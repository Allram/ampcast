(self.webpackChunkampcast=self.webpackChunkampcast||[]).push([[296],{6998:function(e){e.exports=function(e,t){if(null==t&&(t={fuzzy:!0}),/youtu\.?be/.test(e)){var r,n=[/youtu\.be\/([^#\&\?]{11})/,/\?v=([^#\&\?]{11})/,/\&v=([^#\&\?]{11})/,/embed\/([^#\&\?]{11})/,/\/v\/([^#\&\?]{11})/];for(r=0;r<n.length;++r)if(n[r].test(e))return n[r].exec(e)[1];if(t.fuzzy){var i=e.split(/[\/\&\?=#\.\s]/g);for(r=0;r<i.length;++r)if(/^[^#\&\?]{11}$/.test(i[r]))return i[r]}}return null}},2763:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),n=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Float32Array;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t instanceof e?(this.ArrayType=t.ArrayType,this.real=new this.ArrayType(t.real),this.imag=new this.ArrayType(t.imag)):(this.ArrayType=r,this.real=new this.ArrayType(t),this.imag=new this.ArrayType(this.real.length)),this.length=this.real.length}return r(e,[{key:"toString",value:function(){var e=[];return this.forEach((function(t,r){e.push("("+t.real.toFixed(2)+", "+t.imag.toFixed(2)+")")})),"["+e.join(", ")+"]"}},{key:"forEach",value:function(e){for(var t=this.length,r=Object.seal(Object.defineProperties({},{real:{writable:!0},imag:{writable:!0}})),n=0;n<t;n++)r.real=this.real[n],r.imag=this.imag[n],e(r,n,t)}},{key:"map",value:function(e){var t=this;return this.forEach((function(r,n,i){e(r,n,i),t.real[n]=r.real,t.imag[n]=r.imag})),this}},{key:"conjugate",value:function(){return new e(this).map((function(e){e.imag*=-1}))}},{key:"magnitude",value:function(){var e=new this.ArrayType(this.length);return this.forEach((function(t,r){e[r]=Math.sqrt(t.real*t.real+t.imag*t.imag)})),e}}]),e}();t.default=n},4843:(e,t,r)=>{"use strict";var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.rS=function(e){return function(e){return e instanceof l&&e||new l(e)}(e).InvFFT()};var i,a=(i=r(2763))&&i.__esModule?i:{default:i},s=Math.PI,o=Math.SQRT1_2,l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),n(t,[{key:"FFT",value:function(){return c(this,!1)}},{key:"InvFFT",value:function(){return c(this,!0)}},{key:"frequencyMap",value:function(e){return this.FFT().map(e).InvFFT()}}]),t}(a.default);function c(e,t){var r=e.length;return r&r-1?function(e,t){var r=e.length;if(1===r)return e;for(var n=new l(r,e.ArrayType),i=function(e){for(var t=Math.sqrt(e),r=3;r<=t;){if(e%r==0)return r;r+=2}return e}(r),a=r/i,o=1/Math.sqrt(i),u=new l(a,e.ArrayType),d=0;d<i;d++){for(var m=0;m<a;m++)u.real[m]=e.real[m*i+d],u.imag[m]=e.imag[m*i+d];a>1&&(u=c(u,t));for(var h=Math.cos(2*s*d/r),f=(t?-1:1)*Math.sin(2*s*d/r),p=1,b=0,v=0;v<r;v++){var y=u.real[v%a],g=u.imag[v%a];n.real[v]+=p*y-b*g,n.imag[v]+=p*g+b*y;var w=[p*h-b*f,b=p*f+b*h];p=w[0],b=w[1]}}for(var E=0;E<r;E++)e.real[E]=o*n.real[E],e.imag[E]=o*n.imag[E];return e}(e,t):function(e,t){for(var r=e.length,n=function(e){for(var t=e.length,r=new Set,n=0;n<t;n++){var i=u(n,t);if(!r.has(n)){var a=[e.real[i],e.real[n]];e.real[n]=a[0],e.real[i]=a[1];var s=[e.imag[i],e.imag[n]];e.imag[n]=s[0],e.imag[i]=s[1],r.add(i)}}return e}(e),i=n.real,a=n.imag,l=1;l<r;){for(var c=Math.cos(s/l),d=(t?-1:1)*Math.sin(s/l),m=0;m<r/(2*l);m++)for(var h=1,f=0,p=0;p<l;p++){var b=2*m*l+p,v=b+l,y=i[b],g=a[b],w=h*i[v]-f*a[v],E=f*i[v]+h*a[v];i[b]=o*(y+w),a[b]=o*(g+E),i[v]=o*(y-w),a[v]=o*(g-E);var k=[h*c-f*d,h*d+f*c];h=k[0],f=k[1]}l<<=1}return n}(e,t)}function u(e,t){for(var r=0;t>1;)r<<=1,r+=1&e,e>>=1,t>>=1;return r}},745:(e,t,r)=>{"use strict";var n=r(3935);t.s=n.createRoot,n.hydrateRoot},6657:e=>{e.exports=function(e,t,r){"use strict";if(e===t)return 1;if(""===t)return 0;var n=0,i=e.toLowerCase(),a=e.length,s=t.toLowerCase(),o=t.length,l=0,c=1;r=r?1-r:0;for(var u=0;u<o;u+=1){var d=i.indexOf(s[u],l);if(-1===d){if(!r)return 0;c+=r}else{var m=0;l===d?m=.7:(m=.1," "===e[d-1]&&(m+=.8)),e[d]===t[u]&&(m+=.1),n+=m,l=d+1}}var h=.5*(n/a+n/o)/c;return s[0]===i[0]&&h<.85&&(h+=.15),h}},4657:(e,t,r)=>{"use strict";var n=r(7294),i=r(745),a=r(6657),s=r.n(a),o=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function l(e){return null!=e}function c(e){return o(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{const n="ampcast-loaded";let i=document.querySelector(`script[src="${e}"]`);(null==i?void 0:i.hasAttribute(n))?t():(i||(i=document.createElement("script"),i.async=!0,i.src=e),i.addEventListener("load",(function(){this.setAttribute(n,""),t()})),i.addEventListener("error",(()=>r(`Failed to load script: '${e}'`))),i.parentElement||document.head.appendChild(i))}))}))}function u(e,t=1){if(t<=0)return[];const r=[],n=[...e];for(;n.length;)r.push(n.splice(0,t));return r}function d(e,t){const r="function"==typeof t?t:e=>e[t];return e.reduce(((e,t)=>{const n=r(t);return e[n]||(e[n]=[]),e[n].push(t),e}),{})}function m(e,t){const r=[],n=[];for(const i of e)t(i)?r.push(i):n.push(i);return[r,n]}function h(e){return[...new Set(e)]}function f(e){let t=e.length;for(;t>0;){const r=Math.floor(Math.random()*t);t--;const n=e[t];e[t]=e[r],e[r]=n}return e}function p(e=Date.now()){return`${(e=new Date(e)).getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function b(e){return p(e).slice(0,7)}function v(e){return new Date(Math.floor(1e3*(e||0))).toISOString().slice(11,19).replace(/^[0:]+(.{4,})$/,"$1")}function y(e){e.preventDefault()}function g(e){e.stopPropagation()}function w(e){e.preventDefault(),e.stopPropagation()}function E(e,t){return 1===e.length?e[0]:(void 0!==t&&(e=e.filter((e=>e!==t))),e[Math.floor(Math.random()*e.length)])}function k(e,t={}){return h(Object.keys(e).concat(Object.keys(t))).reduce(((r,n)=>(void 0!==e[n]?r[n]=e[n]:void 0!==t[n]&&(r[n]=t[n]),r)),{})}function x(e,t,r){const n=e.filter(t,r);return 0===n.length?e:n}function S(e,t,r=.9){return Math.max(s()(e,t,.99),s()(t,e,.99))>=r}const T=document.createElement("p");function A(e=""){const t=String(null!=e?e:"").trim().split(/[\n\r]+/);return null==t?void 0:t.map((e=>(T.innerHTML=e,T.textContent))).join("\n")}function I(e){return new Promise((t=>setTimeout(t,e)))}const P=["rating","globalRating","playCount","globalPlayCount","inLibrary","lookupStatus"];function C(e){return/m[uú][sz](i|ie)[ckq]/i.test(e)}class M{constructor(e="",t=!1,r=window.console){const n=e?` ${e}:`:"",i=(e,t)=>e&&t?`${e}/${t}`:t||e,a=(...t)=>{e.startsWith(M.only)&&r.log(...t)};this.log=(...e)=>a(`##${n}`,...e),this.warn=(...e)=>a(`###${n}`,...e),this.error=t=>{e.startsWith(M.only)&&(a(`####${n} ERROR`),r.error(t))},t&&(this.next=this.log,this.complete=()=>this.log("***complete***")),this.id=n=>new M(i(e,n),t,r),this.rx=t=>new M(i(e,t),!0,r),this.only=()=>this}}M.only="";const O=M,N=new Map,$={get length(){return N.size},clear(){N.clear()},key(e){var t;return null!==(t=[...N.keys()][e])&&void 0!==t?t:null},getItem(e){var t;return null!==(t=N.get(String(e)))&&void 0!==t?t:null},setItem(e,t){N.set(String(e),String(t))},removeItem(e){N.delete(String(e))}},z=$,j=new O("LiteStorage");class L{constructor(e,t="local"){const r=`${t}-${e}`;if(L.ids.includes(r))throw Error(`Duplicate storageId: ${r}`);switch(L.ids.push(r),this.id=`ampcast/${e}`,t){case"local":this.storage=localStorage;break;case"session":this.storage=sessionStorage;break;case"memory":this.storage=z}}getBoolean(e){const t=this.getItem(e);return!!t&&"false"!==t}setBoolean(e,t){this.setItem(e,String(!!t))}getJson(e,t=null){const r=this.getItem(e);try{return r?JSON.parse(r):t}catch(e){j.error(e)}return t}setJson(e,t){try{null==t?this.removeItem(e):this.setItem(e,JSON.stringify(t))}catch(e){j.error(e)}}getNumber(e,t=0){var r;const n=Number(null!==(r=this.getItem(e))&&void 0!==r?r:t);return isNaN(n)?t:n}setNumber(e,t){this.setItem(e,String(Number(t)||0))}getString(e,t=""){var r;return String(null!==(r=this.getItem(e))&&void 0!==r?r:t)}setString(e,t){this.setItem(e,t)}getItem(e){return this.storage.getItem(`${this.id}/${e}`)}setItem(e,t){e=`${this.id}/${e}`,null==t?this.storage.removeItem(e):this.storage.setItem(e,t)}removeItem(e){this.storage.removeItem(`${this.id}/${e}`)}clear(){const e=`${this.id}/`,t=[];for(let r=0;r<this.storage.length;r++){const n=this.storage.key(r);n.startsWith(e)&&t.push(n)}t.forEach((e=>this.storage.removeItem(e)))}}L.ids=[];const D=L,F=(0,r(3631).qY)(),R=(null==F?void 0:F.name)||"unknown",_=/^edge/.test(R)?"Microsoft Edge":R.replace(/^\w/,(e=>e.toUpperCase())),U=(null==F?void 0:F.version)||"0",V=(null==F?void 0:F.os)||"unknown",B="Mac OS"===V?"metaKey":"ctrlKey",H="Mac OS"===V?"⌘":"Ctrl",Y={name:R,displayName:_,version:U,os:V,desktop:!/^(iOS|Android OS|BlackBerry OS|Windows Mobile|Amazon OS)$/.test(V),ctrlKey:B,ctrlKeyStr:H},q=new D("layout"),K={get:(e,t=0)=>q.getNumber(e,t),set(e,t){q.setNumber(e,t)}};var W=function(e,t){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},W(e,t)};function G(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}W(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function J(e,t){var r,n,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(s=0)),s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}function Q(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function X(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,a=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return s}function Z(e,t,r){if(r||2===arguments.length)for(var n,i=0,a=t.length;i<a;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function ee(e){return this instanceof ee?(this.v=e,this):new ee(e)}function te(e){return"function"==typeof e}function re(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var ne=re((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function ie(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var ae=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,r,n,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var s=Q(a),o=s.next();!o.done;o=s.next())o.value.remove(this)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else a.remove(this);var l=this.initialTeardown;if(te(l))try{l()}catch(e){i=e instanceof ne?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=Q(c),d=u.next();!d.done;d=u.next()){var m=d.value;try{le(m)}catch(e){i=null!=i?i:[],e instanceof ne?i=Z(Z([],X(i)),X(e.errors)):i.push(e)}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}if(i)throw new ne(i)}},e.prototype.add=function(t){var r;if(t&&t!==this)if(this.closed)le(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ie(t,e)},e.prototype.remove=function(t){var r=this._finalizers;r&&ie(r,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),se=ae.EMPTY;function oe(e){return e instanceof ae||e&&"closed"in e&&te(e.remove)&&te(e.add)&&te(e.unsubscribe)}function le(e){te(e)?e():e.unsubscribe()}var ce={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},ue={setTimeout:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=ue.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,Z([e,t],X(r))):setTimeout.apply(void 0,Z([e,t],X(r)))},clearTimeout:function(e){var t=ue.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function de(e){ue.setTimeout((function(){var t=ce.onUnhandledError;if(!t)throw e;t(e)}))}function me(){}var he=fe("C",void 0,void 0);function fe(e,t,r){return{kind:e,value:t,error:r}}var pe=null;function be(e){if(ce.useDeprecatedSynchronousErrorHandling){var t=!pe;if(t&&(pe={errorThrown:!1,error:null}),e(),t){var r=pe,n=r.errorThrown,i=r.error;if(pe=null,n)throw i}}else e()}var ve=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,oe(t)&&t.add(r)):r.destination=Se,r}return G(t,e),t.create=function(e,t,r){return new Ee(e,t,r)},t.prototype.next=function(e){this.isStopped?xe(function(e){return fe("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?xe(fe("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?xe(he,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(ae),ye=Function.prototype.bind;function ge(e,t){return ye.call(e,t)}var we=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){ke(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){ke(e)}else ke(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){ke(e)}},e}(),Ee=function(e){function t(t,r,n){var i,a,s=e.call(this)||this;return te(t)||!t?i={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:s&&ce.useDeprecatedNextContext?((a=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},i={next:t.next&&ge(t.next,a),error:t.error&&ge(t.error,a),complete:t.complete&&ge(t.complete,a)}):i=t,s.destination=new we(i),s}return G(t,e),t}(ve);function ke(e){var t;ce.useDeprecatedSynchronousErrorHandling?(t=e,ce.useDeprecatedSynchronousErrorHandling&&pe&&(pe.errorThrown=!0,pe.error=t)):de(e)}function xe(e,t){var r=ce.onStoppedNotification;r&&ue.setTimeout((function(){return r(e,t)}))}var Se={closed:!0,next:me,error:function(e){throw e},complete:me},Te="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ae(e){return e}var Ie=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n=this,i=function(e){return e&&e instanceof ve||function(e){return e&&te(e.next)&&te(e.error)&&te(e.complete)}(e)&&oe(e)}(e)?e:new Ee(e,t,r);return be((function(){var e=n,t=e.operator,r=e.source;i.add(t?t.call(i,r):r?n._subscribe(i):n._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=Pe(t))((function(t,n){var i=new Ee({next:function(t){try{e(t)}catch(e){n(e),i.unsubscribe()}},error:n,complete:t});r.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Te]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(r=e).length?Ae:1===r.length?r[0]:function(e){return r.reduce((function(e,t){return t(e)}),e)})(this);var r},e.prototype.toPromise=function(e){var t=this;return new(e=Pe(e))((function(e,r){var n;t.subscribe((function(e){return n=e}),(function(e){return r(e)}),(function(){return e(n)}))}))},e.create=function(t){return new e(t)},e}();function Pe(e){var t;return null!==(t=null!=e?e:ce.Promise)&&void 0!==t?t:Promise}var Ce=re((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Me=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return G(t,e),t.prototype.lift=function(e){var t=new Oe(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Ce},t.prototype.next=function(e){var t=this;be((function(){var r,n;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=Q(t.currentObservers),a=i.next();!a.done;a=i.next())a.value.next(e)}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}}}))},t.prototype.error=function(e){var t=this;be((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}}))},t.prototype.complete=function(){var e=this;be((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,r=this,n=r.hasError,i=r.isStopped,a=r.observers;return n||i?se:(this.currentObservers=null,a.push(e),new ae((function(){t.currentObservers=null,ie(a,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,r=t.hasError,n=t.thrownError,i=t.isStopped;r?e.error(n):i&&e.complete()},t.prototype.asObservable=function(){var e=new Ie;return e.source=this,e},t.create=function(e,t){return new Oe(e,t)},t}(Ie),Oe=function(e){function t(t,r){var n=e.call(this)||this;return n.destination=t,n.source=r,n}return G(t,e),t.prototype.next=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)},t.prototype.error=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:se},t}(Me),Ne=function(e){function t(t){var r=e.call(this)||this;return r._value=t,r}return G(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return!r.closed&&t.next(this._value),r},t.prototype.getValue=function(){var e=this,t=e.hasError,r=e.thrownError,n=e._value;if(t)throw r;return this._throwIfClosed(),n},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Me);function $e(e){return function(t){if(function(e){return te(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function ze(e,t,r,n,i){return new je(e,t,r,n,i)}var je=function(e){function t(t,r,n,i,a,s){var o=e.call(this,t)||this;return o.onFinalize=a,o.shouldUnsubscribe=s,o._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,o._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,o}return G(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),!r&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(ve);function Le(e,t,r){var n=te(e)||t||r?{next:e,error:t,complete:r}:e;return n?$e((function(e,t){var r;null===(r=n.subscribe)||void 0===r||r.call(n);var i=!0;e.subscribe(ze(t,(function(e){var r;null===(r=n.next)||void 0===r||r.call(n,e),t.next(e)}),(function(){var e;i=!1,null===(e=n.complete)||void 0===e||e.call(n),t.complete()}),(function(e){var r;i=!1,null===(r=n.error)||void 0===r||r.call(n,e),t.error(e)}),(function(){var e,t;i&&(null===(e=n.unsubscribe)||void 0===e||e.call(n)),null===(t=n.finalize)||void 0===t||t.call(n)})))})):Ae}function De(e,t){return $e((function(r,n){var i=0;r.subscribe(ze(n,(function(r){return e.call(t,r,i++)&&n.next(r)})))}))}function Fe(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var r=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),r&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function Re(e){return Math.min(1,Math.max(0,e))}function _e(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function Ue(e){return e<=1?"".concat(100*Number(e),"%"):e}function Ve(e){return 1===e.length?"0"+e:String(e)}function Be(e,t,r){e=Fe(e,255),t=Fe(t,255),r=Fe(r,255);var n=Math.max(e,t,r),i=Math.min(e,t,r),a=0,s=0,o=(n+i)/2;if(n===i)s=0,a=0;else{var l=n-i;switch(s=o>.5?l/(2-n-i):l/(n+i),n){case e:a=(t-r)/l+(t<r?6:0);break;case t:a=(r-e)/l+2;break;case r:a=(e-t)/l+4}a/=6}return{h:a,s,l:o}}function He(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+6*r*(t-e):r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e}function Ye(e,t,r){e=Fe(e,255),t=Fe(t,255),r=Fe(r,255);var n=Math.max(e,t,r),i=Math.min(e,t,r),a=0,s=n,o=n-i,l=0===n?0:o/n;if(n===i)a=0;else{switch(n){case e:a=(t-r)/o+(t<r?6:0);break;case t:a=(r-e)/o+2;break;case r:a=(e-t)/o+4}a/=6}return{h:a,s:l,v:s}}function qe(e,t,r,n){var i=[Ve(Math.round(e).toString(16)),Ve(Math.round(t).toString(16)),Ve(Math.round(r).toString(16))];return n&&i[0].startsWith(i[0].charAt(1))&&i[1].startsWith(i[1].charAt(1))&&i[2].startsWith(i[2].charAt(1))?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function Ke(e){return We(e)/255}function We(e){return parseInt(e,16)}var Ge={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};var Je="(?:".concat("[-\\+]?\\d*\\.\\d+%?",")|(?:").concat("[-\\+]?\\d+%?",")"),Qe="[\\s|\\(]+(".concat(Je,")[,|\\s]+(").concat(Je,")[,|\\s]+(").concat(Je,")\\s*\\)?"),Xe="[\\s|\\(]+(".concat(Je,")[,|\\s]+(").concat(Je,")[,|\\s]+(").concat(Je,")[,|\\s]+(").concat(Je,")\\s*\\)?"),Ze={CSS_UNIT:new RegExp(Je),rgb:new RegExp("rgb"+Qe),rgba:new RegExp("rgba"+Xe),hsl:new RegExp("hsl"+Qe),hsla:new RegExp("hsla"+Xe),hsv:new RegExp("hsv"+Qe),hsva:new RegExp("hsva"+Xe),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function et(e){return Boolean(Ze.CSS_UNIT.exec(String(e)))}var tt=function(){function e(t,r){var n;if(void 0===t&&(t=""),void 0===r&&(r={}),t instanceof e)return t;"number"==typeof t&&(t=function(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}(t)),this.originalInput=t;var i=function(e){var t,r,n,i={r:0,g:0,b:0},a=1,s=null,o=null,l=null,c=!1,u=!1;return"string"==typeof e&&(e=function(e){if(0===(e=e.trim().toLowerCase()).length)return!1;var t=!1;if(Ge[e])e=Ge[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var r=Ze.rgb.exec(e);return r?{r:r[1],g:r[2],b:r[3]}:(r=Ze.rgba.exec(e))?{r:r[1],g:r[2],b:r[3],a:r[4]}:(r=Ze.hsl.exec(e))?{h:r[1],s:r[2],l:r[3]}:(r=Ze.hsla.exec(e))?{h:r[1],s:r[2],l:r[3],a:r[4]}:(r=Ze.hsv.exec(e))?{h:r[1],s:r[2],v:r[3]}:(r=Ze.hsva.exec(e))?{h:r[1],s:r[2],v:r[3],a:r[4]}:(r=Ze.hex8.exec(e))?{r:We(r[1]),g:We(r[2]),b:We(r[3]),a:Ke(r[4]),format:t?"name":"hex8"}:(r=Ze.hex6.exec(e))?{r:We(r[1]),g:We(r[2]),b:We(r[3]),format:t?"name":"hex"}:(r=Ze.hex4.exec(e))?{r:We(r[1]+r[1]),g:We(r[2]+r[2]),b:We(r[3]+r[3]),a:Ke(r[4]+r[4]),format:t?"name":"hex8"}:!!(r=Ze.hex3.exec(e))&&{r:We(r[1]+r[1]),g:We(r[2]+r[2]),b:We(r[3]+r[3]),format:t?"name":"hex"}}(e)),"object"==typeof e&&(et(e.r)&&et(e.g)&&et(e.b)?(t=e.r,r=e.g,n=e.b,i={r:255*Fe(t,255),g:255*Fe(r,255),b:255*Fe(n,255)},c=!0,u="%"===String(e.r).substr(-1)?"prgb":"rgb"):et(e.h)&&et(e.s)&&et(e.v)?(s=Ue(e.s),o=Ue(e.v),i=function(e,t,r){e=6*Fe(e,360),t=Fe(t,100),r=Fe(r,100);var n=Math.floor(e),i=e-n,a=r*(1-t),s=r*(1-i*t),o=r*(1-(1-i)*t),l=n%6;return{r:255*[r,s,a,a,o,r][l],g:255*[o,r,r,s,a,a][l],b:255*[a,a,o,r,r,s][l]}}(e.h,s,o),c=!0,u="hsv"):et(e.h)&&et(e.s)&&et(e.l)&&(s=Ue(e.s),l=Ue(e.l),i=function(e,t,r){var n,i,a;if(e=Fe(e,360),t=Fe(t,100),r=Fe(r,100),0===t)i=r,a=r,n=r;else{var s=r<.5?r*(1+t):r+t-r*t,o=2*r-s;n=He(o,s,e+1/3),i=He(o,s,e),a=He(o,s,e-1/3)}return{r:255*n,g:255*i,b:255*a}}(e.h,s,l),c=!0,u="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(a=e.a)),a=_e(a),{ok:c,format:e.format||u,r:Math.min(255,Math.max(i.r,0)),g:Math.min(255,Math.max(i.g,0)),b:Math.min(255,Math.max(i.b,0)),a}}(t);this.originalInput=t,this.r=i.r,this.g=i.g,this.b=i.b,this.a=i.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(n=r.format)&&void 0!==n?n:i.format,this.gradientType=r.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=i.ok}return e.prototype.isDark=function(){return this.getBrightness()<128},e.prototype.isLight=function(){return!this.isDark()},e.prototype.getBrightness=function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},e.prototype.getLuminance=function(){var e=this.toRgb(),t=e.r/255,r=e.g/255,n=e.b/255;return.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))},e.prototype.getAlpha=function(){return this.a},e.prototype.setAlpha=function(e){return this.a=_e(e),this.roundA=Math.round(100*this.a)/100,this},e.prototype.isMonochrome=function(){return 0===this.toHsl().s},e.prototype.toHsv=function(){var e=Ye(this.r,this.g,this.b);return{h:360*e.h,s:e.s,v:e.v,a:this.a}},e.prototype.toHsvString=function(){var e=Ye(this.r,this.g,this.b),t=Math.round(360*e.h),r=Math.round(100*e.s),n=Math.round(100*e.v);return 1===this.a?"hsv(".concat(t,", ").concat(r,"%, ").concat(n,"%)"):"hsva(".concat(t,", ").concat(r,"%, ").concat(n,"%, ").concat(this.roundA,")")},e.prototype.toHsl=function(){var e=Be(this.r,this.g,this.b);return{h:360*e.h,s:e.s,l:e.l,a:this.a}},e.prototype.toHslString=function(){var e=Be(this.r,this.g,this.b),t=Math.round(360*e.h),r=Math.round(100*e.s),n=Math.round(100*e.l);return 1===this.a?"hsl(".concat(t,", ").concat(r,"%, ").concat(n,"%)"):"hsla(".concat(t,", ").concat(r,"%, ").concat(n,"%, ").concat(this.roundA,")")},e.prototype.toHex=function(e){return void 0===e&&(e=!1),qe(this.r,this.g,this.b,e)},e.prototype.toHexString=function(e){return void 0===e&&(e=!1),"#"+this.toHex(e)},e.prototype.toHex8=function(e){return void 0===e&&(e=!1),function(e,t,r,n,i){var a,s=[Ve(Math.round(e).toString(16)),Ve(Math.round(t).toString(16)),Ve(Math.round(r).toString(16)),Ve((a=n,Math.round(255*parseFloat(a)).toString(16)))];return i&&s[0].startsWith(s[0].charAt(1))&&s[1].startsWith(s[1].charAt(1))&&s[2].startsWith(s[2].charAt(1))&&s[3].startsWith(s[3].charAt(1))?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}(this.r,this.g,this.b,this.a,e)},e.prototype.toHex8String=function(e){return void 0===e&&(e=!1),"#"+this.toHex8(e)},e.prototype.toHexShortString=function(e){return void 0===e&&(e=!1),1===this.a?this.toHexString(e):this.toHex8String(e)},e.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},e.prototype.toRgbString=function(){var e=Math.round(this.r),t=Math.round(this.g),r=Math.round(this.b);return 1===this.a?"rgb(".concat(e,", ").concat(t,", ").concat(r,")"):"rgba(".concat(e,", ").concat(t,", ").concat(r,", ").concat(this.roundA,")")},e.prototype.toPercentageRgb=function(){var e=function(e){return"".concat(Math.round(100*Fe(e,255)),"%")};return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}},e.prototype.toPercentageRgbString=function(){var e=function(e){return Math.round(100*Fe(e,255))};return 1===this.a?"rgb(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%)"):"rgba(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%, ").concat(this.roundA,")")},e.prototype.toName=function(){if(0===this.a)return"transparent";if(this.a<1)return!1;for(var e="#"+qe(this.r,this.g,this.b,!1),t=0,r=Object.entries(Ge);t<r.length;t++){var n=r[t],i=n[0];if(e===n[1])return i}return!1},e.prototype.toString=function(e){var t=Boolean(e);e=null!=e?e:this.format;var r=!1,n=this.a<1&&this.a>=0;return t||!n||!e.startsWith("hex")&&"name"!==e?("rgb"===e&&(r=this.toRgbString()),"prgb"===e&&(r=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(r=this.toHexString()),"hex3"===e&&(r=this.toHexString(!0)),"hex4"===e&&(r=this.toHex8String(!0)),"hex8"===e&&(r=this.toHex8String()),"name"===e&&(r=this.toName()),"hsl"===e&&(r=this.toHslString()),"hsv"===e&&(r=this.toHsvString()),r||this.toHexString()):"name"===e&&0===this.a?this.toName():this.toRgbString()},e.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},e.prototype.clone=function(){return new e(this.toString())},e.prototype.lighten=function(t){void 0===t&&(t=10);var r=this.toHsl();return r.l+=t/100,r.l=Re(r.l),new e(r)},e.prototype.brighten=function(t){void 0===t&&(t=10);var r=this.toRgb();return r.r=Math.max(0,Math.min(255,r.r-Math.round(-t/100*255))),r.g=Math.max(0,Math.min(255,r.g-Math.round(-t/100*255))),r.b=Math.max(0,Math.min(255,r.b-Math.round(-t/100*255))),new e(r)},e.prototype.darken=function(t){void 0===t&&(t=10);var r=this.toHsl();return r.l-=t/100,r.l=Re(r.l),new e(r)},e.prototype.tint=function(e){return void 0===e&&(e=10),this.mix("white",e)},e.prototype.shade=function(e){return void 0===e&&(e=10),this.mix("black",e)},e.prototype.desaturate=function(t){void 0===t&&(t=10);var r=this.toHsl();return r.s-=t/100,r.s=Re(r.s),new e(r)},e.prototype.saturate=function(t){void 0===t&&(t=10);var r=this.toHsl();return r.s+=t/100,r.s=Re(r.s),new e(r)},e.prototype.greyscale=function(){return this.desaturate(100)},e.prototype.spin=function(t){var r=this.toHsl(),n=(r.h+t)%360;return r.h=n<0?360+n:n,new e(r)},e.prototype.mix=function(t,r){void 0===r&&(r=50);var n=this.toRgb(),i=new e(t).toRgb(),a=r/100;return new e({r:(i.r-n.r)*a+n.r,g:(i.g-n.g)*a+n.g,b:(i.b-n.b)*a+n.b,a:(i.a-n.a)*a+n.a})},e.prototype.analogous=function(t,r){void 0===t&&(t=6),void 0===r&&(r=30);var n=this.toHsl(),i=360/r,a=[this];for(n.h=(n.h-(i*t>>1)+720)%360;--t;)n.h=(n.h+i)%360,a.push(new e(n));return a},e.prototype.complement=function(){var t=this.toHsl();return t.h=(t.h+180)%360,new e(t)},e.prototype.monochromatic=function(t){void 0===t&&(t=6);for(var r=this.toHsv(),n=r.h,i=r.s,a=r.v,s=[],o=1/t;t--;)s.push(new e({h:n,s:i,v:a})),a=(a+o)%1;return s},e.prototype.splitcomplement=function(){var t=this.toHsl(),r=t.h;return[this,new e({h:(r+72)%360,s:t.s,l:t.l}),new e({h:(r+216)%360,s:t.s,l:t.l})]},e.prototype.onBackground=function(t){var r=this.toRgb(),n=new e(t).toRgb(),i=r.a+n.a*(1-r.a);return new e({r:(r.r*r.a+n.r*n.a*(1-r.a))/i,g:(r.g*r.a+n.g*n.a*(1-r.a))/i,b:(r.b*r.a+n.b*n.a*(1-r.a))/i,a:i})},e.prototype.triad=function(){return this.polyad(3)},e.prototype.tetrad=function(){return this.polyad(4)},e.prototype.polyad=function(t){for(var r=this.toHsl(),n=r.h,i=[this],a=360/t,s=1;s<t;s++)i.push(new e({h:(n+s*a)%360,s:r.s,l:r.l}));return i},e.prototype.equals=function(t){return this.toRgbString()===new e(t).toRgbString()},e}();const rt=JSON.parse('{"name":"Astronaut","backgroundColor":"#000000","textColor":"#95a5d6","frameColor":"#141415","frameTextColor":"#b1bdcd","selectedBackgroundColor":"#221650","selectedTextColor":"#ffffff","spacing":0.72,"roundness":0.57,"flat":false}'),nt=JSON.parse('{"name":"Black Gold","backgroundColor":"#0d0c0c","textColor":"#a9aa92","frameColor":"#1c1c12","frameTextColor":"#e8e8bf","selectedBackgroundColor":"#545549","selectedTextColor":"#ffffff","spacing":0.375,"roundness":0.25,"flat":false}'),it=JSON.parse('{"name":"(boring default)","backgroundColor":"#0d0f12","textColor":"#8facbc","frameColor":"#32312f","frameTextColor":"#d1d1d1","selectedBackgroundColor":"#163d5a","selectedTextColor":"#ebebeb","spacing":0.38,"roundness":0.48,"flat":false}'),at=JSON.parse('{"name":"Debug","backgroundColor":"#9dceec","textColor":"#0e0425","frameColor":"#00af4d","frameTextColor":"#fbf6ac","selectedBackgroundColor":"#ffcd03","selectedTextColor":"#000000","buttonColor":"#f57d20","buttonTextColor":"#000000","scrollbarColor":"#dd1a21","scrollbarTextColor":"#fff579","mediaButtonColor":"#f4f4f4","mediaButtonTextColor":"#181818","spacing":0.38,"roundness":0.48,"flat":false}'),st=JSON.parse('{"name":"Glacier","backgroundColor":"#d9e6e8","textColor":"#0d272b","frameColor":"#bfd4e8","frameTextColor":"#1c1c12","selectedBackgroundColor":"#ffffff","selectedTextColor":"#04030c","spacing":0.65,"roundness":0.3,"flat":false}'),ot=JSON.parse('{"name":"Indigo","backgroundColor":"#06181e","textColor":"#d1d3f5","frameColor":"#43477a","frameTextColor":"#f3f3f7","selectedBackgroundColor":"#2c2e4f","selectedTextColor":"#ffffff","spacing":0.625,"roundness":0.84375,"flat":true}'),lt=JSON.parse('{"name":"Moody Blue","backgroundColor":"#051a23","textColor":"#bec1c0","frameColor":"#125673","frameTextColor":"#d8eee7","selectedBackgroundColor":"#124373","selectedTextColor":"#ffffff","spacing":0.53125,"roundness":0.40625,"flat":false}'),ct=JSON.parse('{"name":"Pale Pink","backgroundColor":"#f7f7f7","textColor":"#120f0c","frameColor":"#cfbdd0","frameTextColor":"#121211","selectedBackgroundColor":"#b9d8f3","selectedTextColor":"#000000","spacing":0.375,"roundness":0.53125,"flat":true}'),ut=JSON.parse('{"name":"Purplelicious (Winamp)","backgroundColor":"#000000","textColor":"#ffb464","frameColor":"#3e0445","frameTextColor":"#ffb464","selectedBackgroundColor":"#3e0445","selectedTextColor":"#ffb464","spacing":0.21875,"roundness":0.09375,"flat":false}'),dt=JSON.parse('{"name":"Radioactive","backgroundColor":"#0f0f10","textColor":"#d1f5d2","frameColor":"#322724","frameTextColor":"#c3feca","selectedBackgroundColor":"#43304b","selectedTextColor":"#ffffff","mediaButtonColor":"#c3feca","mediaButtonTextColor":"#021c05","spacing":0.73,"roundness":0.86,"flat":false}'),mt=JSON.parse('{"name":"Saddle","backgroundColor":"#271607","textColor":"#cbbe86","frameColor":"#331d0a","frameTextColor":"#fedfc3","selectedBackgroundColor":"#5d3512","selectedTextColor":"#ffffff","spacing":0.375,"roundness":0.34375,"flat":false}'),ht=JSON.parse('{"name":"Velvet","backgroundColor":"#160916","textColor":"#a7bdd2","frameColor":"#280b1f","frameTextColor":"#cdd1d6","mediaButtonColor":"#aa8f00","mediaButtonTextColor":"#0d0b04","selectedBackgroundColor":"#412438","selectedTextColor":"#ebebeb","spacing":1,"roundness":0.15,"flat":true}'),ft=JSON.parse('{"name":"Winamp Classic","backgroundColor":"#000000","textColor":"#00e200","frameColor":"#383757","frameTextColor":"#d2d2d2","buttonColor":"#464379","buttonTextColor":"#d2d2d2","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#040dae","selectedTextColor":"#d2d2d2","spacing":0.21875,"roundness":0.09375,"flat":false}'),pt=JSON.parse('{"name":"Winamp Modern (WACUP)","backgroundColor":"#14121c","textColor":"#8ac440","frameColor":"#1f1f36","frameTextColor":"#f0f0f0","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#2f2f76","selectedTextColor":"#f0f0f0","spacing":0.21875,"roundness":0.09375,"flat":false}'),bt={name:"(none)",backgroundColor:"black",textColor:"white",frameColor:"black",frameTextColor:"white",selectedBackgroundColor:"blue",selectedTextColor:"white",buttonColor:"",buttonTextColor:"",scrollbarColor:"",scrollbarTextColor:"",mediaButtonColor:"",mediaButtonTextColor:"",spacing:0,roundness:0,flat:!1},vt=Object.assign(Object.assign({},bt),it),yt=[vt,rt,nt,st,ot,lt,ct,ut,dt,mt,ht,ft,pt,at];var gt=r(9520),wt=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Et=new O("themeStore");class kt extends gt.ZP{constructor(){super("ampcast/themes"),this.defaultThemes=new Map(yt.map((e=>[e.name,e]))),this.themes$=new Ne([]),this.version(1).stores({themes:"&name"}),(0,gt.Y1)((()=>this.themes.toArray())).subscribe(this.themes$)}observeUserThemes(){return this.themes$}getDefaultTheme(e){return this.defaultThemes.get(e)}getDefaultThemes(){return[...this.defaultThemes.values()]}getUserTheme(e){return this.getUserThemes().find((t=>t.name===e))}getUserThemes(){return this.themes$.getValue()}save(e){return wt(this,void 0,void 0,(function*(){try{Et.log("save",{theme:e}),yield this.themes.put(Object.assign(Object.assign({},e),{userTheme:!0}))}catch(e){Et.error(e)}}))}remove(e){return wt(this,void 0,void 0,(function*(){try{Et.log("remove",{name:e}),yield this.themes.delete(e)}catch(e){Et.error(e)}}))}rename(e,t){return wt(this,void 0,void 0,(function*(){try{const r=yield this.themes.get(e);if(!r)throw Error(`Theme '${e}' not found.`);yield this.themes.delete(e),yield this.themes.put(Object.assign(Object.assign({},r),{name:t,userTheme:!0}))}catch(e){Et.error(e)}}))}}const xt=new kt,St=new O("theme"),Tt=new class{constructor(){this.defaultFontSize=17.2,this.storage=new D("theme"),this.app=document.getElementById("app"),this.popup=document.getElementById("popup"),this.system=document.getElementById("system"),this.theme$=new Ne(vt),this.applyingUpdate=!1;const e=document.createElement("style");document.head.append(e),this.sheet=e.sheet,this.rootStyle=this.createStyle(":root"),this.appStyle=this.createStyle(".app"),this.playheadStyle=this.createStyle("#playhead"),this.system.classList.toggle("selection-dark",!0),this.restore(),this.observe().pipe(Le((()=>this.applyAppStyles()))).subscribe(St)}observe(){return this.theme$.pipe(De((()=>!this.applyingUpdate)))}get backgroundColor(){return this.current.backgroundColor}set backgroundColor(e){this.setColor("backgroundColor",e)}get black(){if(this.isLight){const e=new tt(this.defaultButtonColor).toHsl();return e.s-=.6*e.s,e.l-=.8*e.l,this.fromHsl(e)}return new tt(this.backgroundColor).darken(33).toHexString()}get buttonColor(){return this.current.buttonColor}set buttonColor(e){this.setColor("buttonColor",e,this.defaultButtonColor),this.scrollbarColor=this.current.scrollbarColor}get buttonTextColor(){return this.current.buttonTextColor}set buttonTextColor(e){this.setColor("buttonTextColor",e,this.defaultButtonTextColor),this.scrollbarTextColor=this.current.scrollbarTextColor}get current(){return this.theme$.value}get defaultButtonColor(){const e=new tt(this.frameColor).toHsl();return e.s+=.05,e.l+=.05,this.fromHsl(e)}get defaultButtonTextColor(){return this.frameTextColor}get defaultMediaButtonColor(){const e=new tt(this.frameColor).toHsl();return e.s+=.33*(1-e.s),e.l+=.5*(1-e.l),this.fromHsl(e)}get defaultMediaButtonTextColor(){const e=new tt(this.mediaButtonColor||this.defaultMediaButtonColor).toHsl();return e.s-=.5*e.s,e.l-=.9*e.l,this.fromHsl(e)}get defaultScrollbarColor(){return this.buttonColor||this.defaultButtonColor}get defaultScrollbarTextColor(){return this.buttonTextColor||this.defaultButtonTextColor}get edited(){const e=this.userTheme?xt.getUserTheme(this.name):xt.getDefaultTheme(this.name);return!!e&&!Object.keys(e).every((t=>e[t]===this[t]))}get flat(){return this.current.flat}set flat(e){this.app.classList.toggle("flat",!!e),this.popup.classList.toggle("flat",!!e),this.theme$.next(Object.assign(Object.assign({},this.current),{flat:e}))}get focusRingColor(){return this.isFrameDark?new tt(this.isMediaButtonLight?this.mediaButtonColor:this.defaultMediaButtonColor).triad()[1].saturate(20).lighten(20).toHexString():new tt(this.frameColor).triad()[2].saturate(33).darken(50).toHexString()}get fontSize(){return Number(this.rootStyle.getPropertyValue("--font-size"))||this.defaultFontSize}set fontSize(e){this.rootStyle.setProperty("--font-size",String(e)),this.createPlayheadSmiley()}get frameColor(){return this.current.frameColor}set frameColor(e){this.setColor("frameColor",e),this.buttonColor=this.current.buttonColor,this.mediaButtonColor=this.current.mediaButtonColor}get frameTextColor(){return this.current.frameTextColor}set frameTextColor(e){this.setColor("frameTextColor",e),this.buttonTextColor=this.current.buttonTextColor}get mediaButtonColor(){return this.current.mediaButtonColor}set mediaButtonColor(e){this.setColor("mediaButtonColor",e,this.defaultMediaButtonColor),this.mediaButtonTextColor=this.current.mediaButtonTextColor}get mediaButtonTextColor(){return this.current.mediaButtonTextColor}set mediaButtonTextColor(e){this.setColor("mediaButtonTextColor",e,this.defaultMediaButtonTextColor),this.createPlayheadSmiley()}get name(){return this.current.name}set name(e){this.theme$.next(Object.assign(Object.assign({},this.current),{name:e}))}get roundness(){return this.current.roundness}set roundness(e){this.setProperty("roundness",e),this.theme$.next(Object.assign(Object.assign({},this.current),{roundness:e}))}get scrollbarColor(){return this.current.scrollbarColor}set scrollbarColor(e){this.setColor("scrollbarColor",e,this.defaultScrollbarColor)}get scrollbarTextColor(){return this.current.scrollbarTextColor}set scrollbarTextColor(e){this.setColor("scrollbarTextColor",e,this.defaultScrollbarTextColor)}get selectedBackgroundColor(){return this.current.selectedBackgroundColor}set selectedBackgroundColor(e){this.setColor("selectedBackgroundColor",e);const t=new tt(e);this.setProperty("selected-background-color-blurred",t.desaturate(50).setAlpha(.75).toRgbString())}get selectedTextColor(){return this.current.selectedTextColor}set selectedTextColor(e){this.setColor("selectedTextColor",e)}get spacing(){return this.current.spacing}set spacing(e){this.setProperty("spacing",e),this.theme$.next(Object.assign(Object.assign({},this.current),{spacing:e}))}get textColor(){return this.current.textColor}set textColor(e){this.setColor("textColor",e)}get isDark(){return new tt(this.backgroundColor).isDark()}get isLight(){return new tt(this.backgroundColor).isLight()}get isButtonDark(){return new tt(this.buttonColor||this.defaultButtonColor).isDark()}get isButtonLight(){return new tt(this.buttonColor||this.defaultButtonColor).isLight()}get isFrameDark(){return new tt(this.frameColor).isDark()}get isFrameLight(){return new tt(this.frameColor).isLight()}get isFrameTextDark(){return new tt(this.frameTextColor).isDark()}get isFrameTextLight(){return new tt(this.frameTextColor).isLight()}get isMediaButtonLight(){return new tt(this.mediaButtonColor).isLight()}get isScrollbarDark(){return new tt(this.scrollbarColor||this.defaultScrollbarColor).isDark()}get isScrollbarLight(){return new tt(this.scrollbarColor||this.defaultScrollbarColor).isLight()}get isSelectionDark(){return new tt(this.selectedBackgroundColor).isDark()}get isSelectionLight(){return new tt(this.selectedBackgroundColor).isLight()}get isTextDark(){return new tt(this.textColor).isDark()}get isTextLight(){return new tt(this.textColor).isLight()}get userTheme(){return!!this.current.userTheme}set userTheme(e){this.theme$.next(Object.assign(Object.assign({},this.current),{userTheme:e}))}getVisualizerColors(){const e=new tt(this.defaultMediaButtonColor);return[this.isDark?this.textColor:this.isFrameTextLight?this.frameTextColor:this.backgroundColor,...e.tetrad().map((e=>e.toRgbString()))]}apply(e){this.applyingUpdate=!0;const t=Object.assign(Object.assign(Object.assign({},bt),{userTheme:void 0}),e);this.frameColor=t.frameColor,this.frameTextColor=t.frameTextColor,Object.assign(this,t),this.applyingUpdate=!1,this.theme$.next(this.current)}applyAppStyles(){this.setProperty("black",this.black),this.setProperty("focus-ring-color",this.focusRingColor),this.toggleClasses(this.app),this.toggleClasses(this.popup)}restore(){const e=this.storage.getJson("current",vt);this.apply(e),this.fontSize=this.storage.getNumber("fontSize",this.defaultFontSize),this.system.classList.toggle("dark",this.isDark),this.system.classList.toggle("light",this.isLight)}save(){this.storage.setNumber("fontSize",this.fontSize),this.storage.setJson("current",this.current),this.system.classList.toggle("dark",this.isDark),this.system.classList.toggle("light",this.isLight)}validate(e){if(!e||"object"!=typeof e||"length"in e)return!1;const t={name:"string",frameColor:"string",frameTextColor:"string",backgroundColor:"string",textColor:"string",selectedBackgroundColor:"string",selectedTextColor:"string"},r={mediaButtonColor:"string",mediaButtonTextColor:"string",buttonColor:"string",buttonTextColor:"string",scrollbarColor:"string",scrollbarTextColor:"string",spacing:"number",roundness:"number",flat:"boolean"};return Object.keys(t).every((r=>r in e&&typeof e[r]===t[r]))&&Object.keys(e).every((n=>n in t||typeof e[n]===r[n]))}toggleClasses(e){const t=e.classList;t.toggle("dark",this.isDark),t.toggle("light",this.isLight),t.toggle("frame-dark",this.isFrameDark),t.toggle("frame-light",this.isFrameLight),t.toggle("frame-text-dark",this.isFrameTextDark),t.toggle("frame-text-light",this.isFrameTextLight),t.toggle("button-dark",this.isButtonDark),t.toggle("button-light",this.isButtonLight),t.toggle("scrollbar-dark",this.isScrollbarDark),t.toggle("scrollbar-light",this.isScrollbarLight),t.toggle("selection-dark",this.isSelectionDark),t.toggle("selection-light",this.isSelectionLight)}setColor(e,t,r){const n=this.toDashName(e);let i=t||r;if(i){"string"==typeof i&&(i=new tt(i));const r=i.toHsl();this.setProperty(`${n}-h`,String(r.h)),this.setProperty(`${n}-s`,100*r.s+"%"),this.setProperty(`${n}-l`,100*r.l+"%"),this.theme$.next(Object.assign(Object.assign({},this.current),{[e]:t?i.toHexString():""}))}else this.setProperty(`${n}-h`,null),this.setProperty(`${n}-s`,null),this.setProperty(`${n}-l`,null),this.theme$.next(Object.assign(Object.assign({},this.current),{[e]:""}))}setProperty(e,t){this.appStyle.setProperty(`--${e}`,null==t?null:String(t))}createStyle(e){const t=this.sheet.insertRule(`${e}{}`);return this.sheet.cssRules[t].style}get smileyColor(){return this.mediaButtonTextColor||this.defaultMediaButtonTextColor}createPlayheadSmiley(){const e=new tt(this.smileyColor).toRgbString(),t=[`<path fill='${e}' d='M 160.5,164.5 C 183.647,162.813 194.147,173.48 192,196.5C 186.494,211.009 175.994,216.842 160.5,214C 145.991,208.494 140.158,197.994 143,182.5C 145.683,173.318 151.517,167.318 160.5,164.5 Z'/>`,`<path fill='${e}' d='M 335.5,164.5 C 358.647,162.813 369.147,173.48 367,196.5C 361.494,211.009 350.994,216.842 335.5,214C 320.991,208.494 315.158,197.994 318,182.5C 320.683,173.318 326.517,167.318 335.5,164.5 Z'/>`,`<path fill='${e}' d='M 164.5,296.5 C 172.699,295.1 179.865,297.1 186,302.5C 201.99,327.582 224.823,341.582 254.5,344.5C 279.499,342.418 299.999,331.751 316,312.5C 318.955,308.756 321.789,304.922 324.5,301C 334.716,294.616 344.55,295.116 354,302.5C 358.296,308.845 359.63,315.845 358,323.5C 334.118,361.698 299.618,382.365 254.5,385.5C 209.382,382.365 174.882,361.698 151,323.5C 148.138,310.557 152.638,301.557 164.5,296.5 Z'/>`].join(""),r=this.createBase64SVG(512,512,t);this.playheadStyle.setProperty("--smiley",r),this.playheadStyle.setProperty("--thumb-size",`${Math.round(1.25*this.fontSize)}px`)}createBase64SVG(e,t,r){return`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='${e}' height='${t}'>${r}</svg>")`}toDashName(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}fromHsl({h:e,s:t,l:r}){return t=Math.min(Math.max(t,0),1),r=Math.min(Math.max(r,0),1),new tt({h:e,s:t,l:r}).toHexString()}};function At(e,t){const r=(0,n.useRef)(t);(0,n.useEffect)((()=>{r.current=t}),[t]),(0,n.useEffect)((()=>{const t=e.current;if(t){const n=new ResizeObserver((()=>{e.current&&r.current()}));return n.observe(t),()=>n.disconnect()}}),[e])}const It=document.createElement("div");function Pt(){const e=(0,n.useRef)(It),[t,r]=(0,n.useState)(0);return(0,n.useEffect)((()=>{It.parentElement||(document.body.append(It),r(Ct()))}),[]),At(e,(()=>r(Ct()))),t}function Ct(){return parseFloat(getComputedStyle(It).fontSize)||Tt.defaultFontSize}function Mt({vertical:e,primary:t,size:r,children:i}){const a={};return t||(e?a.height=`${r}px`:a.width=`${r}px`),n.createElement("div",{className:"layout-pane layout-pane-"+(t?"primary":"secondary"),style:a},i)}function Ot({id:e,arrange:t="columns",primaryIndex:r=0,children:i}){const a=(0,n.useRef)(null),[s,o]=(0,n.useState)({width:0,height:0}),[l,c]=(0,n.useState)(0),[u,d]=(0,n.useState)(0),[m,h]=(0,n.useState)(0),[f,p]=(0,n.useState)((()=>e?K.get(e):0)),[b,v]=(0,n.useState)(-1),[y,g]=(0,n.useState)(0),w=-1!==b,E=Pt(),k="rows"===t;(0,n.useEffect)((()=>{e&&K.set(e,Math.max(f,u))}),[e,f,u]),(0,n.useEffect)((()=>{var e;if(E>0){const t=a.current,r=k?"minHeight":"minWidth",n=t.querySelector(":scope > .layout-pane-primary");if(n){n.style[r]="";const e=parseInt(getComputedStyle(n)[r],10);n.style[r]="unset",c(e||80)}const i=t.querySelector(":scope > .layout-pane-secondary");if(i){i.style[r]="";const n=parseInt(getComputedStyle(i)[r],10);i.style[r]="unset",d(n||80);const a=k?"offsetHeight":"offsetWidth",s=t.querySelector(":scope > .layout-splitter");h(null!==(e=null==s?void 0:s[a])&&void 0!==e?e:4)}}}),[k,E]),(0,n.useLayoutEffect)((()=>{const e=k?s.height:s.width;if(e>0){const t=e-m-f;t<l?p(Math.max(f-(l-t),0)):f<u&&p(Math.min(e-m-l,u))}}),[k,s,l,u,m,f]);const x=(0,n.useCallback)((e=>{if(0===e.button){const t=k?e.screenY:e.screenX;v(t),g(f),e.preventDefault()}}),[k,f]),S=(0,n.useCallback)((e=>{const t=(k?e.screenY:e.screenX)-b;p(0===r?y-t:y+t)}),[k,r,b,y]),T=(0,n.useCallback)((()=>{v(-1),g(0)}),[]);return(0,n.useEffect)((()=>{if(w)return document.documentElement.style.cursor=k?"ns-resize":"ew-resize",document.body.classList.add("dragging"),document.addEventListener("mouseup",T),document.addEventListener("mousemove",S),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",T),document.removeEventListener("mousemove",S)}}),[k,w,S,T]),At(a,(()=>{const e=a.current;o({width:e.clientWidth,height:e.clientHeight})})),n.createElement("div",{className:`splitter splitter-${t}`,id:e,ref:a},n.Children.toArray(i).slice(0,2).map(((e,t)=>{const i=t===r,a=i?0:f,s=[];return 1===t&&s.push(n.createElement("div",{className:"layout-splitter "+(w?"active":""),role:"separator",onMouseDown:x,key:"splitter"})),s.push(n.createElement(Mt,{vertical:k,primary:i,size:a,key:t},e)),s})))}function Nt({name:e,className:t=""}){switch(t=`icon icon-${e} ${t}`,e){case"ampcast":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("circle",{cx:"12",cy:"12",r:"8",strokeWidth:"4",stroke:"orange",fill:"black"}),n.createElement("circle",{cx:"12",cy:"12",r:"2",stroke:"none",fill:"white"}));case"play":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"}));case"pause":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"}));case"stop":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"}));case"volume":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{className:"high medium",stroke:"none",d:"M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"}),n.createElement("path",{className:"medium",stroke:"none",d:"M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"}),n.createElement("path",{stroke:"none",d:"M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182L8 5.525A3.489 3.489 0 0 1 9.025 8 3.49 3.49 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"}));case"muted":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06zm7.137 2.096a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0z"}));case"prev":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z"}));case"next":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z"}));case"calendar":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M128 0c17.7 0 32 14.3 32 32V64H288V32c0-17.7 14.3-32 32-32s32 14.3 32 32V64h48c26.5 0 48 21.5 48 48v48H0V112C0 85.5 21.5 64 48 64H96V32c0-17.7 14.3-32 32-32zM0 192H448V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V192zm64 80v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16zm128 0v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16zm144-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H336zM64 400v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16zm144-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H208zm112 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H336c-8.8 0-16 7.2-16 16z"}));case"shuffle":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M403.8 34.4c12-5 25.7-2.2 34.9 6.9l64 64c6 6 9.4 14.1 9.4 22.6s-3.4 16.6-9.4 22.6l-64 64c-9.2 9.2-22.9 11.9-34.9 6.9s-19.8-16.6-19.8-29.6V160H352c-10.1 0-19.6 4.7-25.6 12.8L284 229.3 244 176l31.2-41.6C293.3 110.2 321.8 96 352 96h32V64c0-12.9 7.8-24.6 19.8-29.6zM164 282.7L204 336l-31.2 41.6C154.7 401.8 126.2 416 96 416H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H96c10.1 0 19.6-4.7 25.6-12.8L164 282.7zm274.6 188c-9.2 9.2-22.9 11.9-34.9 6.9s-19.8-16.6-19.8-29.6V416H352c-30.2 0-58.7-14.2-76.8-38.4L121.6 172.8c-6-8.1-15.5-12.8-25.6-12.8H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H96c30.2 0 58.7 14.2 76.8 38.4L326.4 339.2c6 8.1 15.5 12.8 25.6 12.8h32V320c0-12.9 7.8-24.6 19.8-29.6s25.7-2.2 34.9 6.9l64 64c6 6 9.4 14.1 9.4 22.6s-3.4 16.6-9.4 22.6l-64 64z"}));case"info":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}));case"menu":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"}));case"settings":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}));case"album":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("circle",{cx:"12",cy:"12",r:"8.5",strokeWidth:"6.5",fill:"none"}),n.createElement("circle",{cx:"12",cy:"12",r:"2",stroke:"none"}));case"locked":return n.createElement("svg",{className:t,viewBox:"0 0 448 512",transform:"scale(0.95)"},n.createElement("path",{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"}));case"unlocked":return n.createElement("svg",{className:t,viewBox:"0 0 576 512",transform:"scale(0.95)"},n.createElement("path",{d:"M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"}));case"left":return n.createElement("svg",{className:t,viewBox:"0 0 320 512"},n.createElement("path",{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"}));case"right":return n.createElement("svg",{className:t,viewBox:"0 0 320 512"},n.createElement("path",{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"}));case"saved":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"}));case"unsaved":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM272 80v80H144V80h128zm122 352H54a6 6 0 0 1-6-6V86a6 6 0 0 1 6-6h42v104c0 13.255 10.745 24 24 24h176c13.255 0 24-10.745 24-24V83.882l78.243 78.243a6 6 0 0 1 1.757 4.243V426a6 6 0 0 1-6 6zM224 232c-48.523 0-88 39.477-88 88s39.477 88 88 88 88-39.477 88-88-39.477-88-88-88zm0 128c-22.056 0-40-17.944-40-40s17.944-40 40-40 40 17.944 40 40-17.944 40-40 40z"}));case"close":return n.createElement("svg",{className:t,viewBox:"0 0 64 64"},n.createElement("path",{d:"M 10.5,-0.5 C 12.1667,-0.5 13.8333,-0.5 15.5,-0.5C 20.7971,5.29805 26.2971,10.9647 32,16.5C 37.0314,10.303 42.5314,4.63636 48.5,-0.5C 49.8333,-0.5 51.1667,-0.5 52.5,-0.5C 55.8333,3.5 59.5,7.16667 63.5,10.5C 63.5,11.8333 63.5,13.1667 63.5,14.5C 57.7019,19.7971 52.0353,25.2971 46.5,31C 52.0353,36.7029 57.7019,42.2029 63.5,47.5C 63.5,49.1667 63.5,50.8333 63.5,52.5C 59.5,55.8333 55.8333,59.5 52.5,63.5C 50.8333,63.5 49.1667,63.5 47.5,63.5C 42.1604,57.8275 36.8271,52.1608 31.5,46.5C 25.479,51.8543 19.8123,57.521 14.5,63.5C 13.1667,63.5 11.8333,63.5 10.5,63.5C 7.16667,59.5 3.5,55.8333 -0.5,52.5C -0.5,50.8333 -0.5,49.1667 -0.5,47.5C 5.17254,42.1604 10.8392,36.8271 16.5,31.5C 10.8392,26.1729 5.17254,20.8396 -0.5,15.5C -0.5,13.8333 -0.5,12.1667 -0.5,10.5C 3.5,7.16667 7.16667,3.5 10.5,-0.5 Z"}));case"audio":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("path",{stroke:"none",d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"}));case"video":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{strokeWidth:.5,d:"M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z"}));case"genre":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("path",{stroke:"none",d:"m12 2-5.5 9h11z"}),n.createElement("circle",{stroke:"none",cx:"17.5",cy:"17.5",r:"4.5"}),n.createElement("path",{stroke:"none",d:"M3 13.5h8v8H3z"}));case"star":return n.createElement("svg",{className:t,viewBox:"0 0 576 512"},n.createElement("path",{className:"icon-star-outer",d:"M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z"}),n.createElement("path",{className:"icon-star-inner",d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}));case"star-fill":return n.createElement("svg",{className:t,viewBox:"0 0 576 512"},n.createElement("path",{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}));case"heart":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"}));case"heart-fill":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"}));case"thumbs-up":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z"}));case"tick":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),n.createElement("path",{stroke:"none",d:"M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.235.235 0 0 1 .02-.022z"}));case"plus":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),n.createElement("path",{stroke:"none",d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}));case"tick-fill":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z"}));case"artist":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"}));case"folder":return n.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.25)"},n.createElement("path",{stroke:"none",d:"m9.17 6 2 2H20v10H4V6h5.17M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"}));case"folder-up":return n.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.25)"},n.createElement("path",{stroke:"none",d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V6h5.17l2 2H20v10zM9.41 14.42 11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01l1.41 1.41z"}));case"file-audio":return n.createElement("svg",{className:t,strokeWidth:"0",viewBox:"0 0 16 16"},n.createElement("path",{d:"M14.341 3.579c-0.347-0.473-0.831-1.027-1.362-1.558s-1.085-1.015-1.558-1.362c-0.806-0.591-1.197-0.659-1.421-0.659h-7.75c-0.689 0-1.25 0.561-1.25 1.25v13.5c0 0.689 0.561 1.25 1.25 1.25h11.5c0.689 0 1.25-0.561 1.25-1.25v-9.75c0-0.224-0.068-0.615-0.659-1.421v0zM12.271 2.729c0.48 0.48 0.856 0.912 1.134 1.271h-2.406v-2.405c0.359 0.278 0.792 0.654 1.271 1.134v0zM14 14.75c0 0.136-0.114 0.25-0.25 0.25h-11.5c-0.135 0-0.25-0.114-0.25-0.25v-13.5c0-0.135 0.115-0.25 0.25-0.25 0 0 7.749-0 7.75 0v3.5c0 0.276 0.224 0.5 0.5 0.5h3.5v9.75z"}),n.createElement("path",{d:"M11.817 6.113c-0.116-0.095-0.268-0.133-0.415-0.104l-5 1c-0.234 0.047-0.402 0.252-0.402 0.49v3.701c-0.294-0.128-0.636-0.201-1-0.201-1.105 0-2 0.672-2 1.5s0.895 1.5 2 1.5 2-0.672 2-1.5v-3.59l4-0.8v2.091c-0.294-0.128-0.636-0.201-1-0.201-1.105 0-2 0.672-2 1.5s0.895 1.5 2 1.5 2-0.672 2-1.5v-5c0-0.15-0.067-0.292-0.183-0.387z"}));case"file-video":return n.createElement("svg",{className:t,viewBox:"0 0 16 16",strokeWidth:"0"},n.createElement("path",{d:"M14.341 3.579c-0.347-0.473-0.831-1.027-1.362-1.558s-1.085-1.015-1.558-1.362c-0.806-0.591-1.197-0.659-1.421-0.659h-7.75c-0.689 0-1.25 0.561-1.25 1.25v13.5c0 0.689 0.561 1.25 1.25 1.25h11.5c0.689 0 1.25-0.561 1.25-1.25v-9.75c0-0.224-0.068-0.615-0.659-1.421v0 0zM12.271 2.729c0.48 0.48 0.856 0.912 1.134 1.271h-2.406v-2.405c0.359 0.278 0.792 0.654 1.271 1.134v0 0zM14 14.75c0 0.136-0.114 0.25-0.25 0.25h-11.5c-0.135 0-0.25-0.114-0.25-0.25v-13.5c0-0.135 0.115-0.25 0.25-0.25 0 0 7.749-0 7.75 0v3.5c0 0.276 0.224 0.5 0.5 0.5h3.5v9.75z"}),n.createElement("path",{d:"M4 8h5v5h-5v-5z"}),n.createElement("path",{d:"M9 10l3-2v5l-3-2z"}));case"most-played":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M2 3a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 0-1h-11A.5.5 0 0 0 2 3zm2-2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7A.5.5 0 0 0 4 1zm2.765 5.576A.5.5 0 0 0 6 7v5a.5.5 0 0 0 .765.424l4-2.5a.5.5 0 0 0 0-.848l-4-2.5z"}),n.createElement("path",{stroke:"none",d:"M1.5 14.5A1.5 1.5 0 0 1 0 13V6a1.5 1.5 0 0 1 1.5-1.5h13A1.5 1.5 0 0 1 16 6v7a1.5 1.5 0 0 1-1.5 1.5h-13zm13-1a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5h-13A.5.5 0 0 0 1 6v7a.5.5 0 0 0 .5.5h13z"}));case"clock":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"}));case"globe":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855-.143.268-.276.56-.395.872.705.157 1.472.257 2.282.287V1.077zM4.249 3.539c.142-.384.304-.744.481-1.078a6.7 6.7 0 0 1 .597-.933A7.01 7.01 0 0 0 3.051 3.05c.362.184.763.349 1.198.49zM3.509 7.5c.036-1.07.188-2.087.436-3.008a9.124 9.124 0 0 1-1.565-.667A6.964 6.964 0 0 0 1.018 7.5h2.49zm1.4-2.741a12.344 12.344 0 0 0-.4 2.741H7.5V5.091c-.91-.03-1.783-.145-2.591-.332zM8.5 5.09V7.5h2.99a12.342 12.342 0 0 0-.399-2.741c-.808.187-1.681.301-2.591.332zM4.51 8.5c.035.987.176 1.914.399 2.741A13.612 13.612 0 0 1 7.5 10.91V8.5H4.51zm3.99 0v2.409c.91.03 1.783.145 2.591.332.223-.827.364-1.754.4-2.741H8.5zm-3.282 3.696c.12.312.252.604.395.872.552 1.035 1.218 1.65 1.887 1.855V11.91c-.81.03-1.577.13-2.282.287zm.11 2.276a6.696 6.696 0 0 1-.598-.933 8.853 8.853 0 0 1-.481-1.079 8.38 8.38 0 0 0-1.198.49 7.01 7.01 0 0 0 2.276 1.522zm-1.383-2.964A13.36 13.36 0 0 1 3.508 8.5h-2.49a6.963 6.963 0 0 0 1.362 3.675c.47-.258.995-.482 1.565-.667zm6.728 2.964a7.009 7.009 0 0 0 2.275-1.521 8.376 8.376 0 0 0-1.197-.49 8.853 8.853 0 0 1-.481 1.078 6.688 6.688 0 0 1-.597.933zM8.5 11.909v3.014c.67-.204 1.335-.82 1.887-1.855.143-.268.276-.56.395-.872A12.63 12.63 0 0 0 8.5 11.91zm3.555-.401c.57.185 1.095.409 1.565.667A6.963 6.963 0 0 0 14.982 8.5h-2.49a13.36 13.36 0 0 1-.437 3.008zM14.982 7.5a6.963 6.963 0 0 0-1.362-3.675c-.47.258-.995.482-1.565.667.248.92.4 1.938.437 3.008h2.49zM11.27 2.461c.177.334.339.694.482 1.078a8.368 8.368 0 0 0 1.196-.49 7.01 7.01 0 0 0-2.275-1.52c.218.283.418.597.597.932zm-.488 1.343a7.765 7.765 0 0 0-.395-.872C9.835 1.897 9.17 1.282 8.5 1.077V4.09c.81-.03 1.577-.13 2.282-.287z"}));case"visualizer":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M4 11H2v3h2v-3zm5-4H7v7h2V7zm5-5v12h-2V2h2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1h-2zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3z"}));case"palette":return n.createElement("svg",{className:t,viewBox:"0 0 16 16"},n.createElement("path",{stroke:"none",d:"M8 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 7a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm.5 6a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),n.createElement("path",{stroke:"none",d:"M16 8c0 3.15-1.866 2.585-3.567 2.07C11.42 9.763 10.465 9.473 10 10c-.603.683-.475 1.819-.351 2.92C9.826 14.495 9.996 16 8 16a8 8 0 1 1 8-8zm-8 7c.611 0 .654-.171.655-.176.078-.146.124-.464.07-1.119-.014-.168-.037-.37-.061-.591-.052-.464-.112-1.005-.118-1.462-.01-.707.083-1.61.704-2.314.369-.417.845-.578 1.272-.618.404-.038.812.026 1.16.104.343.077.702.186 1.025.284l.028.008c.346.105.658.199.953.266.653.148.904.083.991.024C14.717 9.38 15 9.161 15 8a7 7 0 1 0-7 7z"}));case"pin":return n.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.125)"},n.createElement("path",{stroke:"none",d:"M14 4v5c0 1.12.37 2.16 1 3H9c.65-.86 1-1.9 1-3V4h4m3-2H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3V4h1c.55 0 1-.45 1-1s-.45-1-1-1z"}));case"pin-fill":return n.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.125)"},n.createElement("path",{stroke:"none",fillRule:"evenodd",d:"M16 9V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3z"}));case"link":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{stroke:"none",d:"M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32H320zM80 32C35.8 32 0 67.8 0 112V432c0 44.2 35.8 80 80 80H400c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32V432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H192c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z"}));case"search":return n.createElement("svg",{className:t,viewBox:"0 0 16 16",transform:"scale(0.875)"},n.createElement("path",{stroke:"none",d:"M15.504 13.616l-3.79-3.223c-0.392-0.353-0.811-0.514-1.149-0.499 0.895-1.048 1.435-2.407 1.435-3.893 0-3.314-2.686-6-6-6s-6 2.686-6 6 2.686 6 6 6c1.486 0 2.845-0.54 3.893-1.435-0.016 0.338 0.146 0.757 0.499 1.149l3.223 3.79c0.552 0.613 1.453 0.665 2.003 0.115s0.498-1.452-0.115-2.003zM6 10c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"}));case"swap":return n.createElement("svg",{className:t,viewBox:"0 0 448 512"},n.createElement("path",{stroke:"none",d:"M438.6 150.6c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.7 96 32 96C14.3 96 0 110.3 0 128s14.3 32 32 32l306.7 0-41.4 41.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96zm-333.3 352c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 416 416 416c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0 41.4-41.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96z"}));case"playlist-add":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("path",{stroke:"none",d:"M14 10H3v2h11v-2zm0-4H3v2h11V6zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zM3 16h7v-2H3v2z"}));case"recently-added":return n.createElement("svg",{className:t,viewBox:"0 0 384 512"},n.createElement("path",{d:"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48z"}),n.createElement("rect",{x:"177",y:"220",width:"40",height:"210",strokeWidth:"20",strokeLinejoin:"round"}),n.createElement("rect",{x:"87",y:"310",width:"210",height:"40",strokeWidth:"20",strokeLinejoin:"round"}));case"playlist":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M88 48C101.3 48 112 58.75 112 72V120C112 133.3 101.3 144 88 144H40C26.75 144 16 133.3 16 120V72C16 58.75 26.75 48 40 48H88zM480 64C497.7 64 512 78.33 512 96C512 113.7 497.7 128 480 128H192C174.3 128 160 113.7 160 96C160 78.33 174.3 64 192 64H480zM480 224C497.7 224 512 238.3 512 256C512 273.7 497.7 288 480 288H192C174.3 288 160 273.7 160 256C160 238.3 174.3 224 192 224H480zM480 384C497.7 384 512 398.3 512 416C512 433.7 497.7 448 480 448H192C174.3 448 160 433.7 160 416C160 398.3 174.3 384 192 384H480zM16 232C16 218.7 26.75 208 40 208H88C101.3 208 112 218.7 112 232V280C112 293.3 101.3 304 88 304H40C26.75 304 16 293.3 16 280V232zM88 368C101.3 368 112 378.7 112 392V440C112 453.3 101.3 464 88 464H40C26.75 464 16 453.3 16 440V392C16 378.7 26.75 368 40 368H88z"}));case"file":case"blob":return n.createElement("svg",{className:t,viewBox:"0 0 448 512",transform:"scale(0.875)"},n.createElement("path",{fill:"#00cccc",d:"M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"}));case"apple":return n.createElement("svg",{className:t,viewBox:"0 0 73 73"},n.createElement("linearGradient",{id:"apple-linear-gradient",gradientUnits:"userSpaceOnUse",x1:"36",y1:"2.2858",x2:"36",y2:"72.455",gradientTransform:"matrix(1 0 0 -1 0 74.0068)"},n.createElement("stop",{offset:"0",style:{stopColor:"#FA233B"}}),n.createElement("stop",{offset:"1",style:{stopColor:"#FB5C74"}})),n.createElement("rect",{className:"icon-apple-inner",x:"10",y:"10",width:"53",height:"53"}),n.createElement("path",{className:"icon-apple-outer",fillRule:"evenodd",clipRule:"evenodd",stroke:"none",d:"M72,19.94c0-0.72-0.01-1.45-0.03-2.17c-0.04-1.58-0.14-3.17-0.42-4.73c-0.28-1.58-0.75-3.06-1.48-4.5\r\n\t\t\tc-0.72-1.41-1.66-2.71-2.78-3.83c-1.12-1.12-2.42-2.06-3.83-2.78c-1.44-0.73-2.91-1.2-4.49-1.48c-1.56-0.28-3.15-0.37-4.73-0.42\r\n\t\t\tC53.51,0.02,52.78,0.01,52.06,0c-0.86,0-1.72,0-2.58,0H22.52c-0.86,0-1.72,0-2.58,0c-0.72,0-1.45,0.01-2.17,0.03\r\n\t\t\tc-1.58,0.04-3.17,0.14-4.73,0.42C11.46,0.74,9.98,1.2,8.55,1.94C7.13,2.66,5.84,3.6,4.72,4.72S2.65,7.13,1.93,8.55\r\n\t\t\tc-0.73,1.44-1.2,2.91-1.48,4.5c-0.28,1.56-0.37,3.15-0.42,4.73C0.02,18.5,0.01,19.22,0,19.94c0,0.86,0,1.72,0,2.58v26.95\r\n\t\t\tc0,0.86,0,1.72,0,2.58c0,0.72,0.01,1.45,0.03,2.17c0.04,1.58,0.14,3.17,0.42,4.73c0.28,1.58,0.75,3.06,1.48,4.5\r\n\t\t\tc0.72,1.41,1.66,2.71,2.78,3.83s2.42,2.06,3.83,2.78c1.44,0.73,2.91,1.2,4.49,1.48c1.56,0.28,3.15,0.37,4.73,0.42\r\n\t\t\tc0.72,0.02,1.45,0.03,2.17,0.03c0.86,0.01,1.72,0,2.58,0h26.95c0.86,0,1.72,0,2.58,0c0.72,0,1.45-0.01,2.17-0.03\r\n\t\t\tc1.58-0.04,3.17-0.14,4.73-0.42c1.58-0.28,3.06-0.75,4.49-1.48c1.41-0.72,2.71-1.66,3.83-2.78c1.12-1.12,2.06-2.41,2.78-3.83\r\n\t\t\tc0.73-1.44,1.2-2.91,1.48-4.5c0.28-1.56,0.37-3.15,0.42-4.73c0.02-0.72,0.03-1.45,0.03-2.17c0.01-0.86,0-1.72,0-2.58V22.52\r\n\t\t\tC72,21.66,72,20.8,72,19.94z M52.71,46.85c0,0.91-0.01,1.74-0.2,2.65c-0.19,0.89-0.53,1.72-1.05,2.47\r\n\t\t\tc-0.52,0.75-1.19,1.36-1.97,1.82c-0.79,0.47-1.62,0.73-2.5,0.91c-1.66,0.33-2.79,0.41-3.86,0.2c-1.03-0.21-1.9-0.68-2.6-1.32\r\n\t\t\tc-1.03-0.95-1.68-2.23-1.82-3.56c-0.16-1.57,0.36-3.24,1.53-4.48c0.59-0.62,1.34-1.11,2.34-1.5c1.04-0.4,2.19-0.65,3.96-1\r\n\t\t\tc0.47-0.09,0.93-0.19,1.4-0.28c0.61-0.12,1.14-0.28,1.56-0.8c0.43-0.52,0.43-1.16,0.43-1.78V24.32c0-1.21-0.54-1.54-1.7-1.32\r\n\t\t\tc-0.83,0.16-18.62,3.75-18.62,3.75c-1,0.24-1.36,0.57-1.36,1.82v23.23c0,0.91-0.05,1.74-0.24,2.65c-0.19,0.89-0.53,1.72-1.05,2.47\r\n\t\t\tc-0.52,0.75-1.19,1.36-1.97,1.82c-0.79,0.47-1.62,0.74-2.5,0.92c-1.66,0.33-2.79,0.41-3.86,0.2c-1.03-0.21-1.9-0.69-2.6-1.33\r\n\t\t\tc-1.03-0.95-1.63-2.23-1.78-3.56c-0.16-1.57,0.31-3.24,1.49-4.48c0.59-0.62,1.34-1.11,2.34-1.5c1.04-0.4,2.19-0.65,3.96-1\r\n\t\t\tc0.47-0.09,0.93-0.19,1.4-0.28c0.61-0.12,1.14-0.28,1.56-0.8c0.42-0.52,0.47-1.13,0.47-1.75c0-4.92,0-26.78,0-26.78\r\n\t\t\tc0-0.36,0.03-0.6,0.05-0.72c0.09-0.56,0.31-1.05,0.72-1.39c0.34-0.28,0.78-0.48,1.33-0.6l0.01,0L49,11.33\r\n\t\t\tc0.19-0.04,1.73-0.31,1.91-0.33c1.16-0.1,1.81,0.66,1.81,1.89L52.71,46.85L52.71,46.85z"}));case"emby":return n.createElement("svg",{className:t,viewBox:"0 0 48 48"},n.createElement("path",{className:"icon-emby-outer",stroke:"none",d:"m9.104 12.415 2.482 2.482L0 26.484l12.414 12.414 2.483-2.483 11.586 11.586L39.725 34.76l-2.483-2.483L48 21.518 35.587 9.104l-2.483 2.483L21.517 0z"}),n.createElement("path",{className:"icon-emby-inner",stroke:"none",d:"M18.45 32.929v-18.1l15.86 9.05-7.93 4.525z"}));case"plex":return n.createElement("svg",{className:t,viewBox:"0 0 122.88 122.88"},n.createElement("path",{className:"icon-plex-outer",d:"M18.43,0h86.02c10.18,0,18.43,8.25,18.43,18.43v86.02c0,10.18-8.25,18.43-18.43,18.43H18.43 C8.25,122.88,0,114.63,0,104.45l0-86.02C0,8.25,8.25,0,18.43,0L18.43,0z"}),n.createElement("polygon",{className:"icon-plex-inner",points:"61.44,16.8 35.52,16.8 61.44,61.44 35.52,106.08 61.44,106.08 87.36,61.44 61.44,16.8"}));case"plex-tidal":case"tidal":return n.createElement("svg",{className:t,viewBox:"0 0 560 560"},n.createElement("path",{className:"icon-tidal-inner",d:"M373.331 186.32l-93.324 93.332-93.337-93.341L280.007 93l93.332 93.309L466.67 93 560 186.318l-93.33 93.341-93.339-93.339zm.01 186.669l-93.334 93.34-93.337-93.34 93.337-93.337 93.334 93.337zm-186.67-186.67l-93.338 93.34L0 186.32 93.333 93l93.337 93.318z",fillRule:"nonzero"}));case"jellyfin":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("defs",null,n.createElement("linearGradient",{id:"jellyfin-linear-gradient",gradientUnits:"userSpaceOnUse",x1:"110.25",y1:"213.3",x2:"496.14",y2:"436.09"},n.createElement("stop",{offset:"0",style:{stopColor:"#aa5cc3"}}),n.createElement("stop",{offset:"1",style:{stopColor:"#00a4dc"}}))),n.createElement("path",{d:"M256,201.6c-20.4,0-86.2,119.3-76.2,139.4s142.5,19.9,152.4,0S276.5,201.6,256,201.6z"}),n.createElement("path",{d:"M256,23.3c-61.6,0-259.8,359.4-229.6,420.1s429.3,60,459.2,0S317.6,23.3,256,23.3z M406.5,390.8c-19.6,39.3-281.1,39.8-300.9,0s110.1-275.3,150.4-275.3S426.1,351.4,406.5,390.8z"}));case"spotify":return n.createElement("svg",{className:t,viewBox:"0 0 168 168"},n.createElement("path",{stroke:"none",d:"m83.996 0.277c-46.249 0-83.743 37.493-83.743 83.742 0 46.251 37.494 83.741 83.743 83.741 46.254 0 83.744-37.49 83.744-83.741 0-46.246-37.49-83.738-83.745-83.738l0.001-0.004zm38.404 120.78c-1.5 2.46-4.72 3.24-7.18 1.73-19.662-12.01-44.414-14.73-73.564-8.07-2.809 0.64-5.609-1.12-6.249-3.93-0.643-2.81 1.11-5.61 3.926-6.25 31.9-7.291 59.263-4.15 81.337 9.34 2.46 1.51 3.24 4.72 1.73 7.18zm10.25-22.805c-1.89 3.075-5.91 4.045-8.98 2.155-22.51-13.839-56.823-17.846-83.448-9.764-3.453 1.043-7.1-0.903-8.148-4.35-1.04-3.453 0.907-7.093 4.354-8.143 30.413-9.228 68.222-4.758 94.072 11.127 3.07 1.89 4.04 5.91 2.15 8.976v-0.001zm0.88-23.744c-26.99-16.031-71.52-17.505-97.289-9.684-4.138 1.255-8.514-1.081-9.768-5.219-1.254-4.14 1.08-8.513 5.221-9.771 29.581-8.98 78.756-7.245 109.83 11.202 3.73 2.209 4.95 7.016 2.74 10.733-2.2 3.722-7.02 4.949-10.73 2.739z"}));case"lastfm":return n.createElement("svg",{className:t,viewBox:"0 0 455 455"},n.createElement("rect",{className:"icon-lastfm-inner",x:"5",y:"5",width:"445",height:"445"}),n.createElement("path",{className:"icon-lastfm-outer",fillRule:"evenodd",clipRule:"evenodd",d:"M0,0v455h455V0H0z M309.94,315.01c-62.425,0-84.085-28.145-95.625-63.145 L202.77,215.77c-8.65-26.33-18.75-46.915-50.505-46.915c-22.035,0-44.395,15.88-44.395,60.275c0,34.63,17.695,56.29,42.575,56.29 c28.145,0,46.915-20.94,46.915-20.94l11.565,31.385c0,0-19.495,19.125-60.275,19.125c-50.51,0-78.65-29.57-78.65-84.435 c0-56.99,28.14-90.565,81.19-90.565c47.99,0,72.165,17.325,87.305,64.235L250.41,240.3c8.65,26.35,23.805,45.47,60.25,45.47 c24.555,0,37.52-5.41,37.52-18.77c0-10.45-6.13-18.025-24.53-22.365l-24.53-5.76c-29.94-7.225-41.855-22.735-41.855-47.265 c0-39.335,31.755-51.6,64.215-51.6c36.82,0,59.18,13.34,62.07,45.82l-36.07,4.335c-1.445-15.53-10.82-22.015-28.145-22.015 c-15.88,0-25.625,7.21-25.625,19.475c0,10.84,4.685,17.325,20.565,20.94l23.085,5.055c31.035,7.21,47.64,22.365,47.64,51.585 C385,301.295,354.685,315.01,309.94,315.01z"}));case"listenbrainz":case"musicbrainz":return n.createElement("svg",{className:t,viewBox:"0 0 27 30"},n.createElement("polygon",{className:`icon-${e}-left`,stroke:"none",points:"13 1 1 8 1 22 13 29 13 1"}),n.createElement("polygon",{className:`icon-${e}-right`,stroke:"none",points:"14 1 26 8 26 22 14 29 14 1"}));case"navidrome":return n.createElement("svg",{className:t,viewBox:"0 0 512 512"},n.createElement("path",{d:"M256 10.449C120.275 10.449 10.449 120.276 10.449 256c0 135.725 109.826 245.551 245.551 245.551S501.551 391.725 501.551 256C501.551 120.276 391.725 10.449 256 10.449z"}),n.createElement("path",{fill:"#fff",d:"M256 168.229c-48.515.0-87.771 39.257-87.771 87.771s39.257 87.771 87.771 87.771 87.771-39.257 87.771-87.771S304.515 168.229 256 168.229z"}),n.createElement("path",{fill:"black",d:"M437.061 74.94C388.735 26.615 324.434.0 256 0S123.265 26.615 74.939 74.94.0 187.566.0 256s26.614 132.735 74.939 181.061S187.566 512 256 512s132.735-26.614 181.061-74.939S512 324.434 512 256 485.386 123.266 437.061 74.94zM256 491.102C126.365 491.102 20.898 385.635 20.898 256S126.365 20.898 256 20.898 491.102 126.365 491.102 256 385.635 491.102 256 491.102z"}),n.createElement("path",{fill:"black",d:"M354.22 256c0-54.158-44.061-98.22-98.22-98.22s-98.22 44.062-98.22 98.22 44.062 98.22 98.22 98.22 98.22-44.061 98.22-98.22zm-175.542.0c0-42.636 34.686-77.322 77.322-77.322s77.322 34.686 77.322 77.322S298.636 333.322 256 333.322 178.678 298.636 178.678 256z"}),n.createElement("path",{fill:"black",d:"M285.257 256c0-16.132-13.124-29.257-29.257-29.257S226.743 239.868 226.743 256s13.125 29.257 29.257 29.257S285.257 272.133 285.257 256zm-37.616.0c0-4.609 3.75-8.359 8.359-8.359 4.609.0 8.359 3.75 8.359 8.359.0 4.609-3.75 8.359-8.359 8.359C251.391 264.359 247.641 260.609 247.641 256z"}),n.createElement("path",{fill:"black",d:"M256 391.837c-5.771.0-10.449 4.678-10.449 10.449s4.678 10.449 10.449 10.449c41.897.0 81.265-16.294 110.853-45.883 29.587-29.587 45.881-68.955 45.881-110.852.0-5.771-4.678-10.449-10.449-10.449s-10.449 4.678-10.449 10.449C391.837 330.9 330.9 391.837 256 391.837z"}),n.createElement("path",{fill:"black",d:"M449.306 245.551c-5.771.0-10.449 4.678-10.449 10.449.0 1.481-.018 2.958-.052 4.43-.136 5.769 4.43 10.557 10.199 10.692.085.002.168.003.252.003 5.656.0 10.307-4.517 10.442-10.202.039-1.637.059-3.279.059-4.925C459.755 250.229 455.077 245.551 449.306 245.551z"}),n.createElement("path",{fill:"black",d:"M447.55 284.239c-5.656-1.145-11.168 2.52-12.308 8.178-17.107 84.854-92.489 146.44-179.242 146.44-5.771.0-10.449 4.678-10.449 10.449s4.678 10.449 10.449 10.449c47.353.0 93.467-16.573 129.847-46.668 35.9-29.697 60.717-71.084 69.881-116.54C456.868 290.891 453.207 285.38 447.55 284.239z"}),n.createElement("path",{fill:"black",d:"M256 120.163c5.771.0 10.449-4.678 10.449-10.449S261.771 99.265 256 99.265c-41.897.0-81.265 16.294-110.853 45.883C115.559 174.735 99.265 214.103 99.265 256c0 5.771 4.678 10.449 10.449 10.449s10.449-4.678 10.449-10.449c0-74.9 60.937-135.837 135.837-135.837z"}),n.createElement("path",{fill:"black",d:"M62.996 240.876c-5.759-.14-10.557 4.43-10.692 10.199-.039 1.637-.059 3.279-.059 4.925.0 5.771 4.678 10.449 10.449 10.449S73.143 261.771 73.143 256c0-1.481.018-2.958.052-4.43C73.331 245.8 68.765 241.013 62.996 240.876z"}),n.createElement("path",{fill:"black",d:"M256 73.143c5.771.0 10.449-4.678 10.449-10.449S261.771 52.245 256 52.245c-47.353.0-93.467 16.573-129.847 46.668-35.9 29.697-60.717 71.084-69.881 116.54-1.14 5.657 2.521 11.168 8.178 12.308.697.141 1.392.208 2.076.208 4.872.0 9.232-3.426 10.232-8.386C93.864 134.729 169.247 73.143 256 73.143z"}));case"subsonic":return n.createElement("svg",{className:t,viewBox:"0 0 700 700",transform:"scale(1.125) translate(0 -1)"},n.createElement("path",{d:"M202 108.1c-7 1.1-8.5 1.6-12.3 4.1-2.7 1.7-3.6 3.1-3.9 5.7-.5 3.8-.1 54.1.6 75.1.2 7.4.5 19.3.6 26.4l.2 12.8-5.8 6-5.9 5.9.2 26.8.2 26.8-20.7 10-20.7 10-5-1.9c-8.5-3.4-21.9-6.6-30.1-7.3-4.4-.4-8.2-.9-8.5-1.1-1.4-.8-1.8 2.8-1.9 16.7-.2 15.1-.2 15.7-1.4 22.9-1.1 5.9-19.2 61.8-21.1 64.6-.7 1.1-4 3.1-7.2 4.3-14.4 5.6-18.6 7.5-21.3 10.1-1.9 1.8-2.8 3.4-2.4 4.4.3.9 5.2 4.2 10.8 7.3 15.6 8.7 17.2 10.2 19.7 18.6 5.3 18.1 9.5 26.3 18.9 37.2 3.3 3.8 6 7.2 6 7.5-.1.3-4 5.5-8.8 11.7-12.8 16.4-17.5 26.8-15.8 35.5 2.9 15.5 33.8 17.4 61.6 3.8 3-1.5 8.6-4.4 12.3-6.5 8.2-4.5 10.7-4.5 26.7.9 15.8 5.2 42 13 55.5 16.5 12.7 3.3 48 11.6 53.3 12.6 1.8.3 7.6 1.4 12.9 2.4 5.4 1.1 11.8 2.2 14.3 2.6 2.5.3 5.2.8 6 1 .8.3 4.7.9 8.5 1.5 3.9.5 7.9 1.1 9 1.4 2.2.4 12.8 1.8 16 2.1 1.1.1 4.7.5 8 .9s8 .9 10.5 1.2c2.5.2 6.5.6 9 .8 26.9 3 67.6 3.5 94.5 1.1 5.6-.5 7.7-.8 18-1.9 33.3-3.9 71.6-15.5 96.4-29.3 29.7-16.4 55.6-43.4 71.2-74 5.5-11 10.6-25.6 11.4-33.3.2-1.4.6-5.1 1-8.3l.8-5.7-9.9.5c-15.4.8-22.7 1.6-30.4 3-8.1 1.5-18.5 3.9-28 6.5-18.5 4.9-45.6 11.8-48.6 12.4-25.6 4.6-31 5.4-49.9 7.1-33.9 3-91.7 2.2-110.2-1.6-5.7-1.1-7.1-2.8-2.5-3 1.5 0 6.3-.2 10.7-.4 4.4-.2 19.3-.6 33-1 13.8-.3 26.8-.7 29-.9 2.2-.2 8-.7 12.9-1.1 4.9-.4 9.7-.8 10.6-1 .9-.2 4.1-.6 7.1-1 25.9-3.2 56.5-10.2 86.5-19.9 27.8-8.9 29.5-9.4 42.4-12 11.9-2.4 28.3-2.8 42.9-1.1l6.4.7-.7-3.3c-5.5-26.1-11.7-40.2-24.9-56.6-8.1-10.2-23-25.1-33.7-33.6-7.6-6.1-24.8-17.9-40.6-27.7-3.6-2.2-6.3-4.8-7.5-7.2-2.9-5.6-4.6-6.1-18.1-5.5-6.5.4-12.2.8-12.6 1.1-.4.2-3.9.7-7.9 1-4 .4-7.8.8-8.5 1.1-.7.2-3.1.6-5.3.9-9.3 1.2-39 5.7-46.5 7.1-1.4.2-5 .7-8 1.1-3 .3-6.6.7-8 .9-12.7 1.8-124.9 2.7-145 1.2-4.1-.3-8.6-.6-10-.6-4.3-.2-.8-1.9 5-2.6 3-.3 7.3-.8 9.5-1 2.2-.2 8.1-.7 13-1 5-.4 11.5-.8 14.5-1 3-.2 10.2-.7 16-1 5.8-.3 12.6-.8 15.2-1 2.5-.2 9-.6 14.5-1 5.4-.3 11.4-.8 13.3-.9 2-.2 7.6-.7 12.5-1.1 4.9-.4 9.6-.8 10.4-1 .9-.1 4.3-.6 7.6-.9 8.5-1 11.9-1.5 21.5-3.3 4.7-.8 9.6-1.7 10.9-2 1.4-.2 2.8-.6 3.1-.8.4-.2 2.1-.7 3.9-1 3.5-.6 17.4-5.2 25.6-8.4l5-1.9-.3-15.4c-.2-8.4-.5-15.4-.7-15.6-.1-.2-4-1.2-8.6-2.3-4.6-1.1-9.1-2.2-9.9-2.4-28.8-7-45.7-10.2-53-9.9-6.2.1-11.3.9-32.1 4.9-.9.2-4 .6-6.9 1-2.9.4-6.2.9-7.4 1.1-12.1 2.3-54.6 2.2-66.8-.1-1.3-.3-4.5-.9-7.3-1.4-6-1.1-10.1-2.6-10.9-4-1.2-1.9-1.3-1.9 28.4-3.6 4.7-.3 11.9-.7 16-1 4.1-.3 11.8-.7 17-1 9.9-.6 17.6-1.2 24.5-2 2.2-.3 6-.7 8.5-.9 6.9-.8 14.4-2.4 18.1-3.9l3.3-1.3-4.8-3.6c-5.2-4-13-6.9-24.6-9.2-7-1.4-9.5-1.7-22.5-3.2-24.4-2.8-62.6-1.6-81.7 2.6-10.8 2.3-15.4 4.7-22.9 11.6-3.2 3-6.5 5.4-7.3 5.4-1 0-1.7-3-2.6-11.3-.7-6.1-1.4-12.3-1.5-13.7-.2-1.4-.6-6.1-.9-10.5-.4-4.4-.8-9.6-1.1-11.5-.2-1.9-.7-6.7-1-10.5-.8-10.5-2.1-24.4-3.1-32.5-2.1-18.3-2.6-19.4-9.6-21.4-7.1-2-10.5-2.3-15.8-1.5zm-82.2 305.3c6.5 4 7.5 42.2 1.5 54.3-2.7 5.4-4.5 6.1-8.1 3.2-6.2-5-6.6-6.7-6.8-26.2-.2-21.4.4-25.1 5.1-29.4 3.3-3.2 5.5-3.7 8.3-1.9zm75.2 3.1c7.6 3.9 12.1 14.6 12.5 29.5.6 19.9-4.7 34.4-13.7 37.9-2.1.8-3.5.5-7-1.2-8.2-4.2-12.1-13.8-12.2-30.7-.1-13.6 1.2-20.2 5.8-27.9 2.3-4.1 3.2-5 6.6-7.4 3-2.1 4.3-2.1 8-.2zm106.7 1.7c14 7 21.7 24.1 20.9 46.8-.3 8.1-1 12.3-3 18.4-4.9 14.4-11.3 20.8-22 22-10.9 1.3-20.2-7.4-25.9-24.4-7.9-23.4.8-54.6 17.5-62.9 5.4-2.6 7-2.6 12.5.1z"}));case"youtube":return n.createElement("svg",{className:t,viewBox:"0 0 576 512",transform:"scale(1.125)"},n.createElement("rect",{className:"icon-youtube-inner",x:"144",y:"128",width:"288",height:"256"}),n.createElement("path",{className:"icon-youtube-outer",d:"M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"}));case"lookup-pending":return n.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 16 16"},n.createElement("title",null,"Lookup scheduled"),n.createElement("circle",{className:"icon-lookup-outer",cx:"8",cy:"8",r:"8",stroke:"none"}),n.createElement("path",{className:"icon-lookup-inner",d:"M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"}));case"lookup-looking":return n.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 100 100"},n.createElement("title",null,"Searching..."),n.createElement("circle",{className:"icon-lookup-outer",cx:"50",cy:"50",r:"50",stroke:"none"}),n.createElement("path",{className:"icon-lookup-inner",d:"M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50"},n.createElement("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"1s",from:"0 50 50",to:"360 50 50",repeatCount:"indefinite"})));case"lookup-not-found":return n.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 16 16",transform:"rotate(45)"},n.createElement("title",null,"Not found"),n.createElement("circle",{className:"icon-lookup-outer",cx:"8",cy:"8",r:"8",stroke:"none"}),n.createElement("path",{className:"icon-lookup-inner",d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}));case"error":return n.createElement("svg",{className:t,viewBox:"0 0 24 24"},n.createElement("circle",{cx:"12",cy:"12",r:"11"}),n.createElement("circle",{cx:"12",cy:"12",r:"6",stroke:"none",fill:"white"}),n.createElement("path",{stroke:"none",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}))}}It.style.cssText="\n    position: absolute;\n    pointer-events: none;\n    visibility: hidden;\n    font-size: 1rem;\n    width: 1rem;\n    height: 1rem;\n    z-index: -1;\n";var $t=r(3121);const zt={left:0,top:0},jt=(0,n.forwardRef)((function(e,t){var{title:r,className:i="",children:a,onClose:s}=e,o=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["title","className","children","onClose"]);const l=(0,n.useRef)(null),[c,u]=(0,n.useState)(zt),[d,m]=(0,n.useState)(null),[h,f]=(0,n.useState)(zt);(0,n.useImperativeHandle)(t,(()=>({close:e=>{var t;(null===(t=l.current)||void 0===t?void 0:t.open)&&l.current.close(e)}}))),(0,n.useEffect)((()=>{const e=l.current;$t.Z.registerDialog(e),e.showModal()}),[]);const p=(0,n.useCallback)((()=>{l.current.close()}),[]),b=(0,n.useCallback)((()=>{s(l.current.returnValue)}),[s]),v=(0,n.useCallback)((e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),l.current.close())}),[]),y=(0,n.useCallback)((e=>{let t=e.target;for(;t&&"BUTTON"!==t.nodeName;)t=t.parentElement;"#cancel"===(null==t?void 0:t.value)&&(e.preventDefault(),l.current.close())}),[]),w=(0,n.useCallback)((e=>{e.preventDefault(),0===e.button&&m({left:e.screenX,top:e.screenY})}),[]),E=(0,n.useCallback)((e=>{f({left:e.screenX-d.left,top:e.screenY-d.top})}),[d]),k=(0,n.useCallback)((e=>{u({left:c.left+(e.screenX-d.left),top:c.top+(e.screenY-d.top)}),f(zt),m(null)}),[c,d]);return(0,n.useEffect)((()=>{if(d)return document.documentElement.style.cursor="default",document.body.classList.add("dragging"),document.addEventListener("mouseup",k),document.addEventListener("mousemove",E),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",k),document.removeEventListener("mousemove",E)}}),[d,E,k]),n.createElement("dialog",Object.assign({},o,{className:`dialog ${i}`,onClose:b,onKeyDown:v,style:{transform:`translate(${c.left+h.left}px, ${c.top+h.top}px)`},ref:l}),n.createElement("header",{className:"dialog-head",onMouseDown:w},n.createElement("h2",null,r),n.createElement("div",{className:"dialog-close",role:"button",onClick:p,onMouseDown:g,"aria-label":"Close"},n.createElement(Nt,{name:"close"}))),n.createElement("div",{className:"dialog-body",onClick:y},a))}));var Lt=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Dt(e,t=!1){return Lt(this,void 0,void 0,(function*(){return new Promise(((r,a)=>{const s=document.createElement("div"),o=(0,i.s)(s);try{const i=e=>{o.unmount(),s.remove(),r(e)};document.getElementById(t?"system":"popup").append(s),o.render(n.createElement(e,{onClose:i}))}catch(e){o.unmount(),s.remove(),a(e)}}))}))}var Ft=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Rt({title:e,message:t,system:r=!1}){return i=this,a=void 0,o=function*(){"string"==typeof t&&(t=n.createElement("p",null,t)),yield Dt((r=>n.createElement(_t,Object.assign({},r,{title:e,message:t}))),r)},new((s=void 0)||(s=Promise))((function(e,t){function r(e){try{l(o.next(e))}catch(e){t(e)}}function n(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof s?e:new s((function(t){t(e)}))}(t.value).then(r,n)}l((o=o.apply(i,a||[])).next())}));var i,a,s,o}function _t(e){var{message:t,title:r="Message"}=e,i=Ft(e,["message","title"]);return n.createElement(jt,Object.assign({},i,{className:"alert-dialog",title:r}),n.createElement("form",{method:"dialog"},n.createElement("div",{className:"alert-message"},t),n.createElement("footer",{className:"dialog-buttons"},n.createElement("button",null,"OK"))))}function Ut({value:e="",submitText:t="Confirm",onCancel:r,onSubmit:i}){return n.createElement("footer",{className:"dialog-buttons"},n.createElement("button",{className:"dialog-button-cancel",type:"button",value:"#cancel",onClick:r},"Cancel"),n.createElement("button",{className:"dialog-button-submit",value:e,onClick:i},t))}var Vt=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Bt=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const Ht=new D("confirm");function Yt({title:e,message:t,okLabel:r,storageId:i,system:a=!1}){return Vt(this,void 0,void 0,(function*(){return!(!i||!Ht.getBoolean(i))||("string"==typeof t&&(t=n.createElement("p",null,t)),"confirmed"===(yield Dt((a=>n.createElement(qt,Object.assign({},a,{title:e,message:t,okLabel:r,storageId:i}))),a)))}))}function qt(e){var{title:t="Confirm",message:r,okLabel:i="OK",storageId:a}=e,s=Bt(e,["title","message","okLabel","storageId"]);const o=(0,n.useId)(),l=(0,n.useRef)(null),c=(0,n.useCallback)((()=>{a&&l.current.checked&&Ht.setBoolean(a,!0)}),[a]);return n.createElement(jt,Object.assign({},s,{className:"confirm-dialog",title:t}),n.createElement("form",{method:"dialog",onSubmit:c},n.createElement("div",{className:"confirm-message"},r),n.createElement(Ut,{value:"confirmed",submitText:i}),a?n.createElement("footer",{className:"confirm-dialog-storage"},n.createElement("input",{id:o,type:"checkbox",ref:l}),n.createElement("label",{htmlFor:o},"Don't show this message again.")):null))}var Kt=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Wt(e){var t,r,i,a,{system:s=!1}=e,o=Kt(e,["system"]);return t=this,r=void 0,a=function*(){return Dt((e=>n.createElement(Gt,Object.assign({},e,o))),s)},new((i=void 0)||(i=Promise))((function(e,n){function s(e){try{l(a.next(e))}catch(e){n(e)}}function o(e){try{l(a.throw(e))}catch(e){n(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(t,r||[])).next())}))}function Gt(e){var{title:t="Input",label:r,suggestedValue:i="",okLabel:a="OK"}=e,s=Kt(e,["title","label","suggestedValue","okLabel"]);const o=(0,n.useId)(),[l,c]=(0,n.useState)(i),u=(0,n.useCallback)((e=>{c(e.target.value)}),[]);return n.createElement(jt,Object.assign({},s,{className:"prompt-dialog",title:t}),n.createElement("form",{method:"dialog"},r?n.createElement("p",{className:"prompt-message"},n.createElement("label",{htmlFor:o},r,": ")):null,n.createElement("p",null,n.createElement("input",{type:"text",id:o,defaultValue:i,autoFocus:!0,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",onChange:u})),n.createElement(Ut,{value:l,submitText:a})))}var Jt=function(e){function t(t,r){return e.call(this)||this}return G(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(ae),Qt={setInterval:function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];var i=Qt.delegate;return(null==i?void 0:i.setInterval)?i.setInterval.apply(i,Z([e,t],X(r))):setInterval.apply(void 0,Z([e,t],X(r)))},clearInterval:function(e){var t=Qt.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},Xt=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.scheduler=t,n.work=r,n.pending=!1,n}return G(t,e),t.prototype.schedule=function(e,t){var r;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),Qt.setInterval(e.flush.bind(e,this),r)},t.prototype.recycleAsyncId=function(e,t,r){if(void 0===r&&(r=0),null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&Qt.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var r,n=!1;try{this.work(e)}catch(e){n=!0,r=e||new Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,r=this.scheduler,n=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ie(n,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Jt),Zt={now:function(){return(Zt.delegate||Date).now()},delegate:void 0},er=function(){function e(t,r){void 0===r&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},e.now=Zt.now,e}(),tr=new(function(e){function t(t,r){void 0===r&&(r=er.now);var n=e.call(this,t,r)||this;return n.actions=[],n._active=!1,n}return G(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var r;this._active=!0;do{if(r=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,r){for(;e=t.shift();)e.unsubscribe();throw r}}},t}(er))(Xt),rr=tr;function nr(e){return e&&te(e.schedule)}function ir(e,t,r){void 0===e&&(e=0),void 0===r&&(r=rr);var n=-1;return null!=t&&(nr(t)?r=t:n=t),new Ie((function(t){var i=function(e){return e instanceof Date&&!isNaN(e)}(e)?+e-r.now():e;i<0&&(i=0);var a=0;return r.schedule((function(){t.closed||(t.next(a++),0<=n?this.schedule(void 0,n):t.complete())}),i)}))}function ar(e,t){return void 0===e&&(e=0),void 0===t&&(t=tr),e<0&&(e=0),ir(e,e,t)}function sr({children:e}){return n.createElement(n.Fragment,null,e)}var or=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function lr(e){return te(null==e?void 0:e.then)}function cr(e){return te(e[Te])}function ur(e){return Symbol.asyncIterator&&te(null==e?void 0:e[Symbol.asyncIterator])}function dr(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var mr="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function hr(e){return te(null==e?void 0:e[mr])}function fr(e){return function(e,t,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),a=[];return n={},s("next"),s("throw"),s("return"),n[Symbol.asyncIterator]=function(){return this},n;function s(e){i[e]&&(n[e]=function(t){return new Promise((function(r,n){a.push([e,t,r,n])>1||o(e,t)}))})}function o(e,t){try{(r=i[e](t)).value instanceof ee?Promise.resolve(r.value.v).then(l,c):u(a[0][2],r)}catch(e){u(a[0][3],e)}var r}function l(e){o("next",e)}function c(e){o("throw",e)}function u(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}(this,arguments,(function(){var t,r,n;return J(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,ee(t.read())];case 3:return r=i.sent(),n=r.value,r.done?[4,ee(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,ee(n)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function pr(e){return te(null==e?void 0:e.getReader)}function br(e){if(e instanceof Ie)return e;if(null!=e){if(cr(e))return i=e,new Ie((function(e){var t=i[Te]();if(te(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(or(e))return t=e,new Ie((function(e){for(var r=0;r<t.length&&!e.closed;r++)e.next(t[r]);e.complete()}));if(lr(e))return n=e,new Ie((function(e){n.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,de)}));if(ur(e))return vr(e);if(hr(e))return r=e,new Ie((function(e){var t,n;try{for(var i=Q(r),a=i.next();!a.done;a=i.next()){var s=a.value;if(e.next(s),e.closed)return}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.complete()}));if(pr(e))return vr(fr(e))}var t,r,n,i;throw dr(e)}function vr(e){return new Ie((function(t){(function(e,t){var r,n,i,a,s,o,l,c;return s=this,o=void 0,c=function(){var s,o;return J(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),r=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=Q(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise((function(n,i){!function(e,t,r,n){Promise.resolve(n).then((function(t){e({value:t,done:r})}),t)}(n,i,(t=e[r](t)).done,t.value)}))}}}(e),l.label=1;case 1:return[4,r.next()];case 2:if((n=l.sent()).done)return[3,4];if(s=n.value,t.next(s),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=l.sent(),i={error:o},[3,11];case 6:return l.trys.push([6,,9,10]),n&&!n.done&&(a=r.return)?[4,a.call(r)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))},new((l=void 0)||(l=Promise))((function(e,t){function r(e){try{i(c.next(e))}catch(e){t(e)}}function n(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(r,n)}i((c=c.apply(s,o||[])).next())}))})(e,t).catch((function(e){return t.error(e)}))}))}function yr(e,t){return $e((function(r,n){var i=0;r.subscribe(ze(n,(function(r){n.next(e.call(t,r,i++))})))}))}function gr(e,t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=!1);var a=t.schedule((function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()}),n);if(e.add(a),!i)return a}function wr(e,t,r){return void 0===r&&(r=1/0),te(t)?wr((function(r,n){return yr((function(e,i){return t(r,e,n,i)}))(br(e(r,n)))}),r):("number"==typeof t&&(r=t),$e((function(t,n){return function(e,t,r,n,i,a,s,o){var l=[],c=0,u=0,d=!1,m=function(){!d||l.length||c||t.complete()},h=function(e){return c<n?f(e):l.push(e)},f=function(e){c++;var i=!1;br(r(e,u++)).subscribe(ze(t,(function(e){t.next(e)}),(function(){i=!0}),void 0,(function(){if(i)try{c--;for(;l.length&&c<n;)e=void 0,e=l.shift(),f(e);m()}catch(e){t.error(e)}var e})))};return e.subscribe(ze(t,h,(function(){d=!0,m()}))),function(){}}(t,n,e,r)})))}var Er=Array.isArray;function kr(e){return yr((function(t){return function(e,t){return Er(t)?e.apply(void 0,Z([],X(t))):e(t)}(e,t)}))}var xr=["addListener","removeListener"],Sr=["addEventListener","removeEventListener"],Tr=["on","off"];function Ar(e,t,r,n){if(te(r)&&(n=r,r=void 0),n)return Ar(e,t,r).pipe(kr(n));var i=X(function(e){return te(e.addEventListener)&&te(e.removeEventListener)}(e)?Sr.map((function(n){return function(i){return e[n](t,i,r)}})):function(e){return te(e.addListener)&&te(e.removeListener)}(e)?xr.map(Ir(e,t)):function(e){return te(e.on)&&te(e.off)}(e)?Tr.map(Ir(e,t)):[],2),a=i[0],s=i[1];if(!a&&or(e))return wr((function(e){return Ar(e,t,r)}))(br(e));if(!a)throw new TypeError("Invalid event target");return new Ie((function(e){var t=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.next(1<t.length?t:t[0])};return a(t),function(){return s(t)}}))}function Ir(e,t){return function(r){return function(n){return e[r](t,n)}}}function Pr(e){return void 0===e&&(e=1/0),wr(Ae,e)}function Cr(e){return e[e.length-1]}function Mr(e){return te(Cr(e))?e.pop():void 0}function Or(e){return nr(Cr(e))?e.pop():void 0}function Nr(e,t){return void 0===t&&(t=0),$e((function(r,n){r.subscribe(ze(n,(function(r){return gr(n,e,(function(){return n.next(r)}),t)}),(function(){return gr(n,e,(function(){return n.complete()}),t)}),(function(r){return gr(n,e,(function(){return n.error(r)}),t)})))}))}function $r(e,t){return void 0===t&&(t=0),$e((function(r,n){n.add(e.schedule((function(){return r.subscribe(n)}),t))}))}function zr(e,t){if(!e)throw new Error("Iterable cannot be null");return new Ie((function(r){gr(r,t,(function(){var n=e[Symbol.asyncIterator]();gr(r,t,(function(){n.next().then((function(e){e.done?r.complete():r.next(e.value)}))}),0,!0)}))}))}function jr(e,t){return t?function(e,t){if(null!=e){if(cr(e))return function(e,t){return br(e).pipe($r(t),Nr(t))}(e,t);if(or(e))return function(e,t){return new Ie((function(r){var n=0;return t.schedule((function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())}))}))}(e,t);if(lr(e))return function(e,t){return br(e).pipe($r(t),Nr(t))}(e,t);if(ur(e))return zr(e,t);if(hr(e))return function(e,t){return new Ie((function(r){var n;return gr(r,t,(function(){n=e[mr](),gr(r,t,(function(){var e,t,i;try{t=(e=n.next()).value,i=e.done}catch(e){return void r.error(e)}i?r.complete():r.next(t)}),0,!0)})),function(){return te(null==n?void 0:n.return)&&n.return()}}))}(e,t);if(pr(e))return function(e,t){return zr(fr(e),t)}(e,t)}throw dr(e)}(e,t):br(e)}function Lr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Pr(1)(jr(e,Or(e)))}function Dr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Or(e);return $e((function(t,n){(r?Lr(e,t,r):Lr(e,t)).subscribe(n)}))}var Fr=new Ie((function(e){return e.complete()}));function Rr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Or(e),n=function(e,t){return"number"==typeof Cr(e)?e.pop():1/0}(e),i=e;return i.length?1===i.length?br(i[0]):Pr(n)(jr(i,r)):Fr}function _r(e,t){return $e((function(r,n){var i=null,a=0,s=!1,o=function(){return s&&!i&&n.complete()};r.subscribe(ze(n,(function(r){null==i||i.unsubscribe();var s=0,l=a++;br(e(r,l)).subscribe(i=ze(n,(function(e){return n.next(t?t(r,e,l,s++):e)}),(function(){i=null,o()})))}),(function(){s=!0,o()})))}))}function Ur(e){return $e((function(t,r){br(e).subscribe(ze(r,(function(){return r.complete()}),me)),!r.closed&&t.subscribe(r)}))}function Vr(e,t){switch(t.type){case"resize":{const r=Math.max(t.clientSize,0),n=Math.max(t.scrollSize,r);if(r!==e.clientSize||n!==e.scrollSize){const t=n-r,i=Br(e.position,t);return Object.assign(Object.assign({},e),{position:i,max:t,clientSize:r,scrollSize:n})}return e}case"scrollBy":{const r=Br(e.position+t.amount,e.max);return r!==e.position?Object.assign(Object.assign({},e),{position:r}):e}case"scrollTo":{const r=Br(t.position,e.max);return r!==e.position?Object.assign(Object.assign({},e),{position:r}):e}default:return e}}function Br(e,t){return Math.min(Math.max(e,0),t)}const Hr={position:0,max:0,clientSize:0,scrollSize:0};const Yr=(0,n.memo)((function(e){var{scrollableId:t,orientation:r,scrollAmount:i,onChange:a,onResize:s,scrollbarRef:o}=e,l=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["scrollableId","orientation","scrollAmount","onChange","onResize","scrollbarRef"]);const c=(0,n.useRef)(null),u=(0,n.useRef)(null),{position:d,max:m,clientSize:h,scrollSize:f,resize:p,scrollBy:b,scrollTo:v}=function(){const[{position:e,max:t,clientSize:r,scrollSize:i},a]=(0,n.useReducer)(Vr,Hr),s=(0,n.useCallback)(((e,t)=>a({type:"resize",clientSize:e,scrollSize:t})),[]),o=(0,n.useCallback)((e=>a({type:"scrollTo",position:e})),[]);return{position:e,max:t,clientSize:r,scrollSize:i,scrollTo:o,scrollBy:(0,n.useCallback)((e=>a({type:"scrollBy",amount:e})),[]),resize:s}}(),[y,g]=(0,n.useState)(0),[E,k]=(0,n.useState)(0),[x,S]=(0,n.useState)(0),[T,A]=(0,n.useState)(-1),[I,P]=(0,n.useState)(0),C=-1!==T,M="vertical"===r,O=Math.ceil(d/m*(E-x));(0,n.useEffect)((()=>{o.current={scrollBy:b,scrollTo:v}}),[o,b,v]),(0,n.useEffect)((()=>p(l.clientSize,l.scrollSize)),[l.clientSize,l.scrollSize,p]),(0,n.useEffect)((()=>null==a?void 0:a(d)),[d,a]),(0,n.useEffect)((()=>null==s?void 0:s(y)),[y,s]),At(c,(()=>{const e=c.current.getBoundingClientRect();k(M?e.height:e.width),g(M?e.width:e.height)})),At(u,(()=>{const e=u.current.getBoundingClientRect();S(M?e.height:e.width)}));const N=(0,n.useCallback)(((e,t)=>{const r=()=>o.current.scrollBy(t),n=t=>t.target===e,i=Ar(document,"mouseup"),a=Rr(Ar(e,"mouseover").pipe(yr(n),Dr(!0)),Ar(e,"mouseout").pipe(De(n),yr((()=>!1)))).pipe(_r(((e,t)=>e?ir(0===t?400:0,40):Fr)),Ur(i)).subscribe(r);return r(),()=>a.unsubscribe()}),[o]),$=(0,n.useCallback)((e=>{if(0===e.button)return N(e.target,-i)}),[i,N]),z=(0,n.useCallback)((e=>{if(0===e.button)return N(e.target,i)}),[i,N]),j=(0,n.useCallback)((e=>{if(0===e.button){const t=M?e.nativeEvent.offsetY:e.nativeEvent.offsetX;return N(e.target,t<O?-h:h)}}),[M,h,O,N]),L=(0,n.useCallback)((e=>{e.stopPropagation(),0===e.button&&(A(M?e.screenY:e.screenX),P(O))}),[M,O]),D=(0,n.useCallback)((e=>{const t=M?e.screenY:e.screenX;v((I+(t-T))*m/(E-x))}),[M,T,I,m,x,E,v]),F=(0,n.useCallback)((()=>{A(-1),P(0)}),[]);return(0,n.useEffect)((()=>{if(C)return document.body.classList.add("dragging"),document.addEventListener("mouseup",F),document.addEventListener("mousemove",D),()=>{document.body.classList.remove("dragging"),document.removeEventListener("mouseup",F),document.removeEventListener("mousemove",D)}}),[C,D,F]),n.createElement("div",{className:`scrollbar scrollbar-${r}`,role:"scrollbar","aria-controls":t,"aria-orientation":r,"aria-valuenow":Number((100*d/m).toFixed(1)),"aria-valuemin":0,"aria-valuemax":100,onContextMenu:w,onMouseDown:w},n.createElement("div",{className:"scrollbar-button scrollbar-button-decrement",onMouseDown:$},n.createElement("svg",{className:"icon",viewBox:"0 0 50 50"},n.createElement("polygon",{points:M?"0,50 25,0 50,50":"50,0 0,25 50,50"}))),n.createElement("div",{className:"scrollbar-track",onMouseDown:j,ref:c},n.createElement("div",{className:"scrollbar-thumb",onMouseDown:L,style:{[M?"height":"width"]:E*(f?h/f:0)+"px",transform:`translate${M?"Y":"X"}(${O}px)`},ref:u})),n.createElement("div",{className:"scrollbar-button scrollbar-button-increment",onMouseDown:z},n.createElement("svg",{className:"icon",viewBox:"0 0 50 50"},n.createElement("polygon",{points:M?"0,0 25,50 50,0":"0,0 50,25 0,50"}))))}));function qr({children:e,scrollWidth:t=0,scrollHeight:r=0,scrollAmount:i=10,droppable:a,onResize:s,onScroll:o,scrollableRef:l}){const c=(0,n.useId)(),u=(0,n.useRef)(null),d=(0,n.useRef)(null),h=(0,n.useRef)(null),f=(0,n.useRef)(null),p=(0,n.useRef)(null),b=(0,n.useRef)(null),[v,y]=(0,n.useState)(0),[g,w]=(0,n.useState)(0),[E,k]=(0,n.useState)(0),[x,S]=(0,n.useState)(0),[T,A]=(0,n.useState)(0),[I,P]=(0,n.useState)(t),[C,M]=(0,n.useState)(r),[O,N]=(0,n.useState)(0),[$,z]=(0,n.useState)(0),[j,L]=(0,n.useState)(!1),[D,F]=(0,n.useState)(!1),[R,_]=(0,n.useState)(0),U=Math.max(O-(D?g:0),0),V=Math.max($-(j?v:0),0),[B,H]=(0,n.useState)(!0);(0,n.useEffect)((()=>{if(j||D){const e=setTimeout((()=>H(!1)),50);return()=>clearTimeout(e)}}),[j,D]),(0,n.useEffect)((()=>{l&&(l.current={scrollTo:({left:e,top:t})=>{void 0!==e&&p.current.scrollTo(e),void 0!==t&&b.current.scrollTo(t)}})}),[l]),(0,n.useEffect)((()=>{L(!(!I||!U)&&I-U>1)}),[I,U]),(0,n.useEffect)((()=>{F(!(!C||!V)&&C-V>1)}),[C,V]),(0,n.useEffect)((()=>{var e;P(0===t?(null===(e=d.current)||void 0===e?void 0:e.scrollWidth)||0:t)}),[t]),(0,n.useEffect)((()=>{var e;M(0===r?(null===(e=d.current)||void 0===e?void 0:e.scrollHeight)||0:r)}),[r]);const Y=(0,n.useCallback)((()=>{const e=u.current;N(e.clientWidth),z(e.clientHeight),k(e.getBoundingClientRect().top)}),[]),q=(0,n.useCallback)((()=>{var e;const n=d.current,i=f.current;0===t&&P(n.scrollWidth),0===r&&M(i.scrollHeight+((null===(e=h.current)||void 0===e?void 0:e.clientHeight)||0));const{clientWidth:a,clientHeight:o}=n,{scrollWidth:l,scrollHeight:c}=i;null==s||s({clientWidth:a,clientHeight:o,scrollWidth:l,scrollHeight:c})}),[t,r,s]);At(u,Y),At(d,q),At(f,q),(0,n.useEffect)((()=>{null==o||o({left:x,top:T})}),[x,T,o]);const K=(0,n.useCallback)((e=>{b.current.scrollBy(3*i*Math.sign(e.deltaY))}),[i]),W=(0,n.useCallback)((e=>{const t=e.nativeEvent.clientY-E;t+i/2>$?_(i):t<i&&_(-i)}),[E,$,i]);(0,n.useEffect)((()=>{if(R){const e=()=>b.current.scrollBy(R),t=ar(100).subscribe(e);return()=>t.unsubscribe()}}),[R]);const G=(0,n.useCallback)((()=>_(0)),[]),[J,Q]=m(n.Children.toArray(e),(e=>(null==e?void 0:e.type)===sr));return n.createElement("div",{className:`scrollable ${j?"overflow-x":""} ${D?"overflow-y":""} ${B?"scrollbars-hidden":""}`,id:c,onWheel:K,ref:u},n.createElement("div",{className:"scrollable-content",onDragOver:a?W:void 0,onDragLeave:a?G:void 0,onDragEnd:a?G:void 0,onDrop:a?G:void 0,style:{right:D?`${g}px`:"0",bottom:j?`${v}px`:"0",transform:`translateX(-${x}px)`},ref:d},J?n.createElement("div",{className:"scrollable-head",ref:h},J):null,n.createElement("div",{className:"scrollable-body",style:{width:t?`${t}px`:void 0}},n.createElement("div",{className:"scrollable-body-content",style:{transform:`translateY(-${T}px)`},ref:f},Q))),n.createElement(Yr,{scrollableId:c,orientation:"horizontal",clientSize:U,scrollSize:I,scrollAmount:i,onChange:S,onResize:y,scrollbarRef:p}),n.createElement(Yr,{scrollableId:c,orientation:"vertical",clientSize:V,scrollSize:C,scrollAmount:i,onChange:A,onResize:w,scrollbarRef:b}))}function Kr(e){return $e((function(t,r){var n=!1,i=null,a=null,s=function(){if(null==a||a.unsubscribe(),a=null,n){n=!1;var e=i;i=null,r.next(e)}};t.subscribe(ze(r,(function(t){null==a||a.unsubscribe(),n=!0,i=t,a=ze(r,s,me),br(e(t)).subscribe(a)}),(function(){s(),r.complete()}),void 0,(function(){i=a=null})))}))}function Wr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return jr(e,Or(e))}function Gr(e,t=200){const[r,i]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{const r=t=>!e||e.includes(t.code),n=(e,t)=>Ar(document,e,{capture:!0}).pipe(De(r),yr((()=>t))),a=Rr(n("keydown",!0),n("keyup",!1)).pipe(Kr((e=>e?Wr(0):ir(t)))).subscribe(i);return()=>a.unsubscribe()}),[e,t]),r}function Jr(e){return{storeExpandedState:(0,n.useCallback)(((t,r)=>{e&&localStorage.setItem(`${e}/${t}`,String(!!r))}),[e]),retrieveExpandedState:(0,n.useCallback)(((t,r=!1)=>{if(e){const n=localStorage.getItem(`${e}/${t}`);return"string"==typeof n?"true"===n:r}return r}),[e]),storeSelectedNodeId:(0,n.useCallback)((t=>{e&&localStorage.setItem(`${e}/selectedId`,t)}),[e]),retrieveSelectedNodeId:(0,n.useCallback)((t=>e&&localStorage.getItem(`${e}/selectedId`)||t),[e])}}function Qr(e,t){return e.reduce(((e,r)=>(t(r.id,r.startExpanded)&&e.push(r.id),r.children?e.concat(Qr(r.children,t)):e)),[])}function Xr(e,t){return(0,n.useMemo)((()=>Zr(e,t)),[e,t])}function Zr(e,t){return e.reduce(((e,r)=>(e.push(r.id),r.children&&t.includes(r.id)?e.concat(Zr(r.children,t)):e)),[])}var en=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function tn({id:e,label:t,children:r=[],selectedId:i,expandedIds:a,level:s,rowHeight:o,nodeIndex:l,setSize:c,emptyMarker:u,onSelect:d,onToggle:m}){const h=a.includes(e),f=0!==r.length,p=e===i,b=`${f?"expandable":""} ${h?"expanded":""} ${p?"selected":""} ${0===r.length?"empty":""}`,v=(0,n.useCallback)((e=>{e.stopPropagation()}),[]),y=(0,n.useCallback)((t=>{t.stopPropagation(),null==d||d(e)}),[e,d]),g=(0,n.useCallback)((t=>{t.stopPropagation(),null==m||m(e)}),[e,m]),w=(0,n.useCallback)((t=>{t.stopPropagation(),null==m||m(e),h&&on(r,i)&&(null==d||d(e))}),[e,i,h,r,d,m]);return n.createElement("li",{className:`tree-view-node ${b}`,id:`tree-view-node-${e}`,role:"treeitem","aria-selected":p?"true":void 0,"aria-expanded":h?"true":void 0,"aria-labelledby":`tree-view-node-label-${e}`,"aria-level":s,"aria-setsize":c,"aria-posinset":l+1,onMouseDown:y},n.createElement("span",{className:"tree-view-row "+(p?"selected-text":""),onDoubleClick:f?g:void 0,style:{height:`${o}px`}},f?n.createElement("svg",{className:"tree-view-node-marker",viewBox:`0 0 ${h?320:256} 512`,onMouseDown:v,onClick:w},h?n.createElement("path",{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"}):n.createElement("path",{d:"M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"})):u&&n.createElement("svg",{className:"tree-view-node-marker empty-marker",viewBox:"0 0 24 24",onMouseDown:v},n.createElement("circle",{cx:"12",cy:"12",r:"4"})),n.createElement("span",{className:"tree-view-node-label",id:`tree-view-node-label-${e}`},t)),h&&n.createElement("ul",{className:"tree-view-node-children",role:"group"},r.map(((e,t)=>{var{id:l}=e,c=en(e,["id"]);return n.createElement(tn,Object.assign({},c,{id:l,selectedId:i,expandedIds:a,level:s+1,rowHeight:o,nodeIndex:t,setSize:r.length,onSelect:d,onToggle:m,key:l}))}))))}var rn=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const nn=24,an=["ArrowUp","ArrowDown"];function sn({roots:e,className:t="",storageId:r,onContextMenu:i,onDelete:a,onEnter:s,onInfo:o,onSelect:l,treeViewRef:c}){const u=(0,n.useRef)(null),d=(0,n.useRef)(null),m=(0,n.useRef)(null),{storeSelectedNodeId:h,retrieveSelectedNodeId:f}=Jr(r),[p,b]=(0,n.useState)(""),{expandedIds:v,toggle:y}=function(e,t){const{storeExpandedState:r,retrieveExpandedState:i}=Jr(t),[a,s]=(0,n.useState)((()=>Qr(e,i)));(0,n.useEffect)((()=>{s(Qr(e,i))}),[e,i]);const o=(0,n.useCallback)(((e,t)=>{const n=a.includes(e);n!==t&&(s(n?a.filter((t=>t!==e)):a.concat(e)),r(e,!n))}),[a,r]);return{expandedIds:a,toggle:o}}(e,r),g=Xr(e,v),w=g.indexOf(p),[E,k]=(0,n.useState)(0),[x,S]=(0,n.useState)(nn),[T,A]=(0,n.useState)(0),I=Math.floor(E/x)-1,P=g.length,C=ln(e,p),M=Gr(an)&&!(0===w||w===P-1),[O,N]=(0,n.useState)((()=>C)),$=(0,n.useCallback)((()=>u.current.focus()),[]);(0,n.useEffect)((()=>{c&&(c.current={focus:$})}),[c,$]),(0,n.useEffect)((()=>{if(!on(e,p)){const t=e.find((e=>null==p?void 0:p.startsWith(`${e.id}/`)))||e[0];b(null==t?void 0:t.id)}}),[e,p]),(0,n.useEffect)((()=>{!p&&e.length>0&&b(f(e[0].id))}),[e,p,f]),(0,n.useEffect)((()=>{null==l||l(O)}),[O,l]),(0,n.useEffect)((()=>{p&&h(p)}),[p,h]),(0,n.useEffect)((()=>{M||N(C)}),[C,M]);const z=(0,n.useCallback)((e=>{e.preventDefault(),null==i||i(C,e.pageX,e.pageY)}),[C,i]),j=(0,n.useCallback)((e=>{switch(e.code){case"Enter":e.stopPropagation(),e.repeat||null==s||s(C);break;case"Delete":e.stopPropagation(),e.repeat||null==a||a(C);break;case"KeyI":e.stopPropagation(),!e[Y.ctrlKey]||e.shiftKey||e.repeat||null==o||o(C);break;case"ArrowLeft":e.stopPropagation(),e.repeat||y(p,!1);break;case"ArrowRight":e.stopPropagation(),e.repeat||y(p,!0);break;default:{const t=function(e,t,r){switch(e){case"ArrowUp":return t[t.indexOf(r)-1]||r;case"ArrowDown":return t[t.indexOf(r)+1]||r;case"Home":return t[0]||r;case"End":return t[t.length-1]||r;default:return""}}(e.key,g,p);if(t&&(e.preventDefault(),t!==p)){e.stopPropagation();const r=d.current,n=Math.floor(T/x),i=g.indexOf(t);if(i>=n+I-1){const e=P*x,t=P-I-1,n=Math.min(P-1,i+1)-I,a=n===t?e:n*x;r.scrollTo({top:a})}else if(i<=n){const e=Math.max(0,i-1)*x;r.scrollTo({top:e})}b(t)}}}}),[g,p,C,x,I,P,T,a,s,o,y]),L=(0,n.useCallback)((({clientHeight:e})=>k(e)),[]),D=(0,n.useCallback)((({top:e})=>A(e)),[]);return At(m,(()=>{S(m.current.getBoundingClientRect().height)})),n.createElement("div",{className:`tree-view ${t}`,tabIndex:0,onContextMenu:z,onKeyDown:j,ref:u},n.createElement(qr,{scrollAmount:x,onResize:L,onScroll:D,scrollableRef:d},n.createElement("ul",{role:"tree"},e.map(((t,r)=>{var{id:i}=t,a=rn(t,["id"]);return n.createElement(tn,Object.assign({},a,{id:i,selectedId:p,expandedIds:v,level:1,rowHeight:x,nodeIndex:r,setSize:e.length,emptyMarker:!0,onSelect:b,onToggle:y,key:i}))}))),n.createElement("div",{className:"tree-view-cursor",style:{transform:`translateY(${w*x}px)`},ref:m})))}function on(e,t){for(const r of e){if(r.id===t)return!0;if(r.children&&on(r.children,t))return!0}return!1}function ln(e,t){return e.reduce(((e,r)=>{if(void 0===e)if(r.id===t)e=r.value;else if(r.children)return ln(r.children,t);return e}),void 0)}const cn=new D("services"),un=cn.getJson("hidden",{}),dn=new Ne(un);function mn(e){var t;return null!==(t=dn.getValue()[e.id])&&void 0!==t?t:!!e.defaultHidden}function hn(e){return!mn(e)}function fn(e){const t=dn.getValue(),r=Object.assign(Object.assign({},t),e);cn.setJson("hidden",r),dn.next(r)}function pn(e){return $e((function(t,r){var n=!1,i=0;t.subscribe(ze(r,(function(t){return(n||(n=!e(t,i++)))&&r.next(t)})))}))}var bn;!function(e){e[e.PublicMedia=0]="PublicMedia",e[e.PersonalMedia=1]="PersonalMedia",e[e.Scrobbler=2]="Scrobbler"}(bn||(bn={}));const vn=bn;var yn=Array.isArray,gn=Object.getPrototypeOf,wn=Object.prototype,En=Object.keys;function kn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Or(e),n=Mr(e),i=function(e){if(1===e.length){var t=e[0];if(yn(t))return{args:t,keys:null};if((n=t)&&"object"==typeof n&&gn(n)===wn){var r=En(t);return{args:r.map((function(e){return t[e]})),keys:r}}}var n;return{args:e,keys:null}}(e),a=i.args,s=i.keys;if(0===a.length)return jr([],r);var o=new Ie(function(e,t,r){return void 0===r&&(r=Ae),function(n){xn(t,(function(){for(var i=e.length,a=new Array(i),s=i,o=i,l=function(i){xn(t,(function(){var l=jr(e[i],t),c=!1;l.subscribe(ze(n,(function(e){a[i]=e,c||(c=!0,o--),o||n.next(r(a.slice()))}),(function(){--s||n.complete()})))}),n)},c=0;c<i;c++)l(c)}),n)}}(a,r,s?function(e){return function(e,t){return e.reduce((function(e,r,n){return e[r]=t[n],e}),{})}(s,e)}:Ae));return n?o.pipe(kr(n)):o}function xn(e,t,r){e?gr(r,e,t):t()}function Sn(e,t){return void 0===t&&(t=Ae),e=null!=e?e:Tn,$e((function(r,n){var i,a=!0;r.subscribe(ze(n,(function(r){var s=t(r);!a&&e(i,s)||(a=!1,i=s,n.next(r))})))}))}function Tn(e,t){return e===t}function An(e,t){return te(t)?wr(e,t,1):wr(e,1)}function In(e){return $e((function(t,r){var n,i=null,a=!1;i=t.subscribe(ze(r,void 0,void 0,(function(s){n=br(e(s,In(e)(t))),i?(i.unsubscribe(),i=null,n.subscribe(r)):a=!0}))),a&&(i.unsubscribe(),i=null,n.subscribe(r))}))}const Pn=new Me,Cn={dispatch:function(e){const t=Array.isArray(e)?e:[e];Pn.next(t)},observe:function(){return Pn}};var Mn=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};class On extends gt.ZP{constructor(){super("ampcast/pending-actions"),this.libraryRemovals$=new Ne([]),this.ratingChanges$=new Ne([]),this.lock$=new Ne(null),this.logger=new O("actionsStore"),this.version(1).stores({libraryRemovals:"&src",ratingChanges:"&src"}),(0,gt.Y1)((()=>this.ratingChanges.toArray())).subscribe(this.ratingChanges$),(0,gt.Y1)((()=>this.libraryRemovals.toArray())).subscribe(this.libraryRemovals$)}registerServices(e){for(const t of e)this.registerService(t)}lock(e,t){this.lock$.next({serviceId:e,itemType:t})}unlock(){this.lock$.next(null)}getInLibrary(e,t){return!this.getLibraryRemovedItem(e)&&t}getRating(e,t){const r=this.getRatingChangedItem(e);return r?r.rating:t}rate(e,t){return Mn(this,void 0,void 0,(function*(){const r=e.src,[n]=r.split(":"),i=Tm(n);if(!i)throw Error(`Service not found '${n}'`);if(!i.rate)throw Error(`rate() not supported by ${n}`);if(this.isLocked(e))yield this.ratingChanges.put(this.createStorableMediaObject(Object.assign(Object.assign({},e),{rating:t})));else{const r=this.getRatingChangedItem(e);r&&(yield this.ratingChanges.delete(r.src)),yield i.rate(e,t)}Cn.dispatch({match:t=>i.compareForRating(t,e),values:{rating:t}})}))}store(e,t){return Mn(this,void 0,void 0,(function*(){const r=e.src,[n]=r.split(":"),i=Tm(n);if(!i)throw Error(`Service not found '${n}'`);if(!i.store)throw Error(`store() not supported by ${n}`);if(this.isLocked(e))t?yield this.libraryRemovals.delete(r):yield this.libraryRemovals.put(this.createStorableMediaObject(e));else{const r=this.getLibraryRemovedItem(e);r&&(yield this.libraryRemovals.delete(r.src)),yield i.store(e,t)}Cn.dispatch({match:t=>i.compareForRating(t,e),values:{inLibrary:t}})}))}observeLibraryRemovals(e){return this.observeUpdates(e,this.libraryRemovals$)}observeRatingChanges(e){return this.observeUpdates(e,this.ratingChanges$)}observeUpdates(e,t){return kn([t,this.lock$]).pipe(De((([e])=>e.length>0)),yr((([t])=>t.filter((t=>t.src.startsWith(`${e.id}:`)&&!this.isLocked(t))))),Sn(((e,t)=>{const r=e.map((e=>e.src)).sort(),n=t.map((e=>e.src)).sort();return String(r)===String(n)})))}bulkRate(e,t,r,n=10){return Mn(this,void 0,void 0,(function*(){const i=t=>Mn(this,void 0,void 0,(function*(){const n=t.map((e=>e.src));yield this.ratingChanges.bulkDelete(n),Cn.dispatch({match:r=>t.some((t=>e.compareForRating(r,t))),values:{rating:r}})}));if(e.bulkRate)yield e.bulkRate(t,r),i(t);else{const a=u(t,n);for(const t of a)yield Promise.all(t.map((t=>e.rate(t,r)))),i(t)}}))}bulkRemoveFromLibrary(e,t,r=10){return Mn(this,void 0,void 0,(function*(){const n=!1,i=t=>Mn(this,void 0,void 0,(function*(){const r=t.map((e=>e.src));yield this.libraryRemovals.bulkDelete(r),Cn.dispatch({match:r=>t.some((t=>e.compareForRating(r,t))),values:{inLibrary:n}})}));if(e.bulkStore)yield e.bulkStore(t,n),i(t);else{const a=u(t,r);for(const t of a)yield Promise.all(t.map((t=>e.store(t,n)))),i(t)}}))}createStorableMediaObject(e){if("pager"in e){const{pager:t}=e;return function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["pager"])}return e}getRatingChangedItem(e){const t=Am(e);if(null==t?void 0:t.rate)return this.ratingChanges$.getValue().find((r=>t.compareForRating(r,e)))}getLibraryRemovedItem(e){const t=Am(e);if(null==t?void 0:t.store)return this.libraryRemovals$.getValue().find((r=>t.compareForRating(r,e)))}isLocked(e){const t=this.lock$.getValue();if(t){const[r]=e.src.split(":");return t.serviceId===r&&t.itemType===e.itemType}return!1}registerService(e,t){if(e.rate){const r=this.logger.id(`${e.id}/rating`);this.observeRatingChanges(e).pipe(De((e=>e.length>0)),yr((e=>d(e,(e=>e.rating)))),wr((e=>Object.keys(e).map((t=>({items:e[t],rating:Number(t)}))))),An((({items:r,rating:n})=>this.bulkRate(e,r,n,t))),In((e=>(r.error(e),[])))).subscribe(r)}if(e.store){const r=this.logger.id(`${e.id}/inLibrary`);this.observeLibraryRemovals(e).pipe(De((e=>e.length>0)),An((r=>this.bulkRemoveFromLibrary(e,r,t))),In((e=>(r.error(e),[])))).subscribe(r)}}}const Nn=new On;var $n;!function(e){e.Pin="pin",e.Unpin="unpin",e.Like="like",e.Unlike="unlike",e.Rate="rate",e.Info="info",e.AddToLibrary="library-add",e.RemoveFromLibrary="library-remove",e.PlayNow="play-now",e.PlayNext="play-next",e.Queue="queue"}($n||($n={}));const zn=$n;var jn;!function(e){e[e.Media=0]="Media",e[e.Album=1]="Album",e[e.Artist=2]="Artist",e[e.Playlist=3]="Playlist",e[e.Folder=4]="Folder"}(jn||(jn={}));const Ln=jn;var Dn;!function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video"}(Dn||(Dn={}));const Fn=Dn;function Rn(e){return e<=0?function(){return Fr}:$e((function(t,r){var n=0;t.subscribe(ze(r,(function(t){++n<=e&&(r.next(t),e<=n&&r.complete())})))}))}function _n(e,{timeout:t=5e3,keepAlive:r=!1}={}){return new Promise(((n,i)=>{const a=r?void 0:()=>e.disconnect(),s=e.observeItems(),o=Rr(e.observeError(),ir(t).pipe(yr((()=>Error("timeout")))));s.pipe(Ur(o),Rn(1)).subscribe({next:n,complete:a}),o.pipe(Ur(s),Rn(1)).subscribe({next:i,complete:a}),e.fetchAt(0)}))}class Un{constructor(e=[]){this.items=e,this.maxSize=void 0}observeItems(){return Wr(this.items)}observeSize(){return Wr(this.items.length)}observeError(){return Fr}fetchAt(){}disconnect(){this.items.forEach((e=>{var t;return null===(t=null==e?void 0:e.pager)||void 0===t?void 0:t.disconnect()}))}}const Vn="eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Ijk3RjI2N1daRDkifQ.eyJpYXQiOjE2NzY5MTcxNzEsImV4cCI6MTY5MjQ2OTE3MSwiaXNzIjoiODM4Nk5ERlhMQiJ9.gb8gDSxxWxSQNKWz_OtyMumKDn8wil6kYAMYHcNgzYhr9k0QS7R8JJp_3DCJxy_9KlgGe7wmlLESpvsQ2Zd2Pg".toString(),Bn="41bd731be5b78200d2bbaea2312b917b".toString(),Hn="78aa93b641329f00e68cf1542356b8fc".toString(),Yn="68c1c915728f4b9da193da1028692f0d".toString(),qn="AIzaSyD-cQaU5ntJBcCEBAbmK5pIXD4FQ19fdho".toString(),Kn="364143070327-sgopc15lidje8uq4l16k1u8pqo2hpc4o.apps.googleusercontent.com".toString(),Wn=new D("apple"),Gn={get connectedAt(){return Wn.getNumber("connectedAt")},set connectedAt(e){Wn.setNumber("connectedAt",e)},get useMusicKitBeta(){return Wn.getBoolean("useMusicKitBeta")},set useMusicKitBeta(e){Wn.setBoolean("useMusicKitBeta",e)},clear(){Wn.clear()}};var Jn=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};class Qn{constructor(e){this.MusicKit=e,this.isWrapper=!0}get version(){return this.MusicKit.version}get Events(){return this.MusicKit.Events}get PlaybackStates(){return this.MusicKit.PlaybackStates}configure(e){return Jn(this,void 0,void 0,(function*(){if(!this.instance){const t=this.MusicKit.configure(e);this.instance=t,Object.defineProperties(t,{volume:{get:()=>t.player.volume,set:e=>t.player.volume=e},queue:{get:()=>t.player.queue},isPlaying:{get:()=>t.player.isPlaying},nowPlayingItem:{get:()=>t.player.nowPlayingItem}}),Object.defineProperties(t.api,{music:{get:()=>(e,t,r)=>this.music(e,t,r)}})}return this.instance}))}getInstance(){const e=this.instance;if(e)return e.api.music||Object.defineProperties(e.api,{music:{get:()=>(e,t,r)=>this.music(e,t,r)}}),e;throw Error("Not configured")}formatArtworkURL(e,t,r){return this.MusicKit.formatArtworkURL(e,t,r)}music(e,t,r){return Jn(this,void 0,void 0,(function*(){const n=this.getInstance();t&&(e=`${e}${e.includes("?")?"&":"?"}${new URLSearchParams(t)}`),e=e.replace("{{storefrontId}}",n.storefrontId);const i=(null==r?void 0:r.fetchOptions)||{};i.headers||(i.headers={}),i.headers=Object.assign(Object.assign({},i.headers),{authorization:`Bearer ${n.developerToken}`,"music-user-token":n.musicUserToken});const a=yield fetch(`https://api.music.apple.com${e}`,i);if(!a.ok){const e=new Error(String(a.status));throw e.data=a,e}return{data:yield a.json()}}))}}var Xn=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Zn=new O("appleAuth"),ei=new Ne(!1);function ti(){return ei.getValue()}function ri(){return ei.pipe(Sn())}function ni(){return Xn(this,void 0,void 0,(function*(){Zn.log("disconnect");const e=yield si();try{e.isPlaying&&e.stop(),e.queue.isEmpty||(yield e.setQueue({}))}catch(e){Zn.error(e)}try{yield e.unauthorize()}catch(e){Zn.error(e)}ei.next(e.isAuthorized)}))}function ii(){return Xn(this,void 0,void 0,(function*(){throw Zn.log("refreshToken"),yield ni(),Error("Access token refresh is not supported.")}))}const ai=new Promise(((e,t)=>{document.addEventListener("musickitloaded",(()=>Xn(void 0,void 0,void 0,(function*(){Zn.log("Loaded MusicKit version",MusicKit.version),MusicKit.version.startsWith("1")&&!MusicKit.isWrapper&&(window.MusicKit=new Qn(MusicKit));try{const t=yield MusicKit.configure({developerToken:Vn,app:{name:"ampcast",build:"0.8.23"},sourceType:8,suppressErrorDialog:!0});e(t)}catch(e){t(e)}}))))}));function si(){return Xn(this,void 0,void 0,(function*(){return window.MusicKit?MusicKit.getInstance():new Promise(((e,t)=>{c(`https://js-cdn.music.apple.com/musickit/v${Gn.useMusicKitBeta?3:1}/musickit.js`).then((()=>ai.then(e,t)),t)}))}))}ri().pipe(pn((e=>!e))).subscribe((e=>Gn.connectedAt=e?Date.now():0)),ri().pipe(De((e=>e)),wr((()=>si())),Rn(1),Le((e=>{e.addEventListener(MusicKit.Events.authorizationStatusDidChange,(()=>ei.next(e.isAuthorized)))}))).subscribe(Zn),Gn.connectedAt&&jr(si()).pipe(De((e=>e.isAuthorized)),wr((e=>e.authorize())),Le((e=>ei.next(!!e)))).subscribe(Zn);var oi;const li=[],ci=new O("AbstractPager");oi=new WeakMap;const ui=class{constructor(e={}){this.config=e,this.additions$=new Ne(li),this.error$=new Ne(li),this.items$=new Ne(li),this.fetches$=new Ne({index:0,length:0}),this.size$=new Ne(-1),this.srcs=new Set,oi.set(this,!1)}get maxSize(){return this.config.maxSize}observeAdditions(){return this.additions$.pipe(pn((e=>e===li)))}observeError(){return this.error$.pipe(pn((e=>e===li)))}observeItems(){return this.items$.pipe(pn((e=>e===li)))}observeSize(){return this.size$.pipe(pn((e=>-1===e)),Sn())}disconnect(){this.disconnected||(function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)}(this,oi,!0,"f"),this.subscriptions&&this.subscriptions.unsubscribe(),this.items.forEach((e=>{var t;return null===(t=null==e?void 0:e.pager)||void 0===t?void 0:t.disconnect()})),this.items$.complete(),this.additions$.complete(),this.size$.complete(),this.error$.complete())}fetchAt(e,t=this.config.pageSize){if(this.disconnected)ci.warn("disconnected");else{if(t||(t=50),!this.connected&&(this.connect(),this.config.calculatePageSize)){const{minPageSize:e=10,maxPageSize:r=100}=this.config,n=10*Math.ceil(2*t/10);this.config.pageSize=Math.max(Math.min(n,r),e)}this.fetches$.next({index:e,length:t})}}get connected(){return!!this.subscriptions}get disconnected(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,oi,"f")}get error(){const e=this.error$.getValue();return e===li?void 0:e}set error(e){this.error$.next(e)}get items(){return this.items$.getValue()}set items(e){const t=[];this.items$.next(e.map((e=>{if(!this.srcs.has(e.src)){this.srcs.add(e.src);const r=Nn.getInLibrary(e,e.inLibrary),n=Nn.getRating(e,e.rating);e.inLibrary===r&&e.rating===n||(e=Object.assign(Object.assign({},e),{inLibrary:r,rating:n})),t.push(e)}return e}))),this.additions$.next(t)}get size(){const e=this.size$.getValue();return-1===e?void 0:e}set size(e){this.size$.next(e)}observeComplete(){return kn([this.observeItems(),this.observeSize()]).pipe(De((([e,t])=>e.reduce((e=>e+1),0)===t)),yr((([e])=>e)),Rn(1))}observeFetches(){return this.fetches$}connect(){this.disconnected||this.connected||(this.subscriptions=new ae,this.config.lookup||(this.subscribeTo(this.observeAdditions().pipe(Le((e=>this.addMultiDisc(e)))),ci),this.subscribeTo(this.observeAdditions().pipe(Le((e=>this.addTrackCount(e)))),ci),this.subscribeTo(Cn.observe().pipe(Le((e=>this.applyChanges(e)))),ci)))}subscribeTo(e,t){this.subscriptions.add(e.subscribe(t))}applyChanges(e){let t=!1;const r=this.items.map((r=>{for(const{match:n,values:i}of e)if(n(r))return t=!0,Object.assign(Object.assign({},r),i);return r}));t&&this.items$.next(r)}addMultiDisc(e){e.forEach((e=>{e.itemType===Ln.Album&&void 0===e.multiDisc&&this.subscribeTo(e.pager.observeItems().pipe(Rn(1),Le((t=>{const r=e.src,n=this.items.findIndex((e=>e.src===r));if(-1!==n){const e=this.items.slice(),r=e[n],i=h(t.map((e=>e.disc)).filter(l)),a=i.length>1||i[0]>1;e[n]=Object.assign(Object.assign({},r),{multiDisc:a}),this.items$.next(e)}}))),ci)}))}addTrackCount(e){e.forEach((e=>{e.itemType===Ln.Playlist&&!e.trackCount&&e.pager&&this.subscribeTo(e.pager.observeSize().pipe(Rn(1),Le((t=>{const r=e.src,n=this.items.findIndex((e=>e.src===r));if(-1!==n){const e=this.items.slice(),r=e[n];e[n]=Object.assign(Object.assign({},r),{trackCount:t}),this.items$.next(e)}}))),ci)}))}},di=new O("SequentialPager");class mi extends ui{constructor(e,t){super(t),this.fetchNext=e,this.fetching$=new Ne(!1),this.maxEmptyCount=2,this.emptyCount=0}connect(){this.disconnected||this.connected||(super.connect(),this.subscribeTo(this.observeShouldFetch().pipe(Dr(void 0),Le((()=>this.fetching$.next(!0))),An((()=>this.fetchNext(this.config.pageSize))),Le((e=>this.addPage(e))),In((e=>(di.error(e),this.error=e,Wr(void 0)))),Le((()=>this.fetching$.next(!1))),Ur(this.observeComplete()),Rn(100)),di))}observeShouldFetch(){const e=kn([this.observeFetches(),this.observeItems()]).pipe(yr((([{index:e,length:t},r])=>e+2*t>=r.length)),De((e=>e)),yr((()=>{})),Rn(1));return this.fetching$.pipe(_r((t=>t?Fr:e)))}addPage(e){var t,r;const n=(e.items||[]).filter(l),i=this.items.concat(n).filter(((e,t,r)=>t===r.findIndex((t=>e.src===t.src))));i.length===this.items.length&&this.emptyCount++,i.length=Math.min(i.length,null!==(t=this.maxSize)&&void 0!==t?t:1/0);let a=e.atEnd||i.length===this.maxSize||this.emptyCount>=this.maxEmptyCount;const s=this.config.pageSize;a||void 0!==e.atEnd||void 0!==e.total||void 0===s||(a=e.items.length<s);const o=a?i.length:e.total;void 0!==o&&(this.size=Math.min(o,null!==(r=this.maxSize)&&void 0!==r?r:1/0)),this.items=i}}const hi=new O("WrappedPager");class fi{constructor(e,t,r){this.headerPager=e,this.bodyPager=t,this.footerPager=r,this.fetches$=new Ne({index:0,length:0}),this.disconnected=!1}get maxSize(){}observeItems(){var e,t;return kn([(null===(e=this.headerPager)||void 0===e?void 0:e.observeItems())||Wr([]),this.bodyPager.observeItems(),(null===(t=this.footerPager)||void 0===t?void 0:t.observeItems())||Wr([]),this.observeComplete()]).pipe(yr((([e,t,r,n])=>e.concat(n?t.concat(r):t))))}observeSize(){var e,t;return kn([(null===(e=this.headerPager)||void 0===e?void 0:e.observeSize())||Wr(0),this.bodyPager.observeSize(),(null===(t=this.footerPager)||void 0===t?void 0:t.observeSize())||Wr(0),this.observeComplete()]).pipe(yr((([e,t,r,n])=>e+t+(n?r:0))))}observeError(){return this.bodyPager.observeError()}disconnect(){var e,t,r;this.disconnected||(this.disconnected=!0,null===(e=this.subscriptions)||void 0===e||e.unsubscribe(),null===(t=this.headerPager)||void 0===t||t.disconnect(),this.bodyPager.disconnect(),null===(r=this.footerPager)||void 0===r||r.disconnect())}fetchAt(e,t){this.disconnected?hi.warn("disconnected"):(this.subscriptions||this.connect(),this.fetches$.next({index:e,length:t}))}connect(){var e;this.subscriptions||(this.subscriptions=new ae,this.subscriptions.add(kn([(null===(e=this.headerPager)||void 0===e?void 0:e.observeSize())||Wr(0),this.observeFetches()]).pipe(Le((([e,t])=>this.bodyPager.fetchAt(Math.max(t.index-e,0),t.length)))).subscribe(hi)),this.footerPager&&this.subscriptions.add(this.observeComplete().pipe(Le((()=>this.footerPager.fetchAt(0)))).subscribe(hi)))}observeComplete(){return kn([this.bodyPager.observeItems(),this.bodyPager.observeSize()]).pipe(yr((([e,t])=>e.reduce((e=>e+1),0)===t)),Sn())}observeFetches(){return this.fetches$.pipe(De((e=>e.length>0)))}}var pi=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const bi=new O("pinStore"),vi=[];class yi extends gt.ZP{constructor(){super("ampcast/pins"),this.pins$=new Ne(vi),this.lockedPin$=new Ne(null),this.version(2).stores({pins:"&src"}).upgrade((e=>e.table("pins").toCollection().modify((e=>{e.plex&&(e.src=`plex:playlist:${e.plex.ratingKey}`)})))),(0,gt.Y1)((()=>this.pins.toArray())).subscribe(this.pins$)}lock(e){this.lockedPin$.next(e)}unlock(){this.lockedPin$.next(null)}pin(e){return pi(this,void 0,void 0,(function*(){try{const t=Array.isArray(e)?e:[e];bi.log("pin",{playlists:t}),yield this.pins.bulkPut(t.map((e=>{const{pager:t}=e,r=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["pager"]);return Object.assign(Object.assign({},r),{isPinned:!0})}))),Cn.dispatch(t.map((e=>({match:t=>t.src===e.src,values:{isPinned:!0}}))))}catch(e){bi.error(e)}}))}unpin(e){return pi(this,void 0,void 0,(function*(){try{const t=Array.isArray(e)?e:[e];bi.log("unpin",{playlists:t}),yield this.pins.bulkDelete(t.map((e=>e.src))),Cn.dispatch(t.map((e=>({match:t=>t.src===e.src,values:{isPinned:!1}}))))}catch(e){bi.error(e)}}))}isPinned(e){return-1!==this.pins$.getValue().findIndex((t=>t.src===e))}observe(){return kn([this.pins$,this.lockedPin$]).pipe(De((([e])=>e!==vi)),yr((([e])=>e)))}getPinsForService(e){const t=this.pins$.getValue().slice(),r=this.lockedPin$.getValue();return r&&!t.find((e=>e.src===r.src))&&t.push(r),t.filter((t=>t.src.startsWith(`${e}:`))).sort(((e,t)=>e.title.localeCompare(t.title,void 0,{sensitivity:"accent",ignorePunctuation:!0})))}}const gi=new yi;var wi=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ei=new O("MusicKitPager");class ki{static defaultToPage(e){var t,r,n;const i=(null===(r=null===(t=e.data[0])||void 0===t?void 0:t.relationships)||void 0===r?void 0:r.tracks)||e,a=i.data||[],s=i.next;return{items:a,total:null===(n=i.meta)||void 0===n?void 0:n.total,nextPageUrl:s}}constructor(e,t,r,n,i=ki.defaultToPage){this.options=r,this.parent=n,this.nextPageUrl=void 0,this.pager=new mi((r=>wi(this,void 0,void 0,(function*(){const n=yield this.fetchNext(this.nextPageUrl||e,r?t?Object.assign(Object.assign({},t),{limit:r}):{limit:r}:t),a=i(n.data),s=this.createItems(a.items),o=a.total,l=!a.nextPageUrl;return this.nextPageUrl=a.nextPageUrl,{items:s,total:o,atEnd:l}}))),r)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){var e;this.subscriptions||(this.subscriptions=new ae,(null===(e=this.options)||void 0===e?void 0:e.lookup)||(this.subscriptions.add(this.pager.observeAdditions().pipe(wr((e=>Li(e,!0)))).subscribe(Ei)),this.subscriptions.add(this.pager.observeAdditions().pipe(wr((e=>Di(e,!0,this.parent)))).subscribe(Ei))))}fetchNext(e,t){return wi(this,void 0,void 0,(function*(){const r=MusicKit.getInstance();try{return yield r.api.music(e,t)}catch(n){const i=null==n?void 0:n.data.status;if(401===i||403===i)return yield ii(),r.api.music(e,t);throw n}}))}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){switch(e.type){case"playlists":case"library-playlists":return this.createMediaPlaylist(e);case"artists":case"library-artists":return this.createMediaArtist(e);case"albums":case"library-albums":return this.createMediaAlbum(e);case"songs":case"library-songs":case"music-videos":case"library-music-videos":return this.createMediaItem(e)}}createMediaPlaylist(e){var t,r;const n=this.createFromLibrary(e),i=(null===(t=n.description)||void 0===t?void 0:t.standard)||(null===(r=n.description)||void 0===r?void 0:r.short),a=`apple:${e.type}:${e.id}`,s=this.getCatalogId(e),o={src:a,itemType:Ln.Playlist,externalUrl:n.url||void 0,title:n.name,description:i?A(i):void 0,thumbnails:this.createThumbnails(n),owner:n.curatorName?{name:n.curatorName}:void 0,modifiedAt:Math.floor(new Date(n.lastModifiedDate).valueOf()/1e3)||void 0,unplayable:!n.playParams||void 0,isPinned:gi.isPinned(a),inLibrary:e.type.startsWith("library-")||void 0,apple:{catalogId:s}};return o.pager=new ki(`${e.href}/tracks`,void 0,void 0,o),o}createMediaArtist(e){var t,r;const n=this.createFromLibrary(e),i=(null===(t=n.editorialNotes)||void 0===t?void 0:t.standard)||(null===(r=n.editorialNotes)||void 0===r?void 0:r.short),a=this.getCatalogId(e);return{itemType:Ln.Artist,src:`apple:${e.type}:${e.id}`,externalUrl:n.url||void 0,title:n.name,description:i?A(i):void 0,thumbnails:this.createThumbnails(n),genres:this.getGenres(n),pager:this.createArtistAlbumsPager(e),apple:{catalogId:a}}}createArtistTopTracks(e){const t=this.createFromLibrary(e);return{itemType:Ln.Album,src:`apple:top-tracks:${e.id}`,title:"Top Tracks",thumbnails:this.createThumbnails(t),artist:t.name,genres:this.getGenres(t),pager:this.createTopTracksPager(e),synthetic:!0,inLibrary:!1,apple:{catalogId:""}}}createMediaAlbum(e){var t,r;const n=this.createFromLibrary(e),i=`apple:${e.type}:${e.id}`,a=(null===(t=n.editorialNotes)||void 0===t?void 0:t.standard)||(null===(r=n.editorialNotes)||void 0===r?void 0:r.short),s=this.getCatalogId(e),o={itemType:Ln.Album,src:i,externalUrl:n.url||void 0,title:n.name,description:a?A(a):void 0,thumbnails:this.createThumbnails(n),artist:n.artistName,trackCount:n.trackCount,genres:this.getGenres(n),year:new Date(n.releaseDate).getFullYear()||0,unplayable:!n.playParams||void 0,inLibrary:e.type.startsWith("library-")||void 0,apple:{catalogId:s}};return o.pager=new ki(`${e.href}/tracks`,void 0,void 0,o),o}createMediaItem(e){var t,r,n,i,a;const s=this.createFromLibrary(e),{id:o,kind:l}=s.playParams||{id:e.id,kind:"music-videos"===e.type?"musicVideo":"song"},c=`apple:${e.type}:${o}`,u=(null===(t=s.editorialNotes)||void 0===t?void 0:t.standard)||(null===(r=s.editorialNotes)||void 0===r?void 0:r.short),d=e.type.startsWith("library-"),m=(null===(n=this.parent)||void 0===n?void 0:n.itemType)===Ln.Playlist,h=this.getCatalogId(e);let f=s.url||void 0;return!f&&h&&(null===(i=this.parent)||void 0===i?void 0:i.itemType)===Ln.Album&&this.parent.externalUrl&&(f=`${this.parent.externalUrl}?i=${h}`),{itemType:Ln.Media,mediaType:"musicVideo"===l?Fn.Video:Fn.Audio,src:c,externalUrl:f,title:s.name,description:u?A(u):void 0,thumbnails:this.createThumbnails(s),artists:[s.artistName],albumArtist:(null===(a=this.parent)||void 0===a?void 0:a.itemType)===Ln.Album?this.parent.artist:void 0,album:s.albumName,duration:s.durationInMillis/1e3,genres:this.getGenres(s),disc:s.discNumber,track:s.trackNumber,year:new Date(s.releaseDate).getFullYear()||void 0,isrc:s.isrc,unplayable:!s.playParams||void 0,playedAt:0,inLibrary:d&&!m||void 0,apple:{catalogId:h}}}getCatalogId(e){var t,r,n;if(e.type.startsWith("library-")){let i=null===(r=null===(t=e.attributes)||void 0===t?void 0:t.playParams)||void 0===r?void 0:r["library-playlists"===e.type?"globalId":"catalogId"];return i||(i=null===(n=this.getCatalog(e))||void 0===n?void 0:n.id),i||""}return e.id}createFromLibrary(e){var t;return k(e.attributes,null===(t=this.getCatalog(e))||void 0===t?void 0:t.attributes)}getCatalog(e){var t,r,n;return null===(n=null===(r=null===(t=e.relationships)||void 0===t?void 0:t.catalog)||void 0===r?void 0:r.data)||void 0===n?void 0:n[0]}createThumbnails({artwork:e}){return e?[this.createThumbnail(e,120),this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480)]:void 0}createThumbnail(e,t){return{url:MusicKit.formatArtworkURL(e,t,t),width:t,height:t}}createArtistAlbumsPager(e){const t=new ki(`${e.href}/albums`);if(e.type.startsWith("library-"))return t;const r=this.createArtistTopTracks(e),n=new Un([r]);return new fi(n,t)}createTopTracksPager(e){return new ki(e.href,{"limit[artists:top-songs]":"20",views:"top-songs"},{maxSize:10},void 0,(e=>{var t,r,n;const i=(null===(r=null===(t=e.data[0])||void 0===t?void 0:t.views)||void 0===r?void 0:r["top-songs"])||e,a=i.data||[],s=i.next;return{items:a,total:null===(n=i.meta)||void 0===n?void 0:n.total,nextPageUrl:s}}))}getGenres({genreNames:e=[]}){return e.filter((e=>"Music"!==e))}}var xi=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Si={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},Ti={id:"apple/recommendations",title:"Recommended",icon:"playlist",itemType:Ln.Playlist,search:()=>new ki("/v1/me/recommendations",void 0,void 0,void 0,(({data:e=[],next:t,meta:r})=>{const n=e.map((e=>e.relationships.contents.data.filter((e=>"playlists"===e.type)))).flat();return{items:n,total:null==r?void 0:r.total,nextPageUrl:t}}))},Ai={id:"apple/recently-played",title:"Recently Played",icon:"clock",itemType:Ln.Media,layout:Si,search:()=>new ki("/v1/me/recent/played/tracks",void 0,{pageSize:30,maxSize:200})},Ii={id:"apple/library-songs",title:"My Songs",icon:"tick",itemType:Ln.Media,lockActionsStore:!0,layout:Si,defaultHidden:!0,search:()=>new ki("/v1/me/library/songs")},Pi={id:"apple/library-albums",title:"My Albums",icon:"tick",itemType:Ln.Album,lockActionsStore:!0,search:()=>new ki("/v1/me/library/albums",{"fields[library-albums]":"name,artistName,playParams","include[library-albums]":"catalog"})},Ci={id:"apple/library-artists",title:"My Artists",icon:"tick",itemType:Ln.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new ki("/v1/me/library/artists",{"fields[library-artists]":"name,playParams","include[library-artists]":"catalog","omit[resource:artists]":"relationships"})},Mi={id:"apple/playlists",title:"My Playlists",icon:"tick",itemType:Ln.Playlist,lockActionsStore:!0,search:()=>new ki("/v1/me/library/playlists",{"fields[library-playlists]":"name,playParams","include[library-playlists]":"catalog"})},Oi={id:"apple/library-videos",title:"My Videos",icon:"tick",itemType:Ln.Media,mediaType:Fn.Video,lockActionsStore:!0,layout:Si,defaultHidden:!0,search:()=>new ki("/v1/me/library/music-videos")},Ni={id:"apple",name:"Apple Music",icon:"apple",url:"https://music.apple.com",serviceType:vn.PublicMedia,defaultHidden:!0,roots:[zi(Ln.Media,{title:"Songs",layout:Si}),zi(Ln.Album,{title:"Albums"}),zi(Ln.Artist,{title:"Artists"}),zi(Ln.Playlist,{title:"Playlists"}),zi(Ln.Media,{title:"Videos",layout:Si,mediaType:Fn.Video},{types:"music-videos"},{maxSize:250})],sources:[Ii,Pi,Ci,Mi,Oi,Ai,Ti],icons:{[zn.AddToLibrary]:"plus",[zn.RemoveFromLibrary]:"tick-fill"},labels:{[zn.AddToLibrary]:"Add to Apple Music Library",[zn.RemoveFromLibrary]:"Saved to Apple Music Library",[zn.Like]:"Love on Apple Music",[zn.Unlike]:"Unlove on Apple Music"},canRate:function(){return!1},canStore:function(e){switch(e.itemType){case Ln.Media:case Ln.Playlist:return!0;case Ln.Album:return!e.synthetic;default:return!1}},compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:Ln.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,t,r]=e.src.split(":"),n=t.startsWith("library-");return new ki(`${n?"/v1/me/library":"/v1/catalog/{{storefrontId}}"}/playlists/${r}`,n?{"include[library-playlists]":"catalog","fields[library-playlists]":"name,playParams"}:{"omit[resource:playlists]":"relationships"})}}},getMetadata:function(e){var t;return xi(this,void 0,void 0,(function*(){if(e.itemType===Ln.Playlist&&e.isOwn)return e;let r=e;if(!e.externalUrl){const[,n,i]=e.src.split(":"),a=n.startsWith("library-"),s=new ki(`${a?"/v1/me/library":"/v1/catalog/{{storefrontId}}"}/${n.replace("library-","")}/${i}${a?"/catalog":""}`,a?void 0:{[`omit[resource:${n.replace("library-","")}]`]:"relationships"},{lookup:!0}),o=yield _n(s,{timeout:2e3});r=k(e,o[0]),r.description=(null===(t=o[0])||void 0===t?void 0:t.description)||e.description}return r.inLibrary=Nn.getInLibrary(r,r.inLibrary),void 0===r.inLibrary&&Di([r]),r.rating=Nn.getRating(r,r.rating),void 0===r.rating&&Li([r]),r}))},lookup:function(e,t,r=10,n){return xi(this,void 0,void 0,(function*(){return e&&t?_n(ji(Ln.Media,`${e} ${t}`,void 0,{pageSize:r,maxSize:r,lookup:!0}),{timeout:n}):[]}))},rate:function(e,t){return xi(this,void 0,void 0,(function*(){const r=MusicKit.getInstance(),[,n,i]=e.src.split(":"),a=`/v1/me/ratings/${n}/${i}`;t?yield r.api.music(a,void 0,{fetchOptions:{method:"PUT",body:JSON.stringify({type:"rating",attributes:{value:t}})}}):yield r.api.music(a,void 0,{fetchOptions:{method:"DELETE"}})}))},store:function(e,t){var r;return xi(this,void 0,void 0,(function*(){const n=MusicKit.getInstance(),[,i]=e.src.split(":"),a=i.replace("library-",""),s=null===(r=e.apple)||void 0===r?void 0:r.catalogId,o="/v1/me/library";if(t){const e=`ids[${a}]`;return n.api.music(o,{[e]:s},{fetchOptions:{method:"POST"}})}return n.api.music(`${o}/${a}/${s}`,void 0,{fetchOptions:{method:"DELETE"}})}))},observeIsLoggedIn:ri,isLoggedIn:ti,login:function(){return Xn(this,void 0,void 0,(function*(){if(!ti()){Zn.log("connect");try{const e=MusicKit.getInstance();yield e.authorize(),ei.next(e.isAuthorized)}catch(e){Zn.error(e)}}}))},logout:ni},$i=Ni;function zi(e,t,r,n){return Object.assign(Object.assign({},t),{itemType:e,id:`apple/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>ji(e,t,r,n)})}function ji(e,t,r,n){if(t){const i=Object.assign(Object.assign({},r),{term:t});if(!i.types){switch(e){case Ln.Media:i.types="songs";break;case Ln.Album:i.types="albums";break;case Ln.Artist:i.types="artists";break;case Ln.Playlist:i.types="playlists"}i[`omit[resource:${i.types}]`]="relationships"}const a=i.types;return new ki("/v1/catalog/{{storefrontId}}/search",i,Object.assign({maxSize:250,pageSize:25},n),void 0,(e=>{var t;const r=e.results[a]||{data:[]},n=r.next,i=null===(t=e.meta)||void 0===t?void 0:t.total;return{items:r.data,total:i,nextPageUrl:n}}))}return new Un}function Li(e,t=!1){return xi(this,void 0,void 0,(function*(){const r=e[0];if(!r||!Ni.canRate(r,t))return;const n=e.filter((e=>void 0===e.rating)).map((e=>{const[,,t]=e.src.split(":");return t}));if(0===n.length)return;const[,i]=r.src.split(":"),a=MusicKit.getInstance(),{data:{data:s}}=yield a.api.music(`/v1/me/ratings/${i}`,{ids:n});if(!s)return;const o=new Map(s.map((e=>[e.id,e.attributes.value])));Cn.dispatch(n.map((e=>({match:t=>t.src===`apple:${i}:${e}`,values:{rating:o.get(e)||0}}))))}))}function Di(e,t=!1,r){return xi(this,void 0,void 0,(function*(){const n=e[0];if(!n||!Ni.canStore(n,t))return;const i=(null==r?void 0:r.itemType)===Ln.Album,a=e.filter((e=>void 0===e.inLibrary&&!(i&&e.src.startsWith("apple:library-")))).map((e=>{var t;return null===(t=e.apple)||void 0===t?void 0:t.catalogId})).filter((e=>!!e));if(0===a.length)return;let[,s]=n.src.split(":");s=s.replace("library-","");const o=MusicKit.getInstance(),{data:{resources:l}}=yield o.api.music("/v1/catalog/{{storefrontId}}",{[`fields[${s}]`]:"inLibrary","format[resources]":"map",[`ids[${s}]`]:a,"omit[resource]":"autos"}),c=l[s];if(!c)return;const u=new Map(Object.keys(c).map((e=>[e,c[e].attributes.inLibrary])));Cn.dispatch(a.map((e=>({match:t=>{var r;return(null===(r=t.apple)||void 0===r?void 0:r.catalogId)===e},values:{inLibrary:u.get(e)||!1}}))))}))}var Fi;!function(e){e[e.Folders=6]="Folders",e[e.ByDecade=7]="ByDecade",e[e.ByGenre=8]="ByGenre"}(Fi||(Fi={}));const Ri=Fi;class _i extends Error{constructor(){super(),Object.setPrototypeOf(this,_i.prototype)}}class Ui extends _i{constructor(){super(...arguments),this.message="No music library found."}}class Vi extends _i{constructor(){super(...arguments),this.message="No music video library found."}}class Bi extends _i{constructor(){super(...arguments),this.message="No TIDAL subscription found."}}class Hi extends ui{constructor(e){super(),this.fetch=e}fetchAt(){if(!this.disconnected&&!this.connected){this.connect();const e=this.fetch();this.size=e.length,this.items=e}}}function Yi({icon:e,text:t,className:r="",showConnectivity:i}){return n.createElement("span",{className:`media-source-label ${r}`},n.createElement(Nt,{name:e,className:i?"show-connectivity":""}),n.createElement("span",{className:"text"},t))}var qi=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Ki=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Wi(e){var{service:t,settings:r,login:i}=e,a=Ki(e,["service","settings","login"]);const s=t.id,[o,l]=(0,n.useState)(!1),[c,u]=(0,n.useState)(""),d=(0,n.useRef)(null),m=(0,n.useRef)(null),h=(0,n.useRef)(null),f=(0,n.useRef)(null),p=n.createElement(Yi,{icon:t.icon,text:`Log in to ${t.name}`}),b=(0,n.useCallback)((()=>qi(this,void 0,void 0,(function*(){try{const e=m.current.value.replace(/\/+$/,""),t=h.current.value,n=f.current.value;if(r.host=e,l(!0),u("Connecting..."),"https:"===location.protocol&&!e.startsWith("https:"))throw Error("https required");const a=yield i(e,t,n);d.current.close(a)}catch(e){console.error(e),l(!1),e instanceof TypeError?u("Host not found"):u(e.message||e.statusText||"Error")}}))),[r,i]),v=(0,n.useCallback)((e=>{e.preventDefault(),b()}),[b]);return n.createElement(jt,Object.assign({},a,{className:`login-dialog login-dialog-${t.id}`,title:p,ref:d}),n.createElement("form",{id:`${s}-login`,method:"dialog",onSubmit:v},n.createElement("div",{className:"table-layout"},n.createElement("p",null,n.createElement("label",{htmlFor:`${s}-host`},"Host:"),n.createElement("input",{type:"url",id:`${s}-host`,name:`${s}-host`,autoFocus:!r.host,defaultValue:r.host,placeholder:"https://",required:!0,ref:m})),n.createElement("p",null,n.createElement("label",{htmlFor:`${s}-username`},"User:"),n.createElement("input",{type:"text",id:`${s}-username`,name:`${s}-username`,autoFocus:!!r.host,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",required:!0,ref:h})),n.createElement("p",null,n.createElement("label",{htmlFor:`${s}-password`},"Password:"),n.createElement("input",{type:"password",id:`${s}-password`,name:`${s}-password`,ref:f,required:!0}))),n.createElement("p",{className:"message "+(o?"":"error")},c),n.createElement(Ut,{submitText:"Login"})))}let Gi=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")),"");class Ji{constructor(e){this.storage=new D(e),this.libraryId$=new Ne(this.storage.getString("libraryId"))}get audioLibraries(){return this.libraries.filter((e=>"musicvideos"!==e.type))}get device(){return"PC"}get deviceId(){let e=this.storage.getString("deviceId");return e||(e=Gi(),this.storage.setString("deviceId",e)),e}get host(){return this.storage.getString("host")}set host(e){this.storage.setString("host",e)}get libraryId(){return this.storage.getString("libraryId")}set libraryId(e){this.storage.setString("libraryId",e),this.libraryId$.next(e)}observeLibraryId(){return this.libraryId$.pipe(Sn())}get libraries(){return this.storage.getJson("libraries")||[]}set libraries(e){const t=e.find((e=>e.id===this.libraryId))||e.find((e=>"music"===e.type&&C(e.title)))||e.find((e=>"music"===e.type))||e.find((e=>"audiobooks"===e.type));this.storage.setJson("libraries",e),this.libraryId=(null==t?void 0:t.id)||""}get serverId(){return this.storage.getString("serverId")}set serverId(e){this.storage.setString("serverId",e)}get token(){return this.storage.getString("token")}set token(e){this.storage.setString("token",e)}get userId(){return this.storage.getString("userId")}set userId(e){this.storage.setString("userId",e)}get videoLibraryId(){var e;return null===(e=this.libraries.find((e=>"musicvideos"===e.type)))||void 0===e?void 0:e.id}clear(){this.storage.removeItem("serverId"),this.storage.removeItem("userId"),this.storage.removeItem("token")}}const Qi=new Ji("emby");var Xi=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Zi=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function ea(e=Ua,t=Qi){return Xi(this,void 0,void 0,(function*(){return Dt((r=>n.createElement(ta,Object.assign({},r,{service:e,settings:t}))),!0)}))}function ta(e){var{service:t,settings:r}=e,i=Zi(e,["service","settings"]);const a=(0,n.useCallback)(((e,t,n)=>Xi(this,void 0,void 0,(function*(){const{device:i,deviceId:a}=r,s=`MediaBrowser Client="ampcast", Version="0.8.23", Device="${i}", DeviceId="${a}"`,o=yield fetch(`${e}/Users/AuthenticateByName`,{method:"POST",headers:{"Content-Type":"application/json","X-Emby-Authorization":s},body:JSON.stringify({Username:t,Pw:n})});if(!o.ok)throw o;const l=yield o.json(),c=l.ServerId,u=l.User.Id,d=l.AccessToken;return JSON.stringify({serverId:c,userId:u,token:d})}))),[r]);return n.createElement(Wi,Object.assign({},i,{service:t,settings:r,login:a}))}var ra=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function na(e,t,r){return ra(this,void 0,void 0,(function*(){const n=yield aa(e,t,{method:"GET",headers:{Accept:"application/json"}},r);return yield n.json()}))}function ia(e,t,r=Qi){return ra(this,void 0,void 0,(function*(){const n={UserId:r.userId,ParentId:r.libraryId,IncludeItemTypes:"Audio",SortBy:"SortName",Recursive:!0,Limit:500,StartIndex:0,EnableImages:!1,EnableUserData:!1,EnableTotalRecordCount:!1};switch(t){case Ln.Album:n.IncludeItemTypes="MusicAlbum";break;case Ln.Artist:n.IncludeItemTypes="AlbumArtist"}return((yield na(e,n,r)).Items||[]).map((({Id:e,Name:t})=>({id:e||t,title:t})))}))}function aa(e,t,r,n=Qi){return ra(this,void 0,void 0,(function*(){const{host:i,device:a,deviceId:s,token:o}=n;if(!o)throw Error("No access token");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1)),r.headers=Object.assign(Object.assign({},r.headers),{"X-Emby-Authorization":`MediaBrowser Client="ampcast", Version="0.8.23", Device="${a}", DeviceId="${s}", Token="${o}"`});const l=yield fetch(`${i}/${e}`,r);if(!l.ok)throw l;return l}))}const sa={delete:function(e,t,r){return ra(this,void 0,void 0,(function*(){yield aa(e,t,{method:"DELETE"},r)}))},get:na,getFilters:function(e,t,r){return ra(this,void 0,void 0,(function*(){return e===Ri.ByDecade?function(e,t){return ra(this,void 0,void 0,(function*(){const r=(new Date).getFullYear(),n=(yield ia("Years",e,t)).map((e=>Number(e.title))).filter((e=>e>500&&e<=r)),i=d(n,(e=>10*Math.floor(e/10)));return Object.keys(i).sort().reverse().map((e=>({id:i[e].join(","),title:`${e}s`})))}))}(t,r):function(e,t){return ra(this,void 0,void 0,(function*(){return ia("Genres",e,t)}))}(t,r)}))},getMusicLibraries:function(e=Qi){var t;return ra(this,void 0,void 0,(function*(){const r=yield na(`Users/${e.userId}/Views`,void 0,e);return((null===(t=r.Items)||void 0===t?void 0:t.filter((e=>/^(audiobooks|music|musicvideos)$/.test(e.CollectionType))))||[]).map((({Id:e,Name:t,CollectionType:r})=>({id:e,title:t,type:r})))}))},post:function(e,t={},r=Qi){return ra(this,void 0,void 0,(function*(){const n=JSON.stringify(t);yield aa(e,void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:n},r)}))},getPlayableUrl:function(e,t=Qi){const{host:r,userId:n,token:i,deviceId:a}=t;if(r&&n&&i&&a){const[,t,s,o]=e.split(":");return"video"===t?`${r}/Videos/${s}/stream?${new URLSearchParams({MediaSourceId:o||s,Static:"true",UserId:n,DeviceId:a,api_key:i})}`:`${r}/Audio/${s}/universal?${new URLSearchParams({MaxStreamingBitrate:"140000000",MaxSampleRate:"48000",TranscodingProtocol:"hls",TranscodingContainer:"ts",Container:"opus,webm|opus,mp3,aac,m4a|aac,m4a|alac,m4b|aac,flac,webma,webm|webma,wav,ogg",AudioCodec:"aac",Static:"true",UserId:n,api_key:i,DeviceId:a})}`}throw Error("Not logged in")}},oa=sa;var la=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const ca=new O("embyAuth"),ua=new Ne(""),da=new Ne(!1);function ma(){return da.getValue()}function ha(e){Qi.token=e,ua.next(e)}function fa(e,t,r){void 0===t&&(t=tr);var n=ir(e,t);return function(e,t){return $e((function(e,r){var i=null!=t?t:{},a=i.leading,s=void 0===a||a,o=i.trailing,l=void 0!==o&&o,c=!1,u=null,d=null,m=!1,h=function(){null==d||d.unsubscribe(),d=null,l&&(b(),m&&r.complete())},f=function(){d=null,m&&r.complete()},p=function(e){return d=br(n).subscribe(ze(r,h,f))},b=function(){if(c){c=!1;var e=u;u=null,r.next(e),!m&&p()}};e.subscribe(ze(r,(function(e){c=!0,u=e,(!d||d.closed)&&(s?b():p())}),(function(){m=!0,(!(l&&c&&d)||d.closed)&&r.complete()})))}))}(0,r)}ua.pipe(Sn()).pipe(De((e=>""!==e)),wr((()=>function(){return la(this,void 0,void 0,(function*(){try{const e=yield oa.getMusicLibraries();return Qi.libraries=e,!0}catch(e){return ca.error(e),ua.next(""),!1}}))}()))).subscribe(da),ha(Qi.token);var pa;!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(pa||(pa={}));const ba=new O("OffsetPager");class va extends ui{constructor(e,t){super(t),this.fetch=e,this.fetchStates={}}connect(){this.disconnected||this.connected||(super.connect(),this.subscribeTo(this.observeFetches().pipe(fa(200,void 0,{leading:!1,trailing:!0}),De((({index:e,length:t})=>t>0&&this.isInRange(e))),yr((({index:e,length:t})=>this.getPageNumbersFromIndex(e,t))),wr((e=>e)),wr((e=>this.fetchPage(e))),In((e=>(ba.error(e),this.error=e,Wr(void 0)))),Ur(this.observeComplete())),ba))}get pageSize(){return this.config.pageSize||20}fetchPage(e){return t=this,r=void 0,i=function*(){if(this.fetchStates[e]!==pa.Fulfilled&&this.fetchStates[e]!==pa.Pending){this.fetchStates[e]=pa.Pending;try{const t=yield this.fetch(e,this.pageSize);this.fetchStates[e]=pa.Fulfilled,this.insertPage(e,t)}catch(t){throw this.fetchStates[e]=pa.Rejected,t}}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}insertPage(e,t){var r;const n=this.items.slice(),i=Math.min(t.total,null!==(r=this.maxSize)&&void 0!==r?r:1/0),a=Math.ceil(i/this.pageSize),s=(e-1)*this.pageSize;if(t.items.forEach(((e,t)=>n[t+s]=e)),n.length=i,t.items.length===i)for(let e=0;e<=a;e++)this.fetchStates[e+1]=pa.Fulfilled;this.size=i,this.items=n}getPageNumbersFromIndex(e,t){const r=this.size||0,n=Math.max(Math.ceil(this.pageSize/2),t),i=Math.max(e-n,0),a=Math.min(e+n+t-1,0===r?this.maxSize?this.maxSize-1:1/0:r-1),s=this.getPageNumberFromIndex(i),o=this.getPageNumberFromIndex(a);if(s===o)return[s];{const e=[];for(let t=s;t<=o;t++)e.push(t);return e}}getPageNumberFromIndex(e){return Math.floor(e/this.pageSize)+1}isInRange(e){const t=this.size||0;return 0===t?e>=0:e>=0&&e<t}}class ya{constructor(e,t={},r,n){this.path=e,this.params=t,this.parent=n,this.pageSize=Math.min((null==r?void 0:r.maxSize)||1/0,(null==r?void 0:r.pageSize)||200),this.pager=new va((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},r))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){var t,r,n,i,a,s;return n=this,i=void 0,s=function*(){const n=Object.assign(Object.assign({IncludeItemTypes:"Audio",Fields:"AudioInfo,Genres,ParentIndexNumber,Path,ProductionYear,Overview,PresentationUniqueKey",EnableUserData:!0,Recursive:!0,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!0},this.params),{Limit:String(this.pageSize),StartIndex:String((e-1)*this.pageSize)}),i=yield oa.get(this.path,n);return i.Type?{items:[this.createMediaObject(i)],total:1}:{items:(null===(t=i.Items)||void 0===t?void 0:t.map((e=>this.createMediaObject(e))))||[],total:i.TotalRecordCount||(null===(r=i.Items)||void 0===r?void 0:r.length)}},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(r,o)}l((s=s.apply(n,i||[])).next())}))}createMediaObject(e){var t;if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Ln.Folder&&e.IsFolder)return this.createMediaFolder(e);{let t;switch(e.Type){case"MusicArtist":t=this.createMediaArtist(e);break;case"MusicAlbum":t=this.createMediaAlbum(e);break;case"Playlist":t=this.createMediaPlaylist(e);break;default:t=this.createMediaItem(e)}return t}}createMediaArtist(e){var t,r;return{itemType:Ln.Artist,src:`emby:artist:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",description:e.Overview||void 0,playCount:(null===(t=e.UserData)||void 0===t?void 0:t.PlayCount)||void 0,genres:e.Genres||void 0,inLibrary:null===(r=e.UserData)||void 0===r?void 0:r.IsFavorite,thumbnails:this.createThumbnails(e),pager:this.createArtistAlbumsPager(e)}}createMediaAlbum(e){var t,r,n;return{itemType:Ln.Album,src:`emby:album:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,thumbnails:this.createThumbnails(e),trackCount:e.ChildCount||void 0,pager:this.createAlbumTracksPager(e),artist:e.AlbumArtist||void 0,year:e.ProductionYear||void 0}}createMediaPlaylist(e){var t,r,n;const i=`emby:playlist:${e.Id}`;return{src:i,itemType:Ln.Playlist,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,trackCount:e.ChildCount||void 0,pager:this.createPlaylistPager(e),isPinned:gi.isPinned(i)}}createMediaFolder(e){var t;const r=this.getFileName(e.Path||"")||e.Name||"[unknown]",n={itemType:Ln.Folder,src:`emby:folder:${e.Id}`,title:e.Name||"[unknown]",fileName:r,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===Ln.Folder?`${this.parent.path}/${r}`:"/",parent:this.parent};return n.pager=this.createFolderPager(n),n}createMediaItem(e){var t,r,n,i;const a="Video"===e.MediaType;return{itemType:Ln.Media,mediaType:a?Fn.Video:Fn.Audio,src:`emby:${a?"video":"audio"}:${e.Id}:${e.PresentationUniqueKey||""}`,externalUrl:this.getExternalUrl(e),fileName:this.getFileName(e.Path||"")||e.Name||"[unknown]",title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,year:e.ProductionYear||void 0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,artists:(null===(i=e.Artists)||void 0===i?void 0:i.length)?e.Artists:e.AlbumArtist?[e.AlbumArtist]:void 0,albumArtist:e.AlbumArtist||void 0,album:e.Album||void 0,disc:e.Album&&e.ParentIndexNumber||void 0,track:e.Album&&e.IndexNumber||0}}createThumbnails(e){var t;const r=(null===(t=e.ImageTags)||void 0===t?void 0:t.Primary)?e.Id:e.AlbumId;return r?[this.createThumbnail(r,120),this.createThumbnail(r,240),this.createThumbnail(r,360),this.createThumbnail(r,480)]:void 0}createThumbnail(e,t,r=t){return{url:`${Qi.host}/Items/${e}/Images/Primary?fillWidth=${t}&fillHeight=${r}`,width:t,height:r}}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),r=new Un([t]),n=new ya(`Users/${Qi.userId}/Items`,{AlbumArtistIds:e.Id,IncludeItemTypes:"MusicAlbum",SortBy:"ProductionYear,SortName",SortOrder:"Descending"});return new fi(void 0,n,r)}createArtistAllTracks(e){return{itemType:Ln.Album,src:`emby:all-tracks:${e.Id}`,title:"All Songs",artist:e.Name||"",thumbnails:this.createThumbnails(e),pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new ya(`Users/${Qi.userId}/Items`,{ArtistIds:e.Id,IncludeItemTypes:"Audio",SortBy:"SortName",SortOrder:"Ascending"})}createAlbumTracksPager(e){return new ya(`Users/${Qi.userId}/Items`,{ParentId:e.Id,SortBy:"ParentIndexNumber,IndexNumber",SortOrder:"Ascending"})}createPlaylistPager(e){return new ya(`Playlists/${e.Id}/Items`,{UserId:Qi.userId,MediaType:"Audio",Fields:"ChildCount"})}createFolderPager(e){var t;const[,,r]=e.src.split(":"),n=new ya(`Users/${Qi.userId}/Items`,{ParentId:r,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path,PresentationUniqueKey",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,FileName",SortOrder:"Ascending"},{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Ln.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new Un([e]);return new fi(t,n)}return n}getExternalUrl(e){return`${Qi.host}/web/index.html#!/item?id=${e.Id}&serverId=${Qi.serverId}`}getFileName(e){return e.split(/[/\\]/).pop()}}ya.minPageSize=10,ya.maxPageSize=500;const ga=ya;var wa=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ea="emby",ka="AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName",xa={view:"card compact",fields:["Thumbnail","Title","TrackCount","Genre"]},Sa={view:"details",fields:["Index","Artist","Title","Album","Duration","Genre","PlayCount"]},Ta={id:"emby/liked-songs",title:"My Songs",icon:"heart",itemType:Ln.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>Ya({ParentId:qa(),Filters:"IsFavorite",SortBy:"AlbumArtist,Album,SortName"})},Aa={id:"emby/liked-albums",title:"My Albums",icon:"heart",itemType:Ln.Album,lockActionsStore:!0,search:()=>Ya({ParentId:qa(),Filters:"IsFavorite",IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"})},Ia={id:"emby/liked-artists",title:"My Artists",icon:"heart",itemType:Ln.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new ga("Artists/AlbumArtists",{ParentId:qa(),isFavorite:!0,UserId:Qi.userId})},Pa={id:"emby/recently-played",title:"Recently Played",icon:"clock",itemType:Ln.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>Ya({ParentId:qa(),SortBy:"DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},Ca={id:"emby/most-played",title:"Most Played",icon:"most-played",itemType:Ln.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>Ya({ParentId:qa(),SortBy:"PlayCount,DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},Ma={id:"emby/playlists",title:"Playlists",icon:"playlist",itemType:Ln.Playlist,layout:xa,secondaryLayout:Sa,search:()=>Ya({ParentId:qa(),SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Playlist"})},Oa={id:"emby/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:Ln.Media,viewType:Ri.ByGenre,defaultHidden:!0,search:e=>e?Ya({ParentId:qa(),GenreIds:e.id,IncludeItemTypes:"Audio",SortBy:ka}):new Un},Na={id:"emby/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:Ln.Album,viewType:Ri.ByGenre,search:e=>e?Ya({ParentId:qa(),GenreIds:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new Un},$a={id:"emby/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:Ln.Artist,viewType:Ri.ByGenre,defaultHidden:!0,search:e=>e?new ga("Artists/AlbumArtists",{ParentId:qa(),GenreIds:e.id,UserId:Qi.userId}):new Un},za={id:"emby/tracks-by-decade",title:"Songs by Decade",icon:"calendar",itemType:Ln.Media,viewType:Ri.ByDecade,defaultHidden:!0,search:e=>e?Ya({ParentId:qa(),Years:e.id,IncludeItemTypes:"Audio",SortBy:ka}):new Un},ja={id:"emby/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:Ln.Album,viewType:Ri.ByDecade,search:e=>e?Ya({ParentId:qa(),Years:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new Un},La={id:"emby/random-tracks",title:"Random Songs",icon:"shuffle",itemType:Ln.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>Ya({ParentId:qa(),IncludeItemTypes:"Audio",SortBy:"Random"},{maxSize:100})},Da={id:"emby/random-albums",title:"Random Albums",icon:"shuffle",itemType:Ln.Album,search:()=>Ya({ParentId:qa(),IncludeItemTypes:"MusicAlbum",SortBy:"Random"},{maxSize:100})},Fa={id:"emby/videos",title:"Music Videos",icon:"video",itemType:Ln.Media,mediaType:Fn.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search({q:e=""}={}){const t=Qi.videoLibraryId;if(!t)throw new Vi;return Ya({ParentId:t,SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",SearchTerm:e})}},Ra={id:"emby/folders",title:"Folders",icon:"folder",itemType:Ln.Folder,viewType:Ri.Folders,search(){const e={itemType:Ln.Folder,src:"",title:"Folders",fileName:"",path:""};return e.pager=new Hi((()=>Qi.libraries.map((({id:t,title:r})=>{const n={itemType:Ln.Folder,src:`emby:folder:${t}`,title:r,fileName:r,path:`/${r}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new Un([i]),s=new ga(`Users/${Qi.userId}/Items`,{ParentId:t,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path,PresentationUniqueKey",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,FileName",SortOrder:"Ascending"},void 0,n);return n.pager=new fi(a,s),n})))),e.pager}},_a={id:Ea,icon:Ea,name:"Emby",url:"https://emby.media/",serviceType:vn.PersonalMedia,defaultHidden:!0,roots:[Ba(Ln.Media,{title:"Songs"}),Ba(Ln.Album,{title:"Albums"}),Ba(Ln.Artist,{title:"Artists"}),Ba(Ln.Playlist,{title:"Playlists",secondaryLayout:Sa})],sources:[Ta,Aa,Ia,Ca,Pa,Ma,Oa,Na,$a,za,ja,La,Da,Fa,Ra],labels:{[zn.AddToLibrary]:"Add to Emby Favorites",[zn.RemoveFromLibrary]:"Remove from Emby Favorites"},get audioLibraries(){return Qi.audioLibraries},get libraryId(){return Qi.libraryId},set libraryId(e){Qi.libraryId=e},get libraries(){return Qi.libraries},set libraries(e){Qi.libraries=e},observeLibraryId:()=>Qi.observeLibraryId(),canRate:()=>!1,canStore:Va,compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:Ln.Playlist,layout:xa,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":");return Ya({ids:t,IncludeItemTypes:"Playlist"})}}},getFilters:function(e,t){return wa(this,void 0,void 0,(function*(){return oa.getFilters(e,t)}))},getMetadata:function(e){return wa(this,void 0,void 0,(function*(){if(!Va(e)||void 0!==e.inLibrary)return e;const t=Nn.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const[,,r]=e.src.split(":"),n=new ga(`Users/${Qi.userId}/Items/${r}`,void 0,{pageSize:1,maxSize:1}),i=yield _n(n,{timeout:2e3});return k(e,i[0])}))},getPlayableUrl:function({src:e}){return oa.getPlayableUrl(e,Qi)},lookup:function(e,t,r=10,n){return wa(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:r,maxSize:r,lookup:!0};return _n(Ha(Ln.Media,t,{Artists:e},i),{timeout:n})}))},store:function(e,t){return wa(this,void 0,void 0,(function*(){const[,,r]=e.src.split(":"),n=`Users/${Qi.userId}/FavoriteItems/${r}`;t?yield oa.post(n):yield oa.delete(n)}))},observeIsLoggedIn:function(){return da.pipe(Sn())},isLoggedIn:ma,login:function(){return la(this,void 0,void 0,(function*(){if(!ma()){ca.log("connect");try{const e=yield ea();if(e){const{serverId:t,userId:r,token:n}=JSON.parse(e);Qi.serverId=t,Qi.userId=r,ha(n)}}catch(e){ca.error(e)}}}))},logout:function(){return la(this,void 0,void 0,(function*(){ca.log("disconnect"),Qi.clear(),ha(""),da.next(!1)}))}},Ua=_a;function Va(e){switch(e.itemType){case Ln.Album:return!e.synthetic;case Ln.Folder:return!1;default:return!0}}function Ba(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`emby/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>Ha(e,t)})}function Ha(e,t,r,n){const i=Object.assign({ParentId:qa(),SortBy:"SortName",SearchTerm:t.trim()},r);if(e===Ln.Artist)return new ga("Artists",Object.assign(Object.assign({},i),{UserId:Qi.userId}),n);switch(e){case Ln.Media:i.IncludeItemTypes="Audio",i.SortBy=ka;break;case Ln.Album:i.IncludeItemTypes="MusicAlbum",i.SortBy="AlbumArtist,SortName";break;case Ln.Playlist:i.IncludeItemTypes="Playlist"}return Ya(i,n)}function Ya(e,t){return new ga(`Users/${Qi.userId}/Items`,e,t)}function qa(){const e=Qi.libraryId;if(!e)throw new Ui;return e}const Ka=new Ji("jellyfin");var Wa=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ga={delete:function(e,t){return Wa(this,void 0,void 0,(function*(){return oa.delete(e,t,Ka)}))},get:function(e,t){return Wa(this,void 0,void 0,(function*(){return oa.get(e,t,Ka)}))},getFilters:function(e,t){return Wa(this,void 0,void 0,(function*(){return oa.getFilters(e,t,Ka)}))},getMusicLibraries:function(){return Wa(this,void 0,void 0,(function*(){return oa.getMusicLibraries(Ka)}))},post:function(e,t={}){return Wa(this,void 0,void 0,(function*(){return oa.post(e,t,Ka)}))},getPlayableUrl:function(e){return oa.getPlayableUrl(e,Ka)}};var Ja=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Qa=new O("jellyfinAuth"),Xa=new Ne(""),Za=new Ne(!1);function es(){return Za.getValue()}function ts(e){Ka.token=e,Xa.next(e)}Xa.pipe(Sn()).pipe(De((e=>""!==e)),wr((()=>function(){return Ja(this,void 0,void 0,(function*(){try{const e=yield Ga.getMusicLibraries();return Ka.libraries=e,!0}catch(e){return Qa.error(e),Xa.next(""),!1}}))}()))).subscribe(Za),ts(Ka.token);class rs{constructor(e,t={},r,n){this.path=e,this.params=t,this.parent=n,this.pageSize=(null==r?void 0:r.pageSize)||200,this.pager=new va((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},r))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){var t,r,n,i,a,s;return n=this,i=void 0,s=function*(){const n=Object.assign(Object.assign({IncludeItemTypes:"Audio",Fields:"AudioInfo,Genres,Path",EnableUserData:!0,Recursive:!0,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!0},this.params),{Limit:String(this.pageSize),StartIndex:String((e-1)*this.pageSize)}),i=yield Ga.get(this.path,n);return i.Type?{items:[this.createMediaObject(i)],total:1}:{items:(null===(t=i.Items)||void 0===t?void 0:t.map((e=>this.createMediaObject(e))))||[],total:i.TotalRecordCount||(null===(r=i.Items)||void 0===r?void 0:r.length)}},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(r,o)}l((s=s.apply(n,i||[])).next())}))}createMediaObject(e){var t;if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Ln.Folder&&e.IsFolder)return this.createMediaFolder(e);{let t;switch(e.Type){case"MusicArtist":t=this.createMediaArtist(e);break;case"MusicAlbum":t=this.createMediaAlbum(e);break;case"Playlist":t=this.createMediaPlaylist(e);break;default:t=this.createMediaItem(e)}return t}}createMediaArtist(e){var t,r;return{itemType:Ln.Artist,src:`jellyfin:artist:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",playCount:(null===(t=e.UserData)||void 0===t?void 0:t.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(r=e.UserData)||void 0===r?void 0:r.IsFavorite,pager:this.createArtistAlbumsPager(e)}}createMediaAlbum(e){var t,r,n;return{itemType:Ln.Album,src:`jellyfin:album:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,trackCount:e.ChildCount||void 0,pager:this.createAlbumTracksPager(e),artist:e.AlbumArtist||void 0,year:e.ProductionYear||void 0}}createMediaPlaylist(e){var t,r,n;const i=`jellyfin:playlist:${e.Id}`;return{src:i,itemType:Ln.Playlist,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,trackCount:e.ChildCount||void 0,pager:this.createPlaylistPager(e),isPinned:gi.isPinned(i)}}createMediaFolder(e){var t;const r=this.getFileName(e.Path||"")||e.Name||"[unknown]",n={itemType:Ln.Folder,src:`jellyfin:folder:${e.Id}`,title:e.Name||"[unknown]",fileName:r,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===Ln.Folder?`${this.parent.path}/${r}`:"/",parent:this.parent};return n.pager=this.createFolderPager(n),n}createMediaItem(e){var t,r,n,i;const a="Video"===e.MediaType;return{itemType:Ln.Media,mediaType:a?Fn.Video:Fn.Audio,src:`jellyfin:${a?"video":"audio"}:${e.Id}`,externalUrl:this.getExternalUrl(e),fileName:this.getFileName(e.Path||"")||e.Name||"[unknown]",title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,year:e.ProductionYear||void 0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),inLibrary:null===(n=e.UserData)||void 0===n?void 0:n.IsFavorite,artists:(null===(i=e.Artists)||void 0===i?void 0:i.length)?e.Artists:e.AlbumArtist?[e.AlbumArtist]:void 0,albumArtist:e.AlbumArtist||void 0,album:e.Album||void 0,disc:e.Album&&e.ParentIndexNumber||void 0,track:e.Album&&e.IndexNumber||0}}createThumbnails(e){var t;const r=(null===(t=e.ImageTags)||void 0===t?void 0:t.Primary)?e.Id:e.AlbumId;return r?[this.createThumbnail(r,120),this.createThumbnail(r,240),this.createThumbnail(r,360),this.createThumbnail(r,480)]:void 0}createThumbnail(e,t,r=t){return{url:`${Ka.host}/Items/${e}/Images/Primary?fillWidth=${t}&fillHeight=${r}`,width:t,height:r}}createAlbumTracksPager(e){return new rs(`Users/${Ka.userId}/Items`,{ParentId:e.Id,SortBy:"SortName",SortOrder:"Ascending"})}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),r=new Un([t]),n=new rs(`Users/${Ka.userId}/Items`,{AlbumArtistIds:e.Id,IncludeItemTypes:"MusicAlbum",SortBy:"ProductionYear,SortName",SortOrder:"Descending,Ascending"});return new fi(void 0,n,r)}createArtistAllTracks(e){return{itemType:Ln.Album,src:`jellyfin:all-tracks:${e.Id}`,title:"All Songs",artist:e.Name||"",thumbnails:this.createThumbnails(e),pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new rs(`Users/${Ka.userId}/Items`,{ArtistIds:e.Id,IncludeItemTypes:"Audio",SortBy:"Name",SortOrder:"Ascending"})}createPlaylistPager(e){return new rs(`Playlists/${e.Id}/Items`,{UserId:Ka.userId,MediaType:"Audio",Fields:"ChildCount"})}createFolderPager(e){var t;const[,,r]=e.src.split(":"),n=new rs(`Users/${Ka.userId}/Items`,{ParentId:r,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,SortName",SortOrder:"Ascending"},{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Ln.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new Un([e]);return new fi(t,n)}return n}getExternalUrl(e){return`${Ka.host}/web/index.html#!/details?id=${e.Id}&serverId=${Ka.serverId}`}getFileName(e){return e.split(/[/\\]/).pop()}}rs.minPageSize=10,rs.maxPageSize=500;const ns=rs;var is=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const as="jellyfin",ss={view:"card compact",fields:["Thumbnail","Title","TrackCount","Genre"]},os={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","PlayCount"]},ls={id:"jellyfin/liked-songs",title:"My Songs",icon:"heart",itemType:Ln.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>Ps({ParentId:Cs(),Filters:"IsFavorite",SortBy:"AlbumArtist,Album,SortName"})},cs={id:"jellyfin/liked-albums",title:"My Albums",icon:"heart",itemType:Ln.Album,lockActionsStore:!0,search:()=>Ps({ParentId:Cs(),Filters:"IsFavorite",IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"})},us={id:"jellyfin/liked-artists",title:"My Artists",icon:"heart",itemType:Ln.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new ns("Artists/AlbumArtists",{ParentId:Cs(),isFavorite:!0,UserId:Ka.userId})},ds={id:"jellyfin/recently-played",title:"Recently Played",icon:"clock",itemType:Ln.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>Ps({ParentId:Cs(),SortBy:"DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},ms={id:"jellyfin/most-played",title:"Most Played",icon:"most-played",itemType:Ln.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>Ps({ParentId:Cs(),SortBy:"PlayCount,DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},hs={id:"jellyfin/playlists",title:"Playlists",icon:"playlist",itemType:Ln.Playlist,layout:ss,secondaryLayout:os,search:()=>Ps({ParentId:Cs(),SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Playlist"})},fs={id:"jellyfin/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:Ln.Media,viewType:Ri.ByGenre,defaultHidden:!0,search:e=>e?Ps({ParentId:Cs(),GenreIds:e.id,IncludeItemTypes:"Audio",SortBy:"AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName"}):new Un},ps={id:"jellyfin/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:Ln.Album,viewType:Ri.ByGenre,search:e=>e?Ps({ParentId:Cs(),GenreIds:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new Un},bs={id:"jellyfin/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:Ln.Artist,viewType:Ri.ByGenre,defaultHidden:!0,search:e=>e?new ns("Artists/AlbumArtists",{ParentId:Cs(),GenreIds:e.id,UserId:Ka.userId}):new Un},vs={id:"jellyfin/tracks-by-decade",title:"Songs by Decade",icon:"calendar",itemType:Ln.Media,viewType:Ri.ByDecade,defaultHidden:!0,search:e=>e?Ps({ParentId:Cs(),Years:e.id,IncludeItemTypes:"Audio",SortBy:"AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName"}):new Un},ys={id:"jellyfin/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:Ln.Album,viewType:Ri.ByDecade,search:e=>e?Ps({ParentId:Cs(),Years:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new Un},gs={id:"jellyfin/random-tracks",title:"Random Songs",icon:"shuffle",itemType:Ln.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>Ps({ParentId:Cs(),IncludeItemTypes:"Audio",SortBy:"Random"},{maxSize:100})},ws={id:"jellyfin/random-albums",title:"Random Albums",icon:"shuffle",itemType:Ln.Album,search:()=>Ps({ParentId:Cs(),IncludeItemTypes:"MusicAlbum",SortBy:"Random"},{maxSize:100})},Es={id:"jellyfin/videos",title:"Music Videos",icon:"video",itemType:Ln.Media,mediaType:Fn.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search({q:e=""}={}){const t=Ka.videoLibraryId;if(!t)throw new Vi;return Ps({ParentId:t,SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",SearchTerm:e})}},ks={id:"jellyfin/folders",title:"Folders",icon:"folder",itemType:Ln.Folder,viewType:Ri.Folders,search(){const e={itemType:Ln.Folder,src:"",title:"Folders",fileName:"",path:""};return e.pager=new Hi((()=>Ka.libraries.map((({id:t,title:r})=>{const n={itemType:Ln.Folder,src:`jellyfin:folder:${t}`,title:r,fileName:r,path:`/${r}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new Un([i]),s=new ns(`Users/${Ka.userId}/Items`,{ParentId:t,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,SortName",SortOrder:"Ascending"},void 0,n);return n.pager=new fi(a,s),n})))),e.pager}},xs={id:as,icon:as,name:"Jellyfin",url:"https://jellyfin.org",serviceType:vn.PersonalMedia,defaultHidden:!0,roots:[As(Ln.Media,{title:"Songs"}),As(Ln.Album,{title:"Albums"}),As(Ln.Artist,{title:"Artists"}),As(Ln.Playlist,{title:"Playlists",secondaryLayout:os})],sources:[ls,cs,us,ms,ds,hs,fs,ps,bs,vs,ys,gs,ws,Es,ks],labels:{[zn.AddToLibrary]:"Add to Jellyfin Favorites",[zn.RemoveFromLibrary]:"Remove from Jellyfin Favorites"},get audioLibraries(){return Ka.audioLibraries},get libraryId(){return Ka.libraryId},set libraryId(e){Ka.libraryId=e},get libraries(){return Ka.libraries},set libraries(e){Ka.libraries=e},observeLibraryId:()=>Ka.observeLibraryId(),canRate:()=>!1,canStore:Ts,compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:Ln.Playlist,layout:ss,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":");return Ps({ids:t,IncludeItemTypes:"Playlist"})}}},getFilters:function(e,t){return is(this,void 0,void 0,(function*(){return Ga.getFilters(e,t)}))},getMetadata:function(e){return is(this,void 0,void 0,(function*(){if(!Ts(e)||void 0!==e.inLibrary)return e;const t=Nn.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const[,,r]=e.src.split(":"),n=new ns(`Users/${Ka.userId}/Items/${r}`,void 0,{pageSize:1,maxSize:1}),i=yield _n(n,{timeout:2e3});return k(e,i[0])}))},getPlayableUrl:function({src:e}){return Ga.getPlayableUrl(e)},lookup:function(e,t,r=10,n){return is(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:r,maxSize:r,lookup:!0};return _n(Is(Ln.Media,t,{Artists:e},i),{timeout:n})}))},store:function(e,t){return is(this,void 0,void 0,(function*(){const[,,r]=e.src.split(":"),n=`Users/${Ka.userId}/FavoriteItems/${r}`;t?yield Ga.post(n):yield Ga.delete(n)}))},observeIsLoggedIn:function(){return Za.pipe(Sn())},isLoggedIn:es,login:function(){return Ja(this,void 0,void 0,(function*(){if(!es()){Qa.log("connect");try{const e=yield ea(Ss,Ka);if(e){const{serverId:t,userId:r,token:n}=JSON.parse(e);Ka.serverId=t,Ka.userId=r,ts(n)}}catch(e){Qa.error(e)}}}))},logout:function(){return Ja(this,void 0,void 0,(function*(){Qa.log("disconnect"),Ka.clear(),ts(""),Za.next(!1)}))}},Ss=xs;function Ts(e){switch(e.itemType){case Ln.Album:return!e.synthetic;case Ln.Folder:return!1;default:return!0}}function As(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`jellyfin/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>Is(e,t)})}function Is(e,t,r,n){const i=Object.assign({ParentId:Cs(),SortBy:"SortName",SearchTerm:t.trim()},r);if(e===Ln.Artist)return new ns("Artists",Object.assign(Object.assign({},i),{UserId:Ka.userId}),n);switch(e){case Ln.Media:i.IncludeItemTypes="Audio",i.SortBy="AlbumArtist,Album,SortName";break;case Ln.Album:i.IncludeItemTypes="MusicAlbum",i.SortBy="AlbumArtist,SortName";break;case Ln.Playlist:i.IncludeItemTypes="Playlist"}return Ps(i,n)}function Ps(e,t){return new ns(`Users/${Ka.userId}/Items`,e,t)}function Cs(){const e=Ka.libraryId;if(!e)throw new Ui;return e}var Ms=r(2568),Os=r.n(Ms);const Ns=new D("lastfm"),$s={get token(){return Ns.getString("token")},set token(e){Ns.setString("token",e)},get userId(){return Ns.getString("userId")},set userId(e){Ns.setString("userId",e)},get sessionKey(){return Ns.getString("sessionKey")},set sessionKey(e){Ns.setString("sessionKey",e)},get firstScrobbledAt(){return Ns.getString("firstScrobbledAt")},set firstScrobbledAt(e){Ns.setString("firstScrobbledAt",e)},get playCount(){return Ns.getNumber("playCount")},set playCount(e){Ns.setNumber("playCount",e)},clear(){Ns.clear()}};var zs=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const js=new O("lastfmAuth"),Ls=new Ne(""),Ds=new Ne("");function Fs(){return""!==Ls.getValue()}function Rs(){return Ls.pipe(Sn()).pipe(yr((e=>""!==e)),Sn())}function _s(e){const t=Object.keys(e);let r="";return t.sort(),t.forEach((t=>r+=t+e[t])),r+=Hn,Os()(r)}Ds.next($s.sessionKey),Ls.next($s.token);var Us=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Vs=new O("lastfmApi"),Bs=new class{constructor(){this.host="https://ws.audioscrobbler.com/2.0",this.placeholderImage="2a96cbd8b46e442fc41c2b86b821562f.png"}scrobble(e){return Us(this,void 0,void 0,(function*(){Vs.log("scrobble",{items:e});const t="track.scrobble";if(1===e.length){const r=e[0],n=String(r.playedAt);yield this.post(Object.assign({method:t,timestamp:n},this.getScrobbleParams(r)))}else if(e.length>0){const r={};e.forEach(((e,t)=>{const n=this.getScrobbleParams(e);r[`timestamp[${t}]`]=String(e.playedAt),Object.keys(n).forEach((e=>{r[`${e}[${t}]`]=n[e]}))})),yield this.post(Object.assign({method:t},r))}}))}updateNowPlaying(e){return Us(this,void 0,void 0,(function*(){Vs.log("updateNowPlaying",{item:e});try{this.canScrobble(e)&&(yield this.post(Object.assign({method:"track.updateNowPlaying"},this.getScrobbleParams(e))))}catch(t){Vs.log('Failed to update "now playing":',{item:e}),Vs.error(t)}}))}getUserInfo(){return Us(this,void 0,void 0,(function*(){return this.get({method:"user.getInfo",user:$s.userId})}))}createThumbnails(e){const t=e?[this.createThumbnail(e[0],34),this.createThumbnail(e[1],64),this.createThumbnail(e[2],174),this.createThumbnail(e[3],300)].filter(l):[];return 0===t.length?void 0:t}get(e){return Us(this,void 0,void 0,(function*(){const t=`${this.host}?${new URLSearchParams(Object.assign(Object.assign({},e),{api_key:Bn,format:"json"}))}`,r=yield fetch(t,{method:"GET"});if(!r.ok)throw r;return r.json()}))}post(e){return Us(this,void 0,void 0,(function*(){const t=$s.token,r=$s.sessionKey,n=_s(e=Object.assign(Object.assign({},e),{api_key:Bn,token:t,sk:r})),i=`${new URLSearchParams(e)}&api_sig=${n}`,a=yield fetch(this.host,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i});if(!a.ok)throw a;return a}))}getScrobbleParams(e){const t={};return t.track=e.title,t.artist=e.artists[0],e.album&&"[Unknown Album]"!==e.album&&(t.album=e.album,e.albumArtist&&(t.albumArtist=e.albumArtist)),e.duration&&(t.duration=String(Math.round(e.duration))),e.track&&(t.trackNumber=String(e.track)),e.recording_mbid&&(t.mbid=e.recording_mbid),t}canScrobble(e){var t;return!!e&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30}createThumbnail(e,t,r=t){if(e){const n=e["#text"];if(n&&!n.endsWith(this.placeholderImage))return{url:n,width:t,height:r}}}},Hs=Bs;class Ys{constructor(e,t,r,n){this.album=n,this.defaultConfig={minPageSize:Ys.minPageSize,maxPageSize:Ys.maxPageSize,pageSize:50},this.pageNumber=1,this.playCountName="playcount";const i=Object.assign(Object.assign({},this.defaultConfig),r),{page:a}=e,s=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["page"]);this.pageNumber=Number(a)||1,this.method=e.method,this.playCountName=i.playCountName||"playcount",this.pager=new mi(((e=this.defaultConfig.pageSize)=>{return r=this,n=void 0,a=function*(){const r=this.pageNumber,n=yield Hs.get(Object.assign(Object.assign({},s),{page:r,limit:e}));this.pageNumber++;const{items:i,total:a,atEnd:o,itemType:l}=t(n);return{items:this.createMediaObjects(l,i),total:a,atEnd:o}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(r,n||[])).next())}));var r,n,i,a}),i)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createMediaObjects(e,t){switch(e){case Ln.Artist:return t.map((e=>this.createMediaArtist(e)));case Ln.Album:return t.map((e=>this.createMediaAlbum(e)));case Ln.Media:return t.map((e=>this.createMediaItem(e)));default:return[]}}createMediaItem(e){var t,r,n,i,a,s;const o=e.date&&Number(e.date.uts)||0,l=null===(t=e["@attr"])||void 0===t?void 0:t.rank;return Object.assign(Object.assign({},this.createMediaObject(Ln.Media,e)),{mediaType:Fn.Audio,src:o?`lastfm:listen:${o}`:`lastfm:track:${Gi()}`,artists:e.artist?[e.artist.name]:void 0,album:(null===(r=this.album)||void 0===r?void 0:r.name)||(null===(n=e.album)||void 0===n?void 0:n["#text"]),albumArtist:null===(i=this.album)||void 0===i?void 0:i.artist.name,release_mbid:(null===(a=this.album)||void 0===a?void 0:a.mbid)||(null===(s=e.album)||void 0===s?void 0:s.mbid),duration:Number(e.duration)||0,track:l&&Number(l)||void 0,inLibrary:"loved"in e?!!Number(e.loved):"user.getLovedTracks"===this.method||void 0,playedAt:o})}createMediaAlbum(e){var t;return Object.assign(Object.assign({},this.createMediaObject(Ln.Album,e)),{src:`lastfm:album:${Gi()}`,artist:e.artist.name,year:(null===(t=e.wiki)||void 0===t?void 0:t.published)&&new Date(e.wiki.published).getFullYear()||void 0,pager:this.createAlbumPager(e)})}createMediaArtist(e){return Object.assign(Object.assign({},this.createMediaObject(Ln.Artist,e)),{src:`lastfm:artist:${Gi()}`,pager:this.createArtistAlbumsPager(e)})}createArtistTopTracks(e){return{itemType:Ln.Album,title:"Top Tracks",thumbnails:Hs.createThumbnails(e.image),src:`lastfm:top-tracks:${Gi()}`,artist:e.name,pager:this.createTopTracksPager(e),synthetic:!0}}createMediaObject(e,t){return{itemType:e,title:t.name,playCount:Number(t[this.playCountName])||void 0,globalPlayCount:"userplaycount"===this.playCountName&&Number(t.playcount)||void 0,thumbnails:Hs.createThumbnails(t.image),externalUrl:t.url||void 0}}createArtistAlbumsPager(e){const t=this.createArtistTopTracks(e),r=new Un([t]),n=new Ys({method:"artist.getTopAlbums",artist:e.name},(({topalbums:e})=>{const t=e["@attr"];return{items:e.album,total:Number(t.total)||void 0,atEnd:t.page===t.totalPages,itemType:Ln.Album}}),{maxSize:100,playCountName:"userplaycount"});return new fi(r,n)}createAlbumPager(e){return new Ys({method:"album.getInfo",album:e.name,artist:e.artist.name,user:$s.userId},(({album:e})=>{if(e.tracks){const t=e.tracks.track,r=(t?Array.isArray(t)?t:[t]:[]).map((t=>Object.assign(Object.assign({},t),{album:{"#text":e.name},image:t.image||e.image})));return{items:r,total:r.length,atEnd:!0,itemType:Ln.Media}}throw Error("No track info")}),{playCountName:"userplaycount"},e)}createTopTracksPager(e){return new Ys({method:"artist.getTopTracks",artist:e.name},(({toptracks:e})=>{const t=e["@attr"];return{items:e.track,total:Number(t.total)||void 0,atEnd:t.page===t.totalPages,itemType:Ln.Media}}),{pageSize:10,maxSize:10})}}Ys.minPageSize=10,Ys.maxPageSize=200;const qs=Ys;class Ks extends qs{constructor(e,t){super(Object.assign(Object.assign({},e),{method:"user.getRecentTracks",extended:"1",user:$s.userId}),(({recenttracks:e})=>{var t,r;const n=e["@attr"]||{},i=e.track,a=i?Array.isArray(i)?i:[i]:[],s="true"===(null===(r=null===(t=a[0])||void 0===t?void 0:t["@attr"])||void 0===r?void 0:r.nowplaying),o=Number(n.page)||1,l=Number(n.totalPages)||1,c=1===l||o===l,u=Number(n.total)||void 0;return s&&a.shift(),{items:a,total:u,atEnd:c,itemType:Ln.Media}}),t)}}var Ws=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Gs={view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},Js={view:"details",fields:["AlbumTrack","Title","Artist"]},Qs={id:"lastfm/history",title:"History",icon:"clock",itemType:Ln.Media,search:({startAt:e=0}={})=>new Ks(e?{to:e}:void 0)},Xs={id:"lastfm/recently-played",title:"Recently Played",icon:"clock",itemType:Ln.Media,search:()=>new Ks},Zs={id:"lastfm/loved-tracks",title:"Loved Tracks",icon:"heart",itemType:Ln.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear"]},search:()=>new qs({method:"user.getLovedTracks",user:$s.userId},(({lovedtracks:e})=>{const t=e["@attr"]||{},r=e.track,n=r?Array.isArray(r)?r:[r]:[],i=Number(t.page)||1,a=Number(t.totalPages)||1,s=1===a||i===a;return{items:n,total:Number(t.total)||void 0,atEnd:s,itemType:Ln.Media}}))},eo={id:"lastfm",name:"last.fm",icon:"lastfm",url:"https://www.last.fm",serviceType:vn.Scrobbler,defaultHidden:!0,roots:[Xs],sources:[no("user.getTopTracks",{title:"Top Tracks",itemType:Ln.Media,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","PlayCount"]}}),no("user.getTopAlbums",{title:"Top Albums",itemType:Ln.Album,layout:Gs,secondaryLayout:Js}),no("user.getTopArtists",{title:"Top Artists",itemType:Ln.Artist,layout:{view:"card minimal",fields:["Thumbnail","Title","PlayCount"]},secondaryLayout:Gs,tertiaryLayout:Js}),Zs,Qs],labels:{[zn.AddToLibrary]:"Love on last.fm",[zn.RemoveFromLibrary]:"Unlove on last.fm"},canRate:()=>!1,canStore:function(e){var t;return e.itemType===Ln.Media&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])},compareForRating:function(e,t){var r,n,i;const[a]=e.src.split(":"),[s]=t.src.split(":");return a===s&&(e.itemType===Ln.Media&&(e.itemType===t.itemType&&!!e.title&&!!(null===(r=e.artists)||void 0===r?void 0:r[0])&&ro(e.title,t.title)&&ro(null===(n=e.artists)||void 0===n?void 0:n[0],null===(i=t.artists)||void 0===i?void 0:i[0])))},getMetadata:function(e){return Ws(this,void 0,void 0,(function*(){if(e.itemType!==Ln.Media||void 0!==e.inLibrary)return e;const t={method:"track.getInfo",user:$s.userId};if(e.recording_mbid)t.mbid=e.recording_mbid;else{const{title:r,artists:n=[]}=e;if(t.artist=n[0],t.track=r,!t.artist)return e}const{track:r}=yield Hs.get(t);if(!r||"error"in r)throw Error((null==r?void 0:r.message)||"Not found");{const t={};return r.album&&(t.album=r.album.title,t.albumArtist=r.album.artist,e.thumbnails||(t.thumbnails=Hs.createThumbnails(r.album.image))),Object.assign(Object.assign(Object.assign({},e),t),{inLibrary:Nn.getInLibrary(e,!!Number(r.userloved)),playCount:Number(r.userplaycount)||0,globalPlayCount:Number(r.playcount)||0})}}))},store:function(e,t){return Ws(this,void 0,void 0,(function*(){if(e.itemType===Ln.Media){const{title:r,artists:n=[]}=e,i=n[0];r&&i&&(yield Hs.post({method:t?"track.love":"track.unlove",track:r,artist:i}))}}))},observeIsLoggedIn:Rs,isLoggedIn:Fs,login:function(){return zs(this,void 0,void 0,(function*(){if(!Fs()){js.log("connect");try{const e=yield function(){return zs(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const r=location.hostname,n=("localhost"===r?`http://${r}:${location.port}`:`https://${r}`)+"/auth/lastfm/callback/";let i=null;const a=r=>{if(/(localhost|ampcast)/.test(r.origin)){if(clearInterval(s),window.removeEventListener("message",a,!1),null==i||i.close(),i=null,r.origin!==location.origin)return void t({message:`Origin ${r.origin} does not match ${location.origin}`});e(r.data.token)}};window.addEventListener("message",a,!1),i=window.open(`https://www.last.fm/api/auth?api_key=${Bn}&cb=${n}`,"last.fm","popup");const s=setInterval((()=>{(null==i?void 0:i.closed)&&(clearInterval(s),t({message:"access_denied"}))}),500)}))}))}(),t=yield function(e){return zs(this,void 0,void 0,(function*(){const t="auth.getSession",r=_s({api_key:Bn,token:e,method:t}),n=yield fetch(`https://ws.audioscrobbler.com/2.0?method=${t}&api_key=${Bn}&token=${e}&api_sig=${r}&format=json`);if(!n.ok)throw n;const{session:i}=yield n.json();return $s.userId=i.name,$s.token=e,$s.sessionKey=i.key,i.key}))}(e);Ds.next(t),Ls.next(e)}catch(e){js.error(e)}}}))},logout:function(){return zs(this,void 0,void 0,(function*(){js.log("disconnect"),$s.clear(),Ds.next(""),Ls.next("")}))}},to=eo;function ro(e,t=""){return 0===e.localeCompare(t,void 0,{sensitivity:"accent"})}function no(e,t){return Object.assign(Object.assign({},t),{id:`lastfm/top/${e.slice(11).toLowerCase()}`,icon:"star",searchable:!1,search:({period:r="overall"}={})=>new qs({method:e,period:r,user:$s.userId},(r=>{const[,n]=e.toLowerCase().split("."),i=r[n.slice(3)],a=i["@attr"],s=i[n.slice(6,-1)],o=Number(a.page)||1,l=Number(a.totalPages)||1,c=1===l||o===l;return{items:s,total:Number(a.total)||void 0,atEnd:c,itemType:t.itemType}}))})}const io=new D("listenbrainz"),ao={get token(){return io.getString("token")},set token(e){io.setString("token",e)},get userId(){return io.getString("userId")},set userId(e){io.setString("userId",e)},get firstScrobbledAt(){return io.getString("firstScrobbledAt")},set firstScrobbledAt(e){io.setString("firstScrobbledAt",e)},clear(){io.clear()}};var so=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const oo=new O("listenbrainzApi"),lo=new class{constructor(){this.host="https://api.listenbrainz.org/1",this.rateLimitRemainingCalls=2,this.rateLimitResetTime=0}store(e,t){return so(this,void 0,void 0,(function*(){if(e.recording_msid||e.recording_mbid){const r="feedback/recording-feedback",n={score:t?1:0};e.recording_msid&&(n.recording_msid=e.recording_msid),e.recording_mbid&&(n.recording_mbid=e.recording_mbid);const i=yield this.post(r,n);if(!i.ok)throw i}}))}addInLibrary(e){return so(this,void 0,void 0,(function*(){if((e=e.filter((e=>!!e.recording_msid||!!e.recording_mbid))).length>0){const t=yield this.getInLibrary(e);Cn.dispatch(e.map(((e,r)=>({match:t=>yl(t,e),values:{inLibrary:t[r]}}))))}}))}getInLibrary(e){return so(this,void 0,void 0,(function*(){if((e=e.filter((e=>!!e.recording_msid||!!e.recording_mbid))).length>0){const[t,r]=m(e,(e=>!!e.recording_mbid)),n=t.map((e=>e.recording_mbid)),i=r.map((e=>e.recording_msid)),a={};n.length>0&&(a.recording_mbids=n),i.length>0&&(a.recording_msids=i);const{feedback:s}=yield this.get(`feedback/user/${ao.userId}/get-feedback-for-recordings`,a);return e.map((e=>{var t;return 1===(null===(t=s.find((t=>!!e.recording_mbid&&e.recording_mbid===t.recording_mbid||!!e.recording_msid&&e.recording_msid===t.recording_msid)))||void 0===t?void 0:t.score)}))}return[]}))}getListeningActivity({range:e="all_time"}={}){return so(this,void 0,void 0,(function*(){const{payload:{listening_activity:t}}=yield this.get(`stats/user/${ao.userId}/listening-activity`,{range:e});return t}))}getListenCount(){return so(this,void 0,void 0,(function*(){const{payload:{count:e}}=yield this.get(`user/${ao.userId}/listen-count`);return e}))}getListens(e){return so(this,void 0,void 0,(function*(){return yield this.get(`user/${ao.userId}/listens`,e)}))}scrobble(e){return so(this,void 0,void 0,(function*(){e.length>0&&(oo.log("scrobble",{items:e}),yield this.post("submit-listens",{listen_type:1===e.length?"single":"import",payload:e.map((e=>({listened_at:e.playedAt,track_metadata:this.getScrobbleParams(e)})))}))}))}updateNowPlaying(e){return so(this,void 0,void 0,(function*(){oo.log("updateNowPlaying",{item:e});try{this.canScrobble(e)&&(yield this.post("submit-listens",{listen_type:"playing_now",payload:[{track_metadata:this.getScrobbleParams(e)}]}))}catch(t){oo.log('Failed to update "now playing":',{item:e}),oo.error(t)}}))}get(e,t,r){return so(this,void 0,void 0,(function*(){t&&(e=`${e}?${new URLSearchParams(t)}`);const n=yield this.fetch(e,{method:"GET"},r);if(!n.ok||204===n.status)throw n;return n.json()}))}post(e,t){return so(this,void 0,void 0,(function*(){const r=JSON.stringify(t);return this.fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:r},!0)}))}fetch(e,t,r=!1){return so(this,void 0,void 0,(function*(){yield this.applyRateLimiting(),r&&(t.headers=Object.assign(Object.assign({},t.headers),{Authorization:`Token ${ao.token}`})),e.startsWith("/")&&(e=e.slice(1));const n=yield window.fetch(`${this.host}/${e}`,t);if(!n.ok)throw n;const i=n.headers;return i.has("x-ratelimit-remaining")&&(this.rateLimitRemainingCalls=Number(i.get("x-ratelimit-remaining"))||1),i.has("x-ratelimit-reset-in")&&(this.rateLimitResetTime=Date.now()+1e3*(Number(i.get("x-ratelimit-reset-in"))||1)),this.rateLimitRemainingCalls<5&&oo.log({rateLimitRemainingCalls:this.rateLimitRemainingCalls,rateLimitReset:new Date(this.rateLimitResetTime).toISOString()}),n}))}getScrobbleParams(e){const t={media_player:"ampcast",media_player_version:"0.8.23",submission_client:"ampcast"};e.duration&&(t.duration=Math.round(e.duration)),e.track&&(t.tracknumber=e.track),e.artist_mbids&&(t.artist_mbids=e.artist_mbids),e.release_mbid&&(t.release_mbid=e.release_mbid),e.recording_mbid&&(t.recording_mbid=e.recording_mbid),e.isrc&&(t.isrc=e.isrc);const[r]=e.src.split(":");switch(r){case"spotify":e.externalUrl&&(t.origin_url=e.externalUrl,t.spotify_id=e.externalUrl),t.music_service="spotify.com";break;case"apple":e.externalUrl&&(t.origin_url=e.externalUrl),t.music_service="music.apple.com";break;case"youtube":e.externalUrl&&(t.origin_url=e.externalUrl),t.music_service="youtube.com";break;case"tidal":case"plex-tidal":t.music_service="tidal.com";break;case"blob":case"file":t.music_service_name="Local file";break;default:{const e=Tm(r);e&&(t.music_service_name=e.name)}}const n={track_name:e.title,artist_name:e.artists[0],additional_info:t};return e.album&&"[Unknown Album]"!==e.album&&(n.release_name=e.album),n}canScrobble(e){var t;return!!e&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30}applyRateLimiting(){return new Promise((e=>{if(this.rateLimitRemainingCalls)this.rateLimitRemainingCalls--,e();else{const t=this.rateLimitResetTime-Date.now();t>0?setTimeout(e,t):e()}}))}},co=lo;var uo=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function mo(e){var{href:t,className:r="",children:i=t}=e,a=uo(e,["href","className","children"]);return n.createElement("a",Object.assign({},a,{className:`external-link ${r}`,href:t,target:"_blank",rel:"noopener"}),n.createElement("span",{className:"external-link-text"},i),n.createElement(Nt,{name:"link"}))}var ho=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function fo(e){const t=bl.id,[r,i]=(0,n.useState)(!1),[a,s]=(0,n.useState)(""),o=(0,n.useRef)(null),l=(0,n.useRef)(null),c=(0,n.useRef)(null),u="https://listenbrainz.org/profile/",d=n.createElement(Yi,{icon:bl.icon,text:`Log in to ${bl.name}`}),m=(0,n.useCallback)((()=>ho(this,void 0,void 0,(function*(){try{const e=l.current.value,t=c.current.value;ao.userId=e,i(!0),s("Connecting...");const r=yield fetch("https://api.listenbrainz.org/1/validate-token",{headers:{"Content-Type":"application/json",Authorization:`Token ${t}`}});if(!r.ok)throw r;const{valid:n,user_name:a}=yield r.json();if(!n)throw Error("Invalid token");if(a!==e)throw Error("Token not valid for this user");s(""),o.current.close(JSON.stringify({userId:e,token:t}))}catch(e){console.error(e),s(e.message||e.statusText||"Error")}i(!1)}))),[]),h=(0,n.useCallback)((e=>{e.preventDefault(),m()}),[m]);return n.createElement(jt,Object.assign({},e,{className:"listenbrainz-login-dialog login-dialog",title:d,ref:o}),n.createElement("form",{id:`${t}-login`,method:"dialog",onSubmit:h},n.createElement("div",{className:"table-layout"},n.createElement("p",null,n.createElement("label",{htmlFor:`${t}-username`},"User:"),n.createElement("input",{type:"text",id:`${t}-username`,name:`${t}-username`,autoFocus:!0,required:!0,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",ref:l})),n.createElement("p",null,n.createElement("label",{htmlFor:`${t}-token`},"Token:"),n.createElement("input",{type:"password",id:`${t}-token`,name:`${t}-token`,required:!0,ref:c}))),n.createElement("p",{className:"message "+(r?"":"error")},a),n.createElement("p",{className:"listenbrainz-link service-link"},n.createElement(mo,{href:u},n.createElement(Nt,{name:"listenbrainz"}),u)),n.createElement(Ut,{submitText:"Login"})))}var po=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const bo=new O("listenbrainzAuth"),vo=new Ne("");function yo(){return""!==vo.getValue()}function go(){return vo.pipe(Sn()).pipe(yr((e=>""!==e)),Sn())}vo.next(ao.token);var wo=r(6998),Eo=r.n(wo);const ko="https://musicbrainz.org",xo=new D("youtube"),So={get connectedAt(){return xo.getNumber("connectedAt")},set connectedAt(e){xo.setNumber("connectedAt",e)},clear(){xo.clear()}};var To=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ao=new O("youtubeAuth"),Io="https://www.googleapis.com/auth/youtube.readonly",Po=["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],Co=new Ne("");function Mo(){return""!==No()}function Oo(){return Co.pipe(Sn()).pipe(yr((e=>""!==e)),Sn())}function No(){return Co.getValue()}function $o(){return To(this,void 0,void 0,(function*(){return window.gapi||(yield c("https://apis.google.com/js/api.js")),window.gapi}))}function zo(){return To(this,void 0,void 0,(function*(){const e=yield $o();return e.client?e.client:new Promise(((t,r)=>{e.load("client",{callback:()=>{const n={apiKey:qn,clientId:Kn,discoveryDocs:Po,scope:Io};e.client.init(n).then((()=>t(e.client)),r)},onerror:r})}))}))}function jo(){var e,t;return To(this,void 0,void 0,(function*(){return(null===(t=null===(e=window.google)||void 0===e?void 0:e.accounts)||void 0===t?void 0:t.oauth2)||(yield c("https://accounts.google.com/gsi/client")),google.accounts.oauth2}))}Oo().pipe(pn((e=>!e))).subscribe((e=>So.connectedAt=e?Date.now():0)),Oo().pipe(De((e=>e)),Rn(1),wr((()=>Promise.all([$o(),zo()]))),Le((([e,t])=>{e.load("client:auth2",(()=>{e.auth2.getAuthInstance().isSignedIn.listen((e=>{if(e){const e=t.getToken();Co.next((null==e?void 0:e.access_token)||"")}else Co.next("")}))}))}))).subscribe(Ao),So.connectedAt&&jr(zo()).pipe(yr((e=>e.getToken())),Le((e=>Co.next((null==e?void 0:e.access_token)||"")))).subscribe(Ao);var Lo=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Do=new O("youtubeCache");class Fo extends gt.ZP{constructor(){super("ampcast/youtube/cache"),this.version(1).stores({entries:"&key, timeStamp"}),setTimeout((()=>this.removeExpired()))}store(e,t){return Lo(this,void 0,void 0,(function*(){try{yield this.entries.put({key:e,response:t,timeStamp:Date.now()})}catch(e){Do.error(e)}}))}fetch(e){return Lo(this,void 0,void 0,(function*(){try{const t=yield this.entries.get(e);return null==t?void 0:t.response}catch(e){Do.error(e)}}))}removeExpired(){const e=Date.now()-12096e5;this.entries.where("timeStamp").below(e).delete()}}const Ro=new Fo;var _o=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Uo=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};class Vo{constructor(e,t,r){this.defaultConfig={pageSize:Vo.maxPageSize},this.nextPageToken=void 0,this.pageNumber=1,this.config=Object.assign(Object.assign({},this.defaultConfig),r),this.pager=new mi((()=>_o(this,void 0,void 0,(function*(){return this.fetchPage(e,t)}))),this.config)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems({kind:e,items:t=[]},r){return _o(this,void 0,void 0,(function*(){switch(e){case"youtube#playlistListResponse":return t.map((e=>this.createMediaPlaylist(e)));case"youtube#playlistItemListResponse":{const e=t.map((e=>e.contentDetails.videoId));return(yield this.fetchVideos(e,r)).map((e=>this.createMediaItem(e)))}case"youtube#searchListResponse":{const e=t.map((e=>e.id.videoId));return(yield this.fetchVideos(e,r)).map((e=>this.createMediaItem(e)))}default:return t.map((e=>this.createMediaItem(e)))}}))}createMediaPlaylist(e){var t,r,n;const i=`youtube:playlist:${e.id}`;return{src:i,itemType:Ln.Playlist,externalUrl:`${Yo}/playlist?list=${e.id}`,title:(null===(t=e.snippet)||void 0===t?void 0:t.title)||e.id,thumbnails:this.mapThumbnails(null===(r=e.snippet)||void 0===r?void 0:r.thumbnails),trackCount:null===(n=e.contentDetails)||void 0===n?void 0:n.itemCount,owner:this.createOwner(e.snippet),pager:this.createPlaylistPager(e.id),isPinned:gi.isPinned(i)}}createMediaItem(e){var t,r,n,i,a;return{itemType:Ln.Media,mediaType:Fn.Video,src:`youtube:video:${e.id}`,externalUrl:Jo(e.id),title:(null===(t=e.snippet)||void 0===t?void 0:t.title)||e.id,duration:this.parseDuration(null===(r=e.contentDetails)||void 0===r?void 0:r.duration),thumbnails:this.mapThumbnails(null===(n=e.snippet)||void 0===n?void 0:n.thumbnails),owner:this.createOwner(e.snippet),globalRating:this.parseNumber(null===(i=e.statistics)||void 0===i?void 0:i.likeCount),globalPlayCount:this.parseNumber(null===(a=e.statistics)||void 0===a?void 0:a.viewCount),playedAt:0}}createOwner({channelId:e="",channelTitle:t=""}){return e?{name:t,url:`${Yo}/channel/${e}`}:void 0}createPlaylistPager(e){return new Vo("/playlistItems",{playlistId:e,part:"contentDetails",fields:"items(contentDetails(videoId))"})}mapThumbnails(e){if(e)return Object.keys(e).map((t=>e[t]))}parseDuration(e=""){const[,t=0,r=0,n=0]=/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/.exec(e)||[];return 60*Number(t)*60+60*Number(r)+Number(n)||0}fetchPage(e,t){return _o(this,void 0,void 0,(function*(){const r=this.createCacheKey(e,t,this.pageNumber),n=yield this.getFromCache(r),i=this.nextPageToken,a=yield this.fetch(e,Object.assign(Object.assign({},t),{fields:`etag,kind,pageInfo,nextPageToken,${t.fields||"items"}`,maxResults:String(this.config.pageSize),pageToken:i}),n),{pageInfo:s,nextPageToken:o}=a,l=Uo(a,["pageInfo","nextPageToken"]),c=yield this.createItems(l,r),u=null==s?void 0:s.totalResults,d=!o;return this.nextPageToken=o,this.pageNumber++,yield this.saveToCache(r,a),{items:c,total:u,atEnd:d}}))}fetchVideos(e,t){return _o(this,void 0,void 0,(function*(){const r=`${t}/videos`,n=yield this.getFromCache(r),i=yield this.fetch("/videos",{id:e.join(","),part:"contentDetails,snippet,statistics",fields:`etag,${Vo.videoFields}`},n);return yield this.saveToCache(r,i),i.items||[]}))}fetch(e,t,r){return _o(this,void 0,void 0,(function*(){const n=yield zo(),i=(null==r?void 0:r.etag)?{"If-None-Match":r.etag}:void 0,{result:a,status:s,statusText:o}=yield n.request({path:`https://www.googleapis.com/youtube/v3${e}`,params:t,headers:i});if(a)return a;if(304===s&&r)return r;throw Error(o||`Error (${s})`)}))}getFromCache(e){return _o(this,void 0,void 0,(function*(){return Ro.fetch(e)}))}saveToCache(e,t){return _o(this,void 0,void 0,(function*(){this.config.noCache||(yield Ro.store(e,t))}))}createCacheKey(e,t,r){const{fields:n}=t,i=Uo(t,["fields"]);return`${e}?${new URLSearchParams(i)}#${r}`}parseNumber(e){if(null!=e&&!isNaN(Number(e)))return Number(e)}}Vo.minPageSize=5,Vo.maxPageSize=50,Vo.videoFields="items(id,snippet(title,thumbnails,channelId,channelTitle),contentDetails(duration),statistics(viewCount,likeCount))",Vo.playlistFields="items(id,snippet(title,thumbnails,channelId,channelTitle),contentDetails(itemCount))";const Bo=Vo;var Ho=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Yo="https://www.youtube.com",qo={view:"card",fields:["Thumbnail","Title","Duration","Owner","Views"]},Ko={id:"youtube/likes",title:"Likes",icon:"thumbs-up",itemType:Ln.Media,mediaType:Fn.Video,lockActionsStore:!0,layout:qo,defaultHidden:!0,search:()=>new Bo("/videos",{myRating:"like",part:"snippet,contentDetails,statistics",fields:Bo.videoFields})},Wo={id:"youtube/playlists",title:"Playlists",icon:"playlist",itemType:Ln.Playlist,secondaryLayout:qo,search:()=>new Bo("/playlists",{mine:"true",part:"snippet,contentDetails",fields:Bo.playlistFields})};function Go(e=""){if(e.startsWith("youtube:"))return e;const t=Eo()(e);if(t)return`youtube:video:${t}`;if(/youtu\.?be/.test(e)){const t=new URLSearchParams(new URL(e).search).get("list")||"";if(t)return`youtube:playlist:${t}`}return""}function Jo(e){return`${Yo}/watch?v=${e}`}function Qo(e){return Ho(this,void 0,void 0,(function*(){const t=Jo(e),r=yield fetch(`${Yo}/oembed?url=${t}&format=json`);if(!r.ok)switch(r.status){case 401:throw Error("Embedding prevented by channel owner");case 403:throw Error("Private video");case 404:throw Error("Video does not exist");default:throw Error(`${r.statusText} (${r.status})`)}const n=yield r.json();return{itemType:Ln.Media,mediaType:Fn.Video,src:`youtube:video:${e}`,externalUrl:t,title:n.title,aspectRatio:n.width/n.height||16/9,duration:0,track:0,thumbnails:[{url:n.thumbnail_url,width:n.thumbnail_width,height:n.thumbnail_height}],owner:{name:n.author_name,url:n.author_url},playedAt:0}}))}const Xo={id:"youtube",name:"YouTube",icon:"youtube",url:"https://www.youtube.com",serviceType:vn.PublicMedia,defaultHidden:!0,defaultNoScrobble:!0,roots:[{id:"youtube/search/videos",title:"Video",icon:"search",itemType:Ln.Media,mediaType:Fn.Video,layout:qo,searchable:!0,search:({q:e=""}={})=>e?new Bo("/search",{q:e,type:"video",videoCategoryId:"10",part:"id",fields:"items(id(videoId))"},{maxSize:Bo.maxPageSize,noCache:!0}):new Un}],sources:[Ko,Wo],canRate:()=>!1,canStore:()=>!1,compareForRating:()=>!1,createSourceFromPin:function(e){return{title:e.title,itemType:Ln.Playlist,id:e.src,icon:"pin",isPin:!0,secondaryLayout:Object.assign(Object.assign({},qo),{view:"card compact"}),search(){const[,,t]=e.src.split(":");return new Bo("/playlists",{id:t,part:"snippet,contentDetails",fields:Bo.playlistFields})}}},observeIsLoggedIn:Oo,isLoggedIn:Mo,login:function(){return To(this,void 0,void 0,(function*(){if(!Mo()){Ao.log("connect");try{const e=yield function(){return To(this,void 0,void 0,(function*(){const e=google.accounts.oauth2;return new Promise(((t,r)=>{e.initTokenClient({client_id:Kn,scope:Io,prompt:"",callback:e=>{e.error?r(e.error_description):t(e.access_token)},error_callback:e=>{r(e.message)}}).requestAccessToken()}))}))}();Co.next(e)}catch(e){Ao.error(e)}}}))},logout:function(){return To(this,void 0,void 0,(function*(){Ao.log("disconnect");const e=No();e&&(yield jo()).revoke(e,(()=>Co.next("")))}))}},Zo=Xo;const el=new O("ListenBrainzHistoryPager");class tl{constructor(e,t=!1){this.fetchListenCount=t,this.size$=new Ne(-1),this.nextPageParams=void 0,this.pager=new mi(((t=50)=>{return r=this,n=void 0,a=function*(){try{const{payload:r}=yield co.get(`user/${ao.userId}/listens`,Object.assign(Object.assign(Object.assign({},e),{count:t}),this.nextPageParams)),n=r.listens,i=this.createItems(n),a=i.length<t;return this.nextPageParams=a?void 0:{max_ts:n.at(-1).listened_at-1},{items:i,atEnd:a}}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(r,n||[])).next())}));var r,n,i,a}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.size$.pipe(pn((e=>-1===e)),Sn())}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new ae,this.subscriptions.add(this.pager.observeAdditions().pipe(wr((e=>co.addInLibrary(e)))).subscribe(el)),this.fetchListenCount&&this.subscriptions.add(jr(co.getListenCount()).pipe(Le((e=>this.size$.next(e)))).subscribe(el)))}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){var t,r,n;const i=e.track_metadata,a=i.additional_info,s=(null===(t=i.mbid_mapping)||void 0===t?void 0:t.recording_mbid)||void 0,o=this.getPlayableSrc(a)||"";return{itemType:Ln.Media,mediaType:o.startsWith("youtube:")?Fn.Video:Fn.Audio,src:`listenbrainz:listen:${e.listened_at}`,title:i.track_name,addedAt:e.inserted_at,artists:i.artist_name?[i.artist_name]:void 0,albumArtist:null==a?void 0:a.release_artist_name,album:i.release_name,duration:(null==a?void 0:a.duration)||((null==a?void 0:a.duration_ms)?Math.round(a.duration_ms/1e3):0),track:(null==a?void 0:a.tracknumber)||(null==a?void 0:a.track_number),disc:null==a?void 0:a.discnumber,isrc:null==a?void 0:a.isrc,externalUrl:s?`${ko}/recording/${s}`:void 0,recording_mbid:s,recording_msid:e.recording_msid||void 0,release_mbid:null===(r=i.mbid_mapping)||void 0===r?void 0:r.release_mbid,artist_mbids:null===(n=i.mbid_mapping)||void 0===n?void 0:n.artist_mbids,playedAt:e.listened_at,link:{src:o,externalUrl:this.getExternalUrl(null==a?void 0:a.origin_url)}}}getExternalUrl(e){if(e&&/youtu\.?be/.test(e)){const t=Eo()(e);if(t)return Jo(t)}return e||void 0}getPlayableSrc(e){var t;if(e){if(e.spotify_id)return this.getSpotifySrc(e.spotify_id);const r=e.origin_url;if(r){if(r.includes("apple.com"))return this.getAppleSrc(r);if(r.includes("spotify.com"))return this.getSpotifySrc(r);if(r.includes("tidal.com"))return"tidal:";if(/youtu\.?be/.test(r))return Go(r)}const n=(null===(t=e.music_service_name)||void 0===t?void 0:t.toLowerCase())||"",i=km().map((e=>e.id));for(const e of i)if(n.includes(e))return`${e}:`}}getAppleSrc(e){if(e){const t=e.split("i=").pop();if(t)return`apple:song:${t}`}}getSpotifySrc(e){if(e){const t=e.split("/").pop();if(t)return`spotify:track:${t}`}}isNoContentError(e){return 204===(null==e?void 0:e.status)}}tl.maxPageSize=100;const rl=tl;class nl{constructor(){let e=0;this.pager=new mi(((t=50)=>{return r=this,n=void 0,a=function*(){try{const r=yield co.get(`feedback/user/${ao.userId}/get-feedback`,{score:1,metadata:!0,offset:e,count:t});e+=t;const n=this.createItems(r.feedback),i=r.total_count;return{items:n,total:i,atEnd:r.offset+n.length>=i}}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(r,n||[])).next())}));var r,n,i,a}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){var t,r;const n=e.track_metadata,i=n.additional_info,a=e.recording_mbid;return{itemType:Ln.Media,mediaType:Fn.Audio,src:`listenbrainz:track:${Gi()}`,title:n.track_name,artists:n.artist_name?[n.artist_name]:void 0,albumArtist:null==i?void 0:i.release_artist_name,album:n.release_name,duration:(null==i?void 0:i.duration)||((null==i?void 0:i.duration_ms)?Math.round(i.duration_ms/1e3):0),track:(null==i?void 0:i.tracknumber)||(null==i?void 0:i.track_number),disc:null==i?void 0:i.discnumber,isrc:null==i?void 0:i.isrc,externalUrl:a?`${ko}/recording/${a}`:void 0,recording_mbid:a,recording_msid:e.recording_msid||void 0,release_mbid:null===(t=n.mbid_mapping)||void 0===t?void 0:t.release_mbid,artist_mbids:null===(r=n.mbid_mapping)||void 0===r?void 0:r.artist_mbids,playedAt:0,inLibrary:!0}}isNoContentError(e){return 204===(null==e?void 0:e.status)}}nl.maxPageSize=100;const il=nl;var al=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const sl=new class{constructor(){this.host="https://musicbrainz.org/ws/2",this.lastCall=0}getISRCs(e){return al(this,void 0,void 0,(function*(){return(yield this.get(`/recording/${e}`,{inc:"isrcs"})).isrcs||[]}))}getRecordingsByISRC(e){return al(this,void 0,void 0,(function*(){return(yield this.get(`/isrc/${e}`)).recordings||[]}))}get(e,t={}){return al(this,void 0,void 0,(function*(){e.startsWith("/")&&(e=e.slice(1)),t.fmt="json",e=`${e}?${new URLSearchParams(t)}`,yield this.applyRateLimiting(),this.lastCall=Date.now();const r=yield fetch(`${this.host}/${e}`,{method:"GET",headers:{"User-Agent":"ampcast/0.8.23 ( rekkyrosso@gmail.com )"}});if(!r.ok)throw r;return yield r.json()}))}applyRateLimiting(){return new Promise((e=>{const t=Date.now()-this.lastCall;t>1e3?e():setTimeout((()=>e),t)}))}};class ol{constructor(e,t){this.release_mbid=e,this.pager=new mi((()=>{return r=this,n=void 0,a=function*(){var r;const{media:n=[]}=yield sl.get(`release/${e}`,{inc:"recordings"});return{items:this.createItems((null===(r=n[0])||void 0===r?void 0:r.tracks)||[],t),atEnd:!0}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(r,n||[])).next())}));var r,n,i,a}))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems(e,t){return e.map((e=>this.createItem(e,t)))}createItem(e,t){const r=e.recording,n=r.id||void 0;return{itemType:Ln.Media,mediaType:Fn.Audio,src:`musicbrainz:track:${n||Gi()}`,title:e.title,artists:(null==t?void 0:t.artist)?[t.artist]:void 0,albumArtist:null==t?void 0:t.artist,album:null==t?void 0:t.title,duration:e.length/1e3||0,track:e.number?Number(e.number):void 0,recording_mbid:n,release_mbid:this.release_mbid,year:(null==t?void 0:t.year)||new Date(r["first-release-date"]).getUTCFullYear()||void 0,playedAt:0,externalUrl:n?`https://musicbrainz.org/recording/${n}`:void 0}}}const ll=new O("ListenBrainzStatsPager");class cl{constructor(e,t){let r=0;this.pager=new mi(((n=50)=>{return i=this,a=void 0,o=function*(){try{const i=yield co.get(e,Object.assign(Object.assign({},t),{offset:r,count:n}));return r+=n,this.createPage(i)}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((s=void 0)||(s=Promise))((function(e,t){function r(e){try{l(o.next(e))}catch(e){t(e)}}function n(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof s?e:new s((function(t){t(e)}))}(t.value).then(r,n)}l((o=o.apply(i,a||[])).next())}));var i,a,s,o}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new ae,this.subscriptions.add(this.pager.observeAdditions().pipe(yr((e=>e.filter((e=>e.itemType===Ln.Media)))),De((e=>e.length>0)),wr((e=>co.addInLibrary(e)))).subscribe(ll)))}createPage(e){if(this.isRecordingsResponse(e)){const t=e.payload,r=t.recordings.map((e=>this.createMediaItem(e))),n=t.total_recording_count;return{items:r,total:n,atEnd:t.offset+r.length>=n}}if(this.isReleasesResponse(e)){const t=e.payload,r=t.releases.map((e=>this.createMediaAlbum(e))),n=t.total_release_count;return{items:r,total:n,atEnd:t.offset+r.length>=n}}if(this.isArtistsResponse(e)){const t=e.payload,r=t.artists.map((e=>this.createMediaArtist(e))),n=t.total_artist_count;return{items:r,total:n,atEnd:t.offset+r.length>=n}}throw Error("Unknown response")}createMediaArtist(e){var t;const r=(null===(t=e.artist_mbids)||void 0===t?void 0:t[0])||void 0;return{itemType:Ln.Artist,src:`listenbrainz:artist:${Gi()}`,externalUrl:r?`${ko}/artist/${r}`:void 0,title:e.artist_name,artist_mbid:r,playCount:e.listen_count,pager:new Un}}createMediaAlbum(e){const t=e.release_mbid||void 0,r={itemType:Ln.Album,src:`listenbrainz:album:${Gi()}`,externalUrl:t?`${ko}/release/${t}`:void 0,title:e.release_name,artist:e.artist_name,release_mbid:t,artist_mbids:e.artist_mbids,playCount:e.listen_count};return Object.assign(Object.assign({},r),{pager:t?new ol(t,r):new Un})}createMediaItem(e){const t=e.recording_mbid||void 0;return{itemType:Ln.Media,mediaType:Fn.Audio,src:`listenbrainz:track:${Gi()}`,externalUrl:t?`${ko}/recording/${t}`:void 0,title:e.track_name,artists:e.artist_name?[e.artist_name]:void 0,album:e.release_name,duration:0,recording_mbid:t,release_mbid:e.release_mbid||void 0,artist_mbids:e.artist_mbids,playCount:e.listen_count,playedAt:0}}isRecordingsResponse(e){return"total_recording_count"in e.payload}isReleasesResponse(e){return"total_release_count"in e.payload}isArtistsResponse(e){return"total_artist_count"in e.payload}isNoContentError(e){return 204===(null==e?void 0:e.status)}}const ul={id:"listenbrainz/history",title:"History",icon:"clock",itemType:Ln.Media,search:({startAt:e=0}={})=>new rl(e?{max_ts:e}:void 0)},dl={id:"listenbrainz/recently-played",title:"Recently Played",icon:"clock",itemType:Ln.Media,search:()=>new rl},ml={id:"listenbrainz/loved-tracks",title:"Loved Tracks",icon:"heart",itemType:Ln.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear"]},search:()=>new il},hl={id:"listenbrainz/top/tracks",title:"Top Tracks",icon:"star",itemType:Ln.Media,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","PlayCount"]},search:e=>new cl(`stats/user/${ao.userId}/recordings`,e)},fl={id:"listenbrainz/top/albums",title:"Top Albums",icon:"star",itemType:Ln.Album,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},search:e=>new cl(`stats/user/${ao.userId}/releases`,e)},pl={id:"listenbrainz/top/artists",title:"Top Artists",icon:"star",itemType:Ln.Artist,layout:{view:"card minimal",fields:["Thumbnail","Title","PlayCount"]},secondaryLayout:{view:"none"},search:e=>new cl(`stats/user/${ao.userId}/artists`,e)},bl={id:"listenbrainz",name:"ListenBrainz",icon:"listenbrainz",url:"https://listenbrainz.org",serviceType:vn.Scrobbler,defaultHidden:!0,roots:[dl],sources:[hl,fl,pl,ml,ul],labels:{[zn.AddToLibrary]:"Love on ListenBrainz",[zn.RemoveFromLibrary]:"Unlove on ListenBrainz"},canRate:()=>!1,canStore:vl,compareForRating:yl,store:function(e,t){return r=this,n=void 0,a=function*(){vl(e)&&(yield co.store(e,t))},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(r,n||[])).next())}));var r,n,i,a},observeIsLoggedIn:go,isLoggedIn:yo,login:function(){return po(this,void 0,void 0,(function*(){if(!yo()){bo.log("connect");try{const e=yield function(){return ho(this,void 0,void 0,(function*(){return Dt(fo,!0)}))}();if(e){const{userId:t,token:r}=JSON.parse(e);ao.userId=t,ao.token=r,vo.next(r)}}catch(e){bo.error(e)}}}))},logout:function(){return po(this,void 0,void 0,(function*(){bo.log("disconnect"),ao.clear(),vo.next("")}))}};function vl(e){return e.itemType===Ln.Media&&!(!e.recording_mbid&&!e.recording_msid)}function yl(e,t){const[r]=e.src.split(":"),[n]=t.src.split(":");return r===n&&e.itemType===Ln.Media&&e.itemType===t.itemType&&(!!e.recording_mbid&&e.recording_mbid===t.recording_mbid||!!e.recording_msid&&e.recording_msid===t.recording_msid)}const gl=new D("subsonic"),wl=new Ne(gl.getString("libraryId")),El={get audioLibraries(){return this.libraries},get host(){return gl.getString("host")},set host(e){gl.setString("host",e)},get credentials(){return gl.getString("credentials")},set credentials(e){gl.setString("credentials",e)},get libraryId(){return gl.getString("libraryId")},set libraryId(e){gl.setString("libraryId",e),wl.next(e)},observeLibraryId:()=>wl.pipe(Sn()),get libraries(){var e;const t=gl.getJson("libraries",[]);return""!==(null===(e=t[0])||void 0===e?void 0:e.id)&&t.splice(0,0,{id:"",title:"(all)"}),t},set libraries(e){gl.setJson("libraries",e),e.find((e=>e.id===this.libraryId))||(this.libraryId="")},get userName(){return gl.getString("userName")},set userName(e){gl.setString("userName",e)},clear(){gl.removeItem("userName"),gl.removeItem("credentials")}},kl=El;var xl=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Sl(e,t,{host:r,credentials:n}=kl){return xl(this,void 0,void 0,(function*(){if(!n)throw Error("No subsonic credentials");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1));const i=yield fetch(`${r}/rest/${e}${e.includes("?")?"&":"?"}${n}`,{method:"GET",headers:{Accept:"application/json"}});if(!i.ok)throw i;const{"subsonic-response":a}=yield i.json();if(a.error)throw Error(a.error.message||"Failed");return a}))}function Tl(e,t=kl){var r;return xl(this,void 0,void 0,(function*(){const n=yield Sl("getAlbumList",t.libraryId?Object.assign(Object.assign({},e),{musicFolderId:t.libraryId}):e,t);return(null===(r=n.albumList.album)||void 0===r?void 0:r.map((e=>Object.assign(Object.assign({},e),{name:e.name||e.album||"[Unknown Album]"}))))||[]}))}function Al(e=kl){return xl(this,void 0,void 0,(function*(){return(yield Sl("getArtists",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).artists.index.map((e=>e.artist)).flat()}))}function Il(){return xl(this,void 0,void 0,(function*(){const e=[];let t=10*Math.floor((new Date).getFullYear()/10);for(;t>=1930;)e.push({id:String(t),title:`${t}s`}),t-=10;return e}))}function Pl(e,t){var r;return xl(this,void 0,void 0,(function*(){const n=yield Sl("getGenres",void 0,t);return(null===(r=n.genres.genre)||void 0===r?void 0:r.map((({value:t,albumCount:r,songCount:n})=>{const i=e===Ln.Album?r:n;return{id:t,title:`${t} (${i})`,count:i}})).filter((e=>e.count>0)).sort(((e,t)=>e.count===t.count?e.title.localeCompare(t.title):t.count-e.count)))||[]}))}function Cl(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getMusicDirectory",{id:e},t)).directory}))}const Ml={get:Sl,getAlbum:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getAlbum",{id:e},t)).album}))},getAlbumInfo:function(e,t,r){return xl(this,void 0,void 0,(function*(){return(yield Sl("getAlbumInfo"+(t?"":"2"),{id:e},r)).albumInfo}))},getAlbumTracks:function(e,t,r){return xl(this,void 0,void 0,(function*(){return t?(yield Sl("getMusicDirectory",{id:e},r)).directory.child||[]:(yield Sl("getAlbum",{id:e},r)).album.song||[]}))},getAlbumsByDecade:function(e,t,r,n){return xl(this,void 0,void 0,(function*(){const i=Number(e);return Tl({type:"byYear",fromYear:i+9,toYear:i,size:r,offset:t},n)}))},getAlbumsByGenre:function(e,t,r,n){return xl(this,void 0,void 0,(function*(){return Tl({type:"byGenre",genre:e,size:r,offset:t},n)}))},getArtist:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getArtist",{id:e},t)).artist}))},getArtists:Al,getArtistAlbums:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getArtist",{id:e},t)).artist.album||[]}))},getArtistInfo:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getArtistInfo2",{id:e},t)).artistInfo2}))},getArtistTopTracks:function(e,t=50,r){return xl(this,void 0,void 0,(function*(){return(yield Sl("getTopSongs",{artist:e,count:t},r)).topSongs.song||[]}))},getDecades:Il,getFilters:function(e,t,r){return xl(this,void 0,void 0,(function*(){return e===Ri.ByDecade?Il():Pl(t,r)}))},getGenres:Pl,getIndexes:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getIndexes",{musicFolderId:e},t)).indexes.index||[]}))},getLikedAlbums:function(e,t,r){return xl(this,void 0,void 0,(function*(){return Tl({type:"starred",size:t,offset:e},r)}))},getLikedArtists:function(e=kl){return xl(this,void 0,void 0,(function*(){return(yield Sl("getStarred2",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).starred2.artist||[]}))},getLikedSongs:function(e=kl){return xl(this,void 0,void 0,(function*(){return(yield Sl("getStarred2",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).starred2.song||[]}))},getMostPlayed:function(e,t,r){return xl(this,void 0,void 0,(function*(){return Tl({type:"frequent",size:t,offset:e},r)}))},getMusicDirectory:Cl,getMusicDirectoryItems:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Cl(e,t)).child.sort(((e,t)=>e.isDir===t.isDir?e.isDir?e.title.localeCompare(t.title):0:e.isDir?-1:1))}))},getMusicLibraries:function(e){var t;return xl(this,void 0,void 0,(function*(){const r=yield Sl("getMusicFolders",void 0,e);return(null===(t=r.musicFolders.musicFolder)||void 0===t?void 0:t.sort(((e,t)=>e.name.localeCompare(t.name))).map((({id:e,name:t})=>({id:String(e),title:t}))))||[]}))},getPlayableUrl:function(e,{host:t,credentials:r}=kl){const[,,n]=e.split(":");return`${t}/rest/stream?id=${n}&${r}`},getPlaylist:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getPlaylist",{id:e},t)).playlist}))},getPlaylists:function(e){return xl(this,void 0,void 0,(function*(){return(yield Sl("getPlaylists",void 0,e)).playlists.playlist||[]}))},getPlaylistItems:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getPlaylist",{id:e},t)).playlist.entry||[]}))},getRandomAlbums:function(e=100,t){return xl(this,void 0,void 0,(function*(){return Tl({type:"random",size:e,offset:0},t)}))},getRandomArtists:function(e=100,t){return xl(this,void 0,void 0,(function*(){return f(yield Al(t)).slice(0,e)}))},getRandomSongs:function(e=100,t=kl){return xl(this,void 0,void 0,(function*(){return(yield Sl("getRandomSongs",t.libraryId?{musicFolderId:t.libraryId,size:e}:{size:e},t)).randomSongs.song||[]}))},getRecentlyPlayed:function(e,t,r){return xl(this,void 0,void 0,(function*(){return Tl({type:"recent",size:t,offset:e},r)}))},getSong:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getSong",{id:e},t)).song}))},getSongsByGenre:function(e,t,r,n=kl){return xl(this,void 0,void 0,(function*(){const i={genre:e,offset:t,count:r};return(yield Sl("getSongsByGenre",n.libraryId?Object.assign(Object.assign({},i),{musicFolderId:n.libraryId}):i,n)).songsByGenre.song||[]}))},getVideos:function(e){return xl(this,void 0,void 0,(function*(){return(yield Sl("getVideos",void 0,e)).videos.video||[]}))},scrobble:function(e,t){return xl(this,void 0,void 0,(function*(){return Sl("scrobble",e,t)}))},searchAlbums:function(e,t,r,n=kl){var i;return xl(this,void 0,void 0,(function*(){const a={query:e,albumCount:r,albumOffset:t,songCount:0,artistCount:0},s=yield Sl("search2",n.libraryId?Object.assign(Object.assign({},a),{musicFolderId:n.libraryId}):a,n);return(null===(i=s.searchResult2.album)||void 0===i?void 0:i.map((e=>Object.assign(Object.assign({},e),{name:e.name||e.album||"[Unknown Album]"}))))||[]}))},searchArtists:function(e,t,r,n=kl){return xl(this,void 0,void 0,(function*(){const i={query:e,artistOffset:t,artistCount:r,songCount:0,albumCount:0};return(yield Sl("search3",n.libraryId?Object.assign(Object.assign({},i),{musicFolderId:n.libraryId}):i,n)).searchResult3.artist||[]}))},searchSongs:function(e,t,r,n=kl){return xl(this,void 0,void 0,(function*(){const i={query:e,songOffset:t,songCount:r,albumCount:0,artistCount:0};return(yield Sl("search3",n.libraryId?Object.assign(Object.assign({},i),{musicFolderId:n.libraryId}):i,n)).searchResult3.song||[]}))}},Ol=Ml,Nl=new D("navidrome"),$l={get host(){return Nl.getString("host")},set host(e){Nl.setString("host",e)},get credentials(){return Nl.getString("credentials")},set credentials(e){Nl.setString("credentials",e)},get token(){return Nl.getString("token")},set token(e){Nl.setString("token",e)},get userId(){return Nl.getString("userId")},set userId(e){Nl.setString("userId",e)},clear(){Nl.removeItem("token"),Nl.removeItem("credentials"),Nl.removeItem("userId")}};var zl=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function jl(e){const t=(0,n.useCallback)(((e,t,r)=>zl(this,void 0,void 0,(function*(){const n=yield fetch(`${e}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:r})});if(!n.ok)throw n;const{token:i,subsonicSalt:a,subsonicToken:s,id:o}=yield n.json(),l=`u=${t}&s=${a}&t=${s}&v=1.16.1&c=ampcast&f=json`;return JSON.stringify({userId:o,token:i,credentials:l})}))),[]);return n.createElement(Wi,Object.assign({},e,{service:dc,settings:$l,login:t}))}var Ll=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Dl(e,t){return Ll(this,void 0,void 0,(function*(){const r=yield Fl(e,t,{method:"GET",headers:{Accept:"application/json"}});return yield r.json()}))}function Fl(e,t,r){return Ll(this,void 0,void 0,(function*(){const{host:n,token:i}=$l;if(!i)throw Error("No access token");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1)),r.headers=Object.assign(Object.assign({},r.headers),{"x-nd-authorization":`Bearer ${i}`});const a=yield fetch(`${n}/api/${e}`,r);if(!a.ok)throw a;return a}))}const Rl={get:Dl,getFilters:function(e){return Ll(this,void 0,void 0,(function*(){return e===Ri.ByDecade?Ol.getDecades():function(){return Ll(this,void 0,void 0,(function*(){return(yield Dl("genre",{_sort:"name"})).map((({id:e,name:t})=>({id:e,title:t})))}))}()}))},getPage:function(e,t){return Ll(this,void 0,void 0,(function*(){const r=yield Fl(e,t,{method:"GET",headers:{Accept:"application/json"}});let n=yield r.json(),i=0;return Array.isArray(n)?i=Number(r.headers.get("X-Total-Count"))||n.length:(n=[n],i=1),{items:n,total:i}}))},getPlayableUrl:function(e){return Ol.getPlayableUrl(e,$l)}},_l=Rl;var Ul=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Vl=new O("navidromeAuth"),Bl=new Ne(""),Hl=new Ne(!1);function Yl(){return Hl.getValue()}function ql(e){$l.token=e,Bl.next(e)}Bl.pipe(Sn()).pipe(De((e=>""!==e)),wr((()=>function(){return Ul(this,void 0,void 0,(function*(){try{return yield _l.get("playlist",{_end:1}),!0}catch(e){return Vl.error(e),Bl.next(""),!1}}))}()))).subscribe(Hl),ql($l.token);class Kl{constructor(e,t,r,n){this.itemType=e,this.path=t,this.params=r,this.pageSize=(null==n?void 0:n.pageSize)||200,this.pager=new va((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},n))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){return t=this,r=void 0,i=function*(){const t=(e-1)*this.pageSize,r=t+this.pageSize,{items:n,total:i}=yield _l.getPage(this.path,Object.assign(Object.assign({},this.params),{_start:t,_end:r}));return{items:n.map((e=>this.createMediaObject(e))),total:i}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}createMediaObject(e){let t;switch(this.itemType){case Ln.Album:t=this.createMediaAlbum(e);break;case Ln.Artist:t=this.createMediaArtist(e);break;case Ln.Playlist:t=this.createMediaPlaylist(e);break;default:t=this.createMediaItem(e)}return t}createMediaItem(e){var t;const r=e.mediaFileId||e.id;return{itemType:Ln.Media,mediaType:Fn.Audio,src:`navidrome:audio:${r}`,externalUrl:this.getExternalUrl(`album/${e.albumId}`),title:e.title,addedAt:this.parseDate(e.createdAt),artists:[e.artist],albumArtist:e.albumArtist,album:e.album,duration:e.duration,track:e.trackNumber,disc:e.discNumber,inLibrary:e.starred,year:e.year,playedAt:this.parseDate(e.playDate),playCount:e.playCount,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),thumbnails:this.createThumbnails(e.albumId),recording_mbid:e.mbzTrackId}}createMediaAlbum(e){var t;const r=e.id;return{itemType:Ln.Album,src:`navidrome:album:${r}`,externalUrl:this.getExternalUrl(`album/${r}`),title:e.name,addedAt:this.parseDate(e.createdAt),artist:e.albumArtist,inLibrary:e.starred,year:e.minYear||e.maxYear,playedAt:this.parseDate(e.playDate),playCount:e.playCount,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),pager:new Kl(Ln.Media,"song",{album_id:r,_sort:"album"}),thumbnails:this.createThumbnails(r),release_mbid:e.mbzAlbumId}}createMediaArtist(e){var t;const r=e.id,n=Object.keys(e).some((e=>/ImageUrl$/.test(e)));return{itemType:Ln.Artist,src:`navidrome:artist:${r}`,externalUrl:this.getExternalUrl(`artist/${r}`),title:e.name,description:A(e.biography)||void 0,inLibrary:e.starred,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),pager:this.createArtistAlbumsPager(e),thumbnails:n?this.createThumbnails(r):void 0,artist_mbid:e.mbzArtistId}}createMediaPlaylist(e){const t=e.id,r=`navidrome:playlist:${t}`;return{itemType:Ln.Playlist,src:r,externalUrl:this.getExternalUrl(`playlist/${t}`),title:e.name,description:A(e.comment),addedAt:this.parseDate(e.createdAt),duration:e.duration,trackCount:e.songCount,pager:new Kl(Ln.Media,`playlist/${t}/tracks`,{playlist_id:t}),thumbnails:this.createThumbnails(t),isPinned:gi.isPinned(r),isOwn:e.ownerId===$l.userId,owner:{name:e.ownerName}}}getExternalUrl(e){return`${$l.host}/app/#/${e}/show`}parseDate(e){const t=Date.parse(e)||0;return t<0?0:Math.round(t/1e3)}createThumbnails(e){return e?[this.createThumbnail(e,120),this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480)]:void 0}createThumbnail(e,t,r=t){const{host:n}=$l;return{url:`${n}/rest/getCoverArt?id=${e}&size=${t}&{navidrome-credentials}`,width:t,height:r}}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),r=new Un([t]),n=new Kl(Ln.Album,"album",{album_artist_id:e.id,_sort:"minYear",_order:"DESC"});return new fi(void 0,n,r)}createArtistAllTracks(e){const t=Object.keys(e).some((e=>/ImageUrl$/.test(e)));return{itemType:Ln.Album,src:`navidrome:all-tracks:${e.id}`,title:"All Songs",artist:e.name,thumbnails:t?this.createThumbnails(e.id):void 0,pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new Kl(Ln.Media,"song",{artist:e.name,_sort:"title"})}}Kl.minPageSize=10,Kl.maxPageSize=500;const Wl=Kl;var Gl=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Jl="navidrome",Ql="order_album_artist_name,order_album_name,disc_number,track_number",Xl="order_album_artist_name,order_album_name",Zl={id:"navidrome/liked-songs",title:"My Songs",icon:"heart",itemType:Ln.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>new Wl(Ln.Media,"song",{starred:!0,_sort:"starred_at",_order:"DESC"})},ec={id:"navidrome/liked-albums",title:"My Albums",icon:"heart",itemType:Ln.Album,lockActionsStore:!0,search:()=>new Wl(Ln.Album,"album",{starred:!0,_sort:"starred_at",_order:"DESC"})},tc={id:"navidrome/liked-artists",title:"My Artists",icon:"heart",itemType:Ln.Artist,lockActionsStore:!0,defaultHidden:!0,search:()=>new Wl(Ln.Artist,"artist",{starred:!0,_sort:"starred_at",_order:"DESC"})},rc={id:"navidrome/recently-played",title:"Recently Played",icon:"clock",itemType:Ln.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>new Wl(Ln.Media,"song",{_sort:"play_date",_order:"DESC"})},nc={id:"navidrome/most-played",title:"Most Played",icon:"most-played",itemType:Ln.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>new Wl(Ln.Media,"song",{_sort:"play_count",_order:"DESC"})},ic={id:"navidrome/playlists",title:"Playlists",icon:"playlist",itemType:Ln.Playlist,secondaryLayout:{view:"details",fields:["Index","Artist","Title","Album","Track","Duration","PlayCount"]},search:()=>new Wl(Ln.Playlist,"playlist",{_sort:"name"})},ac={id:"navidrome/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:Ln.Media,viewType:Ri.ByGenre,defaultHidden:!0,search:e=>e?new Wl(Ln.Media,"song",{genre_id:e.id,_sort:Ql}):new Un},sc={id:"navidrome/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:Ln.Album,viewType:Ri.ByGenre,search:e=>e?new Wl(Ln.Album,"album",{genre_id:e.id,_sort:Xl}):new Un},oc={id:"navidrome/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:Ln.Artist,viewType:Ri.ByGenre,defaultHidden:!0,search:e=>e?new Wl(Ln.Artist,"artist",{genre_id:e.id,_sort:"name"}):new Un},lc={id:"navidrome/random-tracks",title:"Random Songs",icon:"shuffle",itemType:Ln.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>new Wl(Ln.Media,"song",{_sort:"random"},{maxSize:100})},cc={id:"navidrome/random-albums",title:"Random Albums",icon:"shuffle",itemType:Ln.Album,search:()=>new Wl(Ln.Album,"album",{_sort:"random"},{maxSize:100})},uc={id:Jl,icon:Jl,name:"Navidrome",url:"https://www.navidrome.org/",serviceType:vn.PersonalMedia,defaultHidden:!0,roots:[hc(Ln.Media,{title:"Songs"}),hc(Ln.Album,{title:"Albums"}),hc(Ln.Artist,{title:"Artists"}),hc(Ln.Playlist,{title:"Playlists"})],sources:[Zl,ec,tc,rc,nc,ic,ac,sc,oc,lc,cc],labels:{[zn.AddToLibrary]:"Add to Navidrome Favorites",[zn.RemoveFromLibrary]:"Remove from Navidrome Favorites"},canRate:()=>!1,canStore:mc,compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:Ln.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":");return new Wl(Ln.Playlist,`playlist/${t}`)}}},getFilters:function(e){return Gl(this,void 0,void 0,(function*(){return _l.getFilters(e)}))},getMetadata:function(e){return Gl(this,void 0,void 0,(function*(){const t=e.itemType,[,,r]=e.src.split(":");if(t===Ln.Album&&void 0===e.description){const t=yield Ol.getAlbumInfo(r,!1,$l);e=Object.assign(Object.assign({},e),{description:A(t.notes)})}if(!mc(e)||void 0!==e.inLibrary)return e;const n=Nn.getInLibrary(e);if(void 0!==n)return Object.assign(Object.assign({},e),{inLibrary:n});const i=t===Ln.Artist?"artist":t===Ln.Album?"album":"song",a=new Wl(t,`${i}/${r}`,{pageSize:1,maxSize:1}),s=yield _n(a,{timeout:2e3});return k(e,s[0])}))},getPlayableUrl:function({src:e}){return _l.getPlayableUrl(e)},getThumbnailUrl:function(e){return e.replace("{navidrome-credentials}",$l.credentials)},lookup:function(e,t,r=10,n){return Gl(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:r,maxSize:r,lookup:!0};return _n(new Wl(Ln.Media,"song",{title:`${e} ${t}`,_sort:"order_artist_name,order_album_name,track_number"},i),{timeout:n})}))},store:function(e,t){return Gl(this,void 0,void 0,(function*(){const[,,r]=e.src.split(":"),n=t?"star":"unstar";switch(e.itemType){case Ln.Media:yield Ol.get(n,{id:r},$l);break;case Ln.Album:yield Ol.get(n,{albumId:r},$l);break;case Ln.Artist:yield Ol.get(n,{artistId:r},$l)}}))},observeIsLoggedIn:function(){return Hl.pipe(Sn())},isLoggedIn:Yl,login:function(){return Ul(this,void 0,void 0,(function*(){if(!Yl()){Vl.log("connect");try{const e=yield function(){return zl(this,void 0,void 0,(function*(){return Dt(jl,!0)}))}();if(e){const{userId:t,token:r,credentials:n}=JSON.parse(e);$l.userId=t,$l.credentials=n,ql(r)}}catch(e){Vl.error(e)}}}))},logout:function(){return Ul(this,void 0,void 0,(function*(){Vl.log("disconnect"),$l.clear(),ql(""),Hl.next(!1)}))}},dc=uc;function mc(e){switch(e.itemType){case Ln.Media:case Ln.Artist:return!0;case Ln.Album:return!e.synthetic;default:return!1}}function hc(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`navidrome/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search({q:t=""}={}){switch(t=t.trim(),e){case Ln.Media:return new Wl(e,"song",{title:t,_sort:Ql});case Ln.Album:return new Wl(e,"album",{name:t,_sort:Xl});case Ln.Artist:return new Wl(e,"artist",{name:t,_sort:"name"});case Ln.Playlist:return new Wl(e,"playlist",{q:t,_sort:"name"});default:return new Un}}})}var fc;!function(e){e[e.Low=4]="Low",e[e.Normal=8]="Normal",e[e.High=12]="High",e[e.Lossless=16]="Lossless",e[e.Master=20]="Master"}(fc||(fc={}));const pc=fc,bc=new D("plex"),vc=new Ne(bc.getString("libraryId")),yc={get audioLibraries(){return this.libraries},get clientId(){let e=bc.getString("clientId");return e||(e=Gi(),bc.setString("clientId",e)),e},get connection(){return bc.getJson("connection")},set connection(e){bc.setJson("connection",e)},get hasTidal(){return bc.getBoolean("hasTidal")},set hasTidal(e){bc.setBoolean("hasTidal",e)},get host(){var e;return(null===(e=this.connection)||void 0===e?void 0:e.uri)||""},get libraryId(){return bc.getString("libraryId")},set libraryId(e){bc.setString("libraryId",e),vc.next(e)},observeLibraryId:()=>vc.pipe(Sn()),get libraries(){return bc.getJson("libraries")||[]},set libraries(e){const t=e.find((e=>e.id===this.libraryId))||e.find((e=>C(e.title)))||e[0];bc.setJson("libraries",e),this.libraryId=(null==t?void 0:t.id)||""},get server(){return bc.getJson("server")},set server(e){bc.setJson("server",e)},get serverToken(){var e;return(null===(e=this.server)||void 0===e?void 0:e.accessToken)||""},get streamingQuality(){return bc.getNumber("streamingQuality",pc.Lossless)},set streamingQuality(e){bc.setNumber("streamingQuality",e)},get userToken(){return bc.getString("userToken")},set userToken(e){bc.setString("userToken",e)},get userId(){return bc.getString("userId")},set userId(e){bc.setString("userId",e)},clear(){bc.removeItem("userId"),bc.removeItem("userToken"),bc.removeItem("server"),bc.removeItem("connection"),bc.removeItem("hasTidal")}};var gc;!function(e){e.Episode="4",e.Artist="artist",e.Album="album",e.Track="track",e.Clip="clip",e.Playlist="playlist"}(gc||(gc={}));const wc=gc;var Ec;!function(e){e.Episode="4",e.Artist="8",e.Album="9",e.Track="10",e.MusicVideo="12",e.Clip="14",e.Playlist="15"}(Ec||(Ec={}));const kc=Ec;var xc=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Sc=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const Tc="https://music.provider.plex.tv",Ac="https://discover.provider.plex.tv";function Ic(e){var{headers:t,body:r}=e,n=Sc(e,["headers","body"]);return xc(this,void 0,void 0,(function*(){return t=Object.assign(Object.assign({},t),{Accept:"application/json"}),r&&(t=Object.assign(Object.assign({},t),{"Content-Type":"application/json"}),r=JSON.stringify(r)),(yield Pc(Object.assign({headers:t,body:r},n))).json()}))}function Pc({host:e=yc.host,path:t,method:r="GET",params:n,headers:i,body:a,token:s,keepalive:o}){return xc(this,void 0,void 0,(function*(){if(!e)throw Error("No Plex connection.");(t=n?`${t}?${new URLSearchParams(n)}`:t).startsWith("/")&&(t=t.slice(1)),s||(s=e===yc.host?yc.serverToken:yc.userToken);const l=yield fetch(`${e}/${t}`,{method:r,headers:Object.assign(Object.assign({},i),Nc(s)),body:a,keepalive:o});if(!l.ok)throw l;return l}))}function Cc(e="all"){return`/library/sections/${Mc()}/${e}`}function Mc(){const e=yc.libraryId;if(!e)throw new Ui;return e}function Oc(e,t){return xc(this,void 0,void 0,(function*(){if(e.length>0){const r=e.map((e=>e.ratingKey)),{MediaContainer:{Metadata:n=[]}}=yield Ic({host:t,path:`/library/metadata/${r.join(",")}`,headers:{"X-Plex-Container-Start":"0","X-Plex-Container-Size":String(r.length)}});e=n}return e}))}function Nc(e){const t={"X-Plex-Product":"ampcast","X-Plex-Version":"0.8.23","X-Plex-Platform":Y.displayName,"X-Plex-Platform-Version":Y.version,"X-Plex-Device":Y.os,"X-Plex-Device-Name":Y.displayName,"X-Plex-Client-Identifier":yc.clientId,"X-Plex-Model":"hosted","Accept-Encoding":"gzip, deflate, br","X-Plex-Features":"external-media"};return e&&(t["X-Plex-Token"]=e),t}function $c(e){switch(e){case Ln.Album:return kc.Album;case Ln.Artist:return kc.Artist;case Ln.Playlist:return kc.Playlist;default:return kc.Track}}const zc={fetch:Pc,fetchJSON:Ic,getEnhancedItems:Oc,getAccount:function(e){return xc(this,void 0,void 0,(function*(){const{MyPlex:t}=yield Ic({path:"myplex/account",token:e});return t}))},getFilters:function(e,t){return xc(this,void 0,void 0,(function*(){return e===Ri.ByDecade?function(){return xc(this,void 0,void 0,(function*(){const{MediaContainer:{Directory:e}}=yield Ic({path:Cc("decade"),params:{type:kc.Album}}),t=10*Math.floor((new Date).getFullYear()/10);return e.filter((({key:e})=>Number(e)>500&&Number(e)<=t)).map((({key:e,title:t})=>({id:e,title:t})))}))}():function(e){return xc(this,void 0,void 0,(function*(){const t=$c(e),{MediaContainer:{Directory:r}}=yield Ic({path:Cc("genre"),params:{type:t}});return r.map((({key:e,title:t})=>({id:e,title:t})))}))}(t)}))},getMusicLibraries:function(){return xc(this,void 0,void 0,(function*(){const{MediaContainer:{Directory:e}}=yield Ic({path:"/library/sections"});return e.filter((e=>"artist"===e.type)).map((({key:e,title:t})=>({id:e,title:t})))}))},search:function(e){var t=e.params,r=void 0===t?{}:t,{type:n}=r,i=Sc(r,["type"]),a=Sc(e,["params"]);return xc(this,void 0,void 0,(function*(){let e=[],t=[];if(a.host===Ac){const{MediaContainer:{SearchResults:[{SearchResult:e=[]}]}}=yield Ic(Object.assign(Object.assign({},a),{params:i}));t=e}else{const{MediaContainer:{SearchResult:e=[]}}=yield Ic(Object.assign(Object.assign({},a),{params:i}));t=e}return e=t.map((e=>e.Metadata)).filter((e=>e.type===n)),a.host===Ac&&(e=yield Oc(e,Tc)),e}))}},jc=zc;var Lc=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Dc=new O("plexAuth"),Fc="https://plex.tv/api/v2",Rc=new Ne(""),_c=new Ne(!1),Uc=new Ne(!1);let Vc;function Bc(){return Uc.getValue()}function Hc(){return Uc.pipe(Sn())}function Yc(){return Lc(this,void 0,void 0,(function*(){if(!Bc()){Dc.log("connect");try{const{id:e,userToken:t}=yield function(){return Lc(this,void 0,void 0,(function*(){const{id:e,authToken:t}=yield function(){return Lc(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const r=location.hostname,n=("localhost"===r?`http://${r}:${location.port}`:`https://${r}`)+"/auth/plex/callback/";let i=null;const a=r=>{if(/(localhost|ampcast)/.test(r.origin)){if(clearInterval(o),window.removeEventListener("message",a,!1),null==i||i.close(),i=null,r.origin!==location.origin)return void t({message:`Origin ${r.origin} does not match ${location.origin}`});let n=10;const s=()=>Lc(this,void 0,void 0,(function*(){n--;try{const{authToken:r,id:i}=yield jc.fetchJSON({host:Fc,path:`/pins/${Vc.id}`});r?e({id:i,authToken:r}):n?setTimeout(s,200):t("Timeout")}catch(e){t(e)}}));s()}};window.addEventListener("message",a,!1);const s=`clientID=${yc.clientId}&code=${Vc.code}&forwardUrl=${encodeURIComponent(n)}&context%5Bdevice%5D%5Bproduct%5D=ampcast`;i=window.open(`https://app.plex.tv/auth#?${s}`,"Plex","popup");const o=setInterval((()=>{(null==i?void 0:i.closed)&&(clearInterval(o),t({message:"access_denied"}))}),500)}))}))}();yield function(e){return Lc(this,void 0,void 0,(function*(){const t=yc.connection;if(t){if(yield Wc(t,yc.serverToken))return void Dc.log(`Using existing ${t.local?"local":"public"} connection.`);yc.server=null,yc.connection=null}Dc.log("Searching for a connection...");const r=(yield function(){return Lc(this,void 0,void 0,(function*(){return jc.fetchJSON({host:Fc,path:"/resources",params:{includeHttps:"1"},token:e})}))}()).filter((e=>"server"===e.provides));for(const e of r){const t=yield Promise.all([...e.connections.map((t=>Wc(t,e.accessToken)))]),r=t.filter(l);if(r.length){const t=r.find((e=>e.local))||r[0];return yc.server=e,yc.connection=t,void Dc.log(`Using ${t.local?"local":"public"} connection.`)}}throw Error("Could not establish a connection.")}))}(t);const{authToken:r}=yield jc.getAccount(t);return{id:e,userToken:r}}))}();yc.userId=e,Kc(t)}catch(e){Dc.error(e)}}}))}function qc(){return Lc(this,void 0,void 0,(function*(){Dc.log("disconnect"),yc.clear(),Kc(""),_c.next(!1),Uc.next(!1)}))}function Kc(e){yc.userToken=e,Rc.next(e)}function Wc(e,t){return Lc(this,void 0,void 0,(function*(){try{return yield jc.fetch({host:e.uri,path:"/",method:"HEAD",token:t}),e}catch(e){return null}}))}function Gc(){return Lc(this,void 0,void 0,(function*(){try{const e=yield jc.getMusicLibraries();yc.libraries=e}catch(e){Dc.error(e)}}))}function Jc(){return Lc(this,void 0,void 0,(function*(){try{yield jc.fetchJSON({host:Tc,path:"/playlists/all",params:{librarySectionID:"tidal"},headers:{"X-Plex-Container-Size":"1"}}),yc.hasTidal=!0}catch(e){406===e.status?yc.hasTidal=!1:Dc.error(e)}}))}yc.userToken===yc.serverToken&&(Kc(""),yc.serverToken&&yc.userId&&Lc(void 0,void 0,void 0,(function*(){const{authToken:e}=yield jc.getAccount(yc.serverToken);Kc(e)}))),Kc(yc.userToken),Rc.pipe(Sn()).pipe(De((e=>!!e)),wr((()=>Promise.all([Gc(),Jc()]))),Le((()=>Uc.next(!0)))).subscribe(Dc);var Qc=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};class Xc{constructor(e,t,r){var n;this.request=e,this.parent=r,this.pageNumber=1,this.serviceId=(null==t?void 0:t.serviceId)||"plex";const i="plex-tidal"===this.serviceId;let a=null==t?void 0:t.pageSize;a||(a=i?50:(null===(n=yc.connection)||void 0===n?void 0:n.local)?Xc.plexMaxPageSize:200),this.pageSize=Math.min((null==t?void 0:t.maxSize)||1/0,a);const s=Object.assign(Object.assign({},t),{pageSize:this.pageSize});this.pager=i?new mi((()=>this.fetchNext()),s):new va((e=>this.fetch(e)),s)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){return Qc(this,void 0,void 0,(function*(){const t=this.request.path;if(t.endsWith("/search")){const e=(yield jc.search(this.request)).map((e=>this.createMediaObject(e)));return{items:e,total:e.length}}{const r=this.request,{headers:n}=r,i=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(r,["headers"]),a=yield jc.fetchJSON(Object.assign(Object.assign({},i),{headers:Object.assign(Object.assign({},n),{"X-Plex-Container-Size":String(this.pageSize),"X-Plex-Container-Start":String((e-1)*this.pageSize)})})),{MediaContainer:{Metadata:s=[],size:o,totalSize:l}}=a;let c=s;return t.endsWith("/tidal/myMixes")&&(c=c.map(((e,t)=>"playlist"===e.type&&1===e.leafCount?Object.assign(Object.assign({},e),{leafCount:void 0,title:`My Mix ${t+1}`,summary:e.title}):e))),{items:c.map((e=>this.createMediaObject(e))),total:l||o}}}))}fetchNext(){return Qc(this,void 0,void 0,(function*(){const e=yield this.fetch(this.pageNumber);return this.pageNumber++,e}))}createMediaObject(e){switch(e.type){case wc.Clip:return this.createMediaItemFromVideo(e);case wc.Album:return this.createMediaAlbum(e);case wc.Artist:return this.createMediaArtist(e);case wc.Playlist:return this.createMediaPlaylist(e);case wc.Track:return this.createMediaItemFromTrack(e);default:return this.createMediaFolder(e)}}createMediaItemFromTrack(e){var t,r;const[n]=e.Media||[],[i]=(null==n?void 0:n.Part)||[],a=(e.title||"").trim(),s=!!a,o=s?"[Unknown Album]"===e.parentTitle?void 0:e.parentTitle||void 0:void 0,l=this.getFileName(null==i?void 0:i.file)||"[Unknown]";return{src:`${this.serviceId}:audio:${e.ratingKey}`,srcs:null===(t=e.Media)||void 0===t?void 0:t.map((({Part:[e]})=>e.key)),itemType:Ln.Media,mediaType:Fn.Audio,externalUrl:this.getExternalUrl(`/library/metadata/${e.parentRatingKey}`),fileName:l,title:a||l.replace(/\.\w+/,""),addedAt:e.addedAt,artists:s?e.originalTitle?[e.originalTitle]:e.grandparentTitle?[e.grandparentTitle]:void 0:void 0,albumArtist:o&&!e.originalTitle?e.grandparentTitle:void 0,album:o,duration:e.duration/1e3,track:o?e.index:void 0,disc:o&&e.index?e.parentIndex:void 0,inLibrary:this.getInLibrary(e),rating:this.getRating(e),globalRating:e.rating,year:e.year||e.parentYear,playedAt:e.lastViewedAt||0,playCount:e.viewCount,genres:null===(r=e.Genre)||void 0===r?void 0:r.map((e=>e.tag)),thumbnails:this.createThumbnails(e.thumb||e.parentThumb||e.grandparentThumb),unplayable:!i||void 0}}createMediaAlbum(e){var t;return{src:`${this.serviceId}:album:${e.ratingKey}`,itemType:Ln.Album,externalUrl:this.getExternalUrl(`/library/metadata/${e.ratingKey}`),title:e.title||"",description:e.summary,addedAt:e.addedAt,artist:e.parentTitle,inLibrary:this.getInLibrary(e),rating:this.getRating(e),globalRating:e.rating,year:e.year,playedAt:e.lastViewedAt,playCount:e.viewCount,genres:null===(t=e.Genre)||void 0===t?void 0:t.map((e=>e.tag)),pager:this.createPager({path:e.key}),thumbnails:this.createThumbnails(e.thumb||e.parentThumb)}}createMediaArtist(e){var t,r;return{src:`${this.serviceId}:artist:${e.ratingKey}`,itemType:Ln.Artist,externalUrl:this.getExternalUrl(`/library/metadata/${e.ratingKey}`),title:e.title,description:e.summary,country:null===(t=e.Country)||void 0===t?void 0:t.map((e=>e.tag)).join(", "),addedAt:e.addedAt,inLibrary:this.getInLibrary(e),rating:this.getRating(e),globalRating:e.rating,genres:null===(r=e.Genre)||void 0===r?void 0:r.map((e=>e.tag)),pager:this.createArtistAlbumsPager(e),thumbnails:this.createThumbnails(e.thumb)}}createMediaItemFromVideo(e){var t,r;const[n]=e.Media||[],[i]=(null==n?void 0:n.Part)||[];return{src:`${this.serviceId}:video:${e.ratingKey}`,srcs:null===(t=e.Media)||void 0===t?void 0:t.map((({Part:[e]})=>e.key)),itemType:Ln.Media,mediaType:Fn.Video,externalUrl:e.art?this.getExternalUrl(e.art.replace(/\/art\/\d+$/,"")):"",fileName:this.getFileName(null==i?void 0:i.file),title:e.title||"Video",addedAt:e.addedAt,artists:e.grandparentTitle?[e.grandparentTitle]:void 0,duration:e.duration/1e3,playedAt:e.lastViewedAt||0,playCount:e.viewCount,genres:null===(r=e.Genre)||void 0===r?void 0:r.map((e=>e.tag)),inLibrary:this.getInLibrary(e),thumbnails:this.createThumbnails(e.thumb),unplayable:!i||void 0}}createMediaPlaylist(e){const t=`${this.serviceId}:playlist:${e.ratingKey}`;return{src:t,itemType:Ln.Playlist,externalUrl:this.getExternalUrl(`/playlists/${e.ratingKey}`,"playlist"),title:e.title,description:e.summary,addedAt:e.addedAt,duration:e.duration/1e3,playedAt:e.lastViewedAt,playCount:e.viewCount,trackCount:e.leafCount,pager:this.createPager({path:e.key}),thumbnails:this.createThumbnails(e.thumb||e.composite),isPinned:gi.isPinned(t)}}createMediaFolder(e){var t;const r={itemType:Ln.Folder,src:`${this.serviceId}:folder:${e.key}`,title:e.title,fileName:e.title,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===Ln.Folder?`${this.parent.path}/${e.title}`:"/",parent:this.parent};return r.pager=this.createFolderPager(r),r}get webHost(){var e;const t="https://app.plex.tv/desktop/#!";if("plex-tidal"===this.serviceId)return`${t}/provider/tv.plex.provider.music`;{const r=null===(e=yc.server)||void 0===e?void 0:e.clientIdentifier;return r?`${t}/server/${r}`:""}}getExternalUrl(e,t="details"){const r=this.webHost;return r?`${r}/${t}?key=${encodeURIComponent(e)}`:""}getFileName(e=""){return e.split(/[/\\]/).pop()}getInLibrary(e){return"plex-tidal"===this.serviceId?e.saved:void 0}getRating(e){return"plex"===this.serviceId?Math.round((e.userRating||0)/2):void 0}createThumbnails(e){return e?[this.createThumbnail(e,120),this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480)]:void 0}createThumbnail(e,t,r=t){return{url:`${yc.host}/photo/:/transcode?url=${encodeURIComponent(e)}&width=${t}&height=${r}&minSize=1&upscale=1&X-Plex-Token={plex-token}`,width:t,height:r}}createFolderPager(e){var t;const[,,r]=e.src.split(":"),n=this.createPager({path:r},{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Ln.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new Un([e]);return new fi(t,n)}return n}createArtistAlbumsPager(e){const t=this.createPager({path:e.key});if("plex"===this.serviceId){const r=this.createArtistOtherTracks(e),n=new Un([r]);return new fi(void 0,t,n)}{const r=this.createArtistTopTracks(e),n=new Un([r]);return new fi(n,t)}}createArtistOtherTracks(e){return{itemType:Ln.Album,src:`${this.serviceId}:other-tracks:${e.ratingKey}`,title:"Other Tracks",artist:e.title,thumbnails:this.createThumbnails(e.thumb),pager:this.createOtherTracksPager(e),synthetic:!0}}createArtistTopTracks(e){return{itemType:Ln.Album,src:`${this.serviceId}:top-tracks:${e.ratingKey}`,title:"Top Tracks",artist:e.title,thumbnails:this.createThumbnails(e.thumb),pager:this.createTopTracksPager(e),synthetic:!0}}createOtherTracksPager(e){return this.createPager({params:{originalTitle:e.title,type:kc.Track}})}createTopTracksPager(e){return this.createPager({path:`/library/metadata/${e.ratingKey}/popular`},{maxSize:10})}createPager(e,t,r){return new Xc(Object.assign(Object.assign(Object.assign(Object.assign({},this.request),{params:void 0}),e),{host:"plex-tidal"===this.serviceId?Tc:e.host}),Object.assign(Object.assign({},t),{serviceId:this.serviceId}),r)}}Xc.minPageSize=10,Xc.plexMaxPageSize=1e3,Xc.tidalMaxPageSize=100;const Zc=Xc;var eu=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const tu={view:"card compact",fields:["Thumbnail","Title","Artist","Year","Rate"]},ru={view:"details",fields:["AlbumTrack","Artist","Title","Duration","PlayCount","Rate"]},nu={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","PlayCount","Rate"]},iu={id:"plex/recently-played",title:"Recently Played",icon:"clock",itemType:Ln.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>new Zc({path:Cc(),params:{type:kc.Track,"lastViewedAt>":"0",sort:"lastViewedAt:desc"}})},au={id:"plex/most-played",title:"Most Played",icon:"most-played",itemType:Ln.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Rate"]},search:()=>new Zc({path:Cc(),params:{type:kc.Track,"viewCount>":"1",sort:"viewCount:desc,lastViewedAt:desc"}})},su={id:"plex/top-tracks",title:"Top Tracks",icon:"star",itemType:Ln.Media,lockActionsStore:!0,layout:{view:"details",fields:["Rate","Artist","Title","Album","Track","Duration","PlayCount"]},search:()=>new Zc({path:Cc(),params:{type:kc.Track,"track.userRating>":"1",sort:"track.userRating:desc,viewCount:desc,lastViewedAt:desc"}})},ou={id:"plex/top-albums",title:"Top Albums",icon:"star",itemType:Ln.Album,lockActionsStore:!0,layout:tu,secondaryLayout:ru,search:()=>new Zc({path:Cc(),params:{type:kc.Album,"album.userRating>":"1",sort:"album.userRating:desc,viewCount:desc,lastViewedAt:desc"}})},lu={id:"plex/top-artists",title:"Top Artists",icon:"star",itemType:Ln.Artist,lockActionsStore:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Title","Genre","Rate"]},tertiaryLayout:ru,search:()=>new Zc({path:Cc(),params:{type:kc.Artist,"artist.userRating>":"1",sort:"artist.userRating:desc,viewCount:desc,lastViewedAt:desc"}})},cu={id:"plex/playlists",title:"Playlists",icon:"playlist",itemType:Ln.Playlist,secondaryLayout:nu,search:()=>(Mc(),new Zc({path:"/playlists/all",params:{type:kc.Playlist,playlistType:"audio"}}))},uu={id:"plex/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:Ln.Album,viewType:Ri.ByGenre,search:e=>e?new Zc({path:Cc(),params:{genre:e.id,type:kc.Album}}):new Un},du={id:"plex/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:Ln.Artist,viewType:Ri.ByGenre,defaultHidden:!0,search:e=>e?new Zc({path:Cc(),params:{genre:e.id,type:kc.Artist}}):new Un},mu={id:"plex/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:Ln.Album,viewType:Ri.ByDecade,search:e=>e?new Zc({path:Cc(),params:{decade:e.id,type:kc.Album}}):new Un},hu={id:"plex/random-tracks",title:"Random Tracks",icon:"shuffle",itemType:Ln.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>new Zc({path:Cc(),params:{type:kc.Track,sort:"random"}},{maxSize:100})},fu={id:"plex/random-albums",title:"Random Albums",icon:"shuffle",itemType:Ln.Album,layout:tu,secondaryLayout:ru,search:()=>new Zc({path:Cc(),params:{type:kc.Album,sort:"random"}},{maxSize:100})},pu={id:"plex/videos",title:"Music Videos",icon:"video",itemType:Ln.Media,mediaType:Fn.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search:({q:e=""}={})=>new Zc({path:Cc("extras/all"),params:{title:e,type:kc.Artist,extraType:kc.Episode}})},bu={id:"plex/folders",title:"Folders",icon:"folder",itemType:Ln.Folder,viewType:Ri.Folders,search(){const e={itemType:Ln.Folder,src:"plex:folder:",title:"Folders",fileName:"",path:""};return e.pager=new Hi((()=>yc.libraries.map((({id:t,title:r})=>{const n={itemType:Ln.Folder,src:`plex:folder:/library/sections/${t}/folder`,title:r,fileName:r,path:`/${r}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new Un([i]),s=new Zc({path:`library/sections/${t}/folder`,params:{includeCollections:"1"}},void 0,n);return n.pager=new fi(a,s),n})))),e.pager}},vu={id:"plex",name:"Plex",icon:"plex",url:"https://www.plex.tv",serviceType:vn.PersonalMedia,defaultHidden:!0,roots:[wu(Ln.Media,{title:"Tracks",layout:{view:"details",fields:["Artist","Title","Album","Track","Duration","PlayCount","Rate"]}}),wu(Ln.Album,{title:"Albums"}),wu(Ln.Artist,{title:"Artists"}),wu(Ln.Playlist,{title:"Playlists",secondaryLayout:nu})],sources:[su,ou,lu,au,iu,cu,uu,du,mu,hu,fu,pu,bu],get audioLibraries(){return yc.audioLibraries},get libraryId(){return yc.libraryId},set libraryId(e){yc.libraryId=e},get libraries(){return yc.libraries},set libraries(e){yc.libraries=e},observeLibraryId:()=>yc.observeLibraryId(),canRate:gu,canStore:()=>!1,compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:Ln.Playlist,id:e.src,icon:"pin",isPin:!0,search:()=>new Zc({path:`/playlists/${Eu(e)}`,params:{type:kc.Playlist,playlistType:"audio"}})}},getFilters:function(e,t){return eu(this,void 0,void 0,(function*(){return jc.getFilters(e,t)}))},getMetadata:function(e){return eu(this,void 0,void 0,(function*(){if(!gu(e)||void 0!==e.rating)return e;const t=Nn.getRating(e);if(void 0!==t)return Object.assign(Object.assign({},e),{rating:t});const r=Eu(e),n=e.itemType===Ln.Playlist?`/playlists/${r}`:`/library/metadata/${r}`,i=new Zc({path:n},{maxSize:1}),a=yield _n(i,{timeout:2e3});return k(e,a[0])}))},getPlayableUrl:function(e){const{host:t,serverToken:r}=yc;if(t&&r){const[n]=e.srcs||[];if(!n)throw Error("No playable source");return`${t}${n}?X-Plex-Token=${r}`}throw Error("Not logged in")},getThumbnailUrl:function(e){return e.replace("{plex-token}",yc.serverToken)},lookup:function(e,t,r=10,n){return eu(this,void 0,void 0,(function*(){return e&&t?_n(new Zc({path:"/library/search",params:{query:`${e} ${t}`,searchTypes:"music",limit:50,type:wc.Track}},{maxSize:r,lookup:!0}),{timeout:n}):[]}))},rate:function(e,t){return eu(this,void 0,void 0,(function*(){yield jc.fetch({path:"/:/rate",method:"PUT",params:{key:Eu(e),identifier:"com.plexapp.plugins.library",rating:2*t||-1}})}))},observeIsLoggedIn:Hc,isLoggedIn:Bc,login:Yc,logout:qc},yu=vu;function gu(e,t){if(t)return!1;switch(e.itemType){case Ln.Album:return!e.synthetic;case Ln.Artist:return!0;case Ln.Media:return e.mediaType===Fn.Audio;default:return!1}}function wu(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`plex/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>function(e,t,r,n){Mc();const i=e===Ln.Playlist?"/playlists/all":Cc(),a=Object.assign({},void 0);return t&&(a.title=t.trim()),a.type=$c(e),e===Ln.Playlist&&(a.playlistType="audio"),new Zc({path:i,params:a},void 0)}(e,t)})}function Eu({src:e}){const[,,t]=e.split(":");return t}var ku=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const xu="plex-tidal",Su={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},Tu={view:"card compact",fields:["Thumbnail","Title","TrackCount","Blurb"]},Au={view:"details",fields:["Index","Artist","Title","Album","Track","Duration"]},Iu={id:`${xu}/library-tracks`,title:"My Tracks",icon:"heart",itemType:Ln.Media,lockActionsStore:!0,layout:Su,search:()=>Fu(kc.Track)},Pu={id:`${xu}/library-albums`,title:"My Albums",icon:"heart",itemType:Ln.Album,lockActionsStore:!0,search:()=>Fu(kc.Album)},Cu={id:`${xu}/library-artists`,title:"My Artists",icon:"heart",itemType:Ln.Artist,lockActionsStore:!0,search:()=>Fu(kc.Artist)},Mu={id:`${xu}/library-playlists`,title:"My Playlists",icon:"heart",itemType:Ln.Playlist,lockActionsStore:!0,layout:Tu,secondaryLayout:Au,search:()=>(Vu(),_u("/playlists/all"))},Ou={id:"tidal/my-mixes",title:"Recommended",icon:"playlist",itemType:Ln.Playlist,layout:Tu,secondaryLayout:Au,search:()=>(Vu(),_u("/hubs/sections/tidal/myMixes"))},Nu={id:"tidal/plex-picks",title:"Plex Picks",icon:"album",itemType:Ln.Album,defaultHidden:!0,search:()=>_u("/hubs/sections/tidal/plexPicks")},$u={id:"tidal/new-playlists",title:"New Playlists",icon:"playlist",itemType:Ln.Playlist,defaultHidden:!0,layout:Tu,secondaryLayout:Au,search:()=>_u("/hubs/sections/tidal/newPlaylists")},zu={id:xu,name:"TIDAL",icon:xu,url:"https://tidal.com/",serviceType:vn.PublicMedia,authServiceId:"plex",defaultHidden:mn(yu),roots:[Du(Ln.Media,{title:"Tracks",layout:Su}),Du(Ln.Album,{title:"Albums"}),Du(Ln.Artist,{title:"Artists"})],sources:[Iu,Pu,Cu,Mu,Ou,$u,Nu],icons:{[zn.AddToLibrary]:"heart",[zn.RemoveFromLibrary]:"heart-fill"},labels:{[zn.AddToLibrary]:"Add to My TIDAL",[zn.RemoveFromLibrary]:"Remove from My TIDAL"},canRate:()=>!1,canStore:Lu,compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:Ln.Playlist,layout:Tu,id:e.src,icon:"pin",isPin:!0,search:()=>_u(`/playlists/${Uu(e)}`,{type:kc.Playlist,playlistType:"audio"})}},getMetadata:function(e){return ku(this,void 0,void 0,(function*(){const t=e.itemType;if(t===Ln.Album||t===Ln.Artist||t===Ln.Playlist||Lu(e)&&void 0===e.inLibrary){const r=yield function(e,t){return ku(this,void 0,void 0,(function*(){const r=_u(e===Ln.Playlist?`/playlists/${t}`:`/library/metadata/${t}`,void 0,{maxSize:1});return(yield _n(r,{timeout:2e3}))[0]}))}(t,Uu(e));return k(e,r)}return e}))},getPlayableUrl:function(e){const{userToken:t}=yc;if(t){const r=e.srcs||[];let n=r[0];switch(yc.streamingQuality){case pc.Lossless:n=r[0];break;case pc.High:n=r[1];break;case pc.Low:n=r[2]}if(n||(n=r[0]),!n)throw Error("No playable source");return`${Tc}${n}?X-Plex-Token=${t}`}throw Error("Not logged in")},getThumbnailUrl:function(e){return yu.getThumbnailUrl(e)},lookup:function(e,t,r=10,n){return ku(this,void 0,void 0,(function*(){return yc.hasTidal&&e&&t?_n(Ru(wc.Track,`${e} ${t}`,50,{lookup:!0,maxSize:r}),{timeout:n}):[]}))},store:function(e,t){return ku(this,void 0,void 0,(function*(){yield jc.fetch({host:Tc,path:"/actions/"+(t?"save":"unsave"),method:"PUT",params:{ratingKey:Uu(e)}})}))},observeIsLoggedIn:Hc,isLoggedIn:Bc,login:Yc,logout:qc},ju=zu;function Lu(e){switch(e.itemType){case Ln.Album:return!e.synthetic;case Ln.Artist:case Ln.Media:return!0;default:return!1}}function Du(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`${xu}/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>(t=t.trim())?Ru(function(e,t){switch(e){case Ln.Album:return wc.Album;case Ln.Artist:return wc.Artist;case Ln.Playlist:return wc.Playlist;default:return void 0===Fn.Video?wc.Clip:wc.Track}}(e),t):new Un})}function Fu(e){return Vu(),_u("/library/sections/saved/all",{type:e})}function Ru(e,t,r=100,n){return new Zc({host:Ac,path:"/library/search",params:{query:t,limit:r,type:e,searchTypes:"music"}},Object.assign(Object.assign({},n),{serviceId:xu}))}function _u(e,t,r){return new Zc({host:Tc,path:e,params:t},Object.assign(Object.assign({},r),{serviceId:xu}))}function Uu({src:e}){const[,,t]=e.split(":");return t}function Vu(){if(!yc.hasTidal)throw new Bi}var Bu=r(5754);const Hu=new(r.n(Bu)()),Yu=new D("spotify/auth"),qu=new D("spotify/user","memory");var Ku=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Wu=new O("spotifyAuth"),Gu=location.hostname,Ju=("localhost"===Gu?`http://${Gu}:${location.port}`:`https://${Gu}`)+"/auth/spotify/callback/",Qu="https://accounts.spotify.com";let Xu;const Zu=new Ne("");function ed(){return Zu.pipe(Sn())}function td(){return""!==Zu.getValue()}function rd(){return Ku(this,void 0,void 0,(function*(){Wu.log("refreshToken");const e=id(),t=null==e?void 0:e.refresh_token;if(t){const e=yield fetch(`${Qu}/api/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:Yn,grant_type:"refresh_token",refresh_token:t})});if(!e.ok)throw yield sd(),e;const r=yield e.json();return yield nd(r),r.access_token}throw yield sd(),Error("No 'refresh_token'")}))}function nd(e){return Ku(this,void 0,void 0,(function*(){try{const{access_token:t,refresh_token:r}=e;Yu.setJson("token",{access_token:t,refresh_token:r}),Hu.setAccessToken(e.access_token),yield od(),ad(t)}catch(e){Wu.error(e),yield sd()}}))}function id(){return Yu.getJson("token")}function ad(e){Zu.next(e)}function sd(){return Ku(this,void 0,void 0,(function*(){Yu.removeItem("token"),qu.clear(),yield function(){return Ku(this,void 0,void 0,(function*(){const e=function(e){let t="";for(let e=0;e<64;e++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return t}();Yu.setString("code_verifier",e),Xu=yield function(e){return Ku(this,void 0,void 0,(function*(){const t=yield crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}))}(e)}))}(),Zu.next("")}))}function od(){return Ku(this,void 0,void 0,(function*(){if(!qu.getString("userId")){const e=yield Hu.getMe();qu.setString("userId",e.id),qu.setString("market",e.country)}}))}Ku(void 0,void 0,void 0,(function*(){try{const e=id();if(e){try{Hu.setAccessToken(e.access_token),yield od(),ad(e.access_token)}catch(e){if(401!==e.status)throw e;yield rd()}return}}catch(e){Wu.error(e)}yield sd()}));var ld=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const cd=new O("SpotifyPager");class ud{constructor(e,t,r){this.defaultConfig={minPageSize:ud.minPageSize,maxPageSize:ud.maxPageSize,pageSize:ud.maxPageSize},this.pageNumber=1,this.config=Object.assign(Object.assign({},this.defaultConfig),t),this.pager=new mi(((t=this.defaultConfig.pageSize)=>ld(this,void 0,void 0,(function*(){var n;const i=(this.pageNumber-1)*t,a=()=>ld(this,void 0,void 0,(function*(){const{items:n,total:a,next:s}=yield e(i,t);return this.pageNumber++,{items:n.map((e=>this.createMediaObject(e,r))),total:a,atEnd:!s}}));try{return yield a()}catch(e){if(401===e.status)return yield rd(),yield a();if(429===e.status){const t=Number(null===(n=e.headers)||void 0===n?void 0:n.get("Retry-After"));if(t&&t<=10)return yield I(1e3*t),yield a();throw e}throw e}}))),this.config)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new ae,this.config.lookup||this.subscriptions.add(this.pager.observeAdditions().pipe(wr((e=>this.addInLibrary(e)))).subscribe(cd)))}createMediaObject(e,t){switch(e.type){case"episode":return this.createMediaItemFromEpisode(e);case"artist":return this.createMediaArtist(e);case"album":return this.createMediaAlbum(e,t);case"playlist":return this.createMediaPlaylist(e,t);case"track":return this.createMediaItemFromTrack(e,t)}}createMediaItemFromEpisode(e){return{itemType:Ln.Media,mediaType:Fn.Audio,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,duration:e.duration_ms/1e3,thumbnails:e.images,unplayable:!1===e.is_playable,playedAt:e.played_at?Math.floor((new Date(e.played_at).getTime()||0)/1e3):0}}createMediaAlbum(e,t){var r;return{itemType:Ln.Album,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,artist:e.artists.map((e=>e.name)).join(", "),year:new Date(e.release_date).getFullYear(),thumbnails:e.images,trackCount:null===(r=e.tracks)||void 0===r?void 0:r.total,pager:this.createAlbumPager(e),inLibrary:t}}createMediaArtist(e){return{itemType:Ln.Artist,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,genres:e.genres,thumbnails:e.images,pager:this.createArtistAlbumsPager(e)}}createArtistTopTracks(e){return{itemType:Ln.Album,src:`spotify:top-tracks:${e.id}`,title:"Top Tracks",artist:e.name,thumbnails:e.images,pager:this.createTopTracksPager(e),synthetic:!0}}createMediaPlaylist(e,t){const r=e.owner.id===qu.getString("userId");return{itemType:Ln.Playlist,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,description:e.description?A(e.description):void 0,thumbnails:e.images,trackCount:e.tracks.total,pager:this.createPlaylistPager(e),owner:{name:e.owner.display_name||"",url:e.owner.external_urls.spotify},isPinned:gi.isPinned(e.uri),isOwn:r,inLibrary:!r&&t}}createMediaItemFromTrack(e,t){var r,n,i,a,s;const o=/album|compilation/i.test((null===(r=e.album)||void 0===r?void 0:r.album_type)||"")?e.album:void 0;return{itemType:Ln.Media,mediaType:Fn.Audio,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,artists:null===(n=e.artists)||void 0===n?void 0:n.map((e=>e.name)),albumArtist:null==o?void 0:o.artists.map((e=>e.name)).join(", "),album:null==o?void 0:o.name,duration:e.duration_ms/1e3,playedAt:e.played_at?Math.floor((new Date(e.played_at).getTime()||0)/1e3):0,genres:null===(i=e.album)||void 0===i?void 0:i.genres,disc:e.disc_number,track:e.track_number,year:e.album&&new Date(e.album.release_date).getUTCFullYear()||void 0,isrc:null===(a=e.external_ids)||void 0===a?void 0:a.isrc,thumbnails:null===(s=e.album)||void 0===s?void 0:s.images,unplayable:!1===e.is_playable,inLibrary:t}}createArtistAlbumsPager(e){const t=this.getMarket(),r=this.createArtistTopTracks(e),n=new Un([r]),i=new ud(((r,n)=>ld(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield Hu.getArtistAlbums(e.id,{offset:r,limit:n,market:t,include_groups:"album,compilation,single"});return{items:i,total:a,next:s}}))));return new fi(n,i)}createTopTracksPager(e){const t=this.getMarket();return new ud(((r,n)=>ld(this,void 0,void 0,(function*(){const{tracks:i}=yield Hu.getArtistTopTracks(e.id,t,{offset:r,limit:n,market:t});return{items:i,next:""}}))),{pageSize:10,maxSize:10})}createAlbumPager(e){var t;const r=null===(t=e.tracks)||void 0===t?void 0:t.items;if(r&&r.length===e.total_tracks)return new Hi((()=>{const t=r.map((t=>this.createMediaItemFromTrack(Object.assign(Object.assign({},t),{album:e}))));return this.addInLibrary(t),t}));{const t=this.getMarket();return new ud(((r,n)=>ld(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield Hu.getAlbumTracks(e.id,{offset:r,limit:n,market:t});return{items:i.map((t=>Object.assign(Object.assign({},t),{album:e}))),total:a,next:s}}))))}}createPlaylistPager(e){var t;const r=null===(t=e.tracks)||void 0===t?void 0:t.items;if(r&&r.length===e.tracks.total)return new Hi((()=>{const e=r.filter((e=>!!e.track)).map((e=>this.createMediaItemFromTrack(e.track)));return this.addInLibrary(e),e}));{const t=this.getMarket();return new ud(((r,n)=>ld(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield Hu.getPlaylistTracks(e.id,{offset:r,limit:n,market:t});return{items:i.map((e=>e.track)).filter(l),total:a,next:s}}))))}}getMarket(){return qu.getString("market")}addInLibrary(e){return ld(this,void 0,void 0,(function*(){const t=e[0];if(t){const r=e.filter((e=>void 0===e.inLibrary&&xd.canStore(e,!0))).map((e=>{const[,,t]=e.src.split(":");return t}));if(0===r.length)return;let n=[];n=t.itemType===Ln.Album?yield Hu.containsMySavedAlbums(r):yield Hu.containsMySavedTracks(r),Cn.dispatch(e.map((({src:e},t)=>({match:t=>t.src===e,values:{inLibrary:n[t]}}))))}}))}}ud.minPageSize=10,ud.maxPageSize=50;const dd=ud;var md=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const hd={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},fd={view:"details",fields:["Index","Artist","Title","Album","Track","Duration"]},pd={id:"spotify/recently-played",title:"Recently Played",icon:"clock",itemType:Ln.Media,defaultHidden:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search(){return new dd(((e,t)=>md(this,void 0,void 0,(function*(){const{items:e,total:r}=yield Hu.getMyRecentlyPlayedTracks({limit:t});return{items:e.map((e=>Object.assign({played_at:e.played_at},e.track))),total:r,next:void 0}}))),{maxSize:50,pageSize:50})}},bd={id:"spotify/top-tracks",title:"Top Tracks",icon:"star",itemType:Ln.Media,layout:hd,search(){return new dd(((e,t)=>md(this,void 0,void 0,(function*(){return Hu.getMyTopTracks({offset:e,limit:t})}))))}},vd={id:"spotify/top-artists",title:"Top Artists",icon:"star",itemType:Ln.Artist,search(){return new dd(((e,t)=>md(this,void 0,void 0,(function*(){return Hu.getMyTopArtists({offset:e,limit:t})}))))}},yd={id:"spotify/liked-songs",title:"My Songs",icon:"heart",itemType:Ln.Media,lockActionsStore:!0,layout:hd,search(){const e=Pd();return new dd(((t,r)=>md(this,void 0,void 0,(function*(){const{items:n,total:i,next:a}=yield Hu.getMySavedTracks({offset:t,limit:r,market:e});return{items:n.map((e=>e.track)),total:i,next:a}}))),void 0,!0)}},gd={id:"spotify/liked-albums",title:"My Albums",icon:"heart",itemType:Ln.Album,lockActionsStore:!0,search(){const e=Pd();return new dd(((t,r)=>md(this,void 0,void 0,(function*(){const{items:n,total:i,next:a}=yield Hu.getMySavedAlbums({offset:t,limit:r,market:e});return{items:n.map((e=>e.album)),total:i,next:a}}))),{calculatePageSize:!0},!0)}},wd={id:"spotify/playlists",title:"My Playlists",icon:"heart",itemType:Ln.Playlist,lockActionsStore:!0,secondaryLayout:fd,search(){const e=Pd();return new dd(((t,r)=>md(this,void 0,void 0,(function*(){const{items:n,total:i,next:a}=yield Hu.getUserPlaylists(void 0,{offset:t,limit:r,market:e});return{items:n,total:i,next:a}}))),void 0,!0)}},Ed={id:"spotify/featured-playlists",title:"Recommended",icon:"playlist",itemType:Ln.Playlist,secondaryLayout:fd,search(){const e=Pd();return new dd(((t,r)=>md(this,void 0,void 0,(function*(){const{playlists:{items:n,total:i,next:a}}=yield Hu.getFeaturedPlaylists({offset:t,limit:r,market:e});return{items:n,total:i,next:a}}))))}},kd={id:"spotify",name:"Spotify",icon:"spotify",url:"https://www.spotify.com",serviceType:vn.PublicMedia,defaultHidden:!0,roots:[Ad(Ln.Media,{title:"Songs",layout:hd}),Ad(Ln.Album,{title:"Albums"}),Ad(Ln.Artist,{title:"Artists"}),Ad(Ln.Playlist,{title:"Playlists",secondaryLayout:fd})],sources:[yd,gd,wd,pd,bd,vd,Ed],icons:{[zn.AddToLibrary]:"heart",[zn.RemoveFromLibrary]:"heart-fill"},labels:{[zn.AddToLibrary]:"Add to Spotify Library",[zn.RemoveFromLibrary]:"Remove from Spotify Library"},canRate:()=>!1,canStore:Sd,compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:Ln.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":"),r=Pd();return new dd((()=>md(this,void 0,void 0,(function*(){return{items:[yield Hu.getPlaylist(t,{market:r,fields:"id,type,external_urls,name,description,images,owner,uri,tracks.total"})],total:1}}))))}}},getMetadata:function(e){return md(this,void 0,void 0,(function*(){if(!Sd(e)||void 0!==e.inLibrary)return e;const t=Nn.getInLibrary(e);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const[,,r]=e.src.split(":");switch(e.itemType){case Ln.Album:{const[t]=yield Hu.containsMySavedAlbums([r]);return Object.assign(Object.assign({},e),{inLibrary:t})}case Ln.Media:{const[t]=yield Hu.containsMySavedTracks([r]);return Object.assign(Object.assign({},e),{inLibrary:t})}case Ln.Playlist:{const[t]=yield Hu.areFollowingPlaylist(r,[qu.getString("userId")]);return Object.assign(Object.assign({},e),{inLibrary:t})}default:return e}}))},lookup:function(e,t,r=10,n){return md(this,void 0,void 0,(function*(){if(!e||!t)return[];const i=e=>e.replace(/['"]/g," "),a={pageSize:r,maxSize:r,lookup:!0};return _n(Id(Ln.Media,`${i(e)} ${i(t)}`,a),{timeout:n})}))},store:function(e,t){return md(this,void 0,void 0,(function*(){return Td([e],t)}))},bulkStore:function(e,t){return md(this,void 0,void 0,(function*(){const r=e[0];if(!r)return;let n=0;switch(r.itemType){case Ln.Media:n=500;break;case Ln.Album:n=200;break;case Ln.Playlist:n=10}if(0===n)return;const i=u(e,n);for(const e of i)yield Td(e,t)}))},observeIsLoggedIn:function(){return ed().pipe(yr((e=>""!==e)),Sn())},isLoggedIn:td,login:function(){return Ku(this,void 0,void 0,(function*(){if(!td()){Wu.log("connect");try{const e=yield function(){return Ku(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{let r=null;const n=i=>{if(/(localhost|ampcast)/.test(i.origin)){if(clearInterval(a),window.removeEventListener("message",n,!1),null==r||r.close(),r=null,i.origin!==location.origin)return void t({message:`Origin ${i.origin} does not match ${location.origin}`});(function(e){return Ku(this,void 0,void 0,(function*(){const t=Yu.getString("code_verifier"),r=yield fetch(`${Qu}/api/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:Yn,grant_type:"authorization_code",code:e,redirect_uri:Ju,code_verifier:t})});if(!r.ok)throw r;return yield r.json()}))})(i.data.code).then(e,t)}};window.addEventListener("message",n,!1);const i=new URLSearchParams({client_id:Yn,scope:["user-read-recently-played","user-read-playback-position","user-top-read","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","streaming","user-read-email","user-read-private","playlist-read-private","playlist-modify-private","playlist-modify-public","user-library-read","user-library-modify"].join(" "),redirect_uri:Ju,response_type:"code",code_challenge_method:"S256",code_challenge:Xu});r=window.open(`${Qu}/authorize?${i}`,"Spotify","popup");const a=setInterval((()=>{(null==r?void 0:r.closed)&&(clearInterval(a),t({message:"access_denied"}))}),500)}))}))}();yield nd(e)}catch(e){Wu.error(e)}}}))},logout:function(){return Ku(this,void 0,void 0,(function*(){Wu.log("disconnect"),yield sd()}))}},xd=kd;function Sd(e,t){switch(e.itemType){case Ln.Album:return!e.synthetic;case Ln.Media:return!0;case Ln.Playlist:return!e.isOwn&&!t;default:return!1}}function Td(e,t){return md(this,void 0,void 0,(function*(){const r=e[0];if(!r)return;const n=e.map((e=>{const[,,t]=e.src.split(":");return t})),i=()=>md(this,void 0,void 0,(function*(){switch(r.itemType){case Ln.Album:t?yield Promise.all(u(n,20).map((e=>Hu.addToMySavedAlbums(e)))):yield Promise.all(u(n,20).map((e=>Hu.removeFromMySavedAlbums(e))));break;case Ln.Media:t?yield Promise.all(u(n,50).map((e=>Hu.addToMySavedTracks(e)))):yield Promise.all(u(n,50).map((e=>Hu.removeFromMySavedTracks(e))));break;case Ln.Playlist:t?yield Promise.all(n.map((e=>Hu.followPlaylist(e)))):yield Promise.all(n.map((e=>Hu.unfollowPlaylist(e))))}}));try{yield i()}catch(e){if(401!==e.status)throw e;yield rd(),yield i()}}))}function Ad(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`spotify/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>Id(e,t)})}function Id(e,t,r){return t?new dd(function(e,t){const r=Pd();switch(e){case Ln.Media:return(e,n)=>md(this,void 0,void 0,(function*(){const{tracks:{items:i,total:a,next:s}}=yield Hu.searchTracks(t,{offset:e,limit:n,market:r});return{items:i,total:a,next:s}}));case Ln.Album:return(e,n)=>md(this,void 0,void 0,(function*(){const{albums:{items:i,total:a,next:s}}=yield Hu.searchAlbums(t,{offset:e,limit:n,market:r});return{items:i,total:a,next:s}}));case Ln.Artist:return(e,n)=>md(this,void 0,void 0,(function*(){const{artists:{items:i,total:a,next:s}}=yield Hu.searchArtists(t,{offset:e,limit:n,market:r});return{items:i,total:a,next:s}}));case Ln.Playlist:return(e,n)=>md(this,void 0,void 0,(function*(){const{playlists:{items:i,total:a,next:s}}=yield Hu.searchPlaylists(t,{offset:e,limit:n,market:r});return{items:i,total:a,next:s}}));default:throw TypeError("Search not supported for this type of media")}}(e,t),Object.assign({maxSize:250},r)):new Un}function Pd(){return qu.getString("market")}function Cd(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Mr(e);return $e((function(t,n){for(var i=e.length,a=new Array(i),s=e.map((function(){return!1})),o=!1,l=function(t){br(e[t]).subscribe(ze(n,(function(e){a[t]=e,o||s[t]||(s[t]=!0,(o=s.every(Ae))&&(s=null))}),me))},c=0;c<i;c++)l(c);t.subscribe(ze(n,(function(e){if(o){var t=Z([e],X(a));n.next(r?r.apply(void 0,Z([],X(t))):t)}})))}))}function Md(e){return De((function(t,r){return e<=r}))}function Od(e,t){return t?function(r){return Lr(t.pipe(Rn(1),$e((function(e,t){e.subscribe(ze(t,me))}))),r.pipe(Od(e)))}:wr((function(t,r){return br(e(t,r)).pipe(Rn(1),function(e){return yr((function(){return e}))}(t))}))}function Nd(e,t){void 0===t&&(t=tr);var r=ir(e,t);return Od((function(){return r}))}var $d,zd,jd,Ld=re((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}})),Dd=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Fd=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},Rd=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};const _d=new O("SpotifyPlayer"),Ud="Spotify player not connected",Vd=(e,t)=>e.paused===t.paused&&e.position===t.position;$d=new WeakMap,zd=new WeakMap,jd=new WeakMap;const Bd=new class{constructor(e){this.accessToken$=e,this.player=null,this.paused$=new Ne(!0),this.src$=new Ne(""),this.currentTrackSrc$=new Ne(""),this.error$=new Me,this.playerReady$=new Ne(!1),this.playerStarted$=new Ne(!1),this.state$=new Ne(null),this.loadedSrc="",this.isLoggedIn=!1,this.deviceId="",this.hidden=!0,this.loop=!1,$d.set(this,!1),zd.set(this,!0),jd.set(this,1),this.onSpotifyWebPlaybackSDKReady=()=>{_d.log("onSpotifyWebPlaybackSDKReady"),this.observeAccessToken().pipe(De((e=>""!==e)),wr((e=>this.connect(e))),Le((()=>this.playerReady$.next(!0))),Rn(1)).subscribe(_d)},window.onSpotifyWebPlaybackSDKReady=this.onSpotifyWebPlaybackSDKReady,this.observeReady().pipe(Le((()=>this.player.activateElement())),Rn(1)).subscribe(_d),this.observeReady().pipe(_r((()=>this.observeIsLoggedIn())),_r((e=>e?this.observePaused():Fr)),_r((e=>e?Fr:this.observeSrc())),Cd(this.observeAccessToken()),_r((([e,t])=>e&&e!==this.loadedSrc?Wr(void 0).pipe(_r((()=>this.loadError?this.reconnect(t):Wr(void 0))),wr((()=>this.addToQueue(e,t))),In((t=>(this.loadedSrc="",this.loadError={src:e,error:t},this.error$.next(t),this.currentTrackSrc$.next(""),Fr))),Rn(1)):Fr))).subscribe(_d),this.observeSrc().subscribe((()=>this.currentTrackSrc$.next(""))),this.observeState().pipe(Le((e=>{var t,r;const n=null===(r=null===(t=e.track_window)||void 0===t?void 0:t.current_track)||void 0===r?void 0:r.uri;n&&this.loadedSrc===this.src&&this.currentTrackSrc!==n&&this.currentTrackSrc$.next(n)}))).subscribe(_d),this.currentTrackSrc$.pipe(De((e=>!!e)),_r((()=>this.observeCurrentTrackState().pipe(Md(2),wr((e=>!e.paused&&this.paused?(_d.log("State mismatch: pausing..."),this.safePause()):e.paused&&!this.paused?(_d.log("State mismatch: resuming..."),this.safePlay()):Wr(void 0))),Rn(1))))).subscribe(_d),this.observeIsLoggedIn().pipe(pn((e=>e===this.isLoggedIn)),Le((e=>{this.isLoggedIn=e,e||this.paused||this.error$.next(Error(Ud))}))).subscribe(_d),this.observeIsLoggedIn().pipe(De((e=>e)),Rn(1),wr((()=>c("https://sdk.scdn.co/spotify-player.js")))).subscribe(_d),this.observeError().subscribe(_d.error)}get autoplay(){return Fd(this,$d,"f")}set autoplay(e){Fd(this,$d,"f")!==e&&(Rd(this,$d,e,"f"),e&&this.playerStarted$.next(!0))}get muted(){return Fd(this,zd,"f")}set muted(e){Fd(this,zd,"f")!==e&&(Rd(this,zd,e,"f"),this.safeVolume(e?0:this.volume))}get volume(){return Fd(this,jd,"f")}set volume(e){Fd(this,jd,"f")!==e&&(Rd(this,jd,e,"f"),this.safeVolume(this.muted?0:e))}observeCurrentTime(){return Rr(this.observeCurrentTrackState(),this.observePaused().pipe(_r((e=>e?this.getCurrentState():ar(250).pipe(wr((()=>this.getCurrentState()))))))).pipe(yr((e=>{var t,r;return(null===(r=null===(t=null==e?void 0:e.track_window)||void 0===t?void 0:t.current_track)||void 0===r?void 0:r.uri)===this.currentTrackSrc?e.position/1e3:0})),Sn())}observeDuration(){return this.observeCurrentTrackState().pipe(yr((e=>e.duration/1e3)),Sn())}observeEnded(){return this.observePlaying().pipe(_r((()=>this.observeCurrentTrackState())),Sn(Vd),Cd(this.observePaused()),yr((([e,t])=>!t&&e.paused&&0===e.position)),De((e=>e)),yr((()=>{})))}observeError(){return this.error$}observePlaying(){return this.observeCurrentTrackState().pipe(Sn(Vd),Cd(this.observePaused()),yr((([e,t])=>!t&&!e.paused)),Sn(),De((e=>e)),yr((()=>{})))}observeCurrentTrackState(){return this.observeState().pipe(De((e=>{var t,r;return(null===(r=null===(t=e.track_window)||void 0===t?void 0:t.current_track)||void 0===r?void 0:r.uri)===this.currentTrackSrc})))}appendTo(){}load({src:e}){_d.log("load",{src:e}),this.src$.next(e),this.autoplay&&this.paused$.next(!1),this.player&&this.isLoggedIn?this.autoplay&&e===this.loadedSrc&&this.safePlay():this.autoplay&&this.error$.next(Error(Ud))}play(){var e;_d.log("play"),this.paused$.next(!1),this.player&&this.isLoggedIn?this.src===(null===(e=this.loadError)||void 0===e?void 0:e.src)?this.error$.next(this.loadError.error):this.src===this.loadedSrc&&this.safePlay():this.isLoggedIn||this.error$.next(Error(Ud))}pause(){_d.log("pause"),this.paused$.next(!0),this.safePause()}stop(){_d.log("stop"),this.paused$.next(!0),this.safeStop()}seek(e){var t;null===(t=this.player)||void 0===t||t.seek(1e3*e)}resize(){}getCurrentState(){var e;return Dd(this,void 0,void 0,(function*(){return(null===(e=this.player)||void 0===e?void 0:e.getCurrentState())||null}))}get paused(){return this.paused$.getValue()}get src(){return this.src$.getValue()}get currentTrackSrc(){return this.currentTrackSrc$.getValue()}observeAccessToken(){return this.accessToken$}observeIsLoggedIn(){return this.observeAccessToken().pipe(yr((e=>!!e)),Sn())}observePaused(){return this.paused$.pipe(Sn())}observeReady(){return kn([this.playerReady$,this.playerStarted$]).pipe(De((([e,t])=>e&&t)),yr((()=>{})),Rn(1))}observeSrc(){return this.src$.pipe(Sn())}observeState(){return this.state$.pipe(De(l))}addToQueue(e,t,r=3){var n;return Dd(this,void 0,void 0,(function*(){if(e!==this.src)return;if(!t)throw Error(Ud);const i=yield fetch(`https://api.spotify.com/v1/me/player/play?device_id=${this.deviceId}`,{method:"PUT",body:JSON.stringify({uris:[e],position_ms:0}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!i.ok){if(r>0)switch(i.status){case 401:{const t=yield rd();return this.addToQueue(e,t,--r)}case 429:{const r=Number(null===(n=i.headers)||void 0===n?void 0:n.get("Retry-After"));if(r&&r<=5)return yield I(1e3*r),this.addToQueue(e,t,0);throw i}case 404:case 502:case 503:return yield this.reconnect(t),this.addToQueue(e,t,--r)}throw i}this.loadError=void 0,this.loadedSrc=e}))}connect(e){return Dd(this,void 0,void 0,(function*(){return new Promise(((t,r)=>{let n=!1;const i=new Spotify.Player({name:"ampcast",getOAuthToken:t=>Dd(this,void 0,void 0,(function*(){n&&(e=yield rd()),n=!0,t(e)})),volume:this.muted?0:this.volume});i.addListener("initialization_error",r),i.addListener("authentication_error",r),i.addListener("account_error",r),i.addListener("playback_error",(e=>this.error$.next(e))),i.addListener("player_state_changed",(e=>this.state$.next(e))),i.addListener("not_ready",(()=>{_d.log("not_ready"),this.deviceId="",r("not_ready")})),i.addListener("ready",(({device_id:e})=>{_d.log("ready"),this.player=i,this.deviceId=e,t(i)})),i.connect()}))}))}disconnect(){return Dd(this,void 0,void 0,(function*(){this.loadedSrc="",this.currentTrackSrc$.next(""),this.loadError=void 0;const e=this.player;e&&(e.removeListener("initialization_error"),e.removeListener("authentication_error"),e.removeListener("account_error"),e.removeListener("playback_error"),e.removeListener("player_state_changed"),e.removeListener("not_ready"),e.removeListener("ready"),yield this.safePause(),e.disconnect())}))}reconnect(e){return Dd(this,void 0,void 0,(function*(){return _d.log("reconnect"),t=jr(this.disconnect()).pipe(Nd(1e3),wr((()=>this.connect(e))),Nd(3e3),yr((()=>{}))),new Promise((function(e,r){var n=new Ee({next:function(t){e(t),n.unsubscribe()},error:r,complete:function(){r(new Ld)}});t.subscribe(n)}));var t}))}safePause(){return Dd(this,void 0,void 0,(function*(){try{this.player&&this.loadedSrc&&(yield this.player.pause())}catch(e){_d.error(e)}}))}safePlay(){return Dd(this,void 0,void 0,(function*(){try{this.player&&this.loadedSrc&&(yield this.player.resume())}catch(e){this.error$.next(e)}}))}safeStop(){return Dd(this,void 0,void 0,(function*(){try{if(this.player&&this.loadedSrc){yield this.player.pause();const e=yield this.getCurrentState();(null==e?void 0:e.position)&&(yield this.player.seek(0))}}catch(e){_d.error(e)}}))}safeVolume(e){var t;return Dd(this,void 0,void 0,(function*(){try{yield null===(t=this.player)||void 0===t?void 0:t.setVolume(e)}catch(e){_d.error(e)}}))}}(ed());var Hd=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Yd(e){const t=(0,n.useCallback)(((e,t,r)=>Hd(this,void 0,void 0,(function*(){const n=Gi(12),i=Os()(r+n),a=new URLSearchParams({u:t,t:i,s:n,v:"1.13.0",c:"ampcast",f:"json"}).toString(),s=yield fetch(`${e}/rest/ping?${a}`);if(!s.ok)throw s;const{"subsonic-response":o}=yield s.json();if(o.error)throw Error(o.error.message||"Failed");return JSON.stringify({userName:t,credentials:a})}))),[]);return n.createElement(Wi,Object.assign({},e,{service:bm,settings:kl,login:t}))}var qd=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Kd=new O("subsonicAuth"),Wd=new Ne(""),Gd=new Ne(!1);function Jd(){return Gd.getValue()}function Qd(e){kl.credentials=e,Wd.next(e)}Wd.pipe(Sn()).pipe(De((e=>""!==e)),wr((()=>function(){return qd(this,void 0,void 0,(function*(){try{const e=yield Ol.getMusicLibraries();return kl.libraries=e,!0}catch(e){return Kd.error(e),Wd.next(""),!1}}))}()))).subscribe(Gd),Qd(kl.credentials);var Xd=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};class Zd{constructor(e,t,r,n){this.parent=n,this.pageNumber=1,this.pageSize=(null==r?void 0:r.pageSize)||200,this.pager=new mi((()=>Xd(this,void 0,void 0,(function*(){const r=this.pageSize,n=(this.pageNumber-1)*r,{items:i,total:a,atEnd:s}=yield t(n,r);return this.pageNumber++,{items:i.map((t=>this.createMediaObject(e,t))),total:a,atEnd:s}}))),Object.assign({pageSize:this.pageSize},r))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createMediaObject(e,t){let r;switch(e){case Ln.Album:r=this.createMediaAlbum(t);break;case Ln.Artist:r=this.createMediaArtist(t);break;case Ln.Playlist:r=this.createMediaPlaylist(t);break;case Ln.Folder:r=this.createFolderItem(t);break;default:r=this.createMediaItem(t)}return r}createMediaItem(e){return"video"===e.type?this.createMediaItemFromVideo(e):this.createMediaItemFromSong(e)}createFolderItem(e){return"type"in e?this.createMediaItem(e):this.createMediaFolder(e)}createMediaItemFromSong(e){return{itemType:Ln.Media,mediaType:Fn.Audio,src:`subsonic:audio:${e.id}`,fileName:this.getFileName(e.path||"")||"[unknown]",title:e.title,artists:[e.artist],album:e.album,duration:e.duration,track:e.track,disc:e.discNumber,year:e.year,playedAt:0,playCount:e.playCount,inLibrary:!!e.starred,genres:e.genre?[e.genre]:void 0,thumbnails:this.createThumbnails(e.coverArt)}}createMediaItemFromVideo(e){return{itemType:Ln.Media,mediaType:Fn.Video,src:`subsonic:video:${e.id}`,fileName:this.getFileName(e.path||"")||"[unknown]",title:e.title,duration:e.duration,playedAt:0,playCount:e.playCount,inLibrary:!!e.starred,thumbnails:this.createThumbnails(e.id)}}createMediaAlbum(e){return{itemType:Ln.Album,src:`subsonic:album:${e.id}`,title:e.name,addedAt:this.parseDate(e.created),artist:e.artist,year:e.year,playCount:e.playCount,inLibrary:!!e.starred,genres:e.genre?[e.genre]:void 0,pager:this.createAlbumTracksPager(e),thumbnails:this.createThumbnails(e.coverArt),subsonic:{isDir:e.isDir}}}createMediaArtist(e){return{itemType:Ln.Artist,src:`subsonic:artist:${e.id}`,title:e.name,pager:this.createArtistAlbumsPager(e),thumbnails:this.createThumbnails(e.coverArt),inLibrary:!!e.starred}}createMediaPlaylist(e){const t=`subsonic:playlist:${e.id}`;return{src:t,itemType:Ln.Playlist,title:e.name,description:e.comment,addedAt:this.parseDate(e.created),duration:e.duration,trackCount:e.songCount,pager:this.createPlaylistItemsPager(e),thumbnails:this.createThumbnails(e.coverArt),isPinned:gi.isPinned(t),isOwn:e.owner===kl.userName,owner:{name:e.owner}}}createMediaFolder(e){var t;const r=e.title||"[unknown]",n={itemType:Ln.Folder,src:`subsonic:folder:${e.id}`,title:r,fileName:r,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===Ln.Folder?`${this.parent.path}/${r}`:"/",parent:this.parent};return n.pager=this.createFolderPager(n),n}parseDate(e){const t=Date.parse(e)||0;return t<0?0:Math.round(t/1e3)}createThumbnails(e){return e?[this.createThumbnail(e,120),this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480)]:void 0}createThumbnail(e,t,r=t){return{url:`${kl.host}/rest/getCoverArt?id=${e}&size=${t}&{subsonic-credentials}`,width:t,height:r}}getFileName(e){return e.split(/[/\\]/).pop()}createAlbumTracksPager(e){return e.song?new Un(e.song.map((e=>this.createMediaObject(Ln.Media,e)))):new Zd(Ln.Media,(()=>Xd(this,void 0,void 0,(function*(){return{items:yield Ol.getAlbumTracks(e.id,e.isDir),atEnd:!0}}))))}createArtistAlbumsPager(e){const t=this.createArtistTopTracks(e),r=new Un([t]),n=e.album?new Un(e.album.map((e=>this.createMediaObject(Ln.Album,e)))):new Zd(Ln.Album,(()=>Xd(this,void 0,void 0,(function*(){return{items:yield Ol.getArtistAlbums(e.id),atEnd:!0}}))),void 0);return new fi(r,n)}createArtistTopTracks(e){return{itemType:Ln.Album,src:`subsonic:top-tracks:${e.id}`,title:"Top Songs",artist:e.name,thumbnails:this.createThumbnails(e.coverArt),pager:this.createTopTracksPager(e),synthetic:!0}}createTopTracksPager(e){return new Zd(Ln.Media,(()=>Xd(this,void 0,void 0,(function*(){return{items:yield Ol.getArtistTopTracks(e.name),atEnd:!0}}))))}createPlaylistItemsPager(e){return e.entry?new Un(e.entry.map((e=>this.createMediaObject(Ln.Media,e)))):new Zd(Ln.Media,(()=>Xd(this,void 0,void 0,(function*(){return{items:yield Ol.getPlaylistItems(e.id),atEnd:!0}}))))}createFolderPager(e){var t;const[,,r]=e.src.split(":"),n=new Zd(Ln.Folder,(()=>Xd(this,void 0,void 0,(function*(){return{items:yield Ol.getMusicDirectoryItems(r),atEnd:!0}}))),{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Ln.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new Un([e]);return new fi(t,n)}return n}}Zd.minPageSize=10,Zd.maxPageSize=500;const em=Zd;var tm=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const rm="subsonic",nm={id:"subsonic/liked-songs",title:"My Songs",icon:"heart",itemType:Ln.Media,lockActionsStore:!0,layout:{view:"card",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search(){return new em(Ln.Media,(()=>tm(this,void 0,void 0,(function*(){return{items:yield Ol.getLikedSongs(),atEnd:!0}}))))}},im={id:"subsonic/liked-albums",title:"My Albums",icon:"heart",itemType:Ln.Album,lockActionsStore:!0,search(){return new em(Ln.Album,((e,t)=>tm(this,void 0,void 0,(function*(){return{items:yield Ol.getLikedAlbums(e,t)}}))))}},am={id:"subsonic/recently-played",title:"Recently Played",icon:"clock",itemType:Ln.Album,search(){return new em(Ln.Album,((e,t)=>tm(this,void 0,void 0,(function*(){return{items:yield Ol.getRecentlyPlayed(e,t)}}))))}},sm={id:"subsonic/most-played",title:"Most Played",icon:"most-played",itemType:Ln.Album,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},secondaryLayout:{view:"details",fields:["Index","Title","Artist","Duration","PlayCount"]},search(){return new em(Ln.Album,((e,t)=>tm(this,void 0,void 0,(function*(){return{items:yield Ol.getMostPlayed(e,t)}}))))}},om={id:"subsonic/playlists",title:"Playlists",icon:"playlist",itemType:Ln.Playlist,secondaryLayout:{view:"details",fields:["Index","Artist","Title","Album","Track","Duration","PlayCount"]},search(){return new em(Ln.Playlist,(()=>tm(this,void 0,void 0,(function*(){return{items:yield Ol.getPlaylists(),atEnd:!0}}))))}},lm={id:"subsonic/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:Ln.Media,viewType:Ri.ByGenre,defaultHidden:!0,layout:{view:"details",fields:["Artist","Title","Album","Track","Duration","PlayCount"]},search(e){return e?new em(Ln.Media,((t,r)=>tm(this,void 0,void 0,(function*(){return{items:yield Ol.getSongsByGenre(e.id,t,r),total:e.count}})))):new Un}},cm={id:"subsonic/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:Ln.Album,viewType:Ri.ByGenre,search(e){return e?new em(Ln.Album,((t,r)=>tm(this,void 0,void 0,(function*(){return{items:yield Ol.getAlbumsByGenre(e.id,t,r),total:e.count}})))):new Un}},um={id:"subsonic/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:Ln.Album,viewType:Ri.ByDecade,search(e){return e?new em(Ln.Album,((t,r)=>tm(this,void 0,void 0,(function*(){return{items:yield Ol.getAlbumsByDecade(e.id,t,r)}})))):new Un}},dm={id:"subsonic/random-tracks",title:"Random Songs",icon:"shuffle",itemType:Ln.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search(){return new em(Ln.Media,(()=>tm(this,void 0,void 0,(function*(){return{items:yield Ol.getRandomSongs(100),atEnd:!0}}))))}},mm={id:"subsonic/random-albums",title:"Random Albums",icon:"shuffle",itemType:Ln.Album,search(){return new em(Ln.Album,(()=>tm(this,void 0,void 0,(function*(){return{items:yield Ol.getRandomAlbums(100),atEnd:!0}}))))}},hm={id:"subsonic/videos",title:"Music Videos",icon:"video",itemType:Ln.Media,mediaType:Fn.Video,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Title","Duration"]},search(){return new em(Ln.Media,(()=>tm(this,void 0,void 0,(function*(){return{items:yield Ol.getVideos(),atEnd:!0}}))))}},fm={id:"subsonic/folders",title:"Folders",icon:"folder",itemType:Ln.Folder,viewType:Ri.Folders,search(){const e={itemType:Ln.Folder,src:"",title:"Folders",fileName:"",path:""},t=(e,t)=>e.name.localeCompare(t.name);return e.pager=new Hi((()=>kl.libraries.map((({id:r,title:n})=>{const i={itemType:Ln.Folder,src:`subsonic:folder:${r}`,title:n,fileName:n,path:`/${n}`},a=Object.assign(Object.assign({},e),{fileName:"../"}),s=new Un([a]),o=new em(Ln.Folder,(()=>tm(this,void 0,void 0,(function*(){return{items:(yield Ol.getIndexes(r)).map((e=>e.artist.map((({id:e,name:t})=>({id:e,name:t,title:t}))))).flat().sort(t),atEnd:!0}}))),void 0,i);return i.pager=new fi(s,o),i})))),e.pager}},pm={id:rm,icon:rm,name:"Subsonic",url:"http://www.subsonic.org/",serviceType:vn.PersonalMedia,defaultHidden:!0,roots:[ym(Ln.Media,{title:"Songs"}),ym(Ln.Album,{title:"Albums"}),ym(Ln.Artist,{title:"Artists"})],sources:[nm,im,am,sm,om,lm,cm,um,dm,mm,hm,fm],labels:{[zn.AddToLibrary]:"Like on Subsonic",[zn.RemoveFromLibrary]:"Unlike on Subsonic"},get audioLibraries(){return kl.audioLibraries},get libraryId(){return kl.libraryId},set libraryId(e){kl.libraryId=e},get libraries(){return kl.libraries},set libraries(e){kl.libraries=e},observeLibraryId:()=>kl.observeLibraryId(),canRate:()=>!1,canStore:vm,compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:Ln.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":");return new em(Ln.Playlist,(()=>tm(this,void 0,void 0,(function*(){return{items:[yield Ol.getPlaylist(t)],atEnd:!0}}))))}}},getFilters:function(e,t){return tm(this,void 0,void 0,(function*(){return Ol.getFilters(e,t)}))},getMetadata:function(e){var t;return tm(this,void 0,void 0,(function*(){const r=e.itemType,[,,n]=e.src.split(":");if(r===Ln.Album&&void 0===e.description){const r=yield Ol.getAlbumInfo(n,null===(t=e.subsonic)||void 0===t?void 0:t.isDir);e=Object.assign(Object.assign({},e),{description:A(r.notes),release_mbid:r.musicBrainzId})}else if(r===Ln.Artist&&void 0===e.description){const t=yield Ol.getArtistInfo(n);e=Object.assign(Object.assign({},e),{description:A(t.biography),artist_mbid:t.musicBrainzId})}if(!vm(e)||void 0!==e.inLibrary)return e;const i=Nn.getInLibrary(e);if(void 0!==i)return Object.assign(Object.assign({},e),{inLibrary:i});if(r===Ln.Album){const t=yield gm(e),r=yield Ol.getMusicDirectory(t);return Object.assign(Object.assign({},e),{inLibrary:r.starred})}{const t=yield Ol.getSong(n);return Object.assign(Object.assign({},e),{inLibrary:t.starred})}}))},getPlayableUrl:function({src:e}){return Ol.getPlayableUrl(e)},getThumbnailUrl:function(e){return e.replace("{subsonic-credentials}",kl.credentials)},lookup:function(e,t,r=10,n){return tm(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:r,maxSize:r,lookup:!0};return _n(new em(Ln.Media,((r,n)=>tm(this,void 0,void 0,(function*(){return{items:yield Ol.searchSongs(`${e} ${t}`,r,n)}}))),i),{timeout:n})}))},store:function(e,t){return tm(this,void 0,void 0,(function*(){const r=t?"star":"unstar";switch(e.itemType){case Ln.Media:{const[,,t]=e.src.split(":");yield Ol.get(r,{id:t});break}case Ln.Album:{const t=yield gm(e);yield Ol.get(r,{id:t});break}}}))},observeIsLoggedIn:function(){return Gd.pipe(Sn())},isLoggedIn:Jd,login:function(){return qd(this,void 0,void 0,(function*(){if(!Jd()){Kd.log("connect");try{const e=yield function(){return Hd(this,void 0,void 0,(function*(){return Dt(Yd,!0)}))}();if(e){const{userName:t,credentials:r}=JSON.parse(e);kl.userName=t,Qd(r)}}catch(e){Kd.error(e)}}}))},logout:function(){return qd(this,void 0,void 0,(function*(){Kd.log("disconnect"),kl.clear(),Qd(""),Gd.next(!1)}))}},bm=pm;function vm(e){switch(e.itemType){case Ln.Media:return!0;case Ln.Album:return!e.synthetic;default:return!1}}function ym(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`subsonic/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search({q:t=""}={}){return(t=t.trim())?new em(e,((r,n)=>tm(this,void 0,void 0,(function*(){switch(e){case Ln.Media:return{items:yield Ol.searchSongs(t,r,n)};case Ln.Album:return{items:yield Ol.searchAlbums(t,r,n)};case Ln.Artist:return{items:yield Ol.searchArtists(t,r,n)};default:throw TypeError("Search not supported for this type of media")}})))):new Un}})}function gm(e){var t;return tm(this,void 0,void 0,(function*(){const[,,r]=e.src.split(":");if(null===(t=e.subsonic)||void 0===t?void 0:t.isDir)return r;const[{parent:n}]=yield Ol.getAlbumTracks(r);return n||""}))}const wm=new O("mediaServices");function Em(){return[$i,xd,Ua,Ss,dc,yu,ju,bm,Zo,to,bl]}function km(){return Em().filter((e=>!!e.lookup))}function xm(){return Em().filter(Cm)}function Sm(e){const t=e.authServiceId;return t&&Tm(t)||e}function Tm(e){return Em().find((t=>t.id===e))}function Am({src:e=""}={}){const[t]=(null==e?void 0:e.split(":"))||[""];return Tm(t)}function Im(e){return!!e&&Pm(e.src)}function Pm(e){if(e){const[t,r,n]=e.split(":");return"blob"===t||"file"===t||!!n&&!!r&&function(e){const t=Tm(e);return!!t&&t.serviceType!==vn.Scrobbler}(t)}return!1}function Cm(e){return Nm(e,vn.PersonalMedia)}function Mm(e){return Nm(e,vn.PublicMedia)}function Om(e){return Nm(e,vn.Scrobbler)}function Nm(e,t){return function(e){return!!e&&"serviceType"in e}(e)&&e.serviceType===t}function $m({service:e,showConnectivity:t}){const r=Sm(e);return n.createElement(Yi,{className:"media-service-label",icon:e.icon,text:e===r?e.name:n.createElement(n.Fragment,null,e.name," ",n.createElement("span",{className:`auth-service auth-service-${r.id} ${t?"show-connectivity":""}`,title:`via ${r.name}`},r.name)),showConnectivity:t})}function zm({servicesRef:e,onSubmit:t}){const[r,i,a]=(0,n.useMemo)((()=>[Em().filter(Mm),xm(),Em().filter(Om)]),[]);return n.createElement("form",{className:"media-library-settings-general",method:"dialog",onSubmit:t,ref:e},n.createElement("fieldset",null,n.createElement("legend",null,"Media Services"),n.createElement(jm,{services:r})),n.createElement("fieldset",null,n.createElement("legend",null,"Personal Media"),n.createElement(jm,{services:i})),n.createElement("fieldset",null,n.createElement("legend",null,"Listening History"),n.createElement(jm,{services:a})),n.createElement(Ut,null))}function jm({services:e}){const t=(0,n.useId)();return n.createElement("ul",{className:"checkbox-list"},e.map((e=>n.createElement("li",{key:e.id},n.createElement("input",{id:`${t}-${e.id}`,type:"checkbox",value:e.id,defaultChecked:hn(e)}),n.createElement("label",{htmlFor:`${t}-${e.id}`},n.createElement($m,{service:e}))))))}function Lm(e){const t=(0,n.useRef)(null),r=(0,n.useCallback)((()=>{const e=t.current.elements,r={};for(const t of e)"checkbox"===t.type&&(r[t.value]=!t.checked);fn(r)}),[]);return n.createElement(jt,Object.assign({},e,{className:"settings-dialog media-service-selection-dialog",title:"Media Service Selection"}),n.createElement("p",null,"Select any services you are interested in."),n.createElement(zm,{servicesRef:t,onSubmit:r}))}Nn.registerServices(Em()),jr(Em()).pipe(wr((e=>e.observeIsLoggedIn().pipe(pn((e=>!e)),Le((t=>wm.log(`${e.id} ${t?"":"dis"}connected`))))))).subscribe(wm);var Dm=r(4511),Fm=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Rm(e){var{service:t}=e,r=Fm(e,["service"]);return n.createElement("p",null,n.createElement("button",Object.assign({},r,{className:"branded login",onClick:t.login}),"Log in to ",t.name))}function _m({service:e}){return n.createElement("p",null,"You need to be logged in to"," ",e.serviceType===vn.Scrobbler?"access your data":"play music"," from"," ",e.name,".")}function Um({service:e}){return n.createElement("p",{className:`service-link service-link-${e.id}`},n.createElement(Nt,{name:e.icon}),n.createElement(mo,{href:e.url}))}function Vm(){const{musicKit:e,error:t}=function(){const[e,t]=(0,n.useState)(null),[r,i]=(0,n.useState)(null);return(0,n.useEffect)((()=>{const e=jr(si()).subscribe({next:t,error:i});return()=>e.unsubscribe()}),[]),{musicKit:e,error:r}}();return n.createElement(n.Fragment,null,n.createElement(_m,{service:$i}),n.createElement(Rm,{service:$i,disabled:!e}),t?n.createElement("p",{className:"error"},"Could not load Apple MusicKit library."):null,n.createElement(Um,{service:$i}))}function Bm({service:e}){return n.createElement(n.Fragment,null,n.createElement(_m,{service:e}),n.createElement(Rm,{service:e}),n.createElement(Um,{service:e}))}function Hm(){(0,n.useEffect)((()=>{const e=new Me,t=e.pipe(wr((e=>ir(e))),wr((()=>function(){return Lc(this,void 0,void 0,(function*(){return Vc=yield jc.fetchJSON({host:Fc,path:"/pins",method:"POST",params:{strong:"true"}}),Vc}))}())),yr((e=>1e3*e.expiresIn)),Le((t=>e.next(t)))).subscribe();return e.next(0),()=>t.unsubscribe()}))}function Ym(){return Hm(),n.createElement(Bm,{service:yu})}function qm(){return Hm(),n.createElement(n.Fragment,null,n.createElement(_m,{service:ju}),n.createElement(Rm,{service:yu}),n.createElement(Um,{service:yu}),n.createElement(Um,{service:ju}))}function Km({service:e}){return n.createElement("div",{className:"dev-mode note"},n.createElement("p",null,"This application is in ",n.createElement("strong",null,"development mode"),"."),n.createElement("p",null,"You currently need to be an approved user to access services from ",e.name,"."))}function Wm(){return n.createElement(n.Fragment,null,n.createElement(Km,{service:xd}),n.createElement("p",null,"You need to be logged in to play music from Spotify.*"),n.createElement(Rm,{service:xd}),n.createElement("p",null,n.createElement("small",null,"*Spotify Premium required.")),n.createElement(Um,{service:xd}))}function Gm(e,t){return void 0===t&&(t=tr),$e((function(r,n){var i=null,a=null,s=null,o=function(){if(i){i.unsubscribe(),i=null;var e=a;a=null,n.next(e)}};function l(){var r=s+e,a=t.now();if(a<r)return i=this.schedule(void 0,r-a),void n.add(i);o()}r.subscribe(ze(n,(function(r){a=r,s=t.now(),i||(i=t.schedule(l,e),n.add(i))}),(function(){o(),n.complete()}),void 0,(function(){a=i=null})))}))}function Jm(e){return new Promise(((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)}))}function Qm(e,t){const r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);const n=Jm(r);return(e,r)=>n.then((n=>r(n.transaction(t,e).objectStore(t))))}let Xm;function Zm(){return Xm||(Xm=Qm("keyval-store","keyval")),Xm}function eh(e,t=Zm()){return t("readonly",(t=>Jm(t.get(e))))}function th(e,t,r=Zm()){return r("readwrite",(r=>(r.put(t,e),Jm(r.transaction))))}var rh;!function(e){e.Looking="looking",e.NotFound="not-found"}(rh||(rh={}));const nh=rh;var ih=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const ah=new O("file");function sh(e){var t,n,i;return ih(this,void 0,void 0,(function*(){const{parseBlob:a}=yield Promise.all([r.e(463),r.e(12)]).then(r.bind(r,2463));let s;try{s=yield a(e,{duration:!0,skipCovers:!0})}catch(t){ah.log(`Error parsing file: ${e.name}`),ah.error(t),s={format:{},common:{}}}const{common:o,format:l}=s,c=e.type.startsWith("video"),u=l.duration||(yield function(e){return ih(this,void 0,void 0,(function*(){return new Promise((t=>{const r=e.type.startsWith("video"),n=document.createElement(r?"video":"audio"),i=URL.createObjectURL(e),a=()=>{const e=n.error?0:n.duration;n.ondurationchange=null,n.onerror=null,n.src="",n.removeAttribute("src"),URL.revokeObjectURL(i),t(e)};n.ondurationchange=a,n.onerror=a,n.onended=a,n.muted=!0,n.src=i}))}))}(e)),d=(e=0)=>Math.floor(Number(e))||0;return{itemType:Ln.Media,mediaType:c?Fn.Video:Fn.Audio,src:`blob:${Gi()}`,externalUrl:"",title:o.title||e.name.replace(/\.\w+$/,""),artists:o.artist?[o.artist]:o.artists,albumArtist:o.album&&o.albumartist||"",album:o.album||"",genres:o.genre,duration:u?Number(u.toFixed(3)):0,track:d(null===(t=o.track)||void 0===t?void 0:t.no),disc:d(null===(n=o.disk)||void 0===n?void 0:n.no),year:d(o.year),mood:o.mood||"",rating:Number(o.rating)||0,isrc:null===(i=o.isrc)||void 0===i?void 0:i[0],recording_mbid:o.musicbrainz_recordingid,playedAt:0,blob:e}}))}var oh=r(4909),lh=r.n(oh),ch=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const uh=new O("localdb/listens"),dh=[],mh=new Ne(dh);class hh extends gt.ZP{constructor(){super("ampcast/listens"),this.version(1).stores({items:"&playedAt, src, lastfmScrobbledAt, listenbrainzScrobbledAt"})}}const fh=new hh;function ph(){return mh.pipe(De((e=>e!==dh)))}function bh(e,t,r){const n=Math.min(e/2,240);return t=Math.floor(t/1e3),(r=Math.floor(r/1e3))-t>n}function vh(e){return ch(this,void 0,void 0,(function*(){try{e.length>0&&(yield fh.items.bulkPut(e))}catch(e){uh.error(e)}}))}function yh(e,t=30){return Math.round(e.playedAt/t)}function gh(e,t,r=5){const n=t.playedAt,i=n-r,a=n+t.duration+r;for(const r of e){if(r.playedAt<i)return;if(r.playedAt>i&&r.playedAt<a&&Eh(t,r,.75))return r}}function wh(e,t){const r=mh.getValue();return function(e,t,r=5){const n=t.playedAt;if(n)for(let i=0;i<e.length;i++){const a=e[i-1];if(a&&a.playedAt<n)return;const s=e[i],o=s.playedAt-r,l=s.playedAt+s.duration+r;if(n>o&&n<l&&Eh(s,t,.75))return s}}(r,e,t)||function(e,t){return e.find((e=>t.src===e.src||t.externalUrl&&t.externalUrl===e.externalUrl||t.isrc&&t.isrc===e.isrc||t.recording_mbid&&t.recording_mbid===e.recording_mbid))}(r,e)||$h(r,e)}function Eh(e,t,r){return S(e.title,t.title,r)}function kh(e){return ch(this,void 0,void 0,(function*(){const t=`${e}ScrobbledAt`,r=Math.floor(Date.now()/1e3)-1209600,n=yield fh.items.where(t).equals(0).toArray();yield vh(n.filter((e=>e.playedAt<r)).map((e=>Object.assign(Object.assign({},e),{[t]:-1}))))}))}ch(void 0,void 0,void 0,(function*(){try{yield kh("lastfm"),yield kh("listenbrainz")}catch(e){uh.error(e)}(0,gt.Y1)((()=>fh.items.orderBy("playedAt").reverse().toArray())).subscribe(mh)}));const xh=new Me,Sh=new Me,Th=new D("lookup"),Ah={get preferredService(){return Th.getString("preferredService")},set preferredService(e){Th.setString("preferredService",e)}};var Ih=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Ph=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const Ch=new O("lookup");let Mh="";function Oh(e,t){return Ih(this,void 0,void 0,(function*(){try{if(!e.lookup)return[];const{artist:r,title:n}=_h(t);if(e.isLoggedIn()){const i=e=>Rh(e).replace(/[([].*$/,"").replace(/['"]/g," ").replace(/\s\s+/g," ");return zh(yield e.lookup(i(t.albumArtist||Uh(r)),i(Uh(n)),10,2e3),t)}}catch(e){Ch.error(e)}return[]}))}function Nh(e,t,r){return Ih(this,void 0,void 0,(function*(){const n=km().filter((e=>e!==r&&e.isLoggedIn()===t));return 0===n.length?[]:(yield Promise.all([...n.map((t=>Oh(t,e)))])).flat()}))}function $h(e,t){const{artist:r,title:n}=_h(t);if(!r||!n)return;const i=Ah.preferredService||Mh;let a=zh(e,t);return a=x(a,(e=>Dh(e,t))),i&&(a=x(a,(e=>e.src.startsWith(i)))),a[0]}function zh(e,t){let r=e.filter((e=>Lh(e,t,!0)));return 0===r.length&&(r=e.filter((e=>Lh(e,t,!1)))),r}const jh=/\s*(feat\.|[([]?\s?feat[\s.]).*$/i;function Lh(e,t,r){return(function(e,t,r){let n=t.title;if(!n)return!1;if(Fh(n,e.title))return!0;if(r)return!1;const i=Rh(e.title);if(n=Rh(n),Fh(n,i))return!0;const[,...a]=e.artists||[];if(a.length>0){const e=a.length>1?` & ${a.pop()}`:"";if(Fh(n,`${i} (feat. ${a.join(", ")}${e})`))return!0}return!(!jh.test(n)||!Fh(Uh(n),i))||!(!jh.test(e.title)||!Fh(n,Uh(i)))}(e,t,r)||function(e,t){if(!Dh(e,t))return!1;if(e.track!==t.track)return!1;const r=Rh(e.title),n=Rh(t.title);return!(!r.startsWith(n)&&!n.startsWith(r))||S(r,n,.75)}(e,t))&&function(e,t,r){var n;const i=null===(n=t.artists)||void 0===n?void 0:n[0];if(!i)return!1;const a=e.artists;if(!a)return!1;const s=a[0];if(!s)return!1;if(Fh(i,s))return!0;if(r)return!1;if(Fh(Rh(i),Rh(s)))return!0;if(Fh(Uh(i),Uh(s)))return!0;const o=t.albumArtist;if(o&&Fh(Rh(o),Rh(s)))return!0;if(Fh(Uh(i),e.albumArtist))return!0;const l=",;&|/".split("").map((e=>[e,`${e} `,` ${e} `])).flat();for(const e of l){const[t]=a[0].split(e);if(Fh(i,t))return!0;if(a.length>1&&Fh(i,a.join(e)))return!0}return!1}(e,t,r)}function Dh(e,t){return!(!e.album||!t.album)&&Fh(Rh(t.album),Rh(e.album))}function Fh(e,t=""){return 0===e.localeCompare(t,void 0,{sensitivity:"accent"})}function Rh(e){return lh()(e).replace(/\s\s+/g," ")}function _h(e){return{artist:e.artists&&e.artists[0]||"",title:e.title}}function Uh(e){return e.replace(jh,"")}const Vh=new D("playlist"),Bh=new Ne(Vh.getJson("settings",{allowDuplicates:!0,showLineNumbers:!0,zeroPadLineNumbers:!0,showSourceIcons:!0})),Hh={observe:function(){return Bh},get:function(){return Bh.getValue()},set:function(e){Vh.setJson("settings",e),Bh.next(e)}};var Yh=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const qh=new O("playlist"),Kh=Qm("ampcast/playlist","keyval"),Wh=[],Gh=new Ne(Wh),Jh=new Ne("");function Qh(){return Gh.getValue()}function Xh(e){e=e.concat(),Gh.next(e),0===e.length?ef(""):tf()||ef(e[0].id)}function Zh(){return Jh.getValue()}function ef(e){Jh.next(e)}function tf(){const e=Qh(),t=Zh();return e.find((e=>e.id===t))||null}function rf(e){ef(e.id)}function nf(){return kn([Gh,Jh]).pipe(yr((([e,t])=>{var r;return null!==(r=e.find((e=>e.id===t)))&&void 0!==r?r:null})),Sn())}function af(){return kn([Gh,Jh]).pipe(yr((([e,t])=>e.findIndex((e=>e.id===t)))),Sn())}function sf(){const e=Gh.getValue(),t=Zh();return e.findIndex((e=>e.id===t))}function of(){return Gh.getValue().length}function lf(e){const t=Zh();if(t){const r=Qh(),n=r.findIndex((e=>e.id===t));if(-1!==n){const t=r[n+e];t&&rf(t)}}}function cf(e,t){return Yh(this,void 0,void 0,(function*(){const r=Qh(),n=Hh.get().allowDuplicates;let i=yield function(e){return Yh(this,void 0,void 0,(function*(){const t=e=>"itemType"in e&&e.itemType===Ln.Album;let r=[];if(Array.isArray(e))if(t(e[0])){const t=yield Promise.all(e.map((e=>df(e))));for(const e of t)r=r.concat(e)}else r=yield Promise.all(e.map((e=>mf(e))));else r=t(e)?yield df(e):e instanceof FileList?yield Promise.all(Array.from(e).map((e=>sh(e)))):[yield mf(e)];return r.filter(l)}))}(e);if(n||(i=i.filter((e=>-1===r.findIndex((t=>t.src===e.src))))),i.length>0){const e=i.map((e=>Object.assign(Object.assign({},function(e){return Object.keys(e).reduce(((t,r)=>(void 0===e[r]||P.includes(r)||(t[r]=e[r]),t)),{})}(e)),{id:Gi()})));t>=0&&t<r.length?(r.splice(t,0,...e),Xh(r)):Xh(r.concat(e))}}))}function uf(e){const t=Qh(),r=Array.isArray(e)?e:[e],n=t.filter((e=>!r.includes(e)));if(n.length!==t.length){const e=sf(),t=Zh(),r=n.findIndex((e=>e.id===t));if(-1===r)if(-1===e)ef("");else{const t=n[e]||n.at(-1);ef((null==t?void 0:t.id)||"")}Xh(n)}}function df(e){return Yh(this,void 0,void 0,(function*(){return _n(e.pager,{keepAlive:!0})}))}function mf(e){return Yh(this,void 0,void 0,(function*(){return e instanceof File?/^(audio|video)/.test(e.type)?sh(e):null:e}))}const hf={get atEnd(){return sf()===of()-1},get atStart(){return 0===of()||0===sf()},observe:function(){return Gh.pipe(De((e=>e!==Wh)))},observeCurrentIndex:af,observeCurrentItem:nf,observeNextItem:function(){return kn([Gh,Jh]).pipe(yr((([e,t])=>{const r=e.findIndex((e=>e.id===t));return-1===r?null:e[r+1]||null})),Sn())},observeSize:function(){return Gh.pipe(yr((e=>e.length)),Sn())},getCurrentIndex:sf,getCurrentItem:tf,setCurrentItem:rf,add:function(e){return Yh(this,void 0,void 0,(function*(){return cf(e,-1)}))},clear:function(){Xh([])},eject:function(){const e=tf();e&&uf(e)},insert:function(e){return Yh(this,void 0,void 0,(function*(){return cf(e,sf()+1)}))},insertAt:cf,moveSelection:function(e,t){return Yh(this,void 0,void 0,(function*(){const r=Qh(),n=r[t];if(e.includes(n))return;const i=r.filter((t=>!e.includes(t))),a=i.indexOf(n);a>=0?(i.splice(a,0,...e),Xh(i)):Xh(i.concat(e))}))},next:function(){lf(1)},prev:function(){lf(-1)},remove:uf,removeAt:function(e){const t=function(e){var t;return null!==(t=Qh()[e])&&void 0!==t?t:null}(e);t&&uf(t)},reverseAt:function(e,t){const r=Qh(),n=r.slice(e,e+t).reverse();r.splice(e,t,...n),Xh(r)},shuffle:function(e){const t=Qh().slice();if(t.length>0){const r=tf();if(e&&r){const e=f(t.filter((e=>e!==r)));e.unshift(r),Xh(e)}else{const e=f(t);Xh(e),rf(e[0])}}}},ff=hf;Yh(void 0,void 0,void 0,(function*(){var e,t;const r=null!==(e=yield eh("items",Kh))&&void 0!==e?e:[],n=null!==(t=yield eh("currently-playing-id",Kh))&&void 0!==t?t:"";Gh.next(r.map((e=>{if(e.plex){const[,t,r]=e.src.split(":");e.src=`plex:${t}:${e.plex.ratingKey}`,e.srcs=[r],delete e.plex}return e}))),Jh.next(n)})),Gh.pipe(Md(2),Gm(200),wr((e=>th("items",e=e.map((e=>{if(e.lookupStatus){const{lookupStatus:t}=e;return function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["lookupStatus"])}return e})),Kh)))).subscribe(qh),Jh.pipe(Md(2),Gm(200),wr((e=>th("currently-playing-id",e,Kh)))).subscribe(qh),xh.pipe(Le((({lookupItem:e})=>{const t=Qh(),r=t.findIndex((t=>t.src===e.src));if(-1!==r){const e=t[r];t[r]=Object.assign(Object.assign({},e),{lookupStatus:nh.Looking}),Xh(t)}}))).subscribe(qh),Sh.pipe(Le((({lookupItem:e,foundItem:t})=>{const r=Qh(),n=r.findIndex((t=>t.src===e.src));if(-1!==n){const e=r[n];r[n]=t?Object.assign(Object.assign({},t),{id:e.id,lookupStatus:void 0}):Object.assign(Object.assign({},e),{lookupStatus:nh.NotFound}),Xh(r)}}))).subscribe(qh);var pf,bf,vf=r(1062),yf=r.n(vf),gf=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},wf=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};const Ef=(e,t)=>e.width===t.width&&e.height===t.height,kf=16/9,xf={autohide:1,autoplay:0,controls:0,disablekb:1,enablejsapi:1,fs:0,iv_load_policy:3,modestbranding:1,rel:0,showinfo:0};var Sf;!function(e){e[e.UNSTARTED=-1]="UNSTARTED",e[e.ENDED=0]="ENDED",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.BUFFERING=3]="BUFFERING",e[e.CUED=5]="CUED"}(Sf||(Sf={})),pf=new WeakMap,bf=new WeakMap;const Tf=class{constructor(e){this.player=null,this.src$=new Ne(""),this.size$=new Ne({width:0,height:0}),this.error$=new Me,this.ready$=new Me,this.state$=new Me,this.videoId$=new Ne(""),pf.set(this,!0),bf.set(this,1),this.autoplay=!1,this.loop=!1;const t=this.element=document.createElement("div"),r=document.createElement("div"),n=document.createElement("div"),i=this.logger=new O(`YouTubePlayer/${e}`);this.targetId=`youtube-iframe-${e}`,t.hidden=!0,t.className="youtube-video",r.className="youtube-video-wrapper",n.id=this.targetId,r.append(n),t.append(r),this.observeReady().pipe(wr((()=>this.observeSrc())),pn((e=>!e)),Le((e=>{const t=this.player,[,r,n,i="0"]=e.split(":"),a=Number(i)||0;if(n){if("playlist"===r){const e={list:n,listType:r,index:a};this.autoplay?t.loadPlaylist(e):t.cuePlaylist(e)}else this.autoplay?t.loadVideoById(n,a):t.cueVideoById(n,a);this.loadError=void 0}else t.stopVideo()}))).subscribe(i),this.observeReady().pipe(wr((()=>this.observeVideoSize())),Le((({width:e,height:t})=>this.player.setSize(e,t)))).subscribe(i),this.observeState().pipe(De((e=>e===Sf.ENDED&&this.loop)),Le((()=>this.player.seekTo(0,!0)))).subscribe(i),this.observeState().pipe(De((e=>e===Sf.PLAYING)),Le((()=>this.element.style.visibility=""))).subscribe(i),this.observeState().pipe(yr((()=>{var e;return this.getVideoId((null===(e=this.player)||void 0===e?void 0:e.getVideoUrl())||"")})),Le((e=>this.videoId$.next(e)))).subscribe(i),this.observeError().subscribe(i.error)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e,e&&(this.element.style.visibility="hidden")}get muted(){return gf(this,pf,"f")}set muted(e){gf(this,pf,"f")!==e&&(wf(this,pf,e,"f"),this.player&&(e?this.player.mute():0!==this.volume&&this.player.unMute()))}get volume(){return gf(this,bf,"f")}set volume(e){gf(this,bf,"f")!==e&&(wf(this,bf,e,"f"),this.player&&(this.player.setVolume(100*e),0===e?this.player.mute():this.muted||this.player.unMute()))}observeCurrentTime(){return this.observeState().pipe(_r((e=>{var t;return e===Sf.PLAYING?ir(250-Math.round(1e3*this.player.getCurrentTime())%250,250).pipe(yr((()=>this.player.getCurrentTime())),Ur(this.observeState())):Wr((null===(t=this.player)||void 0===t?void 0:t.getCurrentTime())||0)})))}observeDuration(){return this.observeState().pipe(yr((()=>{var e;return(null===(e=this.player)||void 0===e?void 0:e.getDuration())||0})),De((e=>0!==e)),Sn())}observeEnded(){return this.observeState().pipe(De((e=>e===Sf.ENDED&&!this.loop)),yr((()=>{})))}observeError(){return this.error$}observePlaying(){return this.observeState().pipe(De((e=>e===Sf.PLAYING)),yr((()=>{})))}observeVideoId(){return this.videoId$.pipe(Sn())}appendTo(e){e.appendChild(this.element),this.createPlayer()}load({src:e}){this.logger.log("load",{src:e}),this.player||this.createPlayer(),this.autoplay&&this.player&&e===this.src?this.player.playVideo():this.src$.next(e)}play(){var e;this.logger.log("play"),this.player?this.src===(null===(e=this.loadError)||void 0===e?void 0:e.src)?this.error$.next(this.loadError.error):this.player.playVideo():this.error$.next(Error("YouTube player not loaded"))}pause(){var e;this.logger.log("pause"),null===(e=this.player)||void 0===e||e.pauseVideo()}stop(){var e;this.logger.log("stop"),null===(e=this.player)||void 0===e||e.stopVideo()}seek(e){var t;null===(t=this.player)||void 0===t||t.seekTo(e,!0)}resize(e,t){this.size$.next({width:e,height:t})}destroy(){var e;null===(e=this.player)||void 0===e||e.destroy(),this.element.remove()}get src(){return this.src$.getValue()}observeAspectRatio(){return this.observeVideoId().pipe(_r((e=>e?this.getAspectRatio(e):Wr(kf))),Sn())}observeReady(){return this.ready$.pipe(Rn(1))}observeSize(){return this.size$.pipe(Sn(Ef),De((({width:e,height:t})=>e*t>0)))}observeSrc(){return this.src$.pipe(Sn())}observeState(){return this.state$}observeVideoSize(){return kn([this.observeSize(),this.observeAspectRatio()]).pipe(yr((([{width:e,height:t},r])=>{const n=Math.max(Math.round(e/r),t);return{width:Math.max(Math.round(n*r),e),height:n}})),Sn(Ef))}createPlayer(){if(!this.player&&this.element.isConnected){const e=yf()(this.targetId,{playerVars:xf});e.on("ready",(({target:e})=>{this.player=e,e.setVolume(100*this.volume),(this.muted||0===this.volume)&&e.mute(),this.ready$.next(void 0)})),e.on("stateChange",(({data:e})=>{this.state$.next(e)})),e.on("error",(e=>{this.loadError={src:this.src,error:e},this.error$.next(e)}))}}getAspectRatio(e){return jr(Qo(e)).pipe(Ur(ir(3e3)),Ur(this.observeVideoId().pipe(Md(1))),yr((({aspectRatio:e})=>e||kf)),In((t=>(this.logger.log(`Could not obtain oembed info (videoId=${e}): ${t.message}`),this.loadError={src:this.src,error:t},this.error$.next(t),Wr(kf)))))}getPlayerState(){return this.player?this.player.getPlayerState():Sf.UNSTARTED}getVideoId(e){if(e.startsWith("youtube:video")){const[,,t]=e.split(":");return t}return Eo()(e)||""}};var Af=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};let If=0;class Pf extends Tf{constructor(e){super("loader-"+If++),this.load({src:e})}loadPlaylist(){return Af(this,void 0,void 0,(function*(){return yield this.cue(),this.player.getPlaylist()||[]}))}observeVideoSize(){return Fr}loadDuration(){return Af(this,void 0,void 0,(function*(){return yield this.cue(),this.player.getDuration()||0}))}cue(){return new Promise(((e,t)=>{const r=this.observeCued(),n=Rr(this.observeError(),ir(3e3).pipe(yr((()=>Error("timeout")))));r.pipe(Ur(n),Rn(1)).subscribe({next:e}),n.pipe(Ur(r),Rn(1)).subscribe({next:t}),setTimeout((()=>this.appendTo(document.body)))}))}observeCued(){return this.observeState().pipe(De((e=>e===Sf.CUED)),yr((()=>{})),Rn(1))}}var Cf=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Mf(){const e=(0,n.useRef)(null),[t,r]=(0,n.useState)(""),i=(0,n.useCallback)((t=>Cf(this,void 0,void 0,(function*(){try{t.preventDefault();const n=e.current.value,i=Eo()(n),a=yield Qo(i),s=yield function(e){return Af(this,void 0,void 0,(function*(){const t=new Pf(e);try{return yield t.loadDuration()}finally{t.destroy()}}))}(a.src);yield ff.add(Object.assign(Object.assign({},a),{duration:s})),r("Queued")}catch(e){r(e.message||"This video cannot be embedded")}}))),[]),a=(0,n.useCallback)((()=>{r("");const t=e.current.value;let n="Not a valid YouTube url.";/^https?/.test(t)&&/youtu\.?be/.test(t)&&(n="Not a YouTube video.",Eo()(t)&&(n="")),e.current.setCustomValidity(n)}),[]);return n.createElement("form",{className:"add-youtube-video",onSubmit:i},n.createElement("fieldset",null,n.createElement("legend",null,"Add video from YouTube url:"),n.createElement("p",{className:"text-with-button"},n.createElement("input",{type:"url",required:!0,onInput:a,ref:e}),n.createElement("button",{title:"Add to playlist"},n.createElement(Nt,{name:"playlist-add"}))),n.createElement("p",null,n.createElement("output",null,t))))}function Of(){const{client:e,error:t}=function(){const[e,t]=(0,n.useState)(null),[r,i]=(0,n.useState)(null);return(0,n.useEffect)((()=>{const e=jr(jo()).subscribe({next:t,error:i});return()=>e.unsubscribe()}),[]),{client:e,error:r}}();return n.createElement(n.Fragment,null,n.createElement(Km,{service:Zo}),n.createElement("p",null,"You can still play YouTube videos without being logged in.",n.createElement("br",null),"But you need to be logged in to search for music and access your playlists."),n.createElement(Rm,{service:Zo,disabled:!e}),t?n.createElement("p",{className:"error"},"Could not load Google client library."):null,n.createElement(Mf,null),n.createElement(Um,{service:Zo}))}function Nf({service:e}){return n.createElement("div",{className:"panel"},n.createElement("div",{className:`page login login-${e.id}`},n.createElement($f,{service:e})))}function $f({service:e}){switch(e.id){case"apple":return n.createElement(Vm,null);case"plex":return n.createElement(Ym,null);case"plex-tidal":return n.createElement(qm,null);case"spotify":return n.createElement(Wm,null);case"youtube":return n.createElement(Of,null);default:return n.createElement(Bm,{service:e})}}function zf(e,t){const[r,i]=(0,n.useState)(t),a=(0,n.useMemo)(e,[e]);return(0,n.useEffect)((()=>{const e=a.subscribe(i);return()=>e.unsubscribe()}),[a]),r}function jf({children:e}){return n.createElement("div",{className:"panel empty-screen"},e)}function Lf({error:e,children:t}){return n.createElement("div",{className:"panel error-screen"},n.createElement("div",{className:"error-screen-content"},n.createElement("h2",null,"Error"),n.createElement("pre",{className:"note error"},(null==e?void 0:e.message)||String(e)),t))}function Df({icon:e,children:t}){return n.createElement("h2",{className:"page-header"},n.createElement(Yi,{icon:e,text:t}))}function Ff({min:e="1970",max:t=Rf(),value:r=t,onSelect:i}){const[a,s]=(0,n.useState)((()=>String(new Date(r).getFullYear()))),o=function(e,t){const[r,i]=(0,n.useState)([]);return(0,n.useEffect)((()=>{const r=[],n=new Date(e),a=new Date(t),s=n.getFullYear();let o=a.getFullYear();for(;o>=s;)r.push(o),o--;i(r)}),[e,t]),r}(e,t);(0,n.useEffect)((()=>{null==i||i(a)}),[i,a]);const l=(0,n.useCallback)((e=>{s(e.target.value)}),[]);return n.createElement("span",{className:"year-picker"},n.createElement("select",{defaultValue:a,onChange:l},o.map((e=>n.createElement("option",{value:e,key:e},e)))))}function Rf(){const e=new Date;return String(e.getFullYear())}const _f=(()=>{const e=new Intl.DateTimeFormat(navigator.language,{month:"short"}).format;return[...Array(12).keys()].map((t=>e(new Date(2022,t,2))))})();function Uf({min:e="1970-01",max:t=b(),value:r=t,onSelect:i}){const a=(0,n.useRef)(null),[s,o]=(0,n.useState)((()=>String(new Date(r).getFullYear()))),[l,c]=(0,n.useState)((()=>new Date(r).getMonth())),u=function(e,t,r){const[i,a]=(0,n.useState)([]);return(0,n.useEffect)((()=>{const n=[],i=new Date(t),s=new Date(r),o=Number(e)===i.getFullYear()?i.getMonth():0;let l=Number(e)===s.getFullYear()?s.getMonth():11;for(;l>=o;)n.push(l),l--;a(n)}),[e,t,r]),i}(s,e,t);(0,n.useEffect)((()=>{const e=u[0];void 0!==e&&(a.current.value=String(e),c(e))}),[u]),(0,n.useEffect)((()=>{-1!==l&&(null==i||i(`${s}-${String(l+1).padStart(2,"0")}`))}),[i,s,l]);const d=(0,n.useCallback)((e=>{c(-1),o(e)}),[]),m=(0,n.useCallback)((e=>{c(Number(e.target.value))}),[]);return n.createElement("span",{className:"month-picker"},n.createElement(Ff,{min:e,max:t,value:s,onSelect:d}),n.createElement("select",{defaultValue:l,onChange:m,key:s,ref:a},u.map((e=>n.createElement("option",{value:e,key:e},_f[e])))))}function Vf({min:e="1970-01-01",max:t=p(),value:r=t,onSelect:i}){const a=(0,n.useRef)(null),[s,o]=(0,n.useState)((()=>b(r))),[l,c]=(0,n.useState)((()=>new Date(r).getDate())),u=function(e,t,r){const[i,a]=(0,n.useState)([]);return(0,n.useEffect)((()=>{const n=[],i=new Date(t),s=new Date(r),o=e.split("-").map(Number),l=o[0],c=o[1]-1,u=l===i.getFullYear()&&c===i.getMonth()?i.getDate():1;let d=l===s.getFullYear()&&c===s.getMonth()?s.getDate():new Date(l,c+1,0).getDate();for(;d>=u;)n.push(d),d--;a(n)}),[e,t,r]),i}(s,e,t);(0,n.useEffect)((()=>{const e=u[0];e&&(a.current.value=String(e),c(e))}),[u]),(0,n.useEffect)((()=>{l&&(null==i||i(`${s}-${String(l).padStart(2,"0")}`))}),[i,s,l]);const d=(0,n.useCallback)((e=>{c(0),o(e)}),[]),m=(0,n.useCallback)((e=>{c(Number(e.target.value))}),[]);return n.createElement("span",{className:"date-picker"},n.createElement(Uf,{min:e,max:t,value:s,onSelect:d}),n.createElement("select",{defaultValue:l,onChange:m,key:s,ref:a},u.map((e=>n.createElement("option",{value:e,key:e},e)))))}var Bf,Hf,Yf=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},qf=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};Bf=new WeakMap,Hf=new WeakMap;const Kf=class{constructor(e,t,r,n){this.players=t,this.selectPlayer=r,this.loadPlayer=n,this.player$=new Ne(null),this.error$=new Me,Bf.set(this,!1),Hf.set(this,!1);const i=this.element=document.createElement("div");i.className=e,t.forEach((e=>{e.autoplay=!1,e.muted=!0,e.hidden=!0,e.appendTo(i)}))}get autoplay(){return Yf(this,Bf,"f")}set autoplay(e){qf(this,Bf,e,"f"),this.currentPlayer&&(this.currentPlayer.autoplay=e)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e,this.currentPlayer&&(this.currentPlayer.hidden=e)}get loop(){return this.players[0].loop}set loop(e){this.players.forEach((t=>t.loop=e))}get muted(){return Yf(this,Hf,"f")}set muted(e){qf(this,Hf,e,"f"),this.currentPlayer&&(this.currentPlayer.muted=e)}get volume(){return this.players[0].volume}set volume(e){this.players.forEach((t=>t.volume=e))}observeCurrentTime(){return this.observeCurrentPlayer().pipe(_r((e=>e?e.observeCurrentTime():Wr(0))),Sn())}observeDuration(){return this.observeCurrentPlayer().pipe(_r((e=>e?e.observeDuration():Fr)),Sn())}observeEnded(){return this.observeCurrentPlayer().pipe(_r((e=>e?e.observeEnded():Fr)))}observeError(){return this.observeCurrentPlayer().pipe(_r((e=>e?Rr(this.error$,e.observeError()):Fr)))}observePlaying(){return this.observeCurrentPlayer().pipe(_r((e=>e?e.observePlaying():Fr)))}appendTo(e){e.appendChild(this.element)}load(e){const t=this.currentPlayer,r=this.selectPlayer(e);if(this.player$.next(null),t&&t!==r&&(t.muted=!0,t.hidden=!0,t.stop()),this.player$.next(r),r)try{r.autoplay=this.autoplay,this.loadPlayer(r,e),r.muted=this.muted,r.hidden=this.hidden}catch(e){this.error$.next(e)}else this.error$.next(Error("No player found."))}play(){var e;this.autoplay=!0,null===(e=this.currentPlayer)||void 0===e||e.play()}pause(){var e;this.autoplay=!1,null===(e=this.currentPlayer)||void 0===e||e.pause()}stop(){var e;this.autoplay=!1,null===(e=this.currentPlayer)||void 0===e||e.stop()}seek(e){var t;null===(t=this.currentPlayer)||void 0===t||t.seek(e)}resize(e,t){e*t>0&&this.players.forEach((r=>r.resize(e,t)))}get currentPlayer(){return this.player$.getValue()}observeCurrentPlayer(){return this.player$.pipe(Sn())}};var Wf;Wf=new WeakMap;const Gf=class{constructor(){Wf.set(this,!1),this.loop=!0,this.muted=!0,this.volume=0}get autoplay(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,Wf,"f")}set autoplay(e){!function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)}(this,Wf,e,"f")}observeCurrentTime(){return Fr}observeDuration(){return Fr}observeEnded(){return Fr}observeError(){return Fr}observePlaying(){return Fr}seek(){}};class Jf{constructor(e,t){this.error$=new Me,this.item=null,this.autoplay=!1;const r=this.element=document.createElement(e);r.hidden=!0,r.muted=!0,r.autoplay=!1,r.className=`html5-${e} html5-${e}-${t}`,r.crossOrigin="anonymous",this.logger=new O(`HTML5Player/${e}/${t}`),Ar(r,"error").pipe(yr((()=>r.error))).subscribe(this.error$),this.observeError().subscribe(this.logger.error)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e}get loop(){return this.element.loop}set loop(e){this.element.loop=e}get muted(){return this.element.muted}set muted(e){this.element.muted=e}get volume(){return this.element.volume}set volume(e){this.element.volume=e}observeCurrentTime(){return Ar(this.element,"timeupdate").pipe(yr((()=>this.element.currentTime)),yr((e=>isFinite(e)?e:0)))}observeDuration(){return Ar(this.element,"durationchange").pipe(yr((()=>this.element.duration)),De((e=>isFinite(e))))}observeEnded(){return Ar(this.element,"ended").pipe(yr((()=>{})))}observeError(){return this.error$}observePlaying(){return Ar(this.element,"playing").pipe(yr((()=>{})))}appendTo(e){e.appendChild(this.element)}load(e){this.logger.log("load"),this.item=e;try{if(this.autoplay){const t=this.getMediaSrc(e);this.element.setAttribute("src",t),this.safePlay()}}catch(e){this.error$.next(e)}}play(){this.logger.log("play");try{const e=this.getMediaSrc(this.item);this.element.getAttribute("src")!==e&&this.element.setAttribute("src",e),this.safePlay()}catch(e){this.error$.next(e)}}pause(){this.logger.log("pause"),this.element.pause()}stop(){this.logger.log("stop"),this.element.pause(),this.element.currentTime=0}seek(e){this.element.currentTime=e}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}getMediaSrc(e){var t,r;if(e){const n=Am(e);return null!==(r=null===(t=null==n?void 0:n.getPlayableUrl)||void 0===t?void 0:t.call(n,e))&&void 0!==r?r:e.src}throw Error("No playable item")}safePlay(){return e=this,t=void 0,n=function*(){try{yield this.element.play()}catch(e){this.error$.next(e)}},new((r=void 0)||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}));var e,t,r,n}}const Qf=new D("visualizer/settings"),Xf={get ambientVideoEnabled(){return Qf.getBoolean("ambientVideoEnabled")},set ambientVideoEnabled(e){var t;e!==this.ambientVideoEnabled&&(Qf.setBoolean("ambientVideoEnabled",e),e||("ambientvideo"===this.provider&&Qf.setString("provider",""),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&Qf.removeItem("lockedVisualizer")),Zf.next(this))},get ambientVideoSource(){return Qf.getString("ambientVideoSource")},set ambientVideoSource(e){var t;e!==this.ambientVideoSource&&(Qf.setString("ambientVideoSource",e),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&Qf.removeItem("lockedVisualizer"),Zf.next(this))},get beatsOverlay(){return Qf.getBoolean("beatsOverlay")},set beatsOverlay(e){e!==this.beatsOverlay&&(Qf.setBoolean("beatsOverlay",e),Zf.next(this))},get useAmbientVideoSource(){return Qf.getBoolean("useAmbientVideoSource")},set useAmbientVideoSource(e){var t;e!==this.useAmbientVideoSource&&(Qf.setBoolean("useAmbientVideoSource",e),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&Qf.removeItem("lockedVisualizer"),Zf.next(this))},get lockedVisualizer(){return Qf.getJson("lockedVisualizer")},set lockedVisualizer(e){if(e){const{providerId:t,name:r}=e;Qf.setJson("lockedVisualizer",{providerId:t,name:r})}else Qf.removeItem("lockedVisualizer");Zf.next(this)},get provider(){return Qf.getString("provider")},set provider(e){var t;e!==this.provider&&(Qf.setString("provider",e),e&&(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)!==e&&Qf.removeItem("lockedVisualizer"),Zf.next(this))}},Zf=new Ne(Xf),ep=Xf;function tp(){return Zf}const rp=new Ne({currentItem:null,currentTime:0,startedAt:0,endedAt:0,duration:0,paused:!0});function np(){return rp}function ip(){return np().pipe(De((e=>0!==e.startedAt)),Sn(((e,t)=>e.startedAt===t.startedAt)))}function ap(){return np().pipe(De((e=>0!==e.endedAt)),Sn(((e,t)=>e.endedAt===t.endedAt)))}function sp(e=1e4){return ip().pipe(_r((()=>np().pipe(fa(e,void 0,{trailing:!0}),Ur(ap())))))}function op(){return np().pipe(yr((e=>e.paused)),Sn())}function lp(){const e=rp.getValue();e.startedAt&&(e.endedAt||rp.next(Object.assign(Object.assign({},e),{endedAt:Date.now()})),rp.next(Object.assign(Object.assign({},e),{startedAt:0,endedAt:0})))}nf().subscribe((e=>{lp(),rp.next(Object.assign(Object.assign({},rp.getValue()),{currentItem:e,currentTime:0,duration:(null==e?void 0:e.duration)||0,startedAt:0,endedAt:0}))}));const cp={get paused(){return rp.getValue().paused},observePlaybackState:np,observePlaybackStart:ip,observePlaybackEnd:ap,observePlaybackProgress:sp,observeCurrentTime:function(){return np().pipe(yr((e=>e.currentTime)),Sn())},observeDuration:function(){return np().pipe(yr((e=>e.duration)),Sn())},observePaused:op,getCurrentTime:function(){return rp.getValue().currentTime},setCurrentTime:function(e){const t=rp.getValue();(e=Math.max(Math.min(Math.floor(isFinite(e)?e:0),t.duration),0))!==t.currentTime&&rp.next(Object.assign(Object.assign({},t),{currentTime:e}))},getDuration:function(){return rp.getValue().duration},setDuration:function(e){const t=rp.getValue();if((e=Math.max(Math.floor(isFinite(e)?e:0),0))!==t.duration){const r=Math.min(t.currentTime,e);rp.next(Object.assign(Object.assign({},t),{duration:e,currentTime:r}))}},play:function(){const e=rp.getValue();e.currentItem&&e.paused&&rp.next(Object.assign(Object.assign({},e),{paused:!1}))},pause:function(){const e=rp.getValue();e.paused||rp.next(Object.assign(Object.assign({},e),{paused:!0}))},stop:function(){const e=rp.getValue();if(!e.paused||0!==e.currentTime||0!==e.startedAt&&0===e.endedAt){const t=Object.assign(Object.assign({},e),{paused:!0,currentTime:0,endedAt:e.endedAt||(e.startedAt?Date.now():0)});rp.next(t),e.startedAt&&rp.next(Object.assign(Object.assign({},t),{startedAt:0,endedAt:0}))}},started:function(){const e=rp.getValue();e.startedAt||rp.next(Object.assign(Object.assign({},e),{startedAt:Date.now()}))},ended:lp};function up(e,t,r,n,i){var a=e*e,s=a*e;return((1-3*e+3*a-s)*t+(4-6*a+3*s)*r+(1+3*e+3*a-3*s)*n+s*i)/6}function dp(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),i=e[n],a=e[n+1],s=n>0?e[n-1]:2*i-a,o=n<t-1?e[n+2]:2*a-i;return up((r-n/t)*t,s,i,a,o)}}function mp(e,t){let r;if(void 0===t)for(const t of e)null!=t&&(r>t||void 0===r&&t>=t)&&(r=t);else{let n=-1;for(let i of e)null!=(i=t(i,++n,e))&&(r>i||void 0===r&&i>=i)&&(r=i)}return r}const hp=Math.sqrt(50),fp=Math.sqrt(10),pp=Math.sqrt(2);function bp(e,t,r){const n=(t-e)/Math.max(0,r),i=Math.floor(Math.log10(n)),a=n/Math.pow(10,i),s=a>=hp?10:a>=fp?5:a>=pp?2:1;let o,l,c;return i<0?(c=Math.pow(10,-i)/s,o=Math.round(e*c),l=Math.round(t*c),o/c<e&&++o,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*s,o=Math.round(e/c),l=Math.round(t/c),o*c<e&&++o,l*c>t&&--l),l<o&&.5<=r&&r<2?bp(e,t,2*r):[o,l,c]}function vp(e,t,r){if(!((r=+r)>0))return[];if((e=+e)==(t=+t))return[e];const n=t<e,[i,a,s]=n?bp(t,e,r):bp(e,t,r);if(!(a>=i))return[];const o=a-i+1,l=new Array(o);if(n)if(s<0)for(let e=0;e<o;++e)l[e]=(a-e)/-s;else for(let e=0;e<o;++e)l[e]=(a-e)*s;else if(s<0)for(let e=0;e<o;++e)l[e]=(i+e)/-s;else for(let e=0;e<o;++e)l[e]=(i+e)*s;return l}var yp,gp=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function wp(e){if(!(t=gp.exec(e)))throw new Error("invalid format: "+e);var t;return new Ep({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function Ep(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function kp(e,t){if((r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var r,n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function xp(e,t){var r=kp(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}wp.prototype=Ep.prototype,Ep.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Sp={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>xp(100*e,t),r:xp,s:function(e,t){var r=kp(e,t);if(!r)return e+"";var n=r[0],i=r[1],a=i-(yp=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,s=n.length;return a===s?n:a>s?n+new Array(a-s+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+kp(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Tp(e){return e}var Ap,Ip,Pp=Array.prototype.map,Cp=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Mp(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Op(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Np(e){let t,r,n;function i(e,n,i=0,a=e.length){if(i<a){if(0!==t(n,n))return a;do{const t=i+a>>>1;r(e[t],n)<0?i=t+1:a=t}while(i<a)}return i}return 2!==e.length?(t=Mp,r=(t,r)=>Mp(e(t),r),n=(t,r)=>e(t)-r):(t=e===Mp||e===Op?e:$p,r=e,n=e),{left:i,center:function(e,t,r=0,a=e.length){const s=i(e,t,r,a-1);return s>r&&n(e[s-1],t)>-n(e[s],t)?s-1:s},right:function(e,n,i=0,a=e.length){if(i<a){if(0!==t(n,n))return a;do{const t=i+a>>>1;r(e[t],n)<=0?i=t+1:a=t}while(i<a)}return i}}}function $p(){return 0}Ap=function(e){var t,r,n=void 0===e.grouping||void 0===e.thousands?Tp:(t=Pp.call(e.grouping,Number),r=e.thousands+"",function(e,n){for(var i=e.length,a=[],s=0,o=t[0],l=0;i>0&&o>0&&(l+o+1>n&&(o=Math.max(1,n-l)),a.push(e.substring(i-=o,i+o)),!((l+=o+1)>n));)o=t[s=(s+1)%t.length];return a.reverse().join(r)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",s=void 0===e.decimal?".":e.decimal+"",o=void 0===e.numerals?Tp:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Pp.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"−":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=wp(e)).fill,r=e.align,d=e.sign,m=e.symbol,h=e.zero,f=e.width,p=e.comma,b=e.precision,v=e.trim,y=e.type;"n"===y?(p=!0,y="g"):Sp[y]||(void 0===b&&(b=12),v=!0,y="g"),(h||"0"===t&&"="===r)&&(h=!0,t="0",r="=");var g="$"===m?i:"#"===m&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",w="$"===m?a:/[%p]/.test(y)?l:"",E=Sp[y],k=/[defgprs%]/.test(y);function x(e){var i,a,l,m=g,x=w;if("c"===y)x=E(e)+x,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:E(Math.abs(e),b),v&&(e=function(e){e:for(var t,r=e.length,n=1,i=-1;n<r;++n)switch(e[n]){case".":i=t=n;break;case"0":0===i&&(i=n),t=n;break;default:if(!+e[n])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0==+e&&"+"!==d&&(S=!1),m=(S?"("===d?d:c:"-"===d||"("===d?"":d)+m,x=("s"===y?Cp[8+yp/3]:"")+x+(S&&"("===d?")":""),k)for(i=-1,a=e.length;++i<a;)if(48>(l=e.charCodeAt(i))||l>57){x=(46===l?s+e.slice(i+1):e.slice(i))+x,e=e.slice(0,i);break}}p&&!h&&(e=n(e,1/0));var T=m.length+e.length+x.length,A=T<f?new Array(f-T+1).join(t):"";switch(p&&h&&(e=n(A+e,A.length?f-x.length:1/0),A=""),r){case"<":e=m+e+x+A;break;case"=":e=m+A+e+x;break;case"^":e=A.slice(0,T=A.length>>1)+m+e+x+A.slice(T);break;default:e=A+m+e+x}return o(e)}return b=void 0===b?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b)),x.toString=function(){return e+""},x}return{format:d,formatPrefix:function(e,t){var r,n=d(((e=wp(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor((r=t,((r=kp(Math.abs(r)))?r[1]:NaN)/3)))),a=Math.pow(10,-i),s=Cp[8+i/3];return function(e){return n(a*e)+s}}}}({thousands:",",grouping:[3],currency:["$",""]}),Ip=Ap.format,Ap.formatPrefix;const zp=Np(Mp),jp=zp.right,Lp=(zp.left,Np((function(e){return null===e?NaN:+e})).center,jp);function Dp(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function Fp(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function Rp(){}var _p=.7,Up=1/_p,Vp="\\s*([+-]?\\d+)\\s*",Bp="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Hp="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Yp=/^#([0-9a-f]{3,8})$/,qp=new RegExp(`^rgb\\(${Vp},${Vp},${Vp}\\)$`),Kp=new RegExp(`^rgb\\(${Hp},${Hp},${Hp}\\)$`),Wp=new RegExp(`^rgba\\(${Vp},${Vp},${Vp},${Bp}\\)$`),Gp=new RegExp(`^rgba\\(${Hp},${Hp},${Hp},${Bp}\\)$`),Jp=new RegExp(`^hsl\\(${Bp},${Hp},${Hp}\\)$`),Qp=new RegExp(`^hsla\\(${Bp},${Hp},${Hp},${Bp}\\)$`),Xp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Zp(){return this.rgb().formatHex()}function eb(){return this.rgb().formatRgb()}function tb(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=Yp.exec(e))?(r=t[1].length,t=parseInt(t[1],16),6===r?rb(t):3===r?new ab(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===r?nb(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===r?nb(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=qp.exec(e))?new ab(t[1],t[2],t[3],1):(t=Kp.exec(e))?new ab(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Wp.exec(e))?nb(t[1],t[2],t[3],t[4]):(t=Gp.exec(e))?nb(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Jp.exec(e))?db(t[1],t[2]/100,t[3]/100,1):(t=Qp.exec(e))?db(t[1],t[2]/100,t[3]/100,t[4]):Xp.hasOwnProperty(e)?rb(Xp[e]):"transparent"===e?new ab(NaN,NaN,NaN,0):null}function rb(e){return new ab(e>>16&255,e>>8&255,255&e,1)}function nb(e,t,r,n){return n<=0&&(e=t=r=NaN),new ab(e,t,r,n)}function ib(e,t,r,n){return 1===arguments.length?((i=e)instanceof Rp||(i=tb(i)),i?new ab((i=i.rgb()).r,i.g,i.b,i.opacity):new ab):new ab(e,t,r,null==n?1:n);var i}function ab(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}function sb(){return`#${ub(this.r)}${ub(this.g)}${ub(this.b)}`}function ob(){const e=lb(this.opacity);return`${1===e?"rgb(":"rgba("}${cb(this.r)}, ${cb(this.g)}, ${cb(this.b)}${1===e?")":`, ${e})`}`}function lb(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function cb(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ub(e){return((e=cb(e))<16?"0":"")+e.toString(16)}function db(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new hb(e,t,r,n)}function mb(e){if(e instanceof hb)return new hb(e.h,e.s,e.l,e.opacity);if(e instanceof Rp||(e=tb(e)),!e)return new hb;if(e instanceof hb)return e;var t=(e=e.rgb()).r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),a=Math.max(t,r,n),s=NaN,o=a-i,l=(a+i)/2;return o?(s=t===a?(r-n)/o+6*(r<n):r===a?(n-t)/o+2:(t-r)/o+4,o/=l<.5?a+i:2-a-i,s*=60):o=l>0&&l<1?0:s,new hb(s,o,l,e.opacity)}function hb(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}function fb(e){return(e=(e||0)%360)<0?e+360:e}function pb(e){return Math.max(0,Math.min(1,e||0))}function bb(e,t,r){return 255*(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)}Dp(Rp,tb,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Zp,formatHex:Zp,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return mb(this).formatHsl()},formatRgb:eb,toString:eb}),Dp(ab,ib,Fp(Rp,{brighter(e){return e=null==e?Up:Math.pow(Up,e),new ab(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?_p:Math.pow(_p,e),new ab(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new ab(cb(this.r),cb(this.g),cb(this.b),lb(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:sb,formatHex:sb,formatHex8:function(){return`#${ub(this.r)}${ub(this.g)}${ub(this.b)}${ub(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:ob,toString:ob})),Dp(hb,(function(e,t,r,n){return 1===arguments.length?mb(e):new hb(e,t,r,null==n?1:n)}),Fp(Rp,{brighter(e){return e=null==e?Up:Math.pow(Up,e),new hb(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?_p:Math.pow(_p,e),new hb(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new ab(bb(e>=240?e-240:e+120,i,n),bb(e,i,n),bb(e<120?e+240:e-120,i,n),this.opacity)},clamp(){return new hb(fb(this.h),pb(this.s),pb(this.l),lb(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=lb(this.opacity);return`${1===e?"hsl(":"hsla("}${fb(this.h)}, ${100*pb(this.s)}%, ${100*pb(this.l)}%${1===e?")":`, ${e})`}`}}));const vb=e=>()=>e;function yb(e,t){var r=t-e;return r?function(e,t){return function(r){return e+r*t}}(e,r):vb(isNaN(e)?t:e)}const gb=function e(t){var r=function(e){return 1==(e=+e)?yb:function(t,r){return r-t?function(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}(t,r,e):vb(isNaN(t)?r:t)}}(t);function n(e,t){var n=r((e=ib(e)).r,(t=ib(t)).r),i=r(e.g,t.g),a=r(e.b,t.b),s=yb(e.opacity,t.opacity);return function(t){return e.r=n(t),e.g=i(t),e.b=a(t),e.opacity=s(t),e+""}}return n.gamma=e,n}(1);function wb(e){return function(t){var r,n,i=t.length,a=new Array(i),s=new Array(i),o=new Array(i);for(r=0;r<i;++r)n=ib(t[r]),a[r]=n.r||0,s[r]=n.g||0,o[r]=n.b||0;return a=e(a),s=e(s),o=e(o),n.opacity=1,function(e){return n.r=a(e),n.g=s(e),n.b=o(e),n+""}}}function Eb(e,t){var r,n=t?t.length:0,i=e?Math.min(n,e.length):0,a=new Array(i),s=new Array(n);for(r=0;r<i;++r)a[r]=Cb(e[r],t[r]);for(;r<n;++r)s[r]=t[r];return function(e){for(r=0;r<i;++r)s[r]=a[r](e);return s}}function kb(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function xb(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function Sb(e,t){var r,n={},i={};for(r in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)r in e?n[r]=Cb(e[r],t[r]):i[r]=t[r];return function(e){for(r in n)i[r]=n[r](e);return i}}wb(dp),wb((function(e){var t=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*t),i=e[(n+t-1)%t],a=e[n%t],s=e[(n+1)%t],o=e[(n+2)%t];return up((r-n/t)*t,i,a,s,o)}}));var Tb=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Ab=new RegExp(Tb.source,"g");function Ib(e,t){var r,n,i,a=Tb.lastIndex=Ab.lastIndex=0,s=-1,o=[],l=[];for(e+="",t+="";(r=Tb.exec(e))&&(n=Ab.exec(t));)(i=n.index)>a&&(i=t.slice(a,i),o[s]?o[s]+=i:o[++s]=i),(r=r[0])===(n=n[0])?o[s]?o[s]+=n:o[++s]=n:(o[++s]=null,l.push({i:s,x:xb(r,n)})),a=Ab.lastIndex;return a<t.length&&(i=t.slice(a),o[s]?o[s]+=i:o[++s]=i),o.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var r,n=0;n<t;++n)o[(r=l[n]).i]=r.x(e);return o.join("")})}function Pb(e,t){t||(t=[]);var r,n=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(r=0;r<n;++r)i[r]=e[r]*(1-a)+t[r]*a;return i}}function Cb(e,t){var r,n,i=typeof t;return null==t||"boolean"===i?vb(t):("number"===i?xb:"string"===i?(r=tb(t))?(t=r,gb):Ib:t instanceof tb?gb:t instanceof Date?kb:(n=t,!ArrayBuffer.isView(n)||n instanceof DataView?Array.isArray(t)?Eb:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Sb:xb:Pb))(e,t)}function Mb(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function Ob(e){return+e}var Nb=[0,1];function $b(e){return e}function zb(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:(r=isNaN(t)?NaN:.5,function(){return r});var r}function jb(e,t,r){var n=e[0],i=e[1],a=t[0],s=t[1];return i<n?(n=zb(i,n),a=r(s,a)):(n=zb(n,i),a=r(a,s)),function(e){return a(n(e))}}function Lb(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),a=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<n;)i[s]=zb(e[s],e[s+1]),a[s]=r(t[s],t[s+1]);return function(t){var r=Lp(e,t,1,n)-1;return a[r](i[r](t))}}function Db(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Fb(e){return Math.log(e)}function Rb(e){return Math.exp(e)}function _b(e){return-Math.log(-e)}function Ub(e){return-Math.exp(-e)}function Vb(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Bb(e){return(t,r)=>-e(-t,r)}function Hb(){const e=function(e){const t=e(Fb,Rb),r=t.domain;let n,i,a=10;function s(){return n=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}(a),i=function(e){return 10===e?Vb:e===Math.E?Math.exp:t=>Math.pow(e,t)}(a),r()[0]<0?(n=Bb(n),i=Bb(i),e(_b,Ub)):e(Fb,Rb),t}return t.base=function(e){return arguments.length?(a=+e,s()):a},t.domain=function(e){return arguments.length?(r(e),s()):r()},t.ticks=e=>{const t=r();let s=t[0],o=t[t.length-1];const l=o<s;l&&([s,o]=[o,s]);let c,u,d=n(s),m=n(o);const h=null==e?10:+e;let f=[];if(!(a%1)&&m-d<h){if(d=Math.floor(d),m=Math.ceil(m),s>0){for(;d<=m;++d)for(c=1;c<a;++c)if(u=d<0?c/i(-d):c*i(d),!(u<s)){if(u>o)break;f.push(u)}}else for(;d<=m;++d)for(c=a-1;c>=1;--c)if(u=d>0?c/i(-d):c*i(d),!(u<s)){if(u>o)break;f.push(u)}2*f.length<h&&(f=vp(s,o,h))}else f=vp(d,m,Math.min(m-d,h)).map(i);return l?f.reverse():f},t.tickFormat=(e,r)=>{if(null==e&&(e=10),null==r&&(r=10===a?"s":","),"function"!=typeof r&&(a%1||null!=(r=wp(r)).precision||(r.trim=!0),r=Ip(r)),e===1/0)return r;const s=Math.max(1,a*e/t.ticks().length);return e=>{let t=e/i(Math.round(n(e)));return t*a<a-.5&&(t*=a),t<=s?r(e):""}},t.nice=()=>r(function(e,t){var r,n=0,i=(e=e.slice()).length-1,a=e[n],s=e[i];return s<a&&(r=n,n=i,i=r,r=a,a=s,s=r),e[n]=t.floor(a),e[i]=t.ceil(s),e}(r(),{floor:e=>i(Math.floor(n(e))),ceil:e=>i(Math.ceil(n(e)))})),t}(function(){var e,t,r,n,i,a,s=Nb,o=Nb,l=Cb,c=$b;function u(){var e,t,r,l=Math.min(s.length,o.length);return c!==$b&&(e=s[0],t=s[l-1],e>t&&(r=e,e=t,t=r),c=function(r){return Math.max(e,Math.min(t,r))}),n=l>2?Lb:jb,i=a=null,d}function d(t){return null==t||isNaN(t=+t)?r:(i||(i=n(s.map(e),o,l)))(e(c(t)))}return d.invert=function(r){return c(t((a||(a=n(o,s.map(e),xb)))(r)))},d.domain=function(e){return arguments.length?(s=Array.from(e,Ob),u()):s.slice()},d.range=function(e){return arguments.length?(o=Array.from(e),u()):o.slice()},d.rangeRound=function(e){return o=Array.from(e),l=Mb,u()},d.clamp=function(e){return arguments.length?(c=!!e||$b,u()):c!==$b},d.interpolate=function(e){return arguments.length?(l=e,u()):l},d.unknown=function(e){return arguments.length?(r=e,d):r},function(r,n){return e=r,t=n,u()}}()).domain([1,10]);return e.copy=()=>{return(t=e,r=Hb(),r.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())).base(e.base());var t,r},Db.apply(e,arguments),e}var Yb=r(4843);const qb=[16.35,17.32,18.35,19.45,20.6,21.83,23.12,24.5,25.96,27.5,29.14,30.87].map(((e,t)=>{const r=[{index:t,value:e}];for(let n=1;n<12;n++)r[n]={index:t,value:e*Math.pow(2,n)};return r})).flat().sort(((e,t)=>e.value-t.value));function Kb(e,t,r){return function(e,t){const r=e*t,n=r+t,i=qb.filter((e=>e.value>=r&&e.value<n));if(i.length>0)return i.map((({index:e})=>({index:e,value:1})));for(let e=0;e<qb.length;e++){const t=qb[e];if(t.value>n){const i=qb[e-1],a=t.value-i.value;return[{index:i.index,value:1-(n-i.value)/a},{index:t.index,value:1-(t.value-r)/a}]}}return[]}(t,r).map((({index:t,value:r})=>e[t]*r)).reduce(((e,t)=>e+t),0)}var Wb,Gb=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};Wb=new WeakMap;const Jb=new class{constructor(e){this.intervalTypes=["bars","beats","sections","segments","tatums"],this.animationFrameId=0,this.currentTrackId="",this.currentTrackAnalysis=null,this.trackAnalysis={},this.initialTrackProgress=0,this.initialStart=0,this.trackProgress=0,this.active=!1,this.queues={volume:[],beat:[]},this.activeIntervals$=new Ne({bars:{},beats:{},sections:{},segments:{},tatums:{}}),Wb.set(this,0),this.fftSize=2048,this.volumeSmoothing=100,e.observeCurrentTrackState().subscribe((t=>Gb(this,void 0,void 0,(function*(){var r,n;const i=null===(n=null===(r=null==t?void 0:t.track_window)||void 0===r?void 0:r.current_track)||void 0===n?void 0:n.id;if(i&&this.currentTrackId!==i){this.currentTrackId=i,this.currentTrackAnalysis=null;try{this.currentTrackAnalysis=yield Hu.getAudioAnalysisForTrack(i),t=yield e.getCurrentState()}catch(e){console.error(e),this.currentTrackAnalysis=null,t=null}}t&&this.currentTrackAnalysis&&this.updateState(t),this.active=!(!this.currentTrackAnalysis||!t||t.paused||t.loading),this.active?this.start():this.stop()}))))}get bar(){return this.activeIntervals.bars}get beat(){return this.activeIntervals.beats}get frequencyBinCount(){return this.fftSize/2}get section(){return this.activeIntervals.sections}get segment(){return this.activeIntervals.segments}get tatum(){return this.activeIntervals.tatums}get volume(){return function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)}(this,Wb,"f")}observeBar(){return this.observeActiveIntervals().pipe(yr((e=>e.bars)),Sn())}observeBeat(){return this.observeActiveIntervals().pipe(yr((e=>e.beats)),Sn())}observeSection(){return this.observeActiveIntervals().pipe(yr((e=>e.sections)),Sn())}observeSegment(){return this.observeActiveIntervals().pipe(yr((e=>e.segments)),Sn())}observeTatum(){return this.observeActiveIntervals().pipe(yr((e=>e.tatums)),Sn())}getByteFrequencyData(e){if(!this.active)return void e.fill(0);const t=this.segment.pitches;if(t){const r=dp([.5,1,.5])(this.beat.progress)*this.volume,n=(this.segment.timbre[1]-180)/360,i=this.frequencyBinCount;for(let a=0;a<i;a++){let s=(a-i/2-n*i)/i+1;(s<0||s>2)&&(s=0);const o=Math.sin(s*(Math.PI/2)),l=Kb(t,a,this.sampleSize);e[a]=(l+o)/2*255*r}}else e.fill(0)}getFloatFrequencyData(e){if(!this.active)return void e.fill(0);const t=e.length,r=new Uint8Array(t);this.getByteFrequencyData(r);for(let n=0;n<t;n++)e[n]=r[n]-128}getByteTimeDomainData(e){if(!this.active)return void e.fill(0);const t=e.length,r=new Float32Array(t);this.getFloatTimeDomainData(r);const n=Uint8Array.from(r);for(let r=0;r<t;r++)e[r]=n[r]}getFloatTimeDomainData(e){if(!this.active)return void e.fill(0);const t=e.length,r=new Float32Array(t);this.getFloatFrequencyData(r);const{real:n,imag:i}=(0,Yb.rS)(r);for(let r=0;r<t;r++)e[r]=Math.sqrt(n[r]*n[r]+i[r]*i[r])-128}get activeIntervals(){return this.activeIntervals$.getValue()}get sampleSize(){return 22050/this.frequencyBinCount}observeActiveIntervals(){return op().pipe(_r((e=>e?Fr:this.activeIntervals$)),De((()=>this.active)))}updateState(e){return Gb(this,void 0,void 0,(function*(){this.trackAnalysis=JSON.parse(JSON.stringify(this.currentTrackAnalysis)),this.intervalTypes.forEach((e=>{const t=this.trackAnalysis[e];t[0].duration=t[0].start+t[0].duration,t[0].start=0,t.forEach((e=>{this.isSegment(e)&&(e.loudness_max_time=1e3*e.loudness_max_time),e.start=1e3*(e.start||0),e.duration=1e3*(e.duration||0)}))})),this.initialTrackProgress=e.position,this.trackProgress=e.position,this.initialStart=window.performance.now()}))}setActiveIntervals(){const e=this.activeIntervals,t=e=>{const t=this.trackAnalysis[e],r=this.trackProgress;for(let e=0;e<t.length;e++){if(e===t.length-1)return e;if(t[e].start<r&&r<t[e+1].start)return e}return 0};this.intervalTypes.forEach((r=>{const n=t(r);null!=e[r].start&&n===e[r].index||(e[r]=Object.assign(Object.assign({},this.trackAnalysis[r][n]),{index:n}));const{start:i,duration:a}=e[r],s=this.trackProgress-i;e[r].elapsed=s,e[r].progress=this.easeOutQuart(s/a)})),this.activeIntervals$.next(e)}getVolume(){const{loudness_max:e,loudness_start:t,loudness_max_time:r,duration:n,elapsed:i,start:a,index:s}=this.activeIntervals.segments;if(!this.trackAnalysis.segments[s+1])return 0;const o=this.trackAnalysis.segments[s+1].loudness_start,l=a+i;if(i<r){const n=Math.min(1,i/r);return this.interpolate(t,e)(n)}{const t=l-(a+r),i=n-r,s=Math.min(1,t/i);return this.interpolate(e,o)(s)}}start(){this.animationFrameId||(this.animationFrameId=requestAnimationFrame((e=>this.tick(e))))}stop(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}tick(e){if(this.animationFrameId=requestAnimationFrame((e=>this.tick(e))),!this.active)return;this.trackProgress=e-this.initialStart+this.initialTrackProgress,this.setActiveIntervals();const t=this.getVolume(),r=this.queues;function n(e){return e.reduce(((e,t)=>e+t))/e.length}r.volume.unshift(t),r.volume.length>400&&r.volume.pop(),r.beat.unshift(t),r.beat.length>this.volumeSmoothing&&r.beat.pop();const i=Hb().domain([mp(r.volume),n(r.volume)]).range([0,1]),a=n(r.beat);!function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?i.call(e,r):i?i.value=r:t.set(e,r)}(this,Wb,i(a)||0,"f")}interpolate(e,t){return r=>e*(1-r)+t*r}isSegment(e){return"loudness_max_time"in e}easeOutQuart(e){return e=Math.min(Math.max(0,e),1),1- --e*e*e*e}}(Bd);class Qb extends AnalyserNode{constructor(e,t){super(e,t),this.isPlayingSpotify=!1,ip().subscribe((({currentItem:e})=>{this.isPlayingSpotify=!!(null==e?void 0:e.src.startsWith("spotify:"))}))}getByteFrequencyData(e){this.isPlayingSpotify?Jb.getByteFrequencyData(e):super.getByteFrequencyData(e)}getFloatFrequencyData(e){this.isPlayingSpotify?Jb.getFloatFrequencyData(e):super.getFloatFrequencyData(e)}getByteTimeDomainData(e){this.isPlayingSpotify?Jb.getByteTimeDomainData(e):super.getByteTimeDomainData(e)}getFloatTimeDomainData(e){this.isPlayingSpotify?Jb.getFloatTimeDomainData(e):super.getFloatTimeDomainData(e)}}class Xb extends AudioContext{createAnalyser(e){return new Qb(this,e)}}const Zb=new Xb,ev=Zb.createAnalyser({fftSize:2048,smoothingTimeConstant:0});let tv,rv;ev.connect(Zb.destination);const nv=new Ne(Zb.createMediaElementSource(new Audio));function iv(){return nv.pipe(Sn())}ip().subscribe((({currentItem:e})=>{if(null==e?void 0:e.src.startsWith("apple:")){if(!rv){const e=document.querySelector("audio#apple-music-player");e&&(rv=Zb.createMediaElementSource(e))}rv&&nv.next(rv)}else{if(!tv){const e=document.querySelector("audio.html5-audio");e&&(tv=Zb.createMediaElementSource(e))}tv&&nv.next(tv)}})),iv().pipe(Md(1)).subscribe((e=>e.connect(ev)));const av=new O("WaveformPlayer");class sv extends Gf{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.currentVisualizer="",this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-waveform"}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e||this.animationFrameId||this.render())}appendTo(e){e.append(this.canvas)}load(e){e&&(av.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.config=e.config,this.render()))}play(){av.log("play"),this.animationFrameId||this.render()}pause(){av.log("pause"),this.cancelAnimation()}stop(){av.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.renderFrame()}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(e=performance.now()){this.renderFrame(e),this.autoplay&&!this.hidden&&(this.animationFrameId=requestAnimationFrame((e=>this.render(e))))}renderFrame(e=performance.now()){var t,r;const n=this.context2D,i=this.canvas.width,a=this.canvas.height,s=this.analyser;null===(r=null===(t=this.config)||void 0===t?void 0:t.onPaint)||void 0===r||r.call(t,{context2D:n,width:i,height:a,now:e,analyser:s})}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}const ov=new sv(ev);ov.load({providerId:"waveform",name:"beats",config:{onPaint:({context2D:e,width:t,height:r,analyser:n})=>{const i=n.frequencyBinCount,a=new Uint8Array(i);n.getByteFrequencyData(a),e.clearRect(0,0,t,r),e.fillStyle=`rgba(255, 255, 255, ${document.fullscreenElement?.45:.6})`,e.strokeStyle="rgba(0, 0, 0, .9)",e.shadowColor="rgba(0, 0, 0, .6)",e.lineWidth=1,e.shadowBlur=2,e.shadowOffsetX=2,e.shadowOffsetY=2;const s=(t-48)/12,o=.0075*r,l=i/12;let c,u=4;for(let t=0;t<i;t+=l){const n=a.slice(t,t+l).reduce(((e,t)=>e+t),0)/l;c=o*n,e.fillRect(u,r-c/2,s,c/2+4),e.strokeRect(u,r-c/2,s,c/2+4),u+=s+4}}}});const lv=ov,cv=new O("ambientVideoPlayer"),uv=new Jf("video","ambient"),dv=new Tf("ambient"),mv=new D("ambientVideoPlayer");function hv(){return ep.useAmbientVideoSource&&ep.ambientVideoSource?"user-progress":"progress"}const fv=new Kf("ambient-video-player",[uv,dv,lv],(function(e){return e?e.src.startsWith("youtube:")?dv:uv:null}),(function(e,t){const r=t.src;if(r.startsWith("youtube:")){const[,,t]=r.split(":"),n=hv(),i=mv.getJson(n,{})[t]||("progress"===n?120:0);e.load({src:`${r}:${i}`})}else e.load({src:r})}));fv.loop=!0,fv.volume=0,fv.hidden=!0;const pv=new class extends Gf{constructor(e,t){super(),this.videoPlayer=e,this.beatsPlayer=t,tp().pipe(yr((e=>e.beatsOverlay)),Sn()).subscribe((e=>{this.beatsPlayer.hidden=this.hidden||!e}))}get autoplay(){return this.videoPlayer.autoplay}set autoplay(e){this.videoPlayer.autoplay=e,this.beatsPlayer.autoplay=e}get hidden(){return this.videoPlayer.hidden}set hidden(e){this.videoPlayer.hidden=e,this.beatsPlayer.hidden=e||!ep.beatsOverlay}observeCurrentTime(){return this.videoPlayer.observeCurrentTime()}observeDuration(){return this.videoPlayer.observeDuration()}observeEnded(){return this.videoPlayer.observeEnded()}observeError(){return this.videoPlayer.observeError()}observePlaying(){return this.videoPlayer.observePlaying()}appendTo(e){this.videoPlayer.appendTo(e)}load(e){this.videoPlayer.load(e),this.autoplay&&ep.beatsOverlay&&this.beatsPlayer.play()}play(){this.videoPlayer.play(),ep.beatsOverlay&&this.beatsPlayer.play()}pause(){this.videoPlayer.pause(),this.beatsPlayer.pause()}stop(){this.videoPlayer.stop(),this.beatsPlayer.stop()}resize(e,t){this.videoPlayer.resize(e,t);const r=document.fullscreenElement?20:10;this.beatsPlayer.resize(Tt.fontSize*r,Tt.fontSize*r*.225)}}(fv,lv);dv.observeVideoId().pipe(_r((e=>e?dv.observeCurrentTime().pipe(yr(Math.round),Sn(),De((e=>e>0&&e%30==0)),Cd(dv.observeDuration()),De((([,e])=>e>600)),Le((([t])=>{const r=hv(),n=mv.getJson(r,{});n[e]=t,mv.setJson(r,n)}))):Fr))).subscribe(cv),tp().pipe(yr((e=>e.ambientVideoSource)),Sn(),Md(1),Le((()=>mv.removeItem("user-progress")))).subscribe(cv);const bv="\nmo2re_RX3Bs blXien2Jh_o etiatMRgFcM DYsMJiwiZSI _MZ7UZ5frCI HCx1Z92PjJE dIP7wWY4Znw gW4nffCscYs\nA1m0SEqmmbE 9uZ8CCa0t4Y 35CTu7dWzo8 wz_ItcoR0-c jS4-FmNEDKo Tz77vqH_LJw K73lfmxDVR0 W8ayfyRWUrg\ncbuldALGsaQ AJZon2grzmA H5ASEM9dMiA GE2YEq7vaLc MYGOdJNAzrI Oszl95YWfbs b0-IkxXyhmY hoYPURX2RuE\nH6Xy97CD9Hs p-OUNPqRzII XaTxLSPh_Is 1n3ezT1cvAM CWU1pZVw0xM ry1Q7KaQdxM VlC5LSTvoj0 j-bG0j3-KzE\n1bClbVe4QyI f6OZ01vvmko o4jE24WixcI BIej9P2LrzM dxw91a7C5BQ lN9LdcAQnjw VVkZKzTbWQs vXCB1zGGFiY\nJHARFKMl8dU KSB1AZ0-I74 IGqfU6cJJc8 8zg22-ZCUfE WMlR8eJRS3I l4D6bnIdehk A5pbF_YBulo dRFRsKobN9I\nBur1ChHBNsQ IlDvBTDGanI SqMzG8xsynw mOmwk3WyYnw im2eWwIiTOc lxQS58t39_U yk076o8NF3k oggiHfuV4m8\np_GnUkm-G1M xVMsAgHy_IY VdZkfef44JI ZxOd8tmdsIM fszuqfJWKxc 0LGL_lx9XcA i_hU5eUrVIs qtwWkv9OdF0\nuZjCNtOeZG4 ZpXnEvW0XD0 -C8TYbhnVTU WzxSiEWK3cg ZE8vuq4aqNA 7HMw3bcIgRE ZJiCEDweLl8 lyh2kAjcmSY\nvFwqZ4qAUkE QLbPYQcUcgM xwf7EssFnXU n_7gkhSjSjY vvm8b2jAfv0 XkRFSnxXQ_w Ee0Qh_nIoHw 78rppSvbh7A\nNXIaYDJql1c VWHTlq5Fcr8 ZkRjihsMdp8 e1M6jHcRrlM z9Ug-3qhrwY mA30W2dHQIo XIhEPwTMjWk -Tm4H4CrKT0\nT6tapzmF_n0 7QetsPh7BPM xBDqge4w-XA suWbFuw1O_I OvStKpL5Ujo ZX8fSO8uTPg xX9xfFT-Qw0 hf3r9TNSsyY\n-WIamcIaipI Zjc6DwVDvq0 eHjoav_sb88 7E0WVROBsEE BvLIJSmzAnY YPurG3WT8xI 0ocUnSG4oQQ EkmJlmU7uqw\naC7s2UVXt3c EJArkl7K29k 9eFVeErnUzg CLDzwdixWsk B1-yyoNMUzs Ab5I38wGxko sVuqgnXD9AE yMcNorxM9IQ\nY0U0HAwpw2s G20ZaQfTWgs Nde5P8Ob2xg f-Xul0mdBCA ExStG9rRkoY tMzCwwvHwN0 iaVmsp7dU1Y TV4J01qGE8E\nMPch_urCew8 eYpCCSAW3aw XfBNIrQ5JKQ -b68N6Q4Qus H3mdjo7kYiQ 9CJLtzzUphU yy-aMo2ds2k fVRSSNkq3Bk\nLtPGmDskDiY U9rtWGI6H5A NHa506wwN0Y sFSrJSEFXu8 ubQKAfwSLDA aFsNz5VMyC8 h6yhFP_qUro GlotnVckHG4\nPEgQ0dIOB5c KWz3SXWnFys MGRDy2PqCGk 4DcMcAHrURw ETwbuC3p1ls iszl1WqjQIk njcvxMb8TVQ Vpi5By3PG68\nhNNN5xPyyeY 8ls8xBn70gM 2XREaQqoU1U MXL2qjIL4qI 9YqbQcfIre0 nAMkwo2eSbY 8DRItK-C7vU WdtkaLxc464\nPaIH77c53LA FSlhSL8bFoI XLuV3_a-ro0 mo7mUJZV6DM IqWPDr8KCmQ v-QS_Kh_i6o zowLNSKyfI0 Xn8tufsbSz0\n7gG4l70v8mw thurNCHVo08 YgryBZTMVZY XAmU3yQc90M KBUg3U3MRao v_My9t4gadA Xwb1xsWClCM KlH1g1x6RJk\nyFqew9NnNvk LMSmWzCqlPE oN3glsVrnRY PPBV3hem5iM eqzVRpevI8s nSJ67PGjQfQ EoBF2xRsbAc KDUYy3xwCFs\nRZOcoZS_52Q pSP9_otXcTU H36qe8NatNQ qgfd-uWTVwg Blu_yCEFYvk HeYMIBFtwh4 fb0QX7DbqLg kdqyAA0ILD4\nriZWEoGKyuU 4qo9bKRxgYA t0j_GdkG1BM hLq9J32lGRs zfc53CpvlZ4 IjNKQbm4AQ8 hg2FDCmqNkg tG991Undnbc\nsh8l2-cCAGQ XDE5pd4V_xc C2BVXFIX7bY ySPxZpoqXZ8 hiEUaLX4cCM 3F4l-6GwkKM F399teRPBaY 2jw2eAIW8sU\nWsCCYv2adkM wmV7Po_E0pw 9Rvtm2zGEl4 DGlAMkUjcY0 h2s_WOkfTXk 0VhxPdtX0xg 6vuFh6NNa70 ukOHqdPbYYg\nH6OmEQ8RqVk qPp315pPVSI FQqj6gN7M6M Xrwks9O2-JQ ipRwt3TDgY4 aVqRyfRviwA X33dmu12C5c QEwzFKoG7tk\nh98nR30UD8Q Z7WpAwRjprI ilqlSBYfCGs V6SoeDWDon0 d-Hwz42Vfw4 RCdAP0e4W4w 22dlye7h3qU p7l6JQApzak\nblSZ365wpfQ ADF4KgfhzPs jSRvD7Uma1g uLMC6bL_q38 k9DuPxFQ7HQ 7f2taFPyqxc vHf4WQtJvdI NXg0IKlrz-Q\nORHIVufNfRM RT4hEmX5OJ0 H3GL5jO53NU acTsYqhq-AA vp2yiZnjK0w eR5vsN1Lq4E yyNl2HuCTHk 55w2VtMNuvY\n7qXiAaxxGBs m6m6bqHiT6U l5jUOT0XiUM NLxwmtJSvk4 dv_QzcJGHAE kaPD4n9uQ2k r7HpeG2ofU0 O1AQcFpPs04\n44ih4WRTyGg W5BmjLsEsB0 JkNlFaei_k8 2ttB1FzBpZ4 k3Q1vse7In8 7xltSb3VBJQ ojbiGfhnjTU _Qb7TJ-T1HM\ngvT3gIDSwq8 4X95pykbYTY BPDznHIgVMA OIA5xQWkk2U 2uQ58Xwx1V4 UVjCFpYMR6A -uww0BzTb7g EqWBy5i8LyQ\nszErNcJMCdA 5k1DGpr_qDw YNEkjkh0bYo jmjrpHYegzc eXcbc2gmDsA rVLOQB5kGGw F8MN0o6RS9o viim_l9gbF8\nsBtYWK817-0 g0IvwhzSIW0 y7vz1qQGUd8 -0ewPjoBBNI S1emxk9UWBE 1muEwEFDKgk P0MbbslO62E TX9U62sj5nM\nwwXpkTd1CaQ W2A_PcIhUVM ZIb8u6uJwBo TWjid2dVjMk gdJjc6l6iII n3Dru5y3ROc OOf4Z7tyLVM iDXDrTKJehk\nwYhliE9O_3k nw0uvJZonBc cK7x6lUUsYo ltNMSx_imZU e2AUzM6QgGs 3cxyYOXiJss AsD5u6k6dKI d_hx39kXDUg\nhlvfDL3nSoo 6L2xYzu724E URy2Ak-WRpE 9N-sp0FaZEA yttvb9ByOtY ctqujFKaFZQ orTy-IqN9_I JdkM1EBCCKs\nef1wAfrMg5I eN-RZVkFGj0 KPV1hFJIXrg -bp4Bgs7MaQ u1rRUwx_Vy4 iTjgWeJMUJo WL9EOfzoSsA xrCNwCD-z-M\nCC3AanQdQZA ZGLrP5eawdY HoOghpRTkvs N787WRdI35A Cw0d-nqSNE8 2vifO3_gjiM OeJ5xXrbkfU vkYBLYAGavM\njP4gBqxfheI HHi8qOtHnhE oN8q7p57nZw 6vnxzfejWN4 gVamQ6jodK0 iU5QjAbuhec qLIU_90P4Ac z8k_ximc8Og\nZFBoN7yIMZw 4mexI7cACZk bx-0YlFprqc NDWpXTg3koc Vo2AcHSCRiQ UrfJgjQt1SY WXI7byeZk5s y8d7Ihe0IwE\nubmUJcwor3k CGslieDL-04 w7ljU-lmaK4 I0B21LjeSUQ PyFN_FYwqvc bxy9PFJRJ0g ahmrb5EYoxY HGxuVWpN8vQ\nDNR1zyr5Go4 eyPhudLTuis aPWXL4ahxdY JB0A8Me8EKk dGy_6qyyY7c rxrDLgt5YFA uhcocK-td5E 4Z5FLeh7P18\nVB0zDS9ITmk VukLV0AoeFA CouF-tNHV3g lTvYjERVAnY S27YOjpgaaE 24uCC_-zaaE DslTxXsDLsw xilGAQPx5Xw\n9eu4yqpxQGU FDqQlAUDZyk R1OHRQoJOP0 fbqmVbEj9fg asL1AN3hifU fd8spJiYS0k 3ma3yXXc3V8 1U1We59en3s\niNm7PPqO6rM CLRk8SgtVS4 VYO8Biwffns 9Wm8Ij8rHIE ZMOC332wC7A doORhRob3Qg E2sSvVCRI4s 2aVxI4PSiDI\nE6Ww7lpuZ2k Ueqm3PQKYPk eFiKAcbp2MY dAfMgDBeqwU MsUOx11_eLk LAFK1EvwulU OF0iDephya8 L_mlofcsRaA\neZe4Q_58UTU NXObT_Fl-xI H222V6b4DCg _WkkH31sTMI ALJcKvnOjHM 85Y1N8avsXs NCY42RnUpCE 48rsDblF5Ig\n0Tpq2mLtXDc Zp1Oajc7VQw WGi4XiEGe8M b6L40CEYVyM Mw9qiV7XlFs UgHKb_7884o mvIYmMo906E VoXOYFlJTuI\nfsjdpo1o-J8 k9rKpHXwA1E MTG3VA-m6qk cU3XY6Ii8v0 NBIdmswtcnM k5sznEJz8BA R8W3U0Mu6t4 7iSOMLkFizU\n6KBo0GhU9XM d5R3FK9vLBs N5b7Iy4W0ow 2FE1_YK5OPI pughd7ysJyQ A-mPDdnzipI 6gqU-HL68wE RKWLu6UHryQ\nVIlQIVVLWVs 6A-kQCdEIpI _lisL6tLbdg VarS6olPfTA va306f9aN3A YlPawyXaMJI wjMf_bEfqIc hNC6-bxHJac\nJBm1ainuk-c PkF4EKJQOOg 0aMUCiKjBDI D1KsEOUqCEU JdE_xc1rQBY omlVslJvzxQ FoS3732REf0 kNMOaRRBat4\nqqC80mXlOKo MS2asGj1-_M NmP0RylitI4 IahW6hJ1-SM 9MIJm1NeUpE 2qzbMPpgtDw H3UY2gQfj-s 9kekiNImlsI\n5zUCClmhjF0 88jpBZdsrT8 UdFae3BAH38 MAFdQs_yWvg BHgDL6ODWSU p7G1lkYIFTM yAKSGmQkjxM 7TML_MTQdg4\nFGCIBbg0IYk oaQ8UXlKDiw 5rf_gOfa7O4 MYG6FeY4SKg AVzdfRpE9Q0 1UxoHtG2qas o7XgU4ut6jQ IcOYM87wTRc\noPetbPLA8dM eQIzdzSTH08 tpRBHKAJ_tU sTy4stPcD0E p4jroQX6Hwk y2Zl-KXvdSk zffchwaq6KE jv7hNnJEWPU\nDN-BxbMH264 mWaC_VSncEg 8x5Yzxi3LhA 0Txa_T4pHY4 McT_FUPZR5k 5rTo8-CPgU4 WbUgBaEsugI QytjUFgcmWw\n6BLY2zj6pq0 W5Y0deEEszo U6jAaBK7idQ rHZlMW_zxaE 4Xp4J5RYns0 Xsf2ThMqNBM lUbOyYp91NU dpuTxI8KAyc\nOIoAJfLDW1U bXK3EZ1AOZ0 nV62c0XBLDg 7ZWSdWxHAzY LVJHOKOIXK4 8QdnY1lACEs BfkdRwJAeu8 qyCXiUtWhD0\nXLNixgPHzao Q-iZMkvHnFw O47-jQYPznA H0RwPrdQs9g 5hkJkYLounY tlgv2urELis zHAbIALBaog cvoo5xXtiEA\nRpHnKaxt_OQ GsqsG3axUCs eMv6SCniTPg 5BdpkKiY3Fw _85ElkxtQa4 xCfEA0kuNww zsdPYFPTdw0 9pTT6867XJ4\nDUhdSWsapuA EmxS4JvlT5k CGBPXRi1nrM P9iRIGoIc9g Cy3okiPj26M TaKvapV_BwU jg5mnvYmrzU eG89_Vk_cqE\nwqoJj3ZJnXA N3DgwOn9yGI mvUV0FNBnGI 5FJWKoV07VM VaTBFaLFvHk EwlhQziQ-kw c9Ydsd89vWc Id83Esvmmb0\n09h57SoWrvE kwgeurY2omQ uLZlVUnQYY8 4jdV5FbvHpM 44KChB6CQOI XCUk8cRysW4 OdsIYD9F6Og _8fm1yqbPA4\n0hvAQ9hE-V0 df2q8ciX2rU p08ErTYMOh0 MvmxZj9Bo1I fDZYQD1GDd4 cJwiiXmPg-Y fWnlQnposC4 pYqScYQZ-o8\nQ7W4JISNmQk fryghm20GnQ jgtcAEUtgF4 XPKTAyKWoIo n5PqysUA4lU 0bJWDOTyCTY YJJA6pUx2FY JBlJrTkJxi0\nhsNMJp8G5tA pO13fJttJBE iw44ObI2cig 0KIWOl_lF2A 001TlVo_jmg kt0qIFPQBJg 0tZ2Y8kpCLI bzADvjia-mw\nqZezMIk7Oq4 ZHNYXUmEGoU 8dFr3YqPaeg M9KXG8jCq2U djP_T_rp09s Tyd_wjLfA_E ymRww99Yb-I zQrgF2izz2Y\nW0Kl0QfMEPo 5bwHtF7fR94 IXSTdSv-Jlo mf5E3FDZ6rY 7JsOhtl_zG4 vr5dCRHAgb0 Di9jRVy7WHk cVdfUy_VMTY\nLD_jcIQGl0Q ZXas8NdyLsE ELUl-cAtUIE --qCu9yL5H8 74wsGjTZzGg Wey4zHA4nPg VArhsYKbKzk t76IJmQKzKA\nl1RxmWxXQcM 7HagxwgIRcY gJgwJwg6Deg 1mD8V2trqcw i5ZbYQ1Nok4 YE3iWysmcBQ vdycBdIx-do UE-J2Dt8LNs\nx_dVi_PC_sc\n".match(/\S+/g).map((e=>({providerId:"ambientvideo",name:e,src:`youtube:video:${e}`})));const vv=new O("ambientvideo/visualizers");vv.log(`default (total=${bv.length})`);const yv=new Ne([]);tp().pipe(Gm(1),yr((e=>!!e.ambientVideoEnabled)),Sn(),_r((e=>e?tp().pipe(yr((e=>!!e.useAmbientVideoSource)),Sn(),_r((e=>e?tp().pipe(yr((e=>e.ambientVideoSource||"")),Sn(),_r((e=>e?function(e){return t=this,r=void 0,i=function*(){const t=Go(e),[,r,n]=t.split(":");let i=[n];return"playlist"===r&&(i=yield function(e){return Af(this,void 0,void 0,(function*(){const t=new Pf(e);try{return yield t.loadPlaylist()}finally{t.destroy()}}))}(t)),i.map((e=>({providerId:"ambientvideo",name:e,src:`youtube:video:${e}`})))},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(e):Wr([])))):Wr(bv)))):Wr([]))),In((e=>(vv.error(e),Wr([]))))).subscribe(yv);const gv={id:"ambientvideo",name:"Ambient Video",defaultHidden:!0,player:pv,get visualizers(){return yv.getValue()},observeVisualizers:function(){return yv}},wv=new O("AmpShaderPlayer");const Ev=new Ne([]);setTimeout((()=>{return e=void 0,t=void 0,i=function*(){const{default:e}=yield r.e(595).then(r.bind(r,7281));e&&Ev.next(e)},new((n=void 0)||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}),1e3);const kv=new class extends Gf{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.gl=this.canvas.getContext("webgl2"),this.animationFrameId=0,this.fragTheme=null,this.fragTime=null,this.fragChannelTime=null,this.fragDate=null,this.program=null,this.vertexShader=null,this.fragmentShader=null,this.startTime=performance.now(),this.currentVisualizer="";const t=this.gl;this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-ampshader";const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,t.R8,512,2,0,t.RED,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);const n=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n);const i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW)}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e||this.animationFrameId||this.render())}appendTo(e){e.append(this.canvas)}load(e){e&&(wv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.createShader(e.shader),this.render()))}play(){wv.log("play"),this.animationFrameId||this.render()}pause(){wv.log("pause"),this.cancelAnimation()}stop(){wv.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){const r=this.canvas,n=this.gl;if(r.width=e,r.height=t,n.viewport(0,0,e,t),this.program){const e=n.getUniformLocation(this.program,"iResolution");n.uniform2f(e,r.width,r.height),this.renderFrame()}}get currentDate(){const e=new Date;return[e.getFullYear(),e.getMonth(),e.getDate(),3600*e.getHours()+60*e.getMinutes()+e.getSeconds()+.001*e.getMilliseconds()]}get currentTime(){return(performance.now()-this.startTime)/1e3}get themeColor(){const{r:e,g:t,b:r}=new tt(Tt.frameColor).toRgb();return[e,t,r,1]}clear(){}createShader(e){const t=this.gl;this.program&&(t.detachShader(this.program,this.vertexShader),t.detachShader(this.program,this.fragmentShader),t.deleteProgram(this.program),this.program=null,this.vertexShader=null,this.fragmentShader=null);const r=this.vertexShader=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(r,"#version 300 es\nin vec4 as_Position;void main(void){gl_Position=as_Position;}"),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(r));const n=this.fragmentShader=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(n,e),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n));const i=t.createProgram();t.attachShader(i,r),t.attachShader(i,n),t.linkProgram(i),t.useProgram(i);const a=t.getAttribLocation(i,"as_Position");t.enableVertexAttribArray(a),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),this.fragTheme=t.getUniformLocation(i,"iTheme"),t.uniform4f(this.fragTheme,...this.themeColor),this.startTime=performance.now();const s=this.currentTime;this.fragTime=t.getUniformLocation(i,"iTime"),t.uniform1f(this.fragTime,s),this.fragChannelTime=t.getUniformLocation(i,"iChannelTime"),t.uniform1fv(this.fragChannelTime,new Float32Array([s,0,0,0])),this.fragDate=t.getUniformLocation(i,"iDate"),t.uniform4f(this.fragDate,...this.currentDate);const o=t.getUniformLocation(i,"iResolution");t.uniform2f(o,this.canvas.width,this.canvas.height),this.program=i}render(){this.renderFrame(),this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((()=>this.render())))}renderFrame(){if(this.program){const e=this.gl,t=this.analyser.frequencyBinCount,r=new Uint8Array(t),n=new Uint8Array(t),i=new Uint8Array(1024);this.analyser.getByteFrequencyData(r),this.analyser.getByteTimeDomainData(n);for(let e=0;e<512;e++)i[e]=r[e],i[e+512]=n[e];const a=this.currentTime;e.uniform1f(this.fragTime,a),e.uniform1fv(this.fragChannelTime,new Float32Array([a,0,0,0])),e.uniform4f(this.fragDate,...this.currentDate),e.uniform4f(this.fragTheme,...this.themeColor),e.texImage2D(e.TEXTURE_2D,0,e.R8,512,2,0,e.RED,e.UNSIGNED_BYTE,i),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}(ev),xv={id:"ampshader",name:"ampshader",player:kv,get visualizers(){return Ev.getValue()},observeVisualizers:function(){return Ev}};var Sv=r(8841);const Tv=new O("AudioMotionPlayer"),Av="audiomotion",Iv=[{providerId:Av,name:"Anemone",options:{radial:!0,ledBars:!1,spinSpeed:1,mode:8,barSpace:0,gradient:"ampcast-rainbow",reflexRatio:.4,showPeaks:!0,mirror:-1,maxFreq:8e3,lineWidth:2,fillAlpha:.2}},{providerId:Av,name:"Classic LEDs",options:{mode:7,barSpace:0,gradient:"ampcast-classic",ledBars:!0,lumiBars:!1,radial:!1,reflexRatio:0,showPeaks:!0}},{providerId:Av,name:"Mirror wave",options:{mode:10,fillAlpha:.6,gradient:"ampcast-rainbow",lineWidth:2,mirror:-1,radial:!1,reflexAlpha:1,reflexBright:1,reflexRatio:.5,showPeaks:!1}},{providerId:Av,name:"Radial overlay",options:{mode:5,barSpace:.1,gradient:"ampcast-prism",radial:!0,ledBars:!1,showPeaks:!0,spinSpeed:1}},{providerId:Av,name:"Reflex Bars",options:{mode:5,barSpace:.25,gradient:"ampcast-prism",lumiBars:!1,radial:!1,reflexAlpha:.25,reflexBright:1,reflexFit:!0,reflexRatio:.3,ledBars:!1,showPeaks:!0}}],Pv=new class extends Gf{constructor(e,t){super(),this.currentVisualizer="";const r=this.element=document.createElement("div");r.hidden=!0,r.className="visualizer visualizer-audiomotion";const n=this.visualizer=new Sv.Z(r,{audioCtx:e,showBgColor:!1,overlay:!0,showScaleX:!1,showScaleY:!1,connectSpeakers:!1});t.subscribe((e=>{this.audioSourceNode=e,this.element.hidden||n.connectInput(e)})),Tt.observe().pipe(Le((()=>this.registerGradients()))).subscribe(Tv)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden!==e&&(this.element.hidden=e,e?this.visualizer.disconnectInput():this.audioSourceNode&&this.visualizer.connectInput(this.audioSourceNode))}appendTo(e){e.append(this.element)}load(e){e&&(Tv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.visualizer.setOptions(e.options))),this.autoplay&&this.visualizer.toggleAnalyzer(!0)}play(){Tv.log("play"),this.visualizer.toggleAnalyzer(!0)}pause(){Tv.log("pause"),this.visualizer.toggleAnalyzer(!1)}stop(){Tv.log("stop"),this.visualizer.toggleAnalyzer(!0)}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}registerGradients(){const e=new tt(Tt.isMediaButtonLight?Tt.mediaButtonColor:Tt.defaultMediaButtonColor),t=[new tt(Tt.mediaButtonColor),new tt(Tt.defaultMediaButtonColor),new tt(Tt.frameColor),new tt(Tt.frameTextColor),new tt(Tt.backgroundColor),new tt(Tt.textColor)].filter((e=>e.getBrightness()<200&&e.getLuminance()>.3&&e.toHsl().s>.3)).sort(((e,t)=>t.getLuminance()-e.getLuminance()))[0]||e,r=t.tetrad().map((e=>e.toRgbString())).slice(1);this.visualizer.registerGradient("ampcast-classic",{bgColor:Tt.black,colorStops:[r[0],{pos:.6,color:r[1]},r[2]]}),this.visualizer.registerGradient("ampcast-prism",{bgColor:Tt.black,colorStops:Tt.getVisualizerColors()}),this.visualizer.registerGradient("ampcast-rainbow",{bgColor:Tt.black,colorStops:e.analogous().map((e=>e.toRgbString()))})}}(Zb,iv()),Cv={id:"audiomotion",name:"audioMotion-analyzer",externalUrl:"https://audiomotion.dev/",player:Pv,visualizers:Iv,observeVisualizers:()=>Wr(Iv)};var Mv=r(2238),Ov=r.n(Mv);const Nv=new O("ButterchurnPlayer");const $v=new Ne([]);function zv(){return $v.getValue()}setTimeout((()=>{return e=void 0,t=void 0,i=function*(){const e="butterchurn",{default:t}=yield r.e(577).then(r.t.bind(r,6607,23));if(t){$v.next(Object.keys(t).map((r=>({providerId:e,name:r,data:t[r]}))));const{default:n}=yield r.e(271).then(r.t.bind(r,3710,23));n&&$v.next(zv().concat(Object.keys(n).map((t=>({providerId:e,name:t,data:n[t]})))))}},new((n=void 0)||(n=Promise))((function(r,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}),1e3);const jv={id:"butterchurn",name:"Butterchurn (Milkdrop)",externalUrl:"https://butterchurnviz.com/",player:new class extends Gf{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.error$=new Me,this.animationFrameId=0,this.currentVisualizer="",this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-butterchurn",(this.visualizer=Ov().createVisualizer(e.context,this.canvas,{width:400,height:200})).connectAudio(e)}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?this.visualizer.disconnectAudio(this.analyser):(this.visualizer.connectAudio(this.analyser),this.animationFrameId||this.render()))}observeError(){return this.error$}appendTo(e){e.append(this.canvas)}load(e){e&&(Nv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.visualizer.loadPreset(e.data,.5),this.render()))}play(){Nv.log("play"),this.animationFrameId||this.render()}pause(){Nv.log("pause"),this.cancelAnimation()}stop(){Nv.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.visualizer.render(),this.visualizer.setRendererSize(e,t),this.visualizer.render()}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(){if(this.animationFrameId)this.visualizer.render();else try{this.visualizer.render()}catch(e){Nv.error(e),this.error$.next(e)}this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((()=>this.render())))}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}(ev),get visualizers(){return zv()},observeVisualizers:function(){return $v}},Lv=new O("SpotifyVizPlayer");let Dv="",Fv="";const Rv={volumeSmoothing:10,onBar(){const e=Tt.getVisualizerColors();Dv=Fv||E(e),Fv=E(e.filter((e=>e!==Fv)))},onPaint({context2D:e,height:t,width:r,now:n,analyser:i}){const a=dp([0,10*i.volume,0])(i.bar.progress),s=dp([0,300*i.volume,0])(i.beat.progress),{r:o,g:l,b:c}=new tt(Tt.black).toRgb(),u=`${o},${l},${c}`;e.fillStyle=`rgba(${u},0.08)`,e.fillRect(0,0,r,t),e.lineWidth=a,e.strokeStyle=gb(Dv,Fv)(i.bar.progress),function(e,t,r,n,i,a=5){const s=e=>n*Math.sin(e/i+t)+r,{width:o}=e.canvas;e.beginPath();for(let t=-50;t<o+50;t+=a)-50===t?e.moveTo(t,s(t)):e.lineTo(t,s(t))}(e,n/50,t/2,50*i.volume,100),e.stroke(),e.fillStyle=`rgb(${u})`,e.beginPath(),e.lineWidth=s,function(e,t,r,n,i=0,a=2*Math.PI){e.beginPath(),e.arc(t,r,n,i,a),e.closePath()}(e,r/2,t/2,i.volume*t/5+s/10),e.stroke(),e.fill()}},_v=[{providerId:"spotifyviz",name:"example by zachwinter",config:Rv,externalUrl:"https://github.com/zachwinter/spotify-viz/blob/master/client/example.js"}],Uv={id:"spotifyviz",name:"spotify-viz",externalUrl:"https://github.com/zachwinter/spotify-viz/",player:new class extends Gf{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.currentVisualizer="",this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-spotifyviz",e.observeBar().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onBar)||void 0===r||r.call(t,e)})),e.observeBeat().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onBeat)||void 0===r||r.call(t,e)})),e.observeSection().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onSection)||void 0===r||r.call(t,e)})),e.observeSegment().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onSegment)||void 0===r||r.call(t,e)})),e.observeTatum().subscribe((e=>{var t,r;null===(r=null===(t=this.config)||void 0===t?void 0:t.onTatum)||void 0===r||r.call(t,e)}))}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e||this.animationFrameId||this.render())}appendTo(e){e.append(this.canvas)}load(e){var t,r;e&&(Lv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.config=e.config,this.analyser.volumeSmoothing=null!==(r=null===(t=e.config)||void 0===t?void 0:t.volumeSmoothing)&&void 0!==r?r:100,this.render()))}play(){Lv.log("play"),this.animationFrameId||this.render()}pause(){Lv.log("pause"),this.cancelAnimation()}stop(){Lv.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.renderFrame()}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(e=performance.now()){this.renderFrame(e),this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((e=>this.render(e))))}renderFrame(e=performance.now()){var t,r;const n=this.context2D,i=this.canvas.width,a=this.canvas.height,s=this.analyser;null===(r=null===(t=this.config)||void 0===t?void 0:t.onPaint)||void 0===r||r.call(t,{context2D:n,width:i,height:a,now:e,analyser:s})}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}(Jb),visualizers:_v,observeVisualizers:()=>Wr(_v)};function Vv(){return Tt.isLight&&Tt.isFrameLight?Tt.frameColor:Tt.isTextLight?Tt.textColor:Tt.frameTextColor}const Bv=[{providerId:"waveform",name:"wave",config:{onPaint:({context2D:e,width:t,height:r,analyser:n})=>{const i=n.frequencyBinCount,a=new Uint8Array(i),s=t/i;let o=0;e.lineWidth=Math.round(Tt.fontSize/4),e.clearRect(0,0,t,r),e.strokeStyle=Vv(),e.beginPath(),n.getByteTimeDomainData(a);for(let t=0;t<i;t++){const n=a[t]/128*r/2;0===t?e.moveTo(o,n):e.lineTo(o,n),o+=s}e.lineTo(t,r/2),e.stroke()}}},{providerId:"waveform",name:"bars",config:{onPaint:({context2D:e,width:t,height:r,analyser:n})=>{const i=n.frequencyBinCount,a=new Uint8Array(i);n.getByteFrequencyData(a),e.clearRect(0,0,t,r),e.fillStyle=Vv();const s=(t-30)/16,o=.0075*r,l=i/16;let c,u=0;for(let t=0;t<i;t+=l){const n=a.slice(t,t+l).reduce(((e,t)=>e+t),0)/l;c=o*n,e.fillRect(u,r-c/2,s,c/2),u+=s+2}}}}],Hv=Bv,Yv={id:"waveform",name:"Waveform",externalUrl:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API",player:new sv(ev),visualizers:Hv,observeVisualizers:()=>Wr(Hv)},qv=new O("visualizerProviders");function Kv(){return[gv,xv,Cv,jv,Uv,Yv]}function Wv(e){return Kv().find((t=>t.id===e))}function Gv(e){var t;return(null===(t=Wv(e))||void 0===t?void 0:t.visualizers)||[]}jr(Kv()).pipe(wr((e=>e.observeVisualizers().pipe(yr((e=>e.length)),pn((e=>0===e)),Le((t=>qv.log(`${e.id} (total=${t})`))))))).subscribe(qv);const Jv=new O("visualizerPlayer"),Qv=new Kf("visualizer-player",Kv().map((e=>e.player)),(function(e){return function(e){var t;return null===(t=Wv(e))||void 0===t?void 0:t.player}(e.providerId)||null}),(function(e,t){e.load(t)}));Qv.loop=!0,Qv.muted=!0,Qv.volume=.07,Qv.observeError().subscribe(Jv.error);const Xv=Qv;var Zv,ey,ty=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},ry=function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r};const ny=new O("MusicKitPlayer"),iy="Apple Music player not connected";Zv=new WeakMap,ey=new WeakMap;const ay=new class{constructor(e){this.isLoggedIn$=e,this.paused$=new Ne(!0),this.duration$=new Me,this.currentTime$=new Me,this.ended$=new Me,this.playing$=new Me,this.error$=new Me,this.playerLoaded$=new Me,this.playerActivated$=new Ne(!1),this.src$=new Ne(""),this.loadedSrc="",this.isLoggedIn=!1,this.hasPlayed=!1,this.loop=!1,this.autoplay=!1,Zv.set(this,!0),ey.set(this,1),this.onPlaybackStateChange=({state:e})=>{switch(e){case MusicKit.PlaybackStates.playing:{const[,,e]=this.src.split(":"),t=this.player.nowPlayingItem;!1===(null==t?void 0:t.isPlayable)&&(null==t?void 0:t.id)===e?(this.error$.next(Error("Unplayable")),this.stop()):this.paused?this.pause():this.playing$.next(void 0);break}case MusicKit.PlaybackStates.ended:this.ended$.next(void 0)}},this.onPlaybackDurationChange=({duration:e})=>{this.duration$.next(e)},this.onPlaybackTimeChange=({currentPlaybackTime:e})=>{this.currentTime$.next(e)},this.onPlaybackError=e=>{this.error$.next(e)};const t=this.element=document.createElement("div");t.hidden=!0,t.className="apple-video",t.id="apple-music-video-container",this.observeIsLoggedIn().pipe(De((e=>e)),Le((()=>{const e=this.player=MusicKit.getInstance(),t=MusicKit.Events;e.addEventListener(t.playbackStateDidChange,this.onPlaybackStateChange),e.addEventListener(t.playbackDurationDidChange,this.onPlaybackDurationChange),e.addEventListener(t.playbackTimeDidChange,this.onPlaybackTimeChange),e.addEventListener(t.mediaPlaybackError,this.onPlaybackError),e.volume=this.muted?0:this.volume,this.playerLoaded$.next(void 0)})),Rn(1)).subscribe(ny),this.observeReady().pipe(_r((()=>this.observeIsLoggedIn())),_r((e=>e?this.observePaused():Fr)),_r((e=>e?Fr:this.observeSrc())),_r((e=>{if(e&&e!==this.loadedSrc){if(!this.canPlay(e))return this.error$.next(Error(this.getUnplayableReason(e))),Fr;const[,t,r]=e.split(":"),n=t.replace("library-","").replace(/s$/,"").replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));return jr(this.player.setQueue({[n]:r})).pipe(_r((()=>(this.loadedSrc=e,this.autoplay?this.safePlay():Fr))),In((e=>(this.loadedSrc="",this.error$.next(e),Fr))))}return Fr}))).subscribe(ny),this.observeIsLoggedIn().pipe(pn((e=>e===this.isLoggedIn)),Le((e=>{var t;this.isLoggedIn=e,e||(this.loadedSrc="",this.paused&&!(null===(t=this.player)||void 0===t?void 0:t.isPlaying)||(this.stop(),this.error$.next(Error(iy))))}))).subscribe(ny),this.observeError().subscribe(ny.error),this.observeError().pipe(De((()=>{var e;return!1===(null===(e=this.player)||void 0===e?void 0:e.isAuthorized)})),_r((()=>ii())),In((()=>Fr))).subscribe(ny)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e}get muted(){return ty(this,Zv,"f")}set muted(e){ty(this,Zv,"f")!==e&&(ry(this,Zv,e,"f"),this.player&&(this.player.volume=e?0:this.volume))}get volume(){return ty(this,ey,"f")}set volume(e){ty(this,ey,"f")!==e&&(ry(this,ey,e,"f"),this.player&&(this.player.volume=this.muted?0:e))}observeCurrentTime(){return this.currentTime$.pipe(Sn())}observeDuration(){return this.duration$.pipe(Sn())}observePlaying(){return this.playing$}observeEnded(){return this.ended$}observeError(){return this.error$}appendTo(e){e.appendChild(this.element)}load({src:e}){ny.log("load",{src:e}),this.autoplay&&this.playerActivated$.next(!0),this.src$.next(e),this.autoplay&&this.paused$.next(!1),this.player&&this.isLoggedIn?this.autoplay&&(e===this.loadedSrc?this.safePlay():this.canPlay(e)||this.error$.next(Error(this.getUnplayableReason(e)))):this.autoplay&&this.error$.next(Error(iy))}play(){ny.log("play"),this.playerActivated$.next(!0),this.paused$.next(!1),this.player&&this.isLoggedIn?this.src===this.loadedSrc?this.safePlay():this.canPlay(this.src)||this.error$.next(Error(this.getUnplayableReason(this.src))):this.isLoggedIn||this.error$.next(Error(iy))}pause(){var e;ny.log("pause"),this.paused$.next(!0),(null===(e=this.player)||void 0===e?void 0:e.isPlaying)&&this.player.pause()}stop(){ny.log("stop"),this.paused$.next(!0),this.hasPlayed&&this.player.stop()}seek(e){var t;null===(t=this.player)||void 0===t||t.seekToTime(e)}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}get paused(){return this.paused$.getValue()}get src(){return this.src$.getValue()}observeIsLoggedIn(){return this.isLoggedIn$}observePaused(){return this.paused$.pipe(Sn())}observeReady(){return this.playerLoaded$.pipe(_r((()=>this.playerActivated$)),De((e=>e)),yr((()=>{})),Rn(1))}observeSrc(){return this.src$.pipe(Sn())}canPlay(e){return!this.getUnplayableReason(e)}getUnplayableReason(e){var t;const[,r,n]=e.split(":");return"UNPLAYABLE"===n?"Unplayable":/video/i.test(r)&&(null===(t=this.player)||void 0===t?void 0:t.version.startsWith("1"))?"Video playback not supported":""}safePlay(){var e,t,r,n,i;return t=this,r=void 0,i=function*(){try{this.src&&this.src===this.loadedSrc&&!1===(null===(e=this.player)||void 0===e?void 0:e.isPlaying)&&(yield this.player.play(),this.hasPlayed=!0)}catch(e){this.error$.next(e)}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}))}}(ri()),sy=new Jf("audio","main"),oy=new Jf("video","main"),ly=new Tf("main"),cy=new Kf("media-player",[sy,oy,ly,ay,Bd],(function(e){return e?e.src.startsWith("youtube:")?ly:e.src.startsWith("apple:")?ay:e.src.startsWith("spotify:")?Bd:e.mediaType===Fn.Video?oy:sy:null}),(function(e,t){e.load(function(e){if(e){if(e.blob)return{src:URL.createObjectURL(e.blob)};if(e.unplayable){const t=e.src.split(":");return t[2]="UNPLAYABLE",{src:t.join(":")}}return e}return{src:""}}(t))}));var uy=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const dy=new O("embyReporting");function my(e,t,r,n,i){return uy(this,void 0,void 0,(function*(){try{const[,,a]=e.src.split(":");yield oa.post("Sessions/Playing/Progress",{ItemId:a,IsPaused:r,PositionTicks:Math.floor(1e7*t),PlayMethod:"Transcode",EventName:n},i)}catch(e){dy.error(e)}}))}function hy(e,t){const r=new O(`${e.id}Scrobbler`),n=t=>{var r;return!!(null===(r=t.currentItem)||void 0===r?void 0:r.src.startsWith(`${e.id}:`))};e.observeIsLoggedIn().pipe(_r((e=>e?ip():Fr)),De(n),wr((({currentItem:e})=>function(e,t){return uy(this,void 0,void 0,(function*(){try{const[,,r]=e.src.split(":");yield oa.post("Sessions/Playing",{ItemId:r,IsPaused:!1,PositionTicks:0,PlayMethod:"Transcode"},t)}catch(e){dy.error(e)}}))}(e,t)))).subscribe(r),e.observeIsLoggedIn().pipe(_r((e=>e?ap():Fr)),De(n),wr((({currentItem:e,currentTime:r})=>function(e,t,r){return uy(this,void 0,void 0,(function*(){try{const[,,n]=e.src.split(":");yield oa.post("Sessions/Playing/Stopped",{ItemId:n,IsPaused:!1,PositionTicks:Math.floor(1e7*t),PlayMethod:"Transcode"},r)}catch(e){dy.error(e)}}))}(e,r,t)))).subscribe(r),e.observeIsLoggedIn().pipe(_r((e=>e?sp(1e4):Fr)),De(n),De((({currentTime:e})=>e>0)),wr((({currentItem:e,currentTime:r,paused:n})=>my(e,r,n,"timeupdate",t)))).subscribe(r),e.observeIsLoggedIn().pipe(_r((e=>e?ip():Fr)),_r((e=>n(e)?np().pipe(Sn(((e,t)=>e.paused===t.paused)),Md(1),Ur(ap())):Fr)),wr((({currentItem:e,currentTime:r,paused:n})=>my(e,r,n,n?"pause":"unpause",t)))).subscribe(r)}hy(Ua,Qi),hy(Ss,Ka);const fy=new D("scrobbling"),py=new Ne(fy.getJson("noScrobble",{})),by=new Ne(fy.getJson("options",{}));function vy(e,t){var r;const n=py.getValue()[e.id];return!(null!==(r=null==n?void 0:n[t.id])&&void 0!==r?r:t.defaultNoScrobble)}function yy(e,t){const r=py.getValue(),n=r[e.id],i=Object.assign(Object.assign({},n),t),a=Object.assign(Object.assign({},r),{[e.id]:i});fy.setJson("noScrobble",a),py.next(a)}function gy(e){var t;return!!(null===(t=by.getValue()[e.id])||void 0===t?void 0:t.updateNowPlaying)}function wy(e,t){const r=by.getValue(),n=r[e.id],i=Object.assign(Object.assign({},n),t),a=Object.assign(Object.assign({},r),{[e.id]:i});fy.setJson("options",a),by.next(a)}const Ey={canScrobble:vy,setNoScrobble:yy,canUpdateNowPlaying:gy,updateOptions:wy};const ky=new O("lastfmScrobbler");function xy(e){const t=Am(e);return!t||Ey.canScrobble(to,t)}Rs().pipe(_r((e=>e?ip():Fr)),De((()=>Ey.canUpdateNowPlaying(to))),yr((({currentItem:e})=>e)),De(l),De((e=>xy(e))),wr((e=>Hs.updateNowPlaying(e)))).subscribe(ky),Rs().pipe(_r((e=>e?ph():Fr)),yr((e=>e.filter((e=>!e.lastfmScrobbledAt)))),Gm(1e4),wr((e=>function(e){return t=this,r=void 0,i=function*(){try{if(0===e.length)return;const t=e[0].playedAt+Math.floor(e[0].duration),r=e.at(-1).playedAt,n=new Ks({from:r-30,to:t+30,limit:Ks.maxPageSize}),i=yield _n(n),a=i.map((e=>yh(e,30))),[s,o]=m(e,(e=>!xy(e)||a.includes(yh(e,30))||!!gh(i,e)));if(yield vh(s.map((e=>Object.assign(Object.assign({},e),{lastfmScrobbledAt:-1})))),o.length>0){o.reverse(),o.length=Math.min(o.length,50),yield Hs.scrobble(o);const e=Math.floor(Date.now()/1e3);yield vh(o.map((t=>Object.assign(Object.assign({},t),{lastfmScrobbledAt:e}))))}}catch(e){ky.error(e)}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(e)))).subscribe(ky);const Sy=new O("listenbrainzScrobbler");function Ty(e){const t=Am(e);return!t||Ey.canScrobble(bl,t)}go().pipe(_r((e=>e?ip():Fr)),De((()=>Ey.canUpdateNowPlaying(bl))),yr((({currentItem:e})=>e)),De(l),De((e=>Ty(e))),wr((e=>co.updateNowPlaying(e)))).subscribe(Sy),go().pipe(_r((e=>e?ph():Fr)),yr((e=>e.filter((e=>!e.listenbrainzScrobbledAt)))),Gm(1e4),wr((e=>function(e){return t=this,r=void 0,i=function*(){try{if(0===e.length)return;const t=e[0].playedAt+Math.floor(e[0].duration),r=e.at(-1).playedAt,n=new rl({min_ts:r-30,max_ts:t+30,count:rl.maxPageSize}),i=yield _n(n),a=i.map((e=>yh(e,30))),[s,o]=m(e,(e=>!Ty(e)||a.includes(yh(e,30))||!!gh(i,e)));if(yield vh(s.map((e=>Object.assign(Object.assign({},e),{listenbrainzScrobbledAt:-1})))),o.length>0){o.reverse(),o.length=Math.min(o.length,50),yield co.scrobble(o);const e=Math.floor(Date.now()/1e3);yield vh(o.map((t=>Object.assign(Object.assign({},t),{listenbrainzScrobbledAt:e}))))}}catch(e){Sy.error(e)}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(e)))).subscribe(Sy);var Ay=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Iy=new O("subsonicReporting");function Py(e,t){const r=new O(`${e.id}Scrobbler`),n=t=>{var r;return!!(null===(r=t.currentItem)||void 0===r?void 0:r.src.startsWith(`${e.id}:`))};e.observeIsLoggedIn().pipe(_r((e=>e?ip():Fr)),De(n),wr((({currentItem:e})=>function(e,t){return Ay(this,void 0,void 0,(function*(){try{const[,,r]=e.src.split(":");yield Ol.scrobble({id:r,submission:!1},t)}catch(e){Iy.error(e)}}))}(e,t)))).subscribe(r),e.observeIsLoggedIn().pipe(_r((e=>e?ap():Fr)),De(n),wr((({currentItem:e,startedAt:r})=>function(e,t,r){return Ay(this,void 0,void 0,(function*(){try{if(bh(e.duration,t,Date.now())){const[,,n]=e.src.split(":");yield Ol.scrobble({id:n,time:t,submission:!0},r)}}catch(e){Iy.error(e)}}))}(e,r,t)))).subscribe(r)}Py(dc,$l);var Cy=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const My=new O("plexReporting");let Oy=null;function Ny(e,t,r){return Cy(this,void 0,void 0,(function*(){try{yield $y(e,t,r)}catch(e){My.error(e)}}))}function $y(e,t,r,n){return Cy(this,void 0,void 0,(function*(){if(!Oy)return void My.warn(`Cannot report state (${r}): playQueue not defined`);const[i,,a]=e.src.split(":"),s="plex-tidal"===i;yield jc.fetch({host:s?Tc:void 0,path:s?"/timeline":"/:/timeline",params:{key:`/library/metadata/${a}`,ratingKey:a,playQueueItemID:String(Oy.playQueueSelectedItemID),state:r,time:String(Math.floor(1e3*t)),duration:String(Math.floor(1e3*e.duration))},keepalive:n})}))}const zy=new O("plexScrobbler"),jy=e=>{var t;return/^(plex(-tidal)?):/.test(null===(t=e.currentItem)||void 0===t?void 0:t.src)};Hc().pipe(_r((e=>e?ip():Fr)),De(jy),wr((({currentItem:e})=>function(e){return Cy(this,void 0,void 0,(function*(){try{Oy=null,Oy=yield function(e){return Cy(this,void 0,void 0,(function*(){const[t,,r]=e.src.split(":"),n=`/library/metadata/${r}`,i="plex-tidal"===t;return jc.fetchJSON({host:i?"https://play.provider.plex.tv":void 0,path:"/playQueues",method:"POST",params:{key:n,type:"music",uri:i?`provider://tv.plex.provider.music${n}`:`server://${yc.server.clientIdentifier}/com.plexapp.plugins.library${n}`,continuous:"0",repeat:"0",own:"1"}})}))}(e),yield $y(e,0,"playing")}catch(e){My.error(e)}}))}(e)))).subscribe(zy),Hc().pipe(_r((e=>e?ap():Fr)),De(jy),wr((({currentItem:e})=>function(e){return Cy(this,void 0,void 0,(function*(){try{yield $y(e,0,"stopped",!0),Oy=null}catch(e){My.error(e)}}))}(e)))).subscribe(zy),Hc().pipe(_r((e=>e?sp(1e4):Fr)),De(jy),De((({currentTime:e})=>e>0)),wr((({currentItem:e,currentTime:t,paused:r})=>Ny(e,t,r?"paused":"playing")))).subscribe(zy),Hc().pipe(_r((e=>e?ip():Fr)),_r((e=>jy(e)?np().pipe(Sn(((e,t)=>e.paused===t.paused)),Md(1),Ur(ap())):Fr)),wr((({currentItem:e,currentTime:t,paused:r})=>Ny(e,t,r?"paused":"playing")))).subscribe(zy),Py(bm,kl);const Ly=new O("mediaPlayback/scrobbler");ap().pipe(wr((e=>function(e){var t;return ch(this,void 0,void 0,(function*(){try{const r=e.currentItem;if(!r||!e.startedAt||!e.endedAt)throw Error("Invalid playback state");if(r.title&&(null===(t=r.artists)||void 0===t?void 0:t[0])&&r.duration>30&&bh(r.duration,e.startedAt,e.endedAt)){const{id:t,lookupStatus:n}=r,i=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(r,["id","lookupStatus"]);uh.log("add",{listen:i}),yield fh.items.add(Object.assign(Object.assign({},i),{playedAt:Math.floor(e.startedAt/1e3),lastfmScrobbledAt:0,listenbrainzScrobbledAt:0}))}}catch(e){uh.error(e)}}))}(e)))).subscribe(Ly);const Dy=new O("mediaPlayback"),Fy=new D("mediaPlayback"),Ry=new D("mediaPlayback","session"),_y=new Ne(!1),Uy=new Me;let Vy="forward";function By(){return ff.observeCurrentItem()}function Hy(){return cp.observeCurrentTime()}function Yy(){return cp.observeDuration()}function qy(){return cy.observeEnded()}function Ky(){return cy.observeError()}function Wy(){return cp.observePaused()}function Gy(){return cp.observePlaybackStart()}function Jy(){return cp.observePlaybackEnd()}function Qy(){return cy.observePlaying()}function Xy(e){Dy.log("load",{item:e}),cy.load(e),cy.autoplay&&cp.play()}function Zy(){Dy.log("play"),Vy="forward",lg(),cp.play(),cp.paused||(cy.play(),Xv.play())}function eg(){Dy.log("pause"),ug.stopAfterCurrent=!1,lg(),cp.pause(),cy.pause(),Xv.pause()}function tg(e){Dy.log("seek",{time:v(e)}),cy.seek(e)}function rg(){Dy.log("stop"),ug.stopAfterCurrent=!1,lg(),cp.stop(),cy.stop(),Xv.stop()}function ng(){Vy="backward",ff.atStart||(ug.stopAfterCurrent=!1,og(),ff.prev())}function ig(){Vy="forward",ff.atEnd||(ug.stopAfterCurrent=!1,og(),ff.next())}function ag(){ug.stopAfterCurrent=!1,og(),ff.eject()}function sg(){return kn([ff.observeCurrentIndex(),ff.observeSize()]).pipe(yr((([e,t])=>e===t-1)),Sn())}function og(){cp.paused||!1!==_y.getValue()||(cp.stop(),cy.stop(),cp.play()),_y.next(!0)}function lg(){_y.next(!1)}function cg(e){return t=this,r=void 0,i=function*(){if(!Im(e)){const t=yield function(e){return Ih(this,void 0,void 0,(function*(){try{if(!e)return;if(Im(e))return e;t=e,xh.next({lookupItem:t});const r=yield function(e){return Ih(this,void 0,void 0,(function*(){const t=wh(e);if(t)return t;const{link:r}=e,n=Ph(e,["link"]);if(r&&Im(r))return Object.assign(Object.assign({},n),r);const{artist:i,title:a}=_h(e);if(!i||!a)return;let s=[];const o=Am(r);if(o&&(s=yield Oh(o,e),0===s.length&&("plex"===o.id||"tidal"===o.id))){const t=Tm("plex-tidal");t&&(s=yield Oh(t,e))}return 0===s.length&&(s=yield Nh(e,!0,o)),0===s.length&&(s=yield Nh(e,!1,o)),$h(s,e)}))}(e);return r&&([Mh]=r.src.split(":")),function(e,t){Sh.next({lookupItem:e,foundItem:t?k(t,e):void 0})}(e,r),r}catch(e){Ch.error(e)}var t}))}(e);if(t)return Object.assign(Object.assign({},e),t)}return e},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}const ug={stopAfterCurrent:!1,get autoplay(){return cy.autoplay},set autoplay(e){cy.autoplay=e,Xv.autoplay=e},get hidden(){return!1},get loop(){return!1},get muted(){return cy.muted},set muted(e){Ry.setBoolean("muted",e),cy.muted=e},get paused(){return cp.paused},get volume(){return cy.volume},set volume(e){Fy.setNumber("volume",e),cy.volume=e},observeCurrentItem:By,observeCurrentTime:Hy,observeDuration:Yy,observeEnded:qy,observeError:Ky,observePaused:Wy,observePlaying:Qy,observePlaybackStart:Gy,observePlaybackEnd:Jy,observePlaybackProgress:function(e){return cp.observePlaybackProgress(e)},observePlaybackState:function(){return cp.observePlaybackState()},appendTo:function(e){const t=e.querySelector("#playback");cy.appendTo(t),Xv.appendTo(t)},load:Xy,play:Zy,pause:eg,stop:rg,seek:tg,resize:function(e,t){cy.resize(e,t),Xv.resize(e,t)},next:ig,prev:ng,shuffle:function(){ff.shuffle()}},dg=ug;ug.muted=Ry.getBoolean("muted"),ug.volume=Fy.getNumber("volume",1),cy.observeCurrentTime().subscribe((e=>cp.setCurrentTime(e))),cy.observeDuration().subscribe((e=>cp.setDuration(e))),cy.observePlaying().subscribe((()=>cp.started())),cy.observeEnded().subscribe((()=>cp.ended())),cy.observePlaying().subscribe((()=>Vy="forward")),cy.observeEnded().pipe(Cd(sg()),Ur(Uy)).subscribe((([,e])=>{e||ug.stopAfterCurrent?rg():ff.next()})),cy.observeError().pipe(Gm(2e3),Cd(Wy(),ff.observeCurrentIndex().pipe(yr((e=>0===e)),Sn()),sg()),Ur(Uy)).subscribe((([,e,t,r])=>{e||(r||t&&"backward"===Vy?rg():"backward"===Vy?ff.prev():ff.next())})),ff.observeSize().pipe(yr((e=>0===e)),Sn(),pn((e=>e)),De((e=>e))).subscribe(rg),_y.pipe(Gm(250),De((e=>e))).subscribe((()=>{ug.autoplay=!cp.paused,_y.next(!1)})),_y.pipe(Sn(),_r((e=>e?Fr:By())),Sn(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),_r((e=>e?cg(e):Wr(null))),pn((e=>!e)),Le(Xy)).subscribe(Dy),_y.pipe(Sn(),_r((e=>e?Fr:ff.observeNextItem())),Sn(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),Gm(3e3),_r((e=>e?cg(e):Fr))).subscribe(Dy),Ar(window,"pagehide").subscribe((function(){Uy.next(void 0),rg()})),Yy().pipe(pn((e=>!e)),yr(v),Sn()).subscribe(Dy.rx("duration")),Hy().pipe(De((e=>Math.round(e)%30==0)),yr(v)).subscribe(Dy.rx("currentTime")),Qy().subscribe(Dy.rx("playing")),qy().subscribe(Dy.rx("ended")),Gy().subscribe(Dy.rx("playbackStart")),Jy().subscribe(Dy.rx("playbackEnd"));var mg=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function hg(e){var{icon:t,className:r=""}=e,i=mg(e,["icon","className"]);return n.createElement("button",Object.assign({},i,{className:`icon-button icon-button-${t} ${r}`,type:"button",onMouseDown:w,onMouseUp:g}),n.createElement(Nt,{name:t}))}var fg=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function pg(e){var{className:t="",children:r}=e,i=fg(e,["className","children"]);return n.createElement("div",Object.assign({},i,{className:`icon-buttons ${t}`}),r)}function bg({children:e,onClose:t,x:r,y:i,align:a="left"}){const s=(0,n.useRef)(null),o=(0,n.useRef)(document.activeElement),[l,c]=(0,n.useState)({visibility:"hidden"}),[u,d]=(0,n.useState)([]),[m,h]=(0,n.useState)("");(0,n.useEffect)((()=>{const e={},t=s.current,n=Array.from(t.querySelectorAll("button"));"right"===a||r+t.offsetWidth>document.body.clientWidth?e.left=r-t.offsetWidth+"px":e.left=`${r}px`,i+t.offsetHeight>document.body.clientHeight?e.top=i-t.offsetHeight+"px":e.top=`${i}px`,d(n),c(e)}),[a,r,i]),(0,n.useEffect)((()=>{const e=u.find((e=>!e.disabled));null==e||e.focus(),h((null==e?void 0:e.id)||"")}),[u]),(0,n.useEffect)((()=>{const e=Rr(ir(0).pipe(_r((()=>Ar(document,"mousedown",{capture:!0}).pipe(De((e=>!s.current.contains(e.target))))))),Ar(document,"keydown",{capture:!0}).pipe(De((e=>"Escape"===e.code||"Tab"===e.code))),Ar(window,"blur")).subscribe((()=>{var e;null===(e=o.current)||void 0===e||e.focus(),t()}));return()=>e.unsubscribe()}),[t]);const f=(0,n.useCallback)((e=>{var r;let n=e.target;for(;n&&"BUTTON"!==n.nodeName;)n=n.parentElement;(null==n?void 0:n.value)&&!n.disabled&&(null===(r=o.current)||void 0===r||r.focus(),t(n.value))}),[t]),p=(0,n.useCallback)((e=>{let t=u.indexOf(document.activeElement);"ArrowDown"===e.code?(e.stopPropagation(),t++):"ArrowUp"===e.code&&(e.stopPropagation(),t--),t=Math.min(Math.max(t,0),u.length-1);const r=u[t];r&&!r.disabled&&(r.focus(),h(r.id))}),[u]),b=(0,n.useCallback)((e=>{let t=e.target;for(;t&&"BUTTON"!==t.nodeName;)t=t.parentElement;t&&!t.disabled&&(t.focus(),h(t.id))}),[]);return n.createElement("ul",{className:"popup-menu",tabIndex:-1,role:"menu","aria-label":"Actions","aria-activedescendant":m,style:l,onClick:f,onContextMenu:y,onKeyDown:p,onMouseOver:b,ref:s},e)}var vg=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function yg(e){var{className:t="",label:r,acceleratorKey:i="",role:a="menuitem"}=e,s=vg(e,["className","label","acceleratorKey","role"]);const o=(0,n.useId)();return n.createElement("li",{className:`popup-menu-item ${t}`},n.createElement("button",Object.assign({},s,{id:o,role:a,tabIndex:-1,onMouseDown:w,onMouseUp:g}),n.createElement("span",{className:"popup-menu-item-label"},r),n.createElement("span",{className:"popup-menu-item-accelerator-key"},i)))}var gg=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function wg(e){var{className:t="",checked:r=!1}=e,i=gg(e,["className","checked"]);return n.createElement(yg,Object.assign({},i,{className:`popup-menu-item-checkbox ${t}`,role:"menuitemcheckbox","aria-checked":r}))}function Eg(){return n.createElement("li",{className:"popup-menu-separator",role:"separator"})}var kg=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function xg(e,t,r,a){return kg(this,void 0,void 0,(function*(){return new Promise(((s,o)=>{const l=document.getElementById("popup"),c=document.createElement("div"),u=(0,i.s)(c);try{const i=e=>{u.unmount(),c.remove(),s(e)};l.append(c),u.render(n.createElement(e,{x:t,y:r,align:a,onClose:i}))}catch(e){u.unmount(),c.remove(),o(e)}}))}))}var Sg=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Tg=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Ag(e,t,r,i,a="left"){return Sg(this,void 0,void 0,(function*(){return xg((r=>n.createElement(Ig,Object.assign({},r,{items:e,isContextMenu:t}))),r,i,a)}))}function Ig(e){var{items:t,isContextMenu:r}=e,i=Tg(e,["items","isContextMenu"]);const a=t[0],s=1===t.length&&!!a,o=t.every((e=>e.itemType===Ln.Media||e.itemType===Ln.Album));return n.createElement(bg,Object.assign({},i),o?n.createElement(Pg,null):null,r&&s?n.createElement(Cg,{item:a}):null,s?n.createElement(yg,{label:"Info...",value:zn.Info,acceleratorKey:`${Y.ctrlKeyStr}+I`,key:zn.Info}):null)}function Pg(){return n.createElement(n.Fragment,null,n.createElement(yg,{label:"Queue",value:zn.Queue,acceleratorKey:"Enter",key:zn.Queue}),n.createElement(yg,{label:"Play next",value:zn.PlayNext,acceleratorKey:"Shift+Enter",key:zn.PlayNext}),n.createElement(yg,{label:"Play now",value:zn.PlayNow,acceleratorKey:`${Y.ctrlKeyStr}+Enter`,key:zn.PlayNow}),n.createElement(Eg,null))}function Cg({item:e}){const t=Am(e);return n.createElement(n.Fragment,null,e.itemType===Ln.Playlist&&(null==t?void 0:t.createSourceFromPin)?n.createElement(yg,{label:e.isPinned?"Unpin":"Pin",value:e.isPinned?zn.Unpin:zn.Pin,key:e.isPinned?zn.Unpin:zn.Pin}):null,void 0!==e.rating&&(null==t?void 0:t.canRate(e,!0))?n.createElement(yg,{label:e.rating?Lg(t,zn.Unlike):Lg(t,zn.Like),value:e.rating?zn.Unlike:zn.Like,key:e.rating?zn.Unlike:zn.Like}):null,!1===e.inLibrary&&(null==t?void 0:t.canStore(e,!0))?n.createElement(yg,{label:Lg(t,zn.AddToLibrary),value:zn.AddToLibrary,key:zn.AddToLibrary}):null,"apple"!==(null==t?void 0:t.id)&&!0===e.inLibrary&&(null==t?void 0:t.canStore(e,!0))?n.createElement(yg,{label:Lg(t,zn.RemoveFromLibrary),value:zn.RemoveFromLibrary,key:zn.RemoveFromLibrary}):null,n.createElement(Eg,null))}function Mg({value:e=0,tabIndex:t=0,onChange:r}){const[i,a]=(0,n.useState)((()=>Math.max(e-1,0))),[s,o]=(0,n.useState)(-1),[l,c]=(0,n.useState)(!1),u=(0,n.useCallback)((t=>{switch(t.key){case"ArrowLeft":if(0===i&&1===e)null==r||r(0);else if(i>0){const e=i-1;a(e),null==r||r(e+1)}break;case"ArrowRight":if(0===i&&0===e)null==r||r(1);else if(i<4){const e=i+1;a(e),null==r||r(e+1)}}}),[i,e,r]);return n.createElement("div",{className:"star-rating",tabIndex:t,onKeyDown:u,onMouseDown:w,onMouseUp:g,onMouseLeave:()=>o(-1)},n.createElement("button",{className:"star-rating-button "+(0===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(0),1===e?(c(!0),null==r||r(0)):null==r||r(1)},onMouseEnter:()=>{o(0),c(!1)}},-1===s&&e>0||0===s&&!l||s>0?"★":"☆"),n.createElement("button",{className:"star-rating-button "+(1===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(1),2===e?null==r||r(1):null==r||r(2)},onMouseEnter:()=>o(1)},-1===s&&e>1||s>=1?"★":"☆"),n.createElement("button",{className:"star-rating-button "+(2===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(2),3===e?null==r||r(2):null==r||r(3)},onMouseEnter:()=>o(2)},-1===s&&e>2||s>=2?"★":"☆"),n.createElement("button",{className:"star-rating-button "+(3===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(3),4===e?null==r||r(3):null==r||r(4)},onMouseEnter:()=>o(3)},-1===s&&e>3||s>=3?"★":"☆"),n.createElement("button",{className:"star-rating-button "+(4===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(4),5===e?null==r||r(4):null==r||r(5)},onMouseEnter:()=>o(4)},-1===s&&e>4||4===s?"★":"☆"))}var Og=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Ng={[zn.AddToLibrary]:"heart",[zn.RemoveFromLibrary]:"heart-fill",[zn.Rate]:"star",[zn.Like]:"heart",[zn.Unlike]:"heart-fill"},$g={[zn.AddToLibrary]:"Add to library",[zn.RemoveFromLibrary]:"Remove from library",[zn.Rate]:"Rate",[zn.Like]:"Like",[zn.Unlike]:"Unlike"};function zg({item:e,inline:t}){const r=Am(e),i=t?-1:void 0,a=(0,n.useCallback)((()=>Og(this,void 0,void 0,(function*(){e.itemType===Ln.Playlist&&(e.isPinned?yield gw(zn.Unpin,[e]):yield gw(zn.Pin,[e]))}))),[e]),s=(0,n.useCallback)((()=>Og(this,void 0,void 0,(function*(){e.rating?yield gw(zn.Unlike,[e]):yield gw(zn.Like,[e])}))),[e]),o=(0,n.useCallback)((()=>Og(this,void 0,void 0,(function*(){e.inLibrary?yield gw(zn.RemoveFromLibrary,[e]):yield gw(zn.AddToLibrary,[e])}))),[e]),l=(0,n.useCallback)((t=>Og(this,void 0,void 0,(function*(){const r=t.target.getBoundingClientRect(),n=yield Ag([e],!1,r.right,r.bottom,"right");n&&(yield gw(n,[e]))}))),[e]),c=(0,n.useCallback)((t=>Og(this,void 0,void 0,(function*(){yield gw(zn.Rate,[e],t)}))),[e]);return n.createElement(pg,null,t?n.createElement(hg,{icon:"menu",title:"More...",tabIndex:i,onClick:l,key:"menu"}):null,e.itemType===Ln.Playlist&&(null==r?void 0:r.createSourceFromPin)?n.createElement(hg,{icon:e.isPinned?"pin-fill":"pin",title:e.isPinned?"Unpin":"Pin to sidebar",tabIndex:i,onClick:a,key:"pin"}):null,r?n.createElement(n.Fragment,null,void 0!==e.rating&&(null==r?void 0:r.canRate(e,t))?"plex"===r.id?n.createElement(Mg,{value:e.rating,tabIndex:i,onChange:c}):n.createElement(hg,{icon:e.rating?jg(r,zn.Unlike):jg(r,zn.Like),title:e.rating?Lg(r,zn.Unlike):Lg(r,zn.Like),tabIndex:i,onClick:s,key:"rate"}):null,void 0!==e.inLibrary&&(null==r?void 0:r.canStore(e,t))?n.createElement(hg,{icon:e.inLibrary?jg(r,zn.RemoveFromLibrary):jg(r,zn.AddToLibrary),title:e.inLibrary?Lg(r,zn.RemoveFromLibrary):Lg(r,zn.AddToLibrary),tabIndex:i,disabled:"apple"===r.id&&e.inLibrary,onClick:o,key:"store"}):null):null)}function jg(e,t){var r;return(null===(r=e.icons)||void 0===r?void 0:r[t])||Ng[t]}function Lg(e,t){var r;return(null===(r=e.labels)||void 0===r?void 0:r[t])||$g[t]}var Dg=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const Fg=new O("musicbrainz/coverart");class Rg extends gt.ZP{constructor(){super("ampcast/musicbrainz/coverart"),this.version(2).stores({items:"&mbid, [album+artist], thumbnails"})}}const _g=new Rg;function Ug(e){switch(e){case"small":return 250;case"large":return 500;default:return Number(e)||0}}function Vg({item:e,size:t,className:r=""}){const[i,a]=(0,n.useState)(!1),[s,o]=(0,n.useState)((()=>e.thumbnails)),l=!!(null==s?void 0:s.length),c=l?function(e,t=240){if(1===e.length)return e[0];let r=e.filter((e=>Hg(e)<1.34));return 0===r.length&&(r=e.filter((e=>Hg(e)<1.5)),0===r.length&&(r=e)),t*=window.devicePixelRatio||1,r.sort(((e,r)=>Math.abs(e.height-t)-Math.abs(r.height-t))),r[0]}(s,t):void 0,u=c?Bg(c):"",d=function(e){switch(e.itemType){case Ln.Artist:return"artist";case Ln.Album:return"album";case Ln.Media:return e.mediaType===Fn.Video?"video":"audio";case Ln.Playlist:return"playlist";case Ln.Folder:return"folder"}}(e);(0,n.useEffect)((()=>o(e.thumbnails)),[e.thumbnails]),(0,n.useEffect)((()=>{if(!l){if(e.itemType===Ln.Media){const t=wh(e);if(t&&t.thumbnails)return void o(t.thumbnails)}const t=jr(function(e){var t;return Dg(this,void 0,void 0,(function*(){if(!e||e.itemType!==Ln.Album&&e.itemType!==Ln.Media)return;let r=!1;const n=e.release_mbid;if(n){const e=yield _g.items.get(n);if(r=!!e,null==e?void 0:e.thumbnails)return e.thumbnails}let i,a;if(e.itemType===Ln.Album?(i=e.title,a=e.artist):(i=e.album,a=e.albumArtist||(null===(t=e.artists)||void 0===t?void 0:t[0])),i&&a){const e=yield _g.items.get({album:i,artist:a});if(e)return e.thumbnails}if(n&&!r)try{const e=yield function(e){return Dg(this,void 0,void 0,(function*(){const t=yield fetch(`https://coverartarchive.org/release/${e}`);if(!t.ok)throw t;return t.json()}))}(n),t=e.images.filter((e=>e.front&&e.approved))[0],r=t?Object.keys(t.thumbnails).filter((e=>0!==Ug(e))).map((e=>({url:t.thumbnails[e],width:Ug(e),height:Ug(e)}))):[];return yield _g.items.put(0===r.length?{mbid:n}:{mbid:n,album:i,artist:a,thumbnails:r}),r}catch(e){404===e.status?yield _g.items.put({mbid:n}):Fg.error(e)}}))}(e)).subscribe(o);return()=>t.unsubscribe()}}),[l,e]);const m=(0,n.useCallback)((()=>a(!0)),[]);return n.createElement("figure",{className:`cover-art ${r}`,key:e.src},u&&!i?n.createElement("img",{className:"cover-art-image",src:u,alt:`${e.title}: Cover art`,onError:m}):d?n.createElement(Nt,{className:"cover-art-image",name:d}):null)}function Bg(e){return Em().reduce(((e,t)=>{var r,n;return null!==(n=null===(r=null==t?void 0:t.getThumbnailUrl)||void 0===r?void 0:r.call(t,e))&&void 0!==n?n:e}),(null==e?void 0:e.url)||"")}function Hg({width:e,height:t}){return e/t}function Yg({className:e,children:t}){const r=(0,n.useRef)(null),[i,a]=(0,n.useState)(0),s=(0,n.useCallback)((({scrollHeight:e})=>a(e)),[]);return n.createElement("div",{className:`text-box ${e}`,style:{height:`${i}px`},ref:r},n.createElement("div",{style:{position:"relative",height:"100%"}},n.createElement(qr,{onResize:s},t)))}const qg=new O("Media/useCurrentItem");var Kg=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Wg(e){const t=function(e){const[t,r]=(0,n.useState)(e),[i,a]=(0,n.useState)("");return(0,n.useEffect)((()=>{if(i!==e.src){const t=Am(e);if(null==t?void 0:t.getMetadata){const n=jr(t.getMetadata(e)).pipe(Le((t=>{a(e.src),r(Object.assign(Object.assign({},e),t))}))).subscribe(qg);return()=>n.unsubscribe()}a(e.src)}}),[e,i]),(0,n.useEffect)((()=>{const e=Cn.observe().pipe(Le((e=>{for(const{match:n,values:i}of e)if(n(t)){r(Object.assign(Object.assign({},t),i));break}}))).subscribe(qg);return()=>e.unsubscribe()}),[t]),t}(e.item);if(e.debug)return n.createElement(dw,{item:t});switch(t.itemType){case Ln.Media:return n.createElement(Gg,{item:t});case Ln.Artist:return n.createElement(Qg,{item:t});case Ln.Album:return n.createElement(Jg,{item:t});case Ln.Playlist:return n.createElement(Xg,{item:t});case Ln.Folder:return n.createElement(Zg,{item:t})}}function Gg({item:e}){var t;return n.createElement("article",{className:"media-info media-item-info"},n.createElement("div",{className:"media-info-main"},n.createElement(uw,{item:e}),n.createElement(ew,{title:e.title}),n.createElement(rw,{artist:null===(t=e.artists)||void 0===t?void 0:t.join(", ")}),n.createElement(aw,{album:e.album,year:e.year}),n.createElement(sw,{album:e.album,disc:e.disc,track:e.track}),n.createElement(nw,{owner:e.owner,src:e.src}),n.createElement(zg,{item:e})),n.createElement(tw,{description:e.description}),n.createElement(iw,{url:e.externalUrl,src:e.src}))}function Jg({item:e}){return n.createElement("article",{className:"media-info album-info"},n.createElement("div",{className:"media-info-main"},n.createElement(uw,{item:e}),n.createElement(ew,{title:e.title}),n.createElement(rw,{artist:e.artist}),n.createElement(ow,{year:e.year}),n.createElement(zg,{item:e})),n.createElement(tw,{description:e.description}),n.createElement(iw,{url:e.externalUrl,src:e.src}))}function Qg({item:e}){return n.createElement("article",{className:"media-info artist-info"},n.createElement("div",{className:"media-info-main"},n.createElement(uw,{item:e}),n.createElement(ew,{title:e.title}),n.createElement(lw,{genres:e.genres}),n.createElement(cw,{country:e.country}),n.createElement(zg,{item:e})),n.createElement(tw,{description:e.description}),n.createElement(iw,{url:e.externalUrl,src:e.src}))}function Xg({item:e}){return n.createElement("article",{className:"media-info playlist-info"},n.createElement("div",{className:"media-info-main"},n.createElement(uw,{item:e}),n.createElement(ew,{title:e.title}),n.createElement(nw,{owner:e.owner,src:e.src}),n.createElement(lw,{genres:e.genres}),n.createElement(zg,{item:e})),n.createElement(tw,{description:e.description}),n.createElement(iw,{url:e.externalUrl,src:e.src}))}function Zg({item:e}){return n.createElement("article",{className:"media-info folder-info"},n.createElement("div",{className:"media-info-main"},n.createElement(uw,{item:e}),n.createElement(ew,{title:e.title})))}function ew({title:e}){return n.createElement("h3",{className:"title"},e||"(no title)")}function tw({description:e}){const t=null==e?void 0:e.trim().split(/[\n\r]+/);return(null==t?void 0:t.length)?n.createElement(Yg,{className:"blurb"},t.map(((e,t)=>n.createElement("p",{key:t},e)))):null}function rw({artist:e}){return e?n.createElement("h4",{className:"artist"},"By: ",e):null}function nw({src:e,owner:t}){if(!t||!t.name)return null;const[r]=e.split(":"),i="youtube"===r?"Channel":"Curator";return n.createElement("p",{className:"owner"},i,":"," ",t.url?n.createElement(mo,{href:t.url},t.name):t.name)}function iw({src:e,url:t=""}){let[r]=e.split(":"),i=r;switch(r){case"musicbrainz":i="MusicBrainz";break;case"plex-tidal":i="Plex";break;case"listenbrainz":/musicbrainz/.test(t)?(i="MusicBrainz",r="musicbrainz"):i="ListenBrainz";break;case"blob":case"file":i="local file system";break;default:{const e=Tm(r);e&&(i=e.name)}}return n.createElement("p",{className:"external-view"},n.createElement(Nt,{name:r}),t?n.createElement(mo,{href:t},"View on ",i):n.createElement("span",{className:"external-provider"},"Provided by ","plex-tidal"===r?"TIDAL":i))}function aw({album:e,year:t}){return e&&t?n.createElement("h4",{className:"album"},"From: ",e," (",t,")"):e?n.createElement("h4",{className:"album"},"From: ",e):t?n.createElement("h4",{className:"album"},"Year: ",t):null}function sw({album:e,disc:t=1,track:r}){return e&&r?n.createElement("p",{className:"track"},"Track: ",r,t>1?` (Disc ${t})`:""):null}function ow({year:e}){return e?n.createElement("p",{className:"year"},"Year: ",e):null}function lw({genres:e}){return e?n.createElement("p",{className:"genre"},"Genre: ",e.join(", ")):null}function cw({country:e}){return e?n.createElement("p",{className:"country"},"Country: ",e):null}function uw(e){return n.createElement("div",{className:"thumbnail"},n.createElement(Vg,Object.assign({},e)))}function dw(e){const t=e.item,{pager:r,parent:i}=t,a=Kg(t,["pager","parent"]);return n.createElement("article",{className:"media-info debug"},n.createElement("pre",null,JSON.stringify(a,void 0,2)),n.createElement(iw,{url:a.externalUrl,src:a.src}))}function mw(e){const[t,r]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{if(e.current){const e=document.querySelectorAll(".focus");for(const t of e)t.classList.toggle("focus",!1)}const t=Ar(document,"keydown",{capture:!0}).subscribe((t=>{var n;t.repeat||(t.ctrlKey&&t.shiftKey&&"Digit8"===t.code?r((e=>!e)):t[Y.ctrlKey]&&!t.shiftKey&&"KeyI"===t.code&&(t.preventDefault(),null===(n=e.current)||void 0===n||n.close()))}));return()=>t.unsubscribe()}),[e]),{debug:t}}var hw=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},fw=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function pw(e){return hw(this,void 0,void 0,(function*(){yield Dt((t=>n.createElement(bw,Object.assign({},t,{item:e}))))}))}function bw(e){var{item:t}=e,r=fw(e,["item"]);const i=(0,n.useRef)(null),{debug:a}=mw(i),s=function(e){switch(e.itemType){case Ln.Playlist:return"Playlist info";case Ln.Album:return"Album info";case Ln.Artist:return"Artist info";case Ln.Folder:return"Folder info";default:return"Media info"}}(t);return n.createElement(jt,Object.assign({},r,{className:"media-info-dialog",title:s,ref:i}),n.createElement("form",{method:"dialog"},n.createElement(Wg,{item:t,debug:a}),n.createElement("footer",{className:"dialog-buttons"},n.createElement("button",null,"Close"))))}var vw=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const yw=new O("ampcast/actions");function gw(e,t,r){return vw(this,void 0,void 0,(function*(){const n=t[0];if(!n)return;const i=n.itemType;switch(e){case zn.PlayNow:case zn.PlayNext:case zn.Queue:!function(e,t){vw(this,void 0,void 0,(function*(){const r=t[0];if(!r)return;const n=r.itemType;if(n===Ln.Media||n===Ln.Album)switch(e){case zn.PlayNow:case zn.PlayNext:e===zn.PlayNow&&(dg.autoplay=!0),n===Ln.Media?yield ff.insert(t):yield ff.insert(r),e===zn.PlayNow&&ff.next();break;case zn.Queue:n===Ln.Media?yield ff.add(t):yield ff.add(r)}}))}(e,t);break;case zn.Like:case zn.Unlike:case zn.Rate:case zn.AddToLibrary:case zn.RemoveFromLibrary:!function(e,t,r){vw(this,void 0,void 0,(function*(){if(t)try{switch(e){case zn.Like:yield Nn.rate(t,1);break;case zn.Unlike:yield Nn.rate(t,0);break;case zn.Rate:"number"==typeof r&&(yield Nn.rate(t,r));break;case zn.AddToLibrary:yield Nn.store(t,!0);break;case zn.RemoveFromLibrary:yield Nn.store(t,!1)}}catch(n){yw.warn("Failed to perform action:",{action:e,item:t,payload:r}),yw.error(n)}}))}(e,n,r);break;case zn.Pin:i===Ln.Playlist&&(yield gi.pin(t));break;case zn.Unpin:i===Ln.Playlist&&(yield gi.unpin(t));break;case zn.Info:yield pw(n)}}))}let ww=null,Ew="none";const kw={getData:function(e){return"#globalDrag"===e.dataTransfer.getData("text")?ww:null},getEffect:function(e){return"#globalDrag"===e.dataTransfer.getData("text")?Ew:"none"},set:function(e,t,r){e.dataTransfer.setData("text","#globalDrag"),e.dataTransfer.effectAllowed=r,ww=t,Ew=r},unset:function(){ww=null,Ew="none"}};function xw(e){const t=(0,n.useRef)();return(0,n.useEffect)((()=>{t.current=e}),[e]),t.current}function Sw({style:e,title:t}){return n.createElement("div",{className:"list-view-cell",style:e},t)}function Tw({col:e,onResize:t}){const[r,i]=(0,n.useState)(-1),[a,s]=(0,n.useState)(0),o=-1!==r,{width:l,index:c}=e,u=(0,n.useCallback)((e=>{e.preventDefault(),0===e.button&&(i(e.screenX),s(l))}),[l]);(0,n.useEffect)((()=>t(e.index,l)),[e.index,l,t]);const d=(0,n.useCallback)((e=>{t(c,Math.max(20,a+(e.screenX-r)))}),[r,a,c,t]),m=(0,n.useCallback)((()=>{i(-1),s(0)}),[]);return(0,n.useEffect)((()=>{if(o)return document.documentElement.style.cursor="col-resize",document.body.classList.add("dragging"),document.addEventListener("mouseup",m),document.addEventListener("mousemove",d),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",d)}}),[o,d,m]),n.createElement("span",{className:"column-resizer",onMouseDown:u,style:{left:e.left+l-4+"px"}})}function Aw({width:e,height:t,cols:r,sizeable:i,onColumnResize:a}){const s=(0,n.useCallback)(((e,t)=>{null==a||a(e,t)}),[a]);return n.createElement("header",{className:"list-view-head",style:{width:`${e}px`}},n.createElement("div",{className:"list-view-row",style:{width:`${e}px`,height:`${t}px`}},r.map((e=>n.createElement(Sw,Object.assign({},e,{key:e.index}))))," ",i&&r.map((e=>n.createElement(Tw,{col:e,onResize:s,key:e.index})))))}function Iw({rowIndex:e,col:{className:t="",render:r,style:i},item:a}){return n.createElement("div",{className:`list-view-cell ${t}`,style:i},r(a,e))}function Pw({item:e,className:t,id:r,rowIndex:i,height:a,selected:s,cols:o,setSize:l,dragIndex:c}){const u=`${t} ${s?"selected selected-text":""} ${c===l?i===l-1?"drag-over-last":"":c===i?"drag-over":""}`;return n.createElement("li",{role:"option",className:`list-view-row ${u}`,id:r,"aria-selected":s,"aria-setsize":l,"aria-posinset":i+1,style:{height:`${a}px`,transform:`translateY(${a*i}px)`}},o.map((t=>n.createElement(Iw,{rowIndex:i,col:t,item:e,key:t.index}))))}function Cw({listViewId:e,title:t,width:r,height:i,rowHeight:a,cols:s,items:o,itemKey:l,itemClassName:c,selectedId:u,selectedIds:d,scrollTop:m,overScan:h=2,draggable:f,dragIndex:p,multiple:b=!1}){const v=(0,n.useRef)(null),y=o.length,g=Math.floor(m/a),w=Math.floor(i/a),E=Math.max(0,g-h),k=Math.min(y,w+2*h),x=o.slice(E,E+k);return n.createElement("ol",{role:"listbox",className:"list-view-body",draggable:f,style:{width:r?`${r}px`:void 0},"aria-label":t,"aria-multiselectable":b,"aria-activedescendant":u,ref:v},x.map(((t,r)=>n.createElement(Pw,{className:c(t),id:`${e}-${t[l]}`,rowIndex:E+r,height:a,selected:!!t&&d.includes(t[l]),cols:s,item:t,setSize:y,dragIndex:p,key:t[l]}))))}const Mw=[],Ow=()=>"",Nw=["ArrowUp","ArrowDown","PageUp","PageDown"];function $w({items:e=[],itemKey:t,title:r,itemClassName:i=Ow,layout:a,className:s="",selectedIndex:o=-1,draggable:l,droppable:c,droppableTypes:u=[],multiple:d,reorderable:m,disabled:h,onClick:f,onDoubleClick:p,onContextMenu:b,onDrop:v,onDelete:y,onEnter:g,onInfo:w,onRowIndexChange:E,onScrollIndexChange:k,onPageSizeChange:x,onSelect:S,onMove:T,listViewRef:A}){const I=(0,n.useId)(),P=(0,n.useRef)(null),C=(0,n.useRef)(null),M=(0,n.useRef)(null),O=(0,n.useRef)(null),N=(0,n.useRef)(null),$="details"===a.view&&a.showTitles,z="details"===a.view&&a.sizeable,[j,L]=(0,n.useState)(-1),[D,F]=(0,n.useState)(0),[R,_]=(0,n.useState)(0),[U,V]=(0,n.useState)(0),[B,H]=(0,n.useState)(0),[q,K]=function(e){const[t,r]=(0,n.useState)([]),i="details"===e.view&&e.sizeable;(0,n.useEffect)((()=>{const t="details"===e.view,n=t&&e.sizeable;r(e.cols.reduce(((e,r,i)=>{const a=e[i-1],s=a?a.left+a.width:0,{title:o="",className:l="",align:c="left",width:u=200}=r,d=n?{left:`${s}px`,width:`${u}px`,textAlign:c}:t?{textAlign:c}:{};return e.push(Object.assign(Object.assign({},r),{title:o,className:l,align:c,index:i,left:s,width:u,style:d})),e}),[]))}),[e]);const a=(0,n.useCallback)(((e,n)=>{i&&t[e].width!==n&&r(t.reduce(((t,r,i)=>{if(i>=e){const a=t[i-1],s=a?a.left+a.width:0,o=i===e?n:r.width,l={left:`${s}px`,width:`${o}px`,textAlign:r.align};t.push(Object.assign(Object.assign({},r),{left:s,width:o,style:l}))}else t.push(r);return t}),[]))}),[t,i]);return[t,a]}(a),W=(0,n.useMemo)((()=>q.reduce(((e,t)=>e+t.width),0)),[q]),G=B?Math.max(Math.floor(R/B),1)-($?1:0):0,J=e.length,{selectedItems:Q,selectAll:X,selectAt:Z,selectRange:ee,toggleSelectionAt:te}=function(e,t,r){const[i,a]=(0,n.useState)([]),s=xw(e);(0,n.useEffect)((()=>{if(e!==s){const s=e.filter((e=>i.some((r=>r[t]===e[t]))));if(o=s,(n=i).length!==o.length||!n.every(((e,t)=>o[t]===e))){const t=e.length;if(t>0&&0===s.length)if(r<t){const t=e[r];a(t?[t]:[])}else{const r=e[t-1];a(r?[r]:[])}else a(s)}}var n,o}),[s,e,i,t,r]);const o=(0,n.useCallback)((()=>{a(e.slice())}),[e]),l=(0,n.useCallback)((t=>{const r=e[t];a(r?[r]:[])}),[e]),c=(0,n.useCallback)(((t,r)=>{const n=Math.min(t,r),i=Math.max(t,r),s=e.slice(n,i+1);a(s)}),[e]),u=(0,n.useCallback)(((t,r)=>{const n=e[t],s=i.includes(n);s!==r&&a(s?i.filter((e=>e!==n)):e.filter((e=>i.includes(e)||e===n)))}),[e,i]);return{selectedItems:i,selectAll:o,selectAt:l,selectRange:c,toggleSelectionAt:u}}(e,t,j),re=Q.length>0,ne=Pt(),[ie,ae]=(0,n.useState)(-1),[se,oe]=(0,n.useState)(-1),[le,ce]=(0,n.useState)(-1),ue=0===J,de=-1!==le,me=B?Math.floor(D/B):0,he=Gr(Nw)&&!(0===j||j===J-1),fe=xw(e),[pe,be]=(0,n.useState)((()=>Q)),[ve,ye,ge,we]=l?Q:[],Ee=e[j]?`${I}-${e[j][t]}`:"",ke=(0,n.useMemo)((()=>Q.map((e=>e[t]))),[Q,t]),xe=(0,n.useCallback)((()=>C.current.focus()),[]),Se=(0,n.useCallback)((e=>{const t=M.current,r=Math.floor(D/B);if(e>=r+G-1){const r=(J+($?1:0))*B,n=J-G-1,i=Math.min(J-1,e+1)-G,a=i===n?r:i*B;t.scrollTo({top:a})}else if(e<=r){const r=Math.max(0,e-1)*B;t.scrollTo({top:r})}}),[D,B,G,$,J]),Te=(0,n.useCallback)((e=>{Se(e),Z(e),L(e)}),[Se,Z]);(0,n.useEffect)((()=>{P.current={focus:xe,scrollIntoView:Te,scrollTo:Se,selectAll:X,selectAt:Z},A&&(A.current=Object.assign(A.current||{},P.current))}),[A,xe,Te,Se,X,Z]),(0,n.useEffect)((()=>{var e;null===(e=P.current)||void 0===e||e.scrollIntoView(o)}),[o]),(0,n.useEffect)((()=>null==E?void 0:E(j)),[j,E]),(0,n.useEffect)((()=>null==k?void 0:k(me)),[me,k]),(0,n.useEffect)((()=>null==x?void 0:x(G)),[G,x]),(0,n.useEffect)((()=>null==S?void 0:S(pe)),[pe,S]),(0,n.useEffect)((()=>L(Math.min(J-1,j))),[J,j]),(0,n.useEffect)((()=>{if(fe&&e.length!==fe.length){const r=fe[j];if(r){const n=e.findIndex((e=>e&&e[t]===r[t]));-1!==n&&L(n)}}}),[e,fe,j,t]),(0,n.useEffect)((()=>{he||be(Q)}),[Q,he]),(0,n.useEffect)((()=>{ue&&L(-1)}),[ue]),(0,n.useEffect)((()=>{!d&&Q.length>1&&Z(j)}),[d,j,Q,Z]);const Ae=(0,n.useCallback)((t=>{switch(t.code){case"Enter":t.stopPropagation(),t.repeat||null==g||g(Q,t[Y.ctrlKey],t.shiftKey);break;case"Delete":t.stopPropagation(),null==y||y(Q);break;case"KeyI":if(t.stopPropagation(),t.preventDefault(),t[Y.ctrlKey]&&!t.shiftKey&&!t.repeat){null==w||w(Q);break}break;case"KeyA":t[Y.ctrlKey]&&!t.shiftKey&&(t.preventDefault(),t.stopPropagation(),t.repeat||X());break;case"ShiftLeft":case"ShiftRight":t.repeat||ae(j);break;case"Space":t.preventDefault(),t.repeat||(t[Y.ctrlKey]?(t.stopPropagation(),te(j)):Q.includes(e[j])||(t.stopPropagation(),te(j,!0)));break;default:{const r=e.length,n=function(e,t,r,n){switch(e){case"ArrowUp":t-=1;break;case"ArrowDown":t+=1;break;case"PageUp":t-=r-1;break;case"PageDown":t+=r-1;break;case"Home":t=0;break;case"End":t=n-1;break;default:return-1}return Math.min(Math.max(t,0),n-1)}(t.key,j,G,r);-1!==n&&(t.preventDefault(),n!==j&&(t.stopPropagation(),Se(n),L(n)),d&&t.shiftKey&&-1!==ie?ee(ie,n):t[Y.ctrlKey]||Z(n))}}}),[j,e,G,g,y,w,Se,X,Z,ee,te,Q,d,ie]),Ie=(0,n.useCallback)((e=>{const t=zw(e);-1!==t&&(L(t),d&&e.shiftKey?-1===ie?ee(t,j):ee(ie,t):d&&e[Y.ctrlKey]?te(t):function(e){const t=jw(e);return!!(null==t?void 0:t.classList.contains("selected"))}(e)||Z(t))}),[Z,te,ee,j,ie,d]),Pe=(0,n.useCallback)((e=>{if(0===e.button){const t=zw(e);-1!==t&&(!d||e[Y.ctrlKey]||e.shiftKey||Z(t))}}),[Z,d]),Ce=(0,n.useCallback)((e=>{"Shift"===e.key&&ae(-1)}),[]),Me=(0,n.useCallback)((({clientWidth:e,clientHeight:t})=>{V(e),_(t)}),[]),Oe=(0,n.useCallback)((({top:e})=>{F(e)}),[]);At(O,(()=>{H(O.current.getBoundingClientRect().height)})),(0,n.useEffect)((()=>{C.current.classList.toggle("thin",20*ne>U)}),[ne,U]);const Ne=(0,n.useCallback)((t=>{const r=zw(t);-1!==r&&(t.preventDefault(),null==f||f(e[r],r))}),[e,f]),$e=(0,n.useCallback)((e=>{if(e.preventDefault(),-1===e.button){const t=function(e,t){return e.querySelector(`li[aria-posinset="${t+1}"]`)}(C.current,j);if(t){const r=t.getBoundingClientRect();null==b||b(Q,Math.min(r.left+U,r.right),r.bottom,j,e.button)}}else null==b||b(Q,e.pageX,e.pageY,zw(e),e.button)}),[j,Q,b,U]),ze=(0,n.useCallback)((t=>{const r=zw(t);-1!==r&&(t.preventDefault(),null==p||p(e[r],r))}),[e,p]);(0,n.useEffect)((()=>{const e=N.current;for(;e.hasChildNodes();)e.removeChild(e.lastChild);const t=Array.from(C.current.querySelectorAll(".list-view-body:not(list-view-drag-image) li.selected"));t.length=Math.min(t.length,4);for(let r=0;r<t.length;r++){const n=t[r].cloneNode(!0);n.removeAttribute("id"),n.removeAttribute("role"),n.style.transform=`translateY(${B*r}px)`,e.appendChild(n)}}),[ve,ye,ge,we,B]);const je=(0,n.useCallback)((e=>{const t=e.dataTransfer;if(l||m){t.setDragImage(N.current,-16,-16);let r="none";r=l&&m?"copyMove":l?"copy":"move",kw.set(e,Q,r),ce(j)}else t.effectAllowed="none"}),[l,m,Q,j]),Le=(0,n.useCallback)((e=>{e.preventDefault(),e.stopPropagation();const t=e.dataTransfer;if(c||m){const r=t.types.includes("text/plain");let n=zw(e);-1===n&&(n=J),de?m&&r?(t.dropEffect="move",oe(n)):(t.dropEffect="none",oe(-1)):c&&(r||Lw(t.items,u))?(t.dropEffect="copy",oe(n)):(t.dropEffect="none",oe(-1))}else de?t.dropEffect="copy":(t.dropEffect="none",oe(-1))}),[J,de,c,u,m]),De=(0,n.useCallback)((e=>{if(c||m){const t=e.dataTransfer;let r=zw(e);-1===r&&(r=J);const n=kw.getEffect(e);if("copy"===n){const t=kw.getData(e);t&&(null==v||v(t,r))}else if("move"===n){const e=le<r?-1:0;null==T||T(Q,r),L(r+e)}else c&&Lw(t.items,u)&&(null==v||v(t.files,r))}oe(-1),e.preventDefault(),e.stopPropagation()}),[J,Q,c,u,m,le,v,T]),Fe=(0,n.useCallback)((()=>{kw.unset(),ce(-1)}),[]),Re=(0,n.useCallback)((()=>{oe(-1)}),[]),_e=(0,n.useCallback)((()=>{d||re||Z(Math.max(j,0))}),[re,j,d,Z]);return n.createElement("div",{className:`list-view list-view-${a.view} ${s}`,tabIndex:h?void 0:ue?-1:0,onClick:Ne,onContextMenu:$e,onDoubleClick:ze,onDragStart:je,onDragEnter:Le,onDragOver:Le,onDragLeave:Re,onDragEnd:Fe,onDrop:De,onFocus:_e,onKeyDown:Ae,onKeyUp:Ce,onMouseDown:Ie,onMouseUp:Pe,ref:C},n.createElement(qr,{scrollWidth:z?W:void 0,scrollHeight:(J+(c?1:0)+($?1:0))*B,scrollAmount:B,droppable:c||m&&de,onResize:Me,onScroll:Oe,scrollableRef:M},$&&n.createElement(sr,null,n.createElement(Aw,{width:W,height:B,sizeable:z,cols:q,onColumnResize:K})),n.createElement(Cw,{title:r,width:z?W:void 0,height:R,rowHeight:B,cols:q,items:e,itemKey:t,itemClassName:i,listViewId:I,selectedId:Ee,selectedIds:h?Mw:ke,scrollTop:D,dragIndex:se,draggable:!h&&(l||m),multiple:d}),n.createElement("div",{className:"list-view-cursor",style:{width:z?`${W}px`:void 0,transform:`translateY(${Math.max(j,0)*B}px)`},ref:O})),n.createElement("ul",{className:"list-view-drag-image list-view-body","aria-hidden":!0,ref:N}))}function zw(e){let t=0;const r=jw(e);return r&&(t=Number(r.getAttribute("aria-posinset"))||0),t-1}function jw(e){let t=e.target;for(;t&&!(null==t?void 0:t.hasAttribute("aria-posinset"));)t=t.parentElement;return t}function Lw(e,t){return-1!==Array.from(e).findIndex((e=>t.some((t=>((e,t)=>{const[r,n]=e.split("/"),[i,a]=t.split("/");return r===i&&(n===a||"*"===n)})(t,e.type)))))}function Dw(){return zf(nf,null)}function Fw({children:e}){return n.createElement("footer",{className:"status-bar"},e)}function Rw({items:e,size:t,maxSize:r,error:i,loading:a,loadingText:s="Loading",selectedCount:o,itemName:l="item",itemNamePlural:c=l+"s"}){let u="";if(a)u=n.createElement("span",{className:"message"},s,"...");else if(e.length>0){const i=e.reduce((e=>e+1),0),a=n.createElement("span",{className:"selected"},"(",_w(o)," selected)"),s=i===t?`${t.toLocaleString()} ${1===t?l:c}`:`Loaded ${_w(i)} of ${void 0===t?r||`${_w(e.length)}+`:_w(r?Math.min(t,r):t)} ${c}`;u=n.createElement("span",{className:"message"},s," ",a)}else if(i){const e=function(e){return String(e.message||e.statusText||Uw[e.status]||e.status||"")}(i);u=n.createElement(n.Fragment,null,n.createElement(Nt,{name:"error"}),n.createElement("span",{className:"message error"},e?`Error: ${e}`:"Error"))}else u=n.createElement("span",{className:"message"},"0 ",c);return n.createElement(Fw,null,u)}function _w(e=0){return(e=Number(e))<1e4?String(e):e.toLocaleString()}const Uw={401:"Unauthorized",403:"Forbidden",404:"Not found",408:"Timeout",429:"Too many requests",500:"Internal server error",502:"Bad gateway",503:"Service unavailable",504:"Timeout"},Vw=(0,n.memo)((function({time:e}){const t=100/6,r=new Date(e);let i=r.getHours()+r.getMinutes()/60,a=Math.min(i,6),s=i-a;return i>12&&(i=24-i,s=Math.min(i,6),a=i-s),n.createElement("span",{role:"presentation",className:"sun-clock",title:r.toLocaleTimeString(),style:{"--am-alpha":a*t+"%","--pm-alpha":s*t+"%"}})}));function Bw({time:e,className:t}){return n.createElement("time",{className:t},v(e))}const Hw={view:"details",fields:["Title","Genre","Owner"]};const Yw=e=>n.createElement(Bw,{className:"text",time:e.duration||0});function qw({value:e=""}){return""===e?null:n.createElement("span",{className:"text"},e)}const Kw={Index:{title:"#",render:(e,t)=>t+1,className:"index",align:"right",width:60},Artist:{title:"Artist",render:e=>{var t;return n.createElement(qw,{value:e.itemType===Ln.Media?null===(t=e.artists)||void 0===t?void 0:t.join(", "):e.artist})},className:"artist"},AlbumArtist:{title:"Album Artist",render:e=>n.createElement(qw,{value:e.albumArtist}),className:"artist"},AlbumTrack:{title:"#",render:e=>n.createElement("span",{className:"text"},e.track?n.createElement(n.Fragment,null,n.createElement("span",{className:"disc"},e.disc||"?","."),e.track):"-"),align:"right",width:60,className:"index"},Title:{title:"Title",render:e=>n.createElement(qw,{value:e.title}),className:"title"},IconTitle:{title:"Title",render:e=>{const t=Am(e);return t?n.createElement(Yi,{icon:t.icon,text:e.title}):n.createElement(qw,{value:e.title})},className:"title"},Blurb:{title:"Description",render:e=>n.createElement(qw,{value:e.description}),className:"blurb"},Album:{title:"Album",render:e=>n.createElement(qw,{value:e.album}),className:"album"},AlbumAndYear:{title:"Album",render:e=>n.createElement(qw,{value:e.album?e.year?`${e.album} (${e.year})`:e.album:e.year}),className:"album"},Track:{title:"Track",render:e=>n.createElement(qw,{value:e.track||"-"}),align:"right",width:80,className:"track"},Duration:{title:"Time",render:Yw,align:"right",width:120,className:"duration"},FileIcon:{title:"Thumbnail",render:(e,t)=>{const r=e.itemType===Ln.Media?e.mediaType===Fn.Video?"file-video":"file-audio":0===t&&e.fileName.startsWith("../")?"folder-up":"folder";return n.createElement("figure",{className:"cover-art"},n.createElement(Nt,{className:"cover-art-image",name:r}))},className:"thumbnail"},FileName:{title:"FileName",render:e=>n.createElement(qw,{value:e.fileName}),className:"title"},PlayCount:{title:"Plays",render:e=>n.createElement(qw,{value:Ww(e.playCount)}),align:"right",width:80,className:"play-count"},TrackCount:{title:"Tracks",render:e=>n.createElement(qw,{value:Ww(e.trackCount)}),align:"right",width:120,className:"track-count"},Year:{title:"Year",render:e=>n.createElement(qw,{value:e.year||""}),width:120,className:"year"},Views:{title:"Views",render:e=>void 0===e.globalPlayCount?null:n.createElement(qw,{value:Gw(e.globalPlayCount,"view")}),className:"views"},Genre:{title:"Genre",render:e=>{var t;return n.createElement(qw,{value:null===(t=e.genres)||void 0===t?void 0:t.join(", ")})},className:"genre"},Owner:{title:"Owner",render:e=>{var t;return n.createElement(qw,{value:null===(t=e.owner)||void 0===t?void 0:t.name})},className:"owner"},LastPlayed:{title:"Last played",render:e=>{if(!e.playedAt)return n.createElement("span",{className:"text last-played"},"unplayed");const t=new Date(1e3*e.playedAt),r=function(e){const t=Date.now()-e,r=6e4;if(t<12e4)return"just now";const n=36e5;if(t<54e5)return`${Math.round(t/r)} mins ago`;const i=24*n;if(t<1.5*i)return`${Math.round(t/n)} hours ago`;if(t<12*i)return`${Math.round(t/i)} days ago`;const a=7*i;if(t<10*a)return`${Math.round(t/a)} weeks ago`;const s=365*i;return t<s?`${Math.round(t/2592e6)} months ago`:t<2*s?"1 year ago":`${Math.floor(t/s)} years ago`}(t.valueOf());return n.createElement("time",{className:"text last-played",title:t.toLocaleDateString()},r)},className:"played-at"},ListenDate:{title:"Played On",render:e=>{if(!e.playedAt)return"";const t=1e3*e.playedAt;return n.createElement("time",{className:"text"},n.createElement(Vw,{time:t}),n.createElement("span",{className:"date"},new Date(t).toLocaleDateString()))},className:"played-at listen-date"},Thumbnail:{title:"Thumbnail",render:e=>n.createElement(Vg,{item:e}),className:"thumbnail"},Rate:{title:n.createElement(Mg,{value:0,tabIndex:-1}),render:e=>{const t=(0,n.useCallback)((t=>{return r=void 0,n=void 0,a=function*(){yield gw(zn.Rate,[e],t)},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(r,n||[])).next())}));var r,n,i,a}),[e]);return n.createElement(Mg,{value:e.rating,tabIndex:-1,onChange:t})},align:"right",width:120,className:"rate"}};function Ww(e){if(null==e)return"";const t=Number(e);return isNaN(t)?"":t.toLocaleString()}function Gw(e=0,t="listen",r=t+"s"){return 1===e?`1 ${t}`:e<1e3?`${e} ${r}`:e<1e5?`${(e/1e3).toFixed(1).replace(".0","")}K  ${r}`:e<1e6?`${Math.round(e/1e3)}K  ${r}`:e<1e8?`${(e/1e6).toFixed(1).replace(".0","")}M  ${r}`:e<1e9?`${Math.round(e/1e6)}M  ${r}`:`${(e/1e9).toFixed(1).replace(".0","")}B  ${r}`}var Jw=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))},Qw=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Xw(e){var{className:t="",pager:r=null,statusBar:i=!0,loadingText:a,onDoubleClick:s,onEnter:o,onSelect:l}=e,c=Qw(e,["className","pager","statusBar","loadingText","onDoubleClick","onEnter","onSelect"]);const u=function(e=Hw){return(0,n.useMemo)((()=>function(e){if("none"===e.view)return{view:"details",cols:[]};const{view:t,fields:r}=e,i=r.map((e=>Kw[e]));return i.push({title:n.createElement(Nt,{name:"menu"}),render:e=>n.createElement(zg,{item:e,inline:!0}),className:"actions",align:"right",width:80}),"details"===t?{view:t,cols:i,showTitles:!0,sizeable:!0}:{view:t,cols:i}}(e)),[e])}(c.layout),[d,m]=(0,n.useState)(0),[h,f]=(0,n.useState)(0),[{items:p,loaded:b,error:v,size:y,maxSize:g},w]=function(e){const[t,r]=function(){const e=(0,n.useRef)(null);null===e.current&&(e.current=new Me);const t=(0,n.useCallback)((t=>{e.current.next(t)}),[]);return[e.current,t]}(),[i,a]=(0,n.useState)([]),[s,o]=(0,n.useState)(void 0),[l,c]=(0,n.useState)(void 0),[u,d]=(0,n.useState)(),[m,h]=(0,n.useState)(!1),f=(0,n.useMemo)((()=>({items:i,size:s,maxSize:l,error:u,loaded:m})),[i,s,l,u,m]),p=(0,n.useCallback)(((e,t)=>{r([e,t])}),[r]);return(0,n.useEffect)((()=>{if(a([]),o(void 0),c(void 0),d(void 0),h(!1),!e)return;const r=e.observeItems(),n=e.observeSize(),i=e.observeError(),s=Rr(r,i).pipe(Rn(1),yr((()=>!0))),l=Lr(Wr([]),Wr([]).pipe(Nd(0))),u=new ae;return u.add(Lr(l,r).subscribe(a)),u.add(n.subscribe(o)),u.add(i.subscribe(d)),u.add(s.subscribe(h)),u.add(t.subscribe((([t,r])=>{e.fetchAt(t,r)}))),c(e.maxSize),()=>u.unsubscribe()}),[e,t]),[f,p]}(r),[E,k]=(0,n.useState)(0),x=Dw(),S=function(e){const[t,r]=(0,n.useState)("");return(0,n.useEffect)((()=>{let t=0;"details"!==e.view&&e.cols.forEach((e=>{/played-at/.test(e.className)&&(t=2),2!==t&&/duration|track-count|play-count/.test(e.className)&&(t=1)})),r(t?`clip-${t}`:"")}),[e]),t}(u);(0,n.useEffect)((()=>{d>=0&&h>0&&w(d,h)}),[w,d,h,r]);const T=(0,n.useCallback)((e=>{k(e.length),null==l||l(e)}),[l]),A=(0,n.useCallback)(((e,t,r,n,i)=>Jw(this,void 0,void 0,(function*(){if(0===e.length)return;const n=yield Ag(e,!0,t,r,-1===i?"right":"left");n&&(yield gw(n,e))}))),[]),I=(0,n.useCallback)(((e,t)=>Jw(this,void 0,void 0,(function*(){Zw(e)?yield gw(zn.Queue,[e]):null==s||s(e,t)}))),[s]),P=(0,n.useCallback)(((e,t,r)=>Jw(this,void 0,void 0,(function*(){e.every(Zw)?t||r?t&&!r?yield gw(zn.PlayNow,e):r&&!t&&(yield gw(zn.PlayNext,e)):yield gw(zn.Queue,e):null==o||o(e,t,r)}))),[o]),C=(0,n.useCallback)((e=>Jw(this,void 0,void 0,(function*(){yield gw(zn.Info,e)}))),[]),M=(0,n.useCallback)((e=>{if((null==e?void 0:e.itemType)===Ln.Media){const[t]=e.src.split(":");return`source-${t} ${e.src===(null==x?void 0:x.src)?"playing":""} ${e.unplayable?"unplayable":""}`}return""}),[x]);return n.createElement("div",{className:`panel ${t} ${S}`},n.createElement($w,Object.assign({},c,{className:"media-list",layout:u,items:p,itemClassName:M,itemKey:"src",selectedIndex:0===p.length?-1:0,onContextMenu:A,onDoubleClick:I,onEnter:P,onInfo:C,onPageSizeChange:f,onScrollIndexChange:m,onSelect:T})),i?n.createElement(Rw,{items:p,error:v,size:y,maxSize:g,loading:!!r&&!b,loadingText:a,selectedCount:E}):null)}function Zw(e){return e.itemType===Ln.Media||e.itemType===Ln.Album}var eE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const tE={view:"card compact",fields:["Thumbnail","Title","Artist","Year"]};function rE(e){var{className:t="",layout:r=tE,draggable:i=!0}=e,a=eE(e,["className","layout","draggable"]);return n.createElement(Xw,Object.assign({},a,{className:`albums ${t}`,layout:r,draggable:i}))}var nE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const iE={view:"details",fields:["Artist","Title","Album","Track","Duration","Genre","PlayCount"]};function aE(e){var{className:t="",layout:r=iE,multiple:i=!0,draggable:a=!0}=e,s=nE(e,["className","layout","multiple","draggable"]);return n.createElement(Xw,Object.assign({},s,{className:`media-items ${t}`,layout:r,multiple:i,draggable:a}))}const sE={view:"details",fields:["AlbumTrack","Title","Artist","Duration"]};function oE(e,t=sE){const[r,i]=(0,n.useState)(t);return(0,n.useEffect)((()=>{if((null==e?void 0:e.synthetic)&&"details"===t.view){const e=t.fields.slice();"Track"!==e[0]&&"AlbumTrack"!==e[0]||(e[0]="Index");const r=e.indexOf("Duration");-1!==r&&e.splice(r+1,0,"Album","Year"),i({view:"details",fields:h(e)})}else i(t)}),[e,t]),r}var lE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function cE(e){var t,{source:r}=e,i=lE(e,["source"]);const[a,s]=(0,n.useState)(null),o=oE(a,r.secondaryLayout),l=(0,n.useCallback)((([e])=>{s(e||null)}),[]),c=n.createElement(rE,Object.assign({},i,{title:r.title,onSelect:l})),u=n.createElement(aE,{title:a?`${a.title}: Tracks`:"",className:"album-tracks "+((null==a?void 0:a.multiDisc)?"multi-disc":""),pager:null==a?void 0:a.pager,layout:o,key:null==a?void 0:a.src});return n.createElement("div",{className:"panel"},"none"===(null===(t=r.secondaryLayout)||void 0===t?void 0:t.view)?c:n.createElement(Ot,{id:"album-browser-layout",arrange:"rows",primaryIndex:0},c,u))}var uE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const dE={view:"card compact",fields:["Thumbnail","Title","Genre"]};function mE(e){var{className:t="",layout:r=dE}=e,i=uE(e,["className","layout"]);return n.createElement(Xw,Object.assign({},i,{className:`artists ${t}`,layout:r}))}var hE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const fE={view:"card compact",fields:["Thumbnail","Title","Year"]};function pE(e){var t,r,{source:i}=e,a=hE(e,["source"]);const[s,o]=(0,n.useState)(null),[l,c]=(0,n.useState)(null),u=oE(l,i.tertiaryLayout),d=(0,n.useCallback)((([e])=>{o(e||null)}),[]),m=(0,n.useCallback)((([e])=>{c(e||null)}),[]),h=n.createElement(mE,Object.assign({},a,{title:i.title,onSelect:d})),f=n.createElement(rE,{title:s?`${s.title}: Albums`:"",className:"artist-albums",pager:null==s?void 0:s.pager,layout:i.secondaryLayout||fE,onSelect:m,key:null==s?void 0:s.src}),p=n.createElement(aE,{title:l?`${l.title}: Tracks`:"",className:"album-tracks "+((null==l?void 0:l.multiDisc)?"multi-disc":""),pager:null==l?void 0:l.pager,layout:u,key:null==l?void 0:l.src});return n.createElement("div",{className:"panel"},"none"===(null===(t=i.secondaryLayout)||void 0===t?void 0:t.view)?h:"none"===(null===(r=i.tertiaryLayout)||void 0===r?void 0:r.view)?n.createElement(Ot,{id:"artist-album-browser-layout",arrange:"rows",primaryIndex:0},h,f):n.createElement(Ot,{id:"artist-browser-layout",arrange:"columns",primaryIndex:1},h,n.createElement(Ot,{id:"artist-album-browser-layout",arrange:"rows",primaryIndex:0},f,p)))}var bE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function vE(e){var{source:t}=e,r=bE(e,["source"]);return n.createElement("div",{className:"panel"},n.createElement(aE,Object.assign({},r,{title:t.title})),";")}var yE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const gE={view:"card compact",fields:["Thumbnail","Title","TrackCount","Owner"]};function wE(e){var{className:t="",layout:r=gE}=e,i=yE(e,["className","layout"]);return n.createElement(Xw,Object.assign({},i,{className:`playlists ${t}`,layout:r}))}var EE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const kE={view:"card",fields:["Thumbnail","IconTitle","TrackCount","Owner"]},xE={view:"card compact",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]};function SE(e){var{source:t}=e,r=EE(e,["source"]);const[i,a]=(0,n.useState)(null);(0,n.useEffect)((()=>()=>gi.unlock()),[t]),(0,n.useEffect)((()=>{i&&gi.lock(i)}),[i]);const s=(0,n.useCallback)((([e])=>{a(e||null)}),[]);return n.createElement("div",{className:"panel pinned-playlist"},n.createElement(wE,Object.assign({},r,{title:t.title,layout:t.layout||kE,onSelect:s,statusBar:!1,disabled:!0})),n.createElement(aE,{title:`${t.title}: Tracks`,className:"playlist-items",pager:null==i?void 0:i.pager,layout:t.secondaryLayout||xE}))}var TE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const AE={view:"details",fields:["Index","Artist","Title","Album","Duration","Genre"]};function IE(e){var t,{source:r}=e,i=TE(e,["source"]);const[a,s]=(0,n.useState)(null),o=(0,n.useCallback)((([e])=>{s(e||null)}),[]),l=n.createElement(wE,Object.assign({},i,{title:r.title,onSelect:o})),c=n.createElement(aE,{title:a?`${a.title}: Tracks`:"",className:"playlist-items",pager:null==a?void 0:a.pager,layout:r.secondaryLayout||AE,key:null==a?void 0:a.src});return n.createElement("div",{className:"panel"},"none"===(null===(t=r.secondaryLayout)||void 0===t?void 0:t.view)?l:n.createElement(Ot,{id:"playlist-browser-layout",arrange:"rows",primaryIndex:0},l,c))}function PE(e){var t;return(null===(t=window.MusicKit)||void 0===t?void 0:t.version.startsWith("3"))?n.createElement(vE,Object.assign({},e,{service:$i})):n.createElement(CE,null)}function CE(){return n.createElement(jf,null,n.createElement("div",{className:"note"},n.createElement("p",null,n.createElement("strong",null,"Apple MusicKit beta required.")),n.createElement("p",null,"You need to enable ",n.createElement("strong",null,"MusicKit beta")," from the Settings screen to watch videos from ",$i.name,".")))}function ME(e){return"apple"===e.service.id?n.createElement(PE,Object.assign({},e)):n.createElement(vE,Object.assign({},e))}function OE(e){switch(e.source.itemType){case Ln.Artist:return n.createElement(pE,Object.assign({},e));case Ln.Album:return n.createElement(cE,Object.assign({},e));case Ln.Playlist:return e.source.isPin?n.createElement(SE,Object.assign({},e)):n.createElement(IE,Object.assign({},e));default:return e.source.mediaType===Fn.Video?n.createElement(ME,Object.assign({},e)):n.createElement(vE,Object.assign({},e))}}function NE(e,t){const[r,i]=(0,n.useState)(null);return(0,n.useEffect)((()=>{const r=(null==e?void 0:e.search(t))||null;return i(r),()=>null==r?void 0:r.disconnect()}),[e,t]),r}var $E=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const zE={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","ListenDate"]};function jE(e){var{service:t,source:r,minDate:i="2010-01-01"}=e,a=$E(e,["service","source","minDate"]);const[s,o]=(0,n.useState)(0),l=function(e,t=0){return NE(e,(0,n.useMemo)((()=>({startAt:t})),[t]))}(r,s),c=(0,n.useCallback)((e=>{const t=new Date,r=new Date(e);r.getFullYear()===t.getFullYear()&&r.getMonth()===t.getMonth()&&r.getDate()===t.getDate()?o(0):o(Math.floor(r.valueOf()/1e3))}),[]);return n.createElement(n.Fragment,null,n.createElement(Df,{icon:t.icon},t.name,":",n.createElement(Vf,{min:i,onSelect:c})),n.createElement(OE,Object.assign({},a,{service:t,source:r,pager:l,layout:r.layout||zE})))}const LE="2002-11-20",DE=new O("lastfm/useHistoryStart");function FE(){const e=function(){const[e,t]=(0,n.useState)((()=>$s.firstScrobbledAt)),r=""===e||e===LE;return(0,n.useEffect)((()=>{if(r){t(LE);const e=jr(Hs.getUserInfo()).pipe(yr((e=>Number(e.user.playcount))),wr((e=>{return e?Wr(e):(r=te(t=()=>Error("No history."))?t:function(){return t},new Ie((function(e){return e.error(r())})));var t,r})),yr((e=>Math.floor(e/50))),yr((e=>new Ks({page:e},{pageSize:50}))),wr((e=>_n(e))),yr((e=>e.at(-1))),De(l),yr((e=>new Date(1e3*e.playedAt))),yr(p),Le((e=>$s.firstScrobbledAt=e)),Le(t)).subscribe(DE);return()=>e.unsubscribe()}}),[r]),e}();return n.createElement(jE,{service:to,source:Qs,minDate:e})}class RE extends ui{fetchAt(){}next(e){this.disconnected||this.connected||(this.connect(),this.size=e.length,this.items=e)}}var _E=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const UE={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]};function VE(e){var{service:t,source:r,total:i}=e,a=_E(e,["service","source","total"]);const[,s]=(0,n.useReducer)((e=>e++),0);return(0,n.useEffect)((()=>{const e=jr(ar(6e4)).subscribe(s);return()=>e.unsubscribe()}),[]),n.createElement(n.Fragment,null,n.createElement(Df,{icon:t.icon},void 0===i?t.name:n.createElement(n.Fragment,null,t.name,": ",i.toLocaleString()," ",Om(t)?"scrobbles":"plays")),n.createElement(OE,Object.assign({},a,{service:t,source:r,layout:r.layout||UE})))}var BE=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const HE=new O("LastFmRecentlyPlayedBrowser");function YE(){const{pager:e,total:t}=function(){const e=(0,n.useMemo)((()=>Math.floor(Date.now()/1e3)),[]),[t,r]=(0,n.useState)(null),[i,a]=(0,n.useState)(void 0);return(0,n.useEffect)((()=>{const t=new RE,n=new Ks({to:e}),i=new fi(t,n),s=Rr(ph().pipe(Md(1),Nd(2e4)),ar(3e5)),o=new ae;return o.add(n.observeItems().pipe(pn((e=>0===e.length)),Rn(1),yr((e=>e[0].playedAt)),_r((e=>s.pipe(wr((()=>function(e){return BE(this,void 0,void 0,(function*(){const t=new Ks({from:e});return yield _n(t)}))}(e+1))),Le((e=>t.next(e))))))).subscribe(HE)),o.add(i.observeSize().pipe(Le(a)).subscribe(HE)),t.next([]),r(i),()=>o.unsubscribe()}),[e]),{pager:t,total:i}}();return n.createElement(VE,{service:to,source:Xs,pager:e,total:t})}var qE=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const KE=[{value:"overall",text:"All time"},{value:"12month",text:"Year"},{value:"1month",text:"Month"},{value:"7day",text:"Week"}];function WE(e){var{source:t}=e,r=qE(e,["source"]);const i=(0,n.useId)(),[a,s]=(0,n.useState)(),o=function(e,t="overall"){return NE(e,(0,n.useMemo)((()=>({period:t})),[t]))}(t,a),l=(0,n.useCallback)((e=>{s(e.target.value)}),[]);return n.createElement(n.Fragment,null,n.createElement(Df,{icon:to.icon},to.name,": ",t.title),n.createElement("div",{className:"lastfm-period-selector options"},n.createElement("ul",{className:"lastfm-periods"},KE.map((({value:e,text:t})=>n.createElement("li",{className:"lastfm-period",key:e},n.createElement("input",{id:`${i}-period-${e}`,type:"radio",name:"lastfm-period",value:e,defaultChecked:"overall"===e,onChange:l}),n.createElement("label",{htmlFor:`${i}-period-${e}`},t)))))),n.createElement(OE,Object.assign({},r,{service:to,source:t,pager:o,layout:t.layout})))}const GE="2015-09-17";function JE(){const e=function(){const[e,t]=(0,n.useState)(ao.firstScrobbledAt),r=""===e||e===GE;return(0,n.useEffect)((()=>{if(r){t(GE);const e=jr(co.getListeningActivity()).pipe(yr((e=>e.find((e=>e.listen_count>0)))),De(l),yr((e=>p(1e3*Number(e.from_ts)))),Le((e=>ao.firstScrobbledAt=e)),Rn(1)).subscribe(t);return()=>e.unsubscribe()}}),[r]),e}();return n.createElement(jE,{service:bl,source:ul,minDate:e})}var QE=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const XE=new O("ListenBrainzRecentlyPlayedBrowser");function ZE(){const{pager:e,total:t}=function(){const e=(0,n.useMemo)((()=>Math.floor(Date.now()/1e3)),[]),[t,r]=(0,n.useState)(null),[i,a]=(0,n.useState)(void 0);return(0,n.useEffect)((()=>{const t=new RE,n=new rl({max_ts:e},!0),i=new fi(t,n),s=Rr(ph().pipe(Md(1),Nd(2e4)),ar(3e5)),o=new ae;return o.add(n.observeItems().pipe(pn((e=>0===e.length)),Rn(1),yr((e=>e[0].playedAt)),_r((e=>s.pipe(wr((()=>function(e){return QE(this,void 0,void 0,(function*(){const t=new rl({min_ts:e});return yield _n(t)}))}(e+1))),Le((e=>t.next(e))))))).subscribe(XE)),o.add(i.observeSize().pipe(Le(a)).subscribe(XE)),t.next([]),r(i),()=>o.unsubscribe()}),[e]),{pager:t,total:i}}();return n.createElement(VE,{service:bl,source:dl,pager:e,total:t})}const ek=[{value:"all_time",text:"All time"},{value:"year",text:"Year"},{value:"month",text:"Month"},{value:"week",text:"Week"}];function tk({source:e}){const t=(0,n.useId)(),[r,i]=(0,n.useState)(),a=function(e,t="all_time"){return NE(e,(0,n.useMemo)((()=>({range:t})),[t]))}(e,r),s=(0,n.useCallback)((e=>{i(e.target.value)}),[]);return n.createElement(n.Fragment,null,n.createElement(Df,{icon:bl.icon},bl.name,": ",e.title),n.createElement("div",{className:"listenbrainz-range-selector options"},n.createElement("ul",{className:"listenbrainz-ranges"},ek.map((({value:e,text:r})=>n.createElement("li",{className:"listenbrainz-range",key:e},n.createElement("input",{id:`${t}-range-${e}`,type:"radio",name:"listenbrainz-range",value:e,defaultChecked:"all_time"===e,onChange:s}),n.createElement("label",{htmlFor:`${t}-range-${e}`},r)))))),n.createElement(OE,{service:bl,source:e,pager:a,layout:e.layout}))}function rk({icon:e,placeholder:t="Search",onSubmit:r}){const i=(0,n.useRef)(null),a=(0,n.useCallback)((e=>{const t=i.current.value;e.preventDefault(),null==r||r(t)}),[r]);return n.createElement("form",{className:"search-bar",onSubmit:a},n.createElement("p",{className:"text-with-button"},e?n.createElement(Nt,{name:e}):null,n.createElement("input",{type:"search",placeholder:t,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",ref:i}),n.createElement("button",{type:"submit",title:"Search"},n.createElement(Nt,{name:"search"}))))}function nk({sources:e,onSourceChange:t}){const r=(0,n.useId)(),i=(0,n.useCallback)((r=>{const n=Number(r.target.value),i=e[n];null==t||t(i)}),[e,t]);return n.createElement("div",{className:"media-source-selector options"},n.createElement("ul",{className:"media-sources"},e.map(((e,t)=>n.createElement("li",{className:"media-source",key:e.id},n.createElement("input",{id:`${r}-${e.id}`,type:"radio",name:r,value:t,defaultChecked:0===t,onChange:i}),n.createElement("label",{htmlFor:`${r}-${e.id}`},e.title))))))}function ik({service:e,sources:t}){const[r,i]=(0,n.useState)((()=>t[0])),[a,s]=(0,n.useState)(""),o=function(e,t=""){return NE(e,(0,n.useMemo)((()=>({q:t})),[t]))}(r,a),l=!!r.searchable,c=!l&&!r.isPin;return n.createElement(n.Fragment,null,c?n.createElement(Df,{icon:e.icon},e.name,": ",r.title):null,l?n.createElement(rk,{icon:e.icon,placeholder:`Search ${e.name}`,onSubmit:s}):null,t.length>1?n.createElement(nk,{sources:t,onSourceChange:i}):null,n.createElement(OE,{service:e,source:r,pager:o,layout:r.layout,loadingText:a?"Searching":void 0}))}function ak({service:e,viewType:t,itemType:r,onSelect:i}){const a=(0,n.useId)(),[s,o]=(0,n.useState)([]),[l,c]=(0,n.useState)(),u=t===Ri.ByDecade?"Decade":"Genre";(0,n.useEffect)((()=>{l&&i&&i(l)}),[l,i]),(0,n.useEffect)((()=>{const n=jr(e.getFilters(t,r)).subscribe(o);return()=>n.unsubscribe()}),[e,t,r]),(0,n.useEffect)((()=>{l||c(s[0])}),[s,l]);const d=(0,n.useCallback)((e=>{c(s[Number(e.target.value)])}),[s]);return n.createElement("div",{className:"filter-selector"},n.createElement("label",{htmlFor:a},u,":"),n.createElement("select",{id:a,onChange:d},s.map(((e,t)=>n.createElement("option",{key:e.id,value:t},e.title)))))}function sk({service:e,source:t}){const[r,i]=(0,n.useState)(),a=NE(t,r);return n.createElement(n.Fragment,null,n.createElement(Df,{icon:e.icon},e.name,": ",t.title),n.createElement(ak,{service:e,viewType:t.viewType,itemType:t.itemType,onSelect:i}),n.createElement(OE,{service:e,source:t,pager:a,layout:t.layout}))}var ok=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};const lk={view:"card minimal",fields:["FileIcon","FileName"]};function ck(e){var{className:t="",layout:r=lk,multiple:i=!0,draggable:a=!0,onSelect:s}=e,o=ok(e,["className","layout","multiple","draggable","onSelect"]);const[l,c]=(0,n.useState)([]),u=(0,n.useMemo)((()=>i&&l.every((e=>e.itemType===Ln.Media))),[i,l]),d=(0,n.useMemo)((()=>a&&l.every((e=>e.itemType===Ln.Media))),[a,l]),m=(0,n.useCallback)((e=>{c(e),null==s||s(e)}),[s]);return n.createElement(Xw,Object.assign({},o,{className:`folder-items ${t}`,layout:r,multiple:u,draggable:d,onSelect:m}))}var uk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function dk({service:e,source:t}){const[r,i]=(0,n.useState)(null),[a,s]=(0,n.useState)("/");(0,n.useEffect)((()=>{const e=t.search();return i(e),s("/"),()=>e.disconnect()}),[t]);const o=(0,n.useCallback)((e=>uk(this,void 0,void 0,(function*(){e.itemType===Ln.Folder&&(i(e.pager),s(e.path||"/"))}))),[]),l=(0,n.useCallback)((e=>uk(this,void 0,void 0,(function*(){if(1===e.length){const t=e[0];(null==t?void 0:t.itemType)===Ln.Folder&&(i(t.pager),s(t.path||"/"))}}))),[]);return n.createElement(n.Fragment,null,n.createElement(Df,{icon:e.icon},e.name,": ",a),n.createElement("div",{className:"panel"},n.createElement(ck,{title:`Path: ${a}`,pager:r,onEnter:l,onDoubleClick:o})))}function mk({service:e,sources:t}){const r=1===t.length?t[0]:null;switch((0,n.useEffect)((()=>{(null==r?void 0:r.lockActionsStore)?Nn.lock(e.id,r.itemType):Nn.unlock()}),[e,r]),(0,n.useEffect)((()=>()=>Nn.unlock()),[e]),null==r?void 0:r.id){case"lastfm/top/tracks":case"lastfm/top/albums":case"lastfm/top/artists":return n.createElement(WE,{source:r});case"listenbrainz/top/tracks":case"listenbrainz/top/albums":case"listenbrainz/top/artists":return n.createElement(tk,{source:r});case"lastfm/history":return n.createElement(FE,null);case"listenbrainz/history":return n.createElement(JE,null);case"lastfm/recently-played":return n.createElement(YE,null);case"listenbrainz/recently-played":return n.createElement(ZE,null);default:switch(null==r?void 0:r.viewType){case Ri.ByDecade:case Ri.ByGenre:return n.createElement(sk,{service:e,source:r});case Ri.Folders:return n.createElement(dk,{service:e,source:r});default:return n.createElement(ik,{service:e,sources:t})}}}function hk({service:e,sources:t}){const r=zf(e.observeIsLoggedIn,!1),i=function(e,t){return(0,n.useMemo)((()=>function({error:r}){return r instanceof _i?n.createElement(n.Fragment,null,n.createElement(Df,{icon:e.icon},1===t.length?`${e.name}: ${t[0].title}`:e.name),n.createElement(jf,null,n.createElement("div",{className:"note"},n.createElement("p",null,(null==r?void 0:r.message)||String(r))))):n.createElement(Lf,{error:r},e&&n.createElement("p",{className:"buttons"},n.createElement("button",{className:"disconnect",onClick:e.logout},"Reconnect to ",e.name,"...")))}),[e,t])}(e,t),a=`${e.id}/${e.libraryId||"*"}/${t.map((e=>e.id))}`;return n.createElement("div",{className:`media-browser ${e.id}-browser`,key:a},r?n.createElement(Dm.SV,{fallbackRender:i},n.createElement(mk,{service:e,sources:t})):n.createElement(Nf,{service:e}))}function fk(e){return e.sources.filter(hn).map((t=>({id:t.id,label:n.createElement(Yi,{icon:t.icon,text:t.title}),value:n.createElement(hk,{service:e,sources:[t]})}))).concat(function(e){return gi.getPinsForService(e.id).map((t=>{var r;return null===(r=e.createSourceFromPin)||void 0===r?void 0:r.call(e,t)})).filter(l).map((t=>({id:t.id,label:n.createElement(Yi,{icon:t.icon,text:t.title}),value:n.createElement(hk,{service:e,sources:[t]})})))}(e))}const pk=new D("sources");function bk({onSelect:e}){const t=(0,n.useRef)(null),r=function(){const[e,t]=(0,n.useState)();return(0,n.useEffect)((()=>{const e=Rr(dn.pipe(De((e=>e!==un)),yr((()=>{}))),Rr(...xm().filter((e=>!!e.observeLibraryId)).map((e=>e.observeLibraryId()))).pipe(yr((()=>{}))),gi.observe()),r=gi.observe().pipe(Rn(1),_r((()=>e)),yr((()=>Em().filter(hn).map((e=>function(e){return{id:e.id,label:n.createElement($m,{service:e,showConnectivity:!0}),value:n.createElement(hk,{service:e,sources:e.roots}),startExpanded:!0,children:fk(e)}}(e)))))).subscribe(t);return()=>r.unsubscribe()}),[]),e}();return(0,n.useEffect)((()=>{t.current.focus()}),[]),(0,n.useEffect)((()=>{0===(null==r?void 0:r.length)&&Dt(Lm,!0)}),[r]),n.createElement("div",{className:"panel media-sources"},n.createElement(sn,{roots:r||[],onSelect:e,storageId:pk.id,treeViewRef:t}))}var vk=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function yk(e){var{id:t,item:r,index:i,selected:a}=e,s=vk(e,["id","item","index","selected"]);const o=(0,n.useCallback)((e=>{e.target.focus()}),[]);return n.createElement("button",Object.assign({},s,{className:"tab",type:"button",id:`${t}-tab-${i}`,tabIndex:a?0:-1,role:"tab","aria-selected":a,"aria-controls":`${t}-panel-${i}`,onMouseDown:o}),r.tab)}function gk({id:e,item:t,index:r,hidden:i}){return n.createElement("div",{className:"tab-panel",id:`${e}-panel-${r}`,hidden:i,role:"tabpanel","aria-labelledby":`${e}-tab-${r}`},t.panel)}function wk({label:e,items:t,className:r=""}){const i=(0,n.useId)(),a=(0,n.useRef)(null),[s,o]=(0,n.useState)([]),[l,c]=(0,n.useState)(0);(0,n.useEffect)((()=>{o(Array.from(a.current.querySelectorAll("button")))}),[]);const u=(0,n.useCallback)((e=>{let t=l;"ArrowRight"===e.code?(e.stopPropagation(),t++):"ArrowLeft"===e.code&&(e.stopPropagation(),t--),t=Math.min(Math.max(t,0),s.length-1);const r=s[t];r&&!r.disabled&&r.focus()}),[l,s]),d=(0,n.useCallback)((e=>{const t=e.target;if(t.id){const e=Number(t.id.split("-").pop());c(e)}}),[]);return n.createElement("div",{className:`tab-list ${r}`},n.createElement("ul",{className:"tab-list-tabs",role:"tablist","aria-label":e,onFocus:d,onKeyDown:u,ref:a},t.map(((e,t)=>n.createElement("li",{role:"presentation",key:t},n.createElement(yk,{id:i,item:e,index:t,selected:t===l}))))),n.createElement("div",{className:"tab-list-panels"},t.map(((e,t)=>n.createElement(gk,{id:i,item:e,index:t,hidden:t!==l,key:t})))))}function Ek(){return zf((0,n.useMemo)((()=>()=>Rr(Tt.observe(),xt.observeUserThemes()).pipe(yr((()=>Object.assign({},Tt.current))))),[]),Tt.current)}function kk(){return zf((0,n.useMemo)((()=>()=>xt.observeUserThemes()),[]),[])}var xk=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Sk(e){var{colorName:t,onChange:r}=e,i=xk(e,["colorName","onChange"]);const a=(0,n.useCallback)((e=>{const n=e.target.value;Tt[t]=n,null==r||r(n)}),[t,r]);return n.createElement("input",Object.assign({},i,{type:"color",onChange:a}))}function Tk({label:e,backgroundColorName:t,textColorName:r,defaultBackgroundColor:i,defaultTextColor:a,suggestedColors:s,nextSuggestion:o,trackingColor:l="frame"}){const c=Ek(),u=i&&a,d=c[t],m=c[r],[h,f]=(0,n.useState)((()=>d||i||"")),[p,b]=(0,n.useState)((()=>m||a||"")),v=!d&&!m,y=(0,n.useCallback)((()=>{if(s&&o){const[e,n]=s;Tt[t]=e,Tt[r]=n,o()}}),[t,r,s,o]),g=(0,n.useCallback)((()=>{v?(Tt[t]=h,Tt[r]=p):(Tt[t]="",Tt[r]="")}),[v,t,r,h,p]),w=(0,n.useCallback)((()=>{const e=Tt[t],n=Tt[r];Tt[t]=n,Tt[r]=e}),[t,r]);return n.createElement("p",{className:"color-pair "+(v?"locked":"")},n.createElement("label",null,e,":"),n.createElement(Sk,{colorName:t,value:d||i,title:`${e} background color`,disabled:v,onChange:f}),n.createElement(hg,{icon:"swap",title:"Swap",onClick:w,disabled:v}),n.createElement(Sk,{colorName:r,value:m||a,title:`${e} text color`,disabled:v,onChange:b}),u?n.createElement(hg,{icon:v?"locked":"unlocked",title:v?"Allow editing":`Lock to ${l} color`,onClick:g}):null,s&&o?n.createElement("button",{className:"small",type:"button",onClick:y},"Suggest"):null)}function Ak(e,t){var r=new tt(e),n=new tt(t);return(Math.max(r.getLuminance(),n.getLuminance())+.05)/(Math.min(r.getLuminance(),n.getLuminance())+.05)}function Ik(e,t,r){void 0===r&&(r={includeFallbackColors:!1,level:"AA",size:"small"});for(var n=null,i=0,a=r.includeFallbackColors,s=r.level,o=r.size,l=0,c=t;l<c.length;l++){var u=c[l],d=Ak(e,u);d>i&&(i=d,n=new tt(u))}return function(e,t,r){var n,i;void 0===r&&(r={level:"AA",size:"small"});var a=Ak(e,t);switch((null!==(n=r.level)&&void 0!==n?n:"AA")+(null!==(i=r.size)&&void 0!==i?i:"small")){case"AAsmall":case"AAAlarge":return a>=4.5;case"AAlarge":return a>=3;case"AAAsmall":return a>=7;default:return!1}}(e,n,{level:s,size:o})||!a?n:(r.includeFallbackColors=!1,Ik(e,["#fff","#000"],r))}var Pk=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Ck(e){var{renderItem:t=String,className:r=""}=e,i=Pk(e,["renderItem","className"]);const a=(0,n.useMemo)((()=>({view:"details",cols:[{render:t}]})),[t]);return n.createElement($w,Object.assign({},i,{className:`list-box ${r}`,layout:a}))}var Mk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Ok(e){return Mk(this,void 0,void 0,(function*(){return!xt.getUserTheme(e)||Yt({title:"My themes",message:`Overwrite existing theme '${e}'?`,okLabel:"Save",storageId:"overwrite-user-theme",system:!0})}))}var Nk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function $k(e){var{suggestedName:t}=e,r=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["suggestedName"]);const i=(0,n.useId)(),a=(0,n.useMemo)((()=>e=>e.name),[]),[s,o]=(0,n.useState)(t),l=(0,n.useRef)(null),c=(0,n.useRef)(null),u=kk(),d=(0,n.useCallback)((e=>{o(e.target.value)}),[]),m=(0,n.useCallback)((([e])=>{e&&(c.current.value=e.name,o(e.name))}),[]),h=(0,n.useCallback)((()=>Nk(this,void 0,void 0,(function*(){s&&(yield Ok(s))&&l.current.close(s)}))),[s]),f=(0,n.useCallback)((e=>Nk(this,void 0,void 0,(function*(){e.preventDefault(),h()}))),[h]);return n.createElement(jt,Object.assign({},r,{className:"save-theme-dialog",title:"Save Theme",onSubmit:f,ref:l}),n.createElement("form",{method:"dialog"},n.createElement("p",{className:"prompt-message"},n.createElement("label",{htmlFor:i},"Name: "),n.createElement("input",{type:"text",id:i,defaultValue:t,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",onChange:d,ref:c})),n.createElement(Ck,{title:"My themes",items:u,itemKey:"name",renderItem:a,onDoubleClick:h,onSelect:m}),n.createElement(Ut,{value:s,submitText:"Save"})))}var zk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const jk=[{tab:"General",panel:n.createElement((function(){const e=(0,n.useId)(),t=Ek(),r=(0,n.useRef)(null),i=(0,n.useRef)(null),a=(0,n.useRef)(null),s=(0,n.useMemo)((()=>Tt.fontSize),[]),o=(0,n.useMemo)((()=>xt.getDefaultThemes()),[]),l=kk(),c=!!t.userTheme;(0,n.useEffect)((()=>{const e=document.getElementById("system").style;return e.setProperty("--font-size",String(Tt.fontSize)),()=>{Tt.restore(),e.removeProperty("--font-size")}}),[]);const u=(0,n.useCallback)((()=>Tt.save()),[]),d=(0,n.useCallback)((()=>{const e=a.current.checked?xt.getUserTheme(i.current.value):xt.getDefaultTheme(r.current.value);e&&Tt.apply(e)}),[]),m=(0,n.useCallback)((e=>{Tt.fontSize=e.target.valueAsNumber}),[]);return n.createElement("form",{className:"appearance-settings-general",method:"dialog",onSubmit:u},n.createElement("fieldset",null,n.createElement("legend",null,"Theme"),n.createElement("div",{className:"table-layout"},n.createElement("p",null,n.createElement("input",{type:"radio",name:"theme-source",id:`${e}-default-themes`,value:"",checked:!c,onChange:d}),n.createElement("label",{htmlFor:`${e}-default-themes`},"Default themes:"),n.createElement("select",{value:c?void 0:t.name,disabled:c,onChange:d,ref:r},o.map((({name:e})=>n.createElement("option",{value:e,key:e},e))))),n.createElement("p",null,n.createElement("input",{type:"radio",name:"theme-source",id:`${e}-user-themes`,value:"user",checked:c,disabled:0===l.length,onChange:d,ref:a}),n.createElement("label",{htmlFor:`${e}-user-themes`},"My themes:"),n.createElement("select",{value:c?t.name:void 0,onChange:d,disabled:!c,ref:i},l.map((({name:e})=>n.createElement("option",{value:e,key:e},e))))))),n.createElement("fieldset",null,n.createElement("legend",null,"Preferences"),n.createElement("div",{className:"table-layout"},n.createElement("p",{className:"font-size"},n.createElement("label",{htmlFor:"theme-fontSize"},"Font Size:"),n.createElement("input",{type:"range",id:"theme-fontSize",min:12,max:28,step:.4,defaultValue:s,onChange:m})))),n.createElement(Ut,null))}),null)},{tab:"Theme Editor",panel:n.createElement((function(){const e=(0,n.useId)(),t=Ek(),r=`${t.name}${Tt.edited?" (edited)":""}`,i=`${!!t.userTheme}/${t.name}`,[a,s]=function(e){const[t,r]=(0,n.useState)([]),[i,a]=(0,n.useState)(-1);(0,n.useEffect)((()=>{const t=new tt(e),n=h([...t.triad(),...t.tetrad(),...t.splitcomplement(),...t.analogous(),...t.monochromatic(),t.lighten(),t.darken(),t.saturate(),t.desaturate(),t.greyscale(),t.brighten()].map((e=>e.toHexString()))).map((e=>new tt(e))),i=n.reverse().map((e=>[e.toHexString(),Ik(e,["black","white"],{includeFallbackColors:!0,level:"AA",size:"large"}).toHexString()]));r(f(i)),a(-1===i.length?-1:0)}),[e]);const s=(0,n.useCallback)((()=>{a((e=>e===t.length-1?-1===t.length?-1:0:e+1))}),[t]);return[t[i],s]}(t.frameColor);(0,n.useEffect)((()=>{const e=document.getElementById("system").style;return e.setProperty("--font-size",String(Tt.fontSize)),()=>{Tt.restore(),e.removeProperty("--font-size")}}),[]);const o=(0,n.useCallback)((()=>{Tt.save()}),[]),l=(0,n.useCallback)((()=>{!function(e){var t,r,i,a;t=this,r=void 0,a=function*(){const t=yield Dt((t=>n.createElement($k,Object.assign({},t,{suggestedName:e}))),!0);t&&(Tt.name=t,Tt.userTheme=!0,yield xt.save(Tt.current))},new((i=void 0)||(i=Promise))((function(e,n){function s(e){try{l(a.next(e))}catch(e){n(e)}}function o(e){try{l(a.throw(e))}catch(e){n(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(t,r||[])).next())}))}(t.name)}),[t]),c=(0,n.useCallback)((e=>{Tt.spacing=e.target.valueAsNumber}),[]),u=(0,n.useCallback)((e=>{Tt.roundness=e.target.valueAsNumber}),[]),d=(0,n.useCallback)((e=>{Tt.flat=e.target.checked}),[]);return n.createElement("form",{className:"theme-editor",method:"dialog",onSubmit:o},n.createElement("div",{className:"table-layout"},n.createElement("p",{className:"theme-name"},n.createElement("label",{htmlFor:`${e}-theme-name`},"Name:"),n.createElement("input",{type:"text",id:`${e}-theme-name`,value:r,spellCheck:!1,readOnly:!0,tabIndex:-1}),n.createElement("button",{className:"small",type:"button",onClick:l},"Save as…")),n.createElement(Tk,{label:"Frame",backgroundColorName:"frameColor",textColorName:"frameTextColor",key:`${i}/frame`}),n.createElement(Tk,{label:"Content",backgroundColorName:"backgroundColor",textColorName:"textColor",key:`${i}/content`}),n.createElement(Tk,{label:"Selection",backgroundColorName:"selectedBackgroundColor",textColorName:"selectedTextColor",suggestedColors:a,nextSuggestion:s,key:`${i}/selection`}),n.createElement(Tk,{label:"Media button",backgroundColorName:"mediaButtonColor",textColorName:"mediaButtonTextColor",defaultBackgroundColor:Tt.defaultMediaButtonColor,defaultTextColor:Tt.defaultMediaButtonTextColor,key:`${i}/media-button`}),n.createElement(Tk,{label:"Button",backgroundColorName:"buttonColor",textColorName:"buttonTextColor",defaultBackgroundColor:Tt.defaultButtonColor,defaultTextColor:Tt.defaultButtonTextColor,key:`${i}/button`}),n.createElement(Tk,{label:"Scrollbar",backgroundColorName:"scrollbarColor",textColorName:"scrollbarTextColor",defaultBackgroundColor:Tt.defaultScrollbarColor,defaultTextColor:Tt.defaultScrollbarTextColor,trackingColor:"button",key:`${i}/scrollbar`}),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-theme-spacing`},"Spacing:"),n.createElement("input",{type:"range",id:`${e}-theme-spacing`,min:0,max:1,step:.01,value:t.spacing,onChange:c})),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-theme-roundness`},"Roundness:"),n.createElement("input",{type:"range",id:`${e}-theme-roundness`,min:0,max:1,step:.01,value:t.roundness,onChange:u})),n.createElement("p",null,n.createElement("label",{htmlFor:`${e}-theme-flat`},"Flat:"),n.createElement("input",{type:"checkbox",id:`${e}-theme-flat`,checked:t.flat,onChange:d}))),n.createElement(Ut,null))}),null)},{tab:"My Themes",panel:n.createElement((function(){const e=(0,n.useRef)(null),t=(0,n.useMemo)((()=>e=>e.name),[]),r=(0,n.useRef)(null),i=kk(),[a,s]=(0,n.useState)(""),[o,l]=(0,n.useState)([]),[c]=o;(0,n.useEffect)((()=>{if(a){const t=i.findIndex((e=>e.name===a));-1!==t&&(e.current.selectAt(t),s(""))}}),[i,a]);const u=(0,n.useCallback)((()=>zk(this,void 0,void 0,(function*(){if(c){const e=c.name,t=yield Wt({title:"My themes",suggestedValue:e,okLabel:"Rename",system:!0});t&&(yield Ok(t))&&(yield xt.rename(e,t),s(t))}}))),[c]),d=(0,n.useCallback)((()=>zk(this,void 0,void 0,(function*(){if(c){const e=c.name,t=xt.getUserTheme(e);if(t){const{userTheme:r}=t,n=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(t,["userTheme"]);!function(e,t,r="text/json"){const n=document.createElement("a");n.href=window.URL.createObjectURL(new Blob([t],{type:r})),n.download=e,n.type=r,n.click()}(`${e}.json`,JSON.stringify(n,void 0,4))}}}))),[c]),m=(0,n.useCallback)((()=>zk(this,void 0,void 0,(function*(){if(c){const e=c.name,t=yield function(e){return t=this,r=void 0,i=function*(){return Yt({title:"My themes",message:`Delete theme '${e}'?`,okLabel:"Delete",storageId:"delete-user-theme",system:!0})},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(e);t&&(yield xt.remove(e),l([]))}}))),[c]),h=(0,n.useCallback)((()=>{r.current.click()}),[]),f=(0,n.useCallback)((e=>zk(this,void 0,void 0,(function*(){var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&(yield function(e){return t=this,r=void 0,i=function*(){const t="Import theme",r=!0;try{const n=yield e.text(),i=JSON.parse(n);if(!Tt.validate(i))return void(yield Rt({title:t,message:"Not a valid theme.",system:r}));let a=i.name,s=!1;for(;a&&!s;)a=yield Wt({title:t,suggestedValue:a,okLabel:"Import",system:r}),a&&(s=yield Ok(a),s&&(yield xt.save(Object.assign(Object.assign({},i),{name:a}))))}catch(e){console.error(e),yield Rt({title:t,message:"Could not load theme.",system:r})}},new((n=void 0)||(n=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,r||[])).next())}));var t,r,n,i}(r),e.target.value="")}))),[]);return n.createElement("form",{className:"user-themes",method:"dialog"},n.createElement("h3",null,"My themes:"),n.createElement(Ck,{title:"My themes",items:i,itemKey:"name",renderItem:t,onDelete:m,onSelect:l,listViewRef:e}),n.createElement("p",{className:"user-themes-buttons"},n.createElement("button",{type:"button",onClick:u,disabled:!c},"Rename…"),n.createElement("button",{type:"button",onClick:d,disabled:!c},"Export…"),n.createElement("button",{className:"user-themes-delete",type:"button",onClick:m,disabled:!c},"Delete")),n.createElement("fieldset",{className:"user-themes-import"},n.createElement("legend",null,"Import themes"),n.createElement("p",null,n.createElement("input",{type:"file",accept:"text/json,.json",onChange:f,ref:r}),n.createElement("button",{type:"button",onClick:h},"Import…"))),n.createElement(Ut,null))}),null)}];function Lk({lookupRef:e,onSubmit:t}){const r=(0,n.useId)(),i=Ah.preferredService;return n.createElement("form",{className:"lookup-settings",method:"dialog",onSubmit:t},n.createElement("label",{htmlFor:`${r}-lookup-services`},"Preferred Service:"),n.createElement("select",{id:`${r}-lookup-services`,defaultValue:i,ref:e},n.createElement("option",{value:""},"(none)"),km().map((e=>n.createElement("option",{value:e.id,key:e.id},e.name)))),n.createElement("div",{className:"note"},n.createElement("p",null,"To enable playback from last.fm and ListenBrainz, Ampcast will search your logged in services to find a match."),n.createElement("p",null,"Exact matches are preferred. If you have several exact matches then the match from the preferred lookup service is used.")),n.createElement(Ut,null))}var Dk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Fk(){const e=(0,n.useId)(),t=(0,n.useRef)(null),r=(0,n.useCallback)((()=>Dk(this,void 0,void 0,(function*(){Gn.useMusicKitBeta=t.current.checked,(yield Yt({title:"Reload required",message:n.createElement(n.Fragment,null,n.createElement("p",null,"You need to reload for changes to take effect."),n.createElement("p",null,"Reload now?")),okLabel:"Reload",system:!0}))&&(yield $i.logout(),location.reload())}))),[]);return n.createElement("form",{className:"apple-beta-settings",method:"dialog",onSubmit:r},n.createElement("fieldset",null,n.createElement("legend",null,"MusicKit*"),n.createElement("p",null,n.createElement("input",{type:"radio",name:"use-musickit",id:`${e}-musickit-stable`,defaultChecked:!Gn.useMusicKitBeta}),n.createElement("label",{htmlFor:`${e}-musickit-stable`},"Stable version")),n.createElement("p",null,n.createElement("input",{type:"radio",name:"use-musickit",id:`${e}-musickit-beta`,defaultChecked:Gn.useMusicKitBeta,ref:t}),n.createElement("label",{htmlFor:`${e}-musickit-beta`},"Beta version"))),n.createElement("div",{className:"note"},n.createElement("p",null,"MusicKit beta enables playback of music videos."),n.createElement("p",null,"However, this release of MusicKit is still undergoing changes and may be unstable. If you experience any problems then use the stable release."),n.createElement("p",null,"You will need to reload the page for changes to take effect. And you will need to log in again.")),n.createElement("p",null,n.createElement("small",null,"*MusicKit is a JavaScript library supplied by Apple that provides access to Apple Music services and media playback.")),n.createElement(Ut,null))}function Rk(){const e=(0,n.useId)(),t=(0,n.useRef)(null),r=yc.streamingQuality,i=(0,n.useCallback)((()=>{var e,r;yc.streamingQuality=null!==(r=null===(e=t.current["streaming-quality"])||void 0===e?void 0:e.value)&&void 0!==r?r:pc.Lossless}),[]);return n.createElement("form",{className:"plex-tidal-streaming-settings",method:"dialog",onSubmit:i,ref:t},n.createElement("fieldset",null,n.createElement("legend",null,"Quality"),n.createElement("p",null,n.createElement("input",{type:"radio",name:"streaming-quality",id:`${e}-lossless`,value:pc.Lossless,defaultChecked:r===pc.Lossless}),n.createElement("label",{htmlFor:`${e}-lossless`},"Lossless")),n.createElement("p",null,n.createElement("input",{type:"radio",name:"streaming-quality",id:`${e}-high`,value:pc.High,defaultChecked:r===pc.High}),n.createElement("label",{htmlFor:`${e}-high`},"High")),n.createElement("p",null,n.createElement("input",{type:"radio",name:"streaming-quality",id:`${e}-low`,value:pc.Low,defaultChecked:r===pc.Low}),n.createElement("label",{htmlFor:`${e}-low`},"Low"))),n.createElement(Ut,null))}function _k({service:e}){const t=(0,n.useId)(),r=(0,n.useRef)(null),i=Sm(e),a=zf(i.observeIsLoggedIn,!1),s=(0,n.useCallback)((()=>{const e=r.current.elements,t={};for(const r of e)t[r.value]=!r.checked;fn(t)}),[]);return n.createElement("form",{className:"media-service-settings-general",method:"dialog",onSubmit:s},n.createElement("p",null,n.createElement("button",{type:"button",className:"disconnect",onClick:i.logout,disabled:!a},a?`Disconnect from ${i.name}...`:"Not connected")),n.createElement("fieldset",{ref:r},n.createElement("legend",null,"Display"),n.createElement("ul",{className:"checkbox-list"},e.sources.map((e=>n.createElement("li",{key:e.id},n.createElement("input",{id:`${t}-${e.id}`,type:"checkbox",value:e.id,defaultChecked:hn(e)}),n.createElement("label",{htmlFor:`${t}-${e.id}`},e.title)))))),n.createElement(Ut,null))}function Uk({service:e}){const t=(0,n.useId)(),r=(0,n.useRef)(null),i=e.libraryId,a=function(e){const t=zf(e.observeIsLoggedIn,!1),[r,i]=(0,n.useState)((()=>e.audioLibraries||[]));return(0,n.useEffect)((()=>{if(t&&e.getLibraries){const t=jr(e.getLibraries()).subscribe((t=>{e.libraries=t,i(e.audioLibraries||[])}));return()=>t.unsubscribe()}}),[e,t]),r}(e),s=(0,n.useCallback)((()=>{e.libraryId=r.current.value}),[e]);return n.createElement("form",{className:"personal-media-library-settings",method:"dialog",onSubmit:s},n.createElement("label",{htmlFor:`${t}-libraries`},"Preferred Library:"),n.createElement("select",{id:`${t}-libraries`,defaultValue:i,ref:r},a.map((({id:e,title:t})=>n.createElement("option",{value:e,key:e},t)))),n.createElement(Ut,null))}var Vk=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function Bk({service:e}){const t=(0,n.useMemo)((()=>e=>e.title),[]),[r,i]=(0,n.useState)((()=>gi.getPinsForService(e.id))),[a,s]=(0,n.useState)([]),o=(0,n.useCallback)((()=>Vk(this,void 0,void 0,(function*(){const t=gi.getPinsForService(e.id);yield gi.unpin(t.filter((e=>-1===r.findIndex((t=>t.src===e.src)))))}))),[e,r]),l=(0,n.useCallback)((()=>{const e=a.map((e=>e.src));i((t=>t.filter((t=>!e.includes(t.src))))),s([])}),[a]);return n.createElement("form",{className:"pinned-settings",method:"dialog",onSubmit:o},n.createElement("h3",null,"Pinned playlists:"),n.createElement(Ck,{title:"Pinned playlists",items:r,itemKey:"src",multiple:!0,renderItem:t,onDelete:l,onSelect:s}),n.createElement("p",{className:"pinned-settings-buttons"},n.createElement("button",{type:"button",disabled:0===a.length,onClick:l},"Remove")),n.createElement(Ut,null))}function Hk({service:e}){const t=(0,n.useId)(),r=(0,n.useRef)(null),i=(0,n.useRef)(null),a=(0,n.useMemo)((()=>Em().filter((e=>!Om(e)))),[]),s=(0,n.useCallback)((()=>{const t=r.current.elements,n={};for(const e of t)n[e.value]=!e.checked;yy(e,n);const a=i.current.elements,s={};for(const e of a)s[e.value]=e.checked;wy(e,s)}),[e]);return n.createElement("form",{className:"scrobbling-settings",method:"dialog",onSubmit:s},n.createElement("fieldset",{ref:r},n.createElement("legend",null,"Scrobble"),n.createElement("ul",null,a.map((r=>n.createElement("li",{key:r.id},n.createElement("input",{id:`${t}-${r.id}`,type:"checkbox",value:r.id,defaultChecked:vy(e,r),disabled:"youtube"===r.id}),n.createElement("label",{htmlFor:`${t}-${r.id}`},r.name)))))),n.createElement("fieldset",{ref:i},n.createElement("legend",null,"Options"),n.createElement("ul",null,n.createElement("li",null,n.createElement("input",{id:`${t}-scrobbling-options`,type:"checkbox",value:"updateNowPlaying",defaultChecked:gy(e)}),n.createElement("label",{htmlFor:`${t}-scrobbling-options`},'Update "Now Playing"')))),n.createElement(Ut,null))}function Yk({service:e}){const t=(0,n.useMemo)((()=>{const t=[{tab:"General",panel:n.createElement(_k,{service:e})}];return"libraryId"in e&&t.push({tab:"Library",panel:n.createElement(Uk,{service:e})}),e.serviceType===vn.Scrobbler&&t.push({tab:"Scrobbling",panel:n.createElement(Hk,{service:e})}),e.createSourceFromPin&&t.push({tab:"Pinned",panel:n.createElement(Bk,{service:e})}),"apple"===e.id&&t.push({tab:"Beta",panel:n.createElement(Fk,null)}),"plex-tidal"===e.id&&t.push({tab:"Streaming",panel:n.createElement(Rk,null)}),t}),[e]);return n.createElement(wk,{className:`media-service-settings ${e.id}-settings`,items:t,label:e.name})}const qk=[{tab:"General",panel:n.createElement((function(){const e=(0,n.useId)(),t=(0,n.useMemo)((()=>Hh.get()),[]),r=zf(Hh.observe,t),i=(0,n.useRef)(null),a=(0,n.useRef)(null),s=(0,n.useRef)(null),o=(0,n.useRef)(null),l=(0,n.useCallback)((()=>{Hh.set(t)}),[t]),c=(0,n.useCallback)((()=>{Hh.set({allowDuplicates:i.current.checked,showLineNumbers:a.current.checked,zeroPadLineNumbers:s.current.checked,showSourceIcons:o.current.checked})}),[]);return n.createElement("form",{className:"playlist-settings-general",method:"dialog"},n.createElement("fieldset",null,n.createElement("legend",null,"Content"),n.createElement("p",null,n.createElement("input",{id:`${e}-allow-duplicates`,type:"checkbox",checked:r.allowDuplicates,onChange:c,ref:i}),n.createElement("label",{htmlFor:`${e}-allow-duplicates`},"Allow duplicates"))),n.createElement("fieldset",null,n.createElement("legend",null,"Display"),n.createElement("p",null,n.createElement("input",{id:`${e}-item-numbers`,type:"checkbox",checked:r.showLineNumbers,onChange:c,ref:a}),n.createElement("label",{htmlFor:`${e}-item-numbers`},"Show line numbers")),n.createElement("p",null,n.createElement("input",{id:`${e}-zero-pad`,type:"checkbox",checked:r.zeroPadLineNumbers,disabled:!r.showLineNumbers,onChange:c,ref:s}),n.createElement("label",{htmlFor:`${e}-zero-pad`},"Zero pad line numbers")),n.createElement("p",null,n.createElement("input",{id:`${e}-source-icons`,type:"checkbox",checked:r.showSourceIcons,onChange:c,ref:o}),n.createElement("label",{htmlFor:`${e}-source-icons`},"Show media source icons"))),n.createElement(Ut,{onCancel:l}))}),null)}];function Kk({providerRef:e,ambientVideoEnabled:t,onSubmit:r}){const i=(0,n.useId)(),a=ep.provider;return n.createElement("form",{className:"visualizer-settings-general",method:"dialog"},n.createElement("p",null,n.createElement("label",{htmlFor:`${i}-visualizer-provider`},"Provider:"),n.createElement("select",{id:`${i}-visualizer-provider`,defaultValue:a,ref:e},n.createElement("option",{value:"none"},"(none)"),n.createElement("option",{value:""},"(random)"),Kv().filter((e=>"ambientvideo"!==e.id||t)).map((e=>n.createElement("option",{value:e.id,key:e.id},e.name))))),n.createElement(Ut,{onSubmit:r}))}function Wk({ambientVideoEnabledRef:e,ambientVideoSourceRef:t,useAmbientVideoSourceRef:r,beatsOverlayEnabledRef:i,onAmbientVideoEnabledChange:a,onSubmit:s}){const o=(0,n.useId)(),[l,c]=(0,n.useState)((()=>!!ep.useAmbientVideoSource)),u=(0,n.useCallback)((()=>{t.current.validity.valid||r.current.checked||(t.current.value=""),c(r.current.checked)}),[t,r]),d=(0,n.useCallback)((()=>{const e=t.current.value;let r="Not a valid YouTube url.";/^https?/.test(e)&&/youtu\.?be/.test(e)&&(r="Not a YouTube video or playlist.",Go(e)&&(r="")),t.current.setCustomValidity(r)}),[t]),m=(0,n.useCallback)((()=>{a(e.current.checked)}),[e,a]);return n.createElement("form",{className:"ambient-video-settings",method:"dialog"},n.createElement("p",null,n.createElement("input",{id:`${o}-ambient-video-enabled`,type:"checkbox",defaultChecked:ep.ambientVideoEnabled,onChange:m,ref:e}),n.createElement("label",{htmlFor:`${o}-ambient-video-enabled`},"Enable ambient video")),n.createElement("fieldset",null,n.createElement("legend",null,"Source"),n.createElement("p",null,n.createElement("input",{type:"radio",name:"video-source",id:`${o}-source-default`,defaultChecked:!ep.useAmbientVideoSource,onChange:u}),n.createElement("label",{htmlFor:`${o}-source-default`},"Default videos")),n.createElement("p",null,n.createElement("input",{type:"radio",name:"video-source",id:`${o}-source-youtube`,defaultChecked:ep.useAmbientVideoSource,onChange:u,ref:r}),n.createElement("label",{htmlFor:`${o}-source-youtube`},"YouTube video or playlist:")),n.createElement("p",null,n.createElement("input",{type:"url",defaultValue:ep.ambientVideoSource,disabled:!l,required:l,onInput:d,"aria-labelledby":`${o}-source-youtube-label`,ref:t}))),n.createElement("p",null,n.createElement("input",{id:`${o}-beats-overlay`,type:"checkbox",defaultChecked:ep.beatsOverlay,ref:i}),n.createElement("label",{htmlFor:`${o}-beats-overlay`},'Show "beats" overlay')),n.createElement(Ut,{onSubmit:s}))}function Gk(){const e=(0,n.useRef)(null),t=(0,n.useRef)(null),r=(0,n.useRef)(null),i=(0,n.useRef)(null),a=(0,n.useRef)(null),[s,o]=(0,n.useState)(ep.ambientVideoEnabled),l=(0,n.useCallback)((()=>{ep.provider=e.current.value,ep.ambientVideoEnabled=t.current.checked,ep.useAmbientVideoSource=i.current.checked,ep.ambientVideoSource=r.current.value,ep.beatsOverlay=a.current.checked}),[]),c=(0,n.useMemo)((()=>[{tab:"General",panel:n.createElement(Kk,{providerRef:e,ambientVideoEnabled:s,onSubmit:l})},{tab:"Ambient Video",panel:n.createElement(Wk,{ambientVideoEnabledRef:t,ambientVideoSourceRef:r,useAmbientVideoSourceRef:i,beatsOverlayEnabledRef:a,onAmbientVideoEnabledChange:o,onSubmit:l})}]),[s,l]);return n.createElement(wk,{className:"visualizer-settings",items:c,label:"Visualizers"})}function Jk(e){return n.createElement(jt,Object.assign({},e,{className:"settings-dialog visualizer-settings-dialog",title:"Visualizer Settings"}),n.createElement(Gk,null))}const Qk=[{id:"services",label:n.createElement(Yi,{text:"Media Services",icon:"globe"}),value:n.createElement((function(){const e=(0,n.useRef)(null),t=(0,n.useRef)(null),r=(0,n.useCallback)((()=>{const r=e.current.elements,n={};for(const e of r)"checkbox"===e.type&&(n[e.value]=!e.checked);fn(n),Ah.preferredService=t.current.value}),[]),i=(0,n.useMemo)((()=>[{tab:"General",panel:n.createElement(zm,{onSubmit:r,servicesRef:e})},{tab:"Lookup",panel:n.createElement(Lk,{onSubmit:r,lookupRef:t})}]),[r]);return n.createElement(wk,{className:"media-library-settings",items:i,label:"Media Services"})}),null),startExpanded:!0,children:Em().map((e=>({id:e.id,label:n.createElement($m,{service:e}),value:n.createElement(Yk,{service:e,key:e.id})})))},{id:"visualizer",label:n.createElement(Yi,{text:"Visualizer",icon:"visualizer"}),value:n.createElement(Gk,null)},{id:"playlist",label:n.createElement(Yi,{text:"Playlist",icon:"playlist"}),value:n.createElement((function(){return n.createElement(wk,{className:"playlist-settings",items:qk,label:"Playlist Settings"})}),null)},{id:"appearance",label:n.createElement(Yi,{text:"Appearance",icon:"palette"}),value:n.createElement((function(){return n.createElement(wk,{className:"appearance-settings",items:jk,label:"Appearance"})}),null)}],Xk=()=>Qk,Zk=new D("settings-sources");function ex(e){const t=Xk(),[r,i]=(0,n.useState)(null);return n.createElement(jt,Object.assign({},e,{className:"settings-dialog",title:"Settings"}),n.createElement(sn,{className:"settings-dialog-sources",roots:t,storageId:Zk.id,onSelect:i}),n.createElement("div",{className:"settings-dialog-source"},r))}const tx=(0,n.memo)((function(){const[e,t]=(0,n.useState)(null),r=(0,n.useCallback)((()=>{Dt(ex,!0)}),[]);return n.createElement("div",{className:"media-library"},n.createElement("header",{className:"media-library-head"},n.createElement("h1",{className:"media-library-title"},n.createElement("span",{className:"app-name"},n.createElement(Nt,{className:"app-icon",name:"ampcast"}),n.createElement("span",{className:"app-text"},"ampcast"))," ",n.createElement("span",{className:"app-version"},"0.8.23")),n.createElement(hg,{icon:"settings",className:"in-frame",title:"Settings",onClick:r})),n.createElement("div",{className:"media-library-body"},n.createElement(Ot,{id:"media-library-layout",arrange:"columns",primaryIndex:1},n.createElement(bk,{onSelect:t}),e||n.createElement(jf,null))))})),rx=new O("visualizer"),nx={providerId:"none",name:""},ix=new Ne(nx),ax=new Me,sx=[...Array(75).fill("butterchurn"),...Array(10).fill("ampshader"),...Array(4).fill("audiomotion"),...Array(1).fill("waveform")],ox=[...Array(70).fill("ampshader"),...Array(10).fill("spotifyviz")],lx=Array(10).fill("ambientvideo"),cx=Array(20).fill("ambientvideo");function ux(){return ix}function dx(){return hx().pipe(yr((e=>Wv(e))),_r((e=>e?e.observeVisualizers():Wr([]))))}function mx(){return tp().pipe(yr((e=>!!e.lockedVisualizer)),Sn())}function hx(){return tp().pipe(yr((e=>e.provider||"")),Sn())}function fx(e){ax.next(e)}function px(){ep.lockedVisualizer=ix.getValue()}function bx(){ep.lockedVisualizer=null}function vx(e,t=1){var r;null===(r=Wv(e))||void 0===r||r.observeVisualizers().pipe(pn((e=>0===e.length)),Cd(ux()),Le((([,e])=>{e===nx&&fx("sync")})),Rn(t)).subscribe(rx)}function yx(){return zf(ux,null)}function gx(e){const[t,r]=(0,n.useState)(null);return(0,n.useEffect)((()=>{null==t&&null!=e&&r(e)}),[t,e]),t}function wx({visualizer:e}){return n.createElement("article",{className:"visualizer-info"},n.createElement(Ex,{visualizer:e}),n.createElement(kx,{visualizer:e}))}function Ex({visualizer:e}){return n.createElement("h3",null,"Visualizer: ",function(e){if(e){const t=Wv(e.providerId);if(t)return t.name}return"none"}(e))}function kx({visualizer:e}){var t;const r="ambientvideo"===(null==e?void 0:e.providerId)&&e.src.startsWith("youtube:"),i=e?e.externalUrl||(null===(t=Wv(e.providerId))||void 0===t?void 0:t.externalUrl):void 0;return r?n.createElement(xx,{visualizer:e}):(null==e?void 0:e.name)?n.createElement(n.Fragment,null,n.createElement("h4",null,"Name: ",e.name),i?n.createElement("p",{className:"external-view"},n.createElement("span",null,"Url:")," ",n.createElement(mo,{href:i})):null):null}function xx({visualizer:e}){const t=function(e){const[t,,r]=e.split(":"),[i,a]=(0,n.useState)(null);return(0,n.useEffect)((()=>{if(a(null),"youtube"===t&&r){const e=jr(Qo(r)).subscribe(a);return()=>e.unsubscribe()}}),[t,r]),i}(e.src);return t?n.createElement("div",{className:"youtube-video-info"},n.createElement("h4",null,"Title: ",t.title),n.createElement(nw,{owner:t.owner,src:t.src}),n.createElement("p",{className:"external-view"},"View on YouTube: ",n.createElement(Nt,{name:"youtube"})," ",n.createElement(mo,{href:t.externalUrl}))):null}function Sx(e){const t=(0,n.useRef)(null),{debug:r}=mw(t),i=Dw(),a=yx(),s=gx(i),o=gx(a);return n.createElement(jt,Object.assign({},e,{className:"currently-playing-dialog media-info-dialog",title:"Media Info",ref:t}),n.createElement("form",{method:"dialog"},s?n.createElement(Wg,{item:s,debug:r}):n.createElement("p",null,"The playlist is empty."),s&&s.mediaType!==Fn.Video?n.createElement(wx,{visualizer:o}):null,n.createElement("footer",{className:"dialog-buttons"},n.createElement("button",null,"Close"))))}function Tx(){const e=(0,n.useRef)(null),t=(0,n.useRef)(null);return(0,n.useEffect)((()=>{let e;const r=()=>{const n=t.current,i=n.getContext("2d"),a=i.createImageData(n.width,n.height),s=new Uint32Array(a.data.buffer);for(let e=0;e<s.length;e++)s[e]=(255*Math.random()|0)<<24;i.putImageData(a,0,0),e=requestAnimationFrame((()=>r()))};return e=requestAnimationFrame((()=>r())),()=>cancelAnimationFrame(e)}),[]),At(e,(()=>{const r=t.current,n=e.current.getBoundingClientRect();r.width=n.width,r.height=n.height})),n.createElement("div",{className:"static",ref:e},n.createElement("canvas",{ref:t}))}nf().pipe(Gm(200)).subscribe((()=>fx("item"))),Xv.observeError().subscribe((()=>fx("error"))),dx().subscribe((()=>fx("provider"))),ax.pipe(Kr((e=>"click"===e?ir(50):Wr(void 0)))).pipe(Cd(nf(),tp()),yr((([e,t,r])=>function(e,t,r){if(!e||e.mediaType===Fn.Video||e.duration<30)return nx;const n="error"===r,i=e.src.startsWith("spotify:"),a=t.lockedVisualizer;let s=(null==a?void 0:a.providerId)||t.provider;switch(s){case"spotifyviz":if(!i)return nx;break;case"audiomotion":case"butterchurn":if(i)return nx;break;case"none":return nx}if(a)return n?nx:function(e,t){return Gv(e).find((e=>e.name===t))}(a.providerId,a.name)||nx;const o=ix.getValue();if(s=t.provider,!s){let e=i?ox:sx;t.ambientVideoEnabled&&(e=e.concat(i?cx:lx)),s=E(e),"click"===r&&s===o.providerId&&1===Gv(s).length&&(s=E(e,s))}const l=Gv(s);return n&&t.provider&&1===l.length?nx:E(l,o)||nx}(t,r,e)))).subscribe(ix),ux().pipe(Le((e=>Xv.load(e)))).subscribe(rx),vx("ampshader"),vx("butterchurn",2);const Ax=(0,n.memo)((function(){const e=zf(dx,[]),t=zf(mx,!1),r=zf(hx,void 0),i="none"!==r,a=!t&&(!r||e.length>1),s=function(){const e=Dw(),t=yx(),[r,i]=(0,n.useState)("");return(0,n.useEffect)((()=>{(null==e?void 0:e.src.startsWith("youtube:"))?i("youtube"):(null==e?void 0:e.src.startsWith("apple:"))&&(null==e?void 0:e.mediaType)===Fn.Video?i("apple"):"ambientvideo"===(null==t?void 0:t.providerId)&&(null==t?void 0:t.src.startsWith("youtube:"))?i("youtube"):i("")}),[e,t]),r}(),[o,l]=(0,n.useState)(0),c=(0,n.useCallback)((()=>{Dt(Sx)}),[]),u=(0,n.useCallback)((()=>{Dt(Jk,!0)}),[]),d=(0,n.useCallback)((()=>{l(o+1),0===o&&setTimeout((()=>fx("click")))}),[o]);return(0,n.useEffect)((()=>{if(o){const e=ir(500).subscribe((()=>l(0)));return()=>e.unsubscribe()}}),[o]),n.createElement("div",{className:"visualizer-controls"},i&&o?n.createElement(Tx,null):null,n.createElement(pg,{className:"visualizer-controls-settings"},n.createElement(hg,{className:"with-overlay",icon:"info",title:"Info",tabIndex:-1,onClick:c}),n.createElement(hg,{className:"with-overlay",icon:"settings",title:"Settings",tabIndex:-1,onClick:u})),i?n.createElement(pg,{className:"visualizer-controls-selector"},n.createElement(hg,{className:"with-overlay",icon:t?"locked":"unlocked",title:t?"Unlock":"Lock the current visualizer",tabIndex:-1,onClick:t?bx:px}),a?n.createElement(hg,{className:"with-overlay",icon:"right",title:"Next visualizer",tabIndex:-1,onClick:d}):null):null,s?n.createElement(Nt,{className:"source-icon",name:s}):null)}));function Ix(){return zf(Wy,!0)}const Px=(0,n.memo)((function(){var e;const t=Dw(),r=Ix(),i=function(){const[e,t]=(0,n.useState)("searching"),r=Dw(),i=null==r?void 0:r.id;return(0,n.useEffect)((()=>t("searching")),[i]),(0,n.useEffect)((()=>{switch(null==r?void 0:r.lookupStatus){case nh.Looking:t("searching");break;case nh.NotFound:t("error");break;default:if(r){if(Im(r)){t("loading");const e=new ae;return e.add(Qy().pipe(Rn(1)).subscribe((()=>t("playing")))),e.add(Ky().pipe(Rn(1)).subscribe((()=>t("error")))),()=>e.unsubscribe()}t("searching")}else t("playing")}}),[r]),e}(),[a,s]=(0,n.useState)(!1),[o,l]=(0,n.useState)(!1),c=null==t?void 0:t.id;return(0,n.useEffect)((()=>{l(!0);const e=setTimeout((()=>l(!1)),5e3);return()=>clearTimeout(e)}),[c]),(0,n.useEffect)((()=>{if("error"===i)s(!0),l(!1);else if(s(!1),"playing"===i){const e=setTimeout((()=>s(!0)),4500);return()=>clearTimeout(e)}}),[i]),n.createElement("div",{className:`interstitial ${i} ${a?"ready":""} ${o?"is-recent":""}`},n.createElement("div",{className:"currently-playing"},t?n.createElement(n.Fragment,null,n.createElement("h2",null,t.title),(null===(e=t.artists)||void 0===e?void 0:e.length)?n.createElement(n.Fragment,null,n.createElement("span",{className:"by"},"by"),n.createElement("h3",null,t.artists.join(", "))):null):n.createElement("p",null,"The playlist is empty.")),n.createElement("p",{className:"interstitial-state"},r?"":"error"===i?i:`${i}...`))}));r(6234);const Cx=(0,n.memo)((function(){const e=(0,n.useRef)(null),[t,r]=(0,n.useState)(!1),i=Dw(),a=(null==i?void 0:i.mediaType)===Fn.Video,s=function(e,t=200){const[r,i]=(0,n.useState)(!1);return(0,n.useEffect)((()=>{if(e){const r=Ar(e,"mousemove").pipe(Le((()=>i(!0))),Gm(t),Le((()=>i(!1)))).subscribe();return()=>r.unsubscribe()}i(!1)}),[e,t]),r}(e.current,4e3),o=yx(),l=!o||"none"===o.providerId;(0,n.useEffect)((()=>{dg.appendTo(e.current)}),[]),(0,n.useEffect)((()=>{const t=Ar(document,"fullscreenchange").pipe(yr((()=>document.fullscreenElement===e.current))).subscribe(r);return()=>t.unsubscribe()}),[]),At(e,(()=>{const t=e.current;dg.resize(t.clientWidth,t.clientHeight)}));const c=(0,n.useCallback)((()=>{t?document.exitFullscreen():e.current.requestFullscreen()}),[t]);return n.createElement("div",{className:`panel media ${a?"is-playing-video":""} ${l?"no-visualizer":""}  ${s?"":"idle"}`,onDoubleClick:c,ref:e},n.createElement("div",{id:"playback"}),n.createElement(Px,null),n.createElement(Ax,null))}));var Mx=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Ox(e){var{icon:t,className:r=""}=e,i=Mx(e,["icon","className"]);const a=(0,n.useRef)(null),s=(0,n.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),a.current.classList.toggle("active",!0)}),[]);return n.createElement("button",Object.assign({},i,{className:`media-button media-button-${t} ${r}`,type:"button",onMouseDown:s,ref:a}),n.createElement(Nt,{name:t}))}const Nx=(0,n.memo)((function(){const[e,t]=(0,n.useState)((()=>dg.muted)),[r,i]=(0,n.useState)((()=>dg.volume)),a=r<=.33?"low":r<=.67?"medium":"high";(0,n.useEffect)((()=>{dg.muted=e}),[e]),(0,n.useEffect)((()=>{dg.volume=r}),[r]);const s=(0,n.useCallback)((e=>{const r=e.target.valueAsNumber;i(r),t(0===r)}),[]),o=(0,n.useCallback)((()=>{i((t=>e?t||.1:t)),t(!e)}),[e]);return n.createElement("div",{className:`volume-control volume-${a}`},n.createElement(hg,{icon:e?"muted":"volume",className:"in-frame","aria-label":e?"Unmute":"Mute",title:e?"unmute":"mute",onClick:o}),n.createElement("input",{type:"range","aria-label":"Volume",min:0,max:1,step:.01,value:e?0:r,onChange:s}))}));function $x(e){const t=zf(af,sf()),r=Ix();return n.createElement(bg,Object.assign({},e),n.createElement(wg,{label:"Stop after current",value:"stop-after-current",checked:dg.stopAfterCurrent,disabled:r,key:"stop-after-current"}),n.createElement(yg,{label:"Jump to current",value:"jump-to-current",disabled:-1===t,key:"jump-to-current"}),n.createElement(Eg,null),n.createElement(yg,{label:"Shuffle",value:"shuffle",key:"shuffle"}),n.createElement(Eg,null),n.createElement(yg,{label:"Clear",value:"clear",key:"clear"}))}var zx=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};function jx({listViewRef:e}){const t=zf(af,-1),r=zf(Hy,0),i=zf(Yy,0),a=Ix(),s=(0,n.useCallback)((e=>{tg(e.target.valueAsNumber)}),[]),o=(0,n.useCallback)((r=>zx(this,void 0,void 0,(function*(){const i=e.current,s=r.target.getBoundingClientRect();switch(yield function(e,t){return r=this,i=void 0,s=function*(){return xg((e=>n.createElement($x,Object.assign({},e))),e,t)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,o)}l((s=s.apply(r,i||[])).next())}));var r,i,a,s}(s.right,s.bottom+4)){case"jump-to-current":i.scrollIntoView(t),i.focus();break;case"stop-after-current":dg.stopAfterCurrent=!dg.stopAfterCurrent;break;case"clear":ff.clear();break;case"shuffle":yield ff.shuffle(!a),i.scrollIntoView(0)}}))),[e,t,a]),l=(0,n.useCallback)((()=>zx(this,void 0,void 0,(function*(){ff.atStart||(dg.prev(),e.current.scrollIntoView(t-1))}))),[e,t]),c=(0,n.useCallback)((()=>zx(this,void 0,void 0,(function*(){ff.atEnd||(dg.next(),e.current.scrollIntoView(t+1))}))),[e,t]);return n.createElement("div",{className:"media-controls"},n.createElement("div",{className:"current-time-control"},n.createElement(Bw,{time:r}),n.createElement("input",{id:"playhead",type:"range","aria-label":"Seek",min:0,max:i,step:1,value:r,disabled:a,onChange:s})),n.createElement("div",{className:"playback-control"},n.createElement(Nx,null),n.createElement("div",{className:"media-buttons"},n.createElement(Ox,{"aria-label":"Previous track",icon:"prev",onClick:l}),n.createElement(Ox,{"aria-label":a?"Play":"Pause",icon:a?"play":"pause",onClick:a?Zy:eg}),n.createElement(Ox,{"aria-label":"Stop",icon:"stop",onClick:rg}),n.createElement(Ox,{"aria-label":"Next track",icon:"next",onClick:c})),n.createElement("div",{className:"media-buttons-more"},n.createElement(Ox,{title:"More...",icon:"menu",onClick:o}))))}var Lx=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r};function Dx(e){var{items:t,selectedItems:r,rowIndex:i}=e,a=Lx(e,["items","selectedItems","rowIndex"]);const s=t.length,o=r.length,l=0===s,c=o===s,u=1===o;return n.createElement(bg,Object.assign({},a),-1===i?null:n.createElement(n.Fragment,null,u?n.createElement(yg,{label:"Play",value:"play",acceleratorKey:"Enter",key:"play"}):null,n.createElement(yg,{label:"Remove",value:"remove",acceleratorKey:"Del",key:"remove"}),u?n.createElement(yg,{label:"Info...",value:"info",acceleratorKey:`${Y.ctrlKeyStr}+I`,key:"info"}):null),n.createElement(Eg,null),c?null:n.createElement(yg,{label:"Select all",value:"select-all",acceleratorKey:`${Y.ctrlKeyStr}+A`,key:"select-all"}),!u&&function(e,t){const r=e.findIndex((e=>e===t[0]));return t.every(((t,n)=>t===e[r+n]))}(t,r)?n.createElement(yg,{label:"Reverse selection",value:"reverse-selection",key:"reverse-selection"}):null,n.createElement(Eg,null),l?null:n.createElement(yg,{label:"Clear",value:"clear",key:"clear"}))}const Fx={view:"details",showTitles:!1,cols:[{title:"#",render:()=>null,align:"right",className:"index"},{title:"Source",render:function({src:e,lookupStatus:t}){const[r]=e.split(":");let i;switch(t){case nh.Looking:i="lookup-looking";break;case nh.NotFound:i="lookup-not-found";break;default:i=Pm(e)?r:"lookup-pending"}return n.createElement(Nt,{name:i,className:"youtube"===r?"":"show-connectivity"})},align:"center",className:"source"},{title:"Title",render:function({title:e,artists:t}){return(null==t?void 0:t.length)?n.createElement(n.Fragment,null,n.createElement("span",{className:"artist-text"},t.join("/")),n.createElement("span",{role:"separator"},"-"),n.createElement("span",{className:"title-text"},e)):n.createElement("span",{className:"title-text"},e)},className:"title"},{title:"Time",render:Yw,align:"right",className:"duration"}]};var Rx=function(e,t,r,n){return new(r||(r=Promise))((function(i,a){function s(e){try{l(n.next(e))}catch(e){a(e)}}function o(e){try{l(n.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((n=n.apply(e,t||[])).next())}))};const _x=["audio/*","video/*"];function Ux(e){var{onSelect:t,onPlay:r,onEject:i,listViewRef:a}=e,s=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}(e,["onSelect","onPlay","onEject","listViewRef"]);const o=zf(ff.observe,[]),l=function(e){const t=Dw(),r=Ix(),i=String(e).length,{zeroPadLineNumbers:a,showLineNumbers:s,showSourceIcons:o}=zf(Hh.observe,Hh.get());return(0,n.useMemo)((()=>Object.assign(Object.assign({},Fx),{cols:Fx.cols.filter((e=>{switch(e.className){case"index":return s;case"source":return o;default:return!0}})).map((e=>"index"===e.className?Object.assign(Object.assign({},e),{render:(e,s)=>{const o=function(e,t=0){return n.createElement("span",{className:"number"},String(e+1).padStart(t,"0"))}(s,a?i:0);return e.id===(null==t?void 0:t.id)?n.createElement(n.Fragment,null,n.createElement(Nt,{name:r?"pause":"play"}),o):o}}):e))})),[a,s,o,i,t,r])}(o.length),c=Dw(),[u,d]=(0,n.useState)(0),m=(0,n.useCallback)((e=>{const[t]=e.src.split(":");return`source-${t} ${e.id===(null==c?void 0:c.id)?"playing":""} ${e.unplayable||e.lookupStatus===nh.NotFound?"unplayable":""}`}),[c]),h=(0,n.useCallback)((e=>{d(e.length),null==t||t(e)}),[t]),f=(0,n.useCallback)((e=>{null==r||r(e)}),[r]),p=(0,n.useCallback)((e=>{1===e.length&&(null==r||r(e[0]))}),[r]),b=(0,n.useCallback)((e=>{1===e.length&&e[0]===c?null==i||i():ff.remove(e)}),[i,c]),v=(0,n.useCallback)((([e])=>Rx(this,void 0,void 0,(function*(){e&&(yield pw(e))}))),[]),y=(0,n.useCallback)(((e,t,i,s,l)=>Rx(this,void 0,void 0,(function*(){if(0===o.length)return;const c=yield function(e,t,r,i,a,s="left"){return o=this,l=void 0,u=function*(){return xg((i=>n.createElement(Dx,Object.assign({},i,{items:e,selectedItems:t,rowIndex:r}))),i,a,s)},new((c=void 0)||(c=Promise))((function(e,t){function r(e){try{i(u.next(e))}catch(e){t(e)}}function n(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof c?e:new c((function(t){t(e)}))}(t.value).then(r,n)}i((u=u.apply(o,l||[])).next())}));var o,l,c,u}(o,e,s,t,i,-1===l?"right":"left");switch(c){case"play":null==r||r(e[0]);break;case"remove":ff.remove(e);break;case"info":yield pw(e[0]);break;case"select-all":a.current.selectAll();break;case"reverse-selection":{const t=o.findIndex((t=>t===e[0]));ff.reverseAt(t,e.length);break}case"clear":ff.clear()}}))),[r,o,a]);return n.createElement("div",{className:"playlist"},n.createElement($w,Object.assign({},s,{title:"Playlist",className:"media-list",layout:l,items:o,itemKey:"id",itemClassName:m,selectedIndex:0===o.length?-1:0,droppable:!0,droppableTypes:_x,multiple:!0,reorderable:!0,onContextMenu:y,onDelete:b,onDoubleClick:f,onDrop:ff.insertAt,onEnter:p,onInfo:v,onMove:ff.moveSelection,onSelect:h,listViewRef:a})),n.createElement(Rw,{items:o,size:o.length,selectedCount:u}))}const Vx=(0,n.memo)((function(){const e=(0,n.useRef)(null),t=Dw(),r=Ix(),i=(0,n.useCallback)((e=>{e===t?dg.play():(dg.load(null),dg.autoplay=!0,ff.setCurrentItem(e))}),[t]);return n.createElement("div",{className:"media-playback "+(r?"paused":"")},n.createElement(Ot,{id:"media-playback-layout",arrange:"rows"},n.createElement("div",{className:"panel playback"},n.createElement(jx,{listViewRef:e}),n.createElement(Ux,{onPlay:i,onEject:ag,listViewRef:e})),n.createElement(Cx,null)))}));function Bx(e){const t=e.dataTransfer;t&&(e.preventDefault(),t.effectAllowed="none",t.dropEffect="none")}function Hx(e=null){var t,r;const n=navigator.mediaSession;n&&(e&&(n.metadata=new MediaMetadata({title:e.title,artist:null===(t=e.artists)||void 0===t?void 0:t.join(", "),album:e.artists?"":e.album,artwork:null===(r=e.thumbnails)||void 0===r?void 0:r.map((e=>({src:Bg(e),sizes:`${e.width}x${e.height}`})))})),n.setActionHandler("play",Zy),n.setActionHandler("pause",eg),n.setActionHandler("stop",rg),n.setActionHandler("previoustrack",ng),n.setActionHandler("nexttrack",ig),n.setActionHandler("seekto",(e=>{null!=e.seekTime&&tg(e.seekTime)})))}function Yx(e){switch(e.key){case" ":e.target&&!("form"in e.target)&&(e.preventDefault(),qx());break;case"MediaPlayPause":e.preventDefault(),qx();break;case"MediaStop":e.preventDefault(),dg.stop();break;case"MediaTrackPrevious":e.preventDefault(),dg.prev();break;case"MediaTrackNext":e.preventDefault(),dg.next()}}function qx(){dg.paused?dg.play():dg.pause()}const Kx=new D("desktopWarning");function Wx(){const[e,t]=(0,n.useState)((()=>Y.desktop||Kx.getBoolean("dismissed"))),r=(0,n.useCallback)((()=>{Kx.setBoolean("dismissed",!0),t(!0)}),[]);return e?null:n.createElement("div",{className:"desktop-warning"},n.createElement("h1",null,"ampcast"," ","0.8.23"),n.createElement("p",null,"This application is intended for a desktop browser."),n.createElement("p",null,n.createElement("button",{onClick:r},"Proceed")))}(0,i.s)(document.getElementById("app")).render(n.createElement(n.StrictMode,null,n.createElement((function(){return(0,n.useEffect)((()=>{document.body.classList.add(`browser-${Y.name.replace(/\s+/g,"-")}`)}),[]),(0,n.useEffect)((()=>{const e=new ae;return Em().forEach((t=>{if(!t.authServiceId){const r=t.observeIsLoggedIn().subscribe((e=>{document.body.classList.toggle(`${t.id}-connected`,e),document.body.classList.toggle(`${t.id}-not-connected`,!e)}));e.add(r)}})),()=>e.unsubscribe()}),[]),(0,n.useEffect)((()=>{let e=!1;const t=document.getElementById("app"),r=document.getElementById("system"),n=new ae,i=e=>Ar(e,"focusin").subscribe((()=>{const t=e.querySelector(".focus");t!==document.activeElement&&(null==t||t.classList.toggle("focus",!1),document.activeElement.classList.toggle("focus",!0))}));return document.activeElement.classList.toggle("focus",!0),n.add(Ar(document,"keydown",{capture:!0}).subscribe((()=>{e=!0}))),n.add(Ar(document,"mousedown",{capture:!0}).subscribe((()=>{e=!1}))),n.add(Ar(document,"focusin").subscribe((()=>{document.body.classList.toggle("focus-visible",e)}))),n.add(Ar(document,"focusout").subscribe((e=>{if(!e.relatedTarget){const e=(document.querySelector(".system .settings-dialog")?r:document).querySelectorAll(".focus");for(const t of e)t.classList.toggle("focus",!1)}}))),n.add(Ar(document,"mouseup",{capture:!0}).subscribe((()=>{const e=document.querySelectorAll(".active");for(const t of e)t.classList.toggle("active",!1)}))),n.add(Ar(r,"mousedown").subscribe(g)),n.add(i(t)),n.add(i(r)),()=>n.unsubscribe()}),[]),(0,n.useEffect)((()=>{const e=Ar(document,"dragenter"),t=Ar(document,"dragover"),r=Ar(document,"drop"),n=Rr(e,t).pipe(Le(Bx)),i=Rr(n,r.pipe(Le(y))).subscribe();return()=>i.unsubscribe()}),[]),function(){const e=Dw(),t=zf(Gy,null),r=zf(Hy,0),i=zf(Yy,0);(0,n.useEffect)((()=>{var e;null===(e=navigator.mediaSession)||void 0===e||e.setPositionState({duration:i,position:r,playbackRate:1})}),[i,r]),(0,n.useEffect)((()=>Hx(null==t?void 0:t.currentItem)),[t]),(0,n.useEffect)((()=>Hx(e)),[e])}(),(0,n.useEffect)((()=>{document.getElementById("system").addEventListener("keydown",g),document.getElementById("popup").addEventListener("keydown",g),document.body.addEventListener("keydown",Yx)}),[]),n.createElement("main",null,n.createElement(Ot,{id:"main-layout",arrange:"columns"},n.createElement(tx,null),n.createElement(Vx,null)),n.createElement(Wx,null))}),null)))}},e=>{e.O(0,[136,529,503],(()=>(4657,e(e.s=4657)))),e.O()}]);