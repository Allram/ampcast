(globalThis.webpackChunkampcast=globalThis.webpackChunkampcast||[]).push([[296],{6998:function(e){e.exports=function(e,t){if(null==t&&(t={fuzzy:!0}),/youtu\.?be/.test(e)){var n,r=[/youtu\.be\/([^#\&\?]{11})/,/\?v=([^#\&\?]{11})/,/\&v=([^#\&\?]{11})/,/embed\/([^#\&\?]{11})/,/\/v\/([^#\&\?]{11})/];for(n=0;n<r.length;++n)if(r[n].test(e))return r[n].exec(e)[1];if(t.fuzzy){var i=e.split(/[\/\&\?=#\.\s]/g);for(n=0;n<i.length;++n)if(/^[^#\&\?]{11}$/.test(i[n]))return i[n]}}return null}},745:(e,t,n)=>{"use strict";var r=n(3935);t.s=r.createRoot,r.hydrateRoot},6657:e=>{e.exports=function(e,t,n){"use strict";if(e===t)return 1;if(""===t)return 0;var r=0,i=e.toLowerCase(),o=e.length,a=t.toLowerCase(),s=t.length,l=0,c=1;n=n?1-n:0;for(var u=0;u<s;u+=1){var d=i.indexOf(a[u],l);if(-1===d){if(!n)return 0;c+=n}else{var m=0;l===d?m=.7:(m=.1," "===e[d-1]&&(m+=.8)),e[d]===t[u]&&(m+=.1),r+=m,l=d+1}}var f=.5*(r/o+r/s)/c;return a[0]===i[0]&&f<.85&&(f+=.15),f}},6200:(e,t,n)=>{"use strict";var r=n(7294),i=n(745),o=n(6657),a=n.n(o);class s{constructor(e="",t=!1,n=window.console){const r=e?` ${e}:`:"",i=(e,t)=>e&&t?`${e}/${t}`:t||e,o=(...t)=>{e.startsWith(s.only)&&n.log(...t)};this.log=(...e)=>o(`##${r}`,...e),this.warn=(...e)=>o(`###${r}`,...e),this.error=t=>{e.startsWith(s.only)&&(o(`####${r} ERROR`),n.error(t))},t&&(this.next=this.log,this.complete=()=>this.log("***complete***")),this.id=r=>new s(i(e,r),t,n),this.rx=t=>new s(i(e,t),!0,n),this.only=()=>this}}s.only="";const l=new Map,c={get length(){return l.size},clear(){l.clear()},key(e){var t;return null!==(t=[...l.keys()][e])&&void 0!==t?t:null},getItem(e){var t;return null!==(t=l.get(e))&&void 0!==t?t:null},setItem(e,t){l.set(e,String(t))},removeItem(e){l.delete(e)}},u=c,d=new s("LiteStorage");class m{constructor(e,t="local"){const n=`${t}-${e}`;if(m.ids.includes(n))throw Error(`Duplicate storageId: ${n}`);switch(m.ids.push(n),this.id=`ampcast/${e}`,t){case"local":this.storage=localStorage;break;case"session":this.storage=sessionStorage;break;case"memory":this.storage=u}}getBoolean(e){const t=this.getItem(e);return!!t&&"false"!==t}setBoolean(e,t){this.setItem(e,String(!!t))}getJson(e,t=null){const n=this.getItem(e);try{return n?JSON.parse(n):t}catch(e){d.error(e)}return null!=t?t:null}setJson(e,t){try{null==t?this.removeItem(e):this.setItem(e,JSON.stringify(t))}catch(e){d.error(e)}}getNumber(e,t=0){var n;const r=Number(null!==(n=this.getItem(e))&&void 0!==n?n:t);return isNaN(r)?t:r}setNumber(e,t){this.setItem(e,String(Number(t)||0))}getString(e,t=""){var n;return String(null!==(n=this.getItem(e))&&void 0!==n?n:t)}setString(e,t){this.setItem(e,t)}getItem(e){return this.storage.getItem(`${this.id}/${e}`)}setItem(e,t){e=`${this.id}/${e}`,null==t?this.storage.removeItem(e):this.storage.setItem(e,t)}removeItem(e){this.storage.removeItem(`${this.id}/${e}`)}clear(){const e=`${this.id}/`,t=[];for(let n=0;n<this.storage.length;n++){const r=this.storage.key(n);r.startsWith(e)&&t.push(r)}t.forEach((e=>this.storage.removeItem(e)))}}m.ids=[];const f=(0,n(3631).qY)(),h=(null==f?void 0:f.name)||"unknown",p=/^edge/.test(h)?"Microsoft Edge":h.replace(/^\w/,(e=>e.toUpperCase())),v=(null==f?void 0:f.version)||"0",g=(null==f?void 0:f.os)||"unknown",b="Mac OS"===g?"metaKey":"ctrlKey",y="Mac OS"===g?"âŒ˜":"Ctrl",w={name:h,displayName:p,version:v,os:g,desktop:!/^(iOS|Android OS|BlackBerry OS|Windows Mobile|Amazon OS)$/.test(g),ctrlKey:b,ctrlKeyStr:y};function x(e){return null!=e}function k(e){return t=this,n=void 0,i=function*(){return new Promise(((t,n)=>{const r="ampcast-loaded";let i=document.querySelector(`script[src="${e}"]`);(null==i?void 0:i.hasAttribute(r))?t():(i||(i=document.createElement("script"),i.async=!0,i.src=e),i.addEventListener("load",(function(){this.setAttribute(r,""),t()})),i.addEventListener("error",(()=>n(`Failed to load script: '${e}'`))),i.parentElement||document.head.appendChild(i))}))},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(a,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}function E(e,t){const n=[],r=[];for(const i of e)t(i)?n.push(i):r.push(i);return[n,r]}function S(e){return e.filter(((e,t,n)=>t===n.findIndex((t=>e===t))))}function C(e,t){return e.filter(((e,n,r)=>n===r.findIndex((n=>e[t]===n[t]))))}function T(e){let t=e.length;for(;t>0;){const n=Math.floor(Math.random()*t);t--;const r=e[t];e[t]=e[n],e[n]=r}return e}function A(e=Date.now()){return`${(e=new Date(e)).getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function P(e){return A(e).slice(0,7)}function I(e){return new Date(Math.round(1e3*(e||0))).toISOString().slice(11,19).replace(/^[0:]+(.{4,})$/,"$1")}function z(e){e.preventDefault()}function M(e){e.stopPropagation()}function N(e,t){return 1===e.length?e[0]:(void 0!==t&&(e=e.filter((e=>e!==t))),e[Math.floor(Math.random()*e.length)])}function O(e,t={}){return S(Object.keys(e).concat(Object.keys(t))).reduce(((n,r)=>(void 0!==e[r]?n[r]=e[r]:void 0!==t[r]&&(n[r]=t[r]),n)),{})}function $(e,t,n){const r=e.filter(t,n);return 0===r.length?e:r}function j(e,t,n=.9){return Math.max(a()(e,t,.99),a()(t,e,.99))>=n}const _=document.createElement("p"),R=new m("layout"),D={get:(e,t=0)=>R.getNumber(e,t),set(e,t){R.setNumber(e,t)}};function L(e,t){const n=(0,r.useRef)(t);(0,r.useEffect)((()=>{n.current=t}),[t]),(0,r.useLayoutEffect)((()=>{const t=e.current;if(t){const e=new ResizeObserver((()=>n.current()));return e.observe(t),()=>e.disconnect()}}),[e])}const F=document.createElement("div");function B(){const e=(0,r.useRef)(F),[t,n]=(0,r.useState)(0);return(0,r.useEffect)((()=>{F.parentElement||(document.body.append(F),n(V()))}),[]),L(e,(0,r.useCallback)((()=>n(V())),[])),t}function V(){return parseInt(getComputedStyle(F).fontSize,10)||16}function U({vertical:e,primary:t,size:n,children:i}){const o={};return t||(e?o.height=`${n}px`:o.width=`${n}px`),r.createElement("div",{className:"layout-pane layout-pane-"+(t?"primary":"secondary"),style:o},i)}function H({id:e,arrange:t="columns",primaryIndex:n=0,children:i}){const o=(0,r.useRef)(null),[a,s]=(0,r.useState)({width:0,height:0}),[l,c]=(0,r.useState)(0),[u,d]=(0,r.useState)(0),[m,f]=(0,r.useState)(0),[h,p]=(0,r.useState)((()=>e?D.get(e):0)),[v,g]=(0,r.useState)(-1),[b,y]=(0,r.useState)(0),w=-1!==v,x=B(),k="rows"===t;(0,r.useEffect)((()=>{e&&D.set(e,h)}),[e,h]),(0,r.useLayoutEffect)((()=>{var e;if(x>0){const t=o.current,n=k?"minHeight":"minWidth",r=t.querySelector(":scope > .layout-pane-primary");if(r){r.style[n]="";const e=parseInt(getComputedStyle(r)[n],10);r.style[n]="unset",c(e||80)}const i=t.querySelector(":scope > .layout-pane-secondary");if(i){i.style[n]="";const r=parseInt(getComputedStyle(i)[n],10);i.style[n]="unset",d(r||80);const o=k?"offsetHeight":"offsetWidth",a=t.querySelector(":scope > .layout-splitter");f(null!==(e=null==a?void 0:a[o])&&void 0!==e?e:4)}}}),[k,x]),(0,r.useLayoutEffect)((()=>{const e=k?a.height:a.width;if(e>0){const t=e-m-h;t<l?p(Math.max(h-(l-t),0)):h<u&&p(Math.min(e-m-l,u))}}),[k,a,l,u,m,h]);const E=(0,r.useCallback)((e=>{if(0===e.button){const t=k?e.screenY:e.screenX;g(t),y(h),e.preventDefault()}}),[k,h]),S=(0,r.useCallback)((e=>{const t=(k?e.screenY:e.screenX)-v;p(0===n?b-t:b+t)}),[k,n,v,b]),C=(0,r.useCallback)((()=>{g(-1),y(0)}),[]);return(0,r.useEffect)((()=>{if(w)return document.documentElement.style.cursor=k?"ns-resize":"ew-resize",document.body.classList.add("dragging"),document.addEventListener("mouseup",C),document.addEventListener("mousemove",S),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",C),document.removeEventListener("mousemove",S)}}),[k,w,S,C]),L(o,(0,r.useCallback)((()=>{const e=o.current;s({width:e.clientWidth,height:e.clientHeight})}),[])),r.createElement("div",{className:`splitter splitter-${t}`,id:e,ref:o},r.Children.toArray(i).slice(0,2).map(((e,t)=>{const i=t===n,o=i?0:h,a=[];return 1===t&&a.push(r.createElement("div",{className:"layout-splitter "+(w?"active":""),role:"separator",onMouseDown:E,key:"splitter"})),a.push(r.createElement(U,{vertical:k,primary:i,size:o,key:t},e)),a})))}F.style.cssText="\n    position: absolute;\n    pointer-events: none;\n    visibility: hidden;\n    font-size: 1rem;\n    width: 1rem;\n    height: 1rem;\n";var q=function(e,t){return q=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},q(e,t)};function W(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}q(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Y(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function K(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function X(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function G(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function J(e){return this instanceof J?(this.v=e,this):new J(e)}function Q(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=i[e](t)).value instanceof J?Promise.resolve(n.value.v).then(l,c):u(o[0][2],n)}catch(e){u(o[0][3],e)}var n}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),o.shift(),o.length&&s(o[0][0],o[0][1])}}function Z(e){return"function"==typeof e}function ee(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create;var te=ee((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function ne(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var re=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var o=this._parentage;if(o)if(this._parentage=null,Array.isArray(o))try{for(var a=K(o),s=a.next();!s.done;s=a.next())s.value.remove(this)}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else o.remove(this);var l=this.initialTeardown;if(Z(l))try{l()}catch(e){i=e instanceof te?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=K(c),d=u.next();!d.done;d=u.next()){var m=d.value;try{ae(m)}catch(e){i=null!=i?i:[],e instanceof te?i=G(G([],X(i)),X(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(i)throw new te(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)ae(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ne(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&ne(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),ie=re.EMPTY;function oe(e){return e instanceof re||e&&"closed"in e&&Z(e.remove)&&Z(e.add)&&Z(e.unsubscribe)}function ae(e){Z(e)?e():e.unsubscribe()}var se=function(e){function t(t,n){return e.call(this)||this}return W(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(re),le={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=le.delegate;return(null==i?void 0:i.setInterval)?i.setInterval.apply(i,G([e,t],X(n))):setInterval.apply(void 0,G([e,t],X(n)))},clearInterval:function(e){var t=le.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},ce=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return W(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),le.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&le.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ne(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(se),ue={now:function(){return(ue.delegate||Date).now()},delegate:void 0},de=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=ue.now,e}(),me=new(function(e){function t(t,n){void 0===n&&(n=de.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return W(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(de))(ce),fe=me,he=null,pe=null,ve=void 0,ge=!1,be=!1,ye={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=ye.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,G([e,t],X(n))):setTimeout.apply(void 0,G([e,t],X(n)))},clearTimeout:function(e){var t=ye.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function we(e){ye.setTimeout((function(){if(!he)throw e;he(e)}))}function xe(){}var ke=Ee("C",void 0,void 0);function Ee(e,t,n){return{kind:e,value:t,error:n}}var Se=null;function Ce(e){if(ge){var t=!Se;if(t&&(Se={errorThrown:!1,error:null}),e(),t){var n=Se,r=n.errorThrown,i=n.error;if(Se=null,r)throw i}}else e()}var Te=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,oe(t)&&t.add(n)):n.destination=Oe,n}return W(t,e),t.create=function(e,t,n){return new ze(e,t,n)},t.prototype.next=function(e){this.isStopped?Ne(function(e){return Ee("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Ne(Ee("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Ne(ke,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(re),Ae=Function.prototype.bind;function Pe(e,t){return Ae.call(e,t)}var Ie=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){Me(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){Me(e)}else Me(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){Me(e)}},e}(),ze=function(e){function t(t,n,r){var i,o,a=e.call(this)||this;return Z(t)||!t?i={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:a&&be?((o=Object.create(t)).unsubscribe=function(){return a.unsubscribe()},i={next:t.next&&Pe(t.next,o),error:t.error&&Pe(t.error,o),complete:t.complete&&Pe(t.complete,o)}):i=t,a.destination=new Ie(i),a}return W(t,e),t}(Te);function Me(e){var t;ge?(t=e,ge&&Se&&(Se.errorThrown=!0,Se.error=t)):we(e)}function Ne(e,t){var n=pe;n&&ye.setTimeout((function(){return n(e,t)}))}var Oe={closed:!0,next:xe,error:function(e){throw e},complete:xe},$e="function"==typeof Symbol&&Symbol.observable||"@@observable";function je(e){return e}function _e(e){return 0===e.length?je:1===e.length?e[0]:function(t){return e.reduce((function(e,t){return t(e)}),t)}}var Re=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,i=function(e){return e&&e instanceof Te||function(e){return e&&Z(e.next)&&Z(e.error)&&Z(e.complete)}(e)&&oe(e)}(e)?e:new ze(e,t,n);return Ce((function(){var e=r,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?r._subscribe(i):r._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=De(t))((function(t,r){var i=new ze({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[$e]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return _e(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=De(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function De(e){var t;return null!==(t=null!=e?e:ve)&&void 0!==t?t:Promise}function Le(e){return e&&Z(e.schedule)}function Fe(e,t,n){void 0===e&&(e=0),void 0===n&&(n=fe);var r=-1;return null!=t&&(Le(t)?n=t:r=t),new Re((function(t){var i=function(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;i<0&&(i=0);var o=0;return n.schedule((function(){t.closed||(t.next(o++),0<=r?this.schedule(void 0,r):t.complete())}),i)}))}function Be(e,t){return void 0===e&&(e=0),void 0===t&&(t=me),e<0&&(e=0),Fe(e,e,t)}function Ve({children:e}){return r.createElement(r.Fragment,null,e)}var Ue=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function He(e){return Z(null==e?void 0:e.then)}function qe(e){return Z(e[$e])}function We(e){return Symbol.asyncIterator&&Z(null==e?void 0:e[Symbol.asyncIterator])}function Ye(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Ke="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Xe(e){return Z(null==e?void 0:e[Ke])}function Ge(e){return Q(this,arguments,(function(){var t,n,r;return Y(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,J(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,J(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,J(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function Je(e){return Z(null==e?void 0:e.getReader)}function Qe(e){if(e instanceof Re)return e;if(null!=e){if(qe(e))return i=e,new Re((function(e){var t=i[$e]();if(Z(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Ue(e))return t=e,new Re((function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()}));if(He(e))return r=e,new Re((function(e){r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,we)}));if(We(e))return Ze(e);if(Xe(e))return n=e,new Re((function(e){var t,r;try{for(var i=K(n),o=i.next();!o.done;o=i.next()){var a=o.value;if(e.next(a),e.closed)return}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()}));if(Je(e))return Ze(Ge(e))}var t,n,r,i;throw Ye(e)}function Ze(e){return new Re((function(t){(function(e,t){var n,r,i,o,a,s,l,c;return a=this,s=void 0,c=function(){var a,s;return Y(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=K(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,i,(t=e[n](t)).done,t.value)}))}}}(e),l.label=1;case 1:return[4,n.next()];case 2:if((r=l.sent()).done)return[3,4];if(a=r.value,t.next(a),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=l.sent(),i={error:s},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(o=n.return)?[4,o.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))},new((l=void 0)||(l=Promise))((function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(n,r)}i((c=c.apply(a,s||[])).next())}))})(e,t).catch((function(e){return t.error(e)}))}))}function et(e){return function(t){if(function(e){return Z(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function tt(e,t,n,r,i){return new nt(e,t,n,r,i)}var nt=function(e){function t(t,n,r,i,o,a){var s=e.call(this,t)||this;return s.onFinalize=o,s.shouldUnsubscribe=a,s._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return W(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(Te);function rt(e,t){return et((function(n,r){var i=0;n.subscribe(tt(r,(function(n){r.next(e.call(t,n,i++))})))}))}function it(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var o=t.schedule((function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(o),!i)return o}function ot(e,t,n){return void 0===n&&(n=1/0),Z(t)?ot((function(n,r){return rt((function(e,i){return t(n,e,r,i)}))(Qe(e(n,r)))}),n):("number"==typeof t&&(n=t),et((function(t,r){return function(e,t,n,r,i,o,a,s){var l=[],c=0,u=0,d=!1,m=function(){!d||l.length||c||t.complete()},f=function(e){return c<r?h(e):l.push(e)},h=function(e){c++;var i=!1;Qe(n(e,u++)).subscribe(tt(t,(function(e){t.next(e)}),(function(){i=!0}),void 0,(function(){if(i)try{c--;for(;l.length&&c<r;)e=void 0,e=l.shift(),h(e);m()}catch(e){t.error(e)}var e})))};return e.subscribe(tt(t,f,(function(){d=!0,m()}))),function(){}}(t,r,e,n)})))}var at=Array.isArray;function st(e){return rt((function(t){return function(e,t){return at(t)?e.apply(void 0,G([],X(t))):e(t)}(e,t)}))}var lt=["addListener","removeListener"],ct=["addEventListener","removeEventListener"],ut=["on","off"];function dt(e,t,n,r){if(Z(n)&&(r=n,n=void 0),r)return dt(e,t,n).pipe(st(r));var i=X(function(e){return Z(e.addEventListener)&&Z(e.removeEventListener)}(e)?ct.map((function(r){return function(i){return e[r](t,i,n)}})):function(e){return Z(e.addListener)&&Z(e.removeListener)}(e)?lt.map(mt(e,t)):function(e){return Z(e.on)&&Z(e.off)}(e)?ut.map(mt(e,t)):[],2),o=i[0],a=i[1];if(!o&&Ue(e))return ot((function(e){return dt(e,t,n)}))(Qe(e));if(!o)throw new TypeError("Invalid event target");return new Re((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return o(t),function(){return a(t)}}))}function mt(e,t){return function(n){return function(r){return e[n](t,r)}}}function ft(e){return void 0===e&&(e=1/0),ot(je,e)}var ht=new Re((function(e){return e.complete()}));function pt(e){return e[e.length-1]}function vt(e){return Z(pt(e))?e.pop():void 0}function gt(e){return Le(pt(e))?e.pop():void 0}function bt(e,t){return"number"==typeof pt(e)?e.pop():t}function yt(e,t){return void 0===t&&(t=0),et((function(n,r){n.subscribe(tt(r,(function(n){return it(r,e,(function(){return r.next(n)}),t)}),(function(){return it(r,e,(function(){return r.complete()}),t)}),(function(n){return it(r,e,(function(){return r.error(n)}),t)})))}))}function wt(e,t){return void 0===t&&(t=0),et((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function xt(e,t){if(!e)throw new Error("Iterable cannot be null");return new Re((function(n){it(n,t,(function(){var r=e[Symbol.asyncIterator]();it(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function kt(e,t){return t?function(e,t){if(null!=e){if(qe(e))return function(e,t){return Qe(e).pipe(wt(t),yt(t))}(e,t);if(Ue(e))return function(e,t){return new Re((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(He(e))return function(e,t){return Qe(e).pipe(wt(t),yt(t))}(e,t);if(We(e))return xt(e,t);if(Xe(e))return function(e,t){return new Re((function(n){var r;return it(n,t,(function(){r=e[Ke](),it(n,t,(function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(e){return void n.error(e)}i?n.complete():n.next(t)}),0,!0)})),function(){return Z(null==r?void 0:r.return)&&r.return()}}))}(e,t);if(Je(e))return function(e,t){return xt(Ge(e),t)}(e,t)}throw Ye(e)}(e,t):Qe(e)}function Et(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=gt(e),r=bt(e,1/0),i=e;return i.length?1===i.length?Qe(i[0]):ft(r)(kt(i,n)):ht}function St(){return ft(1)}function Ct(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return St()(kt(e,gt(e)))}function Tt(e,t){return et((function(n,r){var i=0;n.subscribe(tt(r,(function(n){return e.call(t,n,i++)&&r.next(n)})))}))}function At(e,t){return et((function(n,r){var i=null,o=0,a=!1,s=function(){return a&&!i&&r.complete()};n.subscribe(tt(r,(function(n){null==i||i.unsubscribe();var a=0,l=o++;Qe(e(n,l)).subscribe(i=tt(r,(function(e){return r.next(t?t(n,e,l,a++):e)}),(function(){i=null,s()})))}),(function(){a=!0,s()})))}))}function Pt(e){return et((function(t,n){Qe(e).subscribe(tt(n,(function(){return n.complete()}),xe)),!n.closed&&t.subscribe(n)}))}function It(e,t){switch(t.type){case"resize":{const n=Math.max(t.clientSize,0),r=Math.max(t.scrollSize,n);if(n!==e.clientSize||r!==e.scrollSize){const t=r-n,i=zt(e.position,t);return Object.assign(Object.assign({},e),{position:i,max:t,clientSize:n,scrollSize:r})}return e}case"scrollBy":{const n=zt(e.position+t.amount,e.max);return n!==e.position?Object.assign(Object.assign({},e),{position:n}):e}case"scrollTo":{const n=zt(t.position,e.max);return n!==e.position?Object.assign(Object.assign({},e),{position:n}):e}default:return e}}function zt(e,t){return Math.min(Math.max(e,0),t)}const Mt={position:0,max:0,clientSize:0,scrollSize:0};const Nt=(0,r.memo)((function(e){var{orientation:t,scrollAmount:n,onChange:i,onResize:o,scrollbarRef:a}=e,s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["orientation","scrollAmount","onChange","onResize","scrollbarRef"]);const l=(0,r.useRef)(null),c=(0,r.useRef)(null),{position:u,max:d,clientSize:m,scrollSize:f,resize:h,scrollBy:p,scrollTo:v}=function(){const[{position:e,max:t,clientSize:n,scrollSize:i},o]=(0,r.useReducer)(It,Mt),a=(0,r.useCallback)(((e,t)=>o({type:"resize",clientSize:e,scrollSize:t})),[]),s=(0,r.useCallback)((e=>o({type:"scrollTo",position:e})),[]);return{position:e,max:t,clientSize:n,scrollSize:i,scrollTo:s,scrollBy:(0,r.useCallback)((e=>o({type:"scrollBy",amount:e})),[]),resize:a}}(),[g,b]=(0,r.useState)(0),[y,w]=(0,r.useState)(0),[x,k]=(0,r.useState)(0),[E,S]=(0,r.useState)(-1),[C,T]=(0,r.useState)(0),A=-1!==E,P="vertical"===t,I=Math.ceil(u/d*(y-x));(0,r.useEffect)((()=>{a.current={scrollBy:p,scrollTo:v}}),[a,p,v]),(0,r.useLayoutEffect)((()=>h(s.clientSize,s.scrollSize)),[s.clientSize,s.scrollSize,h]),(0,r.useLayoutEffect)((()=>null==i?void 0:i(u)),[u,i]),(0,r.useLayoutEffect)((()=>null==o?void 0:o(g)),[g,o]),L(l,(0,r.useCallback)((()=>{const e=l.current.getBoundingClientRect();w(P?e.height:e.width),b(P?e.width:e.height)}),[P])),L(c,(0,r.useCallback)((()=>{const e=c.current.getBoundingClientRect();k(P?e.height:e.width)}),[P]));const z=(0,r.useCallback)(((e,t)=>{const n=()=>a.current.scrollBy(t),r=t=>t.target===e,i=dt(document,"mouseup"),o=dt(e,"mouseover").pipe(rt(r),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=gt(e);return et((function(t,r){(n?Ct(e,t,n):Ct(e,t)).subscribe(r)}))}(!0)),s=Et(o,dt(e,"mouseout").pipe(Tt(r),rt((()=>!1)))).pipe(At(((e,t)=>e?Fe(0===t?400:0,40):ht)),Pt(i)).subscribe(n);return n(),()=>s.unsubscribe()}),[a]),M=(0,r.useCallback)((e=>{if(0===e.button)return e.stopPropagation(),z(e.target,-n)}),[n,z]),N=(0,r.useCallback)((e=>{if(0===e.button)return e.stopPropagation(),z(e.target,n)}),[n,z]),O=(0,r.useCallback)((e=>{if(0===e.button){e.preventDefault();const t=P?e.nativeEvent.offsetY:e.nativeEvent.offsetX;return z(e.target,t<I?-m:m)}}),[P,m,I,z]),$=(0,r.useCallback)((e=>{0===e.button&&(e.preventDefault(),e.stopPropagation(),S(P?e.screenY:e.screenX),T(I))}),[P,I]),j=(0,r.useCallback)((e=>{const t=P?e.screenY:e.screenX;v((C+(t-E))*d/(y-x))}),[P,E,C,d,x,y,v]),_=(0,r.useCallback)((()=>{S(-1),T(0)}),[]);return(0,r.useEffect)((()=>{if(A)return document.body.classList.add("dragging"),document.addEventListener("mouseup",_),document.addEventListener("mousemove",j),()=>{document.body.classList.remove("dragging"),document.removeEventListener("mouseup",_),document.removeEventListener("mousemove",j)}}),[A,j,_]),r.createElement("div",{className:`scrollbar scrollbar-${t}`},r.createElement("div",{className:"scrollbar-button scrollbar-button-decrement",onMouseDown:M},r.createElement("svg",{className:"icon",viewBox:"0 0 50 50"},r.createElement("polygon",{points:P?"0,50 25,0 50,50":"50,0 0,25 50,50"}))),r.createElement("div",{className:"scrollbar-track",onMouseDown:O,ref:l},r.createElement("div",{className:"scrollbar-thumb",onMouseDown:$,style:{[P?"height":"width"]:y*(f?m/f:0)+"px",transform:`translate${P?"Y":"X"}(${I}px)`},ref:c})),r.createElement("div",{className:"scrollbar-button scrollbar-button-increment",onMouseDown:N},r.createElement("svg",{className:"icon",viewBox:"0 0 50 50"},r.createElement("polygon",{points:P?"0,0 25,50 50,0":"0,0 50,25 0,50"}))))}));function Ot({children:e,scrollWidth:t=0,scrollHeight:n=0,scrollAmount:i=10,droppable:o,onResize:a,onScroll:s,scrollableRef:l}){const c=(0,r.useRef)(null),u=(0,r.useRef)(null),d=(0,r.useRef)(null),m=(0,r.useRef)(null),f=(0,r.useRef)(null),h=(0,r.useRef)(null),[p,v]=(0,r.useState)(0),[g,b]=(0,r.useState)(0),[y,w]=(0,r.useState)(0),[x,k]=(0,r.useState)(0),[S,C]=(0,r.useState)(0),[T,A]=(0,r.useState)(t),[P,I]=(0,r.useState)(n),[z,M]=(0,r.useState)(0),[N,O]=(0,r.useState)(0),[$,j]=(0,r.useState)(!1),[_,R]=(0,r.useState)(!1),[D,F]=(0,r.useState)(0),B=Math.max(z-(_?g:0),0),V=Math.max(N-($?p:0),0);(0,r.useEffect)((()=>{l&&(l.current={scrollTo:({left:e,top:t})=>{void 0!==e&&f.current.scrollTo(e),void 0!==t&&h.current.scrollTo(t)}})}),[l]),(0,r.useLayoutEffect)((()=>{T&&B?j(T-B>1):R(!1)}),[T,B]),(0,r.useLayoutEffect)((()=>{R(!(!P||!V)&&P-V>1)}),[P,V]),(0,r.useLayoutEffect)((()=>{c.current.classList.toggle("overflow-x",$)}),[$]),(0,r.useLayoutEffect)((()=>{c.current.classList.toggle("overflow-y",_)}),[_]),(0,r.useLayoutEffect)((()=>{var e;A(0===t?(null===(e=u.current)||void 0===e?void 0:e.scrollWidth)||0:t)}),[t]),(0,r.useLayoutEffect)((()=>{var e;I(0===n?(null===(e=u.current)||void 0===e?void 0:e.scrollHeight)||0:n)}),[n]);const U=(0,r.useCallback)((()=>{const e=c.current;M(e.clientWidth),O(e.clientHeight),w(e.getBoundingClientRect().top)}),[]),H=(0,r.useCallback)((()=>{const e=u.current,r=m.current;0===t&&A(e.scrollWidth),0===n&&I(r.scrollHeight+d.current.clientHeight),null==a||a({width:e.clientWidth,height:e.clientHeight})}),[t,n,a]);L(c,U),L(u,H),L(m,H),(0,r.useLayoutEffect)((()=>{null==s||s({left:x,top:S})}),[x,S,s]);const q=(0,r.useCallback)((e=>{h.current.scrollBy(3*i*Math.sign(e.deltaY))}),[i]),W=(0,r.useCallback)((e=>{const t=e.nativeEvent.clientY-y;t+i/2>N?F(i):t<i&&F(-i)}),[y,N,i]);(0,r.useEffect)((()=>{if(D){const e=()=>h.current.scrollBy(D),t=Be(100).subscribe(e);return()=>t.unsubscribe()}}),[D]);const Y=(0,r.useCallback)((()=>F(0)),[]),[K,X]=E(r.Children.toArray(e),(e=>(null==e?void 0:e.type)===Ve));return r.createElement("div",{className:"scrollable",onWheel:q,ref:c},r.createElement("div",{className:"scrollable-content",onDragOver:o?W:void 0,onDragLeave:o?Y:void 0,onDragEnd:o?Y:void 0,onDrop:o?Y:void 0,style:{right:_?`${g}px`:"0",bottom:$?`${p}px`:"0",transform:`translateX(-${x}px)`},ref:u},r.createElement("div",{className:"scrollable-head",ref:d},K),r.createElement("div",{className:"scrollable-body",style:{width:t?`${t}px`:void 0}},r.createElement("div",{className:"scrollable-body-content",style:{transform:`translateY(-${S}px)`},ref:m},X))),r.createElement(Nt,{orientation:"horizontal",clientSize:B,scrollSize:T,scrollAmount:i,onChange:k,onResize:v,scrollbarRef:f}),r.createElement(Nt,{orientation:"vertical",clientSize:V,scrollSize:P,scrollAmount:i,onChange:C,onResize:b,scrollbarRef:h}))}function $t(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=gt(e);return kt(e,n)}function jt(e=200){const[t,n]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const t=(e,t)=>dt(document,e,{capture:!0}).pipe(rt((()=>t))),r=Et(t("keydown",!0),t("keyup",!1)).pipe((i=t=>t?$t(0):Fe(e),et((function(e,t){var n=!1,r=null,o=null,a=function(){if(null==o||o.unsubscribe(),o=null,n){n=!1;var e=r;r=null,t.next(e)}};e.subscribe(tt(t,(function(e){null==o||o.unsubscribe(),n=!0,r=e,o=tt(t,a,xe),Qe(i(e)).subscribe(o)}),(function(){a(),t.complete()}),void 0,(function(){r=o=null})))})))).subscribe(n);var i;return()=>r.unsubscribe()}),[e]),t}function _t(e){return(0,r.useMemo)((()=>Rt(e)),[e])}function Rt(e){return e.reduce(((e,t)=>(e.push(t.id),t.children?e.concat(Rt(t.children)):e)),[])}function Dt(e){return{storeExpandedState:(0,r.useCallback)(((t,n)=>{e&&localStorage.setItem(`${e}/${t}`,String(!!n))}),[e]),retrieveExpandedState:(0,r.useCallback)(((t,n=!1)=>{if(e){const r=localStorage.getItem(`${e}/${t}`);return"string"==typeof r?"true"===r:n}return n}),[e]),storeSelectedNodeId:(0,r.useCallback)((t=>{e&&localStorage.setItem(`${e}/selectedId`,t)}),[e]),retrieveSelectedNodeId:(0,r.useCallback)((t=>e&&localStorage.getItem(`${e}/selectedId`)||t),[e])}}function Lt(e,t){const{storeExpandedState:n,retrieveExpandedState:i}=Dt(t),o=_t(e),[a,s]=(0,r.useState)((()=>Ft(e,i)));(0,r.useEffect)((()=>{const e=a.filter((e=>o.includes(e)));e.length!==a.length&&s(e)}),[o,a]);const l=(0,r.useCallback)(((e,t)=>{const r=a.includes(e);r!==t&&(s(r?a.filter((t=>t!==e)):a.concat(e)),n(e,!r))}),[a,n]);return{expandedIds:a,toggle:l}}function Ft(e,t){return e.reduce(((e,n)=>(t(n.id,n.startExpanded)&&e.push(n.id),n.children?e.concat(Ft(n.children,t)):e)),[])}function Bt(e,t){return(0,r.useMemo)((()=>Vt(e,t)),[e,t])}function Vt(e,t){return e.reduce(((e,n)=>(e.push(n.id),n.children&&t.includes(n.id)?e.concat(Vt(n.children,t)):e)),[])}function Ut({id:e,label:t,children:n=[],selectedId:i,expandedIds:o,level:a,rowHeight:s,nodeIndex:l,setSize:c,emptyMarker:u,onSelect:d,onToggle:m}){const f=o.includes(e),h=0!==n.length,p=e===i,v=`${h?"expandable":""} ${f?"expanded":""} ${p?"selected":""} ${0===n.length?"empty":""}`,g=(0,r.useCallback)((e=>{e.stopPropagation()}),[]),b=(0,r.useCallback)((t=>{t.stopPropagation(),null==d||d(e)}),[e,d]),y=(0,r.useCallback)((t=>{t.stopPropagation(),null==m||m(e)}),[e,m]),w=(0,r.useCallback)((t=>{t.stopPropagation(),null==m||m(e),f&&Kt(n,i)&&(null==d||d(e))}),[e,i,f,n,d,m]);return r.createElement("li",{className:`tree-view-node ${v}`,id:`tree-view-node-${e}`,role:"treeitem","aria-selected":p?"true":void 0,"aria-expanded":f?"true":void 0,"aria-labelledby":`tree-view-node-label-${e}`,"aria-level":a,"aria-setsize":c,"aria-posinset":l+1,onMouseDown:b},r.createElement("span",{className:"tree-view-row "+(p?"selected-text":""),onDoubleClick:y,style:{height:`${s}px`}},h?r.createElement("svg",{className:"tree-view-node-marker",viewBox:`0 0 ${f?320:256} 512`,onMouseDown:g,onClick:w},f?r.createElement("path",{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"}):r.createElement("path",{d:"M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"})):u&&r.createElement("svg",{className:"tree-view-node-marker",viewBox:"0 0 24 24",onMouseDown:g},r.createElement("circle",{cx:"12",cy:"12",r:"4"})),r.createElement("span",{className:"tree-view-node-label",id:`tree-view-node-label-${e}`},t)),f&&r.createElement("ul",{className:"tree-view-node-children",role:"group"},n.map(((e,t)=>{var{id:l}=e,c=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["id"]);return r.createElement(Ut,Object.assign({},c,{id:l,selectedId:i,expandedIds:o,level:a+1,rowHeight:s,nodeIndex:t,setSize:n.length,onSelect:d,onToggle:m,key:l}))}))))}var Ht,qt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Wt(e){var{roots:t,className:n="",onSelect:i}=e,o=qt(e,["roots","className","onSelect"]);const a=0===t.length;return(0,r.useEffect)((()=>{a&&(null==i||i(null))}),[a,i]),a?r.createElement("div",{className:`tree-view ${n}`,tabIndex:0}):r.createElement(Yt,Object.assign({},o,{className:n,roots:t,onSelect:i}))}function Yt({roots:e,className:t,storageId:n,onContextMenu:i,onDelete:o,onEnter:a,onInfo:s,onSelect:l}){const c=(0,r.useRef)(null),u=(0,r.useRef)(null),d=(0,r.useRef)(null),{storeSelectedNodeId:m,retrieveSelectedNodeId:f}=Dt(n),[h,p]=(0,r.useState)((()=>{var t;return f(null===(t=e[0])||void 0===t?void 0:t.id)})),{expandedIds:v,toggle:g}=Lt(e,n),b=Bt(e,v),y=b.indexOf(h),[w,x]=(0,r.useState)(0),[k,E]=(0,r.useState)(24),[S,C]=(0,r.useState)(0),T=Math.floor(w/k)-1,A=b.length,P=Xt(e,h),I=jt()&&!(0===y||y===A-1),[z,M]=(0,r.useState)((()=>P));(0,r.useLayoutEffect)((()=>{if(!Kt(e,h)){const t=e.find((e=>null==h?void 0:h.startsWith(`${e.id}/`)))||e[0];p(null==t?void 0:t.id)}}),[e,h]),(0,r.useLayoutEffect)((()=>{null==l||l(z)}),[z,l]),(0,r.useEffect)((()=>{m(h)}),[h,m]),(0,r.useEffect)((()=>{I||M(P)}),[P,I]);const N=(0,r.useCallback)((e=>{e.preventDefault(),null==i||i(P,e.pageX,e.pageY)}),[P,i]),O=(0,r.useCallback)((e=>{switch(e.key){case"Enter":e.stopPropagation(),e.repeat||null==a||a(P);break;case"Delete":e.stopPropagation(),e.repeat||null==o||o(P);break;case"Info":case"i":e.stopPropagation(),e.repeat||null==s||s(P);break;case"ArrowLeft":e.stopPropagation(),e.repeat||g(h,!1);break;case"ArrowRight":e.stopPropagation(),e.repeat||g(h,!0);break;default:{const t=function(e,t,n){switch(e){case"ArrowUp":return t[t.indexOf(n)-1]||n;case"ArrowDown":return t[t.indexOf(n)+1]||n;case"Home":return t[0]||n;case"End":return t[t.length-1]||n;default:return""}}(e.key,b,h);if(t&&(e.preventDefault(),t!==h)){e.stopPropagation();const n=u.current,r=Math.floor(S/k),i=b.indexOf(t);if(i>=r+T-1){const e=A*k,t=A-T-1,r=Math.min(A-1,i+1)-T,o=r===t?e:r*k;n.scrollTo({top:o})}else if(i<=r){const e=Math.max(0,i-1)*k;n.scrollTo({top:e})}p(t)}}}}),[b,h,P,k,T,A,S,o,a,s,g]),$=(0,r.useCallback)((({height:e})=>x(e)),[]),j=(0,r.useCallback)((({top:e})=>C(e)),[]);return L(d,(0,r.useCallback)((()=>{E(d.current.getBoundingClientRect().height)}),[])),r.createElement("div",{className:`tree-view ${t}`,tabIndex:0,onContextMenu:N,onKeyDown:O,ref:c},r.createElement(Ot,{scrollAmount:k,onResize:$,onScroll:j,scrollableRef:u},r.createElement("ul",{role:"tree"},e.map(((t,n)=>{var{id:i}=t,o=qt(t,["id"]);return r.createElement(Ut,Object.assign({},o,{id:i,selectedId:h,expandedIds:v,level:1,rowHeight:k,nodeIndex:n,setSize:e.length,emptyMarker:!0,onSelect:p,onToggle:g,key:i}))}))),r.createElement("div",{className:"tree-view-cursor",style:{transform:`translateY(${y*k}px)`},ref:d})))}function Kt(e,t){for(const n of e){if(n.id===t)return!0;if(n.children&&Kt(n.children,t))return!0}return!1}function Xt(e,t){return e.reduce(((e,n)=>{if(void 0===e)if(n.id===t)e=n.value;else if(n.children)return Xt(n.children,t);return e}),void 0)}!function(e){e[e.Media=0]="Media",e[e.Album=1]="Album",e[e.Artist=2]="Artist",e[e.Playlist=3]="Playlist"}(Ht||(Ht={}));const Gt=Ht;function Jt(e){return e<=0?function(){return ht}:et((function(t,n){var r=0;t.subscribe(tt(n,(function(t){++r<=e&&(n.next(t),e<=r&&n.complete())})))}))}function Qt(e,t=5e3){return new Promise(((n,r)=>{const i=()=>e.disconnect(),o=e.observeItems(),a=Et(e.observeError(),Fe(t).pipe(rt((()=>Error("timeout")))));o.pipe(Pt(a),Jt(1)).subscribe({next:n,complete:i}),a.pipe(Pt(o),Jt(1)).subscribe({next:r,complete:i}),e.fetchAt(0)}))}class Zt{constructor(e=[]){this.items=e}get maxSize(){}observeItems(){return $t(this.items)}observeSize(){return $t(this.items.length)}observeError(){return ht}fetchAt(){}disconnect(){this.items.forEach((e=>{var t;return null===(t=e.pager)||void 0===t?void 0:t.disconnect()}))}}var en=ee((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),tn=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return W(t,e),t.prototype.lift=function(e){var t=new nn(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new en},t.prototype.next=function(e){var t=this;Ce((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=K(t.currentObservers),o=i.next();!o.done;o=i.next())o.value.next(e)}catch(e){n={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;Ce((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;Ce((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,o=n.observers;return r||i?ie:(this.currentObservers=null,o.push(e),new re((function(){t.currentObservers=null,ne(o,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new Re;return e.source=this,e},t.create=function(e,t){return new nn(e,t)},t}(Re),nn=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return W(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:ie},t}(tn),rn=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return W(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(tn);function on(e,t){return void 0===t&&(t=je),e=null!=e?e:an,et((function(n,r){var i,o=!0;n.subscribe(tt(r,(function(n){var a=t(n);!o&&e(i,a)||(o=!1,i=a,r.next(n))})))}))}function an(e,t){return e===t}const sn="eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Ijk3RjI2N1daRDkifQ.eyJpYXQiOjE2NjEzNjAyODMsImV4cCI6MTY3NjkxMjI4MywiaXNzIjoiODM4Nk5ERlhMQiJ9.qkvBCFCPGPBBO1Z26b1kiQBzCoZjbcpcIMrxyi-m1BpTWSJUEP9nT58cwc5WGbkOc1YVmipk9Lj0mtOKi_4Qsg".toString(),ln="41bd731be5b78200d2bbaea2312b917b".toString(),cn="78aa93b641329f00e68cf1542356b8fc".toString(),un="68c1c915728f4b9da193da1028692f0d".toString(),dn="AIzaSyD-cQaU5ntJBcCEBAbmK5pIXD4FQ19fdho".toString(),mn="364143070327-sgopc15lidje8uq4l16k1u8pqo2hpc4o.apps.googleusercontent.com".toString(),fn=new m("apple"),hn={get useMusicKitBeta(){return fn.getBoolean("useMusicKitBeta")},set useMusicKitBeta(e){fn.setBoolean("useMusicKitBeta",e)},clear(){fn.clear()}};var pn=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};class vn{constructor(e){this.MusicKit=e}get version(){return this.MusicKit.version}get Events(){return this.MusicKit.Events}get PlaybackStates(){return this.MusicKit.PlaybackStates}configure(e){return pn(this,void 0,void 0,(function*(){const t=this.MusicKit.configure(e);return this.instance=t,Object.defineProperties(t,{volume:{get:()=>t.player.volume,set:e=>t.player.volume=e},queue:{get:()=>t.player.queue},isPlaying:{get:()=>t.player.isPlaying},nowPlayingItem:{get:()=>t.player.nowPlayingItem}}),Object.defineProperties(t.api,{music:{get:()=>e=>this.music(e)}}),this.instance}))}getInstance(){const e=this.instance;if(e)return e.api.music||Object.defineProperties(e.api,{music:{get:()=>e=>this.music(e)}}),e;throw Error("Not configured.")}formatArtworkURL(e,t,n){return this.MusicKit.formatArtworkURL(e,t,n)}music(e){return pn(this,void 0,void 0,(function*(){const t=this.getInstance();e=e.replace("{{storefrontId}}",t.storefrontId);const n=yield fetch(`https://api.music.apple.com${e}`,{headers:{authorization:`Bearer ${t.developerToken}`,"music-user-token":t.musicUserToken}});if(!n.ok)throw n;return{data:yield n.json()}}))}}var gn=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::appleAuth");const bn=new s("appleAuth"),yn=new rn("");function wn(){return""!==yn.getValue()}function xn(){return yn.pipe(on()).pipe(rt((e=>""!==e)),on())}function kn(){return gn(this,void 0,void 0,(function*(){return window.MusicKit?MusicKit.getInstance():new Promise(((e,t)=>{k(`https://js-cdn.music.apple.com/musickit/v${hn.useMusicKitBeta?3:1}/musickit.js`).then(void 0,t),document.addEventListener("musickitloaded",(()=>gn(this,void 0,void 0,(function*(){bn.log("Loaded MusicKit version",MusicKit.version),window.MusicKit.version.startsWith("1")&&(window.MusicKit=new vn(MusicKit));try{const t=yield window.MusicKit.configure({developerToken:sn,app:{name:"ampcast",build:"0.7.3"},sourceType:8,suppressErrorDialog:!0});e(t)}catch(e){t(e)}}))))}))}))}var En;!function(){gn(this,void 0,void 0,(function*(){const e=yield kn();if(e.isAuthorized){const t=yield e.authorize();bn.log("Access token successfully obtained."),yn.next(t)}}))}(),function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video"}(En||(En={}));const Sn=En;var Cn=Array.isArray,Tn=Object.getPrototypeOf,An=Object.prototype,Pn=Object.keys;function In(e){if(1===e.length){var t=e[0];if(Cn(t))return{args:t,keys:null};if((r=t)&&"object"==typeof r&&Tn(r)===An){var n=Pn(t);return{args:n.map((function(e){return t[e]})),keys:n}}}var r;return{args:e,keys:null}}function zn(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})}function Mn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=gt(e),r=vt(e),i=In(e),o=i.args,a=i.keys;if(0===o.length)return kt([],n);var s=new Re(Nn(o,n,a?function(e){return zn(a,e)}:je));return r?s.pipe(st(r)):s}function Nn(e,t,n){return void 0===n&&(n=je),function(r){On(t,(function(){for(var i=e.length,o=new Array(i),a=i,s=i,l=function(i){On(t,(function(){var l=kt(e[i],t),c=!1;l.subscribe(tt(r,(function(e){o[i]=e,c||(c=!0,s--),s||r.next(n(o.slice()))}),(function(){--a||r.complete()})))}),r)},c=0;c<i;c++)l(c)}),r)}}function On(e,t,n){e?it(n,e,t):t()}function $n(e,t,n){var r=Z(e)||t||n?{next:e,error:t,complete:n}:e;return r?et((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var i=!0;e.subscribe(tt(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;i=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;i=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;i&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):je}const jn=new s("DualPager");class _n{constructor(e,t){this.topPager=e,this.mainPager=t,this.fetches$=new rn({index:0}),this.disconnected=!1}get maxSize(){}observeItems(){return Mn([this.topPager.observeItems(),this.mainPager.observeItems()]).pipe(rt((([e,t])=>e.concat(t))))}observeSize(){return Mn([this.topPager.observeSize(),this.mainPager.observeSize()]).pipe(rt((([e,t])=>e+t)))}observeError(){return this.mainPager.observeError()}disconnect(){var e;this.disconnected||(this.disconnected=!0,null===(e=this.subscriptions)||void 0===e||e.unsubscribe(),this.topPager.disconnect(),this.mainPager.disconnect())}fetchAt(e,t){this.disconnected?jn.warn("disconnected"):(this.subscriptions||this.connect(),this.fetches$.next({index:e,length:t}))}connect(){this.subscriptions||(this.subscriptions=new re,this.subscriptions.add(Mn([this.topPager.observeSize(),this.fetches$]).pipe($n((([e,t])=>this.mainPager.fetchAt(Math.max(t.index-e,0),t.length)))).subscribe(jn)))}}function Rn(e){return et((function(t,n){var r,i=null,o=!1;i=t.subscribe(tt(n,void 0,void 0,(function(a){r=Qe(e(a,Rn(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):o=!0}))),o&&(i.unsubscribe(),i=null,r.subscribe(n))}))}var Dn=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=ue);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=n,i._timestampProvider=r,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=n===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,n),i}return W(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,i=n._buffer,o=n._infiniteTimeWindow,a=n._timestampProvider,s=n._windowTime;r||(i.push(t),!o&&i.push(a.now()+s)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),i=0;i<r.length&&!e.closed;i+=n?1:2)e.next(r[i]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,i=e._infiniteTimeWindow,o=(i?1:2)*t;if(t<1/0&&o<r.length&&r.splice(0,r.length-o),!i){for(var a=n.now(),s=0,l=1;l<r.length&&r[l]<=a;l+=2)s=l;s&&r.splice(0,s+1)}},t}(tn);const Ln=[],Fn=new s("AbstractPager");let Bn=0;class Vn{constructor(e={}){this.config=e,this.items$=new rn(Ln),this.size$=new Dn(1),this.error$=new Dn(1),this.fetches$=new rn({index:0,length:0}),this.disconnected=!1}get maxSize(){return this.config.maxSize}observeItems(){return this.items$.pipe(Tt((e=>e!==Ln)))}observeSize(){return this.size$.pipe(on())}observeError(){return this.error$}disconnect(){this.disconnected||(this.disconnected=!0,this.subscriptions&&(this.subscriptions.unsubscribe(),Bn--),this.items.forEach((e=>{var t;return null===(t=e.pager)||void 0===t?void 0:t.disconnect()})),this.items$.complete(),this.size$.complete(),this.error$.complete())}fetchAt(e,t=this.config.pageSize){if(this.disconnected)Fn.warn("disconnected");else{if(t||(t=50),!this.subscriptions&&(this.connect(),this.config.calculatePageSize)){const{minPageSize:e=10,maxPageSize:n=100}=this.config,r=10*Math.ceil(2*t/10);this.config.pageSize=Math.max(Math.min(r,n),e)}this.fetches$.next({index:e,length:t})}}get items(){return this.items$.getValue()}observeComplete(){return Mn([this.observeItems(),this.observeSize()]).pipe(Tt((([e,t])=>e.reduce((e=>e+1),0)===t)),rt((([e])=>e)),Jt(1))}connect(){this.subscriptions||(Bn++,Bn>100&&Fn.warn(`Too many pagers? Connected pagers=${Bn}.`),this.subscriptions=new re,this.subscriptions.add(this.observeAdditions().pipe($n((e=>this.addMissingTrackCounts(e)))).subscribe(Fn)))}observeAdditions(){return this.items$.pipe(et((function(e,t){var n,r=!1;e.subscribe(tt(t,(function(e){var i=n;n=e,r&&t.next([i,e]),r=!0})))})),rt((([e,t])=>t.filter((t=>!e.find((e=>e.src===t.src)))))))}addMissingTrackCounts(e){e.forEach((e=>{e.itemType===Gt.Playlist&&!e.trackCount&&e.pager&&this.subscriptions.add(e.pager.observeSize().pipe($n((t=>{const n=e.src,r=this.items.findIndex((e=>e.src===n));if(-1!==r){const e=this.items.slice(),n=e[r];e[r]=Object.assign(Object.assign({},n),{trackCount:t}),this.items$.next(e)}}))).subscribe(Fn))}))}}const Un=new s("SequentialPager");class Hn extends Vn{constructor(e,t){super(t),this.fetchNext=e,this.fetching$=new rn(!1),this.maxEmptyCount=2,this.emptyCount=0}connect(){var e,t;this.subscriptions||(super.connect(),this.subscriptions.add(this.observeShouldFetch().pipe($n((()=>this.fetching$.next(!0))),(e=()=>this.fetchNext(this.config.pageSize),Z(t)?ot(e,t,1):ot(e,1)),$n((e=>this.addPage(e))),Rn((e=>(Un.error(e),this.error$.next(e),$t(void 0)))),$n((()=>this.fetching$.next(!1))),Pt(this.observeComplete()),Jt(100)).subscribe(Un)))}observeShouldFetch(){const e=Mn([this.fetches$,this.items$]).pipe(rt((([{index:e,length:t},n])=>e+2*t>=n.length)),Tt((e=>e)),rt((()=>{})),Jt(1));return this.fetching$.pipe(At((t=>t?ht:e)))}addPage(e){var t,n;const r=(e.items||[]).filter(x),i=C(this.items.concat(r),"src");i.length===this.items.length&&this.emptyCount++,i.length=Math.min(i.length,null!==(t=this.maxSize)&&void 0!==t?t:1/0);const o=e.atEnd||i.length===this.maxSize||this.emptyCount>this.maxEmptyCount?i.length:e.total;void 0!==o&&this.size$.next(Math.min(o,null!==(n=this.maxSize)&&void 0!==n?n:1/0)),this.items$.next(i)}}var qn=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};class Wn{constructor(e,t,n,r,i){this.album=i,this.nextPageUrl=void 0,this.pager=new Hn((r=>qn(this,void 0,void 0,(function*(){const i=yield this.fetchNext(this.nextPageUrl||e,r?n?Object.assign(Object.assign({},n),{limit:r}):{limit:r}:n),o=t(i.data),a=this.createItems(o.items),s=o.total,l=!o.nextPageUrl;return this.nextPageUrl=o.nextPageUrl,{items:a,total:s,atEnd:l}}))),r)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetchNext(e,t){return qn(this,void 0,void 0,(function*(){const n=MusicKit.getInstance();return t&&(e=`${e}${e.includes("?")?"&":"?"}${new URLSearchParams(t)}`),n.api.music(e)}))}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){switch(e.type){case"playlists":case"library-playlists":return this.createMediaPlaylist(e);case"artists":case"library-artists":return this.createMediaArtist(e);case"albums":case"library-albums":return this.createMediaAlbum(e);case"songs":case"library-songs":case"music-videos":return this.createMediaItem(e)}}createMediaPlaylist(e){var t;const n=this.createFromLibrary(e),{id:r,kind:i}=n.playParams||{id:e.id,kind:"playlist"},o=null===(t=e.href)||void 0===t?void 0:t.startsWith("/v1/me/library/"),a=n.description;return{itemType:Gt.Playlist,src:`apple:${i}:${r}`,externalUrl:n.url||(o?`https://music.apple.com/library/playlist/${r}`:""),title:n.name,description:(null==a?void 0:a.standard)||(null==a?void 0:a.short),thumbnails:this.createThumbnails(e),owner:{name:n.curatorName||"",url:""},modifiedAt:Math.floor(new Date(n.lastModifiedDate).valueOf()/1e3)||void 0,pager:this.createPager(`${e.href}`,{include:"tracks,catalog","fields[library-playlists]":"playParams,name,artwork,url,tracks"}),unplayable:!n.playParams}}createMediaArtist(e){const t=this.createFromLibrary(e);return{itemType:Gt.Artist,src:`apple:artist:${e.id}`,externalUrl:t.url,title:t.name,thumbnails:this.createThumbnails(e),genres:this.getGenres(t),pager:this.createArtistAlbumsPager(e)}}createArtistTopTracks(e){const t=this.createFromLibrary(e);return{itemType:Gt.Album,src:`apple:top-tracks:${e.id}`,externalUrl:"",title:"Top Tracks",thumbnails:this.createThumbnails(e),artist:t.name,genres:this.getGenres(t),pager:this.createTopTracksPager(e)}}createMediaAlbum(e){const t=this.createFromLibrary(e),{id:n,kind:r}=t.playParams||{id:e.id,kind:"album"};return{itemType:Gt.Album,src:`apple:${r}:${n}`,externalUrl:t.url,title:t.name,thumbnails:this.createThumbnails(e),artist:t.artistName,trackCount:t.trackCount,genres:this.getGenres(t),year:new Date(t.releaseDate).getFullYear()||0,pager:this.createPager(e.href,{"include[library-songs]":"catalog","fields[library-songs]":"playParams,name,artistName,albumName,artwork"},void 0,t),unplayable:!t.playParams}}createMediaItem(e){const t=this.createFromLibrary(e),{id:n,kind:r}=t.playParams||{id:e.id,kind:"music-videos"===e.type?"musicVideo":"song"};return{itemType:Gt.Media,mediaType:"musicVideo"===r?Sn.Video:Sn.Audio,src:`apple:${r}:${n}`,externalUrl:t.url,title:t.name,thumbnails:this.createThumbnails(e),artists:[t.artistName],albumArtist:this.album?this.album.artistName:void 0,album:t.albumName,duration:t.durationInMillis/1e3,genres:this.getGenres(t),track:t.trackNumber,year:new Date(t.releaseDate).getFullYear()||void 0,isrc:t.isrc,unplayable:!t.playParams,playedAt:0}}createFromLibrary(e){var t,n,r;const i=null===(r=null===(n=null===(t=e.relationships)||void 0===t?void 0:t.catalog)||void 0===n?void 0:n.data)||void 0===r?void 0:r[0];return Object.assign(Object.assign({},null==i?void 0:i.attributes),e.attributes)}createThumbnails(e){var t;const n=null===(t=e.attributes)||void 0===t?void 0:t.artwork;return n?[this.createThumbnail(n,60),this.createThumbnail(n,120),this.createThumbnail(n,240),this.createThumbnail(n,480)]:void 0}createThumbnail(e,t){return{url:MusicKit.formatArtworkURL(e,t,t),width:t,height:t}}createArtistAlbumsPager(e){var t;const n=this.createArtistTopTracks(e),r=new Zt([n]),i=this.createPager((null===(t=e.relationships)||void 0===t?void 0:t.albums.href)||`/v1/catalog/{{storefrontId}}/artists/${e.id}/albums`);return new _n(r,i)}createTopTracksPager(e){return new Wn(e.href,(e=>{var t,n,r;const i=(null===(n=null===(t=e.data[0])||void 0===t?void 0:t.views)||void 0===n?void 0:n["top-songs"])||e,o=i.data||[],a=i.next;return{items:o,total:null===(r=i.meta)||void 0===r?void 0:r.total,nextPageUrl:a}}),{"limit[artists:top-songs]":"20",views:"top-songs"},{maxSize:20})}createPager(e,t,n,r){return new Wn(e,(e=>{var t,n,r;const i=(null===(n=null===(t=e.data[0])||void 0===t?void 0:t.relationships)||void 0===n?void 0:n.tracks)||e,o=i.data||[],a=i.next;return{items:o,total:null===(r=i.meta)||void 0===r?void 0:r.total,nextPageUrl:a}}),t,n,r)}getGenres({genreNames:e=[]}){return e.filter((e=>"Music"!==e))}}console.log("module::apple");const Yn={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},Kn={id:"apple/video",title:"Music Video",icon:"video",itemType:Gt.Media,searchable:!0,layout:Yn,defaultHidden:!0,search:({q:e=""}={})=>e?nr(Gt.Media,e,{types:"music-videos"},{maxSize:100}):new Zt},Xn={id:"apple/recommendations",title:"Recommended",icon:"playlists",itemType:Gt.Playlist,defaultHidden:!0,search:()=>new Wn("/v1/me/recommendations",(({data:e=[],next:t,meta:n})=>{const r=e.map((e=>e.relationships.contents.data.filter((e=>"playlists"===e.type)))).flat();return{items:r,total:null==n?void 0:n.total,nextPageUrl:t}}))},Gn={id:"apple/recently-played",title:"Recently Played",icon:"clock",itemType:Gt.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>new Wn("/v1/me/recent/played/tracks",rr,void 0,{pageSize:30})},Jn={id:"apple/library-songs",title:"My Songs",icon:"heart",itemType:Gt.Media,layout:Yn,defaultHidden:!0,search:()=>new Wn("/v1/me/library/songs",rr,{"include[library-songs]":"catalog","fields[library-songs]":"playParams,name,artistName,albumName,artwork"})},Qn={id:"apple/library-albums",title:"My Albums",icon:"heart",itemType:Gt.Album,search:()=>new Wn("/v1/me/library/albums",rr,{"include[library-albums]":"catalog","fields[library-albums]":"playParams,name,artistName,artwork"})},Zn={id:"apple/playlists",title:"Playlists",icon:"playlists",itemType:Gt.Playlist,search:()=>new Wn("/v1/me/library/playlists",rr,{"include[library-playlists]":"catalog","fields[library-playlists]":"playParams,name,artwork"})},er={id:"apple",name:"Apple Music",icon:"apple",url:"https://music.apple.com/",lookup:function(e,t,n=10,r){return i=this,o=void 0,s=function*(){if(!e||!t)return[];const i={pageSize:n,maxSize:n};return Qt(nr(Gt.Media,`${e} ${t}`,void 0,i),r)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function r(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,r)}l((s=s.apply(i,o||[])).next())}));var i,o,a,s},roots:[tr(Gt.Media,{title:"Songs",layout:Yn}),tr(Gt.Album,{title:"Albums"}),tr(Gt.Artist,{title:"Artists",layout:{view:"card compact",fields:["Thumbnail","Title","Genre"]}}),tr(Gt.Playlist,{title:"Playlists"})],sources:[Kn,Gn,Jn,Qn,Zn,Xn],observeIsLoggedIn:xn,isLoggedIn:wn,login:function(){return gn(this,void 0,void 0,(function*(){if(!wn())try{const e=yield kn(),t=yield e.authorize();bn.log("Access token successfully obtained."),yn.next(t)}catch(e){bn.log("Could not obtain access token."),bn.error(e)}}))},logout:function(){return gn(this,void 0,void 0,(function*(){yield MusicKit.getInstance().unauthorize(),yn.next("")}))}};function tr(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:String(e),icon:"search",searchable:!0,search:({q:t=""}={})=>nr(e,t)})}function nr(e,t,n,r){if(t){const i=Object.assign(Object.assign({},n),{term:t});if(!i.types)switch(e){case Gt.Media:i.types="songs";break;case Gt.Album:i.types="albums";break;case Gt.Artist:i.types="artists";break;case Gt.Playlist:i.types="playlists"}const o=i.types;return new Wn("/v1/catalog/{{storefrontId}}/search",(e=>{var t;const n=e.results[o]||{data:[]},r=n.next,i=null===(t=e.meta)||void 0===t?void 0:t.total;return{items:n.data,total:i,nextPageUrl:r}}),i,Object.assign({maxSize:250,pageSize:25},r))}return new Zt}function rr({data:e=[],next:t,meta:n}){return{items:e,total:null==n?void 0:n.total,nextPageUrl:t}}const ir=er;var or;!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(or||(or={}));const ar=new s("OffsetPager");class sr extends Vn{constructor(e,t){super(t),this.fetch=e,this.fetchStates={},this.size=0}connect(){this.subscriptions||(super.connect(),this.subscriptions.add(this.fetches$.pipe(Tt((({index:e})=>this.isInRange(e))),rt((({index:e,length:t})=>this.getPageNumbersFromIndex(e,t))),ot((e=>e)),ot((e=>this.fetchPage(e))),Rn((e=>(ar.error(e),this.error$.next(e),$t(void 0)))),Pt(this.observeComplete())).subscribe(ar)))}get pageSize(){return this.config.pageSize||20}fetchPage(e){return t=this,n=void 0,i=function*(){if(this.fetchStates[e]!==or.Fulfilled&&this.fetchStates[e]!==or.Pending){this.fetchStates[e]=or.Pending;try{const t=yield this.fetch(e,this.pageSize);this.fetchStates[e]=or.Fulfilled,this.insertPage(e,t)}catch(t){throw this.fetchStates[e]=or.Rejected,t}}},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(a,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}insertPage(e,t){var n;const r=this.items.slice(),i=Math.min(t.total,null!==(n=this.maxSize)&&void 0!==n?n:1/0),o=Math.ceil(i/this.pageSize),a=(e-1)*this.pageSize,s=e===o;if(r.length=s||t.items.length<this.pageSize?a:i,t.items.forEach(((e,t)=>r[t+a]=e)),r.length=Math.min(r.length,i),t.items.length===i)for(let e=0;e<=o;e++)this.fetchStates[e+1]=or.Fulfilled;this.size=i,this.size$.next(i),this.items$.next(r)}getPageNumbersFromIndex(e,t){const n=this.size,r=Math.max(Math.ceil(this.pageSize/2),t),i=Math.max(e-r,0),o=Math.min(e+r+t-1,0===n?this.maxSize?this.maxSize-1:1/0:n-1),a=this.getPageNumberFromIndex(i),s=this.getPageNumberFromIndex(o);if(a===s)return[a];{const e=[];for(let t=a;t<=s;t++)e.push(t);return e}}getPageNumberFromIndex(e){return Math.floor(e/this.pageSize)+1}isInRange(e){return 0===this.size?e>=0:e>=0&&e<this.size}}let lr=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")),"");const cr=new m("jellyfin"),ur={get host(){return cr.getString("host")},set host(e){cr.setString("host",e)},get device(){return"PC"},get deviceId(){let e=cr.getString("deviceId");return e||(e=lr(),cr.setString("deviceId",e)),e},get token(){return cr.getString("token")},set token(e){cr.setString("token",e)},get userId(){return cr.getString("userId")},set userId(e){cr.setString("userId",e)},clear(){cr.removeItem("userId"),cr.removeItem("token")}};var dr=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function mr(e,t){return dr(this,void 0,void 0,(function*(){const{device:n,deviceId:r,token:i}=ur;if(!i)throw Error("No access token.");return t.headers=Object.assign(Object.assign({},t.headers),{"X-Emby-Authorization":`MediaBrowser Client="ampcast", Version="0.7.3", Device="${n}", DeviceId="${r}", Token="${i}"`}),window.fetch(`${ur.host}/${e}`,t)}))}console.log("module::jellyfinApi");const fr={get:function(e,t){return dr(this,void 0,void 0,(function*(){return mr(`${e}?${new URLSearchParams(t)}`,{method:"GET"})}))},post:function(e,t){return dr(this,void 0,void 0,(function*(){const n=JSON.stringify(t);return mr(e,{method:"POST",headers:{"Content-Type":"application/json"},body:n})}))},getPlayableUrlFromSrc:function(e){const{host:t,userId:n,token:r,deviceId:i}=ur;if(t&&n&&r&&i){const[,,o]=e.split(":");return`${t}/Audio/${o}/universal?${new URLSearchParams({MaxStreamingBitrate:"140000000",MaxSampleRate:"48000",TranscodingProtocol:"hls",TranscodingContainer:"ts",Container:"opus,webm|opus,mp3,aac,m4a|aac,m4a|alac,m4b|aac,flac,webma,webm|webma,wav,ogg",AudioCodec:"aac",static:"true",UserId:n,api_key:r,DeviceId:i})}`}throw Error("Not logged in.")}},hr=fr;class pr{constructor(e,t={},n){this.path=e,this.params=t,this.pageSize=(null==n?void 0:n.pageSize)||100,this.pager=new sr((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},n))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){return t=this,n=void 0,i=function*(){const t=Object.assign(Object.assign({IncludeItemTypes:"Audio",Fields:"AudioInfo,Genres",Recursive:"true",ImageTypeLimit:"1",EnableImageTypes:"Primary"},this.params),{Limit:String(this.pageSize),StartIndex:String((e-1)*this.pageSize)}),n=yield hr.get(this.path,t);if(!n.ok)throw Error(`${n.status}: ${n.statusText}`);const{Items:r,TotalRecordCount:i}=yield n.json();return{items:r.map((e=>this.createItem(e))),total:i}},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(a,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}createItem(e){switch(e.Type){case"MusicArtist":return this.createMediaArtist(e);case"MusicAlbum":return this.createMediaAlbum(e);case"Playlist":return this.createMediaPlaylist(e);default:return this.createMediaItemFromTrack(e)}}createMediaArtist(e){return{itemType:Gt.Artist,src:`jellyfin:album:${e.Id}`,externalUrl:"",title:e.Name||"",genres:e.Genres||void 0,thumbnails:this.createThumbnails(e.Id),pager:this.createAlbumsPager(e)}}createMediaAlbum(e){var t,n;return{itemType:Gt.Album,src:`jellyfin:album:${e.Id}`,externalUrl:"",title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e.Id),trackCount:e.ChildCount||void 0,pager:this.createAlbumPager(e),artist:e.AlbumArtist||void 0,year:e.ProductionYear||void 0}}createMediaPlaylist(e){var t,n;return{itemType:Gt.Playlist,src:`jellyfin:playlist:${e.Id}`,externalUrl:"",title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e.Id),trackCount:e.ChildCount||void 0,pager:this.createPlaylistPager(e)}}createMediaItemFromTrack(e){var t,n,r;const i=(null===(t=e.ImageTags)||void 0===t?void 0:t.Primary)?e.Id:e.AlbumId;return{itemType:Gt.Media,mediaType:Sn.Audio,src:`jellyfin:audio:${e.Id}`,externalUrl:"",title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,year:e.ProductionYear||void 0,playedAt:(null===(n=e.UserData)||void 0===n?void 0:n.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(i),artists:e.Artists||(e.AlbumArtist?[e.AlbumArtist]:void 0),albumArtist:e.AlbumArtist||void 0,album:e.Album||void 0,track:e.Album&&e.IndexNumber||0}}createThumbnails(e){return e?[this.createThumbnail(e,60),this.createThumbnail(e,120),this.createThumbnail(e,240),this.createThumbnail(e,480)]:void 0}createThumbnail(e,t,n=t){return{url:`${ur.host}/Items/${e}/Images/Primary?fillWidth=${t}&fillHeight=${n}`,width:t,height:n}}createAlbumPager(e){return new pr(`Users/${ur.userId}/Items`,{ParentId:e.Id,SortBy:"SortName",SortOrder:"Ascending"})}createAlbumsPager(e){return new pr(`Users/${ur.userId}/Items`,{AlbumArtistIds:e.Id,IncludeItemTypes:"MusicAlbum",SortOrder:"Descending"})}createPlaylistPager(e){return new pr(`Playlists/${e.Id}/Items`,{UserId:ur.userId,MediaType:"Audio",Fields:"ChildCount"})}}function vr({name:e,className:t=""}){switch(t=`icon icon-${e} ${t}`,e){case"ampcast":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("circle",{cx:"12",cy:"12",r:"8",strokeWidth:"4",stroke:"orange",fill:"black"}),r.createElement("circle",{cx:"12",cy:"12",r:"2",stroke:"none",fill:"white"}));case"play":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"}));case"pause":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"}));case"stop":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"}));case"volume":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{className:"high medium",stroke:"none",d:"M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"}),r.createElement("path",{className:"medium",stroke:"none",d:"M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"}),r.createElement("path",{stroke:"none",d:"M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182L8 5.525A3.489 3.489 0 0 1 9.025 8 3.49 3.49 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"}));case"muted":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06zm7.137 2.096a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0z"}));case"prev":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z"}));case"next":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z"}));case"info":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}));case"settings":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}));case"album":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("circle",{cx:"12",cy:"12",r:"8.5",strokeWidth:"6.5",fill:"none"}),r.createElement("circle",{cx:"12",cy:"12",r:"2",stroke:"none"}));case"locked":return r.createElement("svg",{className:t,viewBox:"0 0 448 512",transform:"scale(0.95)"},r.createElement("path",{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"}));case"unlocked":return r.createElement("svg",{className:t,viewBox:"0 0 576 512",transform:"scale(0.95)"},r.createElement("path",{d:"M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"}));case"left":return r.createElement("svg",{className:t,viewBox:"0 0 320 512"},r.createElement("path",{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"}));case"right":return r.createElement("svg",{className:t,viewBox:"0 0 320 512"},r.createElement("path",{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"}));case"saved":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"}));case"unsaved":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM272 80v80H144V80h128zm122 352H54a6 6 0 0 1-6-6V86a6 6 0 0 1 6-6h42v104c0 13.255 10.745 24 24 24h176c13.255 0 24-10.745 24-24V83.882l78.243 78.243a6 6 0 0 1 1.757 4.243V426a6 6 0 0 1-6 6zM224 232c-48.523 0-88 39.477-88 88s39.477 88 88 88 88-39.477 88-88-39.477-88-88-88zm0 128c-22.056 0-40-17.944-40-40s17.944-40 40-40 40 17.944 40 40-17.944 40-40 40z"}));case"close":return r.createElement("svg",{className:t,viewBox:"0 0 64 64"},r.createElement("path",{d:"M 10.5,-0.5 C 12.1667,-0.5 13.8333,-0.5 15.5,-0.5C 20.7971,5.29805 26.2971,10.9647 32,16.5C 37.0314,10.303 42.5314,4.63636 48.5,-0.5C 49.8333,-0.5 51.1667,-0.5 52.5,-0.5C 55.8333,3.5 59.5,7.16667 63.5,10.5C 63.5,11.8333 63.5,13.1667 63.5,14.5C 57.7019,19.7971 52.0353,25.2971 46.5,31C 52.0353,36.7029 57.7019,42.2029 63.5,47.5C 63.5,49.1667 63.5,50.8333 63.5,52.5C 59.5,55.8333 55.8333,59.5 52.5,63.5C 50.8333,63.5 49.1667,63.5 47.5,63.5C 42.1604,57.8275 36.8271,52.1608 31.5,46.5C 25.479,51.8543 19.8123,57.521 14.5,63.5C 13.1667,63.5 11.8333,63.5 10.5,63.5C 7.16667,59.5 3.5,55.8333 -0.5,52.5C -0.5,50.8333 -0.5,49.1667 -0.5,47.5C 5.17254,42.1604 10.8392,36.8271 16.5,31.5C 10.8392,26.1729 5.17254,20.8396 -0.5,15.5C -0.5,13.8333 -0.5,12.1667 -0.5,10.5C 3.5,7.16667 7.16667,3.5 10.5,-0.5 Z"}));case"audio":return r.createElement("svg",{className:t,viewBox:"0 0 384 512"},r.createElement("path",{d:"M369.941 97.941l-83.882-83.882A48 48 0 0 0 252.118 0H48C21.49 0 0 21.49 0 48v416c0 26.51 21.49 48 48 48h288c26.51 0 48-21.49 48-48V131.882a48 48 0 0 0-14.059-33.941zM332.118 128H256V51.882L332.118 128zM48 464V48h160v104c0 13.255 10.745 24 24 24h104v288H48zm144-76.024c0 10.691-12.926 16.045-20.485 8.485L136 360.486h-28c-6.627 0-12-5.373-12-12v-56c0-6.627 5.373-12 12-12h28l35.515-36.947c7.56-7.56 20.485-2.206 20.485 8.485v135.952zm41.201-47.13c9.051-9.297 9.06-24.133.001-33.439-22.149-22.752 12.235-56.246 34.395-33.481 27.198 27.94 27.212 72.444.001 100.401-21.793 22.386-56.947-10.315-34.397-33.481z"}));case"video":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{fillRule:"evenodd",d:"M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z"}));case"note":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("path",{stroke:"none",d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"}));case"star":return r.createElement("svg",{className:t,viewBox:"0 0 576 512"},r.createElement("path",{d:"M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z"}));case"heart":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"}));case"thumbs-up":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z"}));case"person":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"}));case"most-played":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M2 3a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 0-1h-11A.5.5 0 0 0 2 3zm2-2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7A.5.5 0 0 0 4 1zm2.765 5.576A.5.5 0 0 0 6 7v5a.5.5 0 0 0 .765.424l4-2.5a.5.5 0 0 0 0-.848l-4-2.5z"}),r.createElement("path",{stroke:"none",d:"M1.5 14.5A1.5 1.5 0 0 1 0 13V6a1.5 1.5 0 0 1 1.5-1.5h13A1.5 1.5 0 0 1 16 6v7a1.5 1.5 0 0 1-1.5 1.5h-13zm13-1a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5h-13A.5.5 0 0 0 1 6v7a.5.5 0 0 0 .5.5h13z"}));case"clock":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"}));case"search":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M15.504 13.616l-3.79-3.223c-0.392-0.353-0.811-0.514-1.149-0.499 0.895-1.048 1.435-2.407 1.435-3.893 0-3.314-2.686-6-6-6s-6 2.686-6 6 2.686 6 6 6c1.486 0 2.845-0.54 3.893-1.435-0.016 0.338 0.146 0.757 0.499 1.149l3.223 3.79c0.552 0.613 1.453 0.665 2.003 0.115s0.498-1.452-0.115-2.003zM6 10c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"}));case"recently-added":return r.createElement("svg",{className:t,viewBox:"0 0 384 512"},r.createElement("path",{d:"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48z"}),r.createElement("rect",{x:"177",y:"220",width:"40",height:"210",strokeWidth:"20",strokeLinejoin:"round"}),r.createElement("rect",{x:"87",y:"310",width:"210",height:"40",strokeWidth:"20",strokeLinejoin:"round"}));case"playlists":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M88 48C101.3 48 112 58.75 112 72V120C112 133.3 101.3 144 88 144H40C26.75 144 16 133.3 16 120V72C16 58.75 26.75 48 40 48H88zM480 64C497.7 64 512 78.33 512 96C512 113.7 497.7 128 480 128H192C174.3 128 160 113.7 160 96C160 78.33 174.3 64 192 64H480zM480 224C497.7 224 512 238.3 512 256C512 273.7 497.7 288 480 288H192C174.3 288 160 273.7 160 256C160 238.3 174.3 224 192 224H480zM480 384C497.7 384 512 398.3 512 416C512 433.7 497.7 448 480 448H192C174.3 448 160 433.7 160 416C160 398.3 174.3 384 192 384H480zM16 232C16 218.7 26.75 208 40 208H88C101.3 208 112 218.7 112 232V280C112 293.3 101.3 304 88 304H40C26.75 304 16 293.3 16 280V232zM88 368C101.3 368 112 378.7 112 392V440C112 453.3 101.3 464 88 464H40C26.75 464 16 453.3 16 440V392C16 378.7 26.75 368 40 368H88z"}));case"file":case"blob":return r.createElement("svg",{className:t,viewBox:"0 0 448 512",transform:"scale(0.875)"},r.createElement("path",{fill:"#00cccc",d:"M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"}));case"apple":return r.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.1) translate(0,-1)"},r.createElement("path",{fillRule:"nonzero",d:"M11.624 7.222c-.876 0-2.232-.996-3.66-.96-1.884.024-3.612 1.092-4.584 2.784-1.956 3.396-.504 8.412 1.404 11.172.936 1.344 2.04 2.856 3.504 2.808 1.404-.06 1.932-.912 3.636-.912 1.692 0 2.172.912 3.66.876 1.512-.024 2.472-1.368 3.396-2.724 1.068-1.56 1.512-3.072 1.536-3.156-.036-.012-2.94-1.128-2.976-4.488-.024-2.808 2.292-4.152 2.4-4.212-1.32-1.932-3.348-2.148-4.056-2.196-1.848-.144-3.396 1.008-4.26 1.008zm3.12-2.832c.78-.936 1.296-2.244 1.152-3.54-1.116.048-2.46.744-3.264 1.68-.72.828-1.344 2.16-1.176 3.432 1.236.096 2.508-.636 3.288-1.572z"}));case"plex":return r.createElement("svg",{className:t,viewBox:"0 0 122.88 122.88"},r.createElement("path",{className:"icon-plex-outer",d:"M18.43,0h86.02c10.18,0,18.43,8.25,18.43,18.43v86.02c0,10.18-8.25,18.43-18.43,18.43H18.43 C8.25,122.88,0,114.63,0,104.45l0-86.02C0,8.25,8.25,0,18.43,0L18.43,0z"}),r.createElement("polygon",{className:"icon-plex-inner",points:"61.44,16.8 35.52,16.8 61.44,61.44 35.52,106.08 61.44,106.08 87.36,61.44 61.44,16.8"}));case"jellyfin":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("defs",null,r.createElement("linearGradient",{id:"jellyfin-linear-gradient",gradientUnits:"userSpaceOnUse",x1:"110.25",y1:"213.3",x2:"496.14",y2:"436.09"},r.createElement("stop",{offset:"0",style:{stopColor:"#aa5cc3"}}),r.createElement("stop",{offset:"1",style:{stopColor:"#00a4dc"}}))),r.createElement("path",{d:"M256,201.6c-20.4,0-86.2,119.3-76.2,139.4s142.5,19.9,152.4,0S276.5,201.6,256,201.6z"}),r.createElement("path",{d:"M256,23.3c-61.6,0-259.8,359.4-229.6,420.1s429.3,60,459.2,0S317.6,23.3,256,23.3z M406.5,390.8c-19.6,39.3-281.1,39.8-300.9,0s110.1-275.3,150.4-275.3S426.1,351.4,406.5,390.8z"}));case"spotify":return r.createElement("svg",{className:t,viewBox:"0 0 168 168"},r.createElement("path",{stroke:"none",d:"m83.996 0.277c-46.249 0-83.743 37.493-83.743 83.742 0 46.251 37.494 83.741 83.743 83.741 46.254 0 83.744-37.49 83.744-83.741 0-46.246-37.49-83.738-83.745-83.738l0.001-0.004zm38.404 120.78c-1.5 2.46-4.72 3.24-7.18 1.73-19.662-12.01-44.414-14.73-73.564-8.07-2.809 0.64-5.609-1.12-6.249-3.93-0.643-2.81 1.11-5.61 3.926-6.25 31.9-7.291 59.263-4.15 81.337 9.34 2.46 1.51 3.24 4.72 1.73 7.18zm10.25-22.805c-1.89 3.075-5.91 4.045-8.98 2.155-22.51-13.839-56.823-17.846-83.448-9.764-3.453 1.043-7.1-0.903-8.148-4.35-1.04-3.453 0.907-7.093 4.354-8.143 30.413-9.228 68.222-4.758 94.072 11.127 3.07 1.89 4.04 5.91 2.15 8.976v-0.001zm0.88-23.744c-26.99-16.031-71.52-17.505-97.289-9.684-4.138 1.255-8.514-1.081-9.768-5.219-1.254-4.14 1.08-8.513 5.221-9.771 29.581-8.98 78.756-7.245 109.83 11.202 3.73 2.209 4.95 7.016 2.74 10.733-2.2 3.722-7.02 4.949-10.73 2.739z"}));case"lastfm":return r.createElement("svg",{className:t,viewBox:"0 0 455 455"},r.createElement("rect",{className:"icon-lastfm-inner",x:"5",y:"5",width:"445",height:"445"}),r.createElement("path",{className:"icon-lastfm-outer",fillRule:"evenodd",clipRule:"evenodd",d:"M0,0v455h455V0H0z M309.94,315.01c-62.425,0-84.085-28.145-95.625-63.145 L202.77,215.77c-8.65-26.33-18.75-46.915-50.505-46.915c-22.035,0-44.395,15.88-44.395,60.275c0,34.63,17.695,56.29,42.575,56.29 c28.145,0,46.915-20.94,46.915-20.94l11.565,31.385c0,0-19.495,19.125-60.275,19.125c-50.51,0-78.65-29.57-78.65-84.435 c0-56.99,28.14-90.565,81.19-90.565c47.99,0,72.165,17.325,87.305,64.235L250.41,240.3c8.65,26.35,23.805,45.47,60.25,45.47 c24.555,0,37.52-5.41,37.52-18.77c0-10.45-6.13-18.025-24.53-22.365l-24.53-5.76c-29.94-7.225-41.855-22.735-41.855-47.265 c0-39.335,31.755-51.6,64.215-51.6c36.82,0,59.18,13.34,62.07,45.82l-36.07,4.335c-1.445-15.53-10.82-22.015-28.145-22.015 c-15.88,0-25.625,7.21-25.625,19.475c0,10.84,4.685,17.325,20.565,20.94l23.085,5.055c31.035,7.21,47.64,22.365,47.64,51.585 C385,301.295,354.685,315.01,309.94,315.01z"}));case"listenbrainz":case"musicbrainz":return r.createElement("svg",{className:t,viewBox:"0 0 27 30"},r.createElement("polygon",{className:`icon-${e}-left`,stroke:"none",points:"13 1 1 8 1 22 13 29 13 1"}),r.createElement("polygon",{className:`icon-${e}-right`,stroke:"none",points:"14 1 26 8 26 22 14 29 14 1"}));case"youtube":return r.createElement("svg",{className:t,viewBox:"0 0 576 512",transform:"scale(1.125)"},r.createElement("rect",{className:"icon-youtube-inner",x:"144",y:"128",width:"288",height:"256"}),r.createElement("path",{className:"icon-youtube-outer",d:"M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"}));case"lookup-pending":return r.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 16 16"},r.createElement("circle",{className:"icon-lookup-outer",cx:"8",cy:"8",r:"8",stroke:"none"}),r.createElement("path",{className:"icon-lookup-inner",d:"M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"}));case"lookup-looking":return r.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 100 100"},r.createElement("circle",{className:"icon-lookup-outer",cx:"50",cy:"50",r:"50",stroke:"none"}),r.createElement("path",{className:"icon-lookup-inner",d:"M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50"},r.createElement("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"1s",from:"0 50 50",to:"360 50 50",repeatCount:"indefinite"})));case"lookup-not-found":return r.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 16 16",transform:"rotate(45)"},r.createElement("circle",{className:"icon-lookup-outer",cx:"8",cy:"8",r:"8",stroke:"none"}),r.createElement("path",{className:"icon-lookup-inner",d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}))}}pr.minPageSize=10,pr.maxPageSize=1e3;var gr=n(908);const br={left:0,top:0},yr=(0,r.forwardRef)((function(e,t){var{title:n,className:i="",children:o,onClose:a}=e,s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["title","className","children","onClose"]);const l=(0,r.useRef)(null),[c,u]=(0,r.useState)(br),[d,m]=(0,r.useState)(null),[f,h]=(0,r.useState)(br);(0,r.useImperativeHandle)(t,(()=>({close:e=>{l.current.open&&l.current.close(e)}}))),(0,r.useEffect)((()=>{const e=l.current;gr.Z.registerDialog(e),e.showModal()}),[]);const p=(0,r.useCallback)((()=>{l.current.close()}),[]),v=(0,r.useCallback)((()=>{a(l.current.returnValue)}),[a]),g=(0,r.useCallback)((e=>{let t=e.target;for(;t&&"submit"!==t.type;)t=t.parentElement;"#cancel"===(null==t?void 0:t.value)&&(e.preventDefault(),l.current.close())}),[]),b=(0,r.useCallback)((e=>{e.preventDefault(),0===e.button&&m({left:e.screenX,top:e.screenY})}),[]),y=(0,r.useCallback)((e=>{h({left:e.screenX-d.left,top:e.screenY-d.top})}),[d]),w=(0,r.useCallback)((e=>{u({left:c.left+(e.screenX-d.left),top:c.top+(e.screenY-d.top)}),h(br),m(null)}),[c,d]);return(0,r.useEffect)((()=>{if(d)return document.documentElement.style.cursor="default",document.body.classList.add("dragging"),document.addEventListener("mouseup",w),document.addEventListener("mousemove",y),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",w),document.removeEventListener("mousemove",y)}}),[d,y,w]),r.createElement("dialog",Object.assign({},s,{className:`dialog ${i}`,onClose:v,style:{transform:`translate(${c.left+f.left}px, ${c.top+f.top}px)`},ref:l}),r.createElement("header",{className:"dialog-head",onMouseDown:b},r.createElement("h2",null,n),r.createElement("button",{onClick:p,onMouseDown:M},r.createElement(vr,{name:"close"}))),r.createElement("div",{className:"dialog-body",onClick:g},o))}));function wr(e,t=!1){return n=this,o=void 0,s=function*(){return new Promise(((n,o)=>{const a=document.getElementById("popup"),s=document.getElementById("system"),l=document.createElement("div"),c=(0,i.s)(l);try{const i=e=>{c.unmount(),l.remove(),n(e)};(t?s:a).append(l),c.render(r.createElement(e,{onClose:i}))}catch(e){c.unmount(),l.remove(),o(e)}}))},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{l(s.next(e))}catch(e){t(e)}}function i(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(r,i)}l((s=s.apply(n,o||[])).next())}));var n,o,a,s}var xr=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function kr(e){const t=(0,r.useRef)(null),n=(0,r.useRef)(null),i=(0,r.useRef)(null),o=(0,r.useRef)(null),a=(0,r.useRef)(null),s=(0,r.useCallback)((()=>xr(this,void 0,void 0,(function*(){try{const e=i.current.value,r=o.current.value;ur.host=n.current.value.replace(/\/+$/,"");const{device:a,deviceId:s}=ur,l=`MediaBrowser Client="ampcast", Version="0.7.3", Device="${a}", DeviceId="${s}"`,c=yield fetch(`${ur.host}/Users/AuthenticateByName`,{method:"POST",headers:{"Content-Type":"application/json","X-Emby-Authorization":l},body:JSON.stringify({Username:e,Pw:r})});if(!c.ok)throw Error(`${c.status}: ${c.statusText}`);const u=yield c.json(),d=u.User.Id,m=u.AccessToken;t.current.close(JSON.stringify({userId:d,token:m}))}catch(e){console.error(e)}}))),[]),l=(0,r.useCallback)((e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),e.repeat||a.current.click())}),[]),c=(0,r.useCallback)((e=>{e.preventDefault(),s()}),[s]);return r.createElement(yr,Object.assign({},e,{className:"jellyfin-login-dialog",title:"Login to Jellyfin",ref:t}),r.createElement("form",{method:"dialog",onKeyDown:l,onSubmit:c},r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("label",{htmlFor:"jellyfin-host"},"Host:"),r.createElement("input",{type:"url",id:"jellyfin-host",defaultValue:ur.host,placeholder:"https://",ref:n,required:!0})),r.createElement("p",null,r.createElement("label",{htmlFor:"jellyfin-username"},"User:"),r.createElement("input",{type:"text",id:"jellyfin-username",autoFocus:!0,ref:i,required:!0})),r.createElement("p",null,r.createElement("label",{htmlFor:"jellyfin-password"},"Password:"),r.createElement("input",{type:"password",id:"jellyfin-password",ref:o,required:!0}))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{value:"#cancel"},"Cancel"),r.createElement("button",{ref:a},"Login"))))}var Er=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::jellyfinAuth");const Sr=new s("jellyfinAuth"),Cr=new rn("");function Tr(){return""!==Cr.getValue()}function Ar(){return Cr.pipe(on()).pipe(rt((e=>""!==e)),on())}function Pr(e){ur.token=e,e&&Sr.log("Access token successfully obtained."),Cr.next(e)}Pr(ur.token);console.log("module::jellyfin");const Ir="jellyfin",zr={view:"details",fields:["Artist","Title","Album","Track","Duration","Genre","PlayCount"]},Mr={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","PlayCount"]},Nr={id:"jellyfin/liked-songs",title:"Liked Songs",icon:"heart",itemType:Gt.Media,layout:zr,search:()=>Fr({Filters:"IsFavorite"})},Or={id:"jellyfin/liked-albums",title:"Liked Albums",icon:"heart",itemType:Gt.Album,search:()=>Fr({Filters:"IsFavorite",IncludeItemTypes:"MusicAlbum"})},$r={id:"jellyfin/recently-played",title:"Recently Played",icon:"clock",itemType:Gt.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>Fr({SortBy:"DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},jr={id:"jellyfin/most-played",title:"Most Played",icon:"most-played",itemType:Gt.Media,layout:zr,search:()=>Fr({SortBy:"PlayCount,DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},_r={id:"jellyfin/playlists",title:"Playlists",icon:"playlists",itemType:Gt.Playlist,layout:{view:"card compact",fields:["Thumbnail","Title","TrackCount"]},secondaryLayout:Mr,search:()=>Fr({SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Playlist"})},Rr={id:Ir,icon:Ir,name:"Jellyfin",url:"https://jellyfin.org/",lookup:function(e,t,n=10,r){return i=this,o=void 0,s=function*(){if(!e||!t)return[];const i={pageSize:n,maxSize:n};return Qt(Lr(Gt.Media,t,{Artists:e},i),r)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function r(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,r)}l((s=s.apply(i,o||[])).next())}));var i,o,a,s},roots:[Dr(Gt.Media,{title:"Songs"}),Dr(Gt.Album,{title:"Albums"}),Dr(Gt.Artist,{title:"Artists"}),Dr(Gt.Playlist,{title:"Playlists",secondaryLayout:Mr})],sources:[jr,$r,Nr,Or,_r],observeIsLoggedIn:Ar,isLoggedIn:Tr,login:function(){return Er(this,void 0,void 0,(function*(){if(!Tr())try{const e=yield function(){return xr(this,void 0,void 0,(function*(){return wr(kr,!0)}))}();if(e){const{userId:t,token:n}=JSON.parse(e);ur.userId=t,Pr(n)}}catch(e){Sr.log("Could not obtain access token."),Sr.error(e)}}))},logout:function(){return Er(this,void 0,void 0,(function*(){Pr(""),ur.clear()}))}};function Dr(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:String(e),icon:"search",searchable:!0,search:({q:t=""}={})=>Lr(e,t)})}function Lr(e,t,n,r){if(t){const i=Object.assign(Object.assign({},n),{SearchTerm:t});if(e===Gt.Artist)return new pr("Artists",i,r);switch(e){case Gt.Media:i.IncludeItemTypes="Audio";break;case Gt.Album:i.IncludeItemTypes="MusicAlbum";break;case Gt.Playlist:i.IncludeItemTypes="Playlist"}return Fr(i,r)}return new Zt}function Fr(e,t){return new pr(`Users/${ur.userId}/Items`,e,t)}const Br=Rr;var Vr=n(2568),Ur=n.n(Vr);const Hr=new m("lastfm"),qr={get token(){return Hr.getString("token")},set token(e){Hr.setString("token",e)},get userId(){return Hr.getString("userId")},set userId(e){Hr.setString("userId",e)},get sessionKey(){return Hr.getString("sessionKey")},set sessionKey(e){Hr.setString("sessionKey",e)},get firstScrobbledAt(){return Hr.getString("firstScrobbledAt")},set firstScrobbledAt(e){Hr.setString("firstScrobbledAt",e)},get playCount(){return Hr.getNumber("playCount")},set playCount(e){Hr.setNumber("playCount",e)},get removeDuplicates(){return Hr.getBoolean("removeDuplicates")},set removeDuplicates(e){Hr.setBoolean("removeDuplicates",e)},clear(){Hr.clear()}};var Wr=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::lastfmAuth");const Yr=new s("lastfmAuth"),Kr=new rn(""),Xr=new rn("");function Gr(){return""!==Kr.getValue()}function Jr(){return Kr.pipe(on()).pipe(rt((e=>""!==e)),on())}function Qr(e){const t=Object.keys(e);let n="";return t.sort(),t.forEach((t=>n+=t+e[t])),n+=cn,Ur()(n)}Xr.next(qr.sessionKey),Kr.next(qr.token);var Zr=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::lastfmApi");const ei=new s("lastfmApi"),ti=new class{constructor(){this.host="https://ws.audioscrobbler.com/2.0"}scrobble(e){return Zr(this,void 0,void 0,(function*(){ei.log("scrobble",{items:e});const t="track.scrobble";if(1===e.length){const n=e[0],r=String(n.playedAt);yield this.post(Object.assign({method:t,timestamp:r},this.getScrobbleParams(n)))}else if(e.length>0){const n={};e.forEach(((e,t)=>{const r=this.getScrobbleParams(e);n[`timestamp[${t}]`]=String(e.playedAt),Object.keys(r).forEach((e=>{n[`${e}[${t}]`]=r[e]}))})),yield this.post(Object.assign({method:t},n))}}))}updateNowPlaying(e){return Zr(this,void 0,void 0,(function*(){ei.log("updateNowPlaying",{item:e});try{this.canScrobble(e)&&(yield this.post(Object.assign({method:"track.updateNowPlaying"},this.getScrobbleParams(e))))}catch(t){ei.log('Failed to update "now playing":',{item:e}),ei.error(t)}}))}getUserInfo(){return Zr(this,void 0,void 0,(function*(){return this.get({method:"user.getInfo",user:qr.userId})}))}get(e){return Zr(this,void 0,void 0,(function*(){const t=`${this.host}?${new URLSearchParams(Object.assign(Object.assign({},e),{api_key:ln,format:"json"}))}`,n=yield fetch(t,{method:"GET"});if(!n.ok)throw n;return n.json()}))}post(e){return Zr(this,void 0,void 0,(function*(){const t=qr.token,n=qr.sessionKey,r=Qr(e=Object.assign(Object.assign({},e),{api_key:ln,token:t,sk:n})),i=`${new URLSearchParams(e)}&api_sig=${r}`;return fetch(this.host,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i})}))}getScrobbleParams(e){const t={};return t.track=e.title,t.artist=e.artists[0],e.album&&(t.album=e.album),e.albumArtist&&(t.albumArtist=e.albumArtist),e.duration&&(t.duration=String(Math.round(e.duration))),e.track&&(t.trackNumber=String(e.track)),e.recording_mbid&&(t.mbid=e.recording_mbid),t}canScrobble(e){var t;return!!e&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30}},ni=ti;class ri{constructor(e,t,n,r){this.album=r,this.defaultConfig={minPageSize:ri.minPageSize,maxPageSize:ri.maxPageSize,pageSize:50},this.pageNumber=1,this.playCountName="playcount";const i=Object.assign(Object.assign({},this.defaultConfig),n),{page:o}=e,a=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["page"]);this.pageNumber=Number(o)||1,this.playCountName=i.playCountName||"playcount",this.pager=new Hn(((e=this.defaultConfig.pageSize)=>{return n=this,r=void 0,o=function*(){const n=this.pageNumber,r=yield ni.get(Object.assign(Object.assign({},a),{page:n,limit:e}));this.pageNumber++;const{items:i,total:o,atEnd:s,itemType:l}=t(r);return{items:this.createMediaObjects(l,i),total:o,atEnd:s}},new((i=void 0)||(i=Promise))((function(e,t){function a(e){try{l(o.next(e))}catch(e){t(e)}}function s(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(a,s)}l((o=o.apply(n,r||[])).next())}));var n,r,i,o}),i)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createMediaObjects(e,t){switch(e){case Gt.Artist:return t.map((e=>this.createMediaArtist(e)));case Gt.Album:return t.map((e=>this.createMediaAlbum(e)));case Gt.Media:return t.map((e=>this.createMediaItem(e)));case Gt.Playlist:return[]}}createMediaItem(e){var t,n,r,i,o,a;const s=e.date&&Number(e.date.uts)||0,l=null===(t=e["@attr"])||void 0===t?void 0:t.rank;return Object.assign(Object.assign({},this.createMediaObject(Gt.Media,e)),{mediaType:Sn.Audio,src:s?`lastfm:listen:${s}`:`lastfm:track:${lr()}`,artists:e.artist?[e.artist.name]:void 0,album:(null===(n=this.album)||void 0===n?void 0:n.name)||(null===(r=e.album)||void 0===r?void 0:r["#text"]),albumArtist:null===(i=this.album)||void 0===i?void 0:i.artist.name,release_mbid:(null===(o=this.album)||void 0===o?void 0:o.mbid)||(null===(a=e.album)||void 0===a?void 0:a.mbid),duration:Number(e.duration)||0,track:l&&Number(l)||void 0,playedAt:s})}createMediaAlbum(e){var t;return Object.assign(Object.assign({},this.createMediaObject(Gt.Album,e)),{src:`lastfm:album:${lr()}`,artist:e.artist.name,year:(null===(t=e.wiki)||void 0===t?void 0:t.published)&&new Date(e.wiki.published).getFullYear()||void 0,pager:this.createAlbumPager(e)})}createMediaArtist(e){return Object.assign(Object.assign({},this.createMediaObject(Gt.Artist,e)),{src:`lastfm:artist:${lr()}`,pager:this.createArtistAlbumsPager(e)})}createArtistTopTracks(e){return{itemType:Gt.Album,title:"Top Tracks",thumbnails:this.createThumbnails(e.image),src:`lastfm:top-tracks:${lr()}`,externalUrl:"",artist:e.name,pager:this.createTopTracksPager(e)}}createMediaObject(e,t){return{itemType:e,title:t.name,rating:"loved"in t?Number(t.loved)||0:void 0,playCount:Number(t[this.playCountName])||void 0,globalPlayCount:"userplaycount"===this.playCountName&&Number(t.playcount)||void 0,thumbnails:this.createThumbnails(t.image),externalUrl:t.url||""}}createThumbnails(e){const t=e?[this.createThumbnail(e[0],34),this.createThumbnail(e[1],64),this.createThumbnail(e[2],174),this.createThumbnail(e[3],300)].filter(x):[];return 0===t.length?void 0:t}createThumbnail(e,t,n=t){if(e){const r=e["#text"];if(r&&!r.endsWith("2a96cbd8b46e442fc41c2b86b821562f.png"))return{url:r,width:t,height:n}}}createArtistAlbumsPager(e){const t=this.createArtistTopTracks(e),n=new Zt([t]),r=new ri({method:"artist.getTopAlbums",artist:e.name},(({topalbums:e})=>{const t=e["@attr"];return{items:e.album,total:Number(t.total)||void 0,atEnd:t.page===t.totalPages,itemType:Gt.Album}}),{maxSize:100,playCountName:"userplaycount"});return new _n(n,r)}createAlbumPager(e){return new ri({method:"album.getInfo",album:e.name,artist:e.artist.name,user:qr.userId},(({album:e})=>{if(e.tracks){const t=e.tracks.track,n=(t?Array.isArray(t)?t:[t]:[]).map((t=>Object.assign(Object.assign({},t),{album:{"#text":e.name},image:t.image||e.image})));return{items:n,total:n.length,atEnd:!0,itemType:Gt.Media}}throw Error("No track info")}),{playCountName:"userplaycount"},e)}createTopTracksPager(e){return new ri({method:"artist.getTopTracks",artist:e.name},(({toptracks:e})=>{const t=e["@attr"];return{items:e.track,total:Number(t.total)||void 0,atEnd:t.page===t.totalPages,itemType:Gt.Media}}),{maxSize:20})}}ri.minPageSize=10,ri.maxPageSize=200;class ii extends ri{constructor(e,t){super(Object.assign(Object.assign({},e),{method:"user.getRecentTracks",extended:"1",user:qr.userId}),(({recenttracks:e})=>{var t,n;const r=e["@attr"]||{},i=e.track,o=i?Array.isArray(i)?i:[i]:[],a="true"===(null===(n=null===(t=o[0])||void 0===t?void 0:t["@attr"])||void 0===n?void 0:n.nowplaying),s=Number(r.page)||1,l=Number(r.totalPages)||1,c=1===l||s===l,u=Number(r.total)||void 0;return a&&o.shift(),{items:o,total:u,atEnd:c,itemType:Gt.Media}}),t)}}console.log("module::lastfm");const oi={view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},ai={view:"details",fields:["Index","Title","Artist"]},si={id:"lastfm/history",title:"History",icon:"clock",itemType:Gt.Media,defaultHidden:!0,search:({startAt:e=0}={})=>new ii(e?{to:e}:void 0)},li={id:"lastfm/recently-played",title:"Recently Played",icon:"clock",itemType:Gt.Media,search:()=>new ii},ci={id:"lastfm/loved-tracks",title:"Loved Tracks",icon:"heart",itemType:Gt.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear"]},defaultHidden:!0,search:()=>new ri({method:"user.getLovedTracks",user:qr.userId},(({lovedtracks:e})=>{const t=e["@attr"]||{},n=e.track,r=n?Array.isArray(n)?n:[n]:[],i=Number(t.page)||1,o=Number(t.totalPages)||1,a=1===o||i===o;return{items:r,total:Number(t.total)||void 0,atEnd:a,itemType:Gt.Media}}))};function ui(e,t){return Object.assign(Object.assign({},t),{id:`lastfm/top/${e.slice(11).toLowerCase()}`,icon:"star",searchable:!1,search:({period:n="overall"}={})=>new ri({method:e,period:n,user:qr.userId},(n=>{const[,r]=e.toLowerCase().split("."),i=n[r.slice(3)],o=i["@attr"],a=i[r.slice(6,-1)],s=Number(o.page)||1,l=Number(o.totalPages)||1,c=1===l||s===l;return{items:a,total:Number(o.total)||void 0,atEnd:c,itemType:t.itemType}}))})}const di={id:"lastfm",name:"last.fm",icon:"lastfm",url:"https://www.last.fm/",scrobbler:!0,roots:[li],sources:[ui("user.getTopTracks",{title:"Top Tracks",itemType:Gt.Media,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","PlayCount"]}}),ui("user.getTopAlbums",{title:"Top Albums",itemType:Gt.Album,layout:oi,secondaryLayout:ai}),ui("user.getTopArtists",{title:"Top Artists",itemType:Gt.Artist,layout:{view:"card minimal",fields:["Thumbnail","Title","PlayCount"]},secondaryLayout:oi,tertiaryLayout:ai}),si,ci],observeIsLoggedIn:Jr,isLoggedIn:Gr,login:function(){return Wr(this,void 0,void 0,(function*(){if(!Gr())try{const e=yield function(){return Wr(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const n=location.hostname,r=("localhost"===n?`http://${n}:${location.port}`:`https://${n}`)+"/auth/lastfm/callback/";let i=null;const o=n=>{if(/(localhost|ampcast)/.test(n.origin)){if(clearInterval(a),window.removeEventListener("message",o,!1),null==i||i.close(),i=null,n.origin!==location.origin)return void t({message:`Origin ${n.origin} does not match ${location.origin}`});e(n.data.token)}};window.addEventListener("message",o,!1),i=window.open(`https://www.last.fm/api/auth?api_key=${ln}&cb=${r}`,"last.fm","popup");const a=setInterval((()=>{(null==i?void 0:i.closed)&&(clearInterval(a),t({message:"access_denied"}))}),500)}))}))}(),t=yield function(e){return Wr(this,void 0,void 0,(function*(){const t="auth.getSession",n=Qr({api_key:ln,token:e,method:t}),r=yield fetch(`https://ws.audioscrobbler.com/2.0?method=${t}&api_key=${ln}&token=${e}&api_sig=${n}&format=json`);if(!r.ok)throw r;const{session:i}=yield r.json();return qr.userId=i.name,qr.token=e,qr.sessionKey=i.key,i.key}))}(e);Yr.log("Access token successfully obtained."),Xr.next(t),Kr.next(e)}catch(e){Yr.log("Could not obtain access token."),Yr.error(e)}}))},logout:function(){return Wr(this,void 0,void 0,(function*(){qr.clear(),Xr.next(""),Kr.next("")}))}};function mi(e){var{href:t,children:n=t}=e,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["href","children"]);return r.createElement("span",{className:"external-link"},r.createElement("a",Object.assign({},i,{href:t,target:"_blank",rel:"noopener"}),n))}const fi=new m("listenbrainz"),hi={get token(){return fi.getString("token")},set token(e){fi.setString("token",e)},get userId(){return fi.getString("userId")},set userId(e){fi.setString("userId",e)},get firstScrobbledAt(){return fi.getString("firstScrobbledAt")},set firstScrobbledAt(e){fi.setString("firstScrobbledAt",e)},clear(){fi.clear()}};var pi=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function vi(e){const t=(0,r.useRef)(null),n=(0,r.useRef)(null),i=(0,r.useRef)(null),o=(0,r.useRef)(null),a="https://listenbrainz.org/profile/",s=(0,r.useCallback)((()=>pi(this,void 0,void 0,(function*(){try{const e=n.current.value,r=i.current.value;hi.userId=e;const o=yield fetch("https://api.listenbrainz.org/1/validate-token",{headers:{"Content-Type":"application/json",Authorization:`Token ${r}`}});if(!o.ok)throw o;const{valid:a,user_name:s}=yield o.json();if(!a)throw Error("Invalid token.");if(s!==e)throw Error("Token not valid for this user.");t.current.close(JSON.stringify({userId:e,token:r}))}catch(e){console.error(e)}}))),[]),l=(0,r.useCallback)((e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),e.repeat||o.current.click())}),[]),c=(0,r.useCallback)((e=>{e.preventDefault(),s()}),[s]);return r.createElement(yr,Object.assign({},e,{className:"listenbrainz-login-dialog",title:"Login to ListenBrainz",ref:t}),r.createElement("form",{method:"dialog",onKeyDown:l,onSubmit:c},r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("label",{htmlFor:"listenbrainz-username"},"User:"),r.createElement("input",{type:"text",id:"listenbrainz-username",autoFocus:!0,ref:n,required:!0,defaultValue:hi.userId})),r.createElement("p",null,r.createElement("label",{htmlFor:"listenbrainz-token"},"Token:"),r.createElement("input",{type:"password",id:"listenbrainz-token",required:!0,ref:i}))),r.createElement("p",{className:"listenbrainz-link"},r.createElement(mi,{href:a},r.createElement(vr,{name:"listenbrainz"}),a)),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{value:"#cancel"},"Cancel"),r.createElement("button",{ref:o},"Login"))))}var gi=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::listenbrainzAuth");const bi=new s("listenbrainzAuth"),yi=new rn("");function wi(){return""!==yi.getValue()}function xi(){return yi.pipe(on()).pipe(rt((e=>""!==e)),on())}yi.next(hi.token);var ki=n(6998),Ei=n.n(ki),Si=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::youtubeAuth");const Ci=new s("youtubeAuth"),Ti="https://www.googleapis.com/auth/youtube.readonly",Ai=["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],Pi=new rn("");function Ii(){return""!==zi()}function zi(){return Pi.getValue()}function Mi(){var e,t;return Si(this,void 0,void 0,(function*(){return(null===(t=null===(e=window.google)||void 0===e?void 0:e.accounts)||void 0===t?void 0:t.oauth2)||(yield k("https://accounts.google.com/gsi/client")),google.accounts.oauth2}))}function Ni(e){return new Promise(((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)}))}function Oi(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=Ni(n);return(e,n)=>r.then((r=>n(r.transaction(t,e).objectStore(t))))}let $i;function ji(){return $i||($i=Oi("keyval-store","keyval")),$i}function _i(e,t=ji()){return t("readonly",(t=>Ni(t.get(e))))}function Ri(e,t,n=ji()){return n("readwrite",(n=>(n.put(t,e),Ni(n.transaction))))}!function(){Si(this,void 0,void 0,(function*(){const e=(yield function(){return Si(this,void 0,void 0,(function*(){const e=yield function(){return Si(this,void 0,void 0,(function*(){return window.gapi||(yield k("https://apis.google.com/js/api.js")),window.gapi}))}();return e.client?e.client:new Promise(((t,n)=>{e.load("client",{callback:()=>{const r={apiKey:dn,clientId:mn,discoveryDocs:Ai,scope:Ti};e.client.init(r).then((()=>t(e.client)),n)},onerror:n})}))}))}()).getToken();e&&(Ci.log("Access token successfully obtained."),Pi.next(e.access_token)),gapi.load("client:auth2",(()=>{gapi.auth2.getAuthInstance().isSignedIn.listen((e=>{if(e){const e=gapi.client.getToken();Pi.next((null==e?void 0:e.access_token)||"")}else Pi.next("")}))}))}))}();var Di=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))},Li=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Fi=Oi("ampcast/youtube-cache","keyval");!function(){Di(this,void 0,void 0,(function*(){const e=yield function(e=ji()){return e("readonly",(t=>{if(t.getAll&&t.getAllKeys)return Promise.all([Ni(t.getAllKeys()),Ni(t.getAll())]).then((([e,t])=>e.map(((e,n)=>[e,t[n]]))));const n=[];return e("readonly",(e=>function(e,t){return e.openCursor().onsuccess=function(){this.result&&(t(this.result),this.result.continue())},Ni(e.transaction)}(e,(e=>n.push([e.key,e.value]))).then((()=>n))))}))}(Fi),t=[],n=Date.now();for(const[r,i]of e)n-i.cachedAt>6048e5&&t.push(r);t.length>0&&(yield function(e,t=ji()){return t("readwrite",(t=>(e.forEach((e=>t.delete(e))),Ni(t.transaction))))}(t,Fi))}))}();class Bi{constructor(e,t,n){this.defaultConfig={pageSize:Bi.maxPageSize},this.nextPageToken=void 0,this.pageNumber=1,this.config=Object.assign(Object.assign({},this.defaultConfig),n),this.pager=new Hn((()=>Di(this,void 0,void 0,(function*(){return this.fetchPage(e,t)}))),this.config)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems({kind:e,items:t=[]},n){return Di(this,void 0,void 0,(function*(){switch(e){case"youtube#playlistListResponse":return t.map((e=>this.createMediaPlaylist(e)));case"youtube#playlistItemListResponse":{const e=t.map((e=>e.contentDetails.videoId));return(yield this.fetchVideos(e,n)).map((e=>this.createMediaItem(e)))}case"youtube#searchListResponse":{const e=t.map((e=>e.id.videoId));return(yield this.fetchVideos(e,n)).map((e=>this.createMediaItem(e)))}default:return t.map((e=>this.createMediaItem(e)))}}))}createMediaPlaylist(e){var t,n,r;return{itemType:Gt.Playlist,src:`youtube:playlist:${e.id}`,externalUrl:`${Vi}/playlist?list=${e.id}`,title:(null===(t=e.snippet)||void 0===t?void 0:t.title)||e.id,thumbnails:this.mapThumbnails(null===(n=e.snippet)||void 0===n?void 0:n.thumbnails),trackCount:null===(r=e.contentDetails)||void 0===r?void 0:r.itemCount,owner:this.createOwner(e.snippet),pager:this.createPlaylistPager(e.id)}}createMediaItem(e){var t,n,r,i,o;return{itemType:Gt.Media,mediaType:Sn.Video,src:`youtube:video:${e.id}`,externalUrl:Yi(e.id),title:(null===(t=e.snippet)||void 0===t?void 0:t.title)||e.id,duration:this.parseDuration(null===(n=e.contentDetails)||void 0===n?void 0:n.duration),thumbnails:this.mapThumbnails(null===(r=e.snippet)||void 0===r?void 0:r.thumbnails),owner:this.createOwner(e.snippet),globalRating:this.parseNumber(null===(i=e.statistics)||void 0===i?void 0:i.likeCount),globalPlayCount:this.parseNumber(null===(o=e.statistics)||void 0===o?void 0:o.viewCount),playedAt:0}}createOwner({channelId:e="",channelTitle:t=""}){return e?{name:t,url:`${Vi}/channel/${e}`}:void 0}createPlaylistPager(e){return new Bi("/playlistItems",{playlistId:e,part:"contentDetails",fields:"items(contentDetails(videoId))"})}mapThumbnails(e){if(e)return Object.keys(e).map((t=>e[t]))}parseDuration(e=""){const[,t=0,n=0,r=0]=/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/.exec(e)||[];return 60*Number(t)*60+60*Number(n)+Number(r)||0}fetchPage(e,t){return Di(this,void 0,void 0,(function*(){const n=this.createCacheKey(e,t,this.pageNumber),r=yield this.getFromCache(n),i=this.nextPageToken,o=yield this.fetch(e,Object.assign(Object.assign({},t),{fields:`etag,kind,pageInfo,nextPageToken,${t.fields||"items"}`,maxResults:String(this.config.pageSize),pageToken:i}),r),{pageInfo:a,nextPageToken:s}=o,l=Li(o,["pageInfo","nextPageToken"]),c=yield this.createItems(l,n),u=null==a?void 0:a.totalResults,d=!s;return this.nextPageToken=s,this.pageNumber++,yield this.saveToCache(n,o),{items:c,total:u,atEnd:d}}))}fetchVideos(e,t){return Di(this,void 0,void 0,(function*(){const n=`${t}/videos`,r=yield this.getFromCache(n),i=yield this.fetch("/videos",{id:e.join(","),part:"contentDetails,snippet,statistics",fields:`etag,${Bi.videoFields}`},r);return yield this.saveToCache(n,i),i.items||[]}))}fetch(e,t,n){return Di(this,void 0,void 0,(function*(){const r=(null==n?void 0:n.etag)?{"If-None-Match":n.etag}:void 0;return gapi.client.request({path:`https://www.googleapis.com/youtube/v3${e}`,params:t,headers:r}).then((e=>Di(this,void 0,void 0,(function*(){const{result:t,status:r,statusText:i}=e;if(t)return t;if(304===r&&n)return n;throw Error(i||`Error (${r})`)}))))}))}getFromCache(e){return Di(this,void 0,void 0,(function*(){const t=yield _i(e,Fi);return null!=t?t:null}))}saveToCache(e,t){return Di(this,void 0,void 0,(function*(){this.config.noCache||(yield Ri(e,Object.assign(Object.assign({},t),{cachedAt:Date.now()}),Fi))}))}createCacheKey(e,t,n){const{fields:r}=t,i=Li(t,["fields"]);return`${e}?${new URLSearchParams(i)}#${n}`}parseNumber(e){if(null!=e&&!isNaN(Number(e)))return Number(e)}}Bi.minPageSize=5,Bi.maxPageSize=50,Bi.videoFields="items(id,snippet(title,thumbnails,channelId,channelTitle),contentDetails(duration),statistics(viewCount,likeCount))",Bi.playlistFields="items(id,snippet(title,thumbnails,channelId,channelTitle),contentDetails(itemCount))";console.log("module::youtube");const Vi="https://www.youtube.com",Ui={view:"card",fields:["Thumbnail","Title","Duration","Owner"]},Hi={id:"youtube/likes",title:"Likes",icon:"thumbs-up",itemType:Gt.Media,layout:Ui,defaultHidden:!0,search:()=>new Bi("/videos",{myRating:"like",part:"snippet,contentDetails,statistics",fields:Bi.videoFields})},qi={id:"youtube/playlists",title:"Playlists",icon:"playlists",itemType:Gt.Playlist,layout:{view:"card compact",fields:["Thumbnail","Title","TrackCount","Owner"]},secondaryLayout:Ui,search:()=>new Bi("/playlists",{mine:"true",part:"snippet,contentDetails",fields:Bi.playlistFields})};function Wi(e=""){if(e.startsWith("youtube:"))return e;const t=Ei()(e);if(t)return`youtube:video:${t}`;if(/youtu\.?be/.test(e)){const t=new URLSearchParams(new URL(e).search).get("list")||"";if(t)return`youtube:playlist:${t}`}return""}function Yi(e){return`${Vi}/watch?v=${e}`}function Ki(e){return t=this,n=void 0,i=function*(){const t=Yi(e),n=yield fetch(`${Vi}/oembed?url=${t}&format=json`);if(!n.ok)switch(n.status){case 401:throw Error("Embedding prevented by channel owner.");case 403:throw Error("Private video.");case 404:throw Error("Video does not exist.");default:throw Error(`${n.statusText} (${n.status})`)}const r=yield n.json();return{itemType:Gt.Media,mediaType:Sn.Video,src:`youtube:video:${e}`,externalUrl:t,title:r.title,aspectRatio:r.width/r.height||16/9,duration:0,track:0,thumbnails:[{url:r.thumbnail_url,width:r.thumbnail_width,height:r.thumbnail_height}],owner:{name:r.author_name,url:r.author_url},playedAt:0}},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(a,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}const Xi={id:"youtube",name:"YouTube",icon:"youtube",url:"https://www.youtube.com/",defaultNoScrobble:!0,roots:[{id:"youtube/search/video",title:"Video",icon:"",itemType:Gt.Media,layout:Ui,searchable:!0,search:({q:e=""}={})=>e?new Bi("/search",{q:e,type:"video",videoCategoryId:"10",part:"id",fields:"items(id(videoId))"},{maxSize:Bi.maxPageSize,noCache:!0}):new Zt}],sources:[Hi,qi],observeIsLoggedIn:function(){return Pi.pipe(on()).pipe(rt((e=>""!==e)),on())},isLoggedIn:Ii,login:function(){return Si(this,void 0,void 0,(function*(){if(!Ii())try{const e=yield function(){return Si(this,void 0,void 0,(function*(){const e=yield Mi();return new Promise(((t,n)=>{e.initTokenClient({client_id:mn,scope:Ti,callback:e=>{e.error?n(e.error_description):(Pi.next(e.access_token),t(e.access_token))}}).requestAccessToken()}))}))}();Ci.log("Access token successfully obtained."),Pi.next(e)}catch(e){Ci.log("Could not obtain access token."),Ci.error(e)}}))},logout:function(){return Si(this,void 0,void 0,(function*(){const e=zi();e&&(yield Mi()).revoke(e,(()=>Pi.next("")))}))}};var Gi=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::listenbrainzApi");const Ji=new s("listenbrainzApi"),Qi=new class{constructor(){this.host="https://api.listenbrainz.org/1",this.rateLimitRemainingCalls=2,this.rateLimitResetTime=0}getListeningActivity({range:e="all_time"}={}){return Gi(this,void 0,void 0,(function*(){const{payload:{listening_activity:t}}=yield this.get(`stats/user/${hi.userId}/listening-activity`,{range:e});return t}))}getListenCount(){return Gi(this,void 0,void 0,(function*(){const{payload:{count:e}}=yield this.get(`user/${hi.userId}/listen-count`);return e}))}getListens(e){return Gi(this,void 0,void 0,(function*(){return Ji.log("getListens",{params:e}),yield this.get(`user/${hi.userId}/listens`,e)}))}scrobble(e){return Gi(this,void 0,void 0,(function*(){e.length>0&&(Ji.log("scrobble",{items:e}),yield this.post("submit-listens",{listen_type:1===e.length?"single":"import",payload:e.map((e=>({listened_at:e.playedAt,track_metadata:this.getScrobbleParams(e)})))}))}))}updateNowPlaying(e){return Gi(this,void 0,void 0,(function*(){Ji.log("updateNowPlaying",{item:e});try{this.canScrobble(e)&&(yield this.post("submit-listens",{listen_type:"playing_now",payload:[{track_metadata:this.getScrobbleParams(e)}]}))}catch(t){Ji.log('Failed to update "now playing":',{item:e}),Ji.error(t)}}))}get(e,t,n){return Gi(this,void 0,void 0,(function*(){t&&(e=`${e}?${new URLSearchParams(t)}`);const r=yield this.fetch(e,{method:"GET"},n);if(!r.ok||204===r.status)throw r;return r.json()}))}post(e,t){return Gi(this,void 0,void 0,(function*(){const n=JSON.stringify(t);return this.fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:n},!0)}))}fetch(e,t,n=!1){return Gi(this,void 0,void 0,(function*(){yield this.applyRateLimiting(),n&&(t.headers=Object.assign(Object.assign({},t.headers),{Authorization:`Token ${hi.token}`})),e.startsWith("/")&&(e=e.slice(1));const r=yield window.fetch(`${this.host}/${e}`,t);if(!r.ok)throw r;const i=r.headers;return i.has("x-ratelimit-remaining")&&(this.rateLimitRemainingCalls=Number(i.get("x-ratelimit-remaining"))||1),i.has("x-ratelimit-reset-in")&&(this.rateLimitResetTime=Date.now()+1e3*(Number(i.get("x-ratelimit-reset-in"))||1)),this.rateLimitRemainingCalls<5&&Ji.log({rateLimitRemainingCalls:this.rateLimitRemainingCalls,rateLimitReset:new Date(this.rateLimitResetTime).toISOString()}),r}))}getScrobbleParams(e){const t={media_player:"ampcast",media_player_version:"0.7.3",submission_client:"ampcast"};e.duration&&(t.duration=Math.round(e.duration)),e.track&&(t.tracknumber=e.track),e.artist_mbids&&(t.artist_mbids=e.artist_mbids),e.release_mbid&&(t.release_mbid=e.release_mbid),e.recording_mbid&&(t.recording_mbid=e.recording_mbid),e.isrc&&(t.isrc=e.isrc),e.externalUrl&&(t.origin_url=e.externalUrl);const[n]=e.src.split(":");switch(n){case"spotify":e.externalUrl&&(t.spotify_id=e.externalUrl),t.music_service="spotify.com";break;case"apple":t.music_service="music.apple.com";break;case"youtube":t.music_service="youtube.com";break;case"jellyfin":t.music_service_name="Jellyfin";break;case"plex":t.music_service_name="Plex";break;case"blob":case"file":t.music_service_name="Local file"}const r={track_name:e.title,artist_name:e.artists[0],additional_info:t};return e.album&&(r.release_name=e.album),r}canScrobble(e){var t;return!!e&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30}applyRateLimiting(){return new Promise((e=>{if(this.rateLimitRemainingCalls)this.rateLimitRemainingCalls--,e();else{const t=this.rateLimitResetTime-Date.now();t>0?setTimeout(e,t):e()}}))}},Zi=Qi;class eo{constructor(e){this.nextPageParams=void 0,this.pager=new Hn(((t=50)=>{return n=this,r=void 0,o=function*(){try{const{payload:n}=yield Zi.get(`user/${hi.userId}/listens`,Object.assign(Object.assign(Object.assign({},e),{count:t}),this.nextPageParams)),r=n.listens,i=this.createItems(r),o=i.length<t;return this.nextPageParams=o?void 0:{max_ts:r.at(-1).listened_at-1},{items:i,atEnd:o}}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((i=void 0)||(i=Promise))((function(e,t){function a(e){try{l(o.next(e))}catch(e){t(e)}}function s(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(a,s)}l((o=o.apply(n,r||[])).next())}));var n,r,i,o}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){var t,n;const r=e.track_metadata,i=r.additional_info,o=(null===(t=r.mbid_mapping)||void 0===t?void 0:t.recording_mbid)||void 0;return{itemType:Gt.Media,mediaType:Sn.Audio,src:`listenbrainz:listen:${e.listened_at}`,title:r.track_name,addedAt:e.inserted_at,artists:r.artist_name?[r.artist_name]:void 0,albumArtist:null==i?void 0:i.release_artist_name,album:r.release_name,duration:(null==i?void 0:i.duration)||((null==i?void 0:i.duration_ms)?Math.round(i.duration_ms/1e3):0),track:(null==i?void 0:i.tracknumber)||(null==i?void 0:i.track_number),isrc:null==i?void 0:i.isrc,externalUrl:o?`https://musicbrainz.org/recording/${o}`:"",recording_mbid:o,release_mbid:null===(n=r.mbid_mapping)||void 0===n?void 0:n.release_mbid,playedAt:e.listened_at,link:{src:this.getPlayableSrc(i)||"",externalUrl:this.getExternalUrl(null==i?void 0:i.origin_url)}}}getExternalUrl(e){if(e&&/youtu\.?be/.test(e)){const t=Ei()(e);if(t)return Yi(t)}return e||""}getPlayableSrc(e){var t;if(e){if(e.spotify_id)return this.getSpotifySrc(e.spotify_id);const n=e.origin_url;if(n){if(n.includes("apple.com"))return this.getAppleSrc(n);if(n.includes("spotify.com"))return this.getSpotifySrc(n);if(/youtu\.?be/.test(n))return Wi(n)}const r=(null===(t=e.music_service_name)||void 0===t?void 0:t.toLowerCase())||"",i="jellyfin|spotify|youtube|apple|plex".split("|");for(const e of i)if(r.includes(e))return`${e}:`}}getAppleSrc(e){if(e){const t=e.split("i=").pop();if(t)return`apple:song:${t}`}}getSpotifySrc(e){if(e){const t=e.split("/").pop();if(t)return`spotify:track:${t}`}}isNoContentError(e){return 204===(null==e?void 0:e.status)}}eo.maxPageSize=100;var to=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::musicbrainzApi");const no=new class{constructor(){this.host="https://musicbrainz.org/ws/2",this.lastCall=0}getISRCs(e){return to(this,void 0,void 0,(function*(){return(yield this.get(`/recording/${e}`,{inc:"isrcs"})).isrcs||[]}))}getRecordingsByISRC(e){return to(this,void 0,void 0,(function*(){return(yield this.get(`/isrc/${e}`)).recordings||[]}))}get(e,t={}){return to(this,void 0,void 0,(function*(){e.startsWith("/")&&(e=e.slice(1)),t.fmt="json",e=`${e}?${new URLSearchParams(t)}`,yield this.applyRateLimiting(),this.lastCall=Date.now();const n=yield fetch(`${this.host}/${e}`,{method:"GET",headers:{"User-Agent":"ampcast/0.7.3 ( rekky.rosso@gmail.com )"}});if(!n.ok)throw n;return yield n.json()}))}applyRateLimiting(){return new Promise((e=>{const t=Date.now()-this.lastCall;t>1e3?e():setTimeout((()=>e),t)}))}};class ro{constructor(e,t){this.release_mbid=e,this.pager=new Hn((()=>{return n=this,r=void 0,o=function*(){var n;const{media:r=[]}=yield no.get(`release/${e}`,{inc:"recordings"});return{items:this.createItems((null===(n=r[0])||void 0===n?void 0:n.tracks)||[],t),atEnd:!0}},new((i=void 0)||(i=Promise))((function(e,t){function a(e){try{l(o.next(e))}catch(e){t(e)}}function s(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(a,s)}l((o=o.apply(n,r||[])).next())}));var n,r,i,o}))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems(e,t){return e.map((e=>this.createItem(e,t)))}createItem(e,t){const n=e.recording,r=n.id||void 0;return{itemType:Gt.Media,mediaType:Sn.Audio,src:`musicbrainz:track:${r||lr()}`,title:e.title,artists:(null==t?void 0:t.artist)?[t.artist]:void 0,albumArtist:null==t?void 0:t.artist,album:null==t?void 0:t.title,duration:e.length/1e3||0,track:e.number?Number(e.number):void 0,recording_mbid:r,release_mbid:this.release_mbid,year:(null==t?void 0:t.year)||new Date(n["first-release-date"]).getUTCFullYear()||void 0,playedAt:0,externalUrl:r?`https://musicbrainz.org/recording/${r}`:""}}}const io="https://musicbrainz.org";class oo{constructor(e,t){let n=0;this.pager=new Hn(((r=50)=>{return i=this,o=void 0,s=function*(){try{const i=yield Zi.get(e,Object.assign(Object.assign({},t),{offset:n,count:r}));return n+=r,this.createPage(i)}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function r(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,r)}l((s=s.apply(i,o||[])).next())}));var i,o,a,s}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createPage(e){if(this.isRecordingsResponse(e)){const t=e.payload,n=t.recordings.map((e=>this.createMediaItem(e))),r=t.total_recording_count;return{items:n,total:r,atEnd:t.offset+n.length>=r}}if(this.isReleasesResponse(e)){const t=e.payload,n=t.releases.map((e=>this.createMediaAlbum(e))),r=t.total_release_count;return{items:n,total:r,atEnd:t.offset+n.length>=r}}if(this.isArtistsResponse(e)){const t=e.payload,n=t.artists.map((e=>this.createMediaArtist(e))),r=t.total_artist_count;return{items:n,total:r,atEnd:t.offset+n.length>=r}}throw Error("Unknown response.")}createMediaArtist(e){var t;const n=(null===(t=e.artist_mbids)||void 0===t?void 0:t[0])||void 0;return{itemType:Gt.Artist,src:`listenbrainz:artist:${lr()}`,externalUrl:n?`${io}/artist/${n}`:"",title:e.artist_name,artist_mbid:n,playCount:e.listen_count,pager:new Zt}}createMediaAlbum(e){const t=e.release_mbid||void 0,n={itemType:Gt.Album,src:`listenbrainz:album:${lr()}`,externalUrl:t?`${io}/release/${t}`:"",title:e.release_name,artist:e.artist_name,release_mbid:t,artist_mbids:e.artist_mbids,playCount:e.listen_count};return Object.assign(Object.assign({},n),{pager:t?new ro(t,n):new Zt})}createMediaItem(e){const t=e.recording_mbid||void 0;return{itemType:Gt.Media,mediaType:Sn.Audio,src:`listenbrainz:track:${lr()}`,externalUrl:t?`${io}/recording/${t}`:"",title:e.track_name,artists:e.artist_name?[e.artist_name]:void 0,album:e.release_name,duration:0,recording_mbid:t,release_mbid:e.release_mbid||void 0,artist_mbids:e.artist_mbids,playCount:e.listen_count,playedAt:0}}isRecordingsResponse(e){return"total_recording_count"in e.payload}isReleasesResponse(e){return"total_release_count"in e.payload}isArtistsResponse(e){return"total_artist_count"in e.payload}isNoContentError(e){return 204===(null==e?void 0:e.status)}}console.log("module::listenbrainz");const ao={id:"listenbrainz/history",title:"History",icon:"clock",itemType:Gt.Media,defaultHidden:!0,search:({startAt:e=0}={})=>new eo(e?{max_ts:e}:void 0)},so={id:"listenbrainz/recently-played",title:"Recently Played",icon:"clock",itemType:Gt.Media,search:()=>new eo},lo={id:"listenbrainz/top/tracks",title:"Top Tracks",icon:"star",itemType:Gt.Media,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","PlayCount"]},search:e=>new oo(`stats/user/${hi.userId}/recordings`,e)},co={id:"listenbrainz/top/albums",title:"Top Albums",icon:"star",itemType:Gt.Album,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},search:e=>new oo(`stats/user/${hi.userId}/releases`,e)},uo={id:"listenbrainz/top/artists",title:"Top Artists",icon:"star",itemType:Gt.Artist,layout:{view:"card minimal",fields:["Thumbnail","Title","PlayCount"]},defaultHidden:!0,search:e=>new oo(`stats/user/${hi.userId}/artists`,e)},mo={id:"listenbrainz",name:"ListenBrainz",icon:"listenbrainz",url:"https://listenbrainz.org/",scrobbler:!0,roots:[so],sources:[lo,co,uo,ao],observeIsLoggedIn:xi,isLoggedIn:wi,login:function(){return gi(this,void 0,void 0,(function*(){if(!wi())try{const e=yield function(){return pi(this,void 0,void 0,(function*(){return wr(vi,!0)}))}();if(e){const{userId:t,token:n}=JSON.parse(e);hi.userId=t,hi.token=n,bi.log("Access token successfully obtained."),yi.next(n)}}catch(e){bi.log("Could not obtain access token."),bi.error(e)}}))},logout:function(){return gi(this,void 0,void 0,(function*(){yi.next(""),hi.clear()}))}},fo=new m("plex"),ho={get clientId(){let e=fo.getString("clientId");return e||(e=lr(),fo.setString("clientId",e)),e},get connection(){return fo.getJson("connection")},set connection(e){fo.setJson("connection",e)},get host(){var e;return(null===(e=this.connection)||void 0===e?void 0:e.uri)||""},get libraryId(){return fo.getString("libraryId")},set libraryId(e){fo.setString("libraryId",e)},get server(){return fo.getJson("server")},set server(e){fo.setJson("server",e)},get serverToken(){var e;return(null===(e=this.server)||void 0===e?void 0:e.accessToken)||""},get userToken(){return fo.getString("userToken")},set userToken(e){fo.setString("userToken",e)},get userId(){return fo.getString("userId")},set userId(e){fo.setString("userId",e)},clear(){const e=this.clientId;fo.clear(),e&&fo.setString("clientId",e)}};var po=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function vo({host:e=ho.host,path:t,method:n="GET",params:r,headers:i,body:o,token:a,keepalive:s}){return po(this,void 0,void 0,(function*(){if(!e)throw Error("No Plex connection.");(t=r?`${t}?${new URLSearchParams(r)}`:t).startsWith("/")||(t=`/${t}`),a||(a=e===ho.host?ho.serverToken:ho.userToken);const l=yield window.fetch(`${e}${t}`,{method:n,headers:Object.assign(Object.assign({},i),go(a)),body:o,keepalive:s});if(!l.ok)throw Error(l.statusText);return l}))}function go(e){const t={"X-Plex-Product":"ampcast","X-Plex-Version":"0.7.3","X-Plex-Platform":w.displayName,"X-Plex-Platform-Version":w.version,"X-Plex-Device":w.os,"X-Plex-Device-Name":w.displayName,"X-Plex-Client-Identifier":ho.clientId,"X-Plex-Model":"hosted","Accept-Encoding":"gzip, deflate, br"};return e&&(t["X-Plex-Token"]=e),t}console.log("module::plexApi");const bo={fetch:vo,fetchJSON:function(e){var{headers:t,body:n}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["headers","body"]);return po(this,void 0,void 0,(function*(){return t=Object.assign(Object.assign({},t),{Accept:"application/json"}),n&&(t=Object.assign(Object.assign({},t),{"Content-Type":"application/json"}),n=JSON.stringify(n)),(yield vo(Object.assign({headers:t,body:n},r))).json()}))},getPlayableUrlFromSrc:function(e){const{host:t,serverToken:n}=ho;if(t&&n){const[,,r]=e.split(":");return`${t}${r}?X-Plex-Token=${n}`}throw Error("Not logged in.")}},yo=bo;var wo=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::plexAuth");const xo=new s("plexAuth"),ko="https://plex.tv/api/v2",Eo=new rn(""),So=new rn(!1);let Co;function To(){return""!==Eo.getValue()}function Ao(){return Eo.pipe(on()).pipe(rt((e=>""!==e)),on())}function Po(e){ho.userToken=e,e&&xo.log("Access token successfully obtained."),Eo.next(e)}Po(ho.userToken),Ao().pipe(Tt((e=>e)),$n((()=>wo(void 0,void 0,void 0,(function*(){const e=function(e,t){return wo(this,void 0,void 0,(function*(){try{return yield yo.fetch({host:e.uri,path:"/",method:"HEAD",token:t}),e}catch(e){return null}}))},t=ho.connection;if(t){if(yield e(t,ho.serverToken))return xo.log(`Using existing ${t.local?"local":"public"} connection.`),void So.next(!0);ho.server=null,ho.connection=null}xo.log("Searching for a connection...");try{const t=(yield function(){return wo(this,void 0,void 0,(function*(){return yo.fetchJSON({host:ko,path:"/resources",params:{includeHttps:"1"}})}))}()).filter((e=>"server"===e.provides));for(const n of t){const t=yield Promise.all([...n.connections.map((t=>e(t,n.accessToken)))]),r=t.filter(x);if(r.length){const e=r.find((e=>e.local))||r[0];return ho.server=n,ho.connection=e,xo.log(`Using ${e.local?"local":"public"} connection.`),void So.next(!0)}}xo.log("Could not establish a connection.")}catch(e){xo.log(e),Po("")}}))))).subscribe(xo),So.pipe(Tt((e=>e)),$n((()=>wo(void 0,void 0,void 0,(function*(){xo.log("Connected");const{MediaContainer:{Directory:e}}=yield yo.fetchJSON({path:"/library/sections"}),t=e.find((e=>"artist"===e.type));ho.libraryId=(null==t?void 0:t.key)||""}))))).subscribe(xo);class Io{constructor(e,t,n){var r;this.path=e,this.params=t,this.pageSize=(null==n?void 0:n.pageSize)||(null===(r=ho.connection)||void 0===r?void 0:r.local)?Io.maxPageSize:100,this.pager=new sr((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},n))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){return t=this,n=void 0,i=function*(){const t=yield yo.fetchJSON({path:this.path,params:this.params,headers:{"X-Plex-Container-Size":String(this.pageSize),"X-Plex-Container-Start":String((e-1)*this.pageSize)}}),{MediaContainer:{Metadata:n=[],totalSize:r}}=t;return{items:n.map((e=>this.createItem(e))),total:r}},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(a,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}createItem(e){switch(e.type){case"clip":return this.createMediaItemFromVideo(e);case"album":return this.createMediaAlbum(e);case"artist":return this.createMediaArtist(e);case"playlist":return this.createMediaPlaylist(e);default:return this.createMediaItemFromTrack(e)}}createMediaItemFromTrack(e){const[t]=e.Media,[n]=t.Part,r="[Unknown Album]"===e.parentTitle?"":e.parentTitle||"";return{itemType:Gt.Media,mediaType:Sn.Audio,src:`plex:audio:${n.key}`,externalUrl:"",title:e.title,addedAt:e.addedAt,artists:e.originalTitle?[e.originalTitle]:e.grandparentTitle?[e.grandparentTitle]:void 0,albumArtist:r&&!e.originalTitle?e.grandparentTitle:void 0,album:r,duration:e.duration/1e3,track:r?e.index:void 0,rating:e.userRating,year:e.parentYear,playedAt:e.lastViewedAt||0,playCount:e.viewCount,plex:{ratingKey:e.ratingKey},thumbnails:this.createThumbnails(e.thumb)}}createMediaAlbum(e){var t;return{itemType:Gt.Album,src:`plex:album:${e.ratingKey}`,externalUrl:"",title:e.title||"",addedAt:e.addedAt,artist:e.parentTitle,rating:e.userRating,year:e.year,playedAt:e.lastViewedAt,playCount:e.viewCount,genres:null===(t=e.Genre)||void 0===t?void 0:t.map((e=>e.tag)),plex:{ratingKey:e.ratingKey},pager:this.createPager(e.key),thumbnails:this.createThumbnails(e.thumb)}}createMediaArtist(e){var t;return{itemType:Gt.Artist,src:`plex:album:${e.ratingKey}`,externalUrl:"",title:e.title,addedAt:e.addedAt,rating:e.userRating,genres:null===(t=e.Genre)||void 0===t?void 0:t.map((e=>e.tag)),plex:{ratingKey:e.ratingKey},pager:this.createPager(e.key),thumbnails:this.createThumbnails(e.thumb)}}createMediaItemFromVideo(e){const[t]=e.Media,[n]=t.Part;return{itemType:Gt.Media,mediaType:Sn.Video,src:`plex:video:${n.key}`,externalUrl:"",title:e.title||"Video",addedAt:e.addedAt,artists:e.grandparentTitle?[e.grandparentTitle]:void 0,duration:e.duration/1e3,playedAt:e.lastViewedAt||0,playCount:e.viewCount,plex:{ratingKey:e.ratingKey},thumbnails:this.createThumbnails(e.thumb)}}createMediaPlaylist(e){return{itemType:Gt.Playlist,src:`plex:playlist:${e.key}`,externalUrl:"",title:e.title,description:e.summary,addedAt:e.addedAt,duration:e.duration/1e3,playedAt:e.lastViewedAt,playCount:e.viewCount,trackCount:e.leafCount,plex:{ratingKey:e.ratingKey},pager:this.createPager(e.key),thumbnails:this.createThumbnails(e.composite)}}createThumbnails(e){return e?[this.createThumbnail(e,60),this.createThumbnail(e,120),this.createThumbnail(e,240),this.createThumbnail(e,480)]:void 0}createThumbnail(e,t,n=t){return{url:`${ho.host}/photo/:/transcode?url=${encodeURIComponent(e)}&width=${t}&height=${n}&minSize=1&upscale=1&X-Plex-Token={plex-token}`,width:t,height:n}}createPager(e,t){return new Io(e,t)}}Io.minPageSize=10,Io.maxPageSize=1e3;var zo=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::plex");const Mo={view:"details",fields:["Artist","Title","Album","Track","Duration","PlayCount"]},No={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","PlayCount"]},Oo={id:"plex/video",title:"Music Video",icon:"video",itemType:Gt.Media,searchable:!0,layout:{view:"details",fields:["Index","Artist","Title","Duration","PlayCount"]},search:({q:e=""}={})=>new Io(`/library/sections/${ho.libraryId}/extras/all`,{title:e,type:"8",extraType:"4"})},$o={id:"plex/recently-played",title:"Recently Played",icon:"clock",itemType:Gt.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>new Io(`/library/sections/${ho.libraryId}/all`,{type:"10","lastViewedAt>":"0",sort:"lastViewedAt:desc"})},jo={id:"plex/most-played",title:"Most Played",icon:"most-played",itemType:Gt.Media,layout:Mo,search:()=>new Io(`/library/sections/${ho.libraryId}/all`,{type:"10","viewCount>":"1",sort:"viewCount:desc,lastViewedAt:desc"})},_o={id:"plex/top-rated",title:"Top Rated",icon:"star",itemType:Gt.Media,layout:Mo,search:()=>new Io(`/library/sections/${ho.libraryId}/all`,{type:"10","track.userRating>":"1",sort:"track.userRating:desc,viewCount:desc,lastViewedAt:desc"})},Ro={id:"plex/playlists",title:"Playlists",icon:"playlists",itemType:Gt.Playlist,secondaryLayout:No,search:()=>new Io("/playlists/all",{type:"15",playlistType:"audio"})},Do={id:"plex",name:"Plex",icon:"plex",url:"https://www.plex.tv/",lookup:function(e,t,n=10,r){return zo(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:n,maxSize:n},o=e=>zo(this,void 0,void 0,(function*(){return Qt(Fo(Gt.Media,t,e,i),r)}));return C((yield Promise.all([o({"artist.title":e}),o({originalTitle:e})])).flat(),"src")}))},roots:[Lo(Gt.Media,{title:"Songs",layout:Mo}),Lo(Gt.Album,{title:"Albums"}),Lo(Gt.Artist,{title:"Artists"}),Lo(Gt.Playlist,{title:"Playlists",secondaryLayout:No})],sources:[Oo,jo,$o,_o,Ro],observeIsLoggedIn:Ao,isLoggedIn:To,login:function(){return wo(this,void 0,void 0,(function*(){if(!To())try{const{id:e,authToken:t}=yield function(){return wo(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const n=location.hostname,r=("localhost"===n?`http://${n}:${location.port}`:`https://${n}`)+"/auth/plex/callback/";let i=null;const o=n=>{if(/(localhost|ampcast)/.test(n.origin)){if(clearInterval(s),window.removeEventListener("message",o,!1),null==i||i.close(),i=null,n.origin!==location.origin)return void t({message:`Origin ${n.origin} does not match ${location.origin}`});let r=10;const a=()=>wo(this,void 0,void 0,(function*(){r--;try{const{authToken:n,id:i}=yield yo.fetchJSON({host:ko,path:`/pins/${Co.id}`});n?e({id:i,authToken:n}):r?setTimeout(a,200):t("Timeout.")}catch(e){t(e)}}));a()}};window.addEventListener("message",o,!1);const a=`clientID=${ho.clientId}&code=${Co.code}&forwardUrl=${encodeURIComponent(r)}&context%5Bdevice%5D%5Bproduct%5D=ampcast`;i=window.open(`https://app.plex.tv/auth#?${a}`,"Plex","popup");const s=setInterval((()=>{(null==i?void 0:i.closed)&&(clearInterval(s),t({message:"access_denied"}))}),500)}))}))}();ho.userId=e,Po(t)}catch(e){xo.log("Could not obtain access token."),xo.error(e)}}))},logout:function(){return wo(this,void 0,void 0,(function*(){So.next(!1),Po(""),ho.clear()}))}};function Lo(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:String(e),icon:"search",searchable:!0,search:({q:t=""}={})=>Fo(e,t)})}function Fo(e,t,n,r){if(t){const i=e===Gt.Playlist?"/playlists/all":`/library/sections/${ho.libraryId}/all`,o=Object.assign(Object.assign({},n),{title:t});switch(e){case Gt.Media:o.type="10";break;case Gt.Album:o.type="9";break;case Gt.Artist:o.type="8";break;case Gt.Playlist:o.playlistType="audio",o.type="15"}return new Io(i,o,r)}return new Zt}const Bo=Do;function Vo(e){return et((function(t,n){var r=!1,i=0;t.subscribe(tt(n,(function(t){return(r||(r=!e(t,i++)))&&n.next(t)})))}))}var Uo=n(5754),Ho=n.n(Uo),qo=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::spotifyAuth");const Wo=new s("spotifyAuth"),Yo=new m("spotify/auth"),Ko=location.hostname,Xo=("localhost"===Ko?`http://${Ko}:${location.port}`:`https://${Ko}`)+"/auth/spotify/callback/",Go="https://accounts.spotify.com";let Jo;const Qo=new rn("");function Zo(){return Qo.pipe(on())}function ea(){return""!==Qo.getValue()}function ta(){return qo(this,void 0,void 0,(function*(){const e=ra(),t=null==e?void 0:e.refresh_token;if(t){const e=yield fetch(`${Go}/api/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:un,grant_type:"refresh_token",refresh_token:t})});if(!e.ok)throw oa(),e;const n=yield e.json();return na(n),n.access_token}throw oa(),Error("No 'refresh_token'")}))}function na(e){const{access_token:t,refresh_token:n,expires_in:r}=e,i=new Date,o=new Date(i.setSeconds(i.getSeconds()+r)).toISOString();Yo.setJson("token",{access_token:t,refresh_token:n,expires_at:o}),ia(t)}function ra(){const e=Yo.getJson("token");return e&&(e.expires_at=new Date(e.expires_at)),e}function ia(e){Wo.log("Access token successfully obtained."),Qo.next(e)}function oa(){Yo.removeItem("token"),Qo.next("")}function aa(){return qo(this,void 0,void 0,(function*(){const e=function(e){let t="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let e=0;e<64;e++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}();Yo.setString("code_verifier",e),Jo=yield function(e){return qo(this,void 0,void 0,(function*(){const t=yield crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}))}(e)}))}!function(){qo(this,void 0,void 0,(function*(){try{const e=ra();if(e)return void(e.expires_at.getTime()-Date.now()<=0?yield ta():ia(e.access_token))}catch(e){Wo.error(e)}yield aa()}))}();var sa=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};class la{constructor(e,t){this.defaultConfig={minPageSize:la.minPageSize,maxPageSize:la.maxPageSize,pageSize:la.maxPageSize},this.pageNumber=1;const n=Object.assign(Object.assign({},this.defaultConfig),t);this.pager=new Hn(((t=this.defaultConfig.pageSize)=>sa(this,void 0,void 0,(function*(){const n=(this.pageNumber-1)*t,r=()=>sa(this,void 0,void 0,(function*(){const{items:r,total:i,next:o}=yield e(n,t);return this.pageNumber++,{items:r.map((e=>this.createMediaObject(e))),total:i,atEnd:!o}}));try{return yield r()}catch(e){if(401===e.status)return yield ta(),yield r();throw e}}))),n)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createMediaObject(e){switch(e.type){case"episode":return this.createMediaItemFromEpisode(e);case"artist":return this.createMediaArtist(e);case"album":return this.createMediaAlbum(e);case"playlist":return this.createMediaPlaylist(e);case"track":return this.createMediaItemFromTrack(e)}}createMediaItemFromEpisode(e){return{itemType:Gt.Media,mediaType:Sn.Audio,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,duration:e.duration_ms/1e3,thumbnails:e.images,unplayable:!1===e.is_playable,playedAt:e.played_at?Math.floor((new Date(e.played_at).getTime()||0)/1e3):0}}createMediaAlbum(e){var t;return{itemType:Gt.Album,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,artist:e.artists.map((e=>e.name)).join(", "),year:new Date(e.release_date).getFullYear(),thumbnails:e.images,trackCount:null===(t=e.tracks)||void 0===t?void 0:t.total,pager:this.createAlbumPager(e)}}createMediaArtist(e){return{itemType:Gt.Artist,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,genres:e.genres,thumbnails:e.images,pager:this.createArtistAlbumsPager(e)}}createArtistTopTracks(e){return{itemType:Gt.Album,src:`spotify:top-tracks:${e.id}`,externalUrl:"",title:"Top Tracks",artist:e.name,thumbnails:e.images,pager:this.createTopTracksPager(e)}}createMediaPlaylist(e){return{itemType:Gt.Playlist,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,description:e.description?(t=e.description,_.innerHTML=t,_.textContent||""):void 0,thumbnails:e.images,trackCount:e.tracks.total,pager:this.createPlaylistPager(e),owner:{name:e.owner.display_name||"",url:e.owner.external_urls.spotify}};var t}createMediaItemFromTrack(e){var t,n,r,i,o;const a=/album|compilation/i.test((null===(t=e.album)||void 0===t?void 0:t.album_type)||"")?e.album:void 0;return{itemType:Gt.Media,mediaType:Sn.Audio,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,artists:null===(n=e.artists)||void 0===n?void 0:n.map((e=>e.name)),albumArtist:null==a?void 0:a.artists.map((e=>e.name)).join(", "),album:null==a?void 0:a.name,duration:e.duration_ms/1e3,playedAt:e.played_at?Math.floor((new Date(e.played_at).getTime()||0)/1e3):0,genres:null===(r=e.album)||void 0===r?void 0:r.genres,track:a?e.track_number:void 0,year:e.album&&new Date(e.album.release_date).getUTCFullYear()||void 0,isrc:null===(i=e.external_ids)||void 0===i?void 0:i.isrc,thumbnails:null===(o=e.album)||void 0===o?void 0:o.images,unplayable:!1===e.is_playable}}createArtistAlbumsPager(e){const t=this.getMarket(),n=this.createArtistTopTracks(e),r=new Zt([n]),i=new la(((n,r)=>sa(this,void 0,void 0,(function*(){const{items:i,total:o,next:a}=yield da.getArtistAlbums(e.id,{offset:n,limit:r,market:t,include_groups:"album,compilation,single"});return{items:i,total:o,next:a}}))));return new _n(r,i)}createTopTracksPager(e){const t=this.getMarket();return new la(((n,r)=>sa(this,void 0,void 0,(function*(){const{tracks:i}=yield da.getArtistTopTracks(e.id,t,{offset:n,limit:r,market:t});return{items:i,next:""}}))))}createAlbumPager(e){var t,n;const r=null===(t=e.tracks)||void 0===t?void 0:t.items;if(r&&r.length===e.total_tracks){const t=null===(n=e.tracks)||void 0===n?void 0:n.items;return new Zt(t.map((t=>this.createMediaItemFromTrack(Object.assign(Object.assign({},t),{album:e})))))}{const t=this.getMarket();return new la(((n,r)=>sa(this,void 0,void 0,(function*(){const{items:i,total:o,next:a}=yield da.getAlbumTracks(e.id,{offset:n,limit:r,market:t});return{items:i.map((t=>Object.assign(Object.assign({},t),{album:e}))),total:o,next:a}}))))}}createPlaylistPager(e){const t=this.getMarket();return new la(((n,r)=>sa(this,void 0,void 0,(function*(){const{items:i,total:o,next:a}=yield da.getPlaylistTracks(e.id,{offset:n,limit:r,market:t});return{items:i.map((e=>e.track)),total:o,next:a}}))))}getMarket(){return Yo.getString("market")}}la.minPageSize=10,la.maxPageSize=50;var ca=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::spotify");const ua=new s("spotify"),da=new(Ho()),ma={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},fa={view:"details",fields:["Index","Artist","Title","Album","Track","Duration"]},ha={view:"card compact",fields:["Thumbnail","Title","Genre"]},pa={id:"spotify/recently-played",title:"Recently Played",icon:"clock",itemType:Gt.Media,defaultHidden:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search(){return new la(((e,t)=>ca(this,void 0,void 0,(function*(){const{items:e,total:n}=yield da.getMyRecentlyPlayedTracks({limit:t});return{items:e.map((e=>Object.assign({played_at:e.played_at},e.track))),total:n,next:void 0}}))),{maxSize:50,pageSize:50})}},va={id:"spotify/top-tracks",title:"Top Tracks",icon:"star",itemType:Gt.Media,layout:ma,search(){return new la(((e,t)=>ca(this,void 0,void 0,(function*(){return da.getMyTopTracks({offset:e,limit:t})}))))}},ga={id:"spotify/top-artists",title:"Top Artists",icon:"star",itemType:Gt.Artist,layout:ha,defaultHidden:!0,search(){return new la(((e,t)=>ca(this,void 0,void 0,(function*(){return da.getMyTopArtists({offset:e,limit:t})}))))}},ba={id:"spotify/liked-songs",title:"Liked Songs",icon:"heart",itemType:Gt.Media,layout:ma,search(){const e=Ta();return new la(((t,n)=>ca(this,void 0,void 0,(function*(){const{items:r,total:i,next:o}=yield da.getMySavedTracks({offset:t,limit:n,market:e});return{items:r.map((e=>e.track)),total:i,next:o}}))))}},ya={id:"spotify/liked-albums",title:"Liked Albums",icon:"heart",itemType:Gt.Album,search(){const e=Ta();return new la(((t,n)=>ca(this,void 0,void 0,(function*(){const{items:r,total:i,next:o}=yield da.getMySavedAlbums({offset:t,limit:n,market:e});return{items:r.map((e=>e.album)),total:i,next:o}}))),{calculatePageSize:!0})}},wa={id:"spotify/playlists",title:"Playlists",icon:"playlists",itemType:Gt.Playlist,secondaryLayout:fa,search(){const e=Ta();return new la(((t,n)=>ca(this,void 0,void 0,(function*(){const{items:r,total:i,next:o}=yield da.getUserPlaylists(void 0,{offset:t,limit:n,market:e});return{items:r,total:i,next:o}}))))}},xa={id:"spotify/featured-playlists",title:"Featured Playlists",icon:"playlists",itemType:Gt.Playlist,defaultHidden:!0,secondaryLayout:fa,search(){const e=Ta();return new la(((t,n)=>ca(this,void 0,void 0,(function*(){const{playlists:{items:r,total:i,next:o}}=yield da.getFeaturedPlaylists({offset:t,limit:n,market:e});return{items:r,total:i,next:o}}))))}},ka={id:"spotify",name:"Spotify",icon:"spotify",url:"https://www.spotify.com/",lookup:function(e,t,n=10,r){return ca(this,void 0,void 0,(function*(){if(!e||!t)return[];const i=e=>e.replace(/['"]/g," "),o={pageSize:n,maxSize:n};return Qt(Ca(Gt.Media,`${i(e)} ${i(t)}`,o),r)}))},roots:[Sa(Gt.Media,{title:"Songs",layout:ma}),Sa(Gt.Album,{title:"Albums"}),Sa(Gt.Artist,{title:"Artists",layout:ha}),Sa(Gt.Playlist,{title:"Playlists",secondaryLayout:fa})],sources:[pa,va,ga,ba,ya,wa,xa],observeIsLoggedIn:function(){return Zo().pipe(rt((e=>""!==e)),on())},isLoggedIn:ea,login:function(){return qo(this,void 0,void 0,(function*(){if(!ea())try{na(yield function(){return qo(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{let n=null;const r=i=>{if(/(localhost|ampcast)/.test(i.origin)){if(clearInterval(o),window.removeEventListener("message",r,!1),null==n||n.close(),n=null,i.origin!==location.origin)return void t({message:`Origin ${i.origin} does not match ${location.origin}`});(function(e){return qo(this,void 0,void 0,(function*(){const t=Yo.getString("code_verifier"),n=yield fetch(`${Go}/api/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:un,grant_type:"authorization_code",code:e,redirect_uri:Xo,code_verifier:t})});if(!n.ok)throw n;return yield n.json()}))})(i.data.code).then(e,t)}};window.addEventListener("message",r,!1);const i=new URLSearchParams({client_id:un,scope:["user-read-recently-played","user-read-playback-position","user-top-read","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","streaming","user-read-email","user-read-private","playlist-read-private","user-library-read"].join(" "),redirect_uri:Xo,response_type:"code",code_challenge_method:"S256",code_challenge:Jo});n=window.open(`${Go}/authorize?${i}`,"Spotify","popup");const o=setInterval((()=>{(null==n?void 0:n.closed)&&(clearInterval(o),t({message:"access_denied"}))}),500)}))}))}())}catch(e){Wo.log("Could not obtain access token."),Wo.error(e)}}))},logout:function(){return qo(this,void 0,void 0,(function*(){oa(),yield aa()}))}},Ea=ka;function Sa(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:String(e),icon:"search",searchable:!0,search:({q:t=""}={})=>Ca(e,t)})}function Ca(e,t,n){return t?new la(function(e,t){const n=Ta();switch(e){case Gt.Media:return(e,r)=>ca(this,void 0,void 0,(function*(){const{tracks:{items:i,total:o,next:a}}=yield da.searchTracks(t,{offset:e,limit:r,market:n});return{items:i,total:o,next:a}}));case Gt.Album:return(e,r)=>ca(this,void 0,void 0,(function*(){const{albums:{items:i,total:o,next:a}}=yield da.searchAlbums(t,{offset:e,limit:r,market:n});return{items:i,total:o,next:a}}));case Gt.Artist:return(e,r)=>ca(this,void 0,void 0,(function*(){const{artists:{items:i,total:o,next:a}}=yield da.searchArtists(t,{offset:e,limit:r,market:n});return{items:i,total:o,next:a}}));case Gt.Playlist:return(e,r)=>ca(this,void 0,void 0,(function*(){const{playlists:{items:i,total:o,next:a}}=yield da.searchPlaylists(t,{offset:e,limit:r,market:n});return{items:i,total:o,next:a}}))}}(e,t),Object.assign({maxSize:250},n)):new Zt}function Ta(){return Yo.getString("market")}Zo().subscribe((e=>da.setAccessToken(e))),Ta()||Zo().pipe(Vo((e=>!e)),ot((()=>da.getMe())),$n((e=>Yo.setString("market",e.country))),Jt(1)).subscribe(ua);var Aa=ee((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function Pa(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=vt(e);return et((function(t,r){for(var i=e.length,o=new Array(i),a=e.map((function(){return!1})),s=!1,l=function(t){Qe(e[t]).subscribe(tt(r,(function(e){o[t]=e,s||a[t]||(a[t]=!0,(s=a.every(je))&&(a=null))}),xe))},c=0;c<i;c++)l(c);t.subscribe(tt(r,(function(e){if(s){var t=G([e],X(o));r.next(n?n.apply(void 0,G([],X(t))):t)}})))}))}function Ia(e){return Tt((function(t,n){return e<=n}))}function za(e,t){return t?function(n){return Ct(t.pipe(Jt(1),et((function(e,t){e.subscribe(tt(t,xe))}))),n.pipe(za(e)))}:ot((function(t,n){return Qe(e(t,n)).pipe(Jt(1),function(e){return rt((function(){return e}))}(t))}))}function Ma(e,t){void 0===t&&(t=me);var n=Fe(e,t);return za((function(){return n}))}var Na,Oa,$a,ja=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))},_a=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Ra=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const Da=new s("SpotifyPlayer"),La="Spotify player not connected.",Fa=(e,t)=>e.paused===t.paused&&e.position===t.position;Na=new WeakMap,Oa=new WeakMap,$a=new WeakMap;const Ba=new class{constructor(e){this.accessToken$=e,this.player=null,this.paused$=new rn(!0),this.src$=new rn(""),this.currentTrackSrc$=new rn(""),this.error$=new tn,this.playerReady$=new rn(!1),this.playerStarted$=new rn(!1),this.state$=new rn(null),this.loadedSrc="",this.isLoggedIn=!1,this.deviceId="",this.hidden=!0,this.loop=!1,Na.set(this,!1),Oa.set(this,!0),$a.set(this,1),this.onSpotifyWebPlaybackSDKReady=()=>{Da.log("onSpotifyWebPlaybackSDKReady"),this.observeAccessToken().pipe(Tt((e=>""!==e)),ot((e=>this.connect(e))),$n((()=>this.playerReady$.next(!0))),Jt(1)).subscribe(Da)},window.onSpotifyWebPlaybackSDKReady=this.onSpotifyWebPlaybackSDKReady,this.observeReady().pipe($n((()=>this.player.activateElement())),Jt(1)).subscribe(Da),this.observeReady().pipe(At((()=>this.observeIsLoggedIn())),At((e=>e?this.observePaused():ht)),At((e=>e?ht:this.observeSrc())),Pa(this.observeAccessToken()),At((([e,t])=>e&&e!==this.loadedSrc?$t(void 0).pipe(At((()=>this.loadError?this.reconnect(t):$t(void 0))),ot((()=>this.addToQueue(e,t))),Rn((t=>(this.loadedSrc="",this.loadError={src:e,error:t},this.error$.next(t),this.currentTrackSrc$.next(""),ht))),Jt(1)):ht))).subscribe(Da),this.observeSrc().subscribe((()=>this.currentTrackSrc$.next(""))),this.observeState().pipe($n((e=>{var t,n;const r=null===(n=null===(t=e.track_window)||void 0===t?void 0:t.current_track)||void 0===n?void 0:n.uri;r&&this.loadedSrc===this.src&&this.currentTrackSrc!==r&&this.currentTrackSrc$.next(r)}))).subscribe(Da),this.currentTrackSrc$.pipe(Tt((e=>!!e)),At((()=>this.observeCurrentTrackState().pipe(Ia(2),ot((e=>!e.paused&&this.paused?this.safePause():$t(void 0))),Jt(1))))).subscribe(Da),this.observeIsLoggedIn().pipe(Vo((e=>e===this.isLoggedIn)),$n((e=>{this.isLoggedIn=e,e||this.paused||this.error$.next(Error(La))}))).subscribe(Da),this.observeError().subscribe(Da.error),k("https://sdk.scdn.co/spotify-player.js")}get autoplay(){return _a(this,Na,"f")}set autoplay(e){_a(this,Na,"f")!==e&&(Ra(this,Na,e,"f"),e&&this.playerStarted$.next(!0))}get muted(){return _a(this,Oa,"f")}set muted(e){_a(this,Oa,"f")!==e&&(Ra(this,Oa,e,"f"),this.safeVolume(e?0:this.volume))}get volume(){return _a(this,$a,"f")}set volume(e){_a(this,$a,"f")!==e&&(Ra(this,$a,e,"f"),this.safeVolume(this.muted?0:e))}observeCurrentTime(){return Et(this.observeCurrentTrackState(),this.observePaused().pipe(At((e=>e?this.getCurrentState():Be(250).pipe(ot((()=>this.getCurrentState()))))))).pipe(rt((e=>{var t,n;return(null===(n=null===(t=null==e?void 0:e.track_window)||void 0===t?void 0:t.current_track)||void 0===n?void 0:n.uri)===this.currentTrackSrc?e.position/1e3:0})),on())}observeDuration(){return this.observeCurrentTrackState().pipe(rt((e=>e.duration/1e3)),on())}observeEnded(){return this.observePlaying().pipe(At((()=>this.observeCurrentTrackState())),on(Fa),Pa(this.observePaused()),rt((([e,t])=>!t&&e.paused&&0===e.position)),Tt((e=>e)),rt((()=>{})))}observeError(){return this.error$}observePlaying(){return this.observeCurrentTrackState().pipe(on(Fa),Pa(this.observePaused()),rt((([e,t])=>!t&&!e.paused)),on(),Tt((e=>e)),rt((()=>{})))}observeCurrentTrackState(){return this.observeState().pipe(Tt((e=>{var t,n;return(null===(n=null===(t=e.track_window)||void 0===t?void 0:t.current_track)||void 0===n?void 0:n.uri)===this.currentTrackSrc})))}appendTo(){}load(e){Da.log("load",{src:e}),this.src$.next(e),this.autoplay&&this.paused$.next(!1),this.player&&this.isLoggedIn?this.autoplay&&e===this.loadedSrc&&this.safePlay():this.autoplay&&this.error$.next(Error(La))}play(){var e;Da.log("play"),this.paused$.next(!1),this.player&&this.isLoggedIn?this.src===(null===(e=this.loadError)||void 0===e?void 0:e.src)?this.error$.next(this.loadError.error):this.src===this.loadedSrc&&this.safePlay():this.error$.next(Error(La))}pause(){Da.log("pause"),this.paused$.next(!0),this.safePause()}stop(){Da.log("stop"),this.paused$.next(!0),this.safeStop()}seek(e){var t;null===(t=this.player)||void 0===t||t.seek(1e3*e)}resize(){}getCurrentState(){var e;return ja(this,void 0,void 0,(function*(){return(null===(e=this.player)||void 0===e?void 0:e.getCurrentState())||null}))}get paused(){return this.paused$.getValue()}get src(){return this.src$.getValue()}get currentTrackSrc(){return this.currentTrackSrc$.getValue()}observeAccessToken(){return this.accessToken$}observeIsLoggedIn(){return this.observeAccessToken().pipe(rt((e=>!!e)),on())}observePaused(){return this.paused$.pipe(on())}observeReady(){return Mn([this.playerReady$,this.playerStarted$]).pipe(Tt((([e,t])=>e&&t)),rt((()=>{})),Jt(1))}observeSrc(){return this.src$.pipe(on())}observeState(){return this.state$.pipe(Tt(x))}addToQueue(e,t,n=3){return ja(this,void 0,void 0,(function*(){if(!t)throw Error(La);const r=yield fetch(`https://api.spotify.com/v1/me/player/play?device_id=${this.deviceId}`,{method:"PUT",body:JSON.stringify({uris:[e],position_ms:0}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!r.ok){if(n>0)switch(r.status){case 401:{const t=yield ta();return this.addToQueue(e,t,--n)}case 404:case 502:case 503:return yield this.reconnect(t),this.addToQueue(e,t,--n)}throw r}this.loadError=void 0,this.loadedSrc=e}))}connect(e){return ja(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{let r=!1;const i=new Spotify.Player({name:"ampcast",getOAuthToken:t=>ja(this,void 0,void 0,(function*(){r&&(e=yield ta()),r=!0,t(e)})),volume:this.muted?0:this.volume});i.addListener("initialization_error",n),i.addListener("authentication_error",n),i.addListener("account_error",n),i.addListener("playback_error",(e=>this.error$.next(e))),i.addListener("player_state_changed",(e=>this.state$.next(e))),i.addListener("not_ready",(()=>{Da.log("not_ready"),this.deviceId="",n("not_ready")})),i.addListener("ready",(({device_id:e})=>{Da.log("ready"),this.player=i,this.deviceId=e,t(i)})),i.connect()}))}))}disconnect(){return ja(this,void 0,void 0,(function*(){this.loadedSrc="",this.currentTrackSrc$.next(""),this.loadError=void 0;const e=this.player;e&&(e.removeListener("initialization_error"),e.removeListener("authentication_error"),e.removeListener("account_error"),e.removeListener("playback_error"),e.removeListener("player_state_changed"),e.removeListener("not_ready"),e.removeListener("ready"),yield this.safePause(),e.disconnect())}))}reconnect(e){return ja(this,void 0,void 0,(function*(){return Da.log("reconnect"),t=kt(this.disconnect()).pipe(Ma(1e3),ot((()=>this.connect(e))),Ma(3e3),rt((()=>{}))),new Promise((function(e,n){var r=new ze({next:function(t){e(t),r.unsubscribe()},error:n,complete:function(){n(new Aa)}});t.subscribe(r)}));var t}))}safePause(){return ja(this,void 0,void 0,(function*(){try{this.player&&this.loadedSrc&&(yield this.player.pause())}catch(e){Da.error(e)}}))}safePlay(){return ja(this,void 0,void 0,(function*(){try{this.player&&this.loadedSrc&&(yield this.player.resume())}catch(e){this.error$.next(e)}}))}safeStop(){return ja(this,void 0,void 0,(function*(){try{if(this.player&&this.loadedSrc){yield this.player.pause();const e=yield this.getCurrentState();(null==e?void 0:e.position)&&(yield this.player.seek(0))}}catch(e){Da.error(e)}}))}safeVolume(e){var t;return ja(this,void 0,void 0,(function*(){try{yield null===(t=this.player)||void 0===t?void 0:t.setVolume(e)}catch(e){Da.error(e)}}))}}(Zo());function Va(){return[ir,Ea,Xi,Bo,Br,di,mo]}function Ua(){return Va().filter((e=>!!e.lookup))}function Ha(e){return Va().find((t=>t.id===e))}function qa(e){if(e){const[t,n,r]=e.split(":");return"blob"===t||"file"===t||!!r&&!!n&&function(e){const t=Ha(e);return!!t&&!t.scrobbler}(t)}return!1}function Wa(e){return!!e&&qa(e.src)}const Ya=new m("services"),Ka=new rn(Ya.getJson("hidden",{}));function Xa(e){return!function(e){var t;return null!==(t=Ka.getValue()[e.id])&&void 0!==t?t:!!e.defaultHidden}(e)}function Ga(e){const t=Ka.getValue(),n=Object.assign(Object.assign({},t),e);Ya.setJson("hidden",n),Ka.next(n)}var Ja,Qa=n(5800);function Za({service:e}){return r.createElement("p",null,r.createElement("button",{className:"branded login",onClick:e.login},"Log in to ",e.name))}function es({service:e}){return r.createElement("p",null,r.createElement(mi,{href:e.url},r.createElement(vr,{name:e.icon}),e.url))}function ts({service:e}){return r.createElement("div",{className:"panel"},r.createElement("div",{className:"page login"},r.createElement("p",null,"You need to be logged in to play music from ",e.name,"."),r.createElement(Za,{service:e}),r.createElement(es,{service:e})))}function ns(){return(0,r.useEffect)((()=>{const e=new tn,t=e.pipe(ot((e=>Fe(e))),ot((()=>function(){return wo(this,void 0,void 0,(function*(){return Co=yield yo.fetchJSON({host:ko,path:"/pins",method:"POST",params:{strong:"true"}}),Co}))}())),rt((e=>1e3*e.expiresIn)),$n((t=>e.next(t)))).subscribe();return e.next(0),()=>t.unsubscribe()})),r.createElement(ts,{service:Bo})}function rs({service:e}){return r.createElement("div",{className:"dev-mode note"},r.createElement("p",null,"This application is in ",r.createElement("strong",null,"development mode"),"."),r.createElement("p",null,"You currently need to be authorized to access services from ",e.name,"."))}function is(){return r.createElement("div",{className:"panel"},r.createElement("div",{className:"page login"},r.createElement(rs,{service:Ea}),r.createElement("p",null,"You need to be logged in to play music from Spotify.*"),r.createElement(Za,{service:Ea}),r.createElement(es,{service:Ea}),r.createElement("p",null,r.createElement("small",null,"*Spotify Premium required."))))}function os(e,t){return void 0===t&&(t=me),et((function(n,r){var i=null,o=null,a=null,s=function(){if(i){i.unsubscribe(),i=null;var e=o;o=null,r.next(e)}};function l(){var n=a+e,o=t.now();if(o<n)return i=this.schedule(void 0,n-o),void r.add(i);s()}n.subscribe(tt(r,(function(n){o=n,a=t.now(),i||(i=t.schedule(l,e),r.add(i))}),(function(){s(),r.complete()}),void 0,(function(){o=i=null})))}))}!function(e){e.Looking="looking",e.NotFound="not-found"}(Ja||(Ja={}));const as=Ja;var ss=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const ls=new s("file");function cs(e){var t,r;return ss(this,void 0,void 0,(function*(){const{parseBlob:i}=yield Promise.all([n.e(463),n.e(12)]).then(n.bind(n,2463));let o;try{o=yield i(e,{duration:!0,skipCovers:!0})}catch(t){ls.log(`Error parsing file: ${e.name}`),ls.error(t),o={format:{},common:{}}}const{common:a,format:s}=o,l=e.type.startsWith("video"),c=s.duration||(yield function(e){return ss(this,void 0,void 0,(function*(){return new Promise((t=>{const n=e.type.startsWith("video"),r=document.createElement(n?"video":"audio"),i=URL.createObjectURL(e),o=()=>{const e=r.error?0:r.duration;r.ondurationchange=null,r.onerror=null,r.src="",r.removeAttribute("src"),URL.revokeObjectURL(i),t(e)};r.ondurationchange=o,r.onerror=o,r.onended=o,r.muted=!0,r.src=i}))}))}(e)),u=(e=0)=>Math.floor(Number(e))||0;return{itemType:Gt.Media,mediaType:l?Sn.Video:Sn.Audio,src:`blob:${lr()}`,externalUrl:"",title:a.title||e.name.replace(/\.\w+$/,""),artists:a.artist?[a.artist]:a.artists,albumArtist:a.album&&a.albumartist||"",album:a.album||"",genres:a.genre,duration:c?Number(c.toFixed(3)):0,track:u(null===(t=a.track)||void 0===t?void 0:t.no),year:u(a.year),mood:a.mood||"",rating:Number(a.rating)||0,isrc:null===(r=a.isrc)||void 0===r?void 0:r[0],recording_mbid:a.musicbrainz_recordingid,playedAt:0,blob:e}}))}var us=n(4909),ds=n.n(us),ms=n(9520),fs=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module:localdb/listens");const hs=new s("localdb/listens"),ps=[],vs=new rn(ps);class gs extends ms.ZP{constructor(){super("ampcast/listens"),this.version(1).stores({items:"&playedAt, src, lastfmScrobbledAt, listenbrainzScrobbledAt"})}}const bs=new gs;function ys(){return vs.pipe(Tt((e=>e!==ps)))}function ws(e){return fs(this,void 0,void 0,(function*(){try{e.length>0&&(yield bs.items.bulkPut(e))}catch(e){hs.error(e)}}))}function xs(e,t=30){return Math.round(e.playedAt/t)}function ks(e,t,n=5){const r=t.playedAt,i=r-n,o=r+t.duration+n;for(const n of e){if(n.playedAt<i)return;if(n.playedAt>i&&n.playedAt<o&&Ss(t,n,.75))return n}}function Es(e,t){const n=vs.getValue();return function(e,t,n=5){const r=t.playedAt;if(r)for(let i=0;i<e.length;i++){const o=e[i-1];if(o&&o.playedAt<r)return;const a=e[i],s=a.playedAt-n,l=a.playedAt+a.duration+n;if(r>s&&r<l&&Ss(a,t,.75))return a}}(n,e,t)||function(e,t){return e.find((e=>t.src===e.src||t.externalUrl&&t.externalUrl===e.externalUrl||t.isrc&&t.isrc===e.isrc||t.recording_mbid&&t.recording_mbid===e.recording_mbid))}(n,e)||Fs(n,e)}function Ss(e,t,n){return j(e.title,t.title,n)}function Cs(e){return fs(this,void 0,void 0,(function*(){const t=`${e}ScrobbledAt`,n=Math.floor(Date.now()/1e3)-1209600,r=yield bs.items.where(t).equals(0).toArray();yield ws(r.filter((e=>e.playedAt<n)).map((e=>Object.assign(Object.assign({},e),{[t]:-1}))))}))}fs(void 0,void 0,void 0,(function*(){try{yield Cs("lastfm"),yield Cs("listenbrainz")}catch(e){hs.error(e)}(0,ms.Y1)((()=>bs.items.orderBy("playedAt").reverse().toArray())).subscribe(vs)}));const Ts=new tn,As=new tn,Ps=new m("lookup"),Is={get preferredService(){return Ps.getString("preferredService")},set preferredService(e){Ps.setString("preferredService",e)}};var zs=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const Ms=new s("lookupStore");class Ns extends ms.ZP{constructor(){super("ampcast/lookup"),this.version(1).stores({items:"&[service+artist+title]"})}add(e,t,n,r){return zs(this,void 0,void 0,(function*(){try{e&&(Ms.log("add",{service:e,artist:t,title:n,items:r}),t=t.toLowerCase(),n=n.toLowerCase(),yield this.items.put({service:e,artist:t,title:n,items:r}))}catch(e){Ms.error(e)}}))}get(e,t,n){return zs(this,void 0,void 0,(function*(){return this.items.get([e,t.toLowerCase(),n.toLowerCase()])}))}}const Os=new Ns;var $s=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const js=new s("lookup");let _s="";function Rs(e){return $s(this,void 0,void 0,(function*(){try{if(!e)return;if(Wa(e))return e;t=e,Ts.next({lookupItem:t});const n=yield function(e){return $s(this,void 0,void 0,(function*(){const t=Es(e);if(t)return t;const{link:n}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["link"]);if(n&&Wa(n))return Object.assign(Object.assign({},r),n);const{artist:i,title:o}=Ys(e);if(!i||!o)return;let a=[];const[s]=(null==n?void 0:n.src.split(":"))||[],l=Ha(s);return l&&(a=yield Ds(l,e)),0===a.length&&(a=yield Ls(e,!0,l)),0===a.length&&(a=yield Ls(e,!1,l)),Fs(a,e)}))}(e);return n&&([_s]=n.src.split(":")),function(e,t){As.next({lookupItem:e,foundItem:t?O(t,e):void 0})}(e,n),n}catch(e){js.error(e)}var t}))}function Ds(e,t){return $s(this,void 0,void 0,(function*(){try{if(!e.lookup)return[];const{artist:n,title:r}=Ys(t),i=yield Os.get(e.id,n,r);if(i)return i.items;if(e.isLoggedIn()){const i=e=>Ws(e).replace(/[([].*$/,"").replace(/['"]/g," ").replace(/\s\s+/g," "),o=Bs(yield e.lookup(i(t.albumArtist||Ks(n)),i(Ks(r)),10,2e3),t);return yield Os.add(e.id,n,r,o),o}}catch(e){js.error(e)}return[]}))}function Ls(e,t,n){return $s(this,void 0,void 0,(function*(){const r=Ua().filter((e=>e!==n&&e.isLoggedIn()===t));return 0===r.length?[]:(yield Promise.all([...r.map((t=>Ds(t,e)))])).flat()}))}function Fs(e,t){const{artist:n,title:r}=Ys(t);if(!n||!r)return;const i=Is.preferredService||_s;let o=Bs(e,t);return o=$(o,(e=>Hs(e,t))),i&&(o=$(o,(e=>e.src.startsWith(i)))),o[0]}function Bs(e,t){let n=e.filter((e=>Us(e,t,!0)));return 0===n.length&&(n=e.filter((e=>Us(e,t,!1)))),n}const Vs=/\s*(feat\.|[([]?\s?feat[\s.]).*$/i;function Us(e,t,n){return(function(e,t,n){let r=t.title;if(!r)return!1;if(qs(r,e.title))return!0;if(n)return!1;const i=Ws(e.title);if(r=Ws(r),qs(r,i))return!0;const[,...o]=e.artists||[];if(o.length>0){const e=o.length>1?` & ${o.pop()}`:"";if(qs(r,`${i} (feat. ${o.join(", ")}${e})`))return!0}return!(!Vs.test(r)||!qs(Ks(r),i))||!(!Vs.test(e.title)||!qs(r,Ks(i)))}(e,t,n)||function(e,t){if(!Hs(e,t))return!1;if(e.track!==t.track)return!1;const n=Ws(e.title),r=Ws(t.title);return!(!n.startsWith(r)&&!r.startsWith(n))||j(n,r,.75)}(e,t))&&function(e,t,n){var r;const i=null===(r=t.artists)||void 0===r?void 0:r[0];if(!i)return!1;const o=e.artists;if(!o)return!1;const a=o[0];if(!a)return!1;if(qs(i,a))return!0;if(n)return!1;if(qs(Ws(i),Ws(a)))return!0;if(qs(Ks(i),Ks(a)))return!0;const s=t.albumArtist;if(s&&qs(Ws(s),Ws(a)))return!0;if(qs(Ks(i),e.albumArtist))return!0;const l=",;&|/".split("").map((e=>[e,`${e} `,` ${e} `])).flat();for(const e of l){const[t]=o[0].split(e);if(qs(i,t))return!0;if(o.length>1&&qs(i,o.join(e)))return!0}return!1}(e,t,n)}function Hs(e,t){return!(!e.album||!t.album)&&qs(Ws(t.album),Ws(e.album))}function qs(e,t=""){return 0===e.localeCompare(t,void 0,{sensitivity:"accent"})}function Ws(e){return ds()(e).replace(/\s\s+/g," ")}function Ys(e){return{artist:e.artists&&e.artists[0]||"",title:e.title}}function Ks(e){return e.replace(Vs,"")}const Xs=new m("playlist"),Gs=new rn(Xs.getJson("settings",{allowDuplicates:!0,showLineNumbers:!0,zeroPadLineNumbers:!0,showSourceIcons:!0})),Js=function(){return Gs},Qs=function(){return Gs.getValue()},Zs=function(e){Xs.setJson("settings",e),Gs.next(e)};var el=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::playlist");const tl=new s("playlist"),nl=Oi("ampcast/playlist","keyval"),rl=[],il=new rn(rl),ol=new rn("");function al(){return il.getValue()}function sl(e){e=e.concat(),il.next(e),0===e.length?cl(""):ul()||cl(e[0].id)}function ll(){return ol.getValue()}function cl(e){ol.next(e)}function ul(){const e=al(),t=ll();return e.find((e=>e.id===t))||null}function dl(e){cl(e.id)}function ml(){return Mn([il,ol]).pipe(rt((([e,t])=>{var n;return null!==(n=e.find((e=>e.id===t)))&&void 0!==n?n:null})),on())}function fl(){const e=il.getValue(),t=ll();return e.findIndex((e=>e.id===t))}function hl(){return il.getValue().length}function pl(e){const t=ll();if(t){const n=al(),r=n.findIndex((e=>e.id===t));if(-1!==r){const t=n[r+e];t&&dl(t)}}}function vl(e,t){return el(this,void 0,void 0,(function*(){const n=al(),r=Qs().allowDuplicates;let i=yield function(e){return el(this,void 0,void 0,(function*(){const t=e=>"itemType"in e&&e.itemType===Gt.Album;let n=[];if(Array.isArray(e))if(t(e[0])){const t=yield Promise.all(e.map((e=>bl(e))));for(const e of t)n=n.concat(e)}else n=yield Promise.all(e.map((e=>yl(e))));else n=t(e)?yield bl(e):e instanceof FileList?yield Promise.all(Array.from(e).map((e=>cs(e)))):[yield yl(e)];return n.filter(x)}))}(e);if(r||(i=i.filter((e=>-1===n.findIndex((t=>t.src===e.src))))),i.length>0){const e=i.map((e=>Object.assign(Object.assign({},e),{id:lr(),lookupStatus:void 0})));t>=0&&t<n.length?(n.splice(t,0,...e),sl(n)):sl(n.concat(e))}}))}function gl(e){const t=al(),n=Array.isArray(e)?e:[e],r=t.filter((e=>!n.includes(e)));if(r.length!==t.length){const e=fl(),t=ll(),n=r.findIndex((e=>e.id===t));if(-1===n)if(-1===e)cl("");else{const t=r[e]||r.at(-1);cl((null==t?void 0:t.id)||"")}sl(r)}}function bl(e){return el(this,void 0,void 0,(function*(){return Qt(e.pager)}))}function yl(e){return el(this,void 0,void 0,(function*(){return e instanceof File?/^(audio|video)/.test(e.type)?cs(e):null:e}))}const wl={get atEnd(){return fl()===hl()-1},get atStart(){return 0===hl()||0===fl()},observe:function(){return il.pipe(Tt((e=>e!==rl)))},observeCurrentIndex:function(){return Mn([il,ol]).pipe(rt((([e,t])=>e.findIndex((e=>e.id===t)))),on())},observeCurrentItem:ml,observeNextItem:function(){return Mn([il,ol]).pipe(rt((([e,t])=>{const n=e.findIndex((e=>e.id===t));return-1===n?null:e[n+1]||null})),on())},observeSize:function(){return il.pipe(rt((e=>e.length)),on())},getCurrentItem:ul,setCurrentItem:dl,add:function(e){return el(this,void 0,void 0,(function*(){yield vl(e,-1)}))},clear:function(){sl([])},eject:function(){const e=ul();e&&gl(e)},insertAt:vl,moveSelection:function(e,t){const n=al(),r=n[t];if(e.includes(r))return;const i=n.filter((t=>!e.includes(t))),o=i.indexOf(r);o>=0?(i.splice(o,0,...e),sl(i)):sl(i.concat(e))},next:function(){pl(1)},prev:function(){pl(-1)},remove:gl,removeAt:function(e){const t=function(e){var t;return null!==(t=al()[e])&&void 0!==t?t:null}(e);t&&gl(t)},shuffle:function(){sl(T(al()))}},xl=wl;el(void 0,void 0,void 0,(function*(){var e,t;const n=null!==(e=yield _i("items",nl))&&void 0!==e?e:[],r=null!==(t=yield _i("currently-playing-id",nl))&&void 0!==t?t:"";il.next(n),ol.next(r)})),il.pipe(Ia(2),os(200),ot((e=>Ri("items",e=e.map((e=>e.lookupStatus?Object.assign(Object.assign({},e),{lookupStatus:void 0}):e)),nl)))).subscribe(tl),ol.pipe(Ia(2),os(200),ot((e=>Ri("currently-playing-id",e,nl)))).subscribe(tl),Ts.pipe($n((({lookupItem:e})=>{const t=al(),n=t.findIndex((t=>t.src===e.src));if(-1!==n){const e=t[n];t[n]=Object.assign(Object.assign({},e),{lookupStatus:as.Looking}),sl(t)}}))).subscribe(tl),As.pipe($n((({lookupItem:e,foundItem:t})=>{const n=al(),r=n.findIndex((t=>t.src===e.src));if(-1!==r){const e=n[r];n[r]=t?Object.assign(Object.assign({},t),{id:e.id,lookupStatus:void 0}):Object.assign(Object.assign({},e),{lookupStatus:as.NotFound}),sl(n)}}))).subscribe(tl);var kl,El,Sl=n(1062),Cl=n.n(Sl),Tl=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Al=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const Pl=(e,t)=>e.width===t.width&&e.height===t.height,Il=16/9,zl={autohide:1,autoplay:0,controls:0,disablekb:1,enablejsapi:1,fs:0,iv_load_policy:3,modestbranding:1,rel:0,showinfo:0};var Ml;!function(e){e[e.UNSTARTED=-1]="UNSTARTED",e[e.ENDED=0]="ENDED",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.BUFFERING=3]="BUFFERING",e[e.CUED=5]="CUED"}(Ml||(Ml={}));class Nl{constructor(e){this.player=null,this.src$=new rn(""),this.size$=new rn({width:0,height:0}),this.error$=new tn,this.ready$=new tn,this.state$=new tn,this.videoId$=new rn(""),kl.set(this,!0),El.set(this,1),this.autoplay=!1,this.loop=!1;const t=this.element=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div"),i=this.logger=new s(`YouTubePlayer/${e}`);this.targetId=`youtube-iframe-${e}`,t.hidden=!0,t.className="youtube-video",n.className="youtube-video-wrapper",r.id=this.targetId,n.append(r),t.append(n),this.observeReady().pipe(ot((()=>this.observeSrc())),Vo((e=>!e)),$n((e=>{const t=this.player,[,n,r,i="0"]=e.split(":"),o=Number(i)||0;if(r){if("playlist"===n){const e={list:r,listType:n,startSeconds:o};this.autoplay?t.loadPlaylist(e):t.cuePlaylist(e)}else this.autoplay?t.loadVideoById(r,o):t.cueVideoById(r,o);this.loadError=void 0}else t.stopVideo()}))).subscribe(i),this.observeReady().pipe(ot((()=>this.observeVideoSize())),$n((({width:e,height:t})=>this.player.setSize(e,t)))).subscribe(i),this.observeState().pipe(Tt((e=>e===Ml.ENDED&&this.loop)),$n((()=>this.player.seekTo(0,!0)))).subscribe(i),this.observeState().pipe(Tt((e=>e===Ml.PLAYING)),$n((()=>this.element.style.visibility=""))).subscribe(i),this.observeState().pipe(rt((()=>{var e;return this.getVideoId((null===(e=this.player)||void 0===e?void 0:e.getVideoUrl())||"")})),$n((e=>this.videoId$.next(e)))).subscribe(i),this.observeError().subscribe(i.error)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e,e&&(this.element.style.visibility="hidden")}get muted(){return Tl(this,kl,"f")}set muted(e){Tl(this,kl,"f")!==e&&(Al(this,kl,e,"f"),this.player&&(e?this.player.mute():0!==this.volume&&this.player.unMute()))}get volume(){return Tl(this,El,"f")}set volume(e){Tl(this,El,"f")!==e&&(Al(this,El,e,"f"),this.player&&(this.player.setVolume(100*e),0===e?this.player.mute():this.muted||this.player.unMute()))}observeCurrentTime(){return this.observeState().pipe(At((e=>{var t;return e===Ml.PLAYING?Fe(250-Math.round(1e3*this.player.getCurrentTime())%250,250).pipe(rt((()=>this.player.getCurrentTime())),Pt(this.observeState())):$t((null===(t=this.player)||void 0===t?void 0:t.getCurrentTime())||0)})))}observeDuration(){return this.observeState().pipe(rt((()=>{var e;return(null===(e=this.player)||void 0===e?void 0:e.getDuration())||0})),Tt((e=>0!==e)),on())}observeEnded(){return this.observeState().pipe(Tt((e=>e===Ml.ENDED&&!this.loop)),rt((()=>{})))}observeError(){return this.error$}observePlaying(){return this.observeState().pipe(Tt((e=>e===Ml.PLAYING)),rt((()=>{})))}observeVideoId(){return this.videoId$.pipe(on())}appendTo(e){e.appendChild(this.element),this.createPlayer()}load(e){this.logger.log("load",{src:e}),this.player||this.createPlayer(),this.autoplay&&this.player&&e===this.src?this.player.playVideo():this.src$.next(e)}play(){var e;this.logger.log("play"),this.player?this.src===(null===(e=this.loadError)||void 0===e?void 0:e.src)?this.error$.next(this.loadError.error):this.player.playVideo():this.error$.next(Error("YouTube player not loaded."))}pause(){var e;this.logger.log("pause"),null===(e=this.player)||void 0===e||e.pauseVideo()}stop(){var e;this.logger.log("stop"),null===(e=this.player)||void 0===e||e.stopVideo()}seek(e){var t;null===(t=this.player)||void 0===t||t.seekTo(e,!0)}resize(e,t){this.size$.next({width:e,height:t})}destroy(){var e;null===(e=this.player)||void 0===e||e.destroy(),this.element.remove()}get src(){return this.src$.getValue()}observeAspectRatio(){return this.observeVideoId().pipe(At((e=>e?this.getAspectRatio(e):$t(Il))),on())}observeReady(){return this.ready$.pipe(Jt(1))}observeSize(){return this.size$.pipe(on(Pl),Tt((({width:e,height:t})=>e*t>0)))}observeSrc(){return this.src$.pipe(on())}observeState(){return this.state$}observeVideoSize(){return Mn([this.observeSize(),this.observeAspectRatio()]).pipe(rt((([{width:e,height:t},n])=>{const r=Math.max(Math.round(e/n),t);return{width:Math.max(Math.round(r*n),e),height:r}})),on(Pl))}createPlayer(){if(!this.player&&this.element.isConnected){const e=Cl()(this.targetId,{playerVars:zl});e.on("ready",(({target:e})=>{this.player=e,e.setVolume(100*this.volume),(this.muted||0===this.volume)&&e.mute(),this.ready$.next(void 0)})),e.on("stateChange",(({data:e})=>{this.state$.next(e)})),e.on("error",(e=>{this.loadError={src:this.src,error:e},this.error$.next(e)}))}}getAspectRatio(e){return kt(Ki(e)).pipe(Pt(Fe(3e3)),Pt(this.observeVideoId().pipe(Ia(1))),rt((({aspectRatio:e})=>e||Il)),Rn((t=>(this.logger.log(`Could not obtain oembed info (videoId=${e}): ${t.message}`),this.loadError={src:this.src,error:t},this.error$.next(t),$t(Il)))))}getPlayerState(){return this.player?this.player.getPlayerState():Ml.UNSTARTED}getVideoId(e){if(e.startsWith("youtube:video")){const[,,t]=e.split(":");return t}return Ei()(e)||""}}kl=new WeakMap,El=new WeakMap;var Ol=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};let $l=0;class jl extends Nl{constructor(){super("loader-"+$l++),this.appendTo(document.body)}loadPlaylist(e){return Ol(this,void 0,void 0,(function*(){return yield this.cue(e),this.player.getPlaylist()||[]}))}getDuration(e){return Ol(this,void 0,void 0,(function*(){return yield this.cue(e),this.player.getDuration()||0}))}cue(e){return new Promise(((t,n)=>{const r=this.observeCued(),i=Et(this.observeError(),Fe(3e3).pipe(rt((()=>Error("timeout")))));r.pipe(Pt(i),Jt(1)).subscribe({next:t}),i.pipe(Pt(r),Jt(1)).subscribe({next:n}),this.load(e)}))}observeCued(){return this.observeState().pipe(Vo((e=>e!==Ml.UNSTARTED)),Tt((e=>e===Ml.CUED)),rt((()=>{})),Jt(1))}}function _l(){const e=(0,r.useRef)(null),[t,n]=(0,r.useState)(""),i=(0,r.useCallback)((t=>{return r=this,i=void 0,a=function*(){try{t.preventDefault();const r=e.current.value,i=Ei()(r),o=yield Ki(i),a=yield function(e){return Ol(this,void 0,void 0,(function*(){const t=new jl;try{return yield t.getDuration(e)}finally{t.destroy()}}))}(o.src);yield xl.add(Object.assign(Object.assign({},o),{duration:a})),n("Queued.")}catch(e){n(e.message||"This video cannot be embedded.")}},new((o=void 0)||(o=Promise))((function(e,t){function n(e){try{l(a.next(e))}catch(e){t(e)}}function s(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof o?e:new o((function(t){t(e)}))}(t.value).then(n,s)}l((a=a.apply(r,i||[])).next())}));var r,i,o,a}),[]),o=(0,r.useCallback)((()=>{n("");const t=e.current.value;let r="Not a valid YouTube url.";/^https?/.test(t)&&/youtu\.?be/.test(t)&&(r="Not a YouTube video.",Ei()(t)&&(r="")),e.current.setCustomValidity(r)}),[]);return r.createElement("form",{className:"add-youtube-video",onSubmit:i},r.createElement("fieldset",null,r.createElement("legend",null,"Add video from url:"),r.createElement("p",{className:"text-with-button"},r.createElement("input",{type:"url",required:!0,onInput:o,ref:e}),r.createElement("button",{className:"small"},"Queue")),r.createElement("p",null,r.createElement("output",null,t))))}function Rl(){return r.createElement("div",{className:"panel"},r.createElement("div",{className:"page login"},r.createElement(rs,{service:Xi}),r.createElement("p",null,"You can still play YouTube videos without being logged in.",r.createElement("br",null),"But you need to be logged in to search for music and access your playlists."),r.createElement(Za,{service:Xi}),r.createElement(_l,null),r.createElement(es,{service:Xi})))}function Dl({service:e}){switch(e.id){case"plex":return r.createElement(ns,null);case"spotify":return r.createElement(is,null);case"youtube":return r.createElement(Rl,null);default:return r.createElement(ts,{service:e})}}function Ll({onSubmit:e}){const t=(0,r.useRef)(null),n=(0,r.useCallback)((n=>{const r=t.current.value;n.preventDefault(),null==e||e(r)}),[e]);return r.createElement("form",{className:"search-bar",onSubmit:n},r.createElement("p",{className:"text-with-button"},r.createElement("input",{type:"search",spellCheck:!1,autoComplete:"off",autoCapitalize:"off",ref:t}),r.createElement("button",{type:"submit"},"Search")))}function Fl({children:e}){return r.createElement("div",{className:"panel empty-screen"},e)}const Bl=[Kn];function Vl(){var e;return(null===(e=window.MusicKit)||void 0===e?void 0:e.version.startsWith("3"))?r.createElement(dv,{service:ir,sources:Bl}):r.createElement(Ul,null)}function Ul(){return r.createElement(Fl,null,r.createElement("p",null,r.createElement("strong",null,"Apple MusicKit beta required.")),r.createElement("p",null,"You need to enable ",r.createElement("strong",null,"MusicKit beta")," from the settings to watch videos from Apple Music."))}function Hl({min:e="1970",max:t=ql(),value:n=t,onSelect:i}){const[o,a]=(0,r.useState)((()=>String(new Date(n).getFullYear()))),s=function(e,t){const[n,i]=(0,r.useState)([]);return(0,r.useLayoutEffect)((()=>{const n=[],r=new Date(e),o=new Date(t),a=r.getFullYear();let s=o.getFullYear();for(;s>=a;)n.push(s),s--;i(n)}),[e,t]),n}(e,t);(0,r.useEffect)((()=>{null==i||i(o)}),[i,o]);const l=(0,r.useCallback)((e=>{a(e.target.value)}),[]);return r.createElement("span",{className:"year-picker"},r.createElement("select",{defaultValue:o,onChange:l},s.map((e=>r.createElement("option",{value:e,key:e},e)))))}function ql(){const e=new Date;return String(e.getFullYear())}const Wl=(()=>{const e=new Intl.DateTimeFormat(navigator.language,{month:"short"}).format;return[...Array(12).keys()].map((t=>e(new Date(2022,t,2))))})();function Yl({min:e="1970-01",max:t=P(),value:n=t,onSelect:i}){const o=(0,r.useRef)(null),[a,s]=(0,r.useState)((()=>String(new Date(n).getFullYear()))),[l,c]=(0,r.useState)((()=>new Date(n).getMonth())),u=function(e,t,n){const[i,o]=(0,r.useState)([]);return(0,r.useLayoutEffect)((()=>{const r=[],i=new Date(t),a=new Date(n),s=Number(e)===i.getFullYear()?i.getMonth():0;let l=Number(e)===a.getFullYear()?a.getMonth():11;for(;l>=s;)r.push(l),l--;o(r)}),[e,t,n]),i}(a,e,t);(0,r.useLayoutEffect)((()=>{const e=u[0];void 0!==e&&(o.current.value=String(e),c(e))}),[u]),(0,r.useEffect)((()=>{-1!==l&&(null==i||i(`${a}-${String(l+1).padStart(2,"0")}`))}),[i,a,l]);const d=(0,r.useCallback)((e=>{c(-1),s(e)}),[]),m=(0,r.useCallback)((e=>{c(Number(e.target.value))}),[]);return r.createElement("span",{className:"month-picker"},r.createElement(Hl,{min:e,max:t,value:a,onSelect:d}),r.createElement("select",{defaultValue:l,onChange:m,key:a,ref:o},u.map((e=>r.createElement("option",{value:e,key:e},Wl[e])))))}function Kl({min:e="1970-01-01",max:t=A(),value:n=t,onSelect:i}){const o=(0,r.useRef)(null),[a,s]=(0,r.useState)((()=>P(n))),[l,c]=(0,r.useState)((()=>new Date(n).getDate())),u=function(e,t,n){const[i,o]=(0,r.useState)([]);return(0,r.useLayoutEffect)((()=>{const r=[],i=new Date(t),a=new Date(n),s=e.split("-").map(Number),l=s[0],c=s[1]-1,u=l===i.getFullYear()&&c===i.getMonth()?i.getDate():1;let d=l===a.getFullYear()&&c===a.getMonth()?a.getDate():new Date(l,c+1,0).getDate();for(;d>=u;)r.push(d),d--;o(r)}),[e,t,n]),i}(a,e,t);(0,r.useLayoutEffect)((()=>{const e=u[0];e&&(o.current.value=String(e),c(e))}),[u]),(0,r.useEffect)((()=>{l&&(null==i||i(`${a}-${String(l).padStart(2,"0")}`))}),[i,a,l]);const d=(0,r.useCallback)((e=>{c(0),s(e)}),[]),m=(0,r.useCallback)((e=>{c(Number(e.target.value))}),[]);return r.createElement("span",{className:"date-picker"},r.createElement(Yl,{min:e,max:t,value:a,onSelect:d}),r.createElement("select",{defaultValue:l,onChange:m,key:a,ref:o},u.map((e=>r.createElement("option",{value:e,key:e},e)))))}function Xl(e,t){const[n,i]=(0,r.useState)(null);return(0,r.useEffect)((()=>{i((null==e?void 0:e.search(t))||null)}),[e,t]),n}var Gl,Jl,Ql=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Zl=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};class ec{constructor(e,t,n,r){this.players=t,this.selectPlayer=n,this.loadPlayer=r,this.player$=new rn(null),this.error$=new tn,Gl.set(this,!1),Jl.set(this,!1);const i=this.element=document.createElement("div");i.className=e,t.forEach((e=>{e.autoplay=!1,e.muted=!0,e.hidden=!0,e.appendTo(i)}))}get autoplay(){return Ql(this,Gl,"f")}set autoplay(e){Zl(this,Gl,e,"f"),this.currentPlayer&&(this.currentPlayer.autoplay=e)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e,this.currentPlayer&&(this.currentPlayer.hidden=e)}get loop(){return this.players[0].loop}set loop(e){this.players.forEach((t=>t.loop=e))}get muted(){return Ql(this,Jl,"f")}set muted(e){Zl(this,Jl,e,"f"),this.currentPlayer&&(this.currentPlayer.muted=e)}get volume(){return this.players[0].volume}set volume(e){this.players.forEach((t=>t.volume=e))}observeCurrentTime(){return this.observeCurrentPlayer().pipe(At((e=>e?e.observeCurrentTime():$t(0))),on())}observeDuration(){return this.observeCurrentPlayer().pipe(At((e=>e?e.observeDuration():ht)),on())}observeEnded(){return this.observeCurrentPlayer().pipe(At((e=>e?e.observeEnded():ht)))}observeError(){return this.observeCurrentPlayer().pipe(At((e=>e?Et(this.error$,e.observeError()):ht)))}observePlaying(){return this.observeCurrentPlayer().pipe(At((e=>e?e.observePlaying():ht)))}appendTo(e){e.appendChild(this.element)}load(e){const t=this.currentPlayer,n=this.selectPlayer(e);if(this.player$.next(null),t&&t!==n&&(t.muted=!0,t.hidden=!0,t.stop()),this.player$.next(n),n)try{n.autoplay=this.autoplay,this.loadPlayer(n,e),n.muted=this.muted,n.hidden=this.hidden}catch(e){this.error$.next(e)}else this.error$.next(Error("No player found."))}play(){var e;this.autoplay=!0,null===(e=this.currentPlayer)||void 0===e||e.play()}pause(){var e;this.autoplay=!1,null===(e=this.currentPlayer)||void 0===e||e.pause()}stop(){var e;this.autoplay=!1,null===(e=this.currentPlayer)||void 0===e||e.stop()}seek(e){var t;null===(t=this.currentPlayer)||void 0===t||t.seek(e)}resize(e,t){e*t>0&&this.players.forEach((n=>n.resize(e,t)))}get currentPlayer(){return this.player$.getValue()}observeCurrentPlayer(){return this.player$.pipe(on())}}Gl=new WeakMap,Jl=new WeakMap;var tc;class nc{constructor(){tc.set(this,!1),this.loop=!0,this.muted=!0,this.volume=0}get autoplay(){return function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,tc,"f")}set autoplay(e){!function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,tc,e,"f")}observeCurrentTime(){return ht}observeDuration(){return ht}observeEnded(){return ht}observeError(){return ht}observePlaying(){return ht}seek(){}}tc=new WeakMap;class rc{constructor(e,t){this.error$=new tn,this.src="",this.autoplay=!1;const n=this.element=document.createElement(e);n.hidden=!0,n.muted=!0,n.autoplay=!1,n.className=`html5-${e} html5-${e}-${t}`,n.crossOrigin="anonymous",dt(n,"error").pipe(rt((()=>n.error))).subscribe(this.error$);const r=this.logger=new s(`HTML5Player/${e}/${t}`);this.observeError().subscribe(r.error)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e}get loop(){return this.element.loop}set loop(e){this.element.loop=e}get muted(){return this.element.muted}set muted(e){this.element.muted=e}get volume(){return this.element.volume}set volume(e){this.element.volume=e}observeCurrentTime(){return dt(this.element,"timeupdate").pipe(rt((()=>this.element.currentTime)),rt((e=>isFinite(e)?e:0)))}observeDuration(){return dt(this.element,"durationchange").pipe(rt((()=>this.element.duration)),rt((e=>isFinite(e)?e:0)))}observeEnded(){return dt(this.element,"ended").pipe(rt((()=>{})))}observeError(){return this.error$}observePlaying(){return dt(this.element,"playing").pipe(rt((()=>{})))}appendTo(e){e.appendChild(this.element)}load(e){this.logger.log("load"),this.src=e;try{const e=this.getMediaSource(this.src);this.element.setAttribute("src",e),this.autoplay&&this.safePlay()}catch(e){this.error$.next(e)}}play(){this.logger.log("play");try{const e=this.getMediaSource(this.src);this.element.getAttribute("src")!==e&&this.element.setAttribute("src",e),this.safePlay()}catch(e){this.error$.next(e)}}pause(){this.logger.log("pause"),this.element.pause()}stop(){this.logger.log("stop"),this.element.pause(),this.element.currentTime=0}seek(e){this.element.currentTime=e}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}getMediaSource(e){return e.startsWith("jellyfin:")?hr.getPlayableUrlFromSrc(e):e.startsWith("plex:")?yo.getPlayableUrlFromSrc(e):e}safePlay(){return e=this,t=void 0,r=function*(){try{yield this.element.play()}catch(e){this.error$.next(e)}},new((n=void 0)||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}));var e,t,n,r}}const ic=new m("visualizer/settings"),oc={get ambientVideoEnabled(){return ic.getBoolean("ambientVideoEnabled")},set ambientVideoEnabled(e){var t;e!==this.ambientVideoEnabled&&(ic.setBoolean("ambientVideoEnabled",e),e||("ambientvideo"===this.provider&&ic.setString("provider",""),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&ic.removeItem("lockedVisualizer")),ac.next(this))},get ambientVideoSource(){return ic.getString("ambientVideoSource")},set ambientVideoSource(e){var t;e!==this.ambientVideoSource&&(ic.setString("ambientVideoSource",e),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&ic.removeItem("lockedVisualizer"),ac.next(this))},get beatsOverlay(){return ic.getBoolean("beatsOverlay")},set beatsOverlay(e){e!==this.beatsOverlay&&(ic.setBoolean("beatsOverlay",e),ac.next(this))},get useAmbientVideoSource(){return ic.getBoolean("useAmbientVideoSource")},set useAmbientVideoSource(e){var t;e!==this.useAmbientVideoSource&&(ic.setBoolean("useAmbientVideoSource",e),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&ic.removeItem("lockedVisualizer"),ac.next(this))},get lockedVisualizer(){return ic.getJson("lockedVisualizer")},set lockedVisualizer(e){if(e){const{providerId:t,name:n}=e;ic.setJson("lockedVisualizer",{providerId:t,name:n})}else ic.removeItem("lockedVisualizer");ac.next(this)},get provider(){return ic.getString("provider")},set provider(e){var t;e!==this.provider&&(ic.setString("provider",e),e&&(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)!==e&&ic.removeItem("lockedVisualizer"),ac.next(this))}},ac=new rn(oc),sc=oc;function lc(){return ac}var cc={leading:!0,trailing:!1};function uc(e,t,n){void 0===t&&(t=me),void 0===n&&(n=cc);var r=Fe(e,t);return function(e,t){return void 0===t&&(t=cc),et((function(e,n){var i=t.leading,o=t.trailing,a=!1,s=null,l=null,c=!1,u=function(){null==l||l.unsubscribe(),l=null,o&&(f(),c&&n.complete())},d=function(){l=null,c&&n.complete()},m=function(e){return l=Qe(r).subscribe(tt(n,u,d))},f=function(){if(a){a=!1;var e=s;s=null,n.next(e),!c&&m()}};e.subscribe(tt(n,(function(e){a=!0,s=e,(!l||l.closed)&&(i?f():m())}),(function(){c=!0,(!(o&&a&&l)||l.closed)&&n.complete()})))}))}(0,n)}console.log("module::playback");const dc=new rn({currentItem:null,currentTime:0,startedAt:0,endedAt:0,duration:0,paused:!0});function mc(){return dc}function fc(){return mc().pipe(Tt((e=>0!==e.startedAt)),on(((e,t)=>e.startedAt===t.startedAt)))}function hc(){return mc().pipe(Tt((e=>0!==e.endedAt)),on(((e,t)=>e.endedAt===t.endedAt)))}function pc(e=1e4){return fc().pipe(At((()=>mc().pipe(uc(e,void 0,{trailing:!0}),Pt(hc())))))}function vc(){return mc().pipe(rt((e=>e.paused)),on())}function gc(){const e=dc.getValue();e.startedAt&&(e.endedAt||dc.next(Object.assign(Object.assign({},e),{endedAt:Date.now()})),dc.next(Object.assign(Object.assign({},e),{startedAt:0,endedAt:0})))}ml().subscribe((e=>{gc(),dc.next(Object.assign(Object.assign({},dc.getValue()),{currentItem:e,currentTime:0,duration:(null==e?void 0:e.duration)||0,startedAt:0,endedAt:0}))}));const bc={get paused(){return dc.getValue().paused},observePlaybackState:mc,observePlaybackStart:fc,observePlaybackEnd:hc,observePlaybackProgress:pc,observeCurrentTime:function(){return mc().pipe(rt((e=>e.currentTime)),on())},observeDuration:function(){return mc().pipe(rt((e=>e.duration)),on())},observePaused:vc,getCurrentTime:function(){return dc.getValue().currentTime},setCurrentTime:function(e){const t=dc.getValue();(e=Math.max(Math.min(Math.floor(isFinite(e)?e:0),t.duration),0))!==t.currentTime&&dc.next(Object.assign(Object.assign({},t),{currentTime:e}))},getDuration:function(){return dc.getValue().duration},setDuration:function(e){const t=dc.getValue();if((e=Math.max(Math.floor(isFinite(e)?e:0),0))!==t.duration){const n=Math.min(t.currentTime,e);dc.next(Object.assign(Object.assign({},t),{duration:e,currentTime:n}))}},play:function(){const e=dc.getValue();e.currentItem&&e.paused&&dc.next(Object.assign(Object.assign({},e),{paused:!1}))},pause:function(){const e=dc.getValue();e.paused||dc.next(Object.assign(Object.assign({},e),{paused:!0}))},stop:function(){const e=dc.getValue();if(!e.paused||0!==e.currentTime||0!==e.startedAt&&0===e.endedAt){const t=Object.assign(Object.assign({},e),{paused:!0,currentTime:0,endedAt:e.endedAt||(e.startedAt?Date.now():0)});dc.next(t),e.startedAt&&dc.next(Object.assign(Object.assign({},t),{startedAt:0,endedAt:0}))}},started:function(){const e=dc.getValue();e.startedAt||dc.next(Object.assign(Object.assign({},e),{startedAt:Date.now()}))},ended:gc};function yc(e,t,n,r,i){var o=e*e,a=o*e;return((1-3*e+3*o-a)*t+(4-6*o+3*a)*n+(1+3*e+3*o-3*a)*r+a*i)/6}function wc(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],o=e[r+1],a=r>0?e[r-1]:2*i-o,s=r<t-1?e[r+2]:2*o-i;return yc((n-r/t)*t,a,i,o,s)}}function xc(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}var kc=Math.sqrt(50),Ec=Math.sqrt(10),Sc=Math.sqrt(2);function Cc(e,t,n){var r,i,o,a,s=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(a=function(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=kc?10:o>=Ec?5:o>=Sc?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=kc?10:o>=Ec?5:o>=Sc?2:1)}(e,t,n))||!isFinite(a))return[];if(a>0){let n=Math.round(e/a),r=Math.round(t/a);for(n*a<e&&++n,r*a>t&&--r,o=new Array(i=r-n+1);++s<i;)o[s]=(n+s)*a}else{a=-a;let n=Math.round(e*a),r=Math.round(t*a);for(n/a<e&&++n,r/a>t&&--r,o=new Array(i=r-n+1);++s<i;)o[s]=(n+s)/a}return r&&o.reverse(),o}var Tc,Ac=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Pc(e){if(!(t=Ac.exec(e)))throw new Error("invalid format: "+e);var t;return new Ic({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function Ic(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function zc(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function Mc(e,t){var n=zc(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Pc.prototype=Ic.prototype,Ic.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Nc={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Mc(100*e,t),r:Mc,s:function(e,t){var n=zc(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(Tc=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+zc(e,Math.max(0,t+o-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Oc(e){return e}var $c,jc,_c=Array.prototype.map,Rc=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function Dc(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Lc(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Fc(e){let t,n,r;function i(e,r,i=0,o=e.length){if(i<o){if(0!==t(r,r))return o;do{const t=i+o>>>1;n(e[t],r)<0?i=t+1:o=t}while(i<o)}return i}return 2!==e.length?(t=Dc,n=(t,n)=>Dc(e(t),n),r=(t,n)=>e(t)-n):(t=e===Dc||e===Lc?e:Bc,n=e,r=e),{left:i,center:function(e,t,n=0,o=e.length){const a=i(e,t,n,o-1);return a>n&&r(e[a-1],t)>-r(e[a],t)?a-1:a},right:function(e,r,i=0,o=e.length){if(i<o){if(0!==t(r,r))return o;do{const t=i+o>>>1;n(e[t],r)<=0?i=t+1:o=t}while(i<o)}return i}}}function Bc(){return 0}$c=function(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?Oc:(t=_c.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],a=0,s=t[0],l=0;i>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),o.push(e.substring(i-=s,i+s)),!((l+=s+1)>r));)s=t[a=(a+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?Oc:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(_c.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"âˆ’":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=Pc(e)).fill,n=e.align,d=e.sign,m=e.symbol,f=e.zero,h=e.width,p=e.comma,v=e.precision,g=e.trim,b=e.type;"n"===b?(p=!0,b="g"):Nc[b]||(void 0===v&&(v=12),g=!0,b="g"),(f||"0"===t&&"="===n)&&(f=!0,t="0",n="=");var y="$"===m?i:"#"===m&&/[boxX]/.test(b)?"0"+b.toLowerCase():"",w="$"===m?o:/[%p]/.test(b)?l:"",x=Nc[b],k=/[defgprs%]/.test(b);function E(e){var i,o,l,m=y,E=w;if("c"===b)E=x(e)+E,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:x(Math.abs(e),v),g&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0==+e&&"+"!==d&&(S=!1),m=(S?"("===d?d:c:"-"===d||"("===d?"":d)+m,E=("s"===b?Rc[8+Tc/3]:"")+E+(S&&"("===d?")":""),k)for(i=-1,o=e.length;++i<o;)if(48>(l=e.charCodeAt(i))||l>57){E=(46===l?a+e.slice(i+1):e.slice(i))+E,e=e.slice(0,i);break}}p&&!f&&(e=r(e,1/0));var C=m.length+e.length+E.length,T=C<h?new Array(h-C+1).join(t):"";switch(p&&f&&(e=r(T+e,T.length?h-E.length:1/0),T=""),n){case"<":e=m+e+E+T;break;case"=":e=m+T+e+E;break;case"^":e=T.slice(0,C=T.length>>1)+m+e+E+T.slice(C);break;default:e=T+m+e+E}return s(e)}return v=void 0===v?6:/[gprs]/.test(b)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v)),E.toString=function(){return e+""},E}return{format:d,formatPrefix:function(e,t){var n,r=d(((e=Pc(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor((n=t,((n=zc(Math.abs(n)))?n[1]:NaN)/3)))),o=Math.pow(10,-i),a=Rc[8+i/3];return function(e){return r(o*e)+a}}}}({thousands:",",grouping:[3],currency:["$",""]}),jc=$c.format,$c.formatPrefix;const Vc=Fc(Dc),Uc=Vc.right,Hc=(Vc.left,Fc((function(e){return null===e?NaN:+e})).center,Uc);function qc(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function Wc(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Yc(){}var Kc=.7,Xc=1/Kc,Gc="\\s*([+-]?\\d+)\\s*",Jc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Qc="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Zc=/^#([0-9a-f]{3,8})$/,eu=new RegExp(`^rgb\\(${Gc},${Gc},${Gc}\\)$`),tu=new RegExp(`^rgb\\(${Qc},${Qc},${Qc}\\)$`),nu=new RegExp(`^rgba\\(${Gc},${Gc},${Gc},${Jc}\\)$`),ru=new RegExp(`^rgba\\(${Qc},${Qc},${Qc},${Jc}\\)$`),iu=new RegExp(`^hsl\\(${Jc},${Qc},${Qc}\\)$`),ou=new RegExp(`^hsla\\(${Jc},${Qc},${Qc},${Jc}\\)$`),au={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function su(){return this.rgb().formatHex()}function lu(){return this.rgb().formatRgb()}function cu(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Zc.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?uu(t):3===n?new hu(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?du(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?du(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=eu.exec(e))?new hu(t[1],t[2],t[3],1):(t=tu.exec(e))?new hu(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=nu.exec(e))?du(t[1],t[2],t[3],t[4]):(t=ru.exec(e))?du(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=iu.exec(e))?wu(t[1],t[2]/100,t[3]/100,1):(t=ou.exec(e))?wu(t[1],t[2]/100,t[3]/100,t[4]):au.hasOwnProperty(e)?uu(au[e]):"transparent"===e?new hu(NaN,NaN,NaN,0):null}function uu(e){return new hu(e>>16&255,e>>8&255,255&e,1)}function du(e,t,n,r){return r<=0&&(e=t=n=NaN),new hu(e,t,n,r)}function mu(e){return e instanceof Yc||(e=cu(e)),e?new hu((e=e.rgb()).r,e.g,e.b,e.opacity):new hu}function fu(e,t,n,r){return 1===arguments.length?mu(e):new hu(e,t,n,null==r?1:r)}function hu(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function pu(){return`#${yu(this.r)}${yu(this.g)}${yu(this.b)}`}function vu(){const e=gu(this.opacity);return`${1===e?"rgb(":"rgba("}${bu(this.r)}, ${bu(this.g)}, ${bu(this.b)}${1===e?")":`, ${e})`}`}function gu(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function bu(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function yu(e){return((e=bu(e))<16?"0":"")+e.toString(16)}function wu(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new ku(e,t,n,r)}function xu(e){if(e instanceof ku)return new ku(e.h,e.s,e.l,e.opacity);if(e instanceof Yc||(e=cu(e)),!e)return new ku;if(e instanceof ku)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),o=Math.max(t,n,r),a=NaN,s=o-i,l=(o+i)/2;return s?(a=t===o?(n-r)/s+6*(n<r):n===o?(r-t)/s+2:(t-n)/s+4,s/=l<.5?o+i:2-o-i,a*=60):s=l>0&&l<1?0:a,new ku(a,s,l,e.opacity)}function ku(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Eu(e){return(e=(e||0)%360)<0?e+360:e}function Su(e){return Math.max(0,Math.min(1,e||0))}function Cu(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}qc(Yc,cu,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:su,formatHex:su,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return xu(this).formatHsl()},formatRgb:lu,toString:lu}),qc(hu,fu,Wc(Yc,{brighter(e){return e=null==e?Xc:Math.pow(Xc,e),new hu(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?Kc:Math.pow(Kc,e),new hu(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new hu(bu(this.r),bu(this.g),bu(this.b),gu(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:pu,formatHex:pu,formatHex8:function(){return`#${yu(this.r)}${yu(this.g)}${yu(this.b)}${yu(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:vu,toString:vu})),qc(ku,(function(e,t,n,r){return 1===arguments.length?xu(e):new ku(e,t,n,null==r?1:r)}),Wc(Yc,{brighter(e){return e=null==e?Xc:Math.pow(Xc,e),new ku(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?Kc:Math.pow(Kc,e),new ku(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new hu(Cu(e>=240?e-240:e+120,i,r),Cu(e,i,r),Cu(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new ku(Eu(this.h),Su(this.s),Su(this.l),gu(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=gu(this.opacity);return`${1===e?"hsl(":"hsla("}${Eu(this.h)}, ${100*Su(this.s)}%, ${100*Su(this.l)}%${1===e?")":`, ${e})`}`}}));const Tu=e=>()=>e;function Au(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):Tu(isNaN(e)?t:e)}const Pu=function e(t){var n=function(e){return 1==(e=+e)?Au:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):Tu(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=fu(e)).r,(t=fu(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),a=Au(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);function Iu(e){return function(t){var n,r,i=t.length,o=new Array(i),a=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=fu(t[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=e(o),a=e(a),s=e(s),r.opacity=1,function(e){return r.r=o(e),r.g=a(e),r.b=s(e),r+""}}}function zu(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=Du(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<i;++n)a[n]=o[n](e);return a}}function Mu(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Nu(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Ou(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=Du(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}Iu(wc),Iu((function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],o=e[r%t],a=e[(r+1)%t],s=e[(r+2)%t];return yc((n-r/t)*t,i,o,a,s)}}));var $u=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ju=new RegExp($u.source,"g");function _u(e,t){var n,r,i,o=$u.lastIndex=ju.lastIndex=0,a=-1,s=[],l=[];for(e+="",t+="";(n=$u.exec(e))&&(r=ju.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,l.push({i:a,x:Nu(n,r)})),o=ju.lastIndex;return o<t.length&&(i=t.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})}function Ru(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(n=0;n<r;++n)i[n]=e[n]*(1-o)+t[n]*o;return i}}function Du(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?Tu(t):("number"===i?Nu:"string"===i?(n=cu(t))?(t=n,Pu):_u:t instanceof cu?Pu:t instanceof Date?Mu:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?zu:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Ou:Nu:Ru))(e,t)}function Lu(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function Fu(e){return+e}var Bu=[0,1];function Vu(e){return e}function Uu(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function Hu(e,t,n){var r=e[0],i=e[1],o=t[0],a=t[1];return i<r?(r=Uu(i,r),o=n(a,o)):(r=Uu(r,i),o=n(o,a)),function(e){return o(r(e))}}function qu(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)i[a]=Uu(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(t){var n=Hc(e,t,1,r)-1;return o[n](i[n](t))}}function Wu(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Yu(){var e,t,n,r,i,o,a=Bu,s=Bu,l=Du,c=Vu;function u(){var e,t,n,l=Math.min(a.length,s.length);return c!==Vu&&(e=a[0],t=a[l-1],e>t&&(n=e,e=t,t=n),c=function(n){return Math.max(e,Math.min(t,n))}),r=l>2?qu:Hu,i=o=null,d}function d(t){return null==t||isNaN(t=+t)?n:(i||(i=r(a.map(e),s,l)))(e(c(t)))}return d.invert=function(n){return c(t((o||(o=r(s,a.map(e),Nu)))(n)))},d.domain=function(e){return arguments.length?(a=Array.from(e,Fu),u()):a.slice()},d.range=function(e){return arguments.length?(s=Array.from(e),u()):s.slice()},d.rangeRound=function(e){return s=Array.from(e),l=Lu,u()},d.clamp=function(e){return arguments.length?(c=!!e||Vu,u()):c!==Vu},d.interpolate=function(e){return arguments.length?(l=e,u()):l},d.unknown=function(e){return arguments.length?(n=e,d):n},function(n,r){return e=n,t=r,u()}}function Ku(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Xu(e){return Math.log(e)}function Gu(e){return Math.exp(e)}function Ju(e){return-Math.log(-e)}function Qu(e){return-Math.exp(-e)}function Zu(e){return isFinite(e)?+("1e"+e):e<0?0:e}function ed(e){return(t,n)=>-e(-t,n)}function td(e){const t=e(Xu,Gu),n=t.domain;let r,i,o=10;function a(){return r=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}(o),i=function(e){return 10===e?Zu:e===Math.E?Math.exp:t=>Math.pow(e,t)}(o),n()[0]<0?(r=ed(r),i=ed(i),e(Ju,Qu)):e(Xu,Gu),t}return t.base=function(e){return arguments.length?(o=+e,a()):o},t.domain=function(e){return arguments.length?(n(e),a()):n()},t.ticks=e=>{const t=n();let a=t[0],s=t[t.length-1];const l=s<a;l&&([a,s]=[s,a]);let c,u,d=r(a),m=r(s);const f=null==e?10:+e;let h=[];if(!(o%1)&&m-d<f){if(d=Math.floor(d),m=Math.ceil(m),a>0){for(;d<=m;++d)for(c=1;c<o;++c)if(u=d<0?c/i(-d):c*i(d),!(u<a)){if(u>s)break;h.push(u)}}else for(;d<=m;++d)for(c=o-1;c>=1;--c)if(u=d>0?c/i(-d):c*i(d),!(u<a)){if(u>s)break;h.push(u)}2*h.length<f&&(h=Cc(a,s,f))}else h=Cc(d,m,Math.min(m-d,f)).map(i);return l?h.reverse():h},t.tickFormat=(e,n)=>{if(null==e&&(e=10),null==n&&(n=10===o?"s":","),"function"!=typeof n&&(o%1||null!=(n=Pc(n)).precision||(n.trim=!0),n=jc(n)),e===1/0)return n;const a=Math.max(1,o*e/t.ticks().length);return e=>{let t=e/i(Math.round(r(e)));return t*o<o-.5&&(t*=o),t<=a?n(e):""}},t.nice=()=>n(function(e,t){var n,r=0,i=(e=e.slice()).length-1,o=e[r],a=e[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),e[r]=t.floor(o),e[i]=t.ceil(a),e}(n(),{floor:e=>i(Math.floor(r(e))),ceil:e=>i(Math.ceil(r(e)))})),t}function nd(){const e=td(Yu()).domain([1,10]);return e.copy=()=>Wu(e,nd()).base(e.base()),Ku.apply(e,arguments),e}const rd=[16.35,17.32,18.35,19.45,20.6,21.83,23.12,24.5,25.96,27.5,29.14,30.87].map(((e,t)=>{const n=[{index:t,value:e}];for(let r=1;r<12;r++)n[r]={index:t,value:e*Math.pow(2,r)};return n})).flat().sort(((e,t)=>e.value-t.value));function id(e,t,n){return function(e,t){const n=e*t,r=n+t,i=rd.filter((e=>e.value>=n&&e.value<r));if(i.length>0)return i.map((({index:e})=>({index:e,value:1})));for(let e=0;e<rd.length;e++){const t=rd[e];if(t.value>r){const i=rd[e-1],o=t.value-i.value;return[{index:i.index,value:1-(r-i.value)/o},{index:t.index,value:1-(t.value-n)/o}]}}return[]}(t,n).map((({index:t,value:n})=>e[t]*n)).reduce(((e,t)=>e+t),0)}var od,ad=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};od=new WeakMap;const sd=new class{constructor(e){this.intervalTypes=["bars","beats","sections","segments","tatums"],this.animationFrameId=0,this.currentTrackId="",this.currentTrackAnalysis=null,this.trackAnalysis={},this.initialTrackProgress=0,this.initialStart=0,this.trackProgress=0,this.active=!1,this.queues={volume:[],beat:[]},this.activeIntervals$=new rn({bars:{},beats:{},sections:{},segments:{},tatums:{}}),this.fftSize=2048,this.volumeSmoothing=100,od.set(this,0),e.observeCurrentTrackState().subscribe((t=>ad(this,void 0,void 0,(function*(){var n,r;const i=null===(r=null===(n=null==t?void 0:t.track_window)||void 0===n?void 0:n.current_track)||void 0===r?void 0:r.id;if(i&&this.currentTrackId!==i){this.currentTrackId=i,this.currentTrackAnalysis=null;try{this.currentTrackAnalysis=yield da.getAudioAnalysisForTrack(i),t=yield e.getCurrentState()}catch(e){console.error(e),this.currentTrackAnalysis=null,t=null}}t&&this.currentTrackAnalysis&&this.updateState(t),this.active=!(!this.currentTrackAnalysis||!t||t.paused||t.loading),this.active?this.start():this.stop()}))))}get bar(){return this.activeIntervals.bars}get beat(){return this.activeIntervals.beats}get frequencyBinCount(){return this.fftSize/2}get section(){return this.activeIntervals.sections}get segment(){return this.activeIntervals.segments}get tatum(){return this.activeIntervals.tatums}get volume(){return function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,od,"f")}observeBar(){return this.observeActiveIntervals().pipe(rt((e=>e.bars)),on())}observeBeat(){return this.observeActiveIntervals().pipe(rt((e=>e.beats)),on())}observeSection(){return this.observeActiveIntervals().pipe(rt((e=>e.sections)),on())}observeSegment(){return this.observeActiveIntervals().pipe(rt((e=>e.segments)),on())}observeTatum(){return this.observeActiveIntervals().pipe(rt((e=>e.tatums)),on())}getByteFrequencyData(e){if(!this.active)return void e.fill(0);const t=this.segment.pitches;if(t){const n=(this.segment.timbre[1]-180)/360,r=this.frequencyBinCount,i=wc([64,255*this.volume,64])(this.beat.progress);for(let o=0;o<r;o++){const a=id(t,o,this.sampleSize);let s=(o-r/2-n*r)/r+1;(s<0||s>2)&&(s=0),e[o]=Math.sin(s*(Math.PI/2))*a*i}}else e.fill(0)}getByteTimeDomainData(e){e.fill(128)}get activeIntervals(){return this.activeIntervals$.getValue()}get sampleSize(){return 22050/this.frequencyBinCount}observeActiveIntervals(){return vc().pipe(At((e=>e?ht:this.activeIntervals$)),Tt((()=>this.active)))}updateState(e){return ad(this,void 0,void 0,(function*(){this.trackAnalysis=JSON.parse(JSON.stringify(this.currentTrackAnalysis)),this.intervalTypes.forEach((e=>{const t=this.trackAnalysis[e];t[0].duration=t[0].start+t[0].duration,t[0].start=0,t.forEach((e=>{this.isSegment(e)&&(e.loudness_max_time=1e3*e.loudness_max_time),e.start=1e3*(e.start||0),e.duration=1e3*(e.duration||0)}))})),this.initialTrackProgress=e.position,this.trackProgress=e.position,this.initialStart=window.performance.now()}))}setActiveIntervals(){const e=this.activeIntervals,t=e=>{const t=this.trackAnalysis[e],n=this.trackProgress;for(let e=0;e<t.length;e++){if(e===t.length-1)return e;if(t[e].start<n&&n<t[e+1].start)return e}return 0};this.intervalTypes.forEach((n=>{const r=t(n);null!=e[n].start&&r===e[n].index||(e[n]=Object.assign(Object.assign({},this.trackAnalysis[n][r]),{index:r}));const{start:i,duration:o}=e[n],a=this.trackProgress-i;e[n].elapsed=a,e[n].progress=this.easeOutQuart(a/o)})),this.activeIntervals$.next(e)}getVolume(){const{loudness_max:e,loudness_start:t,loudness_max_time:n,duration:r,elapsed:i,start:o,index:a}=this.activeIntervals.segments;if(!this.trackAnalysis.segments[a+1])return 0;const s=this.trackAnalysis.segments[a+1].loudness_start,l=o+i;if(i<n){const r=Math.min(1,i/n);return this.interpolate(t,e)(r)}{const t=l-(o+n),i=r-n,a=Math.min(1,t/i);return this.interpolate(e,s)(a)}}start(){this.animationFrameId||(this.animationFrameId=requestAnimationFrame((e=>this.tick(e))))}stop(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}tick(e){if(this.animationFrameId=requestAnimationFrame((e=>this.tick(e))),!this.active)return;this.trackProgress=e-this.initialStart+this.initialTrackProgress,this.setActiveIntervals();const t=this.getVolume(),n=this.queues;function r(e){return e.reduce(((e,t)=>e+t))/e.length}n.volume.unshift(t),n.volume.length>400&&n.volume.pop(),n.beat.unshift(t),n.beat.length>this.volumeSmoothing&&n.beat.pop();const i=nd().domain([xc(n.volume),r(n.volume)]).range([0,1]),o=r(n.beat);!function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,od,i(o)||0,"f")}interpolate(e,t){return n=>e*(1-n)+t*n}isSegment(e){return"loudness_max_time"in e}easeOutQuart(e){return e=Math.min(Math.max(0,e),1),1- --e*e*e*e}}(Ba);console.log("module::audio");const ld=new AudioContext,cd=new AnalyserNode(ld,{fftSize:2048,smoothingTimeConstant:0}),ud=new class{constructor(e,t){this.analyserNode=e,this.spotifyAudioAnalyser=t,this.currentAnalyser=e,fc().subscribe((({currentItem:n})=>{n.src.startsWith("spotify:")?this.currentAnalyser=t:this.currentAnalyser=e}))}get fftSize(){return this.analyserNode.fftSize}set fftSize(e){this.analyserNode.fftSize=e,this.spotifyAudioAnalyser.fftSize=e}get frequencyBinCount(){return this.analyserNode.frequencyBinCount}getByteFrequencyData(e){this.currentAnalyser.getByteFrequencyData(e)}getByteTimeDomainData(e){this.currentAnalyser.getByteTimeDomainData(e)}}(cd,sd);let dd,md;cd.connect(ld.destination);const fd=new rn(ld.createMediaElementSource(new Audio));function hd(){return fd.pipe(on())}fc().subscribe((({currentItem:e})=>{if(e.src.startsWith("apple:")){if(!md){const e=document.querySelector("audio#apple-music-player");e&&(md=ld.createMediaElementSource(e))}md&&fd.next(md)}else{if(!dd){const e=document.querySelector("audio.html5-audio");e&&(dd=ld.createMediaElementSource(e))}dd&&fd.next(dd)}})),hd().pipe(Ia(1)).subscribe((e=>e.connect(cd)));const pd=new s("WaveformPlayer");class vd extends nc{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-waveform"}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e||this.animationFrameId||this.render(performance.now()))}appendTo(e){e.append(this.canvas)}load(e){pd.log("load"),e&&(pd.log(`Using Waveform visualizer: ${e.name}`),this.config=e.config),this.autoplay&&this.play()}play(){pd.log("play"),this.animationFrameId||this.render(performance.now())}pause(){pd.log("pause"),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}stop(){pd.log("stop"),this.pause(),this.clear()}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.renderFrame(performance.now())}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(e){this.renderFrame(e),this.autoplay&&!this.hidden&&(this.animationFrameId=requestAnimationFrame((e=>this.render(e))))}renderFrame(e){var t,n;const r=this.context2D,i=this.canvas.width,o=this.canvas.height,a=this.analyser;null===(n=null===(t=this.config)||void 0===t?void 0:t.onPaint)||void 0===n||n.call(t,{context2D:r,width:i,height:o,now:e,analyser:a})}}const gd=new vd(ud);gd.load({providerId:"waveform",name:"bars",config:{onPaint:({context2D:e,width:t,height:n,analyser:r})=>{const i=r.frequencyBinCount,o=new Uint8Array(i);r.getByteFrequencyData(o),e.clearRect(0,0,t,n),e.fillStyle=`rgba(255, 255, 255, ${document.fullscreenElement?.45:.6})`,e.strokeStyle="rgba(0, 0, 0, .9)",e.shadowColor="rgba(0, 0, 0, .6)",e.lineWidth=1,e.shadowBlur=2,e.shadowOffsetX=2,e.shadowOffsetY=2;const a=(t-48)/12,s=.0075*n,l=i/12;let c,u=4;for(let t=0;t<i;t+=l){const r=o.slice(t,t+l).reduce(((e,t)=>e+t),0)/l;c=s*r,e.fillRect(u,n-c/2,a,c/2+4),e.strokeRect(u,n-c/2,a,c/2+4),u+=a+4}}}});const bd=gd;function yd(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function wd(e){return Math.min(1,Math.max(0,e))}function xd(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function kd(e){return e<=1?"".concat(100*Number(e),"%"):e}function Ed(e){return 1===e.length?"0"+e:String(e)}function Sd(e,t,n){e=yd(e,255),t=yd(t,255),n=yd(n,255);var r=Math.max(e,t,n),i=Math.min(e,t,n),o=0,a=0,s=(r+i)/2;if(r===i)a=0,o=0;else{var l=r-i;switch(a=s>.5?l/(2-r-i):l/(r+i),r){case e:o=(t-n)/l+(t<n?6:0);break;case t:o=(n-e)/l+2;break;case n:o=(e-t)/l+4}o/=6}return{h:o,s:a,l:s}}function Cd(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*n*(t-e):n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Td(e,t,n){e=yd(e,255),t=yd(t,255),n=yd(n,255);var r=Math.max(e,t,n),i=Math.min(e,t,n),o=0,a=r,s=r-i,l=0===r?0:s/r;if(r===i)o=0;else{switch(r){case e:o=(t-n)/s+(t<n?6:0);break;case t:o=(n-e)/s+2;break;case n:o=(e-t)/s+4}o/=6}return{h:o,s:l,v:a}}function Ad(e,t,n,r){var i=[Ed(Math.round(e).toString(16)),Ed(Math.round(t).toString(16)),Ed(Math.round(n).toString(16))];return r&&i[0].startsWith(i[0].charAt(1))&&i[1].startsWith(i[1].charAt(1))&&i[2].startsWith(i[2].charAt(1))?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function Pd(e){return Id(e)/255}function Id(e){return parseInt(e,16)}var zd={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};var Md="(?:".concat("[-\\+]?\\d*\\.\\d+%?",")|(?:").concat("[-\\+]?\\d+%?",")"),Nd="[\\s|\\(]+(".concat(Md,")[,|\\s]+(").concat(Md,")[,|\\s]+(").concat(Md,")\\s*\\)?"),Od="[\\s|\\(]+(".concat(Md,")[,|\\s]+(").concat(Md,")[,|\\s]+(").concat(Md,")[,|\\s]+(").concat(Md,")\\s*\\)?"),$d={CSS_UNIT:new RegExp(Md),rgb:new RegExp("rgb"+Nd),rgba:new RegExp("rgba"+Od),hsl:new RegExp("hsl"+Nd),hsla:new RegExp("hsla"+Od),hsv:new RegExp("hsv"+Nd),hsva:new RegExp("hsva"+Od),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function jd(e){return Boolean($d.CSS_UNIT.exec(String(e)))}var _d=function(){function e(t,n){var r;if(void 0===t&&(t=""),void 0===n&&(n={}),t instanceof e)return t;"number"==typeof t&&(t=function(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}(t)),this.originalInput=t;var i=function(e){var t,n,r,i={r:0,g:0,b:0},o=1,a=null,s=null,l=null,c=!1,u=!1;return"string"==typeof e&&(e=function(e){if(0===(e=e.trim().toLowerCase()).length)return!1;var t=!1;if(zd[e])e=zd[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var n=$d.rgb.exec(e);return n?{r:n[1],g:n[2],b:n[3]}:(n=$d.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=$d.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=$d.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=$d.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=$d.hsva.exec(e))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=$d.hex8.exec(e))?{r:Id(n[1]),g:Id(n[2]),b:Id(n[3]),a:Pd(n[4]),format:t?"name":"hex8"}:(n=$d.hex6.exec(e))?{r:Id(n[1]),g:Id(n[2]),b:Id(n[3]),format:t?"name":"hex"}:(n=$d.hex4.exec(e))?{r:Id(n[1]+n[1]),g:Id(n[2]+n[2]),b:Id(n[3]+n[3]),a:Pd(n[4]+n[4]),format:t?"name":"hex8"}:!!(n=$d.hex3.exec(e))&&{r:Id(n[1]+n[1]),g:Id(n[2]+n[2]),b:Id(n[3]+n[3]),format:t?"name":"hex"}}(e)),"object"==typeof e&&(jd(e.r)&&jd(e.g)&&jd(e.b)?(t=e.r,n=e.g,r=e.b,i={r:255*yd(t,255),g:255*yd(n,255),b:255*yd(r,255)},c=!0,u="%"===String(e.r).substr(-1)?"prgb":"rgb"):jd(e.h)&&jd(e.s)&&jd(e.v)?(a=kd(e.s),s=kd(e.v),i=function(e,t,n){e=6*yd(e,360),t=yd(t,100),n=yd(n,100);var r=Math.floor(e),i=e-r,o=n*(1-t),a=n*(1-i*t),s=n*(1-(1-i)*t),l=r%6;return{r:255*[n,a,o,o,s,n][l],g:255*[s,n,n,a,o,o][l],b:255*[o,o,s,n,n,a][l]}}(e.h,a,s),c=!0,u="hsv"):jd(e.h)&&jd(e.s)&&jd(e.l)&&(a=kd(e.s),l=kd(e.l),i=function(e,t,n){var r,i,o;if(e=yd(e,360),t=yd(t,100),n=yd(n,100),0===t)i=n,o=n,r=n;else{var a=n<.5?n*(1+t):n+t-n*t,s=2*n-a;r=Cd(s,a,e+1/3),i=Cd(s,a,e),o=Cd(s,a,e-1/3)}return{r:255*r,g:255*i,b:255*o}}(e.h,a,l),c=!0,u="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(o=e.a)),o=xd(o),{ok:c,format:e.format||u,r:Math.min(255,Math.max(i.r,0)),g:Math.min(255,Math.max(i.g,0)),b:Math.min(255,Math.max(i.b,0)),a:o}}(t);this.originalInput=t,this.r=i.r,this.g=i.g,this.b=i.b,this.a=i.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(r=n.format)&&void 0!==r?r:i.format,this.gradientType=n.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=i.ok}return e.prototype.isDark=function(){return this.getBrightness()<128},e.prototype.isLight=function(){return!this.isDark()},e.prototype.getBrightness=function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},e.prototype.getLuminance=function(){var e=this.toRgb(),t=e.r/255,n=e.g/255,r=e.b/255;return.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.0722*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))},e.prototype.getAlpha=function(){return this.a},e.prototype.setAlpha=function(e){return this.a=xd(e),this.roundA=Math.round(100*this.a)/100,this},e.prototype.isMonochrome=function(){return 0===this.toHsl().s},e.prototype.toHsv=function(){var e=Td(this.r,this.g,this.b);return{h:360*e.h,s:e.s,v:e.v,a:this.a}},e.prototype.toHsvString=function(){var e=Td(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),r=Math.round(100*e.v);return 1===this.a?"hsv(".concat(t,", ").concat(n,"%, ").concat(r,"%)"):"hsva(".concat(t,", ").concat(n,"%, ").concat(r,"%, ").concat(this.roundA,")")},e.prototype.toHsl=function(){var e=Sd(this.r,this.g,this.b);return{h:360*e.h,s:e.s,l:e.l,a:this.a}},e.prototype.toHslString=function(){var e=Sd(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),r=Math.round(100*e.l);return 1===this.a?"hsl(".concat(t,", ").concat(n,"%, ").concat(r,"%)"):"hsla(".concat(t,", ").concat(n,"%, ").concat(r,"%, ").concat(this.roundA,")")},e.prototype.toHex=function(e){return void 0===e&&(e=!1),Ad(this.r,this.g,this.b,e)},e.prototype.toHexString=function(e){return void 0===e&&(e=!1),"#"+this.toHex(e)},e.prototype.toHex8=function(e){return void 0===e&&(e=!1),function(e,t,n,r,i){var o,a=[Ed(Math.round(e).toString(16)),Ed(Math.round(t).toString(16)),Ed(Math.round(n).toString(16)),Ed((o=r,Math.round(255*parseFloat(o)).toString(16)))];return i&&a[0].startsWith(a[0].charAt(1))&&a[1].startsWith(a[1].charAt(1))&&a[2].startsWith(a[2].charAt(1))&&a[3].startsWith(a[3].charAt(1))?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0)+a[3].charAt(0):a.join("")}(this.r,this.g,this.b,this.a,e)},e.prototype.toHex8String=function(e){return void 0===e&&(e=!1),"#"+this.toHex8(e)},e.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},e.prototype.toRgbString=function(){var e=Math.round(this.r),t=Math.round(this.g),n=Math.round(this.b);return 1===this.a?"rgb(".concat(e,", ").concat(t,", ").concat(n,")"):"rgba(".concat(e,", ").concat(t,", ").concat(n,", ").concat(this.roundA,")")},e.prototype.toPercentageRgb=function(){var e=function(e){return"".concat(Math.round(100*yd(e,255)),"%")};return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}},e.prototype.toPercentageRgbString=function(){var e=function(e){return Math.round(100*yd(e,255))};return 1===this.a?"rgb(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%)"):"rgba(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%, ").concat(this.roundA,")")},e.prototype.toName=function(){if(0===this.a)return"transparent";if(this.a<1)return!1;for(var e="#"+Ad(this.r,this.g,this.b,!1),t=0,n=Object.entries(zd);t<n.length;t++){var r=n[t],i=r[0];if(e===r[1])return i}return!1},e.prototype.toString=function(e){var t=Boolean(e);e=null!=e?e:this.format;var n=!1,r=this.a<1&&this.a>=0;return t||!r||!e.startsWith("hex")&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this.a?this.toName():this.toRgbString()},e.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},e.prototype.clone=function(){return new e(this.toString())},e.prototype.lighten=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.l+=t/100,n.l=wd(n.l),new e(n)},e.prototype.brighten=function(t){void 0===t&&(t=10);var n=this.toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-t/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-t/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-t/100*255))),new e(n)},e.prototype.darken=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.l-=t/100,n.l=wd(n.l),new e(n)},e.prototype.tint=function(e){return void 0===e&&(e=10),this.mix("white",e)},e.prototype.shade=function(e){return void 0===e&&(e=10),this.mix("black",e)},e.prototype.desaturate=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.s-=t/100,n.s=wd(n.s),new e(n)},e.prototype.saturate=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.s+=t/100,n.s=wd(n.s),new e(n)},e.prototype.greyscale=function(){return this.desaturate(100)},e.prototype.spin=function(t){var n=this.toHsl(),r=(n.h+t)%360;return n.h=r<0?360+r:r,new e(n)},e.prototype.mix=function(t,n){void 0===n&&(n=50);var r=this.toRgb(),i=new e(t).toRgb(),o=n/100;return new e({r:(i.r-r.r)*o+r.r,g:(i.g-r.g)*o+r.g,b:(i.b-r.b)*o+r.b,a:(i.a-r.a)*o+r.a})},e.prototype.analogous=function(t,n){void 0===t&&(t=6),void 0===n&&(n=30);var r=this.toHsl(),i=360/n,o=[this];for(r.h=(r.h-(i*t>>1)+720)%360;--t;)r.h=(r.h+i)%360,o.push(new e(r));return o},e.prototype.complement=function(){var t=this.toHsl();return t.h=(t.h+180)%360,new e(t)},e.prototype.monochromatic=function(t){void 0===t&&(t=6);for(var n=this.toHsv(),r=n.h,i=n.s,o=n.v,a=[],s=1/t;t--;)a.push(new e({h:r,s:i,v:o})),o=(o+s)%1;return a},e.prototype.splitcomplement=function(){var t=this.toHsl(),n=t.h;return[this,new e({h:(n+72)%360,s:t.s,l:t.l}),new e({h:(n+216)%360,s:t.s,l:t.l})]},e.prototype.onBackground=function(t){var n=this.toRgb(),r=new e(t).toRgb();return new e({r:r.r+(n.r-r.r)*n.a,g:r.g+(n.g-r.g)*n.a,b:r.b+(n.b-r.b)*n.a})},e.prototype.triad=function(){return this.polyad(3)},e.prototype.tetrad=function(){return this.polyad(4)},e.prototype.polyad=function(t){for(var n=this.toHsl(),r=n.h,i=[this],o=360/t,a=1;a<t;a++)i.push(new e({h:(r+a*o)%360,s:n.s,l:n.l}));return i},e.prototype.equals=function(t){return this.toRgbString()===new e(t).toRgbString()},e}();function Rd(e,t){var n=new _d(e),r=new _d(t);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)}function Dd(e,t,n){void 0===n&&(n={includeFallbackColors:!1,level:"AA",size:"small"});for(var r=null,i=0,o=n.includeFallbackColors,a=n.level,s=n.size,l=0,c=t;l<c.length;l++){var u=c[l],d=Rd(e,u);d>i&&(i=d,r=new _d(u))}return function(e,t,n){var r,i;void 0===n&&(n={level:"AA",size:"small"});var o=Rd(e,t);switch((null!==(r=n.level)&&void 0!==r?r:"AA")+(null!==(i=n.size)&&void 0!==i?i:"small")){case"AAsmall":case"AAAlarge":return o>=4.5;case"AAlarge":return o>=3;case"AAAsmall":return o>=7;default:return!1}}(e,r,{level:a,size:s})||!o?r:(n.includeFallbackColors=!1,Dd(e,["#fff","#000"],n))}const Ld=JSON.parse('{"name":"Astronaut","backgroundColor":"#000000","textColor":"#95a5d6","frameColor":"#141415","frameTextColor":"#b1bdcd","buttonColor":"","buttonTextColor":"","mediaButtonColor":"","mediaButtonTextColor":"","selectedBackgroundColor":"#0b246f","selectedTextColor":"#ffffff","evenRowBackgroundColor":"","spacing":0.72,"roundness":0.57,"flat":false}'),Fd=JSON.parse('{"name":"Black Gold","backgroundColor":"#0d0c0c","textColor":"#cbccad","frameColor":"#1c1c12","frameTextColor":"#e8e8bf","buttonColor":"","buttonTextColor":"","mediaButtonColor":"","mediaButtonTextColor":"","selectedBackgroundColor":"","selectedTextColor":"","evenRowBackgroundColor":"","spacing":0.375,"roundness":0.25,"flat":false}'),Bd=JSON.parse('{"name":"","backgroundColor":"#0d0f12","textColor":"#8facbc","frameColor":"#32312f","frameTextColor":"#d1d1d1","buttonColor":"","buttonTextColor":"","mediaButtonColor":"","mediaButtonTextColor":"","selectedBackgroundColor":"#163d5a","selectedTextColor":"","evenRowBackgroundColor":"","spacing":0.38,"roundness":0.48,"flat":false}'),Vd=JSON.parse('{"name":"Grey Green","backgroundColor":"#0f0f10","textColor":"#d1f5d2","frameColor":"#24322c","frameTextColor":"#c3feca","buttonColor":"","buttonTextColor":"","mediaButtonColor":"","mediaButtonTextColor":"","selectedBackgroundColor":"#80b19c","selectedTextColor":"#000000","evenRowBackgroundColor":"","spacing":0.375,"roundness":0.25,"flat":false}'),Ud=JSON.parse('{"name":"Indigo","backgroundColor":"#06181e","textColor":"#d1d3f5","frameColor":"#43477a","frameTextColor":"#f3f3f7","buttonColor":"","buttonTextColor":"","mediaButtonColor":"","mediaButtonTextColor":"","selectedBackgroundColor":"#477a43","selectedTextColor":"#ffffff","evenRowBackgroundColor":"","spacing":0.625,"roundness":0.84375,"flat":true}'),Hd=JSON.parse('{"name":"Lemon","backgroundColor":"#e7fdfc","textColor":"#000000","frameColor":"#ecdd36","frameTextColor":"#180c06","buttonColor":"","buttonTextColor":"","mediaButtonColor":"","mediaButtonTextColor":"","selectedBackgroundColor":"#001eff","selectedTextColor":"#fcf8f8","evenRowBackgroundColor":"","spacing":0.375,"roundness":0,"flat":true}'),qd=JSON.parse('{"name":"Lilac","backgroundColor":"#12051a","textColor":"#f5d1ed","frameColor":"#79437a","frameTextColor":"#f3f7f3","buttonColor":"","buttonTextColor":"","mediaButtonColor":"","mediaButtonTextColor":"","selectedBackgroundColor":"#7a7943","selectedTextColor":"#ffffff","evenRowBackgroundColor":"","spacing":0.625,"roundness":0.84375,"flat":true}'),Wd=JSON.parse('{"name":"Moody Blue","backgroundColor":"#16141a","textColor":"#bec1c0","frameColor":"#125673","frameTextColor":"#d8eee7","buttonColor":"","buttonTextColor":"","mediaButtonColor":"","mediaButtonTextColor":"","selectedBackgroundColor":"#124373","selectedTextColor":"#ffffff","evenRowBackgroundColor":"","spacing":0.53125,"roundness":0.40625,"flat":false}'),Yd=JSON.parse('{"name":"(none)","backgroundColor":"#000000","textColor":"#ebebeb","frameColor":"#000000","frameTextColor":"#ebebeb","buttonColor":"","buttonTextColor":"","mediaButtonColor":"","mediaButtonTextColor":"","selectedBackgroundColor":"#414141","selectedTextColor":"#ffffff","evenRowBackgroundColor":"","spacing":0,"roundness":0,"flat":false}'),Kd=JSON.parse('{"name":"Olive Oil","backgroundColor":"#181e10","textColor":"#a6c464","frameColor":"#81810e","frameTextColor":"#181816","buttonColor":"","buttonTextColor":"","mediaButtonColor":"","mediaButtonTextColor":"","selectedBackgroundColor":"#6a810e","selectedTextColor":"#ffffff","evenRowBackgroundColor":"","spacing":0.375,"roundness":0.25,"flat":false}'),Xd=JSON.parse('{"name":"Pale Pink","backgroundColor":"#f7f7f7","textColor":"#120f0c","frameColor":"#cfbdd0","frameTextColor":"#121211","buttonColor":"","buttonTextColor":"","mediaButtonColor":"","mediaButtonTextColor":"","selectedBackgroundColor":"#7a707b","selectedTextColor":"#ffffff","evenRowBackgroundColor":"","spacing":0.375,"roundness":0.53125,"flat":true}'),Gd=JSON.parse('{"name":"Purplelicious (Winamp)","backgroundColor":"#000000","textColor":"#ffb464","frameColor":"#3e0445","frameTextColor":"#ffb464","buttonColor":"","buttonTextColor":"","mediaButtonColor":"","mediaButtonTextColor":"","selectedBackgroundColor":"#3e0445","selectedTextColor":"#ffb464","evenRowBackgroundColor":"","spacing":0.21875,"roundness":0.09375,"flat":false}'),Jd=JSON.parse('{"name":"Saddle","backgroundColor":"#271607","textColor":"#cbbe86","frameColor":"#331d0a","frameTextColor":"#fedfc3","buttonColor":"","buttonTextColor":"","mediaButtonColor":"","mediaButtonTextColor":"","selectedBackgroundColor":"#5d3512","selectedTextColor":"#ffffff","evenRowBackgroundColor":"","spacing":0.375,"roundness":0.34375,"flat":false}'),Qd=JSON.parse('{"name":"Submarine","backgroundColor":"#112d11","textColor":"#c0d59f","frameColor":"#12280b","frameTextColor":"#fcfcf7","buttonColor":"","buttonTextColor":"","mediaButtonColor":"#54e3da","mediaButtonTextColor":"","selectedBackgroundColor":"#226863","selectedTextColor":"#ffffff","evenRowBackgroundColor":"","spacing":0.78125,"roundness":0.8125,"flat":false}'),Zd=JSON.parse('{"name":"Tangerine","backgroundColor":"#eaf2c5","textColor":"#2e1f05","frameColor":"#e89f02","frameTextColor":"#180c06","buttonColor":"","buttonTextColor":"","mediaButtonColor":"","mediaButtonTextColor":"","selectedBackgroundColor":"#e87102","selectedTextColor":"#000000","evenRowBackgroundColor":"","spacing":0.46875,"roundness":1,"flat":true}'),em=JSON.parse('{"name":"Winamp Amber","backgroundColor":"#000000","textColor":"#e79a36","frameColor":"#383757","frameTextColor":"#d2d2d2","buttonColor":"#464379","buttonTextColor":"#ebebeb","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#76490e","selectedTextColor":"#ebebeb","evenRowBackgroundColor":"","spacing":0.21875,"roundness":0.09375,"flat":false}'),tm=JSON.parse('{"name":"Winamp Classic","backgroundColor":"#000000","textColor":"#00e200","frameColor":"#383757","frameTextColor":"#d2d2d2","buttonColor":"#464379","buttonTextColor":"#d2d2d2","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#040dae","selectedTextColor":"#d2d2d2","evenRowBackgroundColor":"","spacing":0.21875,"roundness":0.09375,"flat":false}'),nm=JSON.parse('{"name":"Winamp Modern (WACUP)","backgroundColor":"#14121c","textColor":"#8ac440","frameColor":"#1f1f36","frameTextColor":"#f0f0f0","buttonColor":"","buttonTextColor":"","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#2f2f76","selectedTextColor":"#f0f0f0","evenRowBackgroundColor":"","spacing":0.21875,"roundness":0.09375,"flat":false}'),rm=[Bd,Yd,Ld,Fd,Vd,Ud,Hd,qd,Wd,Kd,Xd,Gd,Jd,Qd,Zd,em,tm,nm],im=new class{constructor(){this.storage=new m("theme"),this.app=document.getElementById("app"),this.popup=document.getElementById("popup"),this.system=document.getElementById("system"),this.theme$=new rn(Bd);const e=document.createElement("style");document.head.append(e),this.sheet=e.sheet,this.rootStyle=this.createStyle(":root"),this.appStyle=this.createStyle(".app"),this.playheadStyle=this.createStyle("#playhead"),this.system.classList.toggle("selection-dark",!0),this.restore()}observe(){return this.theme$}get backgroundColor(){return this.current.backgroundColor}set backgroundColor(e){this.setColor("backgroundColor",e),this.app.classList.toggle("dark",this.isDark),this.app.classList.toggle("light",this.isLight),this.popup.classList.toggle("dark",this.isDark),this.popup.classList.toggle("light",this.isLight)}get buttonColor(){return this.current.buttonColor}set buttonColor(e){this.setColor("buttonColor",e)}get buttonTextColor(){return this.current.buttonTextColor}set buttonTextColor(e){this.setColor("buttonTextColor",e)}get current(){return this.theme$.value}get evenRowBackgroundColor(){return this.current.evenRowBackgroundColor}set evenRowBackgroundColor(e){this.setColor("evenRowBackgroundColor",e)}get flat(){return this.current.flat}set flat(e){this.app.classList.toggle("flat",!!e),this.popup.classList.toggle("flat",!!e),this.theme$.next(Object.assign(Object.assign({},this.current),{flat:e}))}get fontSize(){return Number(this.rootStyle.getPropertyValue("--font-size"))||16}set fontSize(e){this.rootStyle.setProperty("--font-size",String(e)),this.createPlayheadSmiley()}get frameColor(){return this.current.frameColor}set frameColor(e){this.setColor("frameColor",e),this.app.classList.toggle("frame-light",this.isFrameLight),this.app.classList.toggle("frame-dark",this.isFrameDark),this.popup.classList.toggle("frame-light",this.isFrameLight),this.popup.classList.toggle("frame-dark",this.isFrameDark),this.createPlayheadSmiley()}get frameTextColor(){return this.current.frameTextColor}set frameTextColor(e){this.setColor("frameTextColor",e)}get mediaButtonColor(){return this.current.mediaButtonColor}set mediaButtonColor(e){this.setColor("mediaButtonColor",e)}get mediaButtonTextColor(){return this.current.mediaButtonTextColor}set mediaButtonTextColor(e){this.setColor("mediaButtonTextColor",e)}get name(){return this.current.name}set name(e){this.theme$.next(Object.assign(Object.assign({},this.current),{name:e}))}get roundness(){return this.current.roundness}set roundness(e){this.setProperty("roundness",e),this.theme$.next(Object.assign(Object.assign({},this.current),{roundness:e}))}get selectedBackgroundColor(){return this.current.selectedBackgroundColor}set selectedBackgroundColor(e){if(this.setColor("selectedBackgroundColor",e),this.selectedBackgroundColor){const e=new _d(this.selectedBackgroundColor);this.setProperty("selected-background-color-blurred",e.greyscale().setAlpha(.9).toRgbString()),this.app.classList.toggle("selection-dark",this.isSelectionDark),this.app.classList.toggle("selection-light",this.isSelectionLight)}}get selectedTextColor(){return this.current.selectedTextColor}set selectedTextColor(e){this.setColor("selectedTextColor",e)}get spacing(){return this.current.spacing}set spacing(e){this.setProperty("spacing",e),this.theme$.next(Object.assign(Object.assign({},this.current),{spacing:e}))}get textColor(){return this.current.textColor}set textColor(e){this.setColor("textColor",e)}get isDark(){return new _d(this.backgroundColor).isDark()}get isLight(){return new _d(this.backgroundColor).isLight()}get isFrameDark(){return new _d(this.frameColor).isDark()}get isFrameLight(){return new _d(this.frameColor).isLight()}get isSelectionDark(){return new _d(this.selectedBackgroundColor).isDark()}get isSelectionLight(){return new _d(this.selectedBackgroundColor).isLight()}load(e){let t;t="string"==typeof e?rm.find((t=>t.name===e)):e,t&&Object.assign(this,this.applyDefaults(t))}restore(){const e=this.storage.getJson("current",Bd);Object.assign(this,this.applyDefaults(e)),this.fontSize=this.storage.getNumber("fontSize",16),this.toggleClasses(this.app),this.toggleClasses(this.popup),this.system.classList.toggle("dark",this.isDark),this.system.classList.toggle("light",this.isLight),this.createPlayheadSmiley()}save(){this.storage.setNumber("fontSize",this.fontSize),this.storage.setJson("current",this.current),this.system.classList.toggle("dark",this.isDark),this.system.classList.toggle("light",this.isLight)}toggleClasses(e){e.classList.toggle("dark",this.isDark),e.classList.toggle("light",this.isLight),e.classList.toggle("frame-dark",this.isFrameDark),e.classList.toggle("frame-light",this.isFrameLight),e.classList.toggle("selection-dark",this.isSelectionDark),e.classList.toggle("selection-light",this.isSelectionLight)}applyDefaults(e){if(!e.selectedBackgroundColor){const t=new _d(e.textColor),n=t.monochromatic();n.sort(((e,t)=>e.getBrightness()-t.getBrightness())),t.isLight()?e.selectedBackgroundColor=n[1].toHexString():e.selectedBackgroundColor=n[n.length-2].toHexString(),n.push(new _d("white"),new _d("black")),e.selectedTextColor=Dd(e.selectedBackgroundColor,n,{includeFallbackColors:!0,level:"AA",size:"large"}).toHexString()}return e}setColor(e,t){const n=this.toDashName(e);if(t){"string"==typeof t&&(t=new _d(t));const r=t.toHsl();this.setProperty(`${n}-h`,String(r.h)),this.setProperty(`${n}-s`,100*r.s+"%"),this.setProperty(`${n}-l`,100*r.l+"%"),this.theme$.next(Object.assign(Object.assign({},this.current),{[e]:t.toHexString()}))}else this.setProperty(`${n}-h`,null),this.setProperty(`${n}-s`,null),this.setProperty(`${n}-l`,null),this.theme$.next(Object.assign(Object.assign({},this.current),{[e]:""}))}setProperty(e,t){this.appStyle.setProperty(`--${e}`,null==t?null:String(t))}createStyle(e){const t=this.sheet.insertRule(`${e}{}`);return this.sheet.cssRules[t].style}get defaultMediaButtonColor(){const e=new _d(this.frameColor).toHsl();return e.s+=1-.33*e.s,e.l+=1-.5*e.l,new _d(e).toHexString()}get defaultMediaButtonTextColor(){const e=new _d(this.defaultMediaButtonColor).toHsl();return e.s-=.5*e.s,e.l-=.9*e.l,new _d(e).toHexString()}get smileyColor(){return this.mediaButtonTextColor||this.defaultMediaButtonTextColor}createPlayheadSmiley(){const e=new _d(this.smileyColor).toRgbString(),t=[`<path fill='${e}' d='M 160.5,164.5 C 183.647,162.813 194.147,173.48 192,196.5C 186.494,211.009 175.994,216.842 160.5,214C 145.991,208.494 140.158,197.994 143,182.5C 145.683,173.318 151.517,167.318 160.5,164.5 Z'/>`,`<path fill='${e}' d='M 335.5,164.5 C 358.647,162.813 369.147,173.48 367,196.5C 361.494,211.009 350.994,216.842 335.5,214C 320.991,208.494 315.158,197.994 318,182.5C 320.683,173.318 326.517,167.318 335.5,164.5 Z'/>`,`<path fill='${e}' d='M 164.5,296.5 C 172.699,295.1 179.865,297.1 186,302.5C 201.99,327.582 224.823,341.582 254.5,344.5C 279.499,342.418 299.999,331.751 316,312.5C 318.955,308.756 321.789,304.922 324.5,301C 334.716,294.616 344.55,295.116 354,302.5C 358.296,308.845 359.63,315.845 358,323.5C 334.118,361.698 299.618,382.365 254.5,385.5C 209.382,382.365 174.882,361.698 151,323.5C 148.138,310.557 152.638,301.557 164.5,296.5 Z'/>`].join(""),n=this.createBase64SVG(512,512,t);this.playheadStyle.setProperty("--smiley",n),this.playheadStyle.setProperty("--thumb-size",`${Math.round(1.25*this.fontSize)}px`)}createBase64SVG(e,t,n){return`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='${e}' height='${t}'>${n}</svg>")`}toDashName(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}},om=new s("ambientVideoPlayer"),am=new rc("video","ambient"),sm=new Nl("ambient"),lm=new m("ambientVideoPlayer");function cm(){return sc.useAmbientVideoSource&&sc.ambientVideoSource?"user-progress":"progress"}const um=new ec("ambient-video-player",[am,sm,bd],(function(e){return e?e.src.startsWith("youtube:")?sm:am:null}),(function(e,t){const n=t.src;if(n.startsWith("youtube:")){const[,,t]=n.split(":"),r=cm(),i=lm.getJson(r,{})[t]||("progress"===r?120:0);e.load(`${n}:${i}`)}else e.load(n)}));um.loop=!0,um.volume=0,um.hidden=!0;const dm=new class extends nc{constructor(e,t){super(),this.videoPlayer=e,this.beatsPlayer=t,lc().pipe(rt((e=>e.beatsOverlay)),on()).subscribe((e=>{this.beatsPlayer.hidden=this.hidden||!e}))}get autoplay(){return this.videoPlayer.autoplay}set autoplay(e){this.videoPlayer.autoplay=e,this.beatsPlayer.autoplay=e}get hidden(){return this.videoPlayer.hidden}set hidden(e){this.videoPlayer.hidden=e,this.beatsPlayer.hidden=e||!sc.beatsOverlay}appendTo(e){this.videoPlayer.appendTo(e)}load(e){this.videoPlayer.load(e),this.autoplay&&sc.beatsOverlay&&this.beatsPlayer.play()}play(){this.videoPlayer.play(),sc.beatsOverlay&&this.beatsPlayer.play()}pause(){this.videoPlayer.pause(),this.beatsPlayer.pause()}stop(){this.videoPlayer.stop(),this.beatsPlayer.stop()}resize(e,t){this.videoPlayer.resize(e,t);const n=document.fullscreenElement?20:10;this.beatsPlayer.resize(im.fontSize*n,im.fontSize*n*.225)}}(um,bd);sm.observeVideoId().pipe(At((e=>e?sm.observeCurrentTime().pipe(rt(Math.round),on(),Tt((e=>e>0&&e%30==0)),Pa(sm.observeDuration()),Tt((([,e])=>e>600)),$n((([t])=>{const n=cm(),r=lm.getJson(n,{});r[e]=t,lm.setJson(n,r)}))):ht))).subscribe(om),lc().pipe(rt((e=>e.ambientVideoSource)),on(),Ia(1),$n((()=>lm.removeItem("user-progress")))).subscribe(om);const mm="\nmo2re_RX3Bs blXien2Jh_o etiatMRgFcM DYsMJiwiZSI _MZ7UZ5frCI HCx1Z92PjJE dIP7wWY4Znw gW4nffCscYs\nA1m0SEqmmbE 9uZ8CCa0t4Y MXlFDpaQ1ec wz_ItcoR0-c jS4-FmNEDKo Tz77vqH_LJw K73lfmxDVR0 W8ayfyRWUrg\ncbuldALGsaQ AJZon2grzmA H5ASEM9dMiA GE2YEq7vaLc MYGOdJNAzrI Oszl95YWfbs b0-IkxXyhmY hoYPURX2RuE\nAgpGXSAS7Cs p-OUNPqRzII XaTxLSPh_Is 1n3ezT1cvAM CWU1pZVw0xM ry1Q7KaQdxM VlC5LSTvoj0 5hcd2VNOqTQ\n1bClbVe4QyI f6OZ01vvmko o4jE24WixcI BIej9P2LrzM dxw91a7C5BQ lN9LdcAQnjw VVkZKzTbWQs vXCB1zGGFiY\nJHARFKMl8dU KSB1AZ0-I74 IGqfU6cJJc8 8zg22-ZCUfE WMlR8eJRS3I l4D6bnIdehk A5pbF_YBulo dRFRsKobN9I\nBur1ChHBNsQ IlDvBTDGanI SqMzG8xsynw mOmwk3WyYnw im2eWwIiTOc lxQS58t39_U yk076o8NF3k oggiHfuV4m8\np_GnUkm-G1M xVMsAgHy_IY VdZkfef44JI ZxOd8tmdsIM fszuqfJWKxc 0LGL_lx9XcA i_hU5eUrVIs qtwWkv9OdF0\nuZjCNtOeZG4 ZpXnEvW0XD0 -C8TYbhnVTU WzxSiEWK3cg ZE8vuq4aqNA 7HMw3bcIgRE ZJiCEDweLl8 lyh2kAjcmSY\nvFwqZ4qAUkE QLbPYQcUcgM xwf7EssFnXU FvNFuSTDPuk vvm8b2jAfv0 XkRFSnxXQ_w Ee0Qh_nIoHw 78rppSvbh7A\nNXIaYDJql1c e5eg-tOusSo ZkRjihsMdp8 e1M6jHcRrlM z9Ug-3qhrwY mA30W2dHQIo XIhEPwTMjWk -Tm4H4CrKT0\nT6tapzmF_n0 7QetsPh7BPM xBDqge4w-XA suWbFuw1O_I yCUQ8n2OxjI ZX8fSO8uTPg xX9xfFT-Qw0 hf3r9TNSsyY\n-WIamcIaipI Zjc6DwVDvq0 eHjoav_sb88 7E0WVROBsEE BvLIJSmzAnY YPurG3WT8xI 0ocUnSG4oQQ d8jFMKNy9EI\naC7s2UVXt3c EJArkl7K29k 9eFVeErnUzg 7eyYe-MN1Nc B1-yyoNMUzs Ab5I38wGxko sVuqgnXD9AE EqXNmIh0X4I\nY0U0HAwpw2s Shf_P0PLhNA Nde5P8Ob2xg f-Xul0mdBCA ExStG9rRkoY tMzCwwvHwN0 iaVmsp7dU1Y TV4J01qGE8E\nMPch_urCew8 eYpCCSAW3aw XfBNIrQ5JKQ -b68N6Q4Qus H3mdjo7kYiQ 9CJLtzzUphU yy-aMo2ds2k FFjGdNl5Sso\nLtPGmDskDiY U9rtWGI6H5A NHa506wwN0Y PLSxe5Z8Asw ubQKAfwSLDA aFsNz5VMyC8 h6yhFP_qUro GlotnVckHG4\nPEgQ0dIOB5c KWz3SXWnFys MGRDy2PqCGk 4DcMcAHrURw ETwbuC3p1ls iszl1WqjQIk njcvxMb8TVQ sTS5tBOS4GM\nhNNN5xPyyeY 8ls8xBn70gM 2XREaQqoU1U MXL2qjIL4qI 9YqbQcfIre0 JVI9BvU8-Oo J7QA7WmTGA8 WdtkaLxc464\nPaIH77c53LA FSlhSL8bFoI XLuV3_a-ro0 mo7mUJZV6DM IqWPDr8KCmQ v-QS_Kh_i6o zowLNSKyfI0 Xn8tufsbSz0\n7gG4l70v8mw thurNCHVo08 YgryBZTMVZY XAmU3yQc90M KBUg3U3MRao v_My9t4gadA Xwb1xsWClCM KlH1g1x6RJk\nyYP2A8TkSQ0 LMSmWzCqlPE oN3glsVrnRY PPBV3hem5iM 1JbI8Ml25WQ nSJ67PGjQfQ EoBF2xRsbAc KDUYy3xwCFs\nRZOcoZS_52Q pSP9_otXcTU H36qe8NatNQ qgfd-uWTVwg Blu_yCEFYvk HeYMIBFtwh4 fb0QX7DbqLg kdqyAA0ILD4\nriZWEoGKyuU 4qo9bKRxgYA t0j_GdkG1BM hLq9J32lGRs zfc53CpvlZ4 IjNKQbm4AQ8 Ms0uDHae8FY tG991Undnbc\nsh8l2-cCAGQ XDE5pd4V_xc C2BVXFIX7bY ySPxZpoqXZ8 hiEUaLX4cCM wHxEyBMi1A4 YJSw3ougt9Y 2hUJBRUtrPU\nWsCCYv2adkM kD5x3_b1J0o 9Rvtm2zGEl4 DGlAMkUjcY0 h2s_WOkfTXk 0VhxPdtX0xg 6vuFh6NNa70 ukOHqdPbYYg\nH6OmEQ8RqVk qPp315pPVSI FQqj6gN7M6M Xrwks9O2-JQ ipRwt3TDgY4 aVqRyfRviwA X33dmu12C5c QEwzFKoG7tk\nh98nR30UD8Q Z7WpAwRjprI ilqlSBYfCGs V6SoeDWDon0 d-Hwz42Vfw4 hcmxvqJDpDw 22dlye7h3qU p7l6JQApzak\nblSZ365wpfQ ADF4KgfhzPs jSRvD7Uma1g uLMC6bL_q38 k9DuPxFQ7HQ 7f2taFPyqxc YVYDz_coSfY NXg0IKlrz-Q\nORHIVufNfRM YiezM4raRrY H3GL5jO53NU acTsYqhq-AA vp2yiZnjK0w eR5vsN1Lq4E D_l0pBDHFgs HFnt39uG5W0\n7qXiAaxxGBs m6m6bqHiT6U l5jUOT0XiUM NLxwmtJSvk4 dv_QzcJGHAE kaPD4n9uQ2k r7HpeG2ofU0 O1AQcFpPs04\n44ih4WRTyGg W5BmjLsEsB0 JkNlFaei_k8 2ttB1FzBpZ4 k3Q1vse7In8 7xltSb3VBJQ ojbiGfhnjTU _Qb7TJ-T1HM\ngvT3gIDSwq8 4X95pykbYTY BPDznHIgVMA OIA5xQWkk2U 2uQ58Xwx1V4 UVjCFpYMR6A -uww0BzTb7g EqWBy5i8LyQ\nszErNcJMCdA 5k1DGpr_qDw YNEkjkh0bYo jmjrpHYegzc Eye8xYrjm24 rVLOQB5kGGw F8MN0o6RS9o viim_l9gbF8\nsBtYWK817-0 cFRcqnCpqoo y7vz1qQGUd8 -0ewPjoBBNI S1emxk9UWBE 1muEwEFDKgk P0MbbslO62E MPEvXbw3hYA\nwwXpkTd1CaQ W2A_PcIhUVM ZIb8u6uJwBo TWjid2dVjMk gdJjc6l6iII n3Dru5y3ROc OOf4Z7tyLVM iDXDrTKJehk\nwYhliE9O_3k nw0uvJZonBc cK7x6lUUsYo XPjkpBDEs2U e2AUzM6QgGs 3cxyYOXiJss AsD5u6k6dKI d_hx39kXDUg\nhlvfDL3nSoo 6L2xYzu724E URy2Ak-WRpE V-ntXk-4TPo yttvb9ByOtY ctqujFKaFZQ NWF3dNJ-EhQ WUkwH9WmmBA\nef1wAfrMg5I eN-RZVkFGj0 yXuFVc_9Zgg 0-skl5qAC9Q u1rRUwx_Vy4 iTjgWeJMUJo WL9EOfzoSsA xrCNwCD-z-M\nCC3AanQdQZA ZGLrP5eawdY HoOghpRTkvs N787WRdI35A Cw0d-nqSNE8 2vifO3_gjiM OeJ5xXrbkfU vkYBLYAGavM\njP4gBqxfheI gIJxDy25nwM oN8q7p57nZw 6vnxzfejWN4 gVamQ6jodK0 iU5QjAbuhec qLIU_90P4Ac z8k_ximc8Og\nZFBoN7yIMZw 4mexI7cACZk bx-0YlFprqc NDWpXTg3koc Vo2AcHSCRiQ 2ve6LNoU6Qk WXI7byeZk5s y8d7Ihe0IwE\nubmUJcwor3k CGslieDL-04 w7ljU-lmaK4 I0B21LjeSUQ PyFN_FYwqvc bxy9PFJRJ0g ahmrb5EYoxY HGxuVWpN8vQ\nDNR1zyr5Go4 eyPhudLTuis aPWXL4ahxdY JB0A8Me8EKk dGy_6qyyY7c rxrDLgt5YFA uhcocK-td5E 4Z5FLeh7P18\nVB0zDS9ITmk VukLV0AoeFA CouF-tNHV3g lTvYjERVAnY S27YOjpgaaE 24uCC_-zaaE DslTxXsDLsw xilGAQPx5Xw\nzlHISDs2HtQ tdi8B0YzxHg R1OHRQoJOP0 fbqmVbEj9fg asL1AN3hifU rUkLoqxFOTw 3ma3yXXc3V8 1U1We59en3s\niNm7PPqO6rM CLRk8SgtVS4 VYO8Biwffns 9Wm8Ij8rHIE ZMOC332wC7A doORhRob3Qg E2sSvVCRI4s nPQ4BpTfK1Q\nE6Ww7lpuZ2k Ueqm3PQKYPk eFiKAcbp2MY dAfMgDBeqwU Wuq5NHJPXyQ LAFK1EvwulU rU07g1g-PIY L_mlofcsRaA\neZe4Q_58UTU NXObT_Fl-xI t6jlhqNxRYk _WkkH31sTMI ALJcKvnOjHM 85Y1N8avsXs NCY42RnUpCE 2QSukL7dl5o\n0Tpq2mLtXDc Zp1Oajc7VQw WGi4XiEGe8M b6L40CEYVyM Mw9qiV7XlFs UgHKb_7884o mvIYmMo906E VoXOYFlJTuI\nfsjdpo1o-J8 k9rKpHXwA1E MTG3VA-m6qk cU3XY6Ii8v0 NBIdmswtcnM k5sznEJz8BA R8W3U0Mu6t4 1esKStoxuO4\n6KBo0GhU9XM d5R3FK9vLBs N5b7Iy4W0ow VogwWGEO1-c YKRe7n3jQ_M A-mPDdnzipI 6gqU-HL68wE 3ODGCQ-kjGA\nVIlQIVVLWVs 6A-kQCdEIpI _lisL6tLbdg VarS6olPfTA va306f9aN3A zzscMK0ZtjE KpFU_kIw6To hNC6-bxHJac\nbHK0ZvQzfOY PkF4EKJQOOg 0aMUCiKjBDI D1KsEOUqCEU _SFTmh-b-Z4 omlVslJvzxQ FoS3732REf0 kNMOaRRBat4\nqqC80mXlOKo MS2asGj1-_M BizH494DmJI IahW6hJ1-SM 9MIJm1NeUpE 2qzbMPpgtDw H3UY2gQfj-s 9kekiNImlsI\n5zUCClmhjF0 88jpBZdsrT8 e18IjYKZnTA MAFdQs_yWvg xkAUTCdoteI X0IEHj4PhCc JX19TZp8gDQ 7TML_MTQdg4\nSH4f_DnPIto v-A03t6-Kss 5rf_gOfa7O4 MYG6FeY4SKg AVzdfRpE9Q0 1UxoHtG2qas o7XgU4ut6jQ IcOYM87wTRc\noPetbPLA8dM F41dgN-mwrE tpRBHKAJ_tU sTy4stPcD0E p4jroQX6Hwk y2Zl-KXvdSk zffchwaq6KE jv7hNnJEWPU\nDN-BxbMH264 mWaC_VSncEg 8x5Yzxi3LhA 0Txa_T4pHY4 McT_FUPZR5k H6Xy97CD9Hs vHf4WQtJvdI nAMkwo2eSbY\nepD5ixtaID0\n".match(/\S+/g).map((e=>({providerId:"ambientvideo",name:e,src:`youtube:video:${e}`})));console.log("Default ambient videos:",mm.length);const fm=new s("ambientvideo/visualizers"),hm=new rn([]);function pm(){return hm}lc().pipe(os(1),rt((e=>!!e.ambientVideoEnabled)),on(),At((e=>e?lc().pipe(rt((e=>!!e.useAmbientVideoSource)),on(),At((e=>e?lc().pipe(rt((e=>e.ambientVideoSource||"")),on(),At((e=>e?function(e){return t=this,n=void 0,i=function*(){const t=Wi(e),[,n,r]=t.split(":");let i=[r];return"playlist"===n&&(i=yield function(e){return Ol(this,void 0,void 0,(function*(){const t=new jl;try{return yield t.loadPlaylist(e)}finally{t.destroy()}}))}(t)),i.map((e=>({providerId:"ambientvideo",name:e,src:`youtube:video:${e}`})))},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(a,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e):$t([])))):$t(mm)))):$t([]))),Rn((e=>(fm.error(e),$t([]))))).subscribe(hm),pm().pipe(rt((e=>e.length)),Vo((e=>0===e))).subscribe(fm.rx("size"));const vm={id:"ambientvideo",name:"Ambient Video",defaultHidden:!0,player:dm,get visualizers(){return hm.getValue()},observeVisualizers:pm},gm=new s("AmpShaderPlayer"),bm="precision mediump float;\r\nuniform float iTime;\r\nuniform vec2 iResolution;\r\nuniform sampler2D iChannel0;\r\n// uniform float iChannelTime[4];\r\nvec3 iMouse = vec3(0., 0., 0.);\r\n#define texture texture2D\r\n",ym="https://www.shadertoy.com/view",wm="ampshader",xm=[{providerId:wm,name:"MandelKoch - Music Visualiser by Pelegefen",externalUrl:`${ym}/sslXzX`,shader:`${bm}// MandelKoch - Music Visualiser by Pelegefen\r\n// https://www.shadertoy.com/view/sslXzX\r\n\r\n\r\n// ----------------CAUTION!!!--- FLASHING BRIGHT LIGHTS!!!-------------------------\r\n\r\n// Credits - fractal zoom with smooth iter count adapted from - iq (Inigo quilez) - https://iquilezles.org/articles/msetsmooth\r\n// Koch Snowflake symmetry from tutorial by Martijn Steinrucken aka The Art of Code/BigWings - 2020 - https://www.youtube.com/watch?v=il_Qg9AqQkE&ab_channel=TheArtofCode\r\n//music - Sajanka (Official) Sajanka - Sun Is Coming\r\n\r\n//Some notes - color is determined by date and not time - hour of day dependent.\r\n//Move the mouse on the Y axis to change the symmetry.\r\n\r\n//----------------------------------------------------------------------------------\r\n\r\n//uncomment to sample audio input from MIC instead of SoundCloud.\r\n//#define MIC_INPUT\r\n\r\n//comment to make it less trippy and noisy.\r\n//#define EXTRA_DMT\r\n\r\n\r\n#define PI 3.14159265359\r\n\r\n// #define date iDate\r\n#define time iTime\r\n#define resolution iResolution\r\n\r\nfloat freqs[4];\r\n\r\nvec2 rot(vec2 p,float a){\r\n    float c = cos(a);\r\n    float s = sin(a);\r\n\r\n    mat2 m = mat2(c,-s,s,c);\r\n\r\n    p*=m;\r\n    return p  ;\r\n}\r\n\r\nfloat localTime(){\r\n    // float d = date.w / date.x;\r\n    float d = 1.;\r\n    return d;\r\n}\r\n\r\nvec3 randomCol(float sc) {\r\n    float d = localTime();\r\n\tfloat r = sin(sc * 1. * d)*.5+.5;\r\n\tfloat g = sin(sc * 2. * d)*.5+.5;\r\n\tfloat b = sin(sc * 4. * d)*.5+.5;\r\n\r\n\tvec3 col = vec3(r,g,b);\r\n\tcol = clamp(col,0.,1.);\r\n\r\n\treturn col;\r\n}\r\n\r\n//--------------------------------------------------mandelbrot generator-----------https://iquilezles.org/articles/msetsmooth\r\n\r\nfloat mandelbrot(vec2 c ) {\r\n    #if 1\r\n    {\r\n        float c2 = dot(c, c);\r\n        // skip computation inside M1 - https://iquilezles.org/articles/mset1bulb\r\n        if( 256.0*c2*c2 - 96.0*c2 + 32.0*c.x - 3.0 < 0.0 ) return 0.0;\r\n        // skip computation inside M2 - https://iquilezles.org/articles/mset2bulb\r\n        if( 16.0*(c2+2.0*c.x+1.0) - 1.0 < 0.0 ) return 0.0;\r\n    }\r\n    #endif\r\n\r\n    const float B = 128.0;\r\n    float l = 0.0;\r\n    vec2 z  = vec2(0.0);\r\n    for( int i=0; i<256; i++ )\r\n    {\r\n        z = vec2( z.x*z.x - z.y*z.y, 2.0*z.x*z.y ) + c;\r\n        if( dot(z,z)>(B*B) ) break;\r\n        l += 1.0;\r\n    }\r\n\r\n    if( l>255.0 ) return 0.0;\r\n\r\n    // equivalent optimized smooth interation count\r\n    float sl = l - log2(log2(dot(z,z))) + 4.0;\r\n\r\n     return sl;\r\n }\r\n\r\n\r\nvec3 mandelbrotImg(vec2 p)\r\n{\r\n\r\n    //uncomment to see unmaped set\r\n\t//p = (-iResolution.xy + 2.0*gl_FragCoord.xy)/iResolution.y;\r\n    float mtime =  time;\r\n    mtime -= freqs[3];\r\n    float zoo = 0.62 + 0.38*cos(.1*mtime);\r\n   float coa = cos( 0.015*(1.0-zoo)*mtime );\r\n   float sia = sin( 0.015*(1.0-zoo)*mtime );\r\n   zoo = pow( zoo,6.0);\r\n   vec2 xy = vec2( p.x*coa-p.y*sia, p.x*sia+p.y*coa);\r\n   vec2 c = vec2(-.745,.186) + xy*zoo;\r\n\r\n    float l = mandelbrot(c);\r\n\r\n\tvec3 col1 = 0.5 + 0.5*cos( 3.0 + l*.15 + randomCol(.1));\r\n    #ifdef EXTRA_DMT\r\n    vec3 col2 = 0.5 + 0.5*cos( 3.0 + l*.15 / randomCol(.1));\r\n    #else\r\n    vec3 col2 = 0.5 + 0.5*cos( 3.0 + l*.15 * randomCol(.1));\r\n    #endif\r\n    vec3 col = mix(col1,col2,sin(mtime)*.5+.5);\r\n\r\nreturn col;\r\n}\r\n\r\n//-----------------functions-----------\r\n\r\nfloat remap(float a1, float a2 ,float b1, float b2, float t)\r\n{\r\n\treturn b1+(t-a1)*(b2-b1)/(a2-a1);\r\n}\r\n\r\nvec2 remap(float a1, float a2 ,float b1, float b2, vec2 t)\r\n{\r\n\treturn b1+(t-a1)*(b2-b1)/(a2-a1);\r\n}\r\n\r\nvec4 remap(float a1, float a2 ,float b1, float b2, vec4 t)\r\n{\r\n\treturn b1+(t-a1)*(b2-b1)/(a2-a1);\r\n}\r\n\r\nvec2 N(float angle) {\r\n    return vec2(sin(angle), cos(angle));\r\n}\r\n\r\nvoid main(void) {\r\n//--------get soundtrack frequencies----\r\n    freqs[0] = texture( iChannel0, vec2( 0.01, 0.25 ) ).x;\r\n\tfreqs[1] = texture( iChannel0, vec2( 0.07, 0.25 ) ).x;\r\n\tfreqs[2] = texture( iChannel0, vec2( 0.15, 0.25 ) ).x;\r\n\tfreqs[3] = texture( iChannel0, vec2( 0.30, 0.25 ) ).x;\r\n    float avgFreq = (freqs[0] +freqs[1] +freqs[2] +freqs[3])/4.;\r\n\r\n//--------image part---------\r\n    vec2 uv = (gl_FragCoord.xy-.5*resolution.xy)/resolution.y;\r\n\tvec2 mouse = 1. - iMouse.xy/resolution.xy; // 0 1\r\n\tvec2 ouv = uv;\r\n    //uv.y -= .05;\r\n\r\n    uv = rot(uv,(sin(iTime*.1) / freqs[0]*.1  ) * PI  ) ;\r\n\tuv *= 4.0 - (avgFreq * 1.5  );\r\n\r\n    uv.x = abs(uv.x);\r\n\r\n    vec3 col = vec3(0);\r\n    float d;\r\n\r\n    float angle = 0.;\r\n    vec2 n = N((5./6.)*3.1415);\r\n\r\n    uv.y += tan((5./6.)*3.1415)*.5;\r\n   \td = dot(uv-vec2(.5, 0), n);\r\n    uv -= max(0.,d)*n*2.;\r\n\r\n    float scale = 1.;\r\n\r\n    n = N( freqs[0]*(2./3.)*3.1415);\r\n    uv.x += .5;\r\n    for(int i=0; i<10; i++) {\r\n        uv *= 3.;\r\n        scale *= 3.;\r\n        uv.x -= 1.5;\r\n\r\n        uv.x = abs(uv.x);\r\n        uv.x -= .5;\r\n        d = dot(uv, n);\r\n        uv -= min(0.,d)*n*2.;\r\n    }\r\n\r\n    d = length(uv/ clamp(freqs[2],0.1,.9 )- vec2(clamp(uv.x,-1., 1.), 0));\r\n    col += smoothstep(10./iResolution.y, .0, d/scale);\r\n    uv /= scale;\t// normalization\r\n\r\n\r\n\tvec3 manCol = mandelbrotImg(uv);\r\n\t col += manCol;\r\n\r\n\r\n \t\t// vignette effect\r\n\t  col *= 1.0 - 0.5*length(uv *0.5) * freqs[1];\r\n\r\n\r\n    gl_FragColor = vec4( col,1.0);\r\n}`},{providerId:wm,name:"Revision 2015 Livecoding Round 1 by mu6k",externalUrl:`${ym}/ltj3W1`,shader:`${bm}// Revision 2015 Livecoding Round 1 by mu6k\r\n// https://www.shadertoy.com/view/ltj3W1\r\n\r\n\r\n//#define LIGHT_REACT_TO_MUSIC\r\n\r\n#define time iTime\r\n#define v2Resolution iResolution.xy\r\n#define texFFTSmoothed iChannel0\r\n#define texFFT iChannel0\r\n#define fGlobalTime iTime\r\n#define out_color fragColor\r\n\r\nvec4 plas( vec2 v, float time )\r\n{\r\n  float c = 0.5 + sin( v.x * 10.0 ) + cos( sin( time + v.y ) * 20.0 );\r\n  return vec4( sin(c * 0.2 + cos(time)), c * 0.15, cos( c * 0.1 + time / .4 ) * .25, 1.0 );\r\n}\r\n\r\nfloat df ( vec3 p)\r\n{\r\n  p+=0.5;\r\n  float a=time*.3,cs=cos(a),ss=sin(a);\r\n  mat3 r = mat3(cs,0,ss,0,1,0,-ss,0,cs);\r\n\r\na=time*.4,cs=cos(a),ss=sin(a);\r\n  mat3 r2 = mat3(cs,ss,0, -ss,cs,0 ,0,0,1);\r\n\r\n\r\n  float e = .5;\r\n  p = abs(p*r*r2)-.5-sin(time)*.005;;\r\n  p = abs(p*r*r2)-.25-sin(time)*.005;\r\n  p = abs(p*r*r2)-.125-sin(time)*.005;\r\n  p = abs(p*r*r2)-.06125-sin(time)*.005;\r\n  p = abs(p*r*r2)-.0025-sin(time)*.005;\r\n  p = abs(p*r*r2)-.00025-sin(time)*.005;\r\n  return mix(length(p)-.02,max(p.x,max(p.y,p.z))-.02, sin(time)*.5+.5 );\r\n}\r\n\r\nvec3 nf (vec3 p)\r\n{\r\n  vec2 e = vec2(.0,.001);\r\n  float c = df(p);\r\n  return normalize(\r\n vec3(df(p+e.yxx), df(p+e.xyx), df(p+e.xxy))\r\n );\r\n}\r\n\r\nvoid main(void) {\r\n  vec2 uv = vec2(gl_FragCoord.x / v2Resolution.x, gl_FragCoord.y / v2Resolution.y);\r\n  uv -= 0.5;\r\n  uv /= vec2(v2Resolution.y / v2Resolution.x, 1);\r\n\r\n  vec2 m;\r\n  m.x = atan(uv.x / uv.y) / 3.14;\r\n  m.y = 1.0 / length(uv) * .2;\r\n  float d = m.y;\r\n\r\n  float a=time*.2,cs=cos(a),ss=sin(a);\r\n  mat3 r = mat3(cs,0,ss,0,1,0,-ss,0,cs);\r\n\r\n  a=time*.37,cs=cos(a),ss=sin(a);\r\n  mat3 r2 = mat3(cs,ss,0, -ss,cs,0 ,0,0,1);\r\n\r\n  float zoom = sin(time*2.1)*.3+.5;\r\n  float distr = texture(texFFTSmoothed, vec2(pow(uv.y-.5,2.0))*44.0*(sin(time)*.5+.5,.0)).x;\r\n\r\n  vec3 p = vec3(.0,.0,-4.0+sin(time*.8)*0.5);\r\n  vec3 dir = normalize(vec3(uv*zoom,distr+1.0-length(uv)));\r\n\r\n  p*=r*r2;\r\n  dir*=r*r2;\r\n\r\n  for (int i=0; i<40; i++)\r\n  {\r\n    float d = df(p);\r\n    p += d*dir;\r\n\r\n   }\r\n\r\n  vec3 l = normalize(vec3(.1,.2,.3));\r\n\r\n  vec3 c = nf(p)/(1.0+df(p));\r\n  c=vec3(.5+df(p-l*.01)*.5+df(p-l)*.5+df(p-l*2.0)*.25);\r\n  c*= dot(nf(p),-l)*.5+.8;\r\n  float f = texture( texFFT, vec2(d,.0) ).r * 100.0;\r\n\r\n    #ifdef LIGHT_REACT_TO_MUSIC\r\n  float beat = texture(texFFTSmoothed,vec2(.1,.0)).x*1.4;\r\n\t#else\r\n  float beat = .7;\r\n    #endif\r\n\r\n\r\n  c = min(vec3(1.0),c);\r\n\r\n  c-=texture(texFFTSmoothed,vec2(pow(uv.y*.5,2.0)*2.0-1.0,.0)).xxx*uv.x*2.0;\r\n\r\n  m.x += sin( fGlobalTime ) * 0.1;\r\n  m.y += fGlobalTime * 0.25;\r\n\r\n  c -= length(uv);\r\n  c += mix(vec3(.1,.4,.9), vec3(.9,.7,.2), (uv.y+.5));\r\n  //c -= .1;\r\n  vec4 t = plas( m * 3.14, fGlobalTime ) / d;\r\n  t = clamp( t, 0.0, 1.0 );\r\n  gl_FragColor = vec4(c,1.0)*beat + t*.05;\r\n}\r\n`},{providerId:wm,name:"Creation by Silexars",externalUrl:`${ym}/XsXXDn`,shader:`${bm}// Creation by Silexars\r\n// https://www.shadertoy.com/view/XsXXDn\r\n\r\n\r\n// http://www.pouet.net/prod.php?which=57245\r\n// If you intend to reuse this shader, please add credits to 'Danilo Guanabara'\r\n\r\nvoid main(void) {\r\n    vec3 c;\r\n    float z = 0.1 * iTime;\r\n    vec2 uv = gl_FragCoord.xy / iResolution;\r\n    vec2 p = uv - 0.5;\r\n    p.x *= iResolution.x / iResolution.y;\r\n    float l = 0.2 * length(p);\r\n    for (int i = 0; i < 3; i++) {\r\n        z += 0.07;\r\n        uv += p / l * (sin(z) + 1.0) * abs(sin(l * 9.0 - z * 2.0));\r\n        c[i] = 0.01 / length(abs(mod(uv, 1.0) - 0.5));\r\n    }\r\n    float intensity = texture(iChannel0, vec2(l, 0.5)).x;\r\n    gl_FragColor = vec4(c / l * intensity, iTime);\r\n}\r\n`},{providerId:wm,name:"Nautilus by weyland",externalUrl:`${ym}/MdXGz4`,shader:`${bm}// Nautilus by weyland\r\n// https://www.shadertoy.com/view/MdXGz4\r\n\r\n\r\nfloat e(vec3 c) {\r\n\tc=cos(vec3(cos(c.r+iTime/8.)*c.r-cos(c.g+iTime/9.)*c.g,c.b/3.*c.r-cos(iTime/7.)*c.g,c.r+c.g+c.b/1.25+iTime));\r\n\treturn dot(c*c,vec3(1.))-1.0;\r\n}\r\n\r\nvoid main(void) {\r\n    vec2 c=-1.+2.*gl_FragCoord.xy / iResolution.xy;\r\n    vec3 o=vec3(c.r,c.g+cos(iTime/2.)/30.,0),g=vec3(c.r+cos(iTime)/30.,c.g,1)/64.;\r\n    float m=1.0;\r\n\tfloat t=0.0;\r\n    for(int j=0;j<333;j++) {\r\n        if( m>.4) {\r\n            t = (1.0+float(j))*2.0;\r\n   \t\t\tm = e(o+g*t);\r\n\t\t}\r\n    }\r\n    vec3 r=vec3(.1,0.,0.);\r\n\tvec3 n=m-vec3( e(vec3(o+g*t+r.rgg)),\r\n                   e(vec3(o+g*t+r.grg)),\r\n                   e(vec3(o+g*t+r.ggr)) );\r\n    vec3 v=vec3(dot(vec3(0,0,-.5),n)+dot(vec3(0.0,-.5,.5),n));\r\n    vec2 uv = gl_FragCoord.xy / iResolution;\r\n    vec2 p = uv - 0.5;\r\n    p.x *= iResolution.x / iResolution.y;\r\n    float l = 0.1 * length(p);\r\n    float intensity = texture(iChannel0, vec2(l, 0.5)).x;\r\n\tgl_FragColor=vec4(v + intensity * vec3(.1+cos(iTime/14.)/8.,.1,.1-cos(iTime/3.)/19.)*(t/41.),iTime);\r\n}\r\n`},{providerId:wm,name:"Quasicrystal by Ebanflo",externalUrl:`${ym}/4sXfzj`,shader:`${bm}// Quasicrystal by Ebanflo\r\n// https://www.shadertoy.com/view/4sXfzj\r\n\r\n\r\nconst int numWaves = 6;\r\nconst float numStripes = 1.0;\r\nconst float numFreqs = 8.0;\r\nconst float meanFreq = 4.0;\r\nconst float stdDev = 2.0;\r\nconst float period = 3.0;\r\nconst float pi = 4.0 * atan(1.0);\r\nconst float pi2 = 2.0 * pi;\r\nconst float ln2 = log(2.0);\r\nconst float mean = meanFreq * .69314718;\r\n\r\nfloat wavething(int n, float x) {\r\n    float l = ln2 * float(n) + log(x);\r\n    l -= mean;\r\n    return exp(-l * l / stdDev) / 2.0;\r\n}\r\n\r\nvoid main(void) {\r\n    gl_FragColor = vec4(0.0);\r\n    float scale = exp2(-fract(iTime / period));\r\n    float sum1 = 0.0;\r\n    for(int n = 0; n < int(numFreqs); n++){\r\n        sum1 += wavething(n, scale + 0.5*float(n));\r\n    }\r\n    vec2 xy = pi2 * numStripes\r\n        * ((2.0 * gl_FragCoord.xy - iResolution.xy) / iResolution.y);\r\n\r\n    float sum2 = 0.0;\r\n    for(int n = 0; n < numWaves; n++){\r\n        float theta = pi * float(n) / float(numWaves);\r\n        vec2 waveVec = vec2(cos(theta), sin(theta));\r\n        float phase = dot(xy, waveVec);\r\n        for(int k = 0; k < int(numFreqs); k++){\r\n            sum2 += cos(phase * scale * exp2(float(k))) * wavething(k, scale + 0.5*float(n));\r\n        }\r\n    }\r\n    gl_FragColor += vec4(1.0 - sum2 / sum1);\r\n    xy /= pi2 * numStripes;\r\n    float r = length(xy);\r\n    gl_FragColor.x *= texture(iChannel0, vec2(.161616 * r, .2)).x;\r\n    gl_FragColor.y *= texture(iChannel0, vec2(.161616 * r + .161616, .2)).x;\r\n    gl_FragColor.z *= texture(iChannel0, vec2(.161616 * r + .333333, .2)).x;\r\n    gl_FragColor = 1.0 - gl_FragColor;\r\n    gl_FragColor = 1.0 - (r + 1.0) * gl_FragColor;\r\n    if(length(gl_FragColor) > 3.0) gl_FragColor = vec4(0.0);\r\n}\r\n`},{providerId:wm,name:"Rainbow by avin",externalUrl:`${ym}/ttfGzH`,shader:`${bm}// Rainbow by avin\r\n// https://www.shadertoy.com/view/ttfGzH\r\n\r\n\r\n#define PI 3.1415926\r\n#define PI2 6.2831852\r\n#define hue(h)clamp(abs(fract(h + vec4(3, 2, 1, 0) / 3.0) * 6.0 - 3.0) - 1.0 , 0.0, 1.0)\r\n\r\nvoid main(void) {\r\n    vec2 uv = (gl_FragCoord.xy - iResolution.xy * 0.5) / iResolution.y;\r\n    float CIRCLES = 20.0;\r\n    float cS = 0.375;\r\n    float sm = 1.0 / iResolution.y * 2.0; // smooth\r\n    float ps = 1.0 / iResolution.y * sqrt(iResolution.y) * 0.225; // circle thin\r\n    float d = length(uv);\r\n    float a = atan(uv.y, uv.x);\r\n    a = a < 0.0 ? PI + (PI - abs(a)) : a;\r\n    float lPos = a /PI2;\r\n    float m = 0.0;\r\n    float partSize = 1.0 / CIRCLES;\r\n    vec3 col;\r\n    for (float i = 20.0; i > 1.0; i -= 1.0) {\r\n        float ilPos = fract(lPos + i*0.1 + iTime * 0.1);\r\n        float cPos = partSize * i + ilPos * partSize;\r\n        float invPos = partSize * (i + 1.0) - ilPos * partSize;\r\n        float nzF = (1.0 - ilPos);\r\n        float mP0 = texture(iChannel0, vec2(partSize * i, 0.0)).x;\r\n        float mP = texture(iChannel0, vec2(cPos, 0.0)).x;\r\n        float mPInv = texture(iChannel0, vec2(invPos, 0.0)).x;\r\n        mP = (mP + mPInv) / 2.0;\r\n        float rDiff = i*(1.0 / CIRCLES * 0.35);\r\n        float r = mP * (1.0 / CIRCLES * 3.0) - rDiff;\r\n        float subm = smoothstep(cS - ps + r, cS - ps + sm + r, d) * smoothstep(cS + r, cS - sm + r, d);\r\n        if (subm > 0.0) {\r\n            col = hue(i / CIRCLES * 0.5 + iTime * 0.05 + mP0 * 0.84).rgb;\r\n        }\r\n        m += subm;\r\n    }\r\n    m = clamp(m, 0.0, 1.0);\r\n    float r = (sin(iTime * 0.5) * 0.5 + 0.5);\r\n    float b = (cos(iTime * 0.5) * 0.5 + 0.5);\r\n    vec3 backCol = vec3(r, 0.0, b) * length(uv * 0.75) * 0.5;\r\n    col = mix(backCol, col, m);\r\n    gl_FragColor = vec4(col, 1.0);\r\n}\r\n`},{providerId:wm,name:"Audio-Visualizer by CoolerZ",externalUrl:`${ym}/wd3XzS`,shader:`${bm}// Audio-Visualizer by CoolerZ\r\n// https://www.shadertoy.com/view/wd3XzS\r\n\r\n\r\nfloat sigmoid(float x) {\r\n    return 1. / (1. + exp(x));\r\n}\r\n\r\nvec3 sigmoid(vec3 xyz) {\r\n    return vec3(sigmoid(xyz.x), sigmoid(xyz.y), sigmoid(xyz.z));\r\n}\r\n\r\nfloat sample_at(float f) {\r\n    return texture(iChannel0, vec2(f / 16.0, 0.)).x;\r\n}\r\n\r\nfloat sample_multiple(float f) {\r\n    float delta = .1;\r\n    return 0.2 * (sample_at(f - 2. * delta) + sample_at(f - delta) + sample_at(f) + sample_at(f + delta) + sample_at(f + 2. * delta));\r\n}\r\n\r\nvoid main(void) {\r\n    vec2 uv = (gl_FragCoord.xy - 0.5) / iResolution.xy;\r\n    uv = 2. * uv - 1.;\r\n    uv.x *= iResolution.x/iResolution.y;\r\n    vec2 center = vec2(0.);// 0.5 * vec2(cos(iTime), sin(iTime));\r\n    float d = length(uv - center);\r\n    float amplitude = sample_multiple(d * d);\r\n    d -= amplitude;\r\n    float weird = sigmoid(abs(uv.x) * abs(uv.y));\r\n    float speed = 6. * amplitude * sin(iTime * weird * 0.005) * 0.001;\r\n    float dist_diagonal = abs(abs(uv.x) - abs(uv.y));\r\n    dist_diagonal += d * amplitude;\r\n    dist_diagonal *= dist_diagonal;\r\n    amplitude += .1 / (.1 + smoothstep(1., 0.1, dist_diagonal));\r\n    float brightness = 3. * amplitude * sigmoid(sin(d * d * 16. - speed * iTime + 2. * speed * amplitude));\r\n    vec3 col = sigmoid(vec3(uv, sin(iTime)));\r\n    gl_FragColor = vec4(col * brightness,1.0);\r\n}`},{providerId:wm,name:"Radiant by TekF",externalUrl:`${ym}/4sVBWy`,shader:`${bm}// Radiant by TekF\r\n// https://www.shadertoy.com/view/4sVBWy\r\n\r\n\r\n// Radiant Music Visualiser\r\n// by Hazel Quantock 2018\r\n// This work is licensed under a Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. http://creativecommons.org/licenses/by-nc-sa/4.0/\r\n\r\nvoid main(void) {\r\n    vec2 uv = (gl_FragCoord.xy*2.-iResolution.xy)/iResolution.y;\r\n    float l = length(uv)/length(iResolution.xy/iResolution.y);\r\n    float a = atan(uv.x,uv.y)+iTime;\r\n    float s = texture(iChannel0,vec2(abs(fract(5.*a/6.283)*2.-1.),.75)).r;\r\n    // float A = .16;\r\n    // float B = .2025;\r\n    float A = .4;\r\n    float B = .45;\r\n    if (iMouse.z > 0.) {\r\n        A = iMouse.x / iResolution.x; // strength of chromatic dispersion\r\n        B = iMouse.y / iResolution.y; // strength of waveform\r\n    }\r\n    A *= A; // apply a curve so mouse movements feel better\r\n    B *= B;\r\n    gl_FragColor.r = texture(iChannel0,vec2(pow(mix(mix(l,.0,A),    s ,B),2.),.25)).r;\r\n    gl_FragColor.g = texture(iChannel0,vec2(pow(mix(mix(l,.5,A),(1.-s),B),2.),.25)).r;\r\n    gl_FragColor.b = texture(iChannel0,vec2(pow(mix(mix(l,1.,A),    s ,B),2.),.25)).r;\r\n    // tweak the contrast\r\n    gl_FragColor.rgb = smoothstep(.05,1.,gl_FragColor.rgb+.2*l);\r\n    gl_FragColor.rgb = pow(gl_FragColor.rgb, vec3(2));\r\n    gl_FragColor.a = 1.;\r\n}\r\n`},{providerId:wm,name:"ambilight 2.0 by MillhausVKodi",externalUrl:`${ym}/ltc3WH`,shader:`${bm}// ambilight 2.0 by MillhausVKodi\r\n// https://www.shadertoy.com/view/ltc3WH\r\n\r\n\r\nconst float bands = 20.0;\r\nconst float leds = 25.0;\r\nconst float colorRange = 0.3; // >0. (=1. full color range, >1. repeat colors)\r\n\r\n//convert HSV to RGB\r\nvec3 hsv2rgb(vec3 c) {\r\n    vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n\r\nvoid main(void) {\r\n    // middle = (0/0)\r\n    vec2 k=(gl_FragCoord.xy-.5*iResolution.xy)/(max(iResolution.x,iResolution.y));\r\n    //distance from the middle\r\n    float dis = distance(k , vec2(0));\r\n    //and approximated by "leds"\r\n    float disA = floor(dis*leds)/leds;\r\n    //disA = dis;\r\n    //degree from bottom 0 and top 1.0.  /left right symmetric\r\n    float deg = acos(k.y/dis)/3.14;\r\n    //and approximated by "bands"\r\n    float degA = floor(deg*bands)/bands;\r\n    //colorwheel, dark in the middle, changing colors over time\r\n    vec3 color = hsv2rgb(  vec3( degA*colorRange + iTime*0.07 , 1.0 , smoothstep(0.0, 0.6, disA) )  );\r\n\t//brightness of a band by fourier (degree to frequency / magnitude to brightness)\r\n    float bandBrightness = texture(iChannel0, vec2(degA,0.25)).x;\r\n    //more blinky blinky x^2\r\n    color*=bandBrightness*bandBrightness;\r\n    //brighter\r\n    color*=4.;\r\n    float deltaDeg = fract((deg-degA)*bands) - 0.5;\r\n    float deltaDis = fract((dis-disA)*leds) - 0.5;\r\n    float shape = smoothstep(0.5, 0.35, abs(deltaDeg)) * smoothstep(0.5, 0.35, abs(deltaDis));\r\n    color*=shape;\r\n    gl_FragColor = vec4(color, 1.0);\r\n}\r\n`},{providerId:wm,name:"dot grid thing by laney",externalUrl:`${ym}/Xd2cRG`,shader:`${bm}// dot grid thing by laney\r\n// https://www.shadertoy.com/view/Xd2cRG\r\n\r\n\r\nfloat circle(vec2 p, float radius) {\r\n \treturn length(p)-radius;\r\n}\r\n\r\nvec2 dist(vec2 p, vec2 ns, vec2 split, float totalSquares) {\r\n \tfloat amp1 = texture(iChannel0, vec2((ns.x + ns.y*split.x)/totalSquares, 0.25)).x;\r\n    float amp2 = texture(iChannel0, vec2(mod(ns.x + ns.y*split.x +1., totalSquares)/totalSquares, 0.25)).x;\r\n \treturn vec2(circle(p, 0.5 + 0.9*amp1), circle(p, 0.40 + 0.60*amp2));\r\n}\r\n\r\nfloat smin( float a, float b, float k ) {\r\n    float res = exp( -k*a ) + exp( -k*b );\r\n    return -log( res )/k;\r\n}\r\n\r\nconst float ySplit = 10.0;\r\n\r\nvoid main(void) {\r\n\tvec2 uv = gl_FragCoord.xy / iResolution.xy;\r\n    vec2 aspect = vec2(iResolution.x/iResolution.y, 1.0);\r\n    vec2 split = vec2(floor(aspect*vec2(ySplit)));\r\n    float totalSquares = split.x*split.y;\r\n\tvec2 ns = floor(uv*split);\r\n    vec2 p = vec2(fract(uv*split))*2.0-vec2(1.0);\r\n   \tvec2 c = dist(p, ns, split, totalSquares);\r\n   \tvec2 w = dist(p+vec2(2.0,0.0), ns+vec2(-1.0,0.0), split, totalSquares);\r\n   \tvec2 nw = dist(p+vec2(2.0,-2.0), ns+vec2(-1.0,1.0), split, totalSquares);\r\n   \tvec2 ne = dist(p+vec2(-2.0,-2.0), ns+vec2(1.0,1.0), split, totalSquares);\r\n   \tvec2 sw = dist(p+vec2(2.0,2.0), ns+vec2(-1.0,-1.0), split, totalSquares);\r\n   \tvec2 se = dist(p+vec2(-2.0,2.0), ns+vec2(1.0,-1.0), split, totalSquares);\r\n   \tvec2 e = dist(p+vec2(-2.0,0.0), ns+vec2(1.0,0.0), split, totalSquares);\r\n   \tvec2 s = dist(p+vec2(0.0,2.0), ns+vec2(0.,-1.0), split, totalSquares);\r\n   \tvec2 n = dist(p+vec2(0.0,-2.0), ns+vec2(0.,1.0), split, totalSquares);\r\n    float k = 3.0;\r\n    float d1 = smin(c.x, w.x, k);\r\n    d1 = smin(d1, e.x, k);\r\n    d1 = smin(d1, n.x, k);\r\n    d1 = smin(d1, s.x, k);\r\n    d1 = smin(d1, nw.x, k);\r\n    d1 = smin(d1, ne.x, k);\r\n    d1 = smin(d1, sw.x, k);\r\n    d1 = smin(d1, se.x, k);\r\n    float d2 = smin(c.y, w.y, k);\r\n    d2 = smin(d2, e.y, k);\r\n    d2 = smin(d2, n.y, k);\r\n    d2 = smin(d2, s.y, k);\r\n    d2 = smin(d2, nw.y, k);\r\n    d2 = smin(d2, ne.y, k);\r\n    d2 = smin(d2, sw.y, k);\r\n    d2 = smin(d2, se.y, k);\r\n\tgl_FragColor =\r\n        vec4(0.1,0.1,0.1,1.0) *  (1.0 - d1) +\r\n        vec4(.3,0.5,0.3,1.0) *  (1.0 - smoothstep(0., 0.15, d1)) +\r\n        vec4(0.5,0.2,0.1,1.0) *  (1.0 - smoothstep(0., 0.1, d2));\r\n}\r\n`},{providerId:wm,name:"Bubbles by liyouvane",externalUrl:`${ym}/llXBWB`,shader:`${bm}// Bubbles by liyouvane\r\n// https://www.shadertoy.com/view/llXBWB\r\n\r\n\r\n#define SHOW_BLOCKS\r\n\r\nvec4 mod289(vec4 x) {\r\n    return x - floor(x * (1.0 / 289.0)) * 289.0;\r\n}\r\n\r\nvec4 permute(vec4 x) {\r\n    return mod289(((x*34.0)+1.0)*x);\r\n}\r\n\r\nvec4 taylorInvSqrt(vec4 r) {\r\n    return 1.79284291400159 - 0.85373472095314 * r;\r\n}\r\n\r\nvec2 fade(vec2 t) {\r\n    return t*t*t*(t*(t*6.0-15.0)+10.0);\r\n}\r\n\r\n// Classic Perlin noise\r\nfloat cnoise(vec2 P) {\r\n    vec4 Pi = floor(P.xyxy) + vec4(0.0, 0.0, 1.0, 1.0);\r\n    vec4 Pf = fract(P.xyxy) - vec4(0.0, 0.0, 1.0, 1.0);\r\n    Pi = mod289(Pi); // To avoid truncation effects in permutation\r\n    vec4 ix = Pi.xzxz;\r\n    vec4 iy = Pi.yyww;\r\n    vec4 fx = Pf.xzxz;\r\n    vec4 fy = Pf.yyww;\r\n    vec4 i = permute(permute(ix) + iy);\r\n    vec4 gx = fract(i * (1.0 / 41.0)) * 2.0 - 1.0;\r\n    vec4 gy = abs(gx) - 0.5;\r\n    vec4 tx = floor(gx + 0.5);\r\n    gx = gx - tx;\r\n    vec2 g00 = vec2(gx.x,gy.x);\r\n    vec2 g10 = vec2(gx.y,gy.y);\r\n    vec2 g01 = vec2(gx.z,gy.z);\r\n    vec2 g11 = vec2(gx.w,gy.w);\r\n    vec4 norm = taylorInvSqrt(vec4(dot(g00, g00), dot(g01, g01), dot(g10, g10), dot(g11, g11)));\r\n    g00 *= norm.x;\r\n    g01 *= norm.y;\r\n    g10 *= norm.z;\r\n    g11 *= norm.w;\r\n    float n00 = dot(g00, vec2(fx.x, fy.x));\r\n    float n10 = dot(g10, vec2(fx.y, fy.y));\r\n    float n01 = dot(g01, vec2(fx.z, fy.z));\r\n    float n11 = dot(g11, vec2(fx.w, fy.w));\r\n    vec2 fade_xy = fade(Pf.xy);\r\n    vec2 n_x = mix(vec2(n00, n01), vec2(n10, n11), fade_xy.x);\r\n    float n_xy = mix(n_x.x, n_x.y, fade_xy.y);\r\n    return 2.3 * n_xy;\r\n}\r\n\r\nfloat rand(float x) {\r\n    return fract(sin(x) * 4358.5453123);\r\n}\r\n\r\nfloat rand(vec2 co) {\r\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5357);\r\n}\r\n\r\nfloat circle(vec2 p, vec2 b, float r) {\r\n    return length(p-b)-r;\r\n}\r\n\r\nfloat box(vec2 p, vec2 b, float r) {\r\n    return length(max(abs(p)-b,0.0))-r;\r\n}\r\n\r\nfloat sampleMusic() {\r\n\treturn 0.5 * (\r\n//\t\ttexture( iChannel0, vec2( 0.01, 0.25 ) ).x +\r\n//\t\ttexture( iChannel0, vec2( 0.07, 0.25 ) ).x +\r\n\t\ttexture( iChannel0, vec2( 0.15, 0.25 ) ).x +\r\n\t\ttexture( iChannel0, vec2( 0.30, 0.25 ) ).x);\r\n}\r\n\r\nvoid main(void) {\r\n\tconst float speed = 0.4;\r\n\tconst float ySpread = 1.6;\r\n\tconst int numBlocks = 30;\r\n\tconst int numBubbles = 50;\r\n\tfloat pulse = sampleMusic();\r\n\r\n\tvec2 uv = gl_FragCoord.xy / iResolution.xy - 0.5;\r\n\tfloat aspect = iResolution.x / iResolution.y;\r\n\tvec3 baseColor = uv.x > 0.0 ? vec3(0.0,0.3, 0.3) : vec3(0.3, 0.0, 0.3);\r\n\r\n\tvec3 color = 5. * pulse*baseColor*0.5*(0.9-cos(uv.x*8.0));\r\n\tuv.x *= aspect;\r\n\r\n\tfor (int i = 0; i < numBubbles; i++) {\r\n\t\tfloat z = 1.0-0.7*rand(float(i)*1.4333); // 0=far, 1=near\r\n\t\tfloat tickTime = iTime*z*speed + float(i)*1.23753;\r\n\t\tfloat tick = floor(tickTime);\r\n\r\n\t\tvec2 pos = vec2(0.6*aspect*(rand(tick)-0.5), -abs(sign(uv.x))*ySpread*(0.5-fract(tickTime)));\r\n\t\tpos.x += 0.18*sign(pos.x); // move aside\r\n\t\tif (abs(pos.x) < 0.1) pos.x++; // stupid fix; sign sometimes returns 0\r\n\r\n\t\tvec2 size = 1.8*z*vec2(0.04, 0.04 + 0.1*rand(tick+0.2));\r\n\t\tfloat b = circle(uv, pos, 0.01 + 0.15 * pulse);\r\n\t\tfloat dust = z*smoothstep(0.22, 0.0, b)*pulse*0.5;\r\n\t\tfloat block = 0.2*z*smoothstep(0.012, 0.0, b);\r\n\t\tfloat shine = 0.6*z*pulse*smoothstep(-0.002, b, 0.007);\r\n        float u_Scale = 9.;\r\n        float noise = sin(abs(cnoise(u_Scale * uv.xy)+0.5*cnoise(2. * u_Scale * uv.xy)+0.25*cnoise(4. * u_Scale * uv.xy)+0.125*cnoise(8. * u_Scale * uv.xy)));\r\n\t\tcolor += dust*baseColor*(1.+3. * noise) + block*z + shine;\r\n\t}\r\n    baseColor = vec3(0.1, 0.3, 0.0);\r\n    for (int i = 0; i < numBlocks; i++) {\r\n\t\tfloat z = 1.0-0.7*rand(float(i)*1.4333); // 0=far, 1=near\r\n\t\tfloat tickTime = iTime*z*speed + float(i)*1.23753;\r\n\t\tfloat tick = floor(tickTime);\r\n\r\n\t\tvec2 pos = vec2(0.6*aspect*(rand(tick)-0.5), -abs(sign(uv.x))*ySpread*(0.5-fract(tickTime)));\r\n\t\tpos.x += 0.24*sign(pos.x); // move aside\r\n\t\tif (abs(pos.x) < 0.1) pos.x++; // stupid fix; sign sometimes returns 0\r\n\r\n\t\tvec2 size = 1.8*z*vec2(0.04, 0.04 + 0.1*rand(tick+0.2));\r\n\t\tfloat b = circle(uv-pos, size, 0.02);\r\n\t\tfloat dust = z*smoothstep(0.22, 0.0, b)*pulse*0.5;\r\n\t\tfloat block = 0.2*z*smoothstep(0.002, 0.0, b);\r\n\t\tfloat shine = 0.6*z*pulse*smoothstep(-0.002, b, 0.007);\r\n        float u_Scale = 9.;\r\n        float noise = sin(abs(cnoise(u_Scale * uv.xy)+0.5*cnoise(2. * u_Scale * uv.xy)+0.25*cnoise(4. * u_Scale * uv.xy)+0.125*cnoise(8. * u_Scale * uv.xy)));\r\n\t\tcolor += dust*baseColor*(1.+noise) + block*z + shine;\r\n\t}\r\n\tcolor /= 1.5;\r\n\tcolor -= rand(uv)*0.04;\r\n\tgl_FragColor = vec4(color, 1.0);\r\n}\r\n`},{providerId:wm,name:"Soap Bubble by Ruzzyr",externalUrl:`${ym}/XtVSDt`,shader:`${bm}// Soap Bubble by Ruzzyr\r\n// https://www.shadertoy.com/view/XtVSDt\r\n\r\n\r\nmat3 rotateYmat(float ang) {\r\n    return mat3(cos(ang), 0.0, sin(ang), 0.0, 1.0, 0.0, -sin(ang), 0.0, cos(ang));\r\n}\r\n\r\nmat3 rotateXmat(float ang) {\r\n    return mat3(1.0, -0.0, 0.0, 0.0, cos(ang), -sin(ang), 0.0, sin(ang), cos(ang));\r\n}\r\n\r\nmat3 rotateZmat(float ang) {\r\n    return mat3(cos(ang), -sin(ang), 0.0, sin(ang), cos(ang), 0.0, 0.0, 0.0, 1.0);\r\n}\r\n\r\nfloat map( vec3 p, vec3 origin, float s ) {\r\n    vec3 offset = vec3(sin(p.x*2. + iTime*2.),cos(p.z*10. + iTime*2.),1.0)*0.1;\r\n\tfloat d = length(p + offset - origin)- s;\r\n\toffset = vec3(sin(p.x*3. + iTime*2.),cos(p.z*2. + iTime*2.),1.0)*0.2;\r\n    for(int i = 0; i < 3; i++) {\r\n        float prism2 = length(p + offset*float(i) - origin)- s;\r\n        d = max(d, -prism2);\r\n    }\r\n  \treturn d;\r\n}\r\n\r\nvoid main(void) {\r\n    vec2 uv = gl_FragCoord.xy/iResolution.xy;\r\n    uv = uv*2.0-1.0;\r\n    uv.x *= iResolution.x/iResolution.y;\r\n    mat3 rotation = //mat3(1.0);\r\n      rotateXmat(iTime*0.4)*rotateYmat(iTime*0.5);\r\n    vec3 direction = normalize(vec3(uv.x,uv.y, 1.0)*rotation);\r\n    float t = 0.0;\r\n\tvec3 p;\r\n    vec3 finalColor;\r\n    vec3 origin = vec3(0.,0.,-4.)*rotation;\r\n    vec3 offset;\r\n    vec3 sphereOrigin = vec3(0., 0., 0.0);\r\n    vec4 sound = texture(iChannel0,vec2(gl_FragCoord.x/iResolution.x, 0.75));\r\n    float soundColor = texture(iChannel0,vec2(0.5, 0.75)).x;\r\n    vec3 color = vec3(.5 + sin(uv.x+iTime +soundColor*50.)*.4,.5 +cos(uv.y+iTime + soundColor*5.)*.5,.5);\r\n    for (int k = 0; k <15; k++) {\r\n        p = origin + t*direction;\r\n        float d = map(p,sphereOrigin, 2.0);\r\n        {\r\n            vec3 directionalOffset = -normalize(p)*sound.x*normalize(vec3(uv, 1.0));\r\n            vec3 position = p + directionalOffset;\r\n            float radius = 0.1+float(k)*.5;\r\n            float lineThickness = 0.02 + float(k)*0.01;\r\n            //position.y += position.y*abs(uv.x);\r\n            float distanceFromCenter = length(position);\r\n            float condition = step( distanceFromCenter, radius)\r\n                - step(distanceFromCenter, radius - lineThickness);\r\n            finalColor += color*condition;\r\n        }\r\n        t += d;\r\n    }\r\n    float fog = 1.0/(1.0+t*t*0.1);\r\n    gl_FragColor = vec4(finalColor+color*vec3(fog), fog);\r\n}\r\n`},{providerId:wm,name:"Fractal Land by Kali",externalUrl:`${ym}/XsBXWt`,shader:`${bm}// Fractal Land by Kali\r\n// https://www.shadertoy.com/view/XsBXWt\r\n\r\n\r\n// "Fractal Cartoon" - former "DE edge detection" by Kali\r\n\r\n// There are no lights and no AO, only color by normals and dark edges.\r\n\r\n\r\n//#define SHOWONLYEDGES\r\n#define WAVES\r\n#define BORDER\r\n\r\n#define RAY_STEPS 150\r\n\r\n#define BRIGHTNESS 1.2\r\n#define GAMMA 1.4\r\n#define SATURATION .65\r\n\r\n\r\n#define detail .001\r\n#define t iTime*.5\r\n\r\n\r\nconst vec3 origin=vec3(-1.,.7,0.);\r\nfloat det=0.0;\r\n\r\n\r\n// 2D rotation function\r\nmat2 rot(float a) {\r\n\treturn mat2(cos(a),sin(a),-sin(a),cos(a));\r\n}\r\n\r\n// "Amazing Surface" fractal\r\nvec4 formula(vec4 p) {\r\n\t\tp.xz = abs(p.xz+1.)-abs(p.xz-1.)-p.xz;\r\n\t\tp.y-=.25;\r\n\t\tp.xy*=rot(radians(35.));\r\n\t\tp=p*2./clamp(dot(p.xyz,p.xyz),.2,1.);\r\n\treturn p;\r\n}\r\n\r\n// Distance function\r\nfloat de(vec3 pos) {\r\n#ifdef WAVES\r\n\tpos.y+=sin(pos.z-t*6.)*.15; //waves!\r\n#endif\r\n\tfloat hid=0.;\r\n\tvec3 tpos=pos;\r\n\ttpos.z=abs(3.-mod(tpos.z,6.));\r\n\tvec4 p=vec4(tpos,1.);\r\n\tfor (int i=0; i<4; i++) {p=formula(p);}\r\n\tfloat fr=(length(max(vec2(0.),p.yz-1.5))-1.)/p.w;\r\n\tfloat ro=max(abs(pos.x+1.)-.3,pos.y-.35);\r\n\t\t  ro=max(ro,-max(abs(pos.x+1.)-.1,pos.y-.5));\r\n\tpos.z=abs(.25-mod(pos.z,.5));\r\n\t\t  ro=max(ro,-max(abs(pos.z)-.2,pos.y-.3));\r\n\t\t  ro=max(ro,-max(abs(pos.z)-.01,-pos.y+.32));\r\n\tfloat d=min(fr,ro);\r\n\treturn d;\r\n}\r\n\r\n\r\n// Camera path\r\nvec3 path(float ti) {\r\n\tti*=1.5;\r\n\tvec3  p=vec3(sin(ti),(1.-sin(ti*2.))*.5,-ti*5.)*.5;\r\n\treturn p;\r\n}\r\n\r\n// Calc normals, and here is edge detection, set to variable "edge"\r\n\r\nfloat edge=0.;\r\nvec3 normal(vec3 p) {\r\n\tvec3 e = vec3(0.0,det*5.,0.0);\r\n\r\n\tfloat d1=de(p-e.yxx),d2=de(p+e.yxx);\r\n\tfloat d3=de(p-e.xyx),d4=de(p+e.xyx);\r\n\tfloat d5=de(p-e.xxy),d6=de(p+e.xxy);\r\n\tfloat d=de(p);\r\n\tedge=abs(d-0.5*(d2+d1))+abs(d-0.5*(d4+d3))+abs(d-0.5*(d6+d5));//edge finder\r\n\tedge=min(1.,pow(edge,.55)*15.);\r\n\treturn normalize(vec3(d1-d2,d3-d4,d5-d6));\r\n}\r\n\r\n\r\n// Used Nyan Cat code by mu6k, with some mods\r\n\r\nvec4 rainbow(vec2 p)\r\n{\r\n\tfloat q = max(p.x,-0.1);\r\n\tfloat s = sin(p.x*7.0+t*70.0)*0.08;\r\n\tp.y+=s;\r\n\tp.y*=1.1;\r\n\r\n\tvec4 c;\r\n\tif (p.x>0.0) c=vec4(0,0,0,0); else\r\n\tif (0.0/6.0<p.y&&p.y<1.0/6.0) c= vec4(255,43,14,255)/255.0; else\r\n\tif (1.0/6.0<p.y&&p.y<2.0/6.0) c= vec4(255,168,6,255)/255.0; else\r\n\tif (2.0/6.0<p.y&&p.y<3.0/6.0) c= vec4(255,244,0,255)/255.0; else\r\n\tif (3.0/6.0<p.y&&p.y<4.0/6.0) c= vec4(51,234,5,255)/255.0; else\r\n\tif (4.0/6.0<p.y&&p.y<5.0/6.0) c= vec4(8,163,255,255)/255.0; else\r\n\tif (5.0/6.0<p.y&&p.y<6.0/6.0) c= vec4(122,85,255,255)/255.0; else\r\n\tif (abs(p.y)-.05<0.0001) c=vec4(0.,0.,0.,1.); else\r\n\tif (abs(p.y-1.)-.05<0.0001) c=vec4(0.,0.,0.,1.); else\r\n\t\tc=vec4(0,0,0,0);\r\n\tc.a*=.8-min(.8,abs(p.x*.08));\r\n\tc.xyz=mix(c.xyz,vec3(length(c.xyz)),.15);\r\n\treturn c;\r\n}\r\n\r\n\r\n// Raymarching and 2D graphics\r\n\r\nvec3 raymarch(in vec3 from, in vec3 dir)\r\n\r\n{\r\n\tedge=0.;\r\n\tvec3 p, norm;\r\n\tfloat d=100.;\r\n\tfloat totdist=0.;\r\n\tfor (int i=0; i<RAY_STEPS; i++) {\r\n\t\tif (d>det && totdist<25.0) {\r\n\t\t\tp=from+totdist*dir;\r\n\t\t\td=de(p);\r\n\t\t\tdet=detail*exp(.13*totdist);\r\n\t\t\ttotdist+=d;\r\n\t\t}\r\n\t}\r\n\tvec3 col=vec3(0.);\r\n\tp-=(det-d)*dir;\r\n\tnorm=normal(p);\r\n#ifdef SHOWONLYEDGES\r\n\tcol=1.-vec3(edge); // show wireframe version\r\n#else\r\n\tcol=(1.-abs(norm))*max(0.,1.-edge*.8); // set normal as color with dark edges\r\n#endif\r\n\ttotdist=clamp(totdist,0.,26.);\r\n\tdir.y-=.02;\r\n\tfloat sunsize=7.-max(0.,texture(iChannel0,vec2(.6,.2)).x)*5.; // responsive sun size\r\n\tfloat an=atan(dir.x,dir.y)+iTime*1.5; // angle for drawing and rotating sun\r\n\tfloat s=pow(clamp(1.0-length(dir.xy)*sunsize-abs(.2-mod(an,.4)),0.,1.),.1); // sun\r\n\tfloat sb=pow(clamp(1.0-length(dir.xy)*(sunsize-.2)-abs(.2-mod(an,.4)),0.,1.),.1); // sun border\r\n\tfloat sg=pow(clamp(1.0-length(dir.xy)*(sunsize-4.5)-.5*abs(.2-mod(an,.4)),0.,1.),3.); // sun rays\r\n\tfloat y=mix(.45,1.2,pow(smoothstep(0.,1.,.75-dir.y),2.))*(1.-sb*.5); // gradient sky\r\n\r\n\t// set up background with sky and sun\r\n\tvec3 backg=vec3(0.5,0.,1.)*((1.-s)*(1.-sg)*y+(1.-sb)*sg*vec3(1.,.8,0.15)*3.);\r\n\t\t backg+=vec3(1.,.9,.1)*s;\r\n\t\t backg=max(backg,sg*vec3(1.,.9,.5));\r\n\r\n\tcol=mix(vec3(1.,.9,.3),col,exp(-.004*totdist*totdist));// distant fading to sun color\r\n\tif (totdist>25.) col=backg; // hit background\r\n\tcol=pow(col,vec3(GAMMA))*BRIGHTNESS;\r\n\tcol=mix(vec3(length(col)),col,SATURATION);\r\n#ifdef SHOWONLYEDGES\r\n\tcol=1.-vec3(length(col));\r\n#else\r\n\tcol*=vec3(1.,.9,.85);\r\n#endif\r\n\treturn col;\r\n}\r\n\r\n// get camera position\r\nvec3 move(inout vec3 dir) {\r\n\tvec3 go=path(t);\r\n\tvec3 adv=path(t+.7);\r\n\tfloat hd=de(adv);\r\n\tvec3 advec=normalize(adv-go);\r\n\tfloat an=adv.x-go.x; an*=min(1.,abs(adv.z-go.z))*sign(adv.z-go.z)*.7;\r\n\tdir.xy*=mat2(cos(an),sin(an),-sin(an),cos(an));\r\n    an=advec.y*1.7;\r\n\tdir.yz*=mat2(cos(an),sin(an),-sin(an),cos(an));\r\n\tan=atan(advec.x,advec.z);\r\n\tdir.xz*=mat2(cos(an),sin(an),-sin(an),cos(an));\r\n\treturn go;\r\n}\r\n\r\nvoid main(void)\r\n{\r\n\tvec2 uv = gl_FragCoord.xy / iResolution.xy*2.-1.;\r\n\tvec2 oriuv=uv;\r\n\tuv.y*=iResolution.y/iResolution.x;\r\n\tfloat fov=.9-max(0.,.7-iTime*.3);\r\n\tvec3 dir=normalize(vec3(uv*fov,1.));\r\n\tvec3 from=origin+move(dir);\r\n\tvec3 color=raymarch(from,dir);\r\n\t#ifdef BORDER\r\n\tcolor=mix(vec3(0.),color,pow(max(0.,.95-length(oriuv*oriuv*oriuv*vec2(1.05,1.1))),.3));\r\n\t#endif\r\n\tgl_FragColor = vec4(color,1.);\r\n}\r\n`},{providerId:wm,name:"Music MandelBox Colour by pixelbeast",externalUrl:`${ym}/4s33Rj`,shader:`${bm}// Music MandelBox Colour by pixelbeast\r\n// https://www.shadertoy.com/view/4s33Rj\r\n\r\n\r\n// Iain Melvin, 2015\r\n// fft distortions of mandlebox 3d, colour\r\n// with help from:\r\n// https://www.shadertoy.com/view/XsB3Rm  // Original Raymarch tutorial (iq)\r\n// https://www.shadertoy.com/view/ldSGRK  // for mandlebox formula (klems)\r\n// Raymarch tutorial: - iq/2013\r\n\r\n\r\nfloat mandel3D(vec3 z,float fft) {\r\n  const float scale=3.5; //2.0; // -1.5\r\n  const float r=0.5;\r\n  const float f=1.125;\r\n  vec3 offset = z;\r\n  const int niter = 13;\r\n  float dr = 1.0;\r\n  for (int i=0;i<niter;i++){\r\n\t//fold\r\n\tz = clamp(z, -1.0, 1.0) * 2.0 - z;\r\n\t//warp\r\n\tfloat l = length(z);\r\n\tif (l<r){\r\n\t  z/=r*r;\r\n\t}else if (l<1.0){\r\n\t  z/=l*l;\r\n\t}\r\n\tz*=scale;\r\n\tdr = dr * abs(scale) + 1.0;\r\n\t// scale by fft\r\n\tfloat fft_scale = 1.0-(fft*0.34);\r\n\tz*=fft_scale;\r\n\t//dr = dr * fft_scale; // I think there is something to do here\r\n\tz+=offset;\r\n  }\r\n  float zr = length(z);\r\n  return zr / abs(dr);\r\n}\r\n\r\nvec2 map( in vec3 pos ) {\r\n    float d = length(pos);\r\n    float fft = 0.8*texture(iChannel0, vec2((d/32.0),0.3) )[0];\r\n\treturn vec2(mandel3D(pos*1.5,fft),fft);\r\n}\r\n\r\nvec2 castRay( in vec3 ro, in vec3 rd, in float maxd ){\r\n\tfloat precis = 0.015;\r\n    float h=precis*2.0;\r\n    float t = 0.0;\r\n    float m = -1.0;\r\n    for( int i=0; i<120; i++ )\r\n    {\r\n        if( abs(h)<precis||t>maxd ) break;\r\n        t += h;\r\n\t    vec2 res = map( ro+rd*t );\r\n        h = res.x; //dist to solid\r\n\t    m = res.y; //fft\r\n    }\r\n    if (t>maxd) { t=-0.5; m=0.0; }\r\n    return vec2( t, m );\r\n}\r\n\r\nvec3 calcNormal( in vec3 pos ){\r\n\tvec3 eps = vec3( 0.001, 0.0, 0.0 );\r\n\tvec3 nor = vec3(\r\n\t    map(pos+eps.xyy).x - map(pos-eps.xyy).x,\r\n\t    map(pos+eps.yxy).x - map(pos-eps.yxy).x,\r\n\t    map(pos+eps.yyx).x - map(pos-eps.yyx).x );\r\n\treturn normalize(nor);\r\n}\r\n\r\n// iq's smooth hsv to rgb\r\nvec3 hsv2rgb( in vec3 c ) {\r\n    vec3 rgb = clamp( abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0, 0.0, 1.0 );\r\n\trgb = rgb*rgb*(3.0-2.0*rgb);\r\n\treturn c.z * mix( vec3(1.0), rgb, c.y);\r\n}\r\n\r\nvec3 render( in vec3 ro, in vec3 rd ) {\r\n    vec3 col = vec3(0.0);\r\n    vec2 res = castRay(ro,rd,15.0);\r\n    float t = res.x; // dist to func\r\n\tfloat m = res.y; // fft intense at collision\r\n    vec3 pos = ro + t*rd;\r\n    vec3 nor = calcNormal( pos );\r\n    if (t==-0.5) { nor=vec3(1.0,0.0,0.0); }\r\n\r\n\tcol = hsv2rgb(vec3(m*2.0,1.0,1.0)); // hue sat lum\r\n\r\n    float ao = 1.0;\r\n\r\n\tvec3 lig = normalize( vec3(-0.6, 0.7, -0.5) );\r\n\tfloat amb = clamp( 0.5+0.5*nor.y, 0.0, 1.0 );\r\n    float dif = clamp( dot( nor, lig ), 0.0, 1.0 );\r\n    float bac = clamp( dot( nor, normalize(vec3(-lig.x,0.0,-lig.z))), 0.0, 1.0 )*clamp( 1.0-pos.y,0.0,1.0);\r\n\tfloat sh = 1.0;\r\n\r\n\tvec3 brdf = vec3(0.0);\r\n\tbrdf += 0.20*amb*vec3(0.10,0.11,0.13)*ao;\r\n    brdf += 0.20*bac*vec3(0.15,0.15,0.15)*ao;\r\n    brdf += 2.20*dif*vec3(1.00,0.90,0.70);\r\n\r\n\tfloat pp = clamp( dot( reflect(rd,nor), lig ), 0.0, 1.0 );\r\n\tfloat spe = sh*pow(pp,16.0);\r\n\tfloat fre = ao*pow( clamp(1.0+dot(nor,rd),0.0,1.0), 2.0 );\r\n\r\n\tcol = col*brdf + vec3(1.0)*col*spe + 0.2*fre*(0.5+0.5*col);\r\n\r\n\treturn vec3( clamp(col,0.0,10.0) );\r\n}\r\n\r\nvoid main(void) {\r\n\tvec2 q = gl_FragCoord.xy/iResolution.xy;\r\n    vec2 p = -1.0+2.0*q;\r\n\tp.x *= iResolution.x/iResolution.y;\r\n    vec2 mo = iResolution.xy/iResolution.xy;\r\n\r\n\tfloat time = -55.0; //+ time;\r\n\r\n    vec3 d = vec3(0.25*mo.x,0.25*mo.y,0.0);\r\n\r\n    d.x += 5.5*(1.0-cos(0.6*time));\r\n    d.y += 2.5*(1.0-cos(0.05*time));\r\n\r\n\t// camera\r\n\tvec3 ro = vec3( d.x, d.y, 6.0 );\r\n    vec3 ta = vec3( -0.0, -0.0, 0.0 );\r\n\r\n\t// camera tx\r\n\tvec3 cw = normalize( ta-ro );\r\n\tvec3 cp = vec3( 0.0, 1.0, 0.0 );\r\n\tvec3 cu = normalize( cross(cw,cp) );\r\n\tvec3 cv = normalize( cross(cu,cw) );\r\n\tvec3 rd = normalize( p.x*cu + p.y*cv + 2.0*cw );\r\n\r\n    vec3 col = render( ro, rd );\r\n\tcol = sqrt( col );\r\n\r\n    gl_FragColor=vec4( col, 1.0 );\r\n}\r\n`},{providerId:wm,name:"FFT-IFS by nshelton",externalUrl:`${ym}/4lyXWW`,shader:`${bm}// FFT-IFS by nshelton\r\n// https://www.shadertoy.com/view/4lyXWW\r\n\r\n\r\n//#define MAX_ITER 20\r\n#define MAX_ITER 50\r\n\r\nmat3 rotationMatrix(vec3 axis, float angle) {\r\n    float s = sin(angle);\r\n    float c = cos(angle);\r\n    float oc = 1.0 - c;\r\n\r\n    return mat3(oc * axis.x * axis.x + c,           oc * axis.x * axis.y - axis.z * s,  oc * axis.z * axis.x + axis.y * s,\r\n                oc * axis.x * axis.y + axis.z * s,  oc * axis.y * axis.y + c,           oc * axis.y * axis.z - axis.x * s,\r\n                oc * axis.z * axis.x - axis.y * s,  oc * axis.y * axis.z + axis.x * s,  oc * axis.z * axis.z + c);\r\n}\r\n\r\nfloat udBox( vec3 p, vec3 b )\r\n{\r\n  return length(max(abs(p)-b,0.0));\r\n}\r\n\r\nmat3 ir;\r\n\r\nfloat DE(vec3 p)\r\n{\r\n\tvec3 p_o = p;\r\n    float d = 1e10;\r\n\r\n    float s = 1.; //sin(iTime /60.0) / 10.0 + 0.6;\r\n    vec3 t = vec3(0.1 + 0.2 * iMouse.xy/iResolution.xy, 0.1 + 0.1 * sin(iTime/200.));\r\n\r\n    float fftVal = texture(iChannel0,vec2(length(p/5.), 0.2)).x *0.1;\r\n    vec3 dim = vec3( fftVal, 0.9, fftVal);\r\n\r\n    for ( int i = 0; i < 6; i ++)\r\n    {\r\n        p -= t*s;\r\n        p = (ir * (p-t/s));\r\n\r\n     \t//d = min\t(d, udBox(p*s, dim/s) /s);\r\n\r\n \t\tp = abs(p);\r\n\r\n\r\n\r\n        float circleSize = fftVal + 0.03 * (sin(iTime + length(p_o) * 5.) )\r\n            + 0.01;\r\n        d = min(d, length(p - t) - circleSize/s);\r\n        s *= s;\r\n\r\n    }\r\n\r\n\r\n    return d;\r\n}\r\n\r\n\r\nfloat lighting( in vec3 ro, in vec3 rd)\r\n{\r\n    float res = 1.0;\r\n    float t = 0.01;\r\n\r\n    float k = 12.0;\r\n\r\n    for( int i = 0; i < 2; i++ )\r\n    {\r\n        float h = DE(ro + rd*t);\r\n        if( h<0.001 )\r\n            return 0.0;\r\n\r\n        res = min( res,k * h/t );\r\n        t += h;\r\n    }\r\n    return res;\r\n}\r\n\r\nvec3 gradient(vec3 p) {\r\n\tvec2 e = vec2(0., 0.0001);\r\n\r\n\treturn normalize(\r\n\t\tvec3(\r\n\t\t\tDE(p+e.yxx) - DE(p-e.yxx),\r\n\t\t\tDE(p+e.xyx) - DE(p-e.xyx),\r\n\t\t\tDE(p+e.xxy) - DE(p-e.xxy)\r\n\t\t)\r\n\t);\r\n}\r\n\r\n\r\n\r\n\r\n//https://iquilezles.org/articles/fog\r\nvec3 applyFog( in vec3  rgb,      // original color of the pixel\r\n               in float distance, // camera to point distance\r\n               in vec3  rayDir,   // camera to point vector\r\n               in vec3  sunDir )  // sun light direction\r\n{\r\n    float b = .9 + 20.0 / float(MAX_ITER);\r\n    float fogAmount = 1.0 - exp( -distance*b );\r\n    float sunAmount = max( dot( rayDir, sunDir ), 0.0 );\r\n    vec3  fogColor  = mix( vec3(0.1,0.1,0.0),\r\n                           vec3(1.0,0.9,0.7),\r\n                           pow(sunAmount,8.0) );\r\n    return mix( rgb, fogColor, fogAmount );\r\n}\r\n\r\n\r\nvoid main(void) {\r\n\tvec2 uv = gl_FragCoord.xy / iResolution.xy;\r\n    uv -= 0.5;\r\n    float aspect = iResolution.x/iResolution.y;\r\n    uv.x *= aspect;\r\n\r\n    vec3 cam = vec3(0,0, - sin(iTime /32. ) - 2.0);\r\n    vec3 ray = normalize( vec3(uv, 1.0));\r\n\r\n    vec3 color = vec3(0.1, 0.1, 0.2);\r\n    vec3 p;\r\n    float depth = 0.0;\r\n    bool hit = false;\r\n    float iter = 0.0;\r\n\r\n    float fog = 0.0;\r\n    vec3 sun = normalize( vec3(1,1,1));\r\n\r\n    ir = rotationMatrix(normalize(vec3(sin(iTime/50.0),sin(iTime/100.0),sin(iTime/150.0))), 1.5 + iTime/30.0);\r\n\r\n    mat3 mv = rotationMatrix(vec3(0,1,0), iTime/10.0);\r\n\r\n    cam = mv * cam;\r\n    ray = mv * ray;\r\n\r\n    for( int i= 0; i < MAX_ITER; i ++) {\r\n        p = depth * ray + cam;\r\n        float dist = DE(p);\r\n\r\n\r\n        \tdepth += dist * 0.9;\r\n\r\n\r\n        if ( dist < 0.001)\r\n        {\r\n        \thit = true;\r\n            break;\r\n        }\r\n\r\n        iter ++;\r\n    }\r\n    float fakeAO = 1.0 - iter / float(MAX_ITER);\r\n    vec3 n = gradient(p);\r\n\r\n\r\n    if (hit) {\r\n    \tcolor = vec3(fakeAO + dot(-ray,n) / 2.0);\r\n    }\r\n\r\n\r\n\tcolor = applyFog(color, depth, ray, sun) ;\r\n\r\n   //color *= vec3(1.0 - fog);\r\n\r\n    color = pow(color, vec3(0.6));\r\n\r\n\r\n\tgl_FragColor = vec4(color ,1.0);\r\n}\r\n`},{providerId:wm,name:"I/O by movAX13h",externalUrl:`${ym}/XsfGDS`,shader:`${bm}// I/O by movAX13h\r\n// https://www.shadertoy.com/view/XsfGDS\r\n\r\n\r\n// I/O fragment shader by movAX13h, August 2013\r\n\r\n#define SHOW_BLOCKS\r\n\r\nfloat rand(float x)\r\n{\r\n    return fract(sin(x) * 4358.5453123);\r\n}\r\n\r\nfloat rand(vec2 co)\r\n{\r\n    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5357);\r\n}\r\n\r\nfloat box(vec2 p, vec2 b, float r)\r\n{\r\n  return length(max(abs(p)-b,0.0))-r;\r\n}\r\n\r\nfloat sampleMusic()\r\n{\r\n\treturn 0.5 * (\r\n\t\t//texture( iChannel0, vec2( 0.01, 0.25 ) ).x +\r\n\t\t//texture( iChannel0, vec2( 0.07, 0.25 ) ).x +\r\n\t\ttexture( iChannel0, vec2( 0.15, 0.25 ) ).x +\r\n\t\ttexture( iChannel0, vec2( 0.30, 0.25 ) ).x);\r\n}\r\n\r\nvoid main(void)\r\n{\r\n\tconst float speed = 0.7;\r\n\tconst float ySpread = 1.6;\r\n\tconst int numBlocks = 70;\r\n\r\n\tfloat pulse = sampleMusic();\r\n\r\n\tvec2 uv = gl_FragCoord.xy / iResolution.xy - 0.5;\r\n\tfloat aspect = iResolution.x / iResolution.y;\r\n\tvec3 baseColor = uv.x > 0.0 ? vec3(0.0,0.3, 0.6) : vec3(0.6, 0.0, 0.3);\r\n\r\n\tvec3 color = pulse*baseColor*0.5*(0.9-cos(uv.x*8.0));\r\n\tuv.x *= aspect;\r\n\r\n\tfor (int i = 0; i < numBlocks; i++)\r\n\t{\r\n\t\tfloat z = 1.0-0.7*rand(float(i)*1.4333); // 0=far, 1=near\r\n\t\tfloat tickTime = iTime*z*speed + float(i)*1.23753;\r\n\t\tfloat tick = floor(tickTime);\r\n\r\n\t\tvec2 pos = vec2(0.6*aspect*(rand(tick)-0.5), sign(uv.x)*ySpread*(0.5-fract(tickTime)));\r\n\t\tpos.x += 0.24*sign(pos.x); // move aside\r\n\t\tif (abs(pos.x) < 0.1) pos.x++; // stupid fix; sign sometimes returns 0\r\n\r\n\t\tvec2 size = 1.8*z*vec2(0.04, 0.04 + 0.1*rand(tick+0.2));\r\n\t\tfloat b = box(uv-pos, size, 0.01);\r\n\t\tfloat dust = z*smoothstep(0.22, 0.0, b)*pulse*0.5;\r\n\t\t#ifdef SHOW_BLOCKS\r\n\t\tfloat block = 0.2*z*smoothstep(0.002, 0.0, b);\r\n\t\tfloat shine = 0.6*z*pulse*smoothstep(-0.002, b, 0.007);\r\n\t\tcolor += dust*baseColor + block*z + shine;\r\n\t\t#else\r\n\t\tcolor += dust*baseColor;\r\n\t\t#endif\r\n\t}\r\n\r\n\tcolor -= rand(uv)*0.04;\r\n\tgl_FragColor = vec4(color, 1.0);\r\n}`},{providerId:wm,name:"Otherworldy by lherm",externalUrl:`${ym}/MlySWd`,shader:`${bm}// Otherworldy by lherm\r\n// https://www.shadertoy.com/view/MlySWd\r\n\r\n\r\n#define T iTime\r\n\r\n#define PSD (abs(texture(iChannel0, vec2(.5)).r)*abs(texture(iChannel0, vec2(.5)).r))\r\n\r\n// HG_SDF rotate function\r\n#define r(p, a) {p = cos(a)*p + sin(a)*vec2(p.y,-p.x);}\r\n\r\n// Cabbibo's HSV\r\nvec3 hsv(float h, float s, float v) {\r\n    return mix( vec3( 1.0 ), clamp( ( abs( fract(h + vec3( 3.0, 2.0, 1.0 ) / 3.0 ) * 6.0 - 3.0 ) - 1.0 ), 0.0, 1.0 ), s ) * v;\r\n}\r\n\r\nvoid main(void) {\r\n\tvec2 u = (-iResolution.xy+2.*gl_FragCoord.xy) / iResolution.y;\r\n    vec3 ro = vec3(u, 1.), rd = normalize(vec3(u, -1.)), p; // Camera and ray dir\r\n    float d = 0., m; // Distance for march\r\n    for (float i = 1.; i > 0.; i-=0.02)\r\n    {\r\n        p = ro + rd * d;\r\n        r(p.zy, T);\r\n        r(p.zx, T);\r\n        m = length(cos(abs(p)+sin(abs(p))+T))-(PSD + .5); // Distance function\r\n        d += m;\r\n        gl_FragColor = vec4(hsv(T, 1.,1.)*i*i, 1.);\r\n        if (m < 0.02) break;\r\n    }\r\n}\r\n`}];console.log("ampshader visualizers:",xm.length);const km=xm,Em=new class extends nc{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.gl=this.canvas.getContext("webgl"),this.animationFrameId=0,this.fragTime=null,this.shader=null,this.startTime=performance.now();const t=this.gl;this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-ampshader";const n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r);const i=new Float32Array([-1,-1,1,-1,-1,1,1,1]);t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0)}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e||this.animationFrameId||this.render())}appendTo(e){e.append(this.canvas)}load(e){gm.log("load"),e&&(gm.log(`Using Ampshader visualizer: ${e.name}`),this.createShader(e.shader)),this.play()}play(){gm.log("play"),this.animationFrameId||this.render()}pause(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}stop(){this.pause(),this.clear()}resize(e,t){const n=this.canvas,r=this.gl;if(n.width=e,n.height=t,r.viewport(0,0,e,t),this.shader){const e=r.getUniformLocation(this.shader,"iResolution");r.uniform2f(e,n.width,n.height),this.renderFrame()}}get currentTime(){return(performance.now()-this.startTime)/1e3}clear(){}createShader(e){const t=this.gl,n=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(n,"attribute vec2 position;void main(void){gl_Position=vec4(position,0,1);}"),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n));const r=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(r));const i=t.createProgram();t.attachShader(i,n),t.attachShader(i,r),t.linkProgram(i),t.useProgram(i);const o=t.getAttribLocation(i,"position");t.enableVertexAttribArray(o),this.fragTime=t.getUniformLocation(i,"iTime"),t.uniform1f(this.fragTime,this.currentTime);const a=t.getUniformLocation(i,"iResolution");t.uniform2f(a,this.canvas.width,this.canvas.height),this.shader=i}render(){this.renderFrame(),this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((()=>this.render())))}renderFrame(){if(this.shader){const e=this.gl,t=new Uint8Array(this.analyser.frequencyBinCount),n=new Uint8Array(4*t.length);this.analyser.getByteFrequencyData(t),e.uniform1f(this.fragTime,this.currentTime);for(let e=0;e<t.length;e++)n[4*e+0]=t[e],n[4*e+1]=t[e],n[4*e+2]=t[e],n[4*e+3]=255;e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t.length,1,0,e.RGBA,e.UNSIGNED_BYTE,n),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}}(ud),Sm={id:"ampshader",name:"ampshader",player:Em,visualizers:km,observeVisualizers:()=>$t(km)};var Cm=n(8841);const Tm=new s("AudioMotionPlayer"),Am="audiomotion",Pm=[{providerId:Am,name:"Anemone",options:{radial:!0,ledBars:!1,spinSpeed:1,mode:8,barSpace:0,gradient:"rainbow",reflexRatio:.4,showPeaks:!0,mirror:-1,maxFreq:8e3,lineWidth:2,fillAlpha:.2}},{providerId:Am,name:"Classic LEDs",options:{mode:7,barSpace:0,gradient:"classic",ledBars:!0,lumiBars:!1,radial:!1,reflexRatio:0,showPeaks:!0}},{providerId:Am,name:"Mirror wave",options:{mode:10,fillAlpha:.6,gradient:"rainbow",lineWidth:2,mirror:-1,radial:!1,reflexAlpha:1,reflexBright:1,reflexRatio:.5,showPeaks:!1}},{providerId:Am,name:"Radial overlay",options:{mode:5,barSpace:.1,gradient:"prism",radial:!0,ledBars:!1,showPeaks:!0,spinSpeed:1}},{providerId:Am,name:"Reflex Bars",options:{mode:5,barSpace:.25,gradient:"rainbow",lumiBars:!1,radial:!1,reflexAlpha:.25,reflexBright:1,reflexFit:!0,reflexRatio:.3,ledBars:!1,showPeaks:!0}}];console.log("audioMotion-analyzer visualizers:",Pm.length);const Im=Pm,zm=new class extends nc{constructor(e,t){super();const n=this.element=document.createElement("div");n.hidden=!0,n.className="visualizer visualizer-audiomotion",this.audioSourceNode=e.createMediaElementSource(new Audio);const r=this.visualizer=new Cm.Z(n,{source:this.audioSourceNode,showBgColor:!1,overlay:!0,showScaleX:!1,showScaleY:!1,connectSpeakers:!1});t.subscribe((e=>{this.audioSourceNode=e,this.element.hidden||r.connectInput(e)}))}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden!==e&&(this.element.hidden=e,e?this.visualizer.disconnectInput():this.visualizer.connectInput(this.audioSourceNode))}appendTo(e){e.append(this.element)}load(e){Tm.log("load"),e&&(Tm.log(`Using AudioMotion visualizer: ${e.name}`),this.visualizer.setOptions(e.options)),this.autoplay&&this.play()}play(){Tm.log("play"),this.visualizer.toggleAnalyzer(!0)}pause(){Tm.log("pause"),this.visualizer.toggleAnalyzer(!1)}stop(){this.visualizer.toggleAnalyzer(!0)}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}}(ld,hd()),Mm={id:"audiomotion",name:"audioMotion-analyzer",externalUrl:"https://audiomotion.dev/",player:zm,visualizers:Im,observeVisualizers:()=>$t(Im)};var Nm=n(2238),Om=n.n(Nm);const $m=new s("ButterchurnPlayer");const jm=new rn([]);function _m(){return jm.getValue()}function Rm(){return jm}setTimeout((()=>{return e=void 0,t=void 0,i=function*(){const e="butterchurn",{default:t}=yield n.e(577).then(n.t.bind(n,6607,23));if(t){jm.next(Object.keys(t).map((n=>({providerId:e,name:n,data:t[n]}))));const{default:r}=yield n.e(271).then(n.t.bind(n,3710,23));r&&jm.next(_m().concat(Object.keys(r).map((t=>({providerId:e,name:t,data:r[t]})))))}},new((r=void 0)||(r=Promise))((function(n,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(a,s)}l((i=i.apply(e,t||[])).next())}));var e,t,r,i}),1e3),Rm().pipe(rt((e=>e.length)),Vo((e=>0===e)),$n((e=>console.log("Butterchurn visualizers:",e))),Jt(2)).subscribe();const Dm=new class extends nc{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-butterchurn",(this.visualizer=Om().createVisualizer(e.context,this.canvas,{width:400,height:200})).connectAudio(e)}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?this.visualizer.disconnectAudio(this.analyser):(this.visualizer.connectAudio(this.analyser),this.animationFrameId||this.render()))}appendTo(e){e.append(this.canvas)}load(e){e&&($m.log(`Using Butterchurn visualizer: ${e.name}`),this.visualizer.loadPreset(e.data,.5)),this.play()}play(){$m.log("play"),this.animationFrameId||this.render()}pause(){$m.log("pause"),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}stop(){this.pause(),this.clear()}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.visualizer.render(),this.visualizer.setRendererSize(e,t),this.visualizer.render()}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(){this.visualizer.render(),this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((()=>this.render())))}}(cd),Lm={id:"butterchurn",name:"Butterchurn (Milkdrop)",externalUrl:"https://butterchurnviz.com/",player:Dm,get visualizers(){return _m()},observeVisualizers:Rm},Fm=new s("SpotifyVizPlayer"),Bm=["#18FF2A","#7718FF","#06C5FE","#FF4242","#18FF2A"];let Vm="",Um="";const Hm={volumeSmoothing:10,onBar(){Vm=Um||qm(Bm),Um=qm(Bm.filter((e=>e!==Um)))},onPaint({context2D:e,height:t,width:n,now:r,analyser:i}){const o=wc([0,10*i.volume,0])(i.bar.progress),a=wc([0,300*i.volume,0])(i.beat.progress);e.fillStyle="rgba(0, 0, 0, .08)",e.fillRect(0,0,n,t),e.lineWidth=o,e.strokeStyle=Pu(Vm,Um)(i.bar.progress),function(e,t,n,r,i,o=5){const a=e=>r*Math.sin(e/i+t)+n,{width:s}=e.canvas;e.beginPath();for(let t=-50;t<s+50;t+=o)-50===t?e.moveTo(t,a(t)):e.lineTo(t,a(t))}(e,r/50,t/2,50*i.volume,100),e.stroke(),e.fillStyle="rgba(0, 0, 0, 1)",e.beginPath(),e.lineWidth=a,function(e,t,n,r,i=0,o=2*Math.PI){e.beginPath(),e.arc(t,n,r,i,o),e.closePath()}(e,n/2,t/2,i.volume*t/5+a/10),e.stroke(),e.fill()}};function qm(e){return e[Math.floor(Math.random()*e.length)]}const Wm=[{providerId:"spotifyviz",name:"example by zachwinter",config:Hm,externalUrl:"https://github.com/zachwinter/spotify-viz/blob/master/client/example.js"}],Ym=Wm;console.log("spotify-viz visualizers:",Wm.length);const Km=new class extends nc{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-spotifyviz",e.observeBar().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onBar)||void 0===n||n.call(t,e)})),e.observeBeat().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onBeat)||void 0===n||n.call(t,e)})),e.observeSection().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onSection)||void 0===n||n.call(t,e)})),e.observeSegment().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onSegment)||void 0===n||n.call(t,e)})),e.observeTatum().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onTatum)||void 0===n||n.call(t,e)}))}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e||this.animationFrameId||this.render(performance.now()))}appendTo(e){e.append(this.canvas)}load(e){var t,n;Fm.log("load"),e&&(Fm.log(`Using SpotifyViz visualizer: ${e.name}`),this.config=e.config,this.analyser.volumeSmoothing=null!==(n=null===(t=e.config)||void 0===t?void 0:t.volumeSmoothing)&&void 0!==n?n:100),this.autoplay&&this.play()}play(){Fm.log("play"),this.animationFrameId||this.render(performance.now())}pause(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}stop(){this.pause(),this.clear()}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.renderFrame(performance.now())}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(e){this.renderFrame(e),this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((e=>this.render(e))))}renderFrame(e){var t,n;const r=this.context2D,i=this.canvas.width,o=this.canvas.height,a=this.analyser;null===(n=null===(t=this.config)||void 0===t?void 0:t.onPaint)||void 0===n||n.call(t,{context2D:r,width:i,height:o,now:e,analyser:a})}}(sd),Xm={id:"spotifyviz",name:"spotify-viz",externalUrl:"https://github.com/zachwinter/spotify-viz/",player:Km,visualizers:Ym,observeVisualizers:()=>$t(Ym)};function Gm(){return im.isLight&&im.isFrameLight?im.frameColor:im.textColor}const Jm=[{providerId:"waveform",name:"wave",config:{onPaint:({context2D:e,width:t,height:n,analyser:r})=>{const i=r.frequencyBinCount,o=new Uint8Array(i),a=t/i;let s=0;e.lineWidth=Math.round(im.fontSize/4),e.clearRect(0,0,t,n),e.strokeStyle=Gm(),e.beginPath(),r.getByteTimeDomainData(o);for(let t=0;t<i;t++){const r=o[t]/128*n/2;0===t?e.moveTo(s,r):e.lineTo(s,r),s+=a}e.lineTo(t,n/2),e.stroke()}}},{providerId:"waveform",name:"bars",config:{onPaint:({context2D:e,width:t,height:n,analyser:r})=>{const i=r.frequencyBinCount,o=new Uint8Array(i);r.getByteFrequencyData(o),e.clearRect(0,0,t,n),e.fillStyle=Gm();const a=(t-30)/16,s=.0075*n,l=i/16;let c,u=0;for(let t=0;t<i;t+=l){const r=o.slice(t,t+l).reduce(((e,t)=>e+t),0)/l;c=s*r,e.fillRect(u,n-c/2,a,c/2),u+=a+2}}}}],Qm=Jm;console.log("Waveform visualizers:",Jm.length);const Zm={id:"waveform",name:"Waveform",externalUrl:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API",player:new vd(ud),visualizers:Qm,observeVisualizers:()=>$t(Qm)};function ef(){return[vm,Sm,Mm,Lm,Xm,Zm]}function tf(e){return ef().find((t=>t.id===e))}function nf(e){var t;return(null===(t=tf(e))||void 0===t?void 0:t.visualizers)||[]}console.log("module::visualizerPlayer");const rf=new s("visualizerPlayer"),of=new ec("visualizer-player",ef().map((e=>e.player)),(function(e){return function(e){var t;return null===(t=tf(e))||void 0===t?void 0:t.player}(e.providerId)||null}),(function(e,t){e.load(t)}));of.loop=!0,of.muted=!0,of.volume=.07,of.observeError().subscribe(rf.error);const af=of;var sf,lf,cf=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},uf=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const df=new s("MusicKitPlayer"),mf="Apple Music player not connected.",ff="Video playback not supported.";sf=new WeakMap,lf=new WeakMap;const hf=new class{constructor(e){this.isLoggedIn$=e,this.paused$=new rn(!0),this.duration$=new tn,this.currentTime$=new tn,this.ended$=new tn,this.playing$=new tn,this.error$=new tn,this.playerReady$=new tn,this.activated$=new rn(!1),this.src$=new rn(""),this.loadedSrc="",this.isLoggedIn=!1,this.hasPlayed=!1,this.loop=!1,this.autoplay=!1,sf.set(this,!0),lf.set(this,1),this.onPlaybackStateChange=({state:e})=>{switch(e){case MusicKit.PlaybackStates.playing:{const[,,e]=this.src.split(":"),t=this.player.nowPlayingItem;!1===(null==t?void 0:t.isPlayable)&&(null==t?void 0:t.id)===e?(this.error$.next(Error("Unplayable")),this.stop()):this.paused?this.pause():this.playing$.next(void 0);break}case MusicKit.PlaybackStates.ended:this.ended$.next(void 0)}},this.onPlaybackDurationChange=({duration:e})=>{this.duration$.next(e)},this.onPlaybackTimeChange=({currentPlaybackTime:e})=>{this.currentTime$.next(e)},this.onPlaybackError=e=>{this.error$.next(e)};const t=this.element=document.createElement("div");t.hidden=!0,t.className="apple-video",t.id="apple-music-video-container",this.observeIsLoggedIn().pipe(Tt((e=>e)),$n((()=>{const e=this.player=MusicKit.getInstance(),t=MusicKit.Events;e.addEventListener(t.playbackStateDidChange,this.onPlaybackStateChange),e.addEventListener(t.playbackDurationDidChange,this.onPlaybackDurationChange),e.addEventListener(t.playbackTimeDidChange,this.onPlaybackTimeChange),e.addEventListener(t.mediaPlaybackError,this.onPlaybackError),e.volume=this.muted?0:this.volume,this.playerReady$.next(void 0)})),Jt(1)).subscribe(df),this.observeReady().pipe(At((()=>this.observeIsLoggedIn())),At((e=>e?this.observePaused():ht)),At((e=>e?ht:this.observeSrc())),At((e=>{if(e&&e!==this.loadedSrc){if(!this.canPlay(e))return this.error$.next(Error(ff)),ht;const[,t,n]=e.split(":");return kt(this.player.setQueue({[t]:n})).pipe(At((()=>(this.loadedSrc=e,this.autoplay?this.safePlay():ht))),Rn((e=>(this.loadedSrc="",this.error$.next(e),ht))))}return ht}))).subscribe(df),this.observeIsLoggedIn().pipe(Vo((e=>e===this.isLoggedIn))).subscribe((e=>{var t;this.isLoggedIn=e,!e&&(null===(t=this.player)||void 0===t?void 0:t.isPlaying)&&(this.stop(),this.error$.next(Error(mf)))})),this.observeError().subscribe(df.error)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e}get muted(){return cf(this,sf,"f")}set muted(e){cf(this,sf,"f")!==e&&(uf(this,sf,e,"f"),this.player&&(this.player.volume=e?0:this.volume))}get volume(){return cf(this,lf,"f")}set volume(e){cf(this,lf,"f")!==e&&(uf(this,lf,e,"f"),this.player&&(this.player.volume=this.muted?0:e))}observeCurrentTime(){return this.currentTime$.pipe(on())}observeDuration(){return this.duration$.pipe(on())}observePlaying(){return this.playing$}observeEnded(){return this.ended$}observeError(){return this.error$}appendTo(e){e.appendChild(this.element)}load(e){df.log("load",{src:e}),this.autoplay&&this.activated$.next(!0),this.src$.next(e),this.autoplay&&this.paused$.next(!1),this.player&&this.isLoggedIn?this.autoplay&&(e===this.loadedSrc?this.safePlay():this.canPlay(e)||this.error$.next(Error(ff))):this.autoplay&&this.error$.next(Error(mf))}play(){df.log("play"),this.activated$.next(!0),this.paused$.next(!1),this.player&&this.isLoggedIn?this.src===this.loadedSrc?this.safePlay():this.canPlay(this.src)||this.error$.next(Error(ff)):this.error$.next(Error(mf))}pause(){var e;df.log("pause"),this.paused$.next(!0),(null===(e=this.player)||void 0===e?void 0:e.isPlaying)&&this.player.pause()}stop(){df.log("stop"),this.paused$.next(!0),this.hasPlayed&&this.player.stop()}seek(e){var t;null===(t=this.player)||void 0===t||t.seekToTime(e)}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}get paused(){return this.paused$.getValue()}get src(){return this.src$.getValue()}observeIsLoggedIn(){return this.isLoggedIn$}observePaused(){return this.paused$.pipe(on())}observeReady(){return this.playerReady$.pipe(At((()=>this.activated$)),Tt((e=>e)),rt((()=>{})),Jt(1))}observeSrc(){return this.src$.pipe(on())}canPlay(e){var t;return!(null===(t=this.player)||void 0===t?void 0:t.version.startsWith("1"))||!/musicVideo/.test(e)}safePlay(){var e,t,n,r,i;return t=this,n=void 0,i=function*(){try{!1===(null===(e=this.player)||void 0===e?void 0:e.isPlaying)&&(yield this.player.play(),this.hasPlayed=!0)}catch(e){this.error$.next(e)}},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(a,s)}l((i=i.apply(t,n||[])).next())}))}}(xn());console.log("module::mediaPlayer");const pf=new rc("audio","main"),vf=new rc("video","main"),gf=new Nl("main"),bf=new ec("media-player",[pf,vf,gf,hf,Ba],(function(e){return e?e.src.startsWith("youtube:")?gf:e.src.startsWith("apple:")?hf:e.src.startsWith("spotify:")?Ba:e.mediaType===Sn.Video?vf:pf:null}),(function(e,t){if(null==t?void 0:t.unplayable)throw Error("Unplayable.");e.load(function(e){return e?e.blob?URL.createObjectURL(e.blob):e.src||"":""}(t))}));var yf=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::jellyfinReporting");const wf=new s("jellyfinReporting");function xf(e,t,n,r){return yf(this,void 0,void 0,(function*(){try{const[,,i]=e.src.split(":");yield hr.post("Sessions/Playing/Progress",{ItemId:i,IsPaused:n,PositionTicks:Math.floor(1e7*t),PlayMethod:"Transcode",EventName:r})}catch(e){wf.error(e)}}))}console.log("module::jellyfinScrobbler");const kf=new s("jellyfinScrobbler"),Ef=e=>{var t;return!!(null===(t=e.currentItem)||void 0===t?void 0:t.src.startsWith("jellyfin:"))};Ar().pipe(At((e=>e?fc():ht)),Tt(Ef),ot((({currentItem:e})=>function(e){return yf(this,void 0,void 0,(function*(){try{const[,,t]=e.src.split(":");yield hr.post("Sessions/Playing",{ItemId:t,IsPaused:!1,PositionTicks:0,PlayMethod:"Transcode"})}catch(e){wf.error(e)}}))}(e)))).subscribe(kf),Ar().pipe(At((e=>e?hc():ht)),Tt(Ef),ot((({currentItem:e,currentTime:t})=>function(e,t){return yf(this,void 0,void 0,(function*(){try{const[,,n]=e.src.split(":");yield hr.post("Sessions/Playing/Stopped",{ItemId:n,IsPaused:!1,PositionTicks:Math.floor(1e7*t),PlayMethod:"Transcode"})}catch(e){wf.error(e)}}))}(e,t)))).subscribe(kf),Ar().pipe(At((e=>e?pc(1e4):ht)),Tt(Ef),ot((({currentItem:e,currentTime:t,paused:n})=>xf(e,t,n,"timeupdate")))).subscribe(kf),Ar().pipe(At((e=>e?fc():ht)),At((e=>Ef(e)?mc().pipe(on(((e,t)=>e.paused===t.paused)),Ia(1),Pt(hc())):ht)),ot((({currentItem:e,currentTime:t,paused:n})=>xf(e,t,n,n?"pause":"unpause")))).subscribe(kf);const Sf=new m("scrobbling"),Cf=new rn(Sf.getJson("noScrobble",{})),Tf=new rn(Sf.getJson("options",{}));function Af(e,t){var n;const r=Cf.getValue()[e.id];return!(null!==(n=null==r?void 0:r[t.id])&&void 0!==n?n:t.defaultNoScrobble)}function Pf(e,t){const n=Cf.getValue(),r=n[e.id],i=Object.assign(Object.assign({},r),t),o=Object.assign(Object.assign({},n),{[e.id]:i});Sf.setJson("noScrobble",o),Cf.next(o)}function If(e){var t;return!!(null===(t=Tf.getValue()[e.id])||void 0===t?void 0:t.updateNowPlaying)}function zf(e,t){const n=Tf.getValue(),r=n[e.id],i=Object.assign(Object.assign({},r),t),o=Object.assign(Object.assign({},n),{[e.id]:i});Sf.setJson("options",o),Tf.next(o)}const Mf={canScrobble:Af,setNoScrobble:Pf,canUpdateNowPlaying:If,updateOptions:zf};console.log("module::lastfmScrobbler");const Nf=new s("lastfmScrobbler");function Of(e){const[t]=e.src.split(":"),n=Ha(t);return!n||Mf.canScrobble(di,n)}Jr().pipe(At((e=>e?fc():ht)),Tt((()=>Mf.canUpdateNowPlaying(di))),rt((({currentItem:e})=>e)),Tt(x),Tt((e=>Of(e))),ot((e=>ni.updateNowPlaying(e)))).subscribe(Nf),Jr().pipe(At((e=>e?ys():ht)),rt((e=>e.filter((e=>!e.lastfmScrobbledAt)))),os(1e4),ot((e=>function(e){return t=this,n=void 0,i=function*(){try{if(0===e.length)return;const t=e[0].playedAt+Math.floor(e[0].duration),n=e.at(-1).playedAt,r=new ii({from:n-30,to:t+30,limit:ii.maxPageSize}),i=yield Qt(r),o=i.map((e=>xs(e,30))),[a,s]=E(e,(e=>!Of(e)||o.includes(xs(e,30))||!!ks(i,e)));if(yield ws(a.map((e=>Object.assign(Object.assign({},e),{lastfmScrobbledAt:-1})))),s.length>0){s.reverse(),s.length=Math.min(s.length,50),yield ni.scrobble(s);const e=Math.floor(Date.now()/1e3);yield ws(s.map((t=>Object.assign(Object.assign({},t),{lastfmScrobbledAt:e}))))}}catch(e){Nf.error(e)}},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(a,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e)))).subscribe(Nf);console.log("module::listenbrainzScrobbler");const $f=new s("listenbrainzScrobbler");function jf(e){const[t]=e.src.split(":"),n=Ha(t);return!n||Mf.canScrobble(mo,n)}xi().pipe(At((e=>e?fc():ht)),Tt((()=>Mf.canUpdateNowPlaying(mo))),rt((({currentItem:e})=>e)),Tt(x),Tt((e=>jf(e))),ot((e=>Zi.updateNowPlaying(e)))).subscribe($f),xi().pipe(At((e=>e?ys():ht)),rt((e=>e.filter((e=>!e.listenbrainzScrobbledAt)))),os(1e4),ot((e=>function(e){return t=this,n=void 0,i=function*(){try{if(0===e.length)return;const t=e[0].playedAt+Math.floor(e[0].duration),n=e.at(-1).playedAt,r=new eo({min_ts:n-30,max_ts:t+30,count:eo.maxPageSize}),i=yield Qt(r),o=i.map((e=>xs(e,30))),[a,s]=E(e,(e=>!jf(e)||o.includes(xs(e,30))||!!ks(i,e)));if(yield ws(a.map((e=>Object.assign(Object.assign({},e),{listenbrainzScrobbledAt:-1})))),s.length>0){s.reverse(),s.length=Math.min(s.length,50),yield Zi.scrobble(s);const e=Math.floor(Date.now()/1e3);yield ws(s.map((t=>Object.assign(Object.assign({},t),{listenbrainzScrobbledAt:e}))))}}catch(e){$f.error(e)}},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(a,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e)))).subscribe($f);var _f=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::plexReporting");const Rf=new s("plexReporting");let Df=null;function Lf(e,t,n){return _f(this,void 0,void 0,(function*(){try{yield Ff(e,t,n)}catch(e){Rf.error(e)}}))}function Ff(e,t,n,r){return _f(this,void 0,void 0,(function*(){const[,,i]=e.src.split(":");yield yo.fetch({path:"/:/timeline",params:{key:i,ratingKey:e.plex.ratingKey,playQueueItemID:String(Df.playQueueSelectedItemID),state:n,hasMDE:"1",time:String(Math.floor(1e3*t)),duration:String(Math.floor(1e3*e.duration))},keepalive:r})}))}console.log("module::plexScrobbler");const Bf=new s("plexScrobbler"),Vf=e=>{var t;return!!(null===(t=e.currentItem)||void 0===t?void 0:t.src.startsWith("plex:"))};Ao().pipe(At((e=>e?fc():ht)),Tt(Vf),ot((({currentItem:e})=>function(e){return _f(this,void 0,void 0,(function*(){try{const[,,t]=e.src.split(":");Df=yield function(e){return _f(this,void 0,void 0,(function*(){return yo.fetchJSON({path:"/playQueues",method:"POST",params:{type:"music",continuous:"0",uri:`server://${ho.server.clientIdentifier}/com.plexapp.plugins.library/${e}`,repeat:"0",own:"1",includeExternalMedia:"1"}})}))}(t),yield Ff(e,0,"playing")}catch(e){Rf.error(e)}}))}(e)))).subscribe(Bf),Ao().pipe(At((e=>e?hc():ht)),Tt(Vf),ot((({currentItem:e})=>function(e){return _f(this,void 0,void 0,(function*(){try{yield Ff(e,0,"stopped",!0)}catch(e){Rf.error(e)}}))}(e)))).subscribe(Bf),Ao().pipe(At((e=>e?pc(1e4):ht)),Tt(Vf),ot((({currentItem:e,currentTime:t,paused:n})=>Lf(e,t,n?"paused":"playing")))).subscribe(Bf),Ao().pipe(At((e=>e?fc():ht)),At((e=>Vf(e)?mc().pipe(on(((e,t)=>e.paused===t.paused)),Ia(1),Pt(hc())):ht)),ot((({currentItem:e,currentTime:t,paused:n})=>Lf(e,t,n?"paused":"playing")))).subscribe(Bf);const Uf=new s("mediaPlayback/scrobbler");hc().pipe(ot((e=>function(e){var t;return fs(this,void 0,void 0,(function*(){try{const n=e.currentItem;if(!n||!e.startedAt||!e.endedAt)throw Error("Invalid PlaybackState.");if(n.title&&(null===(t=n.artists)||void 0===t?void 0:t[0])&&n.duration>30){const t=Math.min(n.duration/2,240),r=Math.floor(e.startedAt/1e3);if(Math.floor(e.endedAt/1e3)-r>t){const{id:e,lookupStatus:t}=n,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(n,["id","lookupStatus"]);hs.log("add",{listen:i}),yield bs.items.add(Object.assign(Object.assign({},i),{playedAt:r,lastfmScrobbledAt:0,listenbrainzScrobbledAt:0}))}}}catch(e){hs.error(e)}}))}(e)))).subscribe(Uf);console.log("module::mediaPlayback");const Hf=new s("mediaPlayback"),qf=new m("mediaPlayback"),Wf=new m("mediaPlayback","session"),Yf=new rn(!1),Kf=new tn;let Xf="forward";function Gf(){return xl.observeCurrentItem()}function Jf(){return bc.observeCurrentTime()}function Qf(){return bc.observeDuration()}function Zf(){return bf.observeEnded()}function eh(){return bc.observePaused()}function th(){return bc.observePlaybackStart()}function nh(){return bc.observePlaybackEnd()}function rh(){return bf.observePlaying()}function ih(e){Hf.log("load",{item:e}),bf.load(e),bf.autoplay&&bc.play()}function oh(){Hf.log("play"),Xf="forward",ph(),bc.play(),bc.paused||(bf.play(),af.play())}function ah(){Hf.log("pause"),ph(),bc.pause(),bf.pause(),af.pause()}function sh(e){Hf.log("seek",{time:I(e)}),bf.seek(e)}function lh(){Hf.log("stop"),ph(),bc.stop(),bf.stop(),af.stop()}function ch(){Xf="backward",xl.atStart||(hh(),xl.prev())}function uh(){Xf="forward",xl.atEnd||(hh(),xl.next())}function dh(){hh(),xl.eject()}function mh(){xl.shuffle()}function fh(){return Mn([xl.observeCurrentIndex(),xl.observeSize()]).pipe(rt((([e,t])=>e===t-1)),on())}function hh(){bc.paused||!1!==Yf.getValue()||(bc.stop(),bf.stop(),bc.play()),Yf.next(!0)}function ph(){Yf.next(!1)}function vh(e){return t=this,n=void 0,i=function*(){if(!Wa(e)){const t=yield Rs(e);if(t)return Object.assign(Object.assign({},e),t)}return e},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(a,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}const gh={get autoplay(){return bf.autoplay},set autoplay(e){bf.autoplay=e,af.autoplay=e},get hidden(){return!1},get loop(){return!1},get muted(){return bf.muted},set muted(e){Wf.setBoolean("muted",e),bf.muted=e},get paused(){return bc.paused},get volume(){return bf.volume},set volume(e){qf.setNumber("volume",e),bf.volume=e},observeCurrentItem:Gf,observeCurrentTime:Jf,observeDuration:Qf,observeEnded:Zf,observeError:function(){return bf.observeError()},observePaused:eh,observePlaying:rh,observePlaybackStart:th,observePlaybackEnd:nh,observePlaybackProgress:function(e){return bc.observePlaybackProgress(e)},observePlaybackState:function(){return bc.observePlaybackState()},appendTo:function(e){const t=e.querySelector("#playback");bf.appendTo(t),af.appendTo(t)},load:ih,play:oh,pause:ah,stop:lh,seek:sh,resize:function(e,t){bf.resize(e,t),af.resize(e,t)},next:uh,prev:ch,shuffle:mh},bh=gh;gh.muted=Wf.getBoolean("muted"),gh.volume=qf.getNumber("volume",1),bf.observeCurrentTime().subscribe((e=>bc.setCurrentTime(e))),bf.observeDuration().subscribe((e=>bc.setDuration(e))),bf.observePlaying().subscribe((()=>bc.started())),bf.observeEnded().subscribe((()=>bc.ended())),bf.observePlaying().subscribe((()=>Xf="forward")),bf.observeEnded().pipe(Pa(fh()),Pt(Kf)).subscribe((([,e])=>{e?lh():xl.next()})),bf.observeError().pipe(Pa(eh(),xl.observeCurrentIndex().pipe(rt((e=>0===e)),on()),fh()),Pt(Kf)).subscribe((([,e,t,n])=>{n||t&&"backward"===Xf?lh():e||("backward"===Xf?xl.prev():xl.next())})),xl.observeSize().pipe(rt((e=>0===e)),on(),Tt((e=>e))).subscribe(lh),Yf.pipe(os(250),Tt((e=>e))).subscribe((()=>{gh.autoplay=!bc.paused,Yf.next(!1)})),Yf.pipe(on(),At((e=>e?ht:Gf())),on(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),At((e=>e?vh(e):$t(null))),$n(ih)).subscribe(Hf),Yf.pipe(on(),At((e=>e?ht:xl.observeNextItem())),on(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),os(1e4),At((e=>e?vh(e):ht))).subscribe(Hf),dt(window,"pagehide").subscribe((function(){Kf.next(void 0),lh()})),Qf().pipe(rt(I),on()).subscribe(Hf.rx("duration")),Jf().pipe(Tt((e=>Math.round(e)%30==0)),rt(I)).subscribe(Hf.rx("currentTime")),rh().subscribe(Hf.rx("playing")),Zf().subscribe(Hf.rx("ended")),th().subscribe(Hf.rx("playbackStart")),nh().subscribe(Hf.rx("playbackEnd"));var yh=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module:musicbrainz/coverart");const wh=new s("musicbrainz/coverart");class xh extends ms.ZP{constructor(){super("ampcast/musicbrainz/coverart"),this.version(1).stores({items:"&mbid, album, artist, thumbnails"})}}const kh=new xh;function Eh(e){switch(e){case"small":return 250;case"large":return 500;default:return Number(e)||0}}function Sh({item:e,maxSize:t,className:n=""}){const[i,o]=(0,r.useState)((()=>e.thumbnails)),a=!!(null==i?void 0:i.length),s=a?function(e,t=360,n=1){e.sort(((e,t)=>t.width*t.height-e.width*e.height));const[r,i]=E(e,(e=>e.width<=t&&e.height<=t));return r.length>0?(r.sort(((e,t)=>{const r=e.width/e.height,i=Math.abs(r-n),o=t.width/t.height;return i-Math.abs(o-n)})),r[0]):i[i.length-1]}(i,t):void 0,l=s?Ch(s):"",c=function(e){switch(e){case Gt.Artist:return"person";case Gt.Album:return"album";case Gt.Media:return"note"}}(e.itemType);(0,r.useEffect)((()=>{if(!a){if(e.itemType===Gt.Media){const t=Es(e);if(t&&t.thumbnails)return void o(t.thumbnails)}const t=kt(function(e){var t;return yh(this,void 0,void 0,(function*(){if(!e||e.itemType!==Gt.Album&&e.itemType!==Gt.Media)return;let n=!1;const r=e.release_mbid;if(r){const e=yield kh.items.get(r);if(n=!!e,null==e?void 0:e.thumbnails)return e.thumbnails}let i,o;if(e.itemType===Gt.Album?(i=e.title,o=e.artist):(i=e.album,o=e.albumArtist||(null===(t=e.artists)||void 0===t?void 0:t[0])),i&&o){const e=yield kh.items.get({album:i,artist:o});if(e)return e.thumbnails}if(r&&!n)try{const e=yield function(e){return yh(this,void 0,void 0,(function*(){const t=yield fetch(`https://coverartarchive.org/release/${e}`);if(!t.ok)throw t;return t.json()}))}(r),t=e.images.filter((e=>e.front&&e.approved))[0],n=t?Object.keys(t.thumbnails).filter((e=>0!==Eh(e))).map((e=>({url:t.thumbnails[e],width:Eh(e),height:Eh(e)}))):[];return yield kh.items.put(0===n.length?{mbid:r}:{mbid:r,album:i,artist:o,thumbnails:n}),n}catch(e){404===e.status?yield kh.items.put({mbid:r}):wh.error(e)}}))}(e)).subscribe(o);return()=>t.unsubscribe()}}),[a,e]);const u=(0,r.useCallback)((e=>{e.target.removeAttribute("src")}),[]);return r.createElement("figure",{className:`cover-art ${n}`},l?r.createElement("img",{className:"cover-art-image",src:l,onError:u}):c?r.createElement(vr,{className:"cover-art-image",name:c}):null)}function Ch(e){return e.url.replace("{plex-token}",ho.serverToken)}function Th({item:e}){switch(e.itemType){case Gt.Media:return r.createElement(Ah,{item:e});case Gt.Artist:return r.createElement(Ih,{item:e});case Gt.Album:return r.createElement(Ph,{item:e});case Gt.Playlist:return r.createElement(zh,{item:e})}}function Ah({item:e}){var t;return r.createElement("article",{className:"media-info media-item-info"},r.createElement("div",{className:"media-info-main"},r.createElement(Lh,{item:e}),r.createElement(Mh,{title:e.title}),r.createElement(Oh,{artist:null===(t=e.artists)||void 0===t?void 0:t.join(", ")}),r.createElement(_h,{album:e.album,year:e.year}),r.createElement(Rh,{album:e.album,track:e.track}),r.createElement($h,{owner:e.owner,src:e.src})),r.createElement(jh,{url:e.externalUrl,src:e.src}))}function Ph({item:e}){return r.createElement("article",{className:"media-info album-info"},r.createElement("div",{className:"media-info-main"},r.createElement(Lh,{item:e}),r.createElement(Mh,{title:e.title}),r.createElement(Oh,{artist:e.artist}),r.createElement(Dh,{year:e.year})),r.createElement(jh,{url:e.externalUrl,src:e.src}))}function Ih({item:e}){return r.createElement("article",{className:"media-info artist-info"},r.createElement("div",{className:"media-info-main"},r.createElement(Lh,{item:e}),r.createElement(Mh,{title:e.title})),r.createElement(jh,{url:e.externalUrl,src:e.src}))}function zh({item:e}){return r.createElement("article",{className:"media-info playlist-info"},r.createElement("div",{className:"media-info-main"},r.createElement(Lh,{item:e}),r.createElement(Mh,{title:e.title}),r.createElement($h,{owner:e.owner,src:e.src})),r.createElement(jh,{url:e.externalUrl,src:e.src}),r.createElement(Nh,{description:e.description}))}function Mh({title:e}){return r.createElement("h3",{className:"title"},e||"(no title)")}function Nh({description:e}){return e?r.createElement("div",{className:"blurb text-box"},r.createElement("p",null,e)):null}function Oh({artist:e}){return e?r.createElement("h4",{className:"artist"},"By: ",e):null}function $h({src:e,owner:t}){if(!t||!t.name)return null;const[n]=e.split(":"),i="youtube"===n?"Channel":"Curator";return r.createElement("p",{className:"owner"},i,":"," ",t.url?r.createElement(mi,{href:t.url},t.name):t.name)}function jh({src:e,url:t}){if(!t)return null;let[n]=e.split(":"),i="";switch(n){case"musicbrainz":i="MusicBrainz";break;case"listenbrainz":/musicbrainz/.test(t)?(i="MusicBrainz",n="musicbrainz"):i="ListenBrainz";break;default:{const e=Ha(n);e&&(i=e.name)}}return r.createElement("p",{className:"external-view"},i?r.createElement(r.Fragment,null,"View on ",i,": ",r.createElement(vr,{name:n})," "):r.createElement(r.Fragment,null,"Url: "),r.createElement(mi,{href:t}))}function _h({album:e,year:t}){return e&&t?r.createElement("h4",{className:"album"},"From: ",e," (",t,")"):e?r.createElement("h4",{className:"album"},"From: ",e):t?r.createElement("h4",{className:"album"},"Year: ",t):null}function Rh({album:e,track:t}){return e&&t?r.createElement("p",{className:"track"},"Track: #",t):null}function Dh({year:e}){return e?r.createElement("p",{className:"year"},"Year: ",e):null}function Lh(e){return r.createElement("div",{className:"thumbnail"},r.createElement(Sh,Object.assign({},e)))}function Fh(e){wr((t=>r.createElement(Bh,Object.assign({},t,{item:e}))))}function Bh(e){var{item:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["item"]);const i=function(e){switch(e.itemType){case Gt.Playlist:return"Playlist info";case Gt.Album:return"Album info";case Gt.Artist:return"Artist info";default:return"Media info"}}(t);return r.createElement(yr,Object.assign({},n,{className:"media-info-dialog",title:i}),r.createElement("form",{method:"dialog"},r.createElement(Th,{item:t}),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",null,"Close"))))}function Vh(e,t){const[n,i]=(0,r.useState)(t),o=(0,r.useMemo)(e,[e]);return(0,r.useEffect)((()=>{const e=o.subscribe(i);return()=>e.unsubscribe()}),[o]),n}function Uh(){return Vh(ml,null)}let Hh=null,qh="none";const Wh=function(e){return"#globalDrag"===e.dataTransfer.getData("text")?Hh:null},Yh=function(e){return"#globalDrag"===e.dataTransfer.getData("text")?qh:"none"},Kh=function(e,t,n){e.dataTransfer.setData("text","#globalDrag"),e.dataTransfer.effectAllowed=n,Hh=t,qh=n},Xh=function(){Hh=null,qh="none"};function Gh(e){const t=(0,r.useRef)();return(0,r.useEffect)((()=>{t.current=e}),[e]),t.current}function Jh({style:e,title:t}){return r.createElement("div",{className:"list-view-cell",style:e},t)}function Qh({col:e,onResize:t}){const[n,i]=(0,r.useState)(e.width),[o,a]=(0,r.useState)(-1),[s,l]=(0,r.useState)(0),c=-1!==o,u=(0,r.useCallback)((e=>{e.preventDefault(),0===e.button&&(a(e.screenX),l(n))}),[n]);(0,r.useEffect)((()=>t(e.index,n)),[e.index,n,t]);const d=(0,r.useCallback)((e=>{i(Math.max(20,s+(e.screenX-o)))}),[o,s]),m=(0,r.useCallback)((()=>{a(-1),l(0)}),[]);return(0,r.useEffect)((()=>{if(c)return document.documentElement.style.cursor="col-resize",document.body.classList.add("dragging"),document.addEventListener("mouseup",m),document.addEventListener("mousemove",d),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",d)}}),[c,d,m]),r.createElement("span",{className:"column-resizer",onMouseDown:u,style:{left:e.left+n-4+"px"}})}function Zh({width:e,height:t,cols:n,sizeable:i,onColumnResize:o}){const a=(0,r.useCallback)(((e,t)=>{null==o||o(e,t)}),[o]);return r.createElement("header",{className:"list-view-head",style:{width:`${e}px`}},r.createElement("div",{className:"list-view-row",style:{width:`${e}px`,height:`${t}px`}},n.map((e=>r.createElement(Jh,Object.assign({},e,{key:e.title}))))," ",i&&n.map((e=>r.createElement(Qh,{col:e,onResize:a,key:e.title})))))}function ep({rowIndex:e,col:{className:t="",render:n,style:i},item:o}){return r.createElement("div",{className:`list-view-cell ${t}`,style:i},n(o,e))}function tp({item:e,className:t,rowIndex:n,height:i,selected:o,cols:a,setSize:s,dragIndex:l}){const c=`${t} ${o?"selected selected-text":""} ${l===s?n===s-1?"drag-over-last":"":l===n?"drag-over":""}`;return r.createElement("li",{role:"option",className:`list-view-row ${c}`,"aria-selected":o?"true":void 0,"aria-setsize":s,"aria-posinset":n+1,style:{height:`${i}px`,transform:`translateY(${i*n}px)`}},a.map((t=>r.createElement(ep,{rowIndex:n,col:t,item:e,key:t.title}))))}function np({width:e,height:t,rowHeight:n,cols:i,items:o,itemKey:a,itemClassName:s,scrollTop:l,overScan:c=20,selection:u,draggable:d,dragIndex:m}){const f=(0,r.useRef)(null),h=o.length,p=Math.floor(l/n),v=Math.floor(t/n),g=Math.max(0,p-c),b=Math.min(h,v+2*c),y=(0,r.useMemo)((()=>o.slice(g,g+b)),[o,g,b]);return r.createElement("ol",{role:"listbox",className:"list-view-body",draggable:d,style:{width:e?`${e}px`:void 0},ref:f},y.map(((e,t)=>r.createElement(tp,{className:s(e),rowIndex:g+t,height:n,selected:u.includes(e),cols:i,item:e,setSize:h,dragIndex:m,key:e[a]}))))}const rp=()=>"";function ip({items:e=[],itemKey:t,itemClassName:n=rp,layout:i,className:o="",draggable:a,droppable:s,droppableTypes:l=[],multiSelect:c,reorderable:u,onClick:d,onDoubleClick:m,onContextMenu:f,onDrop:h,onDelete:p,onEnter:v,onInfo:g,onRowIndexChange:b,onScrollIndexChange:y,onPageSizeChange:x,onSelect:k,onMove:E,listViewRef:S}){var C;const T=(0,r.useRef)(null),A=(0,r.useRef)(null),P=(0,r.useRef)(null),I=(0,r.useRef)(null),z="details"===i.view&&i.showTitles,M="details"===i.view&&i.sizeable,[N,O]=(0,r.useState)(-1),[$,j]=(0,r.useState)(0),[_,R]=(0,r.useState)(0),[D,F]=(0,r.useState)(0),[V,U]=(0,r.useState)(0),[H,q]=function(e,t=!1){const[n,i]=(0,r.useState)([]);(0,r.useEffect)((()=>{i(e.reduce(((e,n,r)=>{const i=e[r-1],o=i?i.left+i.width:0,{className:a="",align:s="left",sortOrder:l="none",sortPriority:c=0,width:u=200}=n,d=t?{left:`${o}px`,width:`${u}px`,textAlign:s}:{textAlign:s};return e.push(Object.assign(Object.assign({},n),{className:a,align:s,index:r,left:o,width:u,style:d,sortOrder:l,sortPriority:c})),e}),[]))}),[e,t]);const o=(0,r.useCallback)(((e,r)=>{t&&n[e].width!==r&&i(n.reduce(((t,n,i)=>{if(i>=e){const o=t[i-1],a=o?o.left+o.width:0,s=i===e?r:n.width,l={left:`${a}px`,width:`${s}px`,textAlign:n.align};t.push(Object.assign(Object.assign({},n),{left:a,width:s,style:l}))}else t.push(n);return t}),[]))}),[n,t]);return[n,o]}(i.cols,M),W=(0,r.useMemo)((()=>H.reduce(((e,t)=>e+t.width),0)),[H]),Y=V?Math.floor(_/V)-(z?1:0):0,K=e.length,{selectedItems:X,selectAll:G,selectAt:J,selectRange:Q,toggleSelectionAt:Z}=function(e,t,n){const[i,o]=(0,r.useState)([]),a=Gh(e);(0,r.useLayoutEffect)((()=>{if(e!==a){const a=e.filter((e=>i.some((n=>n[t]===e[t]))));if(s=a,(r=i).length!==s.length||!r.every(((e,t)=>s[t]===e))){const t=e.length;t>0&&0===a.length?o(n<t?[e[n]]:n===t?[e[n-1]]:a):o(a)}}var r,s}),[a,e,i,t,n]);const s=(0,r.useCallback)((()=>{o(e.slice())}),[e]),l=(0,r.useCallback)((t=>{const n=e[t];o(n?[n]:[])}),[e]),c=(0,r.useCallback)(((t,n)=>{const r=Math.min(t,n),i=Math.max(t,n),a=e.slice(r,i+1);o(a)}),[e]),u=(0,r.useCallback)(((t,n)=>{const r=e[t],a=i.includes(r);a!==n&&o(a?i.filter((e=>e!==r)):i.concat(r))}),[e,i]);return{selectedItems:i,selectAll:s,selectAt:l,selectRange:c,toggleSelectionAt:u}}(e,t,N),ee=B(),[te,ne]=(0,r.useState)(-1),[re,ie]=(0,r.useState)(-1),[oe,ae]=(0,r.useState)(-1),se=0===K,le=null===(C=Gh(se))||void 0===C||C,ce=-1!==oe,ue=V?Math.floor($/V):0,de=jt()&&!(0===N||N===K-1),me=Gh(e),[fe,he]=(0,r.useState)((()=>X)),[pe,ve,ge,be]=a?X:[];(0,r.useEffect)((()=>{S&&(S.current={selectAll:G})}),[S,G]),(0,r.useLayoutEffect)((()=>null==b?void 0:b(N)),[N,b]),(0,r.useLayoutEffect)((()=>null==y?void 0:y(ue)),[ue,y]),(0,r.useLayoutEffect)((()=>null==x?void 0:x(Y)),[Y,x]),(0,r.useLayoutEffect)((()=>null==k?void 0:k(fe)),[fe,k]),(0,r.useEffect)((()=>O(Math.min(K-1,N))),[K,N]),(0,r.useEffect)((()=>{if(me&&e.length!==me.length){const n=me[N];if(n){const r=e.findIndex((e=>e&&e[t]===n[t]));-1!==r&&O(r)}}}),[e,me,N,t]),(0,r.useEffect)((()=>{de||he(X)}),[X,de]),(0,r.useEffect)((()=>{se?O(-1):le&&(O(0),J(0))}),[se,le,J]);const ye=(0,r.useCallback)((t=>{switch(t.key){case"Enter":t.stopPropagation(),t.repeat||null==v||v(X,t[w.ctrlKey],t.shiftKey);break;case"Delete":t.stopPropagation(),null==p||p(X);break;case"i":if(t.stopPropagation(),t[w.ctrlKey]&&!t.repeat){null==g||g(X);break}break;case"Info":t.preventDefault(),t.stopPropagation(),t.repeat||null==g||g(X);break;case"a":t[w.ctrlKey]&&(t.preventDefault(),t.stopPropagation(),t.repeat||G());break;case"Shift":t.repeat||ne(N);break;case" ":t.preventDefault(),t.repeat||(t[w.ctrlKey]?(t.stopPropagation(),Z(N)):X.includes(e[N])||(t.stopPropagation(),Z(N,!0)));break;default:{const n=e.length,r=function(e,t,n,r){switch(e){case"ArrowUp":t-=1;break;case"ArrowDown":t+=1;break;case"PageUp":t-=n-1;break;case"PageDown":t+=n-1;break;case"Home":t=0;break;case"End":t=r-1;break;default:return-1}return Math.min(Math.max(t,0),r-1)}(t.key,N,Y,n);if(-1!==r){if(t.preventDefault(),r!==N){t.stopPropagation();const e=A.current,i=Math.floor($/V);if(r>=i+Y-1){const t=(n+(z?1:0))*V,i=n-Y-1,o=Math.min(n-1,r+1)-Y,a=o===i?t:o*V;e.scrollTo({top:a})}else if(r<=i){const t=Math.max(0,r-1)*V;e.scrollTo({top:t})}O(r)}c&&t.shiftKey&&-1!==te?Q(te,r):t[w.ctrlKey]||J(r)}}}}),[N,e,Y,V,z,v,p,g,G,J,Q,Z,X,c,te,$]),we=(0,r.useCallback)((e=>{const t=op(e);-1!==t&&(O(t),c&&e[w.ctrlKey]?Z(t):c&&e.shiftKey?-1===te?Q(t,N):Q(te,t):function(e){const t=ap(e);return!!(null==t?void 0:t.classList.contains("selected"))}(e)||J(t))}),[J,Z,Q,N,te,c]),xe=(0,r.useCallback)((e=>{if(0===e.button){const t=op(e);-1!==t&&(!c||e[w.ctrlKey]||e.shiftKey||J(t))}}),[J,c]),ke=(0,r.useCallback)((e=>{"Shift"===e.key&&ne(-1)}),[]),Ee=(0,r.useCallback)((({width:e,height:t})=>{F(e),R(t)}),[]),Se=(0,r.useCallback)((({top:e})=>{j(e)}),[]);L(P,(0,r.useCallback)((()=>{U(P.current.getBoundingClientRect().height)}),[])),(0,r.useLayoutEffect)((()=>{T.current.classList.toggle("thin",20*ee>D)}),[ee,D]);const Ce=(0,r.useCallback)((t=>{const n=op(t);-1!==n&&(t.preventDefault(),null==d||d(e[n],n))}),[e,d]),Te=(0,r.useCallback)((e=>{e.preventDefault(),-1!==op(e)&&(null==f||f(X,e.pageX,e.pageY))}),[X,f]),Ae=(0,r.useCallback)((t=>{const n=op(t);-1!==n&&(t.preventDefault(),null==m||m(e[n],n))}),[e,m]);(0,r.useEffect)((()=>{const e=I.current;for(;e.hasChildNodes();)e.removeChild(e.lastChild);const t=Array.from(T.current.querySelectorAll(".list-view-body:not(list-view-drag-image) li.selected"));t.length=Math.min(t.length,4);for(let n=0;n<t.length;n++){const r=t[n].cloneNode(!0);r.style.transform=`translateY(${V*n}px)`,e.appendChild(r)}}),[pe,ve,ge,be,V]);const Pe=(0,r.useCallback)((e=>{const t=e.dataTransfer;if(a||u){t.setDragImage(I.current,-10,-10);let n="none";n=a&&u?"copyMove":a?"copy":"move",Kh(e,X,n),ae(N)}else t.effectAllowed="none"}),[a,u,X,N]),Ie=(0,r.useCallback)((e=>{e.preventDefault(),e.stopPropagation();const t=e.dataTransfer;if(s||u){const n=t.types.includes("text/plain");let r=op(e);-1===r&&(r=K),ce?u&&n?(t.dropEffect="move",ie(r)):(t.dropEffect="none",ie(-1)):s&&(n||sp(t.items,l))?(t.dropEffect="copy",ie(r)):(t.dropEffect="none",ie(-1))}else ce?t.dropEffect="copy":(t.dropEffect="none",ie(-1))}),[K,ce,s,l,u]),ze=(0,r.useCallback)((e=>{if(s||u){const t=e.dataTransfer;let n=op(e);-1===n&&(n=K);const r=Yh(e);if("copy"===r){const t=Wh(e);t&&(null==h||h(t,n))}else if("move"===r){const e=oe<n?-1:0;null==E||E(X,n),O(n+e)}else s&&sp(t.items,l)&&(null==h||h(t.files,n))}ie(-1),e.preventDefault(),e.stopPropagation()}),[K,X,s,l,u,oe,h,E]),Me=(0,r.useCallback)((()=>{Xh(),ae(-1)}),[]),Ne=(0,r.useCallback)((()=>{ie(-1)}),[]);return r.createElement("div",{className:`list-view list-view-${i.view} ${o}`,tabIndex:0,onClick:Ce,onContextMenu:Te,onDoubleClick:Ae,onDragStart:Pe,onDragEnter:Ie,onDragOver:Ie,onDragLeave:Ne,onDragEnd:Me,onDrop:ze,onKeyDown:ye,onKeyUp:ke,onMouseDown:we,onMouseUp:xe,ref:T},r.createElement(Ot,{scrollWidth:M?W:void 0,scrollHeight:(K+(s?1:0)+(z?1:0))*V,scrollAmount:V,droppable:s||u&&ce,onResize:Ee,onScroll:Se,scrollableRef:A},z&&r.createElement(Ve,null,r.createElement(Zh,{width:W,height:V,sizeable:M,cols:H,onColumnResize:q})),r.createElement(np,{width:M?W:void 0,height:_,rowHeight:V,cols:H,items:e,itemKey:t,itemClassName:n,scrollTop:$,selection:X,dragIndex:re,draggable:a||u}),r.createElement("div",{className:"list-view-cursor",style:{width:M?`${Math.min(D,W)}px`:void 0,transform:`translateY(${N*V}px)`},ref:P}),r.createElement("ul",{className:"list-view-drag-image list-view-body",ref:I})))}function op(e){let t=0;const n=ap(e);return n&&(t=Number(n.getAttribute("aria-posinset"))||0),t-1}function ap(e){let t=e.target;for(;t&&!(null==t?void 0:t.hasAttribute("aria-posinset"));)t=t.parentElement;return t}function sp(e,t){return-1!==Array.from(e).findIndex((e=>t.some((t=>((e,t)=>{const[n,r]=e.split("/"),[i,o]=t.split("/");return n===i&&(r===o||"*"===r)})(t,e.type)))))}function lp({children:e}){return r.createElement("footer",{className:"status-bar"},e)}function cp({items:e,size:t,maxSize:n,error:i,loading:o,loadingText:a="Loading",selectedCount:s,itemName:l="item",itemNamePlural:c=l+"s"}){let u="";if(o)u=r.createElement("span",{className:"message"},a,"...");else if(e.length>0){const i=e.reduce((e=>e+1),0),o=r.createElement("span",{className:"selected"},"(",up(s)," selected)"),a=i===t?`${t.toLocaleString()} ${1===t?l:c}`:`Loaded ${up(i)} of ${void 0===t?n||`${up(e.length)}+`:up(n?Math.min(t,n):t)} ${c}`;u=r.createElement("span",{className:"message"},a," ",o)}else if(i){const e=null==i?void 0:i.message;u=r.createElement("span",{className:"error"},e?`Error: ${e}`:"Error")}else u=r.createElement("span",{className:"message"},"0 ",c);return r.createElement(lp,null,u)}function up(e=0){return(e=Number(e))<1e4?String(e):e.toLocaleString()}new Image(0,0).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1H\nAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";const dp=(0,r.memo)((function({time:e}){const t=100/6,n=new Date(e);let i=n.getHours()+n.getMinutes()/60,o=Math.min(i,6),a=i-o;return i>12&&(i=24-i,a=Math.min(i,6),o=i-a),r.createElement("span",{role:"presentation",className:"sun-clock",title:n.toLocaleTimeString(),style:{"--am-alpha":o*t+"%","--pm-alpha":a*t+"%"}})}));function mp({time:e,className:t}){return r.createElement("time",{className:t},I(e))}const fp={view:"details",fields:["Title","Genre","Owner"]};const hp=e=>r.createElement(mp,{time:e.duration||0}),pp={Index:{title:"#",render:(e,t)=>t+1,className:"index",align:"right",width:60},Artist:{title:"Artist",render:e=>{var t;return e.itemType===Gt.Media?null===(t=e.artists)||void 0===t?void 0:t.join(", "):e.artist},className:"artist"},AlbumArtist:{title:"Album Artist",render:e=>e.albumArtist,className:"artist"},Title:{title:"Title",render:e=>e.title,className:"title"},Blurb:{title:"Description",render:e=>e.description,className:"blurb"},Album:{title:"Album",render:e=>e.album,className:"album"},AlbumAndYear:{title:"Album",render:e=>e.album?e.year?`${e.album} (${e.year})`:e.album:e.year||"",className:"album"},Track:{title:"Track",render:e=>e.track||"-",align:"right",width:80,className:"track"},Duration:{title:"Time",render:hp,align:"right",width:120,className:"duration"},PlayCount:{title:"Play Count",render:e=>vp(e.playCount),align:"right",width:120,className:"play-count"},TrackCount:{title:"Tracks",render:e=>vp(e.trackCount),align:"right",width:120,className:"track-count"},Year:{title:"Year",render:e=>e.year||"",align:"right",width:120,className:"year"},Genre:{title:"Genre",render:e=>{var t;return null===(t=e.genres)||void 0===t?void 0:t.join(", ")},className:"genre"},Owner:{title:"Owner",render:e=>{var t;return null===(t=e.owner)||void 0===t?void 0:t.name},className:"owner"},LastPlayed:{title:"Last played",render:e=>{if(!e.playedAt)return"";const t=new Date(1e3*e.playedAt),n=function(e){const t=Date.now()-e,n=6e4;if(t<12e4)return"just now";const r=36e5;if(t<54e5)return`${Math.round(t/n)} mins ago`;const i=24*r;if(t<1.5*i)return`${Math.round(t/r)} hours ago`;if(t<12*i)return`${Math.round(t/i)} days ago`;const o=7*i;if(t<10*o)return`${Math.round(t/o)} weeks ago`;const a=365*i;return t<a?`${Math.round(t/2592e6)} months ago`:t<2*a?"1 year ago":`${Math.floor(t/a)} years ago`}(t.valueOf());return r.createElement("time",{title:t.toLocaleDateString()},n)},className:"played-at"},ListenDate:{title:"Played On",render:e=>{if(!e.playedAt)return"";const t=1e3*e.playedAt;return r.createElement("time",{className:"cv"},r.createElement(dp,{time:t}),new Date(t).toLocaleDateString())},className:"played-at"},Thumbnail:{title:"Thumbnail",render:e=>r.createElement(Sh,{item:e}),className:"thumbnail"}};function vp(e){if(null==e)return"";const t=Number(e);return isNaN(t)?"":t.toLocaleString()}function gp(e){var{className:t="",pager:n=null,keepAlive:i,statusBar:o=!0,loadingText:a,onSelect:s,unplayable:l}=e,c=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["className","pager","keepAlive","statusBar","loadingText","onSelect","unplayable"]);const[u,d]=(0,r.useState)(0),m=function(e=fp){return(0,r.useMemo)((()=>function(e){const{view:t,fields:n}=e,r=n.map((e=>pp[e]));return"details"===t?{view:t,cols:r,showTitles:!0,sizeable:!0}:{view:t,cols:r}}(e)),[e])}(c.layout),[f,h]=(0,r.useState)(0),[p,v]=(0,r.useState)(0),[{items:g,loaded:b,error:y,size:w,maxSize:x},k]=function(e,t=!1){const[n,i]=function(){const e=(0,r.useRef)(null);null===e.current&&(e.current=new tn),(0,r.useEffect)((()=>()=>{var t;return null===(t=e.current)||void 0===t?void 0:t.complete()}),[]);const t=(0,r.useCallback)((t=>{e.current.next(t)}),[]);return[e.current,t]}(),[o,a]=(0,r.useState)([]),[s,l]=(0,r.useState)(void 0),[c,u]=(0,r.useState)(void 0),[d,m]=(0,r.useState)(),[f,h]=(0,r.useState)(!1),p=(0,r.useMemo)((()=>({items:o,size:s,maxSize:c,error:d,loaded:f})),[o,s,c,d,f]),v=(0,r.useCallback)(((e,t)=>{i([e,t])}),[i]);return(0,r.useEffect)((()=>{if(a([]),l(void 0),u(void 0),m(void 0),h(!1),!e)return;const r=e.observeItems(),i=e.observeSize(),o=e.observeError(),s=Et(r,o).pipe(Jt(1),rt((()=>!0))),c=new re;return c.add(r.subscribe(a)),c.add(i.subscribe(l)),c.add(o.subscribe(m)),c.add(s.subscribe(h)),c.add(n.subscribe((([t,n])=>e.fetchAt(t,n)))),t||c.add((()=>e.disconnect())),u(e.maxSize),()=>c.unsubscribe()}),[e,n,t]),[p,v]}(n,i),[E,S]=(0,r.useState)(0);(0,r.useEffect)((()=>d((e=>e+1))),[n]),(0,r.useEffect)((()=>{f>=0&&p>0&&k(f,p)}),[k,f,p,n]);const C=(0,r.useCallback)((e=>{S(e.length),null==s||s(e)}),[s]);return r.createElement("div",{className:`panel ${t}`},r.createElement(ip,Object.assign({},c,{className:"media-list "+(l?"":"playable"),layout:m,items:g,itemKey:"src",onPageSizeChange:v,onScrollIndexChange:h,onSelect:C,key:u})),o?r.createElement(cp,{items:g,error:y,size:w,maxSize:x,loading:!!n&&!b,loadingText:a,selectedCount:E}):null)}function bp({className:e="",children:t,onClose:n,x:i,y:o}){const a=(0,r.useRef)(null),[s,l]=(0,r.useState)({visibility:"hidden"});(0,r.useLayoutEffect)((()=>{const e={},t=a.current;i+t.offsetWidth>document.body.clientWidth?e.left=i-t.offsetWidth+"px":e.left=`${i}px`,o+t.offsetHeight>document.body.clientHeight?e.top=o-t.offsetHeight+"px":e.top=`${o}px`,l(e)}),[i,o]),(0,r.useEffect)((()=>{const e=Et(dt(document,"mousedown").pipe(At((()=>dt(document,"click")))),dt(document,"keydown",{capture:!0}),dt(document,"contextmenu",{capture:!0}),dt(window,"blur")).subscribe((()=>n("")));return()=>e.unsubscribe()}),[n]);const c=(0,r.useCallback)((e=>{let t=e.target;for(;t&&!t.value;)t=t.parentElement;(null==t?void 0:t.value)&&n(t.value)}),[n]);return r.createElement("menu",{className:`popup-menu ${e}`,onClick:c,style:s,ref:a},t)}function yp({label:e,acceleratorKey:t="",action:n}){return r.createElement("li",{className:"popup-menu-item"},r.createElement("button",{value:n},r.createElement("span",{className:"popup-menu-item-label"},e),r.createElement("span",{className:"popup-menu-item-accelerator-key"},t)))}function wp(e,t,n){return o=this,a=void 0,l=function*(){return new Promise(((o,a)=>{const s=document.getElementById("popup"),l=document.createElement("div"),c=(0,i.s)(l);try{const i=e=>{c.unmount(),l.remove(),o(e)};s.append(l),c.render(r.createElement(e,{x:t,y:n,onClose:i}))}catch(e){c.unmount(),l.remove(),a(e)}}))},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof s?e:new s((function(t){t(e)}))}(t.value).then(n,r)}i((l=l.apply(o,a||[])).next())}));var o,a,s,l}function xp(e,t,n,i){return o=this,a=void 0,l=function*(){return wp((t=>r.createElement(kp,Object.assign({},t,{items:e,unplayable:i}))),t,n)},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{i(l.next(e))}catch(e){t(e)}}function r(e){try{i(l.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof s?e:new s((function(t){t(e)}))}(t.value).then(n,r)}i((l=l.apply(o,a||[])).next())}));var o,a,s,l}function kp(e){var{items:t,unplayable:n}=e,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["items","unplayable"]);const o=1===t.length,a=!n&&t.every((e=>e.itemType===Gt.Media||e.itemType===Gt.Album));return r.createElement(bp,Object.assign({},i,{className:"actions"}),r.createElement("ul",{className:"actions-menu-items"},a?r.createElement(r.Fragment,null,r.createElement(yp,{label:"Queue",action:"queue",acceleratorKey:"Enter",key:"queue"}),r.createElement(yp,{label:"Play next",action:"play-next",acceleratorKey:"Shift+Enter",key:"play-next"}),r.createElement(yp,{label:"Play now",action:"play",acceleratorKey:`${w.ctrlKeyStr}+Enter`,key:"play"})):null,o?r.createElement(yp,{label:"Info...",action:"info",acceleratorKey:`${w.ctrlKeyStr}+I`,key:"info"}):null))}var Ep=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const Sp={view:"details",fields:["Artist","Title","Album","Track","Duration","Genre","PlayCount"]};function Cp(e){var{className:t="",layout:n=Sp,unplayable:i}=e,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["className","layout","unplayable"]);const a=Uh(),s=Vh(xl.observeCurrentIndex,-1),l=(0,r.useCallback)((e=>{const[t]=e.src.split(":");return`source-${t} ${e.src===(null==a?void 0:a.src)?"playing":""} ${e.unplayable?"unplayable":""}`}),[a]),c=(0,r.useCallback)(((e,t,n)=>Ep(this,void 0,void 0,(function*(){switch(yield xp(e,t,n,i)){case"play":bh.autoplay=!0,yield xl.insertAt(e,s+1),xl.next();break;case"play-next":yield xl.insertAt(e,s+1);break;case"queue":yield xl.add(e);break;case"info":Fh(e[0])}}))),[s,i]),u=(0,r.useCallback)((e=>{i||xl.add(e)}),[i]),d=(0,r.useCallback)(((e,t,n)=>Ep(this,void 0,void 0,(function*(){i||(t||n?t&&!n?(bh.autoplay=!0,yield xl.insertAt(e,s+1),xl.next()):n&&!t&&(yield xl.insertAt(e,s+1)):yield xl.add(e))}))),[s,i]),m=(0,r.useCallback)((([e])=>{e&&Fh(e)}),[]);return r.createElement(gp,Object.assign({},o,{className:`media-items ${t}`,itemClassName:l,layout:n,multiSelect:!0,draggable:!i,unplayable:i,onContextMenu:c,onDoubleClick:u,onEnter:d,onInfo:m}))}function Tp(e){var{source:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["source"]);return r.createElement("div",{className:"panel media-item-browser"},r.createElement(Cp,Object.assign({},n,{unplayable:t.unplayable})),";")}const Ap={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","ListenDate"]};function Pp(e){var{source:t,minDate:n="2010-01-1"}=e,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["source","minDate"]);const[o,a]=(0,r.useState)(0),s=function(e,t=0){const[n,i]=(0,r.useState)(),o=Xl(e,n);return(0,r.useEffect)((()=>i({startAt:t})),[t]),o}(t,o),l=(0,r.useCallback)((e=>{const t=new Date,n=new Date(e);n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate()?a(0):a(Math.floor(n.valueOf()/1e3))}),[]);return r.createElement(r.Fragment,null,r.createElement(Kl,{min:n,onSelect:l}),r.createElement(Tp,Object.assign({},i,{className:"history-browser",source:t,pager:s,layout:t.layout||Ap})))}const Ip="2002-11-20",zp=new s("lastfm/useHistoryStart");function Mp(){const e=function(){const[e,t]=(0,r.useState)((()=>qr.firstScrobbledAt)),n=""===e||e===Ip;return(0,r.useEffect)((()=>{if(n){t(Ip);const e=kt(ni.getUserInfo()).pipe(rt((e=>Number(e.user.playcount))),ot((e=>{return e?$t(e):(n=Z(t=()=>Error("No history."))?t:function(){return t},new Re((function(e){return e.error(n())})));var t,n})),rt((e=>Math.floor(e/50))),rt((e=>new ii({page:e},{pageSize:50}))),ot((e=>Qt(e))),rt((e=>e.at(-1))),Tt(x),rt((e=>new Date(1e3*e.playedAt))),rt(A),$n((e=>qr.firstScrobbledAt=e)),$n(t)).subscribe(zp);return()=>e.unsubscribe()}}),[n]),e}();return r.createElement(Pp,{source:si,minDate:e})}class Np{constructor(){this.items$=new rn([])}get maxSize(){}observeItems(){return this.items$}observeSize(){return this.observeItems().pipe(rt((e=>e.length)),on())}observeError(){return ht}fetchAt(){}disconnect(){this.items.forEach((e=>{var t;return null===(t=e.pager)||void 0===t?void 0:t.disconnect()}))}next(e){this.items$.next(e)}get items(){return this.items$.getValue()}}const Op={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]};function $p(e){var{source:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["source"]);const[,i]=(0,r.useReducer)((e=>e+1),0);return(0,r.useEffect)((()=>{const e=setInterval(i,6e4);return()=>clearInterval(e)}),[]),r.createElement(Tp,Object.assign({},n,{className:"recently-played-browser",source:t,layout:t.layout||Op}))}const jp=new s("LastFmRecentlyPlayedBrowser");function _p(){const e=function(){const e=(0,r.useMemo)((()=>Math.floor(Date.now()/1e3)),[]),[t,n]=(0,r.useState)(null);return(0,r.useEffect)((()=>{const t=new Np,r=new ii({to:e}),i=new _n(t,r),o=Et(ys().pipe(Ia(1),Ma(2e4)),Be(3e5)),a=r.observeItems().pipe(Vo((e=>0===e.length)),Jt(1),rt((e=>e[0].playedAt)),At((e=>o.pipe(ot((()=>function(e){return t=this,n=void 0,i=function*(){const t=new ii({from:e});return yield Qt(t)},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(a,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e+1))),$n((e=>t.next(e))))))).subscribe(jp);return n(i),()=>a.unsubscribe()}),[e]),t}();return r.createElement($p,{source:li,pager:e})}const Rp=[{value:"overall",text:"All time"},{value:"12month",text:"Year"},{value:"1month",text:"Month"},{value:"7day",text:"Week"}];function Dp(e){var{source:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["source"]);const[i,o]=(0,r.useState)(),a=function(e,t="overall"){const[n,i]=(0,r.useState)(),o=Xl(e,n);return(0,r.useEffect)((()=>i({period:t})),[t]),o}(t,i),s=(0,r.useCallback)((e=>{o(e.target.value)}),[]);return r.createElement(r.Fragment,null,r.createElement("div",{className:"lastfm-period-selector options"},r.createElement("ul",{className:"lastfm-periods"},Rp.map((({value:e,text:t})=>r.createElement("li",{className:"lastfm-period",key:e},r.createElement("input",{id:`lastfm-period-${e}`,type:"radio",name:"lastfm-period",value:e,defaultChecked:"overall"===e,onChange:s}),r.createElement("label",{htmlFor:`lastfm-period-${e}`},t)))))),r.createElement(mv,Object.assign({},n,{source:t,pager:a,layout:t.layout})))}const Lp="2015-09-17";function Fp(){const e=function(){const[e,t]=(0,r.useState)(hi.firstScrobbledAt),n=""===e||e===Lp;return(0,r.useEffect)((()=>{if(n){t(Lp);const e=kt(Zi.getListeningActivity()).pipe(rt((e=>e.find((e=>e.listen_count>0)))),Tt(x),rt((e=>A(1e3*Number(e.from_ts)))),$n((e=>hi.firstScrobbledAt=e)),Jt(1)).subscribe(t);return()=>e.unsubscribe()}}),[n]),e}();return r.createElement(Pp,{source:ao,minDate:e})}const Bp=new s("ListenBrainzRecentlyPlayedBrowser");function Vp(){const e=function(){const e=(0,r.useMemo)((()=>Math.floor(Date.now()/1e3)),[]),[t,n]=(0,r.useState)(null);return(0,r.useEffect)((()=>{const t=new Np,r=new eo({max_ts:e}),i=new _n(t,r),o=Et(ys().pipe(Ia(1),Ma(2e4)),Be(3e5)),a=r.observeItems().pipe(Vo((e=>0===e.length)),Jt(1),rt((e=>e[0].playedAt)),At((e=>o.pipe(ot((()=>function(e){return t=this,n=void 0,i=function*(){const t=new eo({min_ts:e});return yield Qt(t)},new((r=void 0)||(r=Promise))((function(e,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(a,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e+1))),$n((e=>t.next(e))))))).subscribe(Bp);return n(i),()=>a.unsubscribe()}),[e]),t}();return r.createElement($p,{source:so,pager:e})}var Up=function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const Hp={view:"card compact",fields:["Thumbnail","Title","Artist","Year"]};function qp(e){var{className:t="",layout:n=Hp,unplayable:i}=e,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["className","layout","unplayable"]);const a=Vh(xl.observeCurrentIndex,-1),s=(0,r.useCallback)((([e],t,n)=>Up(this,void 0,void 0,(function*(){switch(yield xp([e],t,n,i)){case"play":bh.autoplay=!0,yield xl.insertAt(e,a+1),xl.next();break;case"play-next":yield xl.insertAt(e,a+1);break;case"queue":yield xl.add(e);break;case"info":Fh(e)}}))),[a,i]),l=(0,r.useCallback)((e=>{i||xl.add(e)}),[i]),c=(0,r.useCallback)((([e],t,n)=>Up(this,void 0,void 0,(function*(){i||(t||n?t&&!n?(bh.autoplay=!0,yield xl.insertAt(e,a+1),xl.next()):n&&!t&&(yield xl.insertAt(e,a+1)):yield xl.add(e))}))),[a,i]),u=(0,r.useCallback)((([e])=>{e&&Fh(e)}),[]);return r.createElement(gp,Object.assign({},o,{className:`albums ${t}`,layout:n,draggable:!i,unplayable:i,onContextMenu:s,onDoubleClick:l,onEnter:c,onInfo:u}))}const Wp={view:"details",fields:["Index","Title","Artist","Duration"]};function Yp(e){var{source:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["source"]);const[i,o]=(0,r.useState)(null),a=(0,r.useCallback)((([e])=>{o(e||null)}),[]);return r.createElement("div",{className:"panel album-browser"},r.createElement(H,{id:"album-browser-layout",arrange:"rows",primaryIndex:1},r.createElement(qp,Object.assign({},n,{unplayable:t.unplayable,onSelect:a})),r.createElement(Cp,{className:"album-items",pager:null==i?void 0:i.pager,keepAlive:!0,layout:t.secondaryLayout||Wp,unplayable:t.unplayable})))}const Kp={view:"card minimal",fields:["Thumbnail","Title"]};function Xp(e){var{className:t="",layout:n=Kp}=e,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["className","layout"]);const o=(0,r.useCallback)((([e],t,n)=>{return r=this,i=void 0,a=function*(){"info"===(yield xp([e],t,n))&&Fh(e)},new((o=void 0)||(o=Promise))((function(e,t){function n(e){try{l(a.next(e))}catch(e){t(e)}}function s(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof o?e:new o((function(t){t(e)}))}(t.value).then(n,s)}l((a=a.apply(r,i||[])).next())}));var r,i,o,a}),[]),a=(0,r.useCallback)((([e])=>{e&&Fh(e)}),[]);return r.createElement(gp,Object.assign({},i,{className:`artists ${t}`,layout:n,onContextMenu:o,onInfo:a}))}const Gp=[{value:"all_time",text:"All time"},{value:"this_year",text:"Year"},{value:"month",text:"Month"},{value:"week",text:"Week"}];function Jp(e){var{source:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["source"]);const[i,o]=(0,r.useState)(),a=function(e,t="all_time"){const[n,i]=(0,r.useState)(),o=Xl(e,n);return(0,r.useEffect)((()=>i({range:t})),[t]),o}(t,i),s=(0,r.useCallback)((e=>{o(e.target.value)}),[]);return r.createElement(r.Fragment,null,r.createElement("div",{className:"listenbrainz-range-selector options"},r.createElement("ul",{className:"listenbrainz-ranges"},Gp.map((({value:e,text:t})=>r.createElement("li",{className:"listenbrainz-range",key:e},r.createElement("input",{id:`listenbrainz-range-${e}`,type:"radio",name:"listenbrainz-range",value:e,defaultChecked:"all_time"===e,onChange:s}),r.createElement("label",{htmlFor:`listenbrainz-range-${e}`},t)))))),r.createElement(Qp,Object.assign({},n,{source:t,pager:a,layout:t.layout})))}function Qp(e){switch(e.source.itemType){case Gt.Artist:return r.createElement("div",{className:"panel artist-browser"},r.createElement(Xp,Object.assign({},e)));case Gt.Album:return r.createElement(Yp,Object.assign({},e));default:return r.createElement(Tp,Object.assign({},e))}}const Zp={view:"card compact",fields:["Thumbnail","Title","Year"]},ev={view:"details",fields:["Index","Title","Artist","Duration"]},tv={view:"details",fields:["Index","Title","Artist","Duration","Album","Year"]};function nv(e){var{source:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["source"]);const[i,o]=(0,r.useState)(null),[a,s]=(0,r.useState)(null),[l,c]=(0,r.useState)(ev),u=(0,r.useCallback)((([e])=>{o(e||null)}),[]),d=(0,r.useCallback)((([e])=>{s(e||null),c(/^\w+:top-tracks/.test(null==e?void 0:e.src)?tv:ev)}),[]);return r.createElement("div",{className:"panel artist-browser"},r.createElement(H,{id:"artist-browser-layout",arrange:"columns",primaryIndex:0},r.createElement(Xp,Object.assign({},n,{unplayable:t.unplayable,onSelect:u})),r.createElement(H,{id:"artist-album-browser-layout",arrange:"rows",primaryIndex:1},r.createElement(qp,{className:"artist-albums",pager:null==i?void 0:i.pager,keepAlive:!0,layout:t.secondaryLayout||Zp,unplayable:t.unplayable,onSelect:d}),r.createElement(Cp,{className:"album-items",pager:null==a?void 0:a.pager,keepAlive:!0,layout:t.tertiaryLayout||l,unplayable:t.unplayable}))))}function rv({sources:e,onSourceChange:t}){const n=(0,r.useId)(),i=(0,r.useCallback)((n=>{const r=Number(n.target.value),i=e[r];null==t||t(i)}),[e,t]);return r.createElement("div",{className:"media-source-selector options"},r.createElement("ul",{className:"media-sources"},e.map(((e,t)=>r.createElement("li",{className:"media-source",key:e.id},r.createElement("input",{id:`${n}-${e.id}`,type:"radio",name:n,value:t,defaultChecked:0===t,onChange:i}),r.createElement("label",{htmlFor:`${n}-${e.id}`},e.title))))))}const iv={view:"card compact",fields:["Thumbnail","Title","TrackCount","Owner"]};function ov(e){var{className:t="",layout:n=iv,unplayable:i}=e,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["className","layout","unplayable"]);const a=(0,r.useCallback)((([e],t,n)=>{return r=this,o=void 0,s=function*(){"info"===(yield xp([e],t,n,i))&&Fh(e)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function i(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,i)}l((s=s.apply(r,o||[])).next())}));var r,o,a,s}),[i]),s=(0,r.useCallback)((([e])=>{e&&Fh(e)}),[]);return r.createElement(gp,Object.assign({},o,{className:`playlists ${t}`,layout:n,unplayable:i,onContextMenu:a,onInfo:s}))}const av={view:"details",fields:["Index","Artist","Title","Album","Duration","Genre"]};function sv(e){var{source:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["source"]);const[i,o]=(0,r.useState)(null),a=(0,r.useCallback)((([e])=>{o(e||null)}),[]);return r.createElement("div",{className:"panel playlist-browser"},r.createElement(H,{id:"playlist-browser-layout",arrange:"rows",primaryIndex:1},r.createElement(ov,Object.assign({},n,{unplayable:t.unplayable,onSelect:a})),r.createElement(Cp,{className:"playlist-items",pager:null==i?void 0:i.pager,keepAlive:!0,layout:t.secondaryLayout||av,unplayable:t.unplayable})))}function lv({error:e,children:t}){return r.createElement("div",{className:"panel error-screen"},r.createElement("div",{className:"error-screen-content"},r.createElement("h2",null,"Error"),r.createElement("pre",{className:"note error"},(null==e?void 0:e.message)||String(e)),t))}function cv({service:e,sources:t}){const n=Vh(e.observeIsLoggedIn,!1),i=function(e){return(0,r.useMemo)((()=>function({error:t}){return r.createElement(lv,{error:t},e&&r.createElement("p",null,r.createElement("button",{className:"disconnect",onClick:e.logout},"Reconnect to ",e.name,"...")))}),[e])}(e),o=`${e.id}/${t.map((e=>e.id))}`;return r.createElement("div",{className:`media-browser ${e.id}-browser`,key:o},n?r.createElement(Qa.ErrorBoundary,{fallbackRender:i},r.createElement(uv,{service:e,sources:t})):r.createElement(Dl,{service:e}))}function uv({service:e,sources:t}){const n=1===t.length?t[0]:null;switch(null==n?void 0:n.id){case"apple/video":return r.createElement(Vl,null);case"lastfm/top/tracks":case"lastfm/top/albums":case"lastfm/top/artists":return r.createElement(Dp,{source:n});case"listenbrainz/top/tracks":case"listenbrainz/top/albums":case"listenbrainz/top/artists":return r.createElement(Jp,{source:n});case"lastfm/history":return r.createElement(Mp,null);case"listenbrainz/history":return r.createElement(Fp,null);case"lastfm/recently-played":return r.createElement(_p,null);case"listenbrainz/recently-played":return r.createElement(Vp,null);default:return r.createElement(dv,{service:e,sources:t})}}function dv({sources:e}){const[t,n]=(0,r.useState)((()=>e[0])),[i,o]=(0,r.useState)(""),a=function(e,t=""){const[n,i]=(0,r.useState)(),o=Xl(e,n);return(0,r.useEffect)((()=>i({q:t})),[t]),o}(t,i),s=!!t.searchable;return r.createElement(r.Fragment,null,s&&r.createElement(Ll,{onSubmit:o}),e.length>1?r.createElement(rv,{sources:e,onSourceChange:n}):null,r.createElement(mv,{source:t,pager:a,layout:t.layout,loadingText:i?"Searching":void 0}))}function mv(e){switch(e.source.itemType){case Gt.Artist:return r.createElement(nv,Object.assign({},e));case Gt.Album:return r.createElement(Yp,Object.assign({},e));case Gt.Playlist:return r.createElement(sv,Object.assign({},e));default:return r.createElement(Tp,Object.assign({},e))}}function fv({icon:e,text:t,showConnectivity:n}){return r.createElement("span",{className:"media-source-label"},r.createElement(vr,{name:e,className:n?"show-connectivity":""}),r.createElement("span",{className:"text"},t))}console.log("component::MediaSources");const hv=new m("sources");function pv({onSelect:e}){const t=function(){const[e,t]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const e=Ka.pipe(rt((()=>{}))).pipe(rt((()=>Va().filter(Xa).map((e=>({id:e.id,label:r.createElement(fv,{icon:e.icon,text:e.name,showConnectivity:!0}),value:r.createElement(cv,{sources:e.roots,service:e}),startExpanded:!0,children:e.sources.filter(Xa).map((t=>({id:t.id,label:r.createElement(fv,{icon:t.icon,text:t.title}),value:r.createElement(cv,{sources:[t],service:e})})))})))))).subscribe(t);return()=>e.unsubscribe()}),[]),e}();return r.createElement("div",{className:"panel media-sources"},r.createElement(Wt,{roots:t,onSelect:e,storageId:hv.id}))}function vv({id:e,item:t,index:n,selected:i,onSelect:o}){const a=(0,r.useCallback)((()=>o(n)),[n,o]);return r.createElement("button",{className:"tab",id:`${e}-tab-${n}`,role:"tab","aria-selected":i,"aria-controls":`${e}-panel-${n}`,onFocus:a},t.tab)}function gv({id:e,item:t,index:n,hidden:i}){return r.createElement("div",{className:"tab-panel",id:`${e}-panel-${n}`,tabIndex:0,hidden:i,role:"tabpanel","aria-labelledby":`${e}-tab-${n}`},t.panel)}function bv({label:e,items:t,className:n=""}){const i=(0,r.useId)(),[o,a]=(0,r.useState)(0),s=t.length,l=(0,r.useCallback)((e=>{switch(e.key){case"left":e.preventDefault(),o>0&&(a(o-1),e.stopPropagation());break;case"right":e.preventDefault(),o<s-1&&(a(o+1),e.stopPropagation())}}),[o,s]);return r.createElement("div",{className:`tab-list ${n}`},r.createElement("ul",{className:"tab-list-tabs",role:"tablist","aria-label":e,onKeyDown:l},t.map(((e,t)=>r.createElement("li",{role:"presentation",key:t},r.createElement(vv,{id:i,item:e,index:t,selected:t===o,onSelect:a}))))),r.createElement("div",{className:"tab-list-panels"},t.map(((e,t)=>r.createElement(gv,{id:i,item:e,index:t,hidden:t!==o,key:t})))))}function yv({service:e}){const t=(0,r.useId)(),n=(0,r.useRef)(null),i=Vh(e.observeIsLoggedIn,!1),o=(0,r.useCallback)((()=>{const e=n.current.elements,t={};for(const n of e)t[n.value]=!n.checked;Ga(t)}),[]);return r.createElement("form",{className:"media-service-settings-general",method:"dialog",onSubmit:o},r.createElement("p",null,r.createElement("button",{type:"button",className:"disconnect",onClick:e.logout,disabled:!i},i?"Disconnect...":"Not connected")),r.createElement("fieldset",{ref:n},r.createElement("legend",null,"Display"),r.createElement("ul",null,e.sources.map((e=>r.createElement("li",{key:e.id},r.createElement("input",{id:`${t}-${e.id}`,type:"checkbox",value:e.id,defaultChecked:Xa(e)}),r.createElement("label",{htmlFor:`${t}-${e.id}`},e.title)))))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}function wv(){const e=(0,r.useRef)(null),t=(0,r.useCallback)((()=>{hn.useMusicKitBeta=e.current.checked}),[]);return r.createElement("form",{className:"apple-beta-settings",method:"dialog",onSubmit:t},r.createElement("fieldset",null,r.createElement("legend",null,"MusicKit"),r.createElement("p",null,r.createElement("input",{type:"radio",name:"use-musickit",id:"use-musickit-stable",defaultChecked:!hn.useMusicKitBeta}),r.createElement("label",{htmlFor:"use-musickit-stable"},"Stable version")),r.createElement("p",null,r.createElement("input",{type:"radio",name:"use-musickit",id:"use-musickit-beta",defaultChecked:hn.useMusicKitBeta,ref:e}),r.createElement("label",{htmlFor:"use-musickit-beta"},"Beta version"))),r.createElement("div",{className:"note"},r.createElement("p",null,"MusicKit beta enables playback of music videos."),r.createElement("p",null,"However, this release of MusicKit is still undergoing changes and may be unstable. If you experience any problems then use the stable release."),r.createElement("p",null,"You will need to refresh the page for changes to take effect.")),r.createElement("p",null,r.createElement("small",null,"MusicKit is a JavaScript library supplied by Apple that provides access to Apple Music services and media playback.")),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}function xv(){const e=(0,r.useMemo)((()=>[{tab:"General",panel:r.createElement(yv,{service:ir})},{tab:"Beta",panel:r.createElement(wv,null)}]),[]);return r.createElement(bv,{items:e,label:ir.name})}function kv({service:e}){const t=(0,r.useId)(),n=(0,r.useRef)(null),i=(0,r.useRef)(null),o=(0,r.useMemo)((()=>Va().filter((e=>!e.scrobbler))),[]),a=(0,r.useCallback)((()=>{const t=n.current.elements,r={};for(const e of t)r[e.value]=!e.checked;Pf(e,r);const o=i.current.elements,a={};for(const e of o)a[e.value]=e.checked;zf(e,a)}),[e]);return r.createElement("form",{className:"scrobbling-settings",method:"dialog",onSubmit:a},r.createElement("fieldset",{ref:n},r.createElement("legend",null,"Scrobble"),r.createElement("ul",null,o.map((n=>r.createElement("li",{key:n.id},r.createElement("input",{id:`${t}-${n.id}`,type:"checkbox",value:n.id,defaultChecked:Af(e,n),disabled:"youtube"===n.id}),r.createElement("label",{htmlFor:`${t}-${n.id}`},n.name)))))),r.createElement("fieldset",{ref:i},r.createElement("legend",null,"Options"),r.createElement("ul",null,r.createElement("li",null,r.createElement("input",{id:`${t}-scrobbling-options`,type:"checkbox",value:"updateNowPlaying",defaultChecked:If(e)}),r.createElement("label",{htmlFor:`${t}-scrobbling-options`},'Update "Now Playing"')))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}function Ev({service:e}){const t=(0,r.useMemo)((()=>{const t=[{tab:"General",panel:r.createElement(yv,{service:e})}];return e.scrobbler&&t.push({tab:"Scrobbling",panel:r.createElement(kv,{service:e})}),t}),[e]);return r.createElement(bv,{className:`media-service-settings ${e.id}-settings`,items:t,label:e.name})}function Sv(){return r.createElement(Ev,{service:Br})}function Cv(){return r.createElement(Ev,{service:di})}function Tv(){return r.createElement(Ev,{service:mo})}function Av(){return r.createElement(Ev,{service:Bo})}function Pv(){return r.createElement(Ev,{service:Ea})}function Iv(){return r.createElement(Ev,{service:Xi})}function zv(e){var{label:t,title:n="Input"}=e,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["label","title"]);const o=(0,r.useId)(),[a,s]=(0,r.useState)(""),l=(0,r.useCallback)((e=>{s(e.target.value)}),[]);return r.createElement(yr,Object.assign({},i,{className:"prompt-dialog",title:n}),r.createElement("form",{method:"dialog"},r.createElement("p",{className:"prompt-message"},r.createElement("label",{htmlFor:o},t,": ")),r.createElement("p",null,r.createElement("input",{type:"text",id:o,autoFocus:!0,onChange:l})),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{value:"#cancel"},"Cancel"),r.createElement("button",{value:a},"Confirm"))))}function Mv(e){var{colorName:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["colorName"]);const i=(0,r.useCallback)((e=>{im[t]=e.target.value}),[t]);return r.createElement("input",Object.assign({},n,{type:"color",onChange:i}))}const Nv=[{tab:"General",panel:r.createElement((function(){const e=(0,r.useMemo)((()=>im.fontSize),[]);(0,r.useLayoutEffect)((()=>{const e=document.getElementById("system").style;return e.setProperty("--font-size",String(im.fontSize)),()=>{im.restore(),e.removeProperty("--font-size")}}),[]);const t=(0,r.useCallback)((()=>im.save()),[]),n=(0,r.useCallback)((e=>{im.load(e.target.value)}),[]),i=(0,r.useCallback)((e=>{im.fontSize=e.target.valueAsNumber}),[]);return r.createElement("form",{className:"theme-settings",method:"dialog",onSubmit:t},r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("label",{htmlFor:"theme-name"},"Theme:"),r.createElement("select",{id:"theme-name",onChange:n,defaultValue:im.name},rm.map((({name:e})=>r.createElement("option",{value:e,key:e},e||"(boring default)"))))),r.createElement("p",{className:"font-size"},r.createElement("label",{htmlFor:"theme-fontSize"},"Font Size:"),r.createElement("input",{type:"range",id:"theme-fontSize",min:12,max:28,step:.4,defaultValue:e,onChange:i,key:e}))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}),null)},{tab:"Theme Editor",panel:r.createElement((function(){const e=Vh((0,r.useMemo)((()=>()=>im.observe()),[]),Bd),[t,n]=function(e){const[t,n]=(0,r.useState)([]),[i,o]=(0,r.useState)(-1);(0,r.useEffect)((()=>{const t=new _d(e),r=S([...t.triad(),...t.tetrad(),...t.splitcomplement(),...t.analogous(),...t.monochromatic()].map((e=>e.toHexString()))).map((e=>new _d(e))),i=r.reverse().map((e=>[e.toHexString(),Dd(e,["black","white"],{includeFallbackColors:!0,level:"AA",size:"large"}).toHexString()]));n(T(i)),o(-1===i.length?-1:0)}),[e]);const a=(0,r.useCallback)((()=>{o((e=>e===t.length-1?-1===t.length?-1:0:e+1))}),[t]);return[t[i],a]}(e.frameColor);(0,r.useLayoutEffect)((()=>{const e=document.getElementById("system").style;return e.setProperty("--font-size",String(im.fontSize)),()=>{im.restore(),e.removeProperty("--font-size")}}),[]);const i=(0,r.useCallback)((()=>im.save()),[]),o=(0,r.useCallback)((e=>{im.spacing=e.target.valueAsNumber}),[]),a=(0,r.useCallback)((e=>{im.roundness=e.target.valueAsNumber}),[]),s=(0,r.useCallback)((e=>{im.flat=e.target.checked}),[]),l=(0,r.useCallback)((()=>{return e=this,t=void 0,i=function*(){const e=yield function(e,t,n){return i=this,o=void 0,s=function*(){return wr((e=>r.createElement(zv,Object.assign({},e,{title:"Save As",label:"Name"}))),!0)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function r(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,r)}l((s=s.apply(i,o||[])).next())}));var i,o,a,s}();console.log({name:e})},new((n=void 0)||(n=Promise))((function(r,o){function a(e){try{l(i.next(e))}catch(e){o(e)}}function s(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){e.done?r(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}),[]),c=(0,r.useCallback)((()=>{const[e,r]=t;im.selectedBackgroundColor=e,im.selectedTextColor=r,n()}),[t,n]);return r.createElement("form",{className:"theme-editor",method:"dialog",onSubmit:i},r.createElement("div",{className:"table-layout"},r.createElement("p",{className:"theme-name"},r.createElement("label",{htmlFor:"theme-name"},"Name:"),r.createElement("input",{type:"text",id:"theme-name",defaultValue:e.name,spellCheck:!1,readOnly:!0}),r.createElement("button",{className:"small",type:"button",onClick:l,disabled:!0},"Save Asâ€¦")),r.createElement("p",null,r.createElement("label",{htmlFor:"theme-fontFamily"},"Font:"),r.createElement("select",{id:"theme-fontFamily",disabled:!0},r.createElement("option",null,"Arial, sans-serif"))),r.createElement("p",null,r.createElement("label",null,"Frame:"),r.createElement(Mv,{id:"frameColor",colorName:"frameColor",value:e.frameColor,title:"Frame background color"}),r.createElement(Mv,{colorName:"frameTextColor",value:e.frameTextColor,title:"Frame text color"})),r.createElement("p",null,r.createElement("label",null,"Content:"),r.createElement(Mv,{colorName:"backgroundColor",value:e.backgroundColor,title:"Content background color"}),r.createElement(Mv,{colorName:"textColor",value:e.textColor,title:"Content text color"})),r.createElement("p",null,r.createElement("label",null,"Selection:"),r.createElement(Mv,{colorName:"selectedBackgroundColor",value:e.selectedBackgroundColor,title:"Selected text background color"}),r.createElement(Mv,{colorName:"selectedTextColor",value:e.selectedTextColor,title:"Selected text color"}),r.createElement("button",{className:"small",type:"button",onClick:c},"Suggest")),r.createElement("p",null,r.createElement("label",{htmlFor:"theme-spacing"},"Spacing:"),r.createElement("input",{type:"range",id:"theme-spacing",min:0,max:1,step:.01,value:e.spacing,onChange:o})),r.createElement("p",null,r.createElement("label",{htmlFor:"theme-roundness"},"Roundness:"),r.createElement("input",{type:"range",id:"theme-roundness",min:0,max:1,step:.01,value:e.roundness,onChange:a})),r.createElement("p",null,r.createElement("label",{htmlFor:"theme-flat"},"Flat:"),r.createElement("input",{type:"checkbox",id:"theme-flat",checked:e.flat,onChange:s}))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}),null)}],Ov=[{tab:"General",panel:r.createElement((function(){const e=(0,r.useMemo)((()=>Qs()),[]),t=Vh(Js,e),n=(0,r.useRef)(null),i=(0,r.useRef)(null),o=(0,r.useRef)(null),a=(0,r.useRef)(null),s=(0,r.useCallback)((()=>{Zs(e)}),[e]),l=(0,r.useCallback)((()=>{Zs({allowDuplicates:n.current.checked,showLineNumbers:i.current.checked,zeroPadLineNumbers:o.current.checked,showSourceIcons:a.current.checked})}),[]);return r.createElement("form",{className:"playlist-settings-general",method:"dialog"},r.createElement("fieldset",null,r.createElement("legend",null,"Content"),r.createElement("p",null,r.createElement("input",{id:"playlist-allow-duplicates",type:"checkbox",checked:t.allowDuplicates,onChange:l,ref:n}),r.createElement("label",{htmlFor:"playlist-allow-duplicates"},"Allow duplicates"))),r.createElement("fieldset",null,r.createElement("legend",null,"Display"),r.createElement("p",null,r.createElement("input",{id:"playlist-item-numbers",type:"checkbox",checked:t.showLineNumbers,onChange:l,ref:i}),r.createElement("label",{htmlFor:"playlist-item-numbers"},"Show playlist line numbers")),r.createElement("p",null,r.createElement("input",{id:"playlist-zero-pad",type:"checkbox",checked:t.zeroPadLineNumbers,disabled:!t.showLineNumbers,onChange:l,ref:o}),r.createElement("label",{htmlFor:"playlist-zero-pad"},"Zero pad line numbers")),r.createElement("p",null,r.createElement("input",{id:"playlist-source-icons",type:"checkbox",checked:t.showSourceIcons,onChange:l,ref:a}),r.createElement("label",{htmlFor:"playlist-source-icons"},"Show media source icons"))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{value:"#cancel",onClick:s},"Cancel"),r.createElement("button",null,"Confirm")))}),null)}],$v=[{tab:"General",panel:r.createElement((function(){const e=(0,r.useRef)(null),t=sc.provider,n=(0,r.useCallback)((()=>{sc.provider=e.current.value}),[]);return r.createElement("form",{className:"visualizer-settings-general",method:"dialog",onSubmit:n},r.createElement("p",null,r.createElement("label",{htmlFor:"visualizer-provider"},"Provider:"),r.createElement("select",{id:"visualizer-provider",defaultValue:t,ref:e},r.createElement("option",{value:"none"},"(none)"),r.createElement("option",{value:""},"(random)"),ef().filter((e=>"ambientvideo"!==e.id||sc.ambientVideoEnabled)).map((e=>r.createElement("option",{value:e.id,key:e.id},e.name))))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}),null)},{tab:"Ambient Video",panel:r.createElement((function(){const e=(0,r.useRef)(null),t=(0,r.useRef)(null),n=(0,r.useRef)(null),i=(0,r.useRef)(null),o=(0,r.useRef)(null),[a,s]=(0,r.useState)((()=>!!sc.useAmbientVideoSource)),l=(0,r.useCallback)((()=>{sc.ambientVideoEnabled=e.current.checked,sc.useAmbientVideoSource=i.current.checked,sc.ambientVideoSource=n.current.value,sc.beatsOverlay=t.current.checked}),[]),c=(0,r.useCallback)((()=>{n.current.validity.valid||i.current.checked||(n.current.value=""),s(i.current.checked)}),[]),u=(0,r.useCallback)((()=>{const e=n.current.value;let t="Not a valid YouTube url.";/^https?/.test(e)&&/youtu\.?be/.test(e)&&(t="Not a YouTube video or playlist.",Wi(e)&&(t="")),n.current.setCustomValidity(t)}),[]),d=(0,r.useCallback)((e=>{"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),e.repeat||o.current.click())}),[]);return r.createElement("form",{className:"ambient-video-settings",method:"dialog",onKeyDown:d,onSubmit:l},r.createElement("p",null,r.createElement("input",{id:"ambient-video-enabled",type:"checkbox",defaultChecked:sc.ambientVideoEnabled,ref:e}),r.createElement("label",{htmlFor:"ambient-video-enabled"},"Enable ambient video")),r.createElement("fieldset",null,r.createElement("legend",null,"Source"),r.createElement("p",null,r.createElement("input",{type:"radio",name:"use-ambient-video-source",id:"use-ambient-video-source-default",defaultChecked:!sc.useAmbientVideoSource,onChange:c}),r.createElement("label",{htmlFor:"use-ambient-video-source-default"},"Default videos")),r.createElement("p",null,r.createElement("input",{type:"radio",name:"use-ambient-video-source",id:"use-ambient-video-source-youtube",defaultChecked:sc.useAmbientVideoSource,onChange:c,ref:i}),r.createElement("label",{htmlFor:"use-ambient-video-source-youtube"},"YouTube video or playlist:")),r.createElement("p",null,r.createElement("input",{type:"url",defaultValue:sc.ambientVideoSource,disabled:!a,required:a,onInput:u,ref:n}))),r.createElement("p",null,r.createElement("input",{id:"beats-overlay",type:"checkbox",defaultChecked:sc.beatsOverlay,ref:t}),r.createElement("label",{htmlFor:"beats-overlay"},'Show "beats" overlay')),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{value:"#cancel"},"Cancel"),r.createElement("button",{ref:o},"Confirm")))}),null)}];function jv(){return r.createElement(bv,{className:"visualizer-settings",items:$v,label:"Visualizers"})}function _v(e){return r.createElement(yr,Object.assign({},e,{className:"settings-dialog visualizer-settings-dialog",title:"Visualizer Settings"}),r.createElement(jv,null))}function Rv(){const e=(0,r.useId)(),t=(0,r.useRef)(null),n=(0,r.useCallback)((()=>{const e=t.current.elements,n={};for(const t of e)n[t.value]=!t.checked;Ga(n)}),[]);return r.createElement("form",{className:"media-library-settings-general",method:"dialog",onSubmit:n},r.createElement("fieldset",{ref:t},r.createElement("legend",null,"Display"),r.createElement("ul",null,Va().map((t=>r.createElement("li",{key:t.id},r.createElement("input",{id:`${e}-${t.id}`,type:"checkbox",value:t.id,defaultChecked:Xa(t)}),r.createElement("label",{htmlFor:`${e}-${t.id}`},t.name)))))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}function Dv(){const e=(0,r.useRef)(null),t=Is.preferredService,n=(0,r.useCallback)((()=>{Is.preferredService=e.current.value}),[]);return r.createElement("form",{className:"lookup-settings",method:"dialog",onSubmit:n},r.createElement("label",{htmlFor:"lookup-services"},"Preferred Service:"),r.createElement("select",{id:"lookup-services",defaultValue:t,ref:e},r.createElement("option",{value:""},"(none)"),Ua().map((e=>r.createElement("option",{value:e.id,key:e.id},e.name)))),r.createElement("div",{className:"note"},r.createElement("p",null,"To enable playback from last.fm and ListenBrainz, Ampcast will search your logged in services to find a match."),r.createElement("p",null,"Exact matches are preferred. If you have several exact matches then the match from the preferred lookup service is used.")),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}const Lv=[{id:"services",label:"Media Services",value:r.createElement((function(){const e=(0,r.useMemo)((()=>[{tab:"General",panel:r.createElement(Rv,null)},{tab:"Lookup",panel:r.createElement(Dv,null)}]),[]);return r.createElement(bv,{className:"media-library-settings",items:e,label:"Media Services"})}),null),startExpanded:!0,children:Va().map((e=>({id:e.id,label:r.createElement(fv,{icon:e.icon,text:e.name}),value:r.createElement(Fv,{service:e})})))},{id:"visualizer",label:"Visualizer",value:r.createElement(jv,null)},{id:"playlist",label:"Playlist",value:r.createElement((function(){return r.createElement(bv,{className:"playlist-settings",items:Ov,label:"Playlist Settings"})}),null)},{id:"appearance",label:"Appearance",value:r.createElement((function(){return r.createElement(bv,{className:"appearance-settings",items:Nv,label:"Appearance"})}),null)}];function Fv({service:e}){switch(e.id){case"apple":return r.createElement(xv,null);case"spotify":return r.createElement(Pv,null);case"youtube":return r.createElement(Iv,null);case"plex":return r.createElement(Av,null);case"jellyfin":return r.createElement(Sv,null);case"lastfm":return r.createElement(Cv,null);case"listenbrainz":return r.createElement(Tv,null)}}const Bv=new m("settings-sources");function Vv(e){const t=Lv,[n,i]=(0,r.useState)(null);return r.createElement(yr,Object.assign({},e,{className:"settings-dialog",title:"Settings"}),r.createElement(Wt,{className:"settings-dialog-sources",roots:t,storageId:Bv.id,onSelect:i}),r.createElement("div",{className:"settings-dialog-source"},n))}var Uv;function Hv(e){var{icon:t,className:n=""}=e,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["icon","className"]);return r.createElement("button",Object.assign({},i,{className:`icon-button icon-button-${t} ${n}`,onMouseDown:z,onDoubleClick:M}),r.createElement(vr,{name:t}))}function qv(){const[e,t]=(0,r.useState)(null),n=(0,r.useCallback)((()=>{wr(Vv,!0)}),[]);return r.createElement("div",{className:"media-library"},r.createElement("header",{className:"media-library-head"},r.createElement("h1",{className:"media-library-title"},r.createElement("span",{className:"app-name"},r.createElement(vr,{className:"app-icon",name:"ampcast"}),r.createElement("span",{className:"app-text"},"ampcast")),r.createElement("span",{className:"app-version"},"0.7.3")),r.createElement(Hv,{icon:"settings",className:"in-frame",title:"Settings",onClick:n})),r.createElement("div",{className:"media-library-body"},r.createElement(H,{id:"media-library-layout",arrange:"columns",primaryIndex:1},r.createElement(pv,{onSelect:t}),e||r.createElement(Fl,null))))}console.log("component::MediaLibrary"),console.log("module::visualizer");const Wv=new s("visualizer"),Yv={providerId:"none",name:""},Kv=new rn(Yv),Xv=new tn,Gv=[...Array(79).fill("butterchurn"),...Array(6).fill("audiomotion"),...Array(4).fill("ampshader"),...Array(1).fill("waveform")],Jv=[...Array(59).fill("spotifyviz"),...Array(20).fill("ampshader"),...Array(1).fill("waveform")],Qv=Array(10).fill("ambientvideo"),Zv=Qv.concat(Qv);function eg(){return Kv}function tg(){return rg().pipe(rt((e=>tf(e))),At((e=>e?e.observeVisualizers():$t([]))))}function ng(){return lc().pipe(rt((e=>!!e.lockedVisualizer)),on())}function rg(){return lc().pipe(rt((e=>e.provider||"")),on())}function ig(e){Xv.next(e)}function og(){sc.lockedVisualizer=Kv.getValue()}function ag(){sc.lockedVisualizer=null}function sg(){return Vh(eg,null)}function lg({className:e="",children:t}){return r.createElement("div",{className:`icon-buttons ${e}`},t)}function cg(e){const[t,n]=(0,r.useState)(null);return(0,r.useEffect)((()=>{null==t&&null!=e&&n(e)}),[t,e]),t}function ug({visualizer:e}){return r.createElement("article",{className:"visualizer-info"},r.createElement(dg,{visualizer:e}),r.createElement(mg,{visualizer:e}))}function dg({visualizer:e}){return r.createElement("h3",null,"Visualizer: ",function(e){if(e){const t=tf(e.providerId);if(t)return t.name}return"none"}(e))}function mg({visualizer:e}){var t;const n="ambientvideo"===(null==e?void 0:e.providerId)&&e.src.startsWith("youtube:"),i=e?e.externalUrl||(null===(t=tf(e.providerId))||void 0===t?void 0:t.externalUrl):void 0;return n?r.createElement(fg,{visualizer:e}):(null==e?void 0:e.name)?r.createElement(r.Fragment,null,r.createElement("h4",null,"Name: ",e.name),r.createElement(jh,{url:i,src:""})):null}function fg({visualizer:e}){const t=function(e){const[t,,n]=e.split(":"),[i,o]=(0,r.useState)(null);return(0,r.useEffect)((()=>{if(o(null),n&&"youtube"===t){const e=kt(Ki(n)).subscribe(o);return()=>e.unsubscribe()}}),[t,n]),i}(e.src);return t?r.createElement("div",{className:"youtube-video-info"},r.createElement("h4",null,"Title: ",t.title),r.createElement($h,{owner:t.owner,src:t.src}),r.createElement(jh,{url:t.externalUrl,src:t.src})):null}function hg(e){const t=Uh(),n=sg(),i=cg(t),o=cg(n);return r.createElement(yr,Object.assign({},e,{className:"currently-playing-dialog media-info-dialog",title:"Media Info"}),r.createElement("form",{method:"dialog"},i?r.createElement(Th,{item:i}):r.createElement("p",null,"The playlist is empty."),i&&i.mediaType!==Sn.Video?r.createElement(ug,{visualizer:o}):null,r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",null,"Close"))))}function pg(){return r.createElement("div",{className:"static"})}ml().pipe(os(200)).subscribe((()=>ig("item"))),af.observeError().subscribe((()=>ig("error"))),tg().subscribe((()=>ig("provider"))),Xv.pipe(Pa(ml(),lc()),rt((([e,t,n])=>function(e,t,n){if(!e||e.mediaType===Sn.Video)return Yv;const r=e.src.startsWith("spotify:"),i=t.lockedVisualizer;let o=(null==i?void 0:i.providerId)||t.provider;switch(o){case"spotifyviz":if(!r)return Yv;break;case"audiomotion":case"butterchurn":if(r)return Yv;break;case"none":return Yv}if(i)return function(e,t){return nf(e).find((e=>e.name===t))}(i.providerId,i.name)||Yv;const a=Kv.getValue();if(o=t.provider,!o){let e=r?Jv:Gv;t.ambientVideoEnabled&&(e=e.concat(r?Zv:Qv)),o=N(e),"click"===n&&o===a.providerId&&1===nf(o).length&&(o=N(e,o))}return N(nf(o),a)||Yv}(t,n,e))),on()).subscribe(Kv),eg().pipe($n((e=>af.load(e)))).subscribe(Wv),null===(Uv=tf("butterchurn"))||void 0===Uv||Uv.observeVisualizers().pipe(Vo((e=>0===e.length)),Pa(eg()),$n((([,e])=>{e===Yv&&ig("sync")})),Jt(2)).subscribe(Wv);const vg=(0,r.memo)((function(){const e=Vh(tg,[]),t=Vh(ng,!1),n=Vh(rg,void 0),i="none"!==n,o=!t&&(!n||e.length>1),a=function(){const e=Uh(),t=sg(),[n,i]=(0,r.useState)("");return(0,r.useEffect)((()=>{(null==e?void 0:e.src.startsWith("youtube:"))?i("youtube"):(null==e?void 0:e.src.startsWith("apple:"))&&(null==e?void 0:e.mediaType)===Sn.Video?i("apple"):"ambientvideo"===(null==t?void 0:t.providerId)&&(null==t?void 0:t.src.startsWith("youtube:"))?i("youtube"):i("")}),[e,t]),n}(),[s,l]=(0,r.useState)(0),c=(0,r.useCallback)((()=>{wr(hg)}),[]),u=(0,r.useCallback)((()=>{wr(_v,!0)}),[]),d=(0,r.useCallback)((()=>{0===s&&ig("click"),l(s+1)}),[s]);return(0,r.useEffect)((()=>{if(s){const e=Fe(500).subscribe((()=>l(0)));return()=>e.unsubscribe()}}),[s]),r.createElement("div",{className:"visualizer-controls"},i&&s?r.createElement(pg,null):null,r.createElement(lg,{className:"visualizer-controls-settings"},r.createElement(Hv,{className:"with-overlay",icon:"info",title:"Info",tabIndex:-1,onClick:c}),r.createElement(Hv,{className:"with-overlay",icon:"settings",title:"Settings",tabIndex:-1,onClick:u})),i?r.createElement(lg,{className:"visualizer-controls-selector"},r.createElement(Hv,{className:"with-overlay",icon:t?"locked":"unlocked",title:t?"Unlock":"Lock the current visualizer",tabIndex:-1,onClick:t?ag:og}),o?r.createElement(Hv,{className:"with-overlay",icon:"right",title:"Next visualizer",tabIndex:-1,onClick:d}):null):null,a?r.createElement(vr,{className:"source-icon",name:a}):null)}));function gg(){return Vh(eh,!0)}const bg=(0,r.memo)((function(){const e=Uh(),t=function(){const[e,t]=(0,r.useState)("searching"),n=Uh(),i=null==n?void 0:n.id;return(0,r.useEffect)((()=>t("searching")),[i]),(0,r.useEffect)((()=>{switch(null==n?void 0:n.lookupStatus){case as.Looking:t("searching");break;case as.NotFound:t("ready");break;default:if(n){if(Wa(n)){t("loading");const e=rh().pipe(Jt(1)).subscribe((()=>t("ready")));return()=>e.unsubscribe()}t("searching")}else t("ready")}}),[n]),e}(),[n,i]=(0,r.useState)(!1),o=null==e?void 0:e.id;return(0,r.useEffect)((()=>{i(!0);const e=setTimeout((()=>i(!1)),5e3);return()=>clearTimeout(e)}),[o]),r.createElement("div",{className:`interstitial ${t} ${n?"is-recent":""}`},e?r.createElement(yg,{item:e,state:t}):r.createElement(wg,null))}));function yg({item:e,state:t}){const n=gg();return r.createElement(r.Fragment,null,r.createElement("h3",null,e.title),e.artists?r.createElement(r.Fragment,null,r.createElement("span",{className:"by"},"by"),r.createElement("h4",null,e.artists.join(", "))):null,r.createElement("span",{className:"interstitial-state"},n?"":`${"ready"===t?"playing":t}...`))}function wg(){return r.createElement("p",null,"The playlist is empty.")}n(6234),console.log("component::Media");const xg=(0,r.memo)((function(){const e=(0,r.useRef)(null),[t,n]=(0,r.useState)(!1),i=Uh(),o=(null==i?void 0:i.mediaType)===Sn.Video,a=function(e,t=200){const[n,i]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{if(e){const n=dt(e,"mousemove").pipe($n((()=>i(!0))),os(t),$n((()=>i(!1)))).subscribe();return()=>n.unsubscribe()}i(!1)}),[e,t]),n}(e.current,4e3),s=sg(),l=!s||"none"===s.providerId;(0,r.useLayoutEffect)((()=>{bh.appendTo(e.current)}),[]),(0,r.useEffect)((()=>{const t=dt(document,"fullscreenchange").pipe(rt((()=>document.fullscreenElement===e.current))).subscribe(n);return()=>t.unsubscribe()}),[]),L(e,(0,r.useCallback)((()=>{const t=e.current;bh.resize(t.clientWidth,t.clientHeight)}),[]));const c=(0,r.useCallback)((()=>{t?document.exitFullscreen():e.current.requestFullscreen()}),[t]);return r.createElement("div",{className:`panel media ${o?"is-playing-video":""} ${l?"no-visualizer":""}  ${a?"":"idle"}`,onDoubleClick:c,ref:e},r.createElement("div",{id:"playback"}),r.createElement(bg,null),r.createElement(vg,null))}));function kg(e){var{icon:t,onClick:n}=e,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["icon","onClick"]);return r.createElement("button",Object.assign({},i,{className:`media-button media-button-${t}`,onClick:n}),r.createElement(vr,{name:t}))}const Eg=(0,r.memo)((function(){const[e,t]=(0,r.useState)((()=>bh.muted)),[n,i]=(0,r.useState)((()=>bh.volume)),o=n<=.33?"low":n<=.67?"medium":"high";(0,r.useEffect)((()=>{bh.muted=e}),[e]),(0,r.useEffect)((()=>{bh.volume=n}),[n]);const a=(0,r.useCallback)((e=>{const n=e.target.valueAsNumber;i(n),t(0===n)}),[]),s=(0,r.useCallback)((()=>{i((t=>e?t||.1:t)),t(!e)}),[e]);return r.createElement("div",{className:`volume-control volume-${o}`},r.createElement(Hv,{icon:e?"muted":"volume",className:"in-frame","aria-label":e?"Unmute":"Mute",title:e?"unmute":"mute",onClick:s}),r.createElement("input",{type:"range","aria-label":"Volume",min:0,max:1,step:.01,value:e?0:n,onChange:a}))}));function Sg(){const e=Vh(Jf,0),t=Vh(Qf,0),n=Vh(eh,!0),i=(0,r.useCallback)((e=>{sh(e.target.valueAsNumber)}),[]);return r.createElement("div",{className:"media-controls"},r.createElement("div",{className:"current-time-control"},r.createElement(mp,{time:e}),r.createElement("input",{id:"playhead",type:"range","aria-label":"Seek",min:0,max:t,step:1,value:e,disabled:n,onChange:i})),r.createElement("div",{className:"playback-control"},r.createElement(Eg,null),r.createElement("div",{className:"media-buttons"},r.createElement(kg,{"aria-label":"Previous track",icon:"prev",onClick:ch}),r.createElement(kg,{"aria-label":n?"Play":"Pause",icon:n?"play":"pause",onClick:n?oh:ah}),r.createElement(kg,{"aria-label":"Stop",icon:"stop",onClick:lh}),r.createElement(kg,{"aria-label":"Next track",icon:"next",onClick:uh})),r.createElement("div",{className:"media-buttons-more"},r.createElement("button",{className:"media-button media-button-shuffle","aria-label":"Shuffle",onClick:mh},"Shuffle"))))}function Cg(e){var{items:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["items"]);const i=1===t.length;return r.createElement(bp,Object.assign({},n,{className:"actions"}),r.createElement("ul",{className:"actions-menu-items"},r.createElement(yp,{label:"Select all",action:"select-all",acceleratorKey:"Ctrl+A",key:"select-all"}),i?r.createElement(yp,{label:"Play",action:"play",acceleratorKey:"Enter",key:"play"}):null,r.createElement(yp,{label:"Remove",action:"remove",acceleratorKey:"Del",key:"remove"}),i?r.createElement(yp,{label:"Info...",action:"info",acceleratorKey:"Ctrl+I",key:"info"}):null))}const Tg={view:"details",showTitles:!1,cols:[{title:"#",render:()=>null,align:"right",className:"track"},{title:"Source",render:function({src:e,lookupStatus:t}){const[n]=e.split(":");let i;switch(t){case as.Looking:i="lookup-looking";break;case as.NotFound:i="lookup-not-found";break;default:i=qa(e)?n:"lookup-pending"}return r.createElement(vr,{name:i,className:"youtube"===n?"":"show-connectivity"})},align:"center",className:"source"},{title:"Title",render:function({title:e,artists:t}){return t?r.createElement(r.Fragment,null,r.createElement("span",{className:"artist-text"},t.join("/")),r.createElement("span",{role:"separator"},"-"),r.createElement("span",{className:"title-text"},e)):r.createElement("span",{className:"title-text"},e)},className:"title"},{title:"Time",render:hp,align:"right",className:"duration"}]};const Ag=["audio/*","video/*"];function Pg(e){var{onSelect:t,onPlay:n,onEject:i}=e,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["onSelect","onPlay","onEject"]);const a=(0,r.useRef)(null),s=Vh(xl.observe,[]),l=function(e){const t=String(e).length,{zeroPadLineNumbers:n,showLineNumbers:i,showSourceIcons:o}=Vh(Js,Qs());return(0,r.useMemo)((()=>Object.assign(Object.assign({},Tg),{cols:Tg.cols.filter((e=>{switch(e.className){case"track":return i;case"source":return o;default:return!0}})).map((e=>"track"===e.className?Object.assign(Object.assign({},e),{render:(e,r)=>function(e,t=0){return String(e+1).padStart(t,"0")}(r,n?t:0)}):e))})),[n,i,o,t])}(s.length),c=Uh(),[u,d]=(0,r.useState)(0),m=(0,r.useCallback)((e=>{const[t]=e.src.split(":");return`source-${t} ${e.id===(null==c?void 0:c.id)?"playing":""} ${e.unplayable||e.lookupStatus===as.NotFound?"unplayable":""}`}),[c]),f=(0,r.useCallback)((e=>{d(e.length),null==t||t(e)}),[t]),h=(0,r.useCallback)((e=>{null==n||n(e)}),[n]),p=(0,r.useCallback)((e=>{1===e.length&&(null==n||n(e[0]))}),[n]),v=(0,r.useCallback)((e=>{1===e.length&&e[0]===c?null==i||i():xl.remove(e)}),[i,c]),g=(0,r.useCallback)((([e])=>{e&&Fh(e)}),[]),b=(0,r.useCallback)(((e,t,i)=>{return o=this,s=void 0,c=function*(){const o=yield function(e,t,n){return i=this,o=void 0,s=function*(){return wp((t=>r.createElement(Cg,Object.assign({},t,{items:e}))),t,n)},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function r(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,r)}l((s=s.apply(i,o||[])).next())}));var i,o,a,s}(e,t,i);switch(o){case"play":null==n||n(e[0]);break;case"remove":xl.remove(e);break;case"info":Fh(e[0]);break;case"select-all":a.current.selectAll()}},new((l=void 0)||(l=Promise))((function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(n,r)}i((c=c.apply(o,s||[])).next())}));var o,s,l,c}),[n]);return r.createElement("div",{className:"playlist"},r.createElement(ip,Object.assign({},o,{className:"media-list playable",layout:l,items:s,itemKey:"id",itemClassName:m,droppable:!0,droppableTypes:Ag,multiSelect:!0,reorderable:!0,onContextMenu:b,onDelete:v,onDoubleClick:h,onDrop:xl.insertAt,onEnter:p,onInfo:g,onMove:xl.moveSelection,onSelect:f,listViewRef:a})),r.createElement(cp,{items:s,size:s.length,selectedCount:u}))}function Ig(){const e=Uh(),t=gg(),n=(0,r.useCallback)((t=>{t===e?bh.play():(bh.load(null),bh.autoplay=!0,xl.setCurrentItem(t))}),[e]);return r.createElement("div",{className:"media-playback "+(t?"paused":"")},r.createElement(H,{id:"media-playback-layout",arrange:"rows"},r.createElement("div",{className:"panel playback"},r.createElement(Sg,null),r.createElement(Pg,{onPlay:n,onEject:dh})),r.createElement(xg,null)))}console.log("component::MediaPlayback");const zg=document.getElementById("app"),Mg=document.getElementById("system");function Ng(e){const t=e.dataTransfer;t&&(e.preventDefault(),t.effectAllowed="none",t.dropEffect="none")}function Og(e=null){var t,n;const r=navigator.mediaSession;e&&(r.metadata=new MediaMetadata({title:e.title,artist:null===(t=e.artists)||void 0===t?void 0:t.join(", "),album:e.artists?"":e.album,artwork:null===(n=e.thumbnails)||void 0===n?void 0:n.map((e=>({src:Ch(e),sizes:`${e.width}x${e.height}`})))})),r.setActionHandler("play",oh),r.setActionHandler("pause",ah),r.setActionHandler("stop",lh),r.setActionHandler("previoustrack",ch),r.setActionHandler("nexttrack",uh),r.setActionHandler("seekto",(e=>{null!=e.seekTime&&sh(e.seekTime)}))}function $g(e){switch(e.key){case" ":e.target&&!("form"in e.target)&&(e.preventDefault(),jg());break;case"MediaPlayPause":e.preventDefault(),jg();break;case"MediaStop":e.preventDefault(),bh.stop();break;case"MediaTrackPrevious":e.preventDefault(),bh.prev();break;case"MediaTrackNext":e.preventDefault(),bh.next()}}function jg(){bh.paused?bh.play():bh.pause()}const _g=new m("desktopWarning");function Rg(){const[e,t]=(0,r.useState)((()=>w.desktop||_g.getBoolean("dismissed"))),n=(0,r.useCallback)((()=>{_g.setBoolean("dismissed",!0),t(!0)}),[]);return e?null:r.createElement("div",{className:"desktop-warning"},r.createElement("h1",null,"ampcast"," ","0.7.3"),r.createElement("p",null,"This application is intended for a desktop browser."),r.createElement("p",null,r.createElement("button",{onClick:n},"Proceed")))}console.log("module::App"),(0,i.s)(document.getElementById("app")).render(r.createElement((function(){return(0,r.useEffect)((()=>{document.body.classList.add(`browser-${w.name.replace(/\s+/g,"-")}`)}),[]),(0,r.useEffect)((()=>{const e=new re;return Va().forEach((t=>{const n=t.observeIsLoggedIn().subscribe((e=>{document.body.classList.toggle(`${t.id}-connected`,e),document.body.classList.toggle(`${t.id}-not-connected`,!e)}));e.add(n)})),()=>e.unsubscribe()}),[]),(0,r.useEffect)((()=>{const e=new re,t=e=>dt(e,"focusin").subscribe((()=>{const t=e.querySelector(".focus");t!==document.activeElement&&(null==t||t.classList.toggle("focus",!1),document.activeElement.classList.toggle("focus",!0))}));return e.add(t(zg)),e.add(t(Mg)),()=>e.unsubscribe()}),[]),(0,r.useEffect)((()=>{const e=dt(document,"dragenter"),t=dt(document,"dragover"),n=dt(document,"drop"),r=Et(e,t).pipe($n(Ng)),i=Et(r,n.pipe($n(z))).subscribe();return()=>i.unsubscribe()}),[]),function(){const e=Uh(),t=Vh(th,null),n=Vh(Jf,0),i=Vh(Qf,0);(0,r.useEffect)((()=>{navigator.mediaSession.setPositionState({duration:i,position:n,playbackRate:1})}),[i,n]),(0,r.useEffect)((()=>Og(null==t?void 0:t.currentItem)),[t]),(0,r.useEffect)((()=>Og(e)),[e])}(),(0,r.useEffect)((()=>{document.getElementById("system").addEventListener("keydown",M),document.getElementById("popup").addEventListener("keydown",M),document.body.addEventListener("keydown",$g)}),[]),function(){(0,r.useEffect)((()=>{(()=>{var e,t,n,r;e=this,t=void 0,r=function*(){var e,t,n,r;const{state:i="granted"}=(yield null===(e=navigator.permissions)||void 0===e?void 0:e.query({name:"persistent-storage"}))||{};let o=yield null===(n=null===(t=navigator.storage)||void 0===t?void 0:t.persisted)||void 0===n?void 0:n.call(t);"granted"!==i||o||(o=yield null===(r=navigator.storage)||void 0===r?void 0:r.persist()),console.log("Persisted storage:",{state:i,persisted:o})},new((n=void 0)||(n=Promise))((function(i,o){function a(e){try{l(r.next(e))}catch(e){o(e)}}function s(e){try{l(r.throw(e))}catch(e){o(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(a,s)}l((r=r.apply(e,t||[])).next())}))})()}),[])}(),r.createElement("main",null,r.createElement(H,{id:"main-layout",arrange:"columns"},r.createElement(qv,null),r.createElement(Ig,null)),r.createElement(Rg,null))}),null))}},e=>{e.O(0,[136,529,503],(()=>(6200,e(e.s=6200)))),e.O()}]);