(self.webpackChunkampcast=self.webpackChunkampcast||[]).push([[296],{6998:function(e){e.exports=function(e,t){if(null==t&&(t={fuzzy:!0}),/youtu\.?be/.test(e)){var n,r=[/youtu\.be\/([^#\&\?]{11})/,/\?v=([^#\&\?]{11})/,/\&v=([^#\&\?]{11})/,/embed\/([^#\&\?]{11})/,/\/v\/([^#\&\?]{11})/];for(n=0;n<r.length;++n)if(r[n].test(e))return r[n].exec(e)[1];if(t.fuzzy){var i=e.split(/[\/\&\?=#\.\s]/g);for(n=0;n<i.length;++n)if(/^[^#\&\?]{11}$/.test(i[n]))return i[n]}}return null}},2763:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),r=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Float32Array;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t instanceof e?(this.ArrayType=t.ArrayType,this.real=new this.ArrayType(t.real),this.imag=new this.ArrayType(t.imag)):(this.ArrayType=n,this.real=new this.ArrayType(t),this.imag=new this.ArrayType(this.real.length)),this.length=this.real.length}return n(e,[{key:"toString",value:function(){var e=[];return this.forEach((function(t,n){e.push("("+t.real.toFixed(2)+", "+t.imag.toFixed(2)+")")})),"["+e.join(", ")+"]"}},{key:"forEach",value:function(e){for(var t=this.length,n=Object.seal(Object.defineProperties({},{real:{writable:!0},imag:{writable:!0}})),r=0;r<t;r++)n.real=this.real[r],n.imag=this.imag[r],e(n,r,t)}},{key:"map",value:function(e){var t=this;return this.forEach((function(n,r,i){e(n,r,i),t.real[r]=n.real,t.imag[r]=n.imag})),this}},{key:"conjugate",value:function(){return new e(this).map((function(e){e.imag*=-1}))}},{key:"magnitude",value:function(){var e=new this.ArrayType(this.length);return this.forEach((function(t,n){e[n]=Math.sqrt(t.real*t.real+t.imag*t.imag)})),e}}]),e}();t.default=r},4843:(e,t,n)=>{"use strict";var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.rS=function(e){return function(e){return e instanceof l&&e||new l(e)}(e).InvFFT()};var i,a=(i=n(2763))&&i.__esModule?i:{default:i},s=Math.PI,o=Math.SQRT1_2,l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"FFT",value:function(){return c(this,!1)}},{key:"InvFFT",value:function(){return c(this,!0)}},{key:"frequencyMap",value:function(e){return this.FFT().map(e).InvFFT()}}]),t}(a.default);function c(e,t){var n=e.length;return n&n-1?function(e,t){var n=e.length;if(1===n)return e;for(var r=new l(n,e.ArrayType),i=function(e){for(var t=Math.sqrt(e),n=3;n<=t;){if(e%n==0)return n;n+=2}return e}(n),a=n/i,o=1/Math.sqrt(i),u=new l(a,e.ArrayType),d=0;d<i;d++){for(var m=0;m<a;m++)u.real[m]=e.real[m*i+d],u.imag[m]=e.imag[m*i+d];a>1&&(u=c(u,t));for(var h=Math.cos(2*s*d/n),f=(t?-1:1)*Math.sin(2*s*d/n),p=1,v=0,b=0;b<n;b++){var y=u.real[b%a],g=u.imag[b%a];r.real[b]+=p*y-v*g,r.imag[b]+=p*g+v*y;var w=[p*h-v*f,v=p*f+v*h];p=w[0],v=w[1]}}for(var E=0;E<n;E++)e.real[E]=o*r.real[E],e.imag[E]=o*r.imag[E];return e}(e,t):function(e,t){for(var n=e.length,r=function(e){for(var t=e.length,n=new Set,r=0;r<t;r++){var i=u(r,t);if(!n.has(r)){var a=[e.real[i],e.real[r]];e.real[r]=a[0],e.real[i]=a[1];var s=[e.imag[i],e.imag[r]];e.imag[r]=s[0],e.imag[i]=s[1],n.add(i)}}return e}(e),i=r.real,a=r.imag,l=1;l<n;){for(var c=Math.cos(s/l),d=(t?-1:1)*Math.sin(s/l),m=0;m<n/(2*l);m++)for(var h=1,f=0,p=0;p<l;p++){var v=2*m*l+p,b=v+l,y=i[v],g=a[v],w=h*i[b]-f*a[b],E=f*i[b]+h*a[b];i[v]=o*(y+w),a[v]=o*(g+E),i[b]=o*(y-w),a[b]=o*(g-E);var k=[h*c-f*d,h*d+f*c];h=k[0],f=k[1]}l<<=1}return r}(e,t)}function u(e,t){for(var n=0;t>1;)n<<=1,n+=1&e,e>>=1,t>>=1;return n}},745:(e,t,n)=>{"use strict";var r=n(3935);t.s=r.createRoot,r.hydrateRoot},6657:e=>{e.exports=function(e,t,n){"use strict";if(e===t)return 1;if(""===t)return 0;var r=0,i=e.toLowerCase(),a=e.length,s=t.toLowerCase(),o=t.length,l=0,c=1;n=n?1-n:0;for(var u=0;u<o;u+=1){var d=i.indexOf(s[u],l);if(-1===d){if(!n)return 0;c+=n}else{var m=0;l===d?m=.7:(m=.1," "===e[d-1]&&(m+=.8)),e[d]===t[u]&&(m+=.1),r+=m,l=d+1}}var h=.5*(r/a+r/o)/c;return s[0]===i[0]&&h<.85&&(h+=.15),h}},8399:(e,t,n)=>{"use strict";var r=n(7294),i=n(745),a=n(6657),s=n.n(a),o=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function l(e){return null!=e}function c(e){return o(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{const r="ampcast-loaded";let i=document.querySelector(`script[src="${e}"]`);(null==i?void 0:i.hasAttribute(r))?t():(i||(i=document.createElement("script"),i.async=!0,i.src=e),i.addEventListener("load",(function(){this.setAttribute(r,""),t()})),i.addEventListener("error",(()=>n(`Failed to load script: '${e}'`))),i.parentElement||document.head.appendChild(i))}))}))}function u(e,t=1){if(t<=0)return[];const n=[],r=[...e];for(;r.length;)n.push(r.splice(0,t));return n}function d(e,t){const n=[],r=[];for(const i of e)t(i)?n.push(i):r.push(i);return[n,r]}function m(e){return[...new Set(e)]}function h(e,t){return e.filter(((e,n,r)=>n===r.findIndex((n=>e[t]===n[t]))))}function f(e){let t=e.length;for(;t>0;){const n=Math.floor(Math.random()*t);t--;const r=e[t];e[t]=e[n],e[n]=r}return e}function p(e=Date.now()){return`${(e=new Date(e)).getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function v(e){return p(e).slice(0,7)}function b(e){return new Date(Math.floor(1e3*(e||0))).toISOString().slice(11,19).replace(/^[0:]+(.{4,})$/,"$1")}function y(e){e.preventDefault()}function g(e){e.stopPropagation()}function w(e){e.preventDefault(),e.stopPropagation()}function E(e,t){return 1===e.length?e[0]:(void 0!==t&&(e=e.filter((e=>e!==t))),e[Math.floor(Math.random()*e.length)])}function k(e,t={}){return m(Object.keys(e).concat(Object.keys(t))).reduce(((n,r)=>(void 0!==e[r]?n[r]=e[r]:void 0!==t[r]&&(n[r]=t[r]),n)),{})}function x(e,t,n){const r=e.filter(t,n);return 0===r.length?e:r}function S(e,t,n=.9){return Math.max(s()(e,t,.99),s()(t,e,.99))>=n}const T=document.createElement("p");function A(e=""){const t=String(null!=e?e:"").trim().split(/[\n\r]+/);return null==t?void 0:t.map((e=>(T.innerHTML=e,T.textContent))).join("\n")}function P(e){return new Promise((t=>setTimeout(t,e)))}const I=["rating","globalRating","playCount","globalPlayCount","inLibrary","lookupStatus"];function C(e){return Object.keys(e).reduce(((t,n)=>(void 0===e[n]||I.includes(n)||(t[n]=e[n]),t)),{})}function M(e){return/m[uú][sz](i|ie)[ckq]/i.test(e)}class O{constructor(e="",t=!1,n=window.console){const r=e?` ${e}:`:"",i=(e,t)=>e&&t?`${e}/${t}`:t||e,a=(...t)=>{e.startsWith(O.only)&&n.log(...t)};this.log=(...e)=>a(`##${r}`,...e),this.warn=(...e)=>a(`###${r}`,...e),this.error=t=>{e.startsWith(O.only)&&(a(`####${r} ERROR`),n.error(t))},t&&(this.next=this.log,this.complete=()=>this.log("***complete***")),this.id=r=>new O(i(e,r),t,n),this.rx=t=>new O(i(e,t),!0,n),this.only=()=>this}}O.only="";const N=O,$=new Map,z={get length(){return $.size},clear(){$.clear()},key(e){var t;return null!==(t=[...$.keys()][e])&&void 0!==t?t:null},getItem(e){var t;return null!==(t=$.get(String(e)))&&void 0!==t?t:null},setItem(e,t){$.set(String(e),String(t))},removeItem(e){$.delete(String(e))}},j=z,L=new N("LiteStorage");class R{constructor(e,t="local"){const n=`${t}-${e}`;if(R.ids.includes(n))throw Error(`Duplicate storageId: ${n}`);switch(R.ids.push(n),this.id=`ampcast/${e}`,t){case"local":this.storage=localStorage;break;case"session":this.storage=sessionStorage;break;case"memory":this.storage=j}}getBoolean(e){const t=this.getItem(e);return!!t&&"false"!==t}setBoolean(e,t){this.setItem(e,String(!!t))}getJson(e,t=null){const n=this.getItem(e);try{return n?JSON.parse(n):t}catch(e){L.error(e)}return t}setJson(e,t){try{null==t?this.removeItem(e):this.setItem(e,JSON.stringify(t))}catch(e){L.error(e)}}getNumber(e,t=0){var n;const r=Number(null!==(n=this.getItem(e))&&void 0!==n?n:t);return isNaN(r)?t:r}setNumber(e,t){this.setItem(e,String(Number(t)||0))}getString(e,t=""){var n;return String(null!==(n=this.getItem(e))&&void 0!==n?n:t)}setString(e,t){this.setItem(e,t)}getItem(e){return this.storage.getItem(`${this.id}/${e}`)}setItem(e,t){e=`${this.id}/${e}`,null==t?this.storage.removeItem(e):this.storage.setItem(e,t)}removeItem(e){this.storage.removeItem(`${this.id}/${e}`)}clear(){const e=`${this.id}/`,t=[];for(let n=0;n<this.storage.length;n++){const r=this.storage.key(n);r.startsWith(e)&&t.push(r)}t.forEach((e=>this.storage.removeItem(e)))}}R.ids=[];const D=R,F=(0,n(3631).qY)(),_=(null==F?void 0:F.name)||"unknown",U=/^edge/.test(_)?"Microsoft Edge":_.replace(/^\w/,(e=>e.toUpperCase())),V=(null==F?void 0:F.version)||"0",B=(null==F?void 0:F.os)||"unknown",H="Mac OS"===B?"metaKey":"ctrlKey",Y="Mac OS"===B?"⌘":"Ctrl",K={name:_,displayName:U,version:V,os:B,desktop:!/^(iOS|Android OS|BlackBerry OS|Windows Mobile|Amazon OS)$/.test(B),ctrlKey:H,ctrlKeyStr:Y},W=new D("layout"),q={get:(e,t=0)=>W.getNumber(e,t),set(e,t){W.setNumber(e,t)}};var G=function(e,t){return G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},G(e,t)};function J(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}G(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function Q(e,t){var n,r,i,a,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,o[0]&&(s=0)),s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}}function X(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function Z(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return s}function ee(e,t,n){if(n||2===arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function te(e){return this instanceof te?(this.v=e,this):new te(e)}function ne(e){return"function"==typeof e}function re(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create,"function"==typeof SuppressedError&&SuppressedError;var ie=re((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function ae(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var se=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var s=X(a),o=s.next();!o.done;o=s.next())o.value.remove(this)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}else a.remove(this);var l=this.initialTeardown;if(ne(l))try{l()}catch(e){i=e instanceof ie?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=X(c),d=u.next();!d.done;d=u.next()){var m=d.value;try{ce(m)}catch(e){i=null!=i?i:[],e instanceof ie?i=ee(ee([],Z(i)),Z(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(i)throw new ie(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)ce(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&ae(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&ae(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),oe=se.EMPTY;function le(e){return e instanceof se||e&&"closed"in e&&ne(e.remove)&&ne(e.add)&&ne(e.unsubscribe)}function ce(e){ne(e)?e():e.unsubscribe()}var ue={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},de={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=de.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,ee([e,t],Z(n))):setTimeout.apply(void 0,ee([e,t],Z(n)))},clearTimeout:function(e){var t=de.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function me(e){de.setTimeout((function(){var t=ue.onUnhandledError;if(!t)throw e;t(e)}))}function he(){}var fe=pe("C",void 0,void 0);function pe(e,t,n){return{kind:e,value:t,error:n}}var ve=null;function be(e){if(ue.useDeprecatedSynchronousErrorHandling){var t=!ve;if(t&&(ve={errorThrown:!1,error:null}),e(),t){var n=ve,r=n.errorThrown,i=n.error;if(ve=null,r)throw i}}else e()}var ye=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,le(t)&&t.add(n)):n.destination=Te,n}return J(t,e),t.create=function(e,t,n){return new ke(e,t,n)},t.prototype.next=function(e){this.isStopped?Se(function(e){return pe("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?Se(pe("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?Se(fe,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(se),ge=Function.prototype.bind;function we(e,t){return ge.call(e,t)}var Ee=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){xe(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){xe(e)}else xe(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){xe(e)}},e}(),ke=function(e){function t(t,n,r){var i,a,s=e.call(this)||this;return ne(t)||!t?i={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:s&&ue.useDeprecatedNextContext?((a=Object.create(t)).unsubscribe=function(){return s.unsubscribe()},i={next:t.next&&we(t.next,a),error:t.error&&we(t.error,a),complete:t.complete&&we(t.complete,a)}):i=t,s.destination=new Ee(i),s}return J(t,e),t}(ye);function xe(e){var t;ue.useDeprecatedSynchronousErrorHandling?(t=e,ue.useDeprecatedSynchronousErrorHandling&&ve&&(ve.errorThrown=!0,ve.error=t)):me(e)}function Se(e,t){var n=ue.onStoppedNotification;n&&de.setTimeout((function(){return n(e,t)}))}var Te={closed:!0,next:he,error:function(e){throw e},complete:he},Ae="function"==typeof Symbol&&Symbol.observable||"@@observable";function Pe(e){return e}var Ie=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,i=function(e){return e&&e instanceof ye||function(e){return e&&ne(e.next)&&ne(e.error)&&ne(e.complete)}(e)&&le(e)}(e)?e:new ke(e,t,n);return be((function(){var e=r,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?r._subscribe(i):r._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Ce(t))((function(t,r){var i=new ke({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[Ae]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(n=e).length?Pe:1===n.length?n[0]:function(e){return n.reduce((function(e,t){return t(e)}),e)})(this);var n},e.prototype.toPromise=function(e){var t=this;return new(e=Ce(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function Ce(e){var t;return null!==(t=null!=e?e:ue.Promise)&&void 0!==t?t:Promise}var Me=re((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Oe=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return J(t,e),t.prototype.lift=function(e){var t=new Ne(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Me},t.prototype.next=function(e){var t=this;be((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=X(t.currentObservers),a=i.next();!a.done;a=i.next())a.value.next(e)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;be((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;be((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,a=n.observers;return r||i?oe:(this.currentObservers=null,a.push(e),new se((function(){t.currentObservers=null,ae(a,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new Ie;return e.source=this,e},t.create=function(e,t){return new Ne(e,t)},t}(Ie),Ne=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return J(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:oe},t}(Oe),$e=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return J(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Oe);function ze(e){return function(t){if(function(e){return ne(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function je(e,t,n,r,i){return new Le(e,t,n,r,i)}var Le=function(e){function t(t,n,r,i,a,s){var o=e.call(this,t)||this;return o.onFinalize=a,o.shouldUnsubscribe=s,o._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,o._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,o}return J(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(ye);function Re(e,t,n){var r=ne(e)||t||n?{next:e,error:t,complete:n}:e;return r?ze((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var i=!0;e.subscribe(je(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;i=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;i=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;i&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):Pe}function De(e,t){return ze((function(n,r){var i=0;n.subscribe(je(r,(function(n){return e.call(t,n,i++)&&r.next(n)})))}))}function Fe(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function _e(e){return Math.min(1,Math.max(0,e))}function Ue(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function Ve(e){return e<=1?"".concat(100*Number(e),"%"):e}function Be(e){return 1===e.length?"0"+e:String(e)}function He(e,t,n){e=Fe(e,255),t=Fe(t,255),n=Fe(n,255);var r=Math.max(e,t,n),i=Math.min(e,t,n),a=0,s=0,o=(r+i)/2;if(r===i)s=0,a=0;else{var l=r-i;switch(s=o>.5?l/(2-r-i):l/(r+i),r){case e:a=(t-n)/l+(t<n?6:0);break;case t:a=(n-e)/l+2;break;case n:a=(e-t)/l+4}a/=6}return{h:a,s,l:o}}function Ye(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*n*(t-e):n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Ke(e,t,n){e=Fe(e,255),t=Fe(t,255),n=Fe(n,255);var r=Math.max(e,t,n),i=Math.min(e,t,n),a=0,s=r,o=r-i,l=0===r?0:o/r;if(r===i)a=0;else{switch(r){case e:a=(t-n)/o+(t<n?6:0);break;case t:a=(n-e)/o+2;break;case n:a=(e-t)/o+4}a/=6}return{h:a,s:l,v:s}}function We(e,t,n,r){var i=[Be(Math.round(e).toString(16)),Be(Math.round(t).toString(16)),Be(Math.round(n).toString(16))];return r&&i[0].startsWith(i[0].charAt(1))&&i[1].startsWith(i[1].charAt(1))&&i[2].startsWith(i[2].charAt(1))?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function qe(e){return Ge(e)/255}function Ge(e){return parseInt(e,16)}var Je={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};var Qe="(?:".concat("[-\\+]?\\d*\\.\\d+%?",")|(?:").concat("[-\\+]?\\d+%?",")"),Xe="[\\s|\\(]+(".concat(Qe,")[,|\\s]+(").concat(Qe,")[,|\\s]+(").concat(Qe,")\\s*\\)?"),Ze="[\\s|\\(]+(".concat(Qe,")[,|\\s]+(").concat(Qe,")[,|\\s]+(").concat(Qe,")[,|\\s]+(").concat(Qe,")\\s*\\)?"),et={CSS_UNIT:new RegExp(Qe),rgb:new RegExp("rgb"+Xe),rgba:new RegExp("rgba"+Ze),hsl:new RegExp("hsl"+Xe),hsla:new RegExp("hsla"+Ze),hsv:new RegExp("hsv"+Xe),hsva:new RegExp("hsva"+Ze),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function tt(e){return Boolean(et.CSS_UNIT.exec(String(e)))}var nt=function(){function e(t,n){var r;if(void 0===t&&(t=""),void 0===n&&(n={}),t instanceof e)return t;"number"==typeof t&&(t=function(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}(t)),this.originalInput=t;var i=function(e){var t,n,r,i={r:0,g:0,b:0},a=1,s=null,o=null,l=null,c=!1,u=!1;return"string"==typeof e&&(e=function(e){if(0===(e=e.trim().toLowerCase()).length)return!1;var t=!1;if(Je[e])e=Je[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var n=et.rgb.exec(e);return n?{r:n[1],g:n[2],b:n[3]}:(n=et.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=et.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=et.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=et.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=et.hsva.exec(e))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=et.hex8.exec(e))?{r:Ge(n[1]),g:Ge(n[2]),b:Ge(n[3]),a:qe(n[4]),format:t?"name":"hex8"}:(n=et.hex6.exec(e))?{r:Ge(n[1]),g:Ge(n[2]),b:Ge(n[3]),format:t?"name":"hex"}:(n=et.hex4.exec(e))?{r:Ge(n[1]+n[1]),g:Ge(n[2]+n[2]),b:Ge(n[3]+n[3]),a:qe(n[4]+n[4]),format:t?"name":"hex8"}:!!(n=et.hex3.exec(e))&&{r:Ge(n[1]+n[1]),g:Ge(n[2]+n[2]),b:Ge(n[3]+n[3]),format:t?"name":"hex"}}(e)),"object"==typeof e&&(tt(e.r)&&tt(e.g)&&tt(e.b)?(t=e.r,n=e.g,r=e.b,i={r:255*Fe(t,255),g:255*Fe(n,255),b:255*Fe(r,255)},c=!0,u="%"===String(e.r).substr(-1)?"prgb":"rgb"):tt(e.h)&&tt(e.s)&&tt(e.v)?(s=Ve(e.s),o=Ve(e.v),i=function(e,t,n){e=6*Fe(e,360),t=Fe(t,100),n=Fe(n,100);var r=Math.floor(e),i=e-r,a=n*(1-t),s=n*(1-i*t),o=n*(1-(1-i)*t),l=r%6;return{r:255*[n,s,a,a,o,n][l],g:255*[o,n,n,s,a,a][l],b:255*[a,a,o,n,n,s][l]}}(e.h,s,o),c=!0,u="hsv"):tt(e.h)&&tt(e.s)&&tt(e.l)&&(s=Ve(e.s),l=Ve(e.l),i=function(e,t,n){var r,i,a;if(e=Fe(e,360),t=Fe(t,100),n=Fe(n,100),0===t)i=n,a=n,r=n;else{var s=n<.5?n*(1+t):n+t-n*t,o=2*n-s;r=Ye(o,s,e+1/3),i=Ye(o,s,e),a=Ye(o,s,e-1/3)}return{r:255*r,g:255*i,b:255*a}}(e.h,s,l),c=!0,u="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(a=e.a)),a=Ue(a),{ok:c,format:e.format||u,r:Math.min(255,Math.max(i.r,0)),g:Math.min(255,Math.max(i.g,0)),b:Math.min(255,Math.max(i.b,0)),a}}(t);this.originalInput=t,this.r=i.r,this.g=i.g,this.b=i.b,this.a=i.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(r=n.format)&&void 0!==r?r:i.format,this.gradientType=n.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=i.ok}return e.prototype.isDark=function(){return this.getBrightness()<128},e.prototype.isLight=function(){return!this.isDark()},e.prototype.getBrightness=function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},e.prototype.getLuminance=function(){var e=this.toRgb(),t=e.r/255,n=e.g/255,r=e.b/255;return.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.0722*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))},e.prototype.getAlpha=function(){return this.a},e.prototype.setAlpha=function(e){return this.a=Ue(e),this.roundA=Math.round(100*this.a)/100,this},e.prototype.isMonochrome=function(){return 0===this.toHsl().s},e.prototype.toHsv=function(){var e=Ke(this.r,this.g,this.b);return{h:360*e.h,s:e.s,v:e.v,a:this.a}},e.prototype.toHsvString=function(){var e=Ke(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),r=Math.round(100*e.v);return 1===this.a?"hsv(".concat(t,", ").concat(n,"%, ").concat(r,"%)"):"hsva(".concat(t,", ").concat(n,"%, ").concat(r,"%, ").concat(this.roundA,")")},e.prototype.toHsl=function(){var e=He(this.r,this.g,this.b);return{h:360*e.h,s:e.s,l:e.l,a:this.a}},e.prototype.toHslString=function(){var e=He(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),r=Math.round(100*e.l);return 1===this.a?"hsl(".concat(t,", ").concat(n,"%, ").concat(r,"%)"):"hsla(".concat(t,", ").concat(n,"%, ").concat(r,"%, ").concat(this.roundA,")")},e.prototype.toHex=function(e){return void 0===e&&(e=!1),We(this.r,this.g,this.b,e)},e.prototype.toHexString=function(e){return void 0===e&&(e=!1),"#"+this.toHex(e)},e.prototype.toHex8=function(e){return void 0===e&&(e=!1),function(e,t,n,r,i){var a,s=[Be(Math.round(e).toString(16)),Be(Math.round(t).toString(16)),Be(Math.round(n).toString(16)),Be((a=r,Math.round(255*parseFloat(a)).toString(16)))];return i&&s[0].startsWith(s[0].charAt(1))&&s[1].startsWith(s[1].charAt(1))&&s[2].startsWith(s[2].charAt(1))&&s[3].startsWith(s[3].charAt(1))?s[0].charAt(0)+s[1].charAt(0)+s[2].charAt(0)+s[3].charAt(0):s.join("")}(this.r,this.g,this.b,this.a,e)},e.prototype.toHex8String=function(e){return void 0===e&&(e=!1),"#"+this.toHex8(e)},e.prototype.toHexShortString=function(e){return void 0===e&&(e=!1),1===this.a?this.toHexString(e):this.toHex8String(e)},e.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},e.prototype.toRgbString=function(){var e=Math.round(this.r),t=Math.round(this.g),n=Math.round(this.b);return 1===this.a?"rgb(".concat(e,", ").concat(t,", ").concat(n,")"):"rgba(".concat(e,", ").concat(t,", ").concat(n,", ").concat(this.roundA,")")},e.prototype.toPercentageRgb=function(){var e=function(e){return"".concat(Math.round(100*Fe(e,255)),"%")};return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}},e.prototype.toPercentageRgbString=function(){var e=function(e){return Math.round(100*Fe(e,255))};return 1===this.a?"rgb(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%)"):"rgba(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%, ").concat(this.roundA,")")},e.prototype.toName=function(){if(0===this.a)return"transparent";if(this.a<1)return!1;for(var e="#"+We(this.r,this.g,this.b,!1),t=0,n=Object.entries(Je);t<n.length;t++){var r=n[t],i=r[0];if(e===r[1])return i}return!1},e.prototype.toString=function(e){var t=Boolean(e);e=null!=e?e:this.format;var n=!1,r=this.a<1&&this.a>=0;return t||!r||!e.startsWith("hex")&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this.a?this.toName():this.toRgbString()},e.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},e.prototype.clone=function(){return new e(this.toString())},e.prototype.lighten=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.l+=t/100,n.l=_e(n.l),new e(n)},e.prototype.brighten=function(t){void 0===t&&(t=10);var n=this.toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-t/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-t/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-t/100*255))),new e(n)},e.prototype.darken=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.l-=t/100,n.l=_e(n.l),new e(n)},e.prototype.tint=function(e){return void 0===e&&(e=10),this.mix("white",e)},e.prototype.shade=function(e){return void 0===e&&(e=10),this.mix("black",e)},e.prototype.desaturate=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.s-=t/100,n.s=_e(n.s),new e(n)},e.prototype.saturate=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.s+=t/100,n.s=_e(n.s),new e(n)},e.prototype.greyscale=function(){return this.desaturate(100)},e.prototype.spin=function(t){var n=this.toHsl(),r=(n.h+t)%360;return n.h=r<0?360+r:r,new e(n)},e.prototype.mix=function(t,n){void 0===n&&(n=50);var r=this.toRgb(),i=new e(t).toRgb(),a=n/100;return new e({r:(i.r-r.r)*a+r.r,g:(i.g-r.g)*a+r.g,b:(i.b-r.b)*a+r.b,a:(i.a-r.a)*a+r.a})},e.prototype.analogous=function(t,n){void 0===t&&(t=6),void 0===n&&(n=30);var r=this.toHsl(),i=360/n,a=[this];for(r.h=(r.h-(i*t>>1)+720)%360;--t;)r.h=(r.h+i)%360,a.push(new e(r));return a},e.prototype.complement=function(){var t=this.toHsl();return t.h=(t.h+180)%360,new e(t)},e.prototype.monochromatic=function(t){void 0===t&&(t=6);for(var n=this.toHsv(),r=n.h,i=n.s,a=n.v,s=[],o=1/t;t--;)s.push(new e({h:r,s:i,v:a})),a=(a+o)%1;return s},e.prototype.splitcomplement=function(){var t=this.toHsl(),n=t.h;return[this,new e({h:(n+72)%360,s:t.s,l:t.l}),new e({h:(n+216)%360,s:t.s,l:t.l})]},e.prototype.onBackground=function(t){var n=this.toRgb(),r=new e(t).toRgb(),i=n.a+r.a*(1-n.a);return new e({r:(n.r*n.a+r.r*r.a*(1-n.a))/i,g:(n.g*n.a+r.g*r.a*(1-n.a))/i,b:(n.b*n.a+r.b*r.a*(1-n.a))/i,a:i})},e.prototype.triad=function(){return this.polyad(3)},e.prototype.tetrad=function(){return this.polyad(4)},e.prototype.polyad=function(t){for(var n=this.toHsl(),r=n.h,i=[this],a=360/t,s=1;s<t;s++)i.push(new e({h:(r+s*a)%360,s:n.s,l:n.l}));return i},e.prototype.equals=function(t){return this.toRgbString()===new e(t).toRgbString()},e}();const rt=JSON.parse('{"name":"Astronaut","backgroundColor":"#000000","textColor":"#95a5d6","frameColor":"#141415","frameTextColor":"#b1bdcd","selectedBackgroundColor":"#221650","selectedTextColor":"#ffffff","spacing":0.72,"roundness":0.57,"flat":false}'),it=JSON.parse('{"name":"Black Gold","backgroundColor":"#0d0c0c","textColor":"#a9aa92","frameColor":"#1c1c12","frameTextColor":"#e8e8bf","selectedBackgroundColor":"#545549","selectedTextColor":"#ffffff","spacing":0.375,"roundness":0.25,"flat":false}'),at=JSON.parse('{"name":"(boring default)","backgroundColor":"#0d0f12","textColor":"#8facbc","frameColor":"#32312f","frameTextColor":"#d1d1d1","selectedBackgroundColor":"#163d5a","selectedTextColor":"#ebebeb","spacing":0.38,"roundness":0.48,"flat":false}'),st=JSON.parse('{"name":"Debug","backgroundColor":"#9dceec","textColor":"#0e0425","frameColor":"#00af4d","frameTextColor":"#fbf6ac","selectedBackgroundColor":"#ffcd03","selectedTextColor":"#000000","buttonColor":"#f57d20","buttonTextColor":"#000000","scrollbarColor":"#dd1a21","scrollbarTextColor":"#fff579","mediaButtonColor":"#f4f4f4","mediaButtonTextColor":"#181818","spacing":0.38,"roundness":0.48,"flat":false}'),ot=JSON.parse('{"name":"Glacier","backgroundColor":"#d9e6e8","textColor":"#0d272b","frameColor":"#bfd4e8","frameTextColor":"#1c1c12","selectedBackgroundColor":"#ffffff","selectedTextColor":"#04030c","spacing":0.65,"roundness":0.3,"flat":false}'),lt=JSON.parse('{"name":"Indigo","backgroundColor":"#06181e","textColor":"#d1d3f5","frameColor":"#43477a","frameTextColor":"#f3f3f7","selectedBackgroundColor":"#2c2e4f","selectedTextColor":"#ffffff","spacing":0.625,"roundness":0.84375,"flat":true}'),ct=JSON.parse('{"name":"Moody Blue","backgroundColor":"#051a23","textColor":"#bec1c0","frameColor":"#125673","frameTextColor":"#d8eee7","selectedBackgroundColor":"#124373","selectedTextColor":"#ffffff","spacing":0.53125,"roundness":0.40625,"flat":false}'),ut=JSON.parse('{"name":"Pale Pink","backgroundColor":"#f7f7f7","textColor":"#120f0c","frameColor":"#cfbdd0","frameTextColor":"#121211","selectedBackgroundColor":"#b9d8f3","selectedTextColor":"#000000","spacing":0.375,"roundness":0.53125,"flat":true}'),dt=JSON.parse('{"name":"Purplelicious (Winamp)","backgroundColor":"#000000","textColor":"#ffb464","frameColor":"#3e0445","frameTextColor":"#ffb464","selectedBackgroundColor":"#3e0445","selectedTextColor":"#ffb464","spacing":0.21875,"roundness":0.09375,"flat":false}'),mt=JSON.parse('{"name":"Radioactive","backgroundColor":"#0f0f10","textColor":"#d1f5d2","frameColor":"#322724","frameTextColor":"#c3feca","selectedBackgroundColor":"#43304b","selectedTextColor":"#ffffff","mediaButtonColor":"#c3feca","mediaButtonTextColor":"#021c05","spacing":0.73,"roundness":0.86,"flat":false}'),ht=JSON.parse('{"name":"Saddle","backgroundColor":"#271607","textColor":"#cbbe86","frameColor":"#331d0a","frameTextColor":"#fedfc3","selectedBackgroundColor":"#5d3512","selectedTextColor":"#ffffff","spacing":0.375,"roundness":0.34375,"flat":false}'),ft=JSON.parse('{"name":"Velvet","backgroundColor":"#160916","textColor":"#a7bdd2","frameColor":"#280b1f","frameTextColor":"#cdd1d6","mediaButtonColor":"#aa8f00","mediaButtonTextColor":"#0d0b04","selectedBackgroundColor":"#412438","selectedTextColor":"#ebebeb","spacing":1,"roundness":0.15,"flat":true}'),pt=JSON.parse('{"name":"Winamp Classic","backgroundColor":"#000000","textColor":"#00e200","frameColor":"#383757","frameTextColor":"#d2d2d2","buttonColor":"#464379","buttonTextColor":"#d2d2d2","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#040dae","selectedTextColor":"#d2d2d2","spacing":0.21875,"roundness":0.09375,"flat":false}'),vt=JSON.parse('{"name":"Winamp Modern (WACUP)","backgroundColor":"#14121c","textColor":"#8ac440","frameColor":"#1f1f36","frameTextColor":"#f0f0f0","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#2f2f76","selectedTextColor":"#f0f0f0","spacing":0.21875,"roundness":0.09375,"flat":false}'),bt={name:"(none)",backgroundColor:"black",textColor:"white",frameColor:"black",frameTextColor:"white",selectedBackgroundColor:"blue",selectedTextColor:"white",buttonColor:"",buttonTextColor:"",scrollbarColor:"",scrollbarTextColor:"",mediaButtonColor:"",mediaButtonTextColor:"",spacing:0,roundness:0,flat:!1},yt=Object.assign(Object.assign({},bt),at),gt=[yt,rt,it,ot,lt,ct,ut,dt,mt,ht,ft,pt,vt,st];var wt=n(9520),Et=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const kt=new N("themeStore");class xt extends wt.ZP{constructor(){super("ampcast/themes"),this.defaultThemes=new Map(gt.map((e=>[e.name,e]))),this.themes$=new $e([]),this.version(1).stores({themes:"&name"}),(0,wt.Y1)((()=>this.themes.toArray())).subscribe(this.themes$)}observeUserThemes(){return this.themes$}getDefaultTheme(e){return this.defaultThemes.get(e)}getDefaultThemes(){return[...this.defaultThemes.values()]}getUserTheme(e){return this.getUserThemes().find((t=>t.name===e))}getUserThemes(){return this.themes$.getValue()}save(e){return Et(this,void 0,void 0,(function*(){try{kt.log("save",{theme:e}),yield this.themes.put(Object.assign(Object.assign({},e),{userTheme:!0}))}catch(e){kt.error(e)}}))}remove(e){return Et(this,void 0,void 0,(function*(){try{kt.log("remove",{name:e}),yield this.themes.delete(e)}catch(e){kt.error(e)}}))}rename(e,t){return Et(this,void 0,void 0,(function*(){try{const n=yield this.themes.get(e);if(!n)throw Error(`Theme '${e}' not found.`);yield this.themes.delete(e),yield this.themes.put(Object.assign(Object.assign({},n),{name:t,userTheme:!0}))}catch(e){kt.error(e)}}))}}const St=new xt,Tt=new N("theme"),At=new class{constructor(){this.defaultFontSize=17.2,this.storage=new D("theme"),this.app=document.getElementById("app"),this.popup=document.getElementById("popup"),this.system=document.getElementById("system"),this.theme$=new $e(yt),this.applyingUpdate=!1;const e=document.createElement("style");document.head.append(e),this.sheet=e.sheet,this.rootStyle=this.createStyle(":root"),this.appStyle=this.createStyle(".app"),this.playheadStyle=this.createStyle("#playhead"),this.system.classList.toggle("selection-dark",!0),this.restore(),this.observe().pipe(Re((()=>this.applyAppStyles()))).subscribe(Tt)}observe(){return this.theme$.pipe(De((()=>!this.applyingUpdate)))}get backgroundColor(){return this.current.backgroundColor}set backgroundColor(e){this.setColor("backgroundColor",e)}get black(){if(this.isLight){const e=new nt(this.defaultButtonColor).toHsl();return e.s-=.6*e.s,e.l-=.8*e.l,this.fromHsl(e)}return new nt(this.backgroundColor).darken(33).toHexString()}get buttonColor(){return this.current.buttonColor}set buttonColor(e){this.setColor("buttonColor",e,this.defaultButtonColor),this.scrollbarColor=this.current.scrollbarColor}get buttonTextColor(){return this.current.buttonTextColor}set buttonTextColor(e){this.setColor("buttonTextColor",e,this.defaultButtonTextColor),this.scrollbarTextColor=this.current.scrollbarTextColor}get current(){return this.theme$.value}get defaultButtonColor(){const e=new nt(this.frameColor).toHsl();return e.s+=.05,e.l+=.05,this.fromHsl(e)}get defaultButtonTextColor(){return this.frameTextColor}get defaultMediaButtonColor(){const e=new nt(this.frameColor).toHsl();return e.s+=.33*(1-e.s),e.l+=.5*(1-e.l),this.fromHsl(e)}get defaultMediaButtonTextColor(){const e=new nt(this.mediaButtonColor||this.defaultMediaButtonColor).toHsl();return e.s-=.5*e.s,e.l-=.9*e.l,this.fromHsl(e)}get defaultScrollbarColor(){return this.buttonColor||this.defaultButtonColor}get defaultScrollbarTextColor(){return this.buttonTextColor||this.defaultButtonTextColor}get edited(){const e=this.userTheme?St.getUserTheme(this.name):St.getDefaultTheme(this.name);return!!e&&!Object.keys(e).every((t=>e[t]===this[t]))}get flat(){return this.current.flat}set flat(e){this.app.classList.toggle("flat",!!e),this.popup.classList.toggle("flat",!!e),this.theme$.next(Object.assign(Object.assign({},this.current),{flat:e}))}get focusRingColor(){return this.isFrameDark?new nt(this.isMediaButtonLight?this.mediaButtonColor:this.defaultMediaButtonColor).triad()[1].saturate(20).lighten(20).toHexString():new nt(this.frameColor).triad()[2].saturate(33).darken(50).toHexString()}get fontSize(){return Number(this.rootStyle.getPropertyValue("--font-size"))||this.defaultFontSize}set fontSize(e){this.rootStyle.setProperty("--font-size",String(e)),this.createPlayheadSmiley()}get frameColor(){return this.current.frameColor}set frameColor(e){this.setColor("frameColor",e),this.buttonColor=this.current.buttonColor,this.mediaButtonColor=this.current.mediaButtonColor}get frameTextColor(){return this.current.frameTextColor}set frameTextColor(e){this.setColor("frameTextColor",e),this.buttonTextColor=this.current.buttonTextColor}get mediaButtonColor(){return this.current.mediaButtonColor}set mediaButtonColor(e){this.setColor("mediaButtonColor",e,this.defaultMediaButtonColor),this.mediaButtonTextColor=this.current.mediaButtonTextColor}get mediaButtonTextColor(){return this.current.mediaButtonTextColor}set mediaButtonTextColor(e){this.setColor("mediaButtonTextColor",e,this.defaultMediaButtonTextColor),this.createPlayheadSmiley()}get name(){return this.current.name}set name(e){this.theme$.next(Object.assign(Object.assign({},this.current),{name:e}))}get roundness(){return this.current.roundness}set roundness(e){this.setProperty("roundness",e),this.theme$.next(Object.assign(Object.assign({},this.current),{roundness:e}))}get scrollbarColor(){return this.current.scrollbarColor}set scrollbarColor(e){this.setColor("scrollbarColor",e,this.defaultScrollbarColor)}get scrollbarTextColor(){return this.current.scrollbarTextColor}set scrollbarTextColor(e){this.setColor("scrollbarTextColor",e,this.defaultScrollbarTextColor)}get selectedBackgroundColor(){return this.current.selectedBackgroundColor}set selectedBackgroundColor(e){this.setColor("selectedBackgroundColor",e);const t=new nt(e);this.setProperty("selected-background-color-blurred",t.desaturate(50).setAlpha(.75).toRgbString())}get selectedTextColor(){return this.current.selectedTextColor}set selectedTextColor(e){this.setColor("selectedTextColor",e)}get spacing(){return this.current.spacing}set spacing(e){this.setProperty("spacing",e),this.theme$.next(Object.assign(Object.assign({},this.current),{spacing:e}))}get textColor(){return this.current.textColor}set textColor(e){this.setColor("textColor",e)}get isDark(){return new nt(this.backgroundColor).isDark()}get isLight(){return new nt(this.backgroundColor).isLight()}get isButtonDark(){return new nt(this.buttonColor||this.defaultButtonColor).isDark()}get isButtonLight(){return new nt(this.buttonColor||this.defaultButtonColor).isLight()}get isFrameDark(){return new nt(this.frameColor).isDark()}get isFrameLight(){return new nt(this.frameColor).isLight()}get isFrameTextDark(){return new nt(this.frameTextColor).isDark()}get isFrameTextLight(){return new nt(this.frameTextColor).isLight()}get isMediaButtonLight(){return new nt(this.mediaButtonColor).isLight()}get isScrollbarDark(){return new nt(this.scrollbarColor||this.defaultScrollbarColor).isDark()}get isScrollbarLight(){return new nt(this.scrollbarColor||this.defaultScrollbarColor).isLight()}get isSelectionDark(){return new nt(this.selectedBackgroundColor).isDark()}get isSelectionLight(){return new nt(this.selectedBackgroundColor).isLight()}get isTextDark(){return new nt(this.textColor).isDark()}get isTextLight(){return new nt(this.textColor).isLight()}get userTheme(){return!!this.current.userTheme}set userTheme(e){this.theme$.next(Object.assign(Object.assign({},this.current),{userTheme:e}))}getVisualizerColors(){const e=new nt(this.defaultMediaButtonColor);return[this.isDark?this.textColor:this.isFrameTextLight?this.frameTextColor:this.backgroundColor,...e.tetrad().map((e=>e.toRgbString()))]}apply(e){this.applyingUpdate=!0;const t=Object.assign(Object.assign(Object.assign({},bt),{userTheme:void 0}),e);this.frameColor=t.frameColor,this.frameTextColor=t.frameTextColor,Object.assign(this,t),this.applyingUpdate=!1,this.theme$.next(this.current)}applyAppStyles(){this.setProperty("black",this.black),this.setProperty("focus-ring-color",this.focusRingColor),this.toggleClasses(this.app),this.toggleClasses(this.popup)}restore(){const e=this.storage.getJson("current",yt);this.apply(e),this.fontSize=this.storage.getNumber("fontSize",this.defaultFontSize),this.system.classList.toggle("dark",this.isDark),this.system.classList.toggle("light",this.isLight)}save(){this.storage.setNumber("fontSize",this.fontSize),this.storage.setJson("current",this.current),this.system.classList.toggle("dark",this.isDark),this.system.classList.toggle("light",this.isLight)}validate(e){if(!e||"object"!=typeof e||"length"in e)return!1;const t={name:"string",frameColor:"string",frameTextColor:"string",backgroundColor:"string",textColor:"string",selectedBackgroundColor:"string",selectedTextColor:"string"},n={mediaButtonColor:"string",mediaButtonTextColor:"string",buttonColor:"string",buttonTextColor:"string",scrollbarColor:"string",scrollbarTextColor:"string",spacing:"number",roundness:"number",flat:"boolean"};return Object.keys(t).every((n=>n in e&&typeof e[n]===t[n]))&&Object.keys(e).every((r=>r in t||typeof e[r]===n[r]))}toggleClasses(e){const t=e.classList;t.toggle("dark",this.isDark),t.toggle("light",this.isLight),t.toggle("frame-dark",this.isFrameDark),t.toggle("frame-light",this.isFrameLight),t.toggle("frame-text-dark",this.isFrameTextDark),t.toggle("frame-text-light",this.isFrameTextLight),t.toggle("button-dark",this.isButtonDark),t.toggle("button-light",this.isButtonLight),t.toggle("scrollbar-dark",this.isScrollbarDark),t.toggle("scrollbar-light",this.isScrollbarLight),t.toggle("selection-dark",this.isSelectionDark),t.toggle("selection-light",this.isSelectionLight)}setColor(e,t,n){const r=this.toDashName(e);let i=t||n;if(i){"string"==typeof i&&(i=new nt(i));const n=i.toHsl();this.setProperty(`${r}-h`,String(n.h)),this.setProperty(`${r}-s`,100*n.s+"%"),this.setProperty(`${r}-l`,100*n.l+"%"),this.theme$.next(Object.assign(Object.assign({},this.current),{[e]:t?i.toHexString():""}))}else this.setProperty(`${r}-h`,null),this.setProperty(`${r}-s`,null),this.setProperty(`${r}-l`,null),this.theme$.next(Object.assign(Object.assign({},this.current),{[e]:""}))}setProperty(e,t){this.appStyle.setProperty(`--${e}`,null==t?null:String(t))}createStyle(e){const t=this.sheet.insertRule(`${e}{}`);return this.sheet.cssRules[t].style}get smileyColor(){return this.mediaButtonTextColor||this.defaultMediaButtonTextColor}createPlayheadSmiley(){const e=new nt(this.smileyColor).toRgbString(),t=[`<path fill='${e}' d='M 160.5,164.5 C 183.647,162.813 194.147,173.48 192,196.5C 186.494,211.009 175.994,216.842 160.5,214C 145.991,208.494 140.158,197.994 143,182.5C 145.683,173.318 151.517,167.318 160.5,164.5 Z'/>`,`<path fill='${e}' d='M 335.5,164.5 C 358.647,162.813 369.147,173.48 367,196.5C 361.494,211.009 350.994,216.842 335.5,214C 320.991,208.494 315.158,197.994 318,182.5C 320.683,173.318 326.517,167.318 335.5,164.5 Z'/>`,`<path fill='${e}' d='M 164.5,296.5 C 172.699,295.1 179.865,297.1 186,302.5C 201.99,327.582 224.823,341.582 254.5,344.5C 279.499,342.418 299.999,331.751 316,312.5C 318.955,308.756 321.789,304.922 324.5,301C 334.716,294.616 344.55,295.116 354,302.5C 358.296,308.845 359.63,315.845 358,323.5C 334.118,361.698 299.618,382.365 254.5,385.5C 209.382,382.365 174.882,361.698 151,323.5C 148.138,310.557 152.638,301.557 164.5,296.5 Z'/>`].join(""),n=this.createBase64SVG(512,512,t);this.playheadStyle.setProperty("--smiley",n),this.playheadStyle.setProperty("--thumb-size",`${Math.round(1.25*this.fontSize)}px`)}createBase64SVG(e,t,n){return`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='${e}' height='${t}'>${n}</svg>")`}toDashName(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}fromHsl({h:e,s:t,l:n}){return t=Math.min(Math.max(t,0),1),n=Math.min(Math.max(n,0),1),new nt({h:e,s:t,l:n}).toHexString()}};function Pt(e,t){const n=(0,r.useRef)(t);(0,r.useEffect)((()=>{n.current=t}),[t]),(0,r.useEffect)((()=>{const t=e.current;if(t){const r=new ResizeObserver((()=>{e.current&&n.current()}));return r.observe(t),()=>r.disconnect()}}),[e])}const It=document.createElement("div");function Ct(){const e=(0,r.useRef)(It),[t,n]=(0,r.useState)(0);return(0,r.useEffect)((()=>{It.parentElement||(document.body.append(It),n(Mt()))}),[]),Pt(e,(()=>n(Mt()))),t}function Mt(){return parseFloat(getComputedStyle(It).fontSize)||At.defaultFontSize}function Ot({vertical:e,primary:t,size:n,children:i}){const a={};return t||(e?a.height=`${n}px`:a.width=`${n}px`),r.createElement("div",{className:"layout-pane layout-pane-"+(t?"primary":"secondary"),style:a},i)}function Nt({id:e,arrange:t="columns",primaryIndex:n=0,children:i}){const a=(0,r.useRef)(null),[s,o]=(0,r.useState)({width:0,height:0}),[l,c]=(0,r.useState)(0),[u,d]=(0,r.useState)(0),[m,h]=(0,r.useState)(0),[f,p]=(0,r.useState)((()=>e?q.get(e):0)),[v,b]=(0,r.useState)(-1),[y,g]=(0,r.useState)(0),w=-1!==v,E=Ct(),k="rows"===t;(0,r.useEffect)((()=>{e&&q.set(e,Math.max(f,u))}),[e,f,u]),(0,r.useEffect)((()=>{var e;if(E>0){const t=a.current,n=k?"minHeight":"minWidth",r=t.querySelector(":scope > .layout-pane-primary");if(r){r.style[n]="";const e=parseInt(getComputedStyle(r)[n],10);r.style[n]="unset",c(e||80)}const i=t.querySelector(":scope > .layout-pane-secondary");if(i){i.style[n]="";const r=parseInt(getComputedStyle(i)[n],10);i.style[n]="unset",d(r||80);const a=k?"offsetHeight":"offsetWidth",s=t.querySelector(":scope > .layout-splitter");h(null!==(e=null==s?void 0:s[a])&&void 0!==e?e:4)}}}),[k,E]),(0,r.useLayoutEffect)((()=>{const e=k?s.height:s.width;if(e>0){const t=e-m-f;t<l?p(Math.max(f-(l-t),0)):f<u&&p(Math.min(e-m-l,u))}}),[k,s,l,u,m,f]);const x=(0,r.useCallback)((e=>{if(0===e.button){const t=k?e.screenY:e.screenX;b(t),g(f),e.preventDefault()}}),[k,f]),S=(0,r.useCallback)((e=>{const t=(k?e.screenY:e.screenX)-v;p(0===n?y-t:y+t)}),[k,n,v,y]),T=(0,r.useCallback)((()=>{b(-1),g(0)}),[]);return(0,r.useEffect)((()=>{if(w)return document.documentElement.style.cursor=k?"ns-resize":"ew-resize",document.body.classList.add("dragging"),document.addEventListener("mouseup",T),document.addEventListener("mousemove",S),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",T),document.removeEventListener("mousemove",S)}}),[k,w,S,T]),Pt(a,(()=>{const e=a.current;o({width:e.clientWidth,height:e.clientHeight})})),r.createElement("div",{className:`splitter splitter-${t}`,id:e,ref:a},r.Children.toArray(i).slice(0,2).map(((e,t)=>{const i=t===n,a=i?0:f,s=[];return 1===t&&s.push(r.createElement("div",{className:"layout-splitter "+(w?"active":""),role:"separator",onMouseDown:x,key:"splitter"})),s.push(r.createElement(Ot,{vertical:k,primary:i,size:a,key:t},e)),s})))}function $t({name:e,className:t=""}){switch(t=`icon icon-${e} ${t}`,e){case"ampcast":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("circle",{cx:"12",cy:"12",r:"8",strokeWidth:"4",stroke:"orange",fill:"black"}),r.createElement("circle",{cx:"12",cy:"12",r:"2",stroke:"none",fill:"white"}));case"play":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"}));case"pause":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"}));case"stop":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"}));case"volume":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{className:"high medium",stroke:"none",d:"M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"}),r.createElement("path",{className:"medium",stroke:"none",d:"M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"}),r.createElement("path",{stroke:"none",d:"M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182L8 5.525A3.489 3.489 0 0 1 9.025 8 3.49 3.49 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"}));case"muted":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06zm7.137 2.096a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0z"}));case"prev":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z"}));case"next":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z"}));case"calendar":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M128 0c17.7 0 32 14.3 32 32V64H288V32c0-17.7 14.3-32 32-32s32 14.3 32 32V64h48c26.5 0 48 21.5 48 48v48H0V112C0 85.5 21.5 64 48 64H96V32c0-17.7 14.3-32 32-32zM0 192H448V464c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V192zm64 80v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16zm128 0v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H208c-8.8 0-16 7.2-16 16zm144-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V272c0-8.8-7.2-16-16-16H336zM64 400v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H80c-8.8 0-16 7.2-16 16zm144-16c-8.8 0-16 7.2-16 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H208zm112 16v32c0 8.8 7.2 16 16 16h32c8.8 0 16-7.2 16-16V400c0-8.8-7.2-16-16-16H336c-8.8 0-16 7.2-16 16z"}));case"shuffle":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M403.8 34.4c12-5 25.7-2.2 34.9 6.9l64 64c6 6 9.4 14.1 9.4 22.6s-3.4 16.6-9.4 22.6l-64 64c-9.2 9.2-22.9 11.9-34.9 6.9s-19.8-16.6-19.8-29.6V160H352c-10.1 0-19.6 4.7-25.6 12.8L284 229.3 244 176l31.2-41.6C293.3 110.2 321.8 96 352 96h32V64c0-12.9 7.8-24.6 19.8-29.6zM164 282.7L204 336l-31.2 41.6C154.7 401.8 126.2 416 96 416H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H96c10.1 0 19.6-4.7 25.6-12.8L164 282.7zm274.6 188c-9.2 9.2-22.9 11.9-34.9 6.9s-19.8-16.6-19.8-29.6V416H352c-30.2 0-58.7-14.2-76.8-38.4L121.6 172.8c-6-8.1-15.5-12.8-25.6-12.8H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H96c30.2 0 58.7 14.2 76.8 38.4L326.4 339.2c6 8.1 15.5 12.8 25.6 12.8h32V320c0-12.9 7.8-24.6 19.8-29.6s25.7-2.2 34.9 6.9l64 64c6 6 9.4 14.1 9.4 22.6s-3.4 16.6-9.4 22.6l-64 64z"}));case"info":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}));case"menu":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"}));case"settings":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}));case"album":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("circle",{cx:"12",cy:"12",r:"8.5",strokeWidth:"6.5",fill:"none"}),r.createElement("circle",{cx:"12",cy:"12",r:"2",stroke:"none"}));case"locked":return r.createElement("svg",{className:t,viewBox:"0 0 448 512",transform:"scale(0.95)"},r.createElement("path",{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"}));case"unlocked":return r.createElement("svg",{className:t,viewBox:"0 0 576 512",transform:"scale(0.95)"},r.createElement("path",{d:"M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"}));case"left":return r.createElement("svg",{className:t,viewBox:"0 0 320 512"},r.createElement("path",{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"}));case"right":return r.createElement("svg",{className:t,viewBox:"0 0 320 512"},r.createElement("path",{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"}));case"saved":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"}));case"unsaved":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM272 80v80H144V80h128zm122 352H54a6 6 0 0 1-6-6V86a6 6 0 0 1 6-6h42v104c0 13.255 10.745 24 24 24h176c13.255 0 24-10.745 24-24V83.882l78.243 78.243a6 6 0 0 1 1.757 4.243V426a6 6 0 0 1-6 6zM224 232c-48.523 0-88 39.477-88 88s39.477 88 88 88 88-39.477 88-88-39.477-88-88-88zm0 128c-22.056 0-40-17.944-40-40s17.944-40 40-40 40 17.944 40 40-17.944 40-40 40z"}));case"close":return r.createElement("svg",{className:t,viewBox:"0 0 64 64"},r.createElement("path",{d:"M 10.5,-0.5 C 12.1667,-0.5 13.8333,-0.5 15.5,-0.5C 20.7971,5.29805 26.2971,10.9647 32,16.5C 37.0314,10.303 42.5314,4.63636 48.5,-0.5C 49.8333,-0.5 51.1667,-0.5 52.5,-0.5C 55.8333,3.5 59.5,7.16667 63.5,10.5C 63.5,11.8333 63.5,13.1667 63.5,14.5C 57.7019,19.7971 52.0353,25.2971 46.5,31C 52.0353,36.7029 57.7019,42.2029 63.5,47.5C 63.5,49.1667 63.5,50.8333 63.5,52.5C 59.5,55.8333 55.8333,59.5 52.5,63.5C 50.8333,63.5 49.1667,63.5 47.5,63.5C 42.1604,57.8275 36.8271,52.1608 31.5,46.5C 25.479,51.8543 19.8123,57.521 14.5,63.5C 13.1667,63.5 11.8333,63.5 10.5,63.5C 7.16667,59.5 3.5,55.8333 -0.5,52.5C -0.5,50.8333 -0.5,49.1667 -0.5,47.5C 5.17254,42.1604 10.8392,36.8271 16.5,31.5C 10.8392,26.1729 5.17254,20.8396 -0.5,15.5C -0.5,13.8333 -0.5,12.1667 -0.5,10.5C 3.5,7.16667 7.16667,3.5 10.5,-0.5 Z"}));case"audio":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("path",{stroke:"none",d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"}));case"video":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{strokeWidth:.5,d:"M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z"}));case"genre":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("path",{stroke:"none",d:"m12 2-5.5 9h11z"}),r.createElement("circle",{stroke:"none",cx:"17.5",cy:"17.5",r:"4.5"}),r.createElement("path",{stroke:"none",d:"M3 13.5h8v8H3z"}));case"star":return r.createElement("svg",{className:t,viewBox:"0 0 576 512"},r.createElement("path",{className:"icon-star-outer",d:"M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z"}),r.createElement("path",{className:"icon-star-inner",d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}));case"star-fill":return r.createElement("svg",{className:t,viewBox:"0 0 576 512"},r.createElement("path",{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}));case"heart":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"}));case"heart-fill":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"}));case"thumbs-up":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z"}));case"tick":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),r.createElement("path",{stroke:"none",d:"M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.235.235 0 0 1 .02-.022z"}));case"plus":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),r.createElement("path",{stroke:"none",d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}));case"tick-fill":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z"}));case"artist":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"}));case"folder":return r.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.25)"},r.createElement("path",{stroke:"none",d:"m9.17 6 2 2H20v10H4V6h5.17M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"}));case"folder-up":return r.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.25)"},r.createElement("path",{stroke:"none",d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V6h5.17l2 2H20v10zM9.41 14.42 11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01l1.41 1.41z"}));case"file-audio":return r.createElement("svg",{className:t,strokeWidth:"0",viewBox:"0 0 16 16"},r.createElement("path",{d:"M14.341 3.579c-0.347-0.473-0.831-1.027-1.362-1.558s-1.085-1.015-1.558-1.362c-0.806-0.591-1.197-0.659-1.421-0.659h-7.75c-0.689 0-1.25 0.561-1.25 1.25v13.5c0 0.689 0.561 1.25 1.25 1.25h11.5c0.689 0 1.25-0.561 1.25-1.25v-9.75c0-0.224-0.068-0.615-0.659-1.421v0zM12.271 2.729c0.48 0.48 0.856 0.912 1.134 1.271h-2.406v-2.405c0.359 0.278 0.792 0.654 1.271 1.134v0zM14 14.75c0 0.136-0.114 0.25-0.25 0.25h-11.5c-0.135 0-0.25-0.114-0.25-0.25v-13.5c0-0.135 0.115-0.25 0.25-0.25 0 0 7.749-0 7.75 0v3.5c0 0.276 0.224 0.5 0.5 0.5h3.5v9.75z"}),r.createElement("path",{d:"M11.817 6.113c-0.116-0.095-0.268-0.133-0.415-0.104l-5 1c-0.234 0.047-0.402 0.252-0.402 0.49v3.701c-0.294-0.128-0.636-0.201-1-0.201-1.105 0-2 0.672-2 1.5s0.895 1.5 2 1.5 2-0.672 2-1.5v-3.59l4-0.8v2.091c-0.294-0.128-0.636-0.201-1-0.201-1.105 0-2 0.672-2 1.5s0.895 1.5 2 1.5 2-0.672 2-1.5v-5c0-0.15-0.067-0.292-0.183-0.387z"}));case"file-video":return r.createElement("svg",{className:t,viewBox:"0 0 16 16",strokeWidth:"0"},r.createElement("path",{d:"M14.341 3.579c-0.347-0.473-0.831-1.027-1.362-1.558s-1.085-1.015-1.558-1.362c-0.806-0.591-1.197-0.659-1.421-0.659h-7.75c-0.689 0-1.25 0.561-1.25 1.25v13.5c0 0.689 0.561 1.25 1.25 1.25h11.5c0.689 0 1.25-0.561 1.25-1.25v-9.75c0-0.224-0.068-0.615-0.659-1.421v0 0zM12.271 2.729c0.48 0.48 0.856 0.912 1.134 1.271h-2.406v-2.405c0.359 0.278 0.792 0.654 1.271 1.134v0 0zM14 14.75c0 0.136-0.114 0.25-0.25 0.25h-11.5c-0.135 0-0.25-0.114-0.25-0.25v-13.5c0-0.135 0.115-0.25 0.25-0.25 0 0 7.749-0 7.75 0v3.5c0 0.276 0.224 0.5 0.5 0.5h3.5v9.75z"}),r.createElement("path",{d:"M4 8h5v5h-5v-5z"}),r.createElement("path",{d:"M9 10l3-2v5l-3-2z"}));case"most-played":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M2 3a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 0-1h-11A.5.5 0 0 0 2 3zm2-2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7A.5.5 0 0 0 4 1zm2.765 5.576A.5.5 0 0 0 6 7v5a.5.5 0 0 0 .765.424l4-2.5a.5.5 0 0 0 0-.848l-4-2.5z"}),r.createElement("path",{stroke:"none",d:"M1.5 14.5A1.5 1.5 0 0 1 0 13V6a1.5 1.5 0 0 1 1.5-1.5h13A1.5 1.5 0 0 1 16 6v7a1.5 1.5 0 0 1-1.5 1.5h-13zm13-1a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5h-13A.5.5 0 0 0 1 6v7a.5.5 0 0 0 .5.5h13z"}));case"clock":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"}));case"globe":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855-.143.268-.276.56-.395.872.705.157 1.472.257 2.282.287V1.077zM4.249 3.539c.142-.384.304-.744.481-1.078a6.7 6.7 0 0 1 .597-.933A7.01 7.01 0 0 0 3.051 3.05c.362.184.763.349 1.198.49zM3.509 7.5c.036-1.07.188-2.087.436-3.008a9.124 9.124 0 0 1-1.565-.667A6.964 6.964 0 0 0 1.018 7.5h2.49zm1.4-2.741a12.344 12.344 0 0 0-.4 2.741H7.5V5.091c-.91-.03-1.783-.145-2.591-.332zM8.5 5.09V7.5h2.99a12.342 12.342 0 0 0-.399-2.741c-.808.187-1.681.301-2.591.332zM4.51 8.5c.035.987.176 1.914.399 2.741A13.612 13.612 0 0 1 7.5 10.91V8.5H4.51zm3.99 0v2.409c.91.03 1.783.145 2.591.332.223-.827.364-1.754.4-2.741H8.5zm-3.282 3.696c.12.312.252.604.395.872.552 1.035 1.218 1.65 1.887 1.855V11.91c-.81.03-1.577.13-2.282.287zm.11 2.276a6.696 6.696 0 0 1-.598-.933 8.853 8.853 0 0 1-.481-1.079 8.38 8.38 0 0 0-1.198.49 7.01 7.01 0 0 0 2.276 1.522zm-1.383-2.964A13.36 13.36 0 0 1 3.508 8.5h-2.49a6.963 6.963 0 0 0 1.362 3.675c.47-.258.995-.482 1.565-.667zm6.728 2.964a7.009 7.009 0 0 0 2.275-1.521 8.376 8.376 0 0 0-1.197-.49 8.853 8.853 0 0 1-.481 1.078 6.688 6.688 0 0 1-.597.933zM8.5 11.909v3.014c.67-.204 1.335-.82 1.887-1.855.143-.268.276-.56.395-.872A12.63 12.63 0 0 0 8.5 11.91zm3.555-.401c.57.185 1.095.409 1.565.667A6.963 6.963 0 0 0 14.982 8.5h-2.49a13.36 13.36 0 0 1-.437 3.008zM14.982 7.5a6.963 6.963 0 0 0-1.362-3.675c-.47.258-.995.482-1.565.667.248.92.4 1.938.437 3.008h2.49zM11.27 2.461c.177.334.339.694.482 1.078a8.368 8.368 0 0 0 1.196-.49 7.01 7.01 0 0 0-2.275-1.52c.218.283.418.597.597.932zm-.488 1.343a7.765 7.765 0 0 0-.395-.872C9.835 1.897 9.17 1.282 8.5 1.077V4.09c.81-.03 1.577-.13 2.282-.287z"}));case"visualizer":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M4 11H2v3h2v-3zm5-4H7v7h2V7zm5-5v12h-2V2h2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1h-2zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3z"}));case"palette":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M8 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 7a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm.5 6a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),r.createElement("path",{stroke:"none",d:"M16 8c0 3.15-1.866 2.585-3.567 2.07C11.42 9.763 10.465 9.473 10 10c-.603.683-.475 1.819-.351 2.92C9.826 14.495 9.996 16 8 16a8 8 0 1 1 8-8zm-8 7c.611 0 .654-.171.655-.176.078-.146.124-.464.07-1.119-.014-.168-.037-.37-.061-.591-.052-.464-.112-1.005-.118-1.462-.01-.707.083-1.61.704-2.314.369-.417.845-.578 1.272-.618.404-.038.812.026 1.16.104.343.077.702.186 1.025.284l.028.008c.346.105.658.199.953.266.653.148.904.083.991.024C14.717 9.38 15 9.161 15 8a7 7 0 1 0-7 7z"}));case"pin":return r.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.125)"},r.createElement("path",{stroke:"none",d:"M14 4v5c0 1.12.37 2.16 1 3H9c.65-.86 1-1.9 1-3V4h4m3-2H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3V4h1c.55 0 1-.45 1-1s-.45-1-1-1z"}));case"pin-fill":return r.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.125)"},r.createElement("path",{stroke:"none",fillRule:"evenodd",d:"M16 9V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3z"}));case"link":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{stroke:"none",d:"M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32H320zM80 32C35.8 32 0 67.8 0 112V432c0 44.2 35.8 80 80 80H400c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32V432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H192c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z"}));case"search":return r.createElement("svg",{className:t,viewBox:"0 0 16 16",transform:"scale(0.875)"},r.createElement("path",{stroke:"none",d:"M15.504 13.616l-3.79-3.223c-0.392-0.353-0.811-0.514-1.149-0.499 0.895-1.048 1.435-2.407 1.435-3.893 0-3.314-2.686-6-6-6s-6 2.686-6 6 2.686 6 6 6c1.486 0 2.845-0.54 3.893-1.435-0.016 0.338 0.146 0.757 0.499 1.149l3.223 3.79c0.552 0.613 1.453 0.665 2.003 0.115s0.498-1.452-0.115-2.003zM6 10c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"}));case"swap":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{stroke:"none",d:"M438.6 150.6c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.7 96 32 96C14.3 96 0 110.3 0 128s14.3 32 32 32l306.7 0-41.4 41.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96zm-333.3 352c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 416 416 416c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0 41.4-41.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96z"}));case"playlist-add":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("path",{stroke:"none",d:"M14 10H3v2h11v-2zm0-4H3v2h11V6zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zM3 16h7v-2H3v2z"}));case"recently-added":return r.createElement("svg",{className:t,viewBox:"0 0 384 512"},r.createElement("path",{d:"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48z"}),r.createElement("rect",{x:"177",y:"220",width:"40",height:"210",strokeWidth:"20",strokeLinejoin:"round"}),r.createElement("rect",{x:"87",y:"310",width:"210",height:"40",strokeWidth:"20",strokeLinejoin:"round"}));case"playlist":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M88 48C101.3 48 112 58.75 112 72V120C112 133.3 101.3 144 88 144H40C26.75 144 16 133.3 16 120V72C16 58.75 26.75 48 40 48H88zM480 64C497.7 64 512 78.33 512 96C512 113.7 497.7 128 480 128H192C174.3 128 160 113.7 160 96C160 78.33 174.3 64 192 64H480zM480 224C497.7 224 512 238.3 512 256C512 273.7 497.7 288 480 288H192C174.3 288 160 273.7 160 256C160 238.3 174.3 224 192 224H480zM480 384C497.7 384 512 398.3 512 416C512 433.7 497.7 448 480 448H192C174.3 448 160 433.7 160 416C160 398.3 174.3 384 192 384H480zM16 232C16 218.7 26.75 208 40 208H88C101.3 208 112 218.7 112 232V280C112 293.3 101.3 304 88 304H40C26.75 304 16 293.3 16 280V232zM88 368C101.3 368 112 378.7 112 392V440C112 453.3 101.3 464 88 464H40C26.75 464 16 453.3 16 440V392C16 378.7 26.75 368 40 368H88z"}));case"file":case"blob":return r.createElement("svg",{className:t,viewBox:"0 0 448 512",transform:"scale(0.875)"},r.createElement("path",{fill:"#00cccc",d:"M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"}));case"apple":return r.createElement("svg",{className:t,viewBox:"0 0 73 73"},r.createElement("linearGradient",{id:"apple-linear-gradient",gradientUnits:"userSpaceOnUse",x1:"36",y1:"2.2858",x2:"36",y2:"72.455",gradientTransform:"matrix(1 0 0 -1 0 74.0068)"},r.createElement("stop",{offset:"0",style:{stopColor:"#FA233B"}}),r.createElement("stop",{offset:"1",style:{stopColor:"#FB5C74"}})),r.createElement("rect",{className:"icon-apple-inner",x:"10",y:"10",width:"53",height:"53"}),r.createElement("path",{className:"icon-apple-outer",fillRule:"evenodd",clipRule:"evenodd",stroke:"none",d:"M72,19.94c0-0.72-0.01-1.45-0.03-2.17c-0.04-1.58-0.14-3.17-0.42-4.73c-0.28-1.58-0.75-3.06-1.48-4.5\r\n\t\t\tc-0.72-1.41-1.66-2.71-2.78-3.83c-1.12-1.12-2.42-2.06-3.83-2.78c-1.44-0.73-2.91-1.2-4.49-1.48c-1.56-0.28-3.15-0.37-4.73-0.42\r\n\t\t\tC53.51,0.02,52.78,0.01,52.06,0c-0.86,0-1.72,0-2.58,0H22.52c-0.86,0-1.72,0-2.58,0c-0.72,0-1.45,0.01-2.17,0.03\r\n\t\t\tc-1.58,0.04-3.17,0.14-4.73,0.42C11.46,0.74,9.98,1.2,8.55,1.94C7.13,2.66,5.84,3.6,4.72,4.72S2.65,7.13,1.93,8.55\r\n\t\t\tc-0.73,1.44-1.2,2.91-1.48,4.5c-0.28,1.56-0.37,3.15-0.42,4.73C0.02,18.5,0.01,19.22,0,19.94c0,0.86,0,1.72,0,2.58v26.95\r\n\t\t\tc0,0.86,0,1.72,0,2.58c0,0.72,0.01,1.45,0.03,2.17c0.04,1.58,0.14,3.17,0.42,4.73c0.28,1.58,0.75,3.06,1.48,4.5\r\n\t\t\tc0.72,1.41,1.66,2.71,2.78,3.83s2.42,2.06,3.83,2.78c1.44,0.73,2.91,1.2,4.49,1.48c1.56,0.28,3.15,0.37,4.73,0.42\r\n\t\t\tc0.72,0.02,1.45,0.03,2.17,0.03c0.86,0.01,1.72,0,2.58,0h26.95c0.86,0,1.72,0,2.58,0c0.72,0,1.45-0.01,2.17-0.03\r\n\t\t\tc1.58-0.04,3.17-0.14,4.73-0.42c1.58-0.28,3.06-0.75,4.49-1.48c1.41-0.72,2.71-1.66,3.83-2.78c1.12-1.12,2.06-2.41,2.78-3.83\r\n\t\t\tc0.73-1.44,1.2-2.91,1.48-4.5c0.28-1.56,0.37-3.15,0.42-4.73c0.02-0.72,0.03-1.45,0.03-2.17c0.01-0.86,0-1.72,0-2.58V22.52\r\n\t\t\tC72,21.66,72,20.8,72,19.94z M52.71,46.85c0,0.91-0.01,1.74-0.2,2.65c-0.19,0.89-0.53,1.72-1.05,2.47\r\n\t\t\tc-0.52,0.75-1.19,1.36-1.97,1.82c-0.79,0.47-1.62,0.73-2.5,0.91c-1.66,0.33-2.79,0.41-3.86,0.2c-1.03-0.21-1.9-0.68-2.6-1.32\r\n\t\t\tc-1.03-0.95-1.68-2.23-1.82-3.56c-0.16-1.57,0.36-3.24,1.53-4.48c0.59-0.62,1.34-1.11,2.34-1.5c1.04-0.4,2.19-0.65,3.96-1\r\n\t\t\tc0.47-0.09,0.93-0.19,1.4-0.28c0.61-0.12,1.14-0.28,1.56-0.8c0.43-0.52,0.43-1.16,0.43-1.78V24.32c0-1.21-0.54-1.54-1.7-1.32\r\n\t\t\tc-0.83,0.16-18.62,3.75-18.62,3.75c-1,0.24-1.36,0.57-1.36,1.82v23.23c0,0.91-0.05,1.74-0.24,2.65c-0.19,0.89-0.53,1.72-1.05,2.47\r\n\t\t\tc-0.52,0.75-1.19,1.36-1.97,1.82c-0.79,0.47-1.62,0.74-2.5,0.92c-1.66,0.33-2.79,0.41-3.86,0.2c-1.03-0.21-1.9-0.69-2.6-1.33\r\n\t\t\tc-1.03-0.95-1.63-2.23-1.78-3.56c-0.16-1.57,0.31-3.24,1.49-4.48c0.59-0.62,1.34-1.11,2.34-1.5c1.04-0.4,2.19-0.65,3.96-1\r\n\t\t\tc0.47-0.09,0.93-0.19,1.4-0.28c0.61-0.12,1.14-0.28,1.56-0.8c0.42-0.52,0.47-1.13,0.47-1.75c0-4.92,0-26.78,0-26.78\r\n\t\t\tc0-0.36,0.03-0.6,0.05-0.72c0.09-0.56,0.31-1.05,0.72-1.39c0.34-0.28,0.78-0.48,1.33-0.6l0.01,0L49,11.33\r\n\t\t\tc0.19-0.04,1.73-0.31,1.91-0.33c1.16-0.1,1.81,0.66,1.81,1.89L52.71,46.85L52.71,46.85z"}));case"emby":return r.createElement("svg",{className:t,viewBox:"0 0 48 48"},r.createElement("path",{className:"icon-emby-outer",stroke:"none",d:"m9.104 12.415 2.482 2.482L0 26.484l12.414 12.414 2.483-2.483 11.586 11.586L39.725 34.76l-2.483-2.483L48 21.518 35.587 9.104l-2.483 2.483L21.517 0z"}),r.createElement("path",{className:"icon-emby-inner",stroke:"none",d:"M18.45 32.929v-18.1l15.86 9.05-7.93 4.525z"}));case"plex":return r.createElement("svg",{className:t,viewBox:"0 0 122.88 122.88"},r.createElement("path",{className:"icon-plex-outer",d:"M18.43,0h86.02c10.18,0,18.43,8.25,18.43,18.43v86.02c0,10.18-8.25,18.43-18.43,18.43H18.43 C8.25,122.88,0,114.63,0,104.45l0-86.02C0,8.25,8.25,0,18.43,0L18.43,0z"}),r.createElement("polygon",{className:"icon-plex-inner",points:"61.44,16.8 35.52,16.8 61.44,61.44 35.52,106.08 61.44,106.08 87.36,61.44 61.44,16.8"}));case"jellyfin":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("defs",null,r.createElement("linearGradient",{id:"jellyfin-linear-gradient",gradientUnits:"userSpaceOnUse",x1:"110.25",y1:"213.3",x2:"496.14",y2:"436.09"},r.createElement("stop",{offset:"0",style:{stopColor:"#aa5cc3"}}),r.createElement("stop",{offset:"1",style:{stopColor:"#00a4dc"}}))),r.createElement("path",{d:"M256,201.6c-20.4,0-86.2,119.3-76.2,139.4s142.5,19.9,152.4,0S276.5,201.6,256,201.6z"}),r.createElement("path",{d:"M256,23.3c-61.6,0-259.8,359.4-229.6,420.1s429.3,60,459.2,0S317.6,23.3,256,23.3z M406.5,390.8c-19.6,39.3-281.1,39.8-300.9,0s110.1-275.3,150.4-275.3S426.1,351.4,406.5,390.8z"}));case"spotify":return r.createElement("svg",{className:t,viewBox:"0 0 168 168"},r.createElement("path",{stroke:"none",d:"m83.996 0.277c-46.249 0-83.743 37.493-83.743 83.742 0 46.251 37.494 83.741 83.743 83.741 46.254 0 83.744-37.49 83.744-83.741 0-46.246-37.49-83.738-83.745-83.738l0.001-0.004zm38.404 120.78c-1.5 2.46-4.72 3.24-7.18 1.73-19.662-12.01-44.414-14.73-73.564-8.07-2.809 0.64-5.609-1.12-6.249-3.93-0.643-2.81 1.11-5.61 3.926-6.25 31.9-7.291 59.263-4.15 81.337 9.34 2.46 1.51 3.24 4.72 1.73 7.18zm10.25-22.805c-1.89 3.075-5.91 4.045-8.98 2.155-22.51-13.839-56.823-17.846-83.448-9.764-3.453 1.043-7.1-0.903-8.148-4.35-1.04-3.453 0.907-7.093 4.354-8.143 30.413-9.228 68.222-4.758 94.072 11.127 3.07 1.89 4.04 5.91 2.15 8.976v-0.001zm0.88-23.744c-26.99-16.031-71.52-17.505-97.289-9.684-4.138 1.255-8.514-1.081-9.768-5.219-1.254-4.14 1.08-8.513 5.221-9.771 29.581-8.98 78.756-7.245 109.83 11.202 3.73 2.209 4.95 7.016 2.74 10.733-2.2 3.722-7.02 4.949-10.73 2.739z"}));case"lastfm":return r.createElement("svg",{className:t,viewBox:"0 0 455 455"},r.createElement("rect",{className:"icon-lastfm-inner",x:"5",y:"5",width:"445",height:"445"}),r.createElement("path",{className:"icon-lastfm-outer",fillRule:"evenodd",clipRule:"evenodd",d:"M0,0v455h455V0H0z M309.94,315.01c-62.425,0-84.085-28.145-95.625-63.145 L202.77,215.77c-8.65-26.33-18.75-46.915-50.505-46.915c-22.035,0-44.395,15.88-44.395,60.275c0,34.63,17.695,56.29,42.575,56.29 c28.145,0,46.915-20.94,46.915-20.94l11.565,31.385c0,0-19.495,19.125-60.275,19.125c-50.51,0-78.65-29.57-78.65-84.435 c0-56.99,28.14-90.565,81.19-90.565c47.99,0,72.165,17.325,87.305,64.235L250.41,240.3c8.65,26.35,23.805,45.47,60.25,45.47 c24.555,0,37.52-5.41,37.52-18.77c0-10.45-6.13-18.025-24.53-22.365l-24.53-5.76c-29.94-7.225-41.855-22.735-41.855-47.265 c0-39.335,31.755-51.6,64.215-51.6c36.82,0,59.18,13.34,62.07,45.82l-36.07,4.335c-1.445-15.53-10.82-22.015-28.145-22.015 c-15.88,0-25.625,7.21-25.625,19.475c0,10.84,4.685,17.325,20.565,20.94l23.085,5.055c31.035,7.21,47.64,22.365,47.64,51.585 C385,301.295,354.685,315.01,309.94,315.01z"}));case"listenbrainz":case"musicbrainz":return r.createElement("svg",{className:t,viewBox:"0 0 27 30"},r.createElement("polygon",{className:`icon-${e}-left`,stroke:"none",points:"13 1 1 8 1 22 13 29 13 1"}),r.createElement("polygon",{className:`icon-${e}-right`,stroke:"none",points:"14 1 26 8 26 22 14 29 14 1"}));case"navidrome":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M256 10.449C120.275 10.449 10.449 120.276 10.449 256c0 135.725 109.826 245.551 245.551 245.551S501.551 391.725 501.551 256C501.551 120.276 391.725 10.449 256 10.449z"}),r.createElement("path",{fill:"#fff",d:"M256 168.229c-48.515.0-87.771 39.257-87.771 87.771s39.257 87.771 87.771 87.771 87.771-39.257 87.771-87.771S304.515 168.229 256 168.229z"}),r.createElement("path",{fill:"black",d:"M437.061 74.94C388.735 26.615 324.434.0 256 0S123.265 26.615 74.939 74.94.0 187.566.0 256s26.614 132.735 74.939 181.061S187.566 512 256 512s132.735-26.614 181.061-74.939S512 324.434 512 256 485.386 123.266 437.061 74.94zM256 491.102C126.365 491.102 20.898 385.635 20.898 256S126.365 20.898 256 20.898 491.102 126.365 491.102 256 385.635 491.102 256 491.102z"}),r.createElement("path",{fill:"black",d:"M354.22 256c0-54.158-44.061-98.22-98.22-98.22s-98.22 44.062-98.22 98.22 44.062 98.22 98.22 98.22 98.22-44.061 98.22-98.22zm-175.542.0c0-42.636 34.686-77.322 77.322-77.322s77.322 34.686 77.322 77.322S298.636 333.322 256 333.322 178.678 298.636 178.678 256z"}),r.createElement("path",{fill:"black",d:"M285.257 256c0-16.132-13.124-29.257-29.257-29.257S226.743 239.868 226.743 256s13.125 29.257 29.257 29.257S285.257 272.133 285.257 256zm-37.616.0c0-4.609 3.75-8.359 8.359-8.359 4.609.0 8.359 3.75 8.359 8.359.0 4.609-3.75 8.359-8.359 8.359C251.391 264.359 247.641 260.609 247.641 256z"}),r.createElement("path",{fill:"black",d:"M256 391.837c-5.771.0-10.449 4.678-10.449 10.449s4.678 10.449 10.449 10.449c41.897.0 81.265-16.294 110.853-45.883 29.587-29.587 45.881-68.955 45.881-110.852.0-5.771-4.678-10.449-10.449-10.449s-10.449 4.678-10.449 10.449C391.837 330.9 330.9 391.837 256 391.837z"}),r.createElement("path",{fill:"black",d:"M449.306 245.551c-5.771.0-10.449 4.678-10.449 10.449.0 1.481-.018 2.958-.052 4.43-.136 5.769 4.43 10.557 10.199 10.692.085.002.168.003.252.003 5.656.0 10.307-4.517 10.442-10.202.039-1.637.059-3.279.059-4.925C459.755 250.229 455.077 245.551 449.306 245.551z"}),r.createElement("path",{fill:"black",d:"M447.55 284.239c-5.656-1.145-11.168 2.52-12.308 8.178-17.107 84.854-92.489 146.44-179.242 146.44-5.771.0-10.449 4.678-10.449 10.449s4.678 10.449 10.449 10.449c47.353.0 93.467-16.573 129.847-46.668 35.9-29.697 60.717-71.084 69.881-116.54C456.868 290.891 453.207 285.38 447.55 284.239z"}),r.createElement("path",{fill:"black",d:"M256 120.163c5.771.0 10.449-4.678 10.449-10.449S261.771 99.265 256 99.265c-41.897.0-81.265 16.294-110.853 45.883C115.559 174.735 99.265 214.103 99.265 256c0 5.771 4.678 10.449 10.449 10.449s10.449-4.678 10.449-10.449c0-74.9 60.937-135.837 135.837-135.837z"}),r.createElement("path",{fill:"black",d:"M62.996 240.876c-5.759-.14-10.557 4.43-10.692 10.199-.039 1.637-.059 3.279-.059 4.925.0 5.771 4.678 10.449 10.449 10.449S73.143 261.771 73.143 256c0-1.481.018-2.958.052-4.43C73.331 245.8 68.765 241.013 62.996 240.876z"}),r.createElement("path",{fill:"black",d:"M256 73.143c5.771.0 10.449-4.678 10.449-10.449S261.771 52.245 256 52.245c-47.353.0-93.467 16.573-129.847 46.668-35.9 29.697-60.717 71.084-69.881 116.54-1.14 5.657 2.521 11.168 8.178 12.308.697.141 1.392.208 2.076.208 4.872.0 9.232-3.426 10.232-8.386C93.864 134.729 169.247 73.143 256 73.143z"}));case"subsonic":return r.createElement("svg",{className:t,viewBox:"0 0 700 700",transform:"scale(1.125) translate(0 -1)"},r.createElement("path",{d:"M202 108.1c-7 1.1-8.5 1.6-12.3 4.1-2.7 1.7-3.6 3.1-3.9 5.7-.5 3.8-.1 54.1.6 75.1.2 7.4.5 19.3.6 26.4l.2 12.8-5.8 6-5.9 5.9.2 26.8.2 26.8-20.7 10-20.7 10-5-1.9c-8.5-3.4-21.9-6.6-30.1-7.3-4.4-.4-8.2-.9-8.5-1.1-1.4-.8-1.8 2.8-1.9 16.7-.2 15.1-.2 15.7-1.4 22.9-1.1 5.9-19.2 61.8-21.1 64.6-.7 1.1-4 3.1-7.2 4.3-14.4 5.6-18.6 7.5-21.3 10.1-1.9 1.8-2.8 3.4-2.4 4.4.3.9 5.2 4.2 10.8 7.3 15.6 8.7 17.2 10.2 19.7 18.6 5.3 18.1 9.5 26.3 18.9 37.2 3.3 3.8 6 7.2 6 7.5-.1.3-4 5.5-8.8 11.7-12.8 16.4-17.5 26.8-15.8 35.5 2.9 15.5 33.8 17.4 61.6 3.8 3-1.5 8.6-4.4 12.3-6.5 8.2-4.5 10.7-4.5 26.7.9 15.8 5.2 42 13 55.5 16.5 12.7 3.3 48 11.6 53.3 12.6 1.8.3 7.6 1.4 12.9 2.4 5.4 1.1 11.8 2.2 14.3 2.6 2.5.3 5.2.8 6 1 .8.3 4.7.9 8.5 1.5 3.9.5 7.9 1.1 9 1.4 2.2.4 12.8 1.8 16 2.1 1.1.1 4.7.5 8 .9s8 .9 10.5 1.2c2.5.2 6.5.6 9 .8 26.9 3 67.6 3.5 94.5 1.1 5.6-.5 7.7-.8 18-1.9 33.3-3.9 71.6-15.5 96.4-29.3 29.7-16.4 55.6-43.4 71.2-74 5.5-11 10.6-25.6 11.4-33.3.2-1.4.6-5.1 1-8.3l.8-5.7-9.9.5c-15.4.8-22.7 1.6-30.4 3-8.1 1.5-18.5 3.9-28 6.5-18.5 4.9-45.6 11.8-48.6 12.4-25.6 4.6-31 5.4-49.9 7.1-33.9 3-91.7 2.2-110.2-1.6-5.7-1.1-7.1-2.8-2.5-3 1.5 0 6.3-.2 10.7-.4 4.4-.2 19.3-.6 33-1 13.8-.3 26.8-.7 29-.9 2.2-.2 8-.7 12.9-1.1 4.9-.4 9.7-.8 10.6-1 .9-.2 4.1-.6 7.1-1 25.9-3.2 56.5-10.2 86.5-19.9 27.8-8.9 29.5-9.4 42.4-12 11.9-2.4 28.3-2.8 42.9-1.1l6.4.7-.7-3.3c-5.5-26.1-11.7-40.2-24.9-56.6-8.1-10.2-23-25.1-33.7-33.6-7.6-6.1-24.8-17.9-40.6-27.7-3.6-2.2-6.3-4.8-7.5-7.2-2.9-5.6-4.6-6.1-18.1-5.5-6.5.4-12.2.8-12.6 1.1-.4.2-3.9.7-7.9 1-4 .4-7.8.8-8.5 1.1-.7.2-3.1.6-5.3.9-9.3 1.2-39 5.7-46.5 7.1-1.4.2-5 .7-8 1.1-3 .3-6.6.7-8 .9-12.7 1.8-124.9 2.7-145 1.2-4.1-.3-8.6-.6-10-.6-4.3-.2-.8-1.9 5-2.6 3-.3 7.3-.8 9.5-1 2.2-.2 8.1-.7 13-1 5-.4 11.5-.8 14.5-1 3-.2 10.2-.7 16-1 5.8-.3 12.6-.8 15.2-1 2.5-.2 9-.6 14.5-1 5.4-.3 11.4-.8 13.3-.9 2-.2 7.6-.7 12.5-1.1 4.9-.4 9.6-.8 10.4-1 .9-.1 4.3-.6 7.6-.9 8.5-1 11.9-1.5 21.5-3.3 4.7-.8 9.6-1.7 10.9-2 1.4-.2 2.8-.6 3.1-.8.4-.2 2.1-.7 3.9-1 3.5-.6 17.4-5.2 25.6-8.4l5-1.9-.3-15.4c-.2-8.4-.5-15.4-.7-15.6-.1-.2-4-1.2-8.6-2.3-4.6-1.1-9.1-2.2-9.9-2.4-28.8-7-45.7-10.2-53-9.9-6.2.1-11.3.9-32.1 4.9-.9.2-4 .6-6.9 1-2.9.4-6.2.9-7.4 1.1-12.1 2.3-54.6 2.2-66.8-.1-1.3-.3-4.5-.9-7.3-1.4-6-1.1-10.1-2.6-10.9-4-1.2-1.9-1.3-1.9 28.4-3.6 4.7-.3 11.9-.7 16-1 4.1-.3 11.8-.7 17-1 9.9-.6 17.6-1.2 24.5-2 2.2-.3 6-.7 8.5-.9 6.9-.8 14.4-2.4 18.1-3.9l3.3-1.3-4.8-3.6c-5.2-4-13-6.9-24.6-9.2-7-1.4-9.5-1.7-22.5-3.2-24.4-2.8-62.6-1.6-81.7 2.6-10.8 2.3-15.4 4.7-22.9 11.6-3.2 3-6.5 5.4-7.3 5.4-1 0-1.7-3-2.6-11.3-.7-6.1-1.4-12.3-1.5-13.7-.2-1.4-.6-6.1-.9-10.5-.4-4.4-.8-9.6-1.1-11.5-.2-1.9-.7-6.7-1-10.5-.8-10.5-2.1-24.4-3.1-32.5-2.1-18.3-2.6-19.4-9.6-21.4-7.1-2-10.5-2.3-15.8-1.5zm-82.2 305.3c6.5 4 7.5 42.2 1.5 54.3-2.7 5.4-4.5 6.1-8.1 3.2-6.2-5-6.6-6.7-6.8-26.2-.2-21.4.4-25.1 5.1-29.4 3.3-3.2 5.5-3.7 8.3-1.9zm75.2 3.1c7.6 3.9 12.1 14.6 12.5 29.5.6 19.9-4.7 34.4-13.7 37.9-2.1.8-3.5.5-7-1.2-8.2-4.2-12.1-13.8-12.2-30.7-.1-13.6 1.2-20.2 5.8-27.9 2.3-4.1 3.2-5 6.6-7.4 3-2.1 4.3-2.1 8-.2zm106.7 1.7c14 7 21.7 24.1 20.9 46.8-.3 8.1-1 12.3-3 18.4-4.9 14.4-11.3 20.8-22 22-10.9 1.3-20.2-7.4-25.9-24.4-7.9-23.4.8-54.6 17.5-62.9 5.4-2.6 7-2.6 12.5.1z"}));case"youtube":return r.createElement("svg",{className:t,viewBox:"0 0 576 512",transform:"scale(1.125)"},r.createElement("rect",{className:"icon-youtube-inner",x:"144",y:"128",width:"288",height:"256"}),r.createElement("path",{className:"icon-youtube-outer",d:"M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"}));case"lookup-pending":return r.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 16 16"},r.createElement("title",null,"Lookup scheduled"),r.createElement("circle",{className:"icon-lookup-outer",cx:"8",cy:"8",r:"8",stroke:"none"}),r.createElement("path",{className:"icon-lookup-inner",d:"M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"}));case"lookup-looking":return r.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 100 100"},r.createElement("title",null,"Searching..."),r.createElement("circle",{className:"icon-lookup-outer",cx:"50",cy:"50",r:"50",stroke:"none"}),r.createElement("path",{className:"icon-lookup-inner",d:"M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50"},r.createElement("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"1s",from:"0 50 50",to:"360 50 50",repeatCount:"indefinite"})));case"lookup-not-found":return r.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 16 16",transform:"rotate(45)"},r.createElement("title",null,"Not found"),r.createElement("circle",{className:"icon-lookup-outer",cx:"8",cy:"8",r:"8",stroke:"none"}),r.createElement("path",{className:"icon-lookup-inner",d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}));case"error":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("circle",{cx:"12",cy:"12",r:"11"}),r.createElement("circle",{cx:"12",cy:"12",r:"6",stroke:"none",fill:"white"}),r.createElement("path",{stroke:"none",d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"}))}}It.style.cssText="\n    position: absolute;\n    pointer-events: none;\n    visibility: hidden;\n    font-size: 1rem;\n    width: 1rem;\n    height: 1rem;\n    z-index: -1;\n";var zt=n(3121);const jt={left:0,top:0},Lt=(0,r.forwardRef)((function(e,t){var{title:n,className:i="",children:a,onClose:s}=e,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["title","className","children","onClose"]);const l=(0,r.useRef)(null),[c,u]=(0,r.useState)(jt),[d,m]=(0,r.useState)(null),[h,f]=(0,r.useState)(jt);(0,r.useImperativeHandle)(t,(()=>({close:e=>{var t;(null===(t=l.current)||void 0===t?void 0:t.open)&&l.current.close(e)}}))),(0,r.useEffect)((()=>{const e=l.current;zt.Z.registerDialog(e),e.showModal()}),[]);const p=(0,r.useCallback)((()=>{l.current.close()}),[]),v=(0,r.useCallback)((()=>{s(l.current.returnValue)}),[s]),b=(0,r.useCallback)((e=>{"Escape"===e.key&&(e.preventDefault(),e.stopPropagation(),l.current.close())}),[]),y=(0,r.useCallback)((e=>{let t=e.target;for(;t&&"BUTTON"!==t.nodeName;)t=t.parentElement;"#cancel"===(null==t?void 0:t.value)&&(e.preventDefault(),l.current.close())}),[]),w=(0,r.useCallback)((e=>{e.preventDefault(),0===e.button&&m({left:e.screenX,top:e.screenY})}),[]),E=(0,r.useCallback)((e=>{f({left:e.screenX-d.left,top:e.screenY-d.top})}),[d]),k=(0,r.useCallback)((e=>{u({left:c.left+(e.screenX-d.left),top:c.top+(e.screenY-d.top)}),f(jt),m(null)}),[c,d]);return(0,r.useEffect)((()=>{if(d)return document.documentElement.style.cursor="default",document.body.classList.add("dragging"),document.addEventListener("mouseup",k),document.addEventListener("mousemove",E),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",k),document.removeEventListener("mousemove",E)}}),[d,E,k]),r.createElement("dialog",Object.assign({},o,{className:`dialog ${i}`,onClose:v,onKeyDown:b,style:{transform:`translate(${c.left+h.left}px, ${c.top+h.top}px)`},ref:l}),r.createElement("header",{className:"dialog-head",onMouseDown:w},r.createElement("h2",null,n),r.createElement("div",{className:"dialog-close",role:"button",onClick:p,onMouseDown:g,"aria-label":"Close"},r.createElement($t,{name:"close"}))),r.createElement("div",{className:"dialog-body",onClick:y},a))}));var Rt=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function Dt(e,t=!1){return Rt(this,void 0,void 0,(function*(){return new Promise(((n,a)=>{const s=document.createElement("div"),o=(0,i.s)(s);try{const i=e=>{o.unmount(),s.remove(),n(e)};document.getElementById(t?"system":"popup").append(s),o.render(r.createElement(e,{onClose:i}))}catch(e){o.unmount(),s.remove(),a(e)}}))}))}var Ft=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function _t({title:e,message:t,system:n=!1}){return i=this,a=void 0,o=function*(){"string"==typeof t&&(t=r.createElement("p",null,t)),yield Dt((n=>r.createElement(Ut,Object.assign({},n,{title:e,message:t}))),n)},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{l(o.next(e))}catch(e){t(e)}}function r(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof s?e:new s((function(t){t(e)}))}(t.value).then(n,r)}l((o=o.apply(i,a||[])).next())}));var i,a,s,o}function Ut(e){var{message:t,title:n="Message"}=e,i=Ft(e,["message","title"]);return r.createElement(Lt,Object.assign({},i,{className:"alert-dialog",title:n}),r.createElement("form",{method:"dialog"},r.createElement("div",{className:"alert-message"},t),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",null,"OK"))))}function Vt({value:e="",submitText:t="Confirm",onCancel:n,onSubmit:i}){return r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{className:"dialog-button-cancel",type:"button",value:"#cancel",onClick:n},"Cancel"),r.createElement("button",{className:"dialog-button-submit",value:e,onClick:i},t))}var Bt=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},Ht=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Yt=new D("confirm");function Kt({title:e,message:t,okLabel:n,storageId:i,system:a=!1}){return Bt(this,void 0,void 0,(function*(){return!(!i||!Yt.getBoolean(i))||("string"==typeof t&&(t=r.createElement("p",null,t)),"confirmed"===(yield Dt((a=>r.createElement(Wt,Object.assign({},a,{title:e,message:t,okLabel:n,storageId:i}))),a)))}))}function Wt(e){var{title:t="Confirm",message:n,okLabel:i="OK",storageId:a}=e,s=Ht(e,["title","message","okLabel","storageId"]);const o=(0,r.useId)(),l=(0,r.useRef)(null),c=(0,r.useCallback)((()=>{a&&l.current.checked&&Yt.setBoolean(a,!0)}),[a]);return r.createElement(Lt,Object.assign({},s,{className:"confirm-dialog",title:t}),r.createElement("form",{method:"dialog",onSubmit:c},r.createElement("div",{className:"confirm-message"},n),r.createElement(Vt,{value:"confirmed",submitText:i}),a?r.createElement("footer",{className:"confirm-dialog-storage"},r.createElement("input",{id:o,type:"checkbox",ref:l}),r.createElement("label",{htmlFor:o},"Don't show this message again.")):null))}var qt=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Gt(e){var t,n,i,a,{system:s=!1}=e,o=qt(e,["system"]);return t=this,n=void 0,a=function*(){return Dt((e=>r.createElement(Jt,Object.assign({},e,o))),s)},new((i=void 0)||(i=Promise))((function(e,r){function s(e){try{l(a.next(e))}catch(e){r(e)}}function o(e){try{l(a.throw(e))}catch(e){r(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(t,n||[])).next())}))}function Jt(e){var{title:t="Input",label:n,suggestedValue:i="",okLabel:a="OK"}=e,s=qt(e,["title","label","suggestedValue","okLabel"]);const o=(0,r.useId)(),[l,c]=(0,r.useState)(i),u=(0,r.useCallback)((e=>{c(e.target.value)}),[]);return r.createElement(Lt,Object.assign({},s,{className:"prompt-dialog",title:t}),r.createElement("form",{method:"dialog"},n?r.createElement("p",{className:"prompt-message"},r.createElement("label",{htmlFor:o},n,": ")):null,r.createElement("p",null,r.createElement("input",{type:"text",id:o,defaultValue:i,autoFocus:!0,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",onChange:u})),r.createElement(Vt,{value:l,submitText:a})))}var Qt=function(e){function t(t,n){return e.call(this)||this}return J(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(se),Xt={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=Xt.delegate;return(null==i?void 0:i.setInterval)?i.setInterval.apply(i,ee([e,t],Z(n))):setInterval.apply(void 0,ee([e,t],Z(n)))},clearInterval:function(e){var t=Xt.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},Zt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return J(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),Xt.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&Xt.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,ae(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(Qt),en={now:function(){return(en.delegate||Date).now()},delegate:void 0},tn=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=en.now,e}(),nn=new(function(e){function t(t,n){void 0===n&&(n=tn.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return J(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(tn))(Zt),rn=nn;function an(e){return e&&ne(e.schedule)}function sn(e,t,n){void 0===e&&(e=0),void 0===n&&(n=rn);var r=-1;return null!=t&&(an(t)?n=t:r=t),new Ie((function(t){var i=function(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;i<0&&(i=0);var a=0;return n.schedule((function(){t.closed||(t.next(a++),0<=r?this.schedule(void 0,r):t.complete())}),i)}))}function on(e,t){return void 0===e&&(e=0),void 0===t&&(t=nn),e<0&&(e=0),sn(e,e,t)}function ln({children:e}){return r.createElement(r.Fragment,null,e)}var cn=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function un(e){return ne(null==e?void 0:e.then)}function dn(e){return ne(e[Ae])}function mn(e){return Symbol.asyncIterator&&ne(null==e?void 0:e[Symbol.asyncIterator])}function hn(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var fn="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function pn(e){return ne(null==e?void 0:e[fn])}function vn(e){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),a=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){a.push([e,t,n,r])>1||o(e,t)}))})}function o(e,t){try{(n=i[e](t)).value instanceof te?Promise.resolve(n.value.v).then(l,c):u(a[0][2],n)}catch(e){u(a[0][3],e)}var n}function l(e){o("next",e)}function c(e){o("throw",e)}function u(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}(this,arguments,(function(){var t,n,r;return Q(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,te(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,te(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,te(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function bn(e){return ne(null==e?void 0:e.getReader)}function yn(e){if(e instanceof Ie)return e;if(null!=e){if(dn(e))return i=e,new Ie((function(e){var t=i[Ae]();if(ne(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(cn(e))return t=e,new Ie((function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()}));if(un(e))return r=e,new Ie((function(e){r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,me)}));if(mn(e))return gn(e);if(pn(e))return n=e,new Ie((function(e){var t,r;try{for(var i=X(n),a=i.next();!a.done;a=i.next()){var s=a.value;if(e.next(s),e.closed)return}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()}));if(bn(e))return gn(vn(e))}var t,n,r,i;throw hn(e)}function gn(e){return new Ie((function(t){(function(e,t){var n,r,i,a,s,o,l,c;return s=this,o=void 0,c=function(){var s,o;return Q(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=X(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,i,(t=e[n](t)).done,t.value)}))}}}(e),l.label=1;case 1:return[4,n.next()];case 2:if((r=l.sent()).done)return[3,4];if(s=r.value,t.next(s),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return o=l.sent(),i={error:o},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(a=n.return)?[4,a.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))},new((l=void 0)||(l=Promise))((function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(n,r)}i((c=c.apply(s,o||[])).next())}))})(e,t).catch((function(e){return t.error(e)}))}))}function wn(e,t){return ze((function(n,r){var i=0;n.subscribe(je(r,(function(n){r.next(e.call(t,n,i++))})))}))}function En(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var a=t.schedule((function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(a),!i)return a}function kn(e,t,n){return void 0===n&&(n=1/0),ne(t)?kn((function(n,r){return wn((function(e,i){return t(n,e,r,i)}))(yn(e(n,r)))}),n):("number"==typeof t&&(n=t),ze((function(t,r){return function(e,t,n,r,i,a,s,o){var l=[],c=0,u=0,d=!1,m=function(){!d||l.length||c||t.complete()},h=function(e){return c<r?f(e):l.push(e)},f=function(e){c++;var i=!1;yn(n(e,u++)).subscribe(je(t,(function(e){t.next(e)}),(function(){i=!0}),void 0,(function(){if(i)try{c--;for(;l.length&&c<r;)e=void 0,e=l.shift(),f(e);m()}catch(e){t.error(e)}var e})))};return e.subscribe(je(t,h,(function(){d=!0,m()}))),function(){}}(t,r,e,n)})))}var xn=Array.isArray;function Sn(e){return wn((function(t){return function(e,t){return xn(t)?e.apply(void 0,ee([],Z(t))):e(t)}(e,t)}))}var Tn=["addListener","removeListener"],An=["addEventListener","removeEventListener"],Pn=["on","off"];function In(e,t,n,r){if(ne(n)&&(r=n,n=void 0),r)return In(e,t,n).pipe(Sn(r));var i=Z(function(e){return ne(e.addEventListener)&&ne(e.removeEventListener)}(e)?An.map((function(r){return function(i){return e[r](t,i,n)}})):function(e){return ne(e.addListener)&&ne(e.removeListener)}(e)?Tn.map(Cn(e,t)):function(e){return ne(e.on)&&ne(e.off)}(e)?Pn.map(Cn(e,t)):[],2),a=i[0],s=i[1];if(!a&&cn(e))return kn((function(e){return In(e,t,n)}))(yn(e));if(!a)throw new TypeError("Invalid event target");return new Ie((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return a(t),function(){return s(t)}}))}function Cn(e,t){return function(n){return function(r){return e[n](t,r)}}}function Mn(e){return void 0===e&&(e=1/0),kn(Pe,e)}function On(e){return e[e.length-1]}function Nn(e){return ne(On(e))?e.pop():void 0}function $n(e){return an(On(e))?e.pop():void 0}function zn(e,t){return void 0===t&&(t=0),ze((function(n,r){n.subscribe(je(r,(function(n){return En(r,e,(function(){return r.next(n)}),t)}),(function(){return En(r,e,(function(){return r.complete()}),t)}),(function(n){return En(r,e,(function(){return r.error(n)}),t)})))}))}function jn(e,t){return void 0===t&&(t=0),ze((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function Ln(e,t){if(!e)throw new Error("Iterable cannot be null");return new Ie((function(n){En(n,t,(function(){var r=e[Symbol.asyncIterator]();En(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function Rn(e,t){return t?function(e,t){if(null!=e){if(dn(e))return function(e,t){return yn(e).pipe(jn(t),zn(t))}(e,t);if(cn(e))return function(e,t){return new Ie((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(un(e))return function(e,t){return yn(e).pipe(jn(t),zn(t))}(e,t);if(mn(e))return Ln(e,t);if(pn(e))return function(e,t){return new Ie((function(n){var r;return En(n,t,(function(){r=e[fn](),En(n,t,(function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(e){return void n.error(e)}i?n.complete():n.next(t)}),0,!0)})),function(){return ne(null==r?void 0:r.return)&&r.return()}}))}(e,t);if(bn(e))return function(e,t){return Ln(vn(e),t)}(e,t)}throw hn(e)}(e,t):yn(e)}function Dn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Mn(1)(Rn(e,$n(e)))}var Fn=new Ie((function(e){return e.complete()}));function _n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=$n(e),r=function(e,t){return"number"==typeof On(e)?e.pop():1/0}(e),i=e;return i.length?1===i.length?yn(i[0]):Mn(r)(Rn(i,n)):Fn}function Un(e,t){return ze((function(n,r){var i=null,a=0,s=!1,o=function(){return s&&!i&&r.complete()};n.subscribe(je(r,(function(n){null==i||i.unsubscribe();var s=0,l=a++;yn(e(n,l)).subscribe(i=je(r,(function(e){return r.next(t?t(n,e,l,s++):e)}),(function(){i=null,o()})))}),(function(){s=!0,o()})))}))}function Vn(e){return ze((function(t,n){yn(e).subscribe(je(n,(function(){return n.complete()}),he)),!n.closed&&t.subscribe(n)}))}function Bn(e,t){switch(t.type){case"resize":{const n=Math.max(t.clientSize,0),r=Math.max(t.scrollSize,n);if(n!==e.clientSize||r!==e.scrollSize){const t=r-n,i=Hn(e.position,t);return Object.assign(Object.assign({},e),{position:i,max:t,clientSize:n,scrollSize:r})}return e}case"scrollBy":{const n=Hn(e.position+t.amount,e.max);return n!==e.position?Object.assign(Object.assign({},e),{position:n}):e}case"scrollTo":{const n=Hn(t.position,e.max);return n!==e.position?Object.assign(Object.assign({},e),{position:n}):e}default:return e}}function Hn(e,t){return Math.min(Math.max(e,0),t)}const Yn={position:0,max:0,clientSize:0,scrollSize:0};const Kn=(0,r.memo)((function(e){var{scrollableId:t,orientation:n,scrollAmount:i,onChange:a,onResize:s,scrollbarRef:o}=e,l=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["scrollableId","orientation","scrollAmount","onChange","onResize","scrollbarRef"]);const c=(0,r.useRef)(null),u=(0,r.useRef)(null),{position:d,max:m,clientSize:h,scrollSize:f,resize:p,scrollBy:v,scrollTo:b}=function(){const[{position:e,max:t,clientSize:n,scrollSize:i},a]=(0,r.useReducer)(Bn,Yn),s=(0,r.useCallback)(((e,t)=>a({type:"resize",clientSize:e,scrollSize:t})),[]),o=(0,r.useCallback)((e=>a({type:"scrollTo",position:e})),[]);return{position:e,max:t,clientSize:n,scrollSize:i,scrollTo:o,scrollBy:(0,r.useCallback)((e=>a({type:"scrollBy",amount:e})),[]),resize:s}}(),[y,g]=(0,r.useState)(0),[E,k]=(0,r.useState)(0),[x,S]=(0,r.useState)(0),[T,A]=(0,r.useState)(-1),[P,I]=(0,r.useState)(0),C=-1!==T,M="vertical"===n,O=Math.ceil(d/m*(E-x));(0,r.useEffect)((()=>{o.current={scrollBy:v,scrollTo:b}}),[o,v,b]),(0,r.useEffect)((()=>p(l.clientSize,l.scrollSize)),[l.clientSize,l.scrollSize,p]),(0,r.useEffect)((()=>null==a?void 0:a(d)),[d,a]),(0,r.useEffect)((()=>null==s?void 0:s(y)),[y,s]),Pt(c,(()=>{const e=c.current.getBoundingClientRect();k(M?e.height:e.width),g(M?e.width:e.height)})),Pt(u,(()=>{const e=u.current.getBoundingClientRect();S(M?e.height:e.width)}));const N=(0,r.useCallback)(((e,t)=>{const n=()=>o.current.scrollBy(t),r=t=>t.target===e,i=In(document,"mouseup"),a=In(e,"mouseover").pipe(wn(r),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=$n(e);return ze((function(t,r){(n?Dn(e,t,n):Dn(e,t)).subscribe(r)}))}(!0)),s=_n(a,In(e,"mouseout").pipe(De(r),wn((()=>!1)))).pipe(Un(((e,t)=>e?sn(0===t?400:0,40):Fn)),Vn(i)).subscribe(n);return n(),()=>s.unsubscribe()}),[o]),$=(0,r.useCallback)((e=>{if(0===e.button)return N(e.target,-i)}),[i,N]),z=(0,r.useCallback)((e=>{if(0===e.button)return N(e.target,i)}),[i,N]),j=(0,r.useCallback)((e=>{if(0===e.button){const t=M?e.nativeEvent.offsetY:e.nativeEvent.offsetX;return N(e.target,t<O?-h:h)}}),[M,h,O,N]),L=(0,r.useCallback)((e=>{e.stopPropagation(),0===e.button&&(A(M?e.screenY:e.screenX),I(O))}),[M,O]),R=(0,r.useCallback)((e=>{const t=M?e.screenY:e.screenX;b((P+(t-T))*m/(E-x))}),[M,T,P,m,x,E,b]),D=(0,r.useCallback)((()=>{A(-1),I(0)}),[]);return(0,r.useEffect)((()=>{if(C)return document.body.classList.add("dragging"),document.addEventListener("mouseup",D),document.addEventListener("mousemove",R),()=>{document.body.classList.remove("dragging"),document.removeEventListener("mouseup",D),document.removeEventListener("mousemove",R)}}),[C,R,D]),r.createElement("div",{className:`scrollbar scrollbar-${n}`,role:"scrollbar","aria-controls":t,"aria-orientation":n,"aria-valuenow":Number((100*d/m).toFixed(1)),"aria-valuemin":0,"aria-valuemax":100,onContextMenu:w,onMouseDown:w},r.createElement("div",{className:"scrollbar-button scrollbar-button-decrement",onMouseDown:$},r.createElement("svg",{className:"icon",viewBox:"0 0 50 50"},r.createElement("polygon",{points:M?"0,50 25,0 50,50":"50,0 0,25 50,50"}))),r.createElement("div",{className:"scrollbar-track",onMouseDown:j,ref:c},r.createElement("div",{className:"scrollbar-thumb",onMouseDown:L,style:{[M?"height":"width"]:E*(f?h/f:0)+"px",transform:`translate${M?"Y":"X"}(${O}px)`},ref:u})),r.createElement("div",{className:"scrollbar-button scrollbar-button-increment",onMouseDown:z},r.createElement("svg",{className:"icon",viewBox:"0 0 50 50"},r.createElement("polygon",{points:M?"0,0 25,50 50,0":"0,0 50,25 0,50"}))))}));function Wn({children:e,scrollWidth:t=0,scrollHeight:n=0,scrollAmount:i=10,droppable:a,onResize:s,onScroll:o,scrollableRef:l}){const c=(0,r.useId)(),u=(0,r.useRef)(null),m=(0,r.useRef)(null),h=(0,r.useRef)(null),f=(0,r.useRef)(null),p=(0,r.useRef)(null),v=(0,r.useRef)(null),[b,y]=(0,r.useState)(0),[g,w]=(0,r.useState)(0),[E,k]=(0,r.useState)(0),[x,S]=(0,r.useState)(0),[T,A]=(0,r.useState)(0),[P,I]=(0,r.useState)(t),[C,M]=(0,r.useState)(n),[O,N]=(0,r.useState)(0),[$,z]=(0,r.useState)(0),[j,L]=(0,r.useState)(!1),[R,D]=(0,r.useState)(!1),[F,_]=(0,r.useState)(0),U=Math.max(O-(R?g:0),0),V=Math.max($-(j?b:0),0),[B,H]=(0,r.useState)(!0);(0,r.useEffect)((()=>{if(j||R){const e=setTimeout((()=>H(!1)),50);return()=>clearTimeout(e)}}),[j,R]),(0,r.useEffect)((()=>{l&&(l.current={scrollTo:({left:e,top:t})=>{void 0!==e&&p.current.scrollTo(e),void 0!==t&&v.current.scrollTo(t)}})}),[l]),(0,r.useEffect)((()=>{L(!(!P||!U)&&P-U>1)}),[P,U]),(0,r.useEffect)((()=>{D(!(!C||!V)&&C-V>1)}),[C,V]),(0,r.useEffect)((()=>{var e;I(0===t?(null===(e=m.current)||void 0===e?void 0:e.scrollWidth)||0:t)}),[t]),(0,r.useEffect)((()=>{var e;M(0===n?(null===(e=m.current)||void 0===e?void 0:e.scrollHeight)||0:n)}),[n]);const Y=(0,r.useCallback)((()=>{const e=u.current;N(e.clientWidth),z(e.clientHeight),k(e.getBoundingClientRect().top)}),[]),K=(0,r.useCallback)((()=>{var e;const r=m.current,i=f.current;0===t&&I(r.scrollWidth),0===n&&M(i.scrollHeight+((null===(e=h.current)||void 0===e?void 0:e.clientHeight)||0));const{clientWidth:a,clientHeight:o}=r,{scrollWidth:l,scrollHeight:c}=i;null==s||s({clientWidth:a,clientHeight:o,scrollWidth:l,scrollHeight:c})}),[t,n,s]);Pt(u,Y),Pt(m,K),Pt(f,K),(0,r.useEffect)((()=>{null==o||o({left:x,top:T})}),[x,T,o]);const W=(0,r.useCallback)((e=>{v.current.scrollBy(3*i*Math.sign(e.deltaY))}),[i]),q=(0,r.useCallback)((e=>{const t=e.nativeEvent.clientY-E;t+i/2>$?_(i):t<i&&_(-i)}),[E,$,i]);(0,r.useEffect)((()=>{if(F){const e=()=>v.current.scrollBy(F),t=on(100).subscribe(e);return()=>t.unsubscribe()}}),[F]);const G=(0,r.useCallback)((()=>_(0)),[]),[J,Q]=d(r.Children.toArray(e),(e=>(null==e?void 0:e.type)===ln));return r.createElement("div",{className:`scrollable ${j?"overflow-x":""} ${R?"overflow-y":""} ${B?"scrollbars-hidden":""}`,id:c,onWheel:W,ref:u},r.createElement("div",{className:"scrollable-content",onDragOver:a?q:void 0,onDragLeave:a?G:void 0,onDragEnd:a?G:void 0,onDrop:a?G:void 0,style:{right:R?`${g}px`:"0",bottom:j?`${b}px`:"0",transform:`translateX(-${x}px)`},ref:m},J?r.createElement("div",{className:"scrollable-head",ref:h},J):null,r.createElement("div",{className:"scrollable-body",style:{width:t?`${t}px`:void 0}},r.createElement("div",{className:"scrollable-body-content",style:{transform:`translateY(-${T}px)`},ref:f},Q))),r.createElement(Kn,{scrollableId:c,orientation:"horizontal",clientSize:U,scrollSize:P,scrollAmount:i,onChange:S,onResize:y,scrollbarRef:p}),r.createElement(Kn,{scrollableId:c,orientation:"vertical",clientSize:V,scrollSize:C,scrollAmount:i,onChange:A,onResize:w,scrollbarRef:v}))}function qn(e){return ze((function(t,n){var r=!1,i=null,a=null,s=function(){if(null==a||a.unsubscribe(),a=null,r){r=!1;var e=i;i=null,n.next(e)}};t.subscribe(je(n,(function(t){null==a||a.unsubscribe(),r=!0,i=t,a=je(n,s,he),yn(e(t)).subscribe(a)}),(function(){s(),n.complete()}),void 0,(function(){i=a=null})))}))}function Gn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Rn(e,$n(e))}function Jn(e,t=200){const[n,i]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const n=t=>!e||e.includes(t.code),r=(e,t)=>In(document,e,{capture:!0}).pipe(De(n),wn((()=>t))),a=_n(r("keydown",!0),r("keyup",!1)).pipe(qn((e=>e?Gn(0):sn(t)))).subscribe(i);return()=>a.unsubscribe()}),[e,t]),n}function Qn(e){return{storeExpandedState:(0,r.useCallback)(((t,n)=>{e&&localStorage.setItem(`${e}/${t}`,String(!!n))}),[e]),retrieveExpandedState:(0,r.useCallback)(((t,n=!1)=>{if(e){const r=localStorage.getItem(`${e}/${t}`);return"string"==typeof r?"true"===r:n}return n}),[e]),storeSelectedNodeId:(0,r.useCallback)((t=>{e&&localStorage.setItem(`${e}/selectedId`,t)}),[e]),retrieveSelectedNodeId:(0,r.useCallback)((t=>e&&localStorage.getItem(`${e}/selectedId`)||t),[e])}}function Xn(e,t){return e.reduce(((e,n)=>(t(n.id,n.startExpanded)&&e.push(n.id),n.children?e.concat(Xn(n.children,t)):e)),[])}function Zn(e,t){return(0,r.useMemo)((()=>er(e,t)),[e,t])}function er(e,t){return e.reduce(((e,n)=>(e.push(n.id),n.children&&t.includes(n.id)?e.concat(er(n.children,t)):e)),[])}var tr=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function nr({id:e,label:t,children:n=[],selectedId:i,expandedIds:a,level:s,rowHeight:o,nodeIndex:l,setSize:c,emptyMarker:u,onSelect:d,onToggle:m}){const h=a.includes(e),f=0!==n.length,p=e===i,v=`${f?"expandable":""} ${h?"expanded":""} ${p?"selected":""} ${0===n.length?"empty":""}`,b=(0,r.useCallback)((e=>{e.stopPropagation()}),[]),y=(0,r.useCallback)((t=>{t.stopPropagation(),null==d||d(e)}),[e,d]),g=(0,r.useCallback)((t=>{t.stopPropagation(),null==m||m(e)}),[e,m]),w=(0,r.useCallback)((t=>{t.stopPropagation(),null==m||m(e),h&&or(n,i)&&(null==d||d(e))}),[e,i,h,n,d,m]);return r.createElement("li",{className:`tree-view-node ${v}`,id:`tree-view-node-${e}`,role:"treeitem","aria-selected":p?"true":void 0,"aria-expanded":h?"true":void 0,"aria-labelledby":`tree-view-node-label-${e}`,"aria-level":s,"aria-setsize":c,"aria-posinset":l+1,onMouseDown:y},r.createElement("span",{className:"tree-view-row "+(p?"selected-text":""),onDoubleClick:f?g:void 0,style:{height:`${o}px`}},f?r.createElement("svg",{className:"tree-view-node-marker",viewBox:`0 0 ${h?320:256} 512`,onMouseDown:b,onClick:w},h?r.createElement("path",{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"}):r.createElement("path",{d:"M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"})):u&&r.createElement("svg",{className:"tree-view-node-marker empty-marker",viewBox:"0 0 24 24",onMouseDown:b},r.createElement("circle",{cx:"12",cy:"12",r:"4"})),r.createElement("span",{className:"tree-view-node-label",id:`tree-view-node-label-${e}`},t)),h&&r.createElement("ul",{className:"tree-view-node-children",role:"group"},n.map(((e,t)=>{var{id:l}=e,c=tr(e,["id"]);return r.createElement(nr,Object.assign({},c,{id:l,selectedId:i,expandedIds:a,level:s+1,rowHeight:o,nodeIndex:t,setSize:n.length,onSelect:d,onToggle:m,key:l}))}))))}var rr=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const ir=24,ar=["ArrowUp","ArrowDown"];function sr({roots:e,className:t="",storageId:n,onContextMenu:i,onDelete:a,onEnter:s,onInfo:o,onSelect:l,treeViewRef:c}){const u=(0,r.useRef)(null),d=(0,r.useRef)(null),m=(0,r.useRef)(null),{storeSelectedNodeId:h,retrieveSelectedNodeId:f}=Qn(n),[p,v]=(0,r.useState)(""),{expandedIds:b,toggle:y}=function(e,t){const{storeExpandedState:n,retrieveExpandedState:i}=Qn(t),[a,s]=(0,r.useState)((()=>Xn(e,i)));(0,r.useEffect)((()=>{s(Xn(e,i))}),[e,i]);const o=(0,r.useCallback)(((e,t)=>{const r=a.includes(e);r!==t&&(s(r?a.filter((t=>t!==e)):a.concat(e)),n(e,!r))}),[a,n]);return{expandedIds:a,toggle:o}}(e,n),g=Zn(e,b),w=g.indexOf(p),[E,k]=(0,r.useState)(0),[x,S]=(0,r.useState)(ir),[T,A]=(0,r.useState)(0),P=Math.floor(E/x)-1,I=g.length,C=lr(e,p),M=Jn(ar)&&!(0===w||w===I-1),[O,N]=(0,r.useState)((()=>C)),$=(0,r.useCallback)((()=>u.current.focus()),[]);(0,r.useEffect)((()=>{c&&(c.current={focus:$})}),[c,$]),(0,r.useEffect)((()=>{if(!or(e,p)){const t=e.find((e=>null==p?void 0:p.startsWith(`${e.id}/`)))||e[0];v(null==t?void 0:t.id)}}),[e,p]),(0,r.useEffect)((()=>{!p&&e.length>0&&v(f(e[0].id))}),[e,p,f]),(0,r.useEffect)((()=>{null==l||l(O)}),[O,l]),(0,r.useEffect)((()=>{p&&h(p)}),[p,h]),(0,r.useEffect)((()=>{M||N(C)}),[C,M]);const z=(0,r.useCallback)((e=>{e.preventDefault(),null==i||i(C,e.pageX,e.pageY)}),[C,i]),j=(0,r.useCallback)((e=>{switch(e.code){case"Enter":e.stopPropagation(),e.repeat||null==s||s(C);break;case"Delete":e.stopPropagation(),e.repeat||null==a||a(C);break;case"KeyI":e.stopPropagation(),!e[K.ctrlKey]||e.shiftKey||e.repeat||null==o||o(C);break;case"ArrowLeft":e.stopPropagation(),e.repeat||y(p,!1);break;case"ArrowRight":e.stopPropagation(),e.repeat||y(p,!0);break;default:{const t=function(e,t,n){switch(e){case"ArrowUp":return t[t.indexOf(n)-1]||n;case"ArrowDown":return t[t.indexOf(n)+1]||n;case"Home":return t[0]||n;case"End":return t[t.length-1]||n;default:return""}}(e.key,g,p);if(t&&(e.preventDefault(),t!==p)){e.stopPropagation();const n=d.current,r=Math.floor(T/x),i=g.indexOf(t);if(i>=r+P-1){const e=I*x,t=I-P-1,r=Math.min(I-1,i+1)-P,a=r===t?e:r*x;n.scrollTo({top:a})}else if(i<=r){const e=Math.max(0,i-1)*x;n.scrollTo({top:e})}v(t)}}}}),[g,p,C,x,P,I,T,a,s,o,y]),L=(0,r.useCallback)((({clientHeight:e})=>k(e)),[]),R=(0,r.useCallback)((({top:e})=>A(e)),[]);return Pt(m,(()=>{S(m.current.getBoundingClientRect().height)})),r.createElement("div",{className:`tree-view ${t}`,tabIndex:0,onContextMenu:z,onKeyDown:j,ref:u},r.createElement(Wn,{scrollAmount:x,onResize:L,onScroll:R,scrollableRef:d},r.createElement("ul",{role:"tree"},e.map(((t,n)=>{var{id:i}=t,a=rr(t,["id"]);return r.createElement(nr,Object.assign({},a,{id:i,selectedId:p,expandedIds:b,level:1,rowHeight:x,nodeIndex:n,setSize:e.length,emptyMarker:!0,onSelect:v,onToggle:y,key:i}))}))),r.createElement("div",{className:"tree-view-cursor",style:{transform:`translateY(${w*x}px)`},ref:m})))}function or(e,t){for(const n of e){if(n.id===t)return!0;if(n.children&&or(n.children,t))return!0}return!1}function lr(e,t){return e.reduce(((e,n)=>{if(void 0===e)if(n.id===t)e=n.value;else if(n.children)return lr(n.children,t);return e}),void 0)}const cr=new D("services"),ur=cr.getJson("hidden",{}),dr=new $e(ur);function mr(e){return!function(e){var t;return null!==(t=dr.getValue()[e.id])&&void 0!==t?t:!!e.defaultHidden}(e)}function hr(e){const t=dr.getValue(),n=Object.assign(Object.assign({},t),e);cr.setJson("hidden",n),dr.next(n)}function fr(e){return ze((function(t,n){var r=!1,i=0;t.subscribe(je(n,(function(t){return(r||(r=!e(t,i++)))&&n.next(t)})))}))}var pr;!function(e){e[e.PublicMedia=0]="PublicMedia",e[e.PersonalMedia=1]="PersonalMedia",e[e.Scrobbler=2]="Scrobbler"}(pr||(pr={}));const vr=pr;var br;!function(e){e.Pin="pin",e.Unpin="unpin",e.Like="like",e.Unlike="unlike",e.Rate="rate",e.Info="info",e.AddToLibrary="library-add",e.RemoveFromLibrary="library-remove",e.PlayNow="play-now",e.PlayNext="play-next",e.Queue="queue"}(br||(br={}));const yr=br;var gr;!function(e){e[e.Media=0]="Media",e[e.Album=1]="Album",e[e.Artist=2]="Artist",e[e.Playlist=3]="Playlist",e[e.Folder=4]="Folder"}(gr||(gr={}));const wr=gr;var Er;!function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video"}(Er||(Er={}));const kr=Er;var xr;!function(e){e[e.RecentlyPlayed=2]="RecentlyPlayed",e[e.MostPlayed=3]="MostPlayed",e[e.Library=4]="Library",e[e.Ratings=5]="Ratings",e[e.Folders=6]="Folders",e[e.ByDecade=7]="ByDecade",e[e.ByGenre=8]="ByGenre"}(xr||(xr={}));const Sr=xr;var Tr=Array.isArray,Ar=Object.getPrototypeOf,Pr=Object.prototype,Ir=Object.keys;function Cr(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=$n(e),r=Nn(e),i=function(e){if(1===e.length){var t=e[0];if(Tr(t))return{args:t,keys:null};if((r=t)&&"object"==typeof r&&Ar(r)===Pr){var n=Ir(t);return{args:n.map((function(e){return t[e]})),keys:n}}}var r;return{args:e,keys:null}}(e),a=i.args,s=i.keys;if(0===a.length)return Rn([],n);var o=new Ie(function(e,t,n){return void 0===n&&(n=Pe),function(r){Mr(t,(function(){for(var i=e.length,a=new Array(i),s=i,o=i,l=function(i){Mr(t,(function(){var l=Rn(e[i],t),c=!1;l.subscribe(je(r,(function(e){a[i]=e,c||(c=!0,o--),o||r.next(n(a.slice()))}),(function(){--s||r.complete()})))}),r)},c=0;c<i;c++)l(c)}),r)}}(a,n,s?function(e){return function(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})}(s,e)}:Pe));return r?o.pipe(Sn(r)):o}function Mr(e,t,n){e?En(n,e,t):t()}function Or(e,t){return void 0===t&&(t=Pe),e=null!=e?e:Nr,ze((function(n,r){var i,a=!0;n.subscribe(je(r,(function(n){var s=t(n);!a&&e(i,s)||(a=!1,i=s,r.next(n))})))}))}function Nr(e,t){return e===t}const $r=new Oe,zr={dispatch:function(e){const t=Array.isArray(e)?e:[e];$r.next(t)},observe:function(){return $r}};var jr=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};class Lr extends wt.ZP{constructor(){super("ampcast/library-removals"),this.libraryRemovals$=new $e([]),this.lock$=new $e(null),this.version(1).stores({libraryRemovals:"&src"}),(0,wt.Y1)((()=>this.libraryRemovals.toArray())).subscribe(this.libraryRemovals$)}observeRemovals(e){return Cr([this.libraryRemovals$,this.lock$]).pipe(De((([e])=>e.length>0)),wn((([t])=>t.filter((t=>t.src.startsWith(`${e}:`)&&!this.isLocked(t))))),Or(((e,t)=>{const n=e.map((e=>e.src)).sort(),r=t.map((e=>e.src)).sort();return String(n)===String(r)})))}lock(e,t){this.lock$.next({serviceId:e,itemType:t})}unlock(){this.lock$.next(null)}store(e,t){return jr(this,void 0,void 0,(function*(){const n=e.src,[r]=n.split(":"),i=Vd(r);if(!i)throw Error(`Service not found '${r}'`);if(!i.store)throw Error(`store() not supported by ${r}`);this.isLocked(e)?t?yield this.libraryRemovals.delete(n):yield this.libraryRemovals.put(this.createLibraryObject(e)):yield i.store(e,t),zr.dispatch({match:e=>e.src===n,values:{inLibrary:t}})}))}applyRemovals(e){return jr(this,void 0,void 0,(function*(){if(e.length>0){const t=e.map((e=>e.src));yield this.libraryRemovals.bulkDelete(t),zr.dispatch({match:e=>t.includes(e.src),values:{inLibrary:!1}})}}))}get(e,t){return!this.isRemoved(e)&&t}isRemoved(e){return-1!==this.libraryRemovals$.getValue().findIndex((t=>t.src===e))}isLocked(e){const t=this.lock$.getValue();if(t){const[n]=e.src.split(":");return t.serviceId===n&&t.itemType===e.itemType}return!1}createLibraryObject(e){if("pager"in e){const{pager:t}=e;return function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["pager"])}return e}}const Rr=new Lr;function Dr(e,t){return ne(t)?kn(e,t,1):kn(e,1)}function Fr(e){return ze((function(t,n){var r,i=null,a=!1;i=t.subscribe(je(n,void 0,void 0,(function(s){r=yn(e(s,Fr(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):a=!0}))),a&&(i.unsubscribe(),i=null,r.subscribe(n))}))}var _r=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};class Ur extends wt.ZP{constructor(){super("ampcast/rating-removals"),this.ratingRemovals$=new $e([]),this.lock$=new $e(null),this.logger=new N("ratingStore"),this.version(1).stores({ratingRemovals:"&src"}),(0,wt.Y1)((()=>this.ratingRemovals.toArray())).subscribe(this.ratingRemovals$)}addObserver(e,t=10){if(!e.rate)return void this.logger.error(`rate() not supported by ${e.id}.`);const n=this.logger.id(e.id);this.observeRemovals(e.id).pipe(wn((e=>e.slice(0,t))),Dr((t=>Promise.all(t.map((t=>e.rate(t,0).then((()=>t))))))),Dr((e=>this.applyRemovals(e))),Fr((e=>(n.error(e),[])))).subscribe(n)}observeRemovals(e){return Cr([this.ratingRemovals$,this.lock$]).pipe(De((([e])=>e.length>0)),wn((([t])=>t.filter((t=>t.src.startsWith(`${e}:`)&&!this.isLocked(t))))),Or(((e,t)=>{const n=e.map((e=>e.src)).sort(),r=t.map((e=>e.src)).sort();return String(n)===String(r)})))}lock(e,t){this.lock$.next({serviceId:e,itemType:t})}unlock(){this.lock$.next(null)}rate(e,t){return _r(this,void 0,void 0,(function*(){const n=e.src,[r]=n.split(":"),i=Vd(r);if(!i)throw Error(`Service not found '${r}'`);if(!i.rate)throw Error(`rate() not supported by ${r}`);{const n=this.getRemovedItem(e);this.isLocked(e)?t?(n&&(yield this.ratingRemovals.delete(n.src)),t>1&&(yield i.rate(e,t))):n||(yield this.ratingRemovals.put(this.createRatingObject(e))):(n&&(yield this.ratingRemovals.delete(n.src)),yield i.rate(e,t)),zr.dispatch({match:t=>i.compareForRating(t,e),values:{rating:t}})}}))}get(e,t){return this.getRemovedItem(e)?0:t}applyRemovals(e){return _r(this,void 0,void 0,(function*(){const t=e.map((e=>this.getRemovedItem(e))).filter(l);if(t.length>0){const e=t.map((e=>e.src));yield this.ratingRemovals.bulkDelete(e),zr.dispatch({match:e=>{const[n]=e.src.split(":"),r=Vd(n);return t.some((t=>null==r?void 0:r.compareForRating(e,t)))},values:{rating:0}})}}))}getRemovedItem(e){const[t]=e.src.split(":"),n=Vd(t);if(null==n?void 0:n.rate)return this.ratingRemovals$.getValue().find((t=>n.compareForRating(t,e)))}isLocked(e){const t=this.lock$.getValue();if(t){const[n]=e.src.split(":");return t.serviceId===n&&t.itemType===e.itemType}return!1}createRatingObject(e){if("pager"in e){const{pager:t}=e;return function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["pager"])}return e}}const Vr=new Ur;function Br(e){return e<=0?function(){return Fn}:ze((function(t,n){var r=0;t.subscribe(je(n,(function(t){++r<=e&&(n.next(t),e<=r&&n.complete())})))}))}function Hr(e,{timeout:t=5e3,keepAlive:n=!1}={}){return new Promise(((r,i)=>{const a=n?void 0:()=>e.disconnect(),s=e.observeItems(),o=_n(e.observeError(),sn(t).pipe(wn((()=>Error("timeout")))));s.pipe(Vn(o),Br(1)).subscribe({next:r,complete:a}),o.pipe(Vn(s),Br(1)).subscribe({next:i,complete:a}),e.fetchAt(0)}))}class Yr{constructor(e=[]){this.items=e,this.maxSize=void 0}observeItems(){return Gn(this.items)}observeSize(){return Gn(this.items.length)}observeError(){return Fn}fetchAt(){}disconnect(){this.items.forEach((e=>{var t;return null===(t=e.pager)||void 0===t?void 0:t.disconnect()}))}}const Kr="eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Ijk3RjI2N1daRDkifQ.eyJpYXQiOjE2NzY5MTcxNzEsImV4cCI6MTY5MjQ2OTE3MSwiaXNzIjoiODM4Nk5ERlhMQiJ9.gb8gDSxxWxSQNKWz_OtyMumKDn8wil6kYAMYHcNgzYhr9k0QS7R8JJp_3DCJxy_9KlgGe7wmlLESpvsQ2Zd2Pg".toString(),Wr="41bd731be5b78200d2bbaea2312b917b".toString(),qr="78aa93b641329f00e68cf1542356b8fc".toString(),Gr="68c1c915728f4b9da193da1028692f0d".toString(),Jr="AIzaSyD-cQaU5ntJBcCEBAbmK5pIXD4FQ19fdho".toString(),Qr="364143070327-sgopc15lidje8uq4l16k1u8pqo2hpc4o.apps.googleusercontent.com".toString(),Xr=new D("apple"),Zr={get connectedAt(){return Xr.getNumber("connectedAt")},set connectedAt(e){Xr.setNumber("connectedAt",e)},get useMusicKitBeta(){return Xr.getBoolean("useMusicKitBeta")},set useMusicKitBeta(e){Xr.setBoolean("useMusicKitBeta",e)},clear(){Xr.clear()}};var ei=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};class ti{constructor(e){this.MusicKit=e,this.isWrapper=!0}get version(){return this.MusicKit.version}get Events(){return this.MusicKit.Events}get PlaybackStates(){return this.MusicKit.PlaybackStates}configure(e){return ei(this,void 0,void 0,(function*(){if(!this.instance){const t=this.MusicKit.configure(e);this.instance=t,Object.defineProperties(t,{volume:{get:()=>t.player.volume,set:e=>t.player.volume=e},queue:{get:()=>t.player.queue},isPlaying:{get:()=>t.player.isPlaying},nowPlayingItem:{get:()=>t.player.nowPlayingItem}}),Object.defineProperties(t.api,{music:{get:()=>(e,t,n)=>this.music(e,t,n)}})}return this.instance}))}getInstance(){const e=this.instance;if(e)return e.api.music||Object.defineProperties(e.api,{music:{get:()=>(e,t,n)=>this.music(e,t,n)}}),e;throw Error("Not configured")}formatArtworkURL(e,t,n){return this.MusicKit.formatArtworkURL(e,t,n)}music(e,t,n){return ei(this,void 0,void 0,(function*(){const r=this.getInstance();t&&(e=`${e}${e.includes("?")?"&":"?"}${new URLSearchParams(t)}`),e=e.replace("{{storefrontId}}",r.storefrontId);const i=(null==n?void 0:n.fetchOptions)||{};i.headers||(i.headers={}),i.headers=Object.assign(Object.assign({},i.headers),{authorization:`Bearer ${r.developerToken}`,"music-user-token":r.musicUserToken});const a=yield fetch(`https://api.music.apple.com${e}`,i);if(!a.ok){const e=new Error(String(a.status));throw e.data=a,e}return{data:yield a.json()}}))}}var ni=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const ri=new N("appleAuth"),ii=new $e(!1);function ai(){return ii.getValue()}function si(){return ii.pipe(Or())}function oi(){return ni(this,void 0,void 0,(function*(){ri.log("disconnect");const e=yield ui();try{e.isPlaying&&e.stop(),e.queue.isEmpty||(yield e.setQueue({}))}catch(e){ri.error(e)}try{yield e.unauthorize()}catch(e){ri.error(e)}ii.next(e.isAuthorized)}))}function li(){return ni(this,void 0,void 0,(function*(){throw ri.log("refreshToken"),yield oi(),Error("Access token refresh is not supported.")}))}const ci=new Promise(((e,t)=>{document.addEventListener("musickitloaded",(()=>ni(void 0,void 0,void 0,(function*(){ri.log("Loaded MusicKit version",MusicKit.version),MusicKit.version.startsWith("1")&&!MusicKit.isWrapper&&(window.MusicKit=new ti(MusicKit));try{const t=yield MusicKit.configure({developerToken:Kr,app:{name:"ampcast",build:"0.8.22"},sourceType:8,suppressErrorDialog:!0});e(t)}catch(e){t(e)}}))))}));function ui(){return ni(this,void 0,void 0,(function*(){return window.MusicKit?MusicKit.getInstance():new Promise(((e,t)=>{c(`https://js-cdn.music.apple.com/musickit/v${Zr.useMusicKitBeta?3:1}/musickit.js`).then((()=>ci.then(e,t)),t)}))}))}si().pipe(fr((e=>!e))).subscribe((e=>Zr.connectedAt=e?Date.now():0)),si().pipe(De((e=>e)),kn((()=>ui())),Br(1),Re((e=>{e.addEventListener(MusicKit.Events.authorizationStatusDidChange,(()=>ii.next(e.isAuthorized)))}))).subscribe(ri),Zr.connectedAt&&Rn(ui()).pipe(De((e=>e.isAuthorized)),kn((e=>e.authorize())),Re((e=>ii.next(!!e)))).subscribe(ri);var di=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=en);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=n,i._timestampProvider=r,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=n===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,n),i}return J(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,i=n._buffer,a=n._infiniteTimeWindow,s=n._timestampProvider,o=n._windowTime;r||(i.push(t),!a&&i.push(s.now()+o)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),i=0;i<r.length&&!e.closed;i+=n?1:2)e.next(r[i]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,i=e._infiniteTimeWindow,a=(i?1:2)*t;if(t<1/0&&a<r.length&&r.splice(0,r.length-a),!i){for(var s=n.now(),o=0,l=1;l<r.length&&r[l]<=s;l+=2)o=l;o&&r.splice(0,o+1)}},t}(Oe);const mi=[],hi=new N("AbstractPager");class fi{constructor(e={}){this.config=e,this.items$=new $e(mi),this.additions$=new $e(mi),this.size$=new di(1),this.error$=new di(1),this.fetches$=new $e({index:0,length:0}),this.disconnected=!1}get maxSize(){return this.config.maxSize}observeAdditions(){return this.additions$.pipe(De((e=>e!==mi)))}observeItems(){return this.items$.pipe(De((e=>e!==mi)))}observeSize(){return this.size$.pipe(Or())}observeError(){return this.error$}disconnect(){this.disconnected||(this.disconnected=!0,this.subscriptions&&this.subscriptions.unsubscribe(),this.items.forEach((e=>{var t;return null===(t=e.pager)||void 0===t?void 0:t.disconnect()})),this.items$.complete(),this.additions$.complete(),this.size$.complete(),this.error$.complete())}fetchAt(e,t=this.config.pageSize){if(this.disconnected)hi.warn("disconnected");else{if(t||(t=50),!this.subscriptions&&(this.connect(),this.config.calculatePageSize)){const{minPageSize:e=10,maxPageSize:n=100}=this.config,r=10*Math.ceil(2*t/10);this.config.pageSize=Math.max(Math.min(r,n),e)}this.fetches$.next({index:e,length:t})}}get items(){return this.items$.getValue()}observeComplete(){return Cr([this.observeItems(),this.observeSize()]).pipe(De((([e,t])=>e.reduce((e=>e+1),0)===t)),wn((([e])=>e)),Br(1))}connect(){this.disconnected||this.subscriptions||(this.subscriptions=new se,this.config.lookup||(this.srcs=new Set,this.subscriptions.add(this.items$.pipe(wn((e=>e.filter((e=>{const t=this.srcs.has(e.src);return t||this.srcs.add(e.src),!t})))),De((e=>e.length>0))).subscribe(this.additions$)),this.subscriptions.add(this.observeAdditions().pipe(Re((e=>this.addMultiDisc(e)))).subscribe(hi)),this.subscriptions.add(this.observeAdditions().pipe(Re((e=>this.addTrackCount(e)))).subscribe(hi)),this.subscriptions.add(zr.observe().pipe(Re((e=>this.applyChanges(e)))).subscribe(hi))))}applyChanges(e){let t=!1;const n=this.items.map((n=>{for(const{match:r,values:i}of e)if(r(n))return t=!0,Object.assign(Object.assign({},n),i);return n}));t&&this.items$.next(n)}addMultiDisc(e){e.forEach((e=>{e.itemType===wr.Album&&void 0===e.multiDisc&&this.subscriptions.add(e.pager.observeItems().pipe(Br(1),Re((t=>{const n=e.src,r=this.items.findIndex((e=>e.src===n));if(-1!==r){const e=this.items.slice(),n=e[r],i=m(t.map((e=>e.disc)).filter(l)),a=i.length>1||i[0]>1;e[r]=Object.assign(Object.assign({},n),{multiDisc:a}),this.items$.next(e)}}))).subscribe(hi))}))}addTrackCount(e){e.forEach((e=>{e.itemType===wr.Playlist&&!e.trackCount&&e.pager&&this.subscriptions.add(e.pager.observeSize().pipe(Br(1),Re((t=>{const n=e.src,r=this.items.findIndex((e=>e.src===n));if(-1!==r){const e=this.items.slice(),n=e[r];e[r]=Object.assign(Object.assign({},n),{trackCount:t}),this.items$.next(e)}}))).subscribe(hi))}))}}const pi=new N("SequentialPager");class vi extends fi{constructor(e,t){super(t),this.fetchNext=e,this.fetching$=new $e(!1),this.maxEmptyCount=2,this.emptyCount=0}connect(){this.subscriptions||(super.connect(),this.subscriptions.add(this.observeShouldFetch().pipe(Re((()=>this.fetching$.next(!0))),Dr((()=>this.fetchNext(this.config.pageSize))),Re((e=>this.addPage(e))),Fr((e=>(pi.error(e),this.error$.next(e),Gn(void 0)))),Re((()=>this.fetching$.next(!1))),Vn(this.observeComplete()),Br(100)).subscribe(pi)))}observeShouldFetch(){const e=Cr([this.fetches$,this.items$]).pipe(wn((([{index:e,length:t},n])=>e+2*t>=n.length)),De((e=>e)),wn((()=>{})),Br(1));return this.fetching$.pipe(Un((t=>t?Fn:e)))}addPage(e){var t,n;const r=(e.items||[]).filter(l),i=h(this.items.concat(r),"src");i.length===this.items.length&&this.emptyCount++,i.length=Math.min(i.length,null!==(t=this.maxSize)&&void 0!==t?t:1/0);let a=e.atEnd||i.length===this.maxSize||this.emptyCount>=this.maxEmptyCount;const s=this.config.pageSize;a||void 0!==e.atEnd||void 0!==e.total||void 0===s||(a=e.items.length<s);const o=a?i.length:e.total;void 0!==o&&this.size$.next(Math.min(o,null!==(n=this.maxSize)&&void 0!==n?n:1/0)),this.items$.next(i)}}const bi=new N("WrappedPager");class yi{constructor(e,t,n){this.headerPager=e,this.bodyPager=t,this.footerPager=n,this.fetches$=new $e({index:0,length:0}),this.disconnected=!1}get maxSize(){}observeItems(){var e,t;return Cr([(null===(e=this.headerPager)||void 0===e?void 0:e.observeItems())||Gn([]),this.bodyPager.observeItems(),(null===(t=this.footerPager)||void 0===t?void 0:t.observeItems())||Gn([]),this.observeComplete()]).pipe(wn((([e,t,n,r])=>e.concat(r?t.concat(n):t))))}observeSize(){var e,t;return Cr([(null===(e=this.headerPager)||void 0===e?void 0:e.observeSize())||Gn(0),this.bodyPager.observeSize(),(null===(t=this.footerPager)||void 0===t?void 0:t.observeSize())||Gn(0),this.observeComplete()]).pipe(wn((([e,t,n,r])=>e+t+(r?n:0))))}observeError(){return this.bodyPager.observeError()}disconnect(){var e,t,n;this.disconnected||(this.disconnected=!0,null===(e=this.subscriptions)||void 0===e||e.unsubscribe(),null===(t=this.headerPager)||void 0===t||t.disconnect(),this.bodyPager.disconnect(),null===(n=this.footerPager)||void 0===n||n.disconnect())}fetchAt(e,t){this.disconnected?bi.warn("disconnected"):(this.subscriptions||this.connect(),this.fetches$.next({index:e,length:t}))}connect(){var e;this.subscriptions||(this.subscriptions=new se,this.subscriptions.add(Cr([(null===(e=this.headerPager)||void 0===e?void 0:e.observeSize())||Gn(0),this.observeFetches()]).pipe(Re((([e,t])=>this.bodyPager.fetchAt(Math.max(t.index-e,0),t.length)))).subscribe(bi)),this.footerPager&&this.subscriptions.add(this.observeComplete().pipe(Re((()=>this.footerPager.fetchAt(0)))).subscribe(bi)))}observeComplete(){return Cr([this.bodyPager.observeItems(),this.bodyPager.observeSize()]).pipe(wn((([e,t])=>e.reduce((e=>e+1),0)===t)),Or())}observeFetches(){return this.fetches$.pipe(De((e=>e.length>0)))}}var gi=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const wi=new N("pinStore"),Ei=[];class ki extends wt.ZP{constructor(){super("ampcast/pins"),this.pins$=new $e(Ei),this.lockedPin$=new $e(null),this.version(1).stores({pins:"&src"}),(0,wt.Y1)((()=>this.pins.toArray())).subscribe(this.pins$)}lock(e){this.lockedPin$.next(e)}unlock(){this.lockedPin$.next(null)}pin(e){return gi(this,void 0,void 0,(function*(){try{const t=Array.isArray(e)?e:[e];wi.log("pin",{playlists:t}),yield this.pins.bulkPut(t.map((e=>{const{pager:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["pager"]);return Object.assign(Object.assign({},n),{isPinned:!0})}))),zr.dispatch(t.map((e=>({match:t=>t.src===e.src,values:{isPinned:!0}}))))}catch(e){wi.error(e)}}))}unpin(e){return gi(this,void 0,void 0,(function*(){try{const t=Array.isArray(e)?e:[e];wi.log("unpin",{playlists:t}),yield this.pins.bulkDelete(t.map((e=>e.src))),zr.dispatch(t.map((e=>({match:t=>t.src===e.src,values:{isPinned:!1}}))))}catch(e){wi.error(e)}}))}isPinned(e){return-1!==this.pins$.getValue().findIndex((t=>t.src===e))}observe(){return Cr([this.pins$,this.lockedPin$]).pipe(De((([e])=>e!==Ei)),wn((([e])=>e)))}getPinsForService(e){const t=this.pins$.getValue().slice(),n=this.lockedPin$.getValue();return n&&!t.find((e=>e.src===n.src))&&t.push(n),t.filter((t=>t.src.startsWith(`${e}:`))).sort(((e,t)=>e.title.localeCompare(t.title,void 0,{sensitivity:"accent",ignorePunctuation:!0})))}}const xi=new ki;var Si=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Ti=new N("MusicKitPager");class Ai{static defaultToPage(e){var t,n,r;const i=(null===(n=null===(t=e.data[0])||void 0===t?void 0:t.relationships)||void 0===n?void 0:n.tracks)||e,a=i.data||[],s=i.next;return{items:a,total:null===(r=i.meta)||void 0===r?void 0:r.total,nextPageUrl:s}}constructor(e,t,n,r,i=Ai.defaultToPage){this.options=n,this.parent=r,this.nextPageUrl=void 0,this.pager=new vi((n=>Si(this,void 0,void 0,(function*(){const r=yield this.fetchNext(this.nextPageUrl||e,n?t?Object.assign(Object.assign({},t),{limit:n}):{limit:n}:t),a=i(r.data),s=this.createItems(a.items),o=a.total,l=!a.nextPageUrl;return this.nextPageUrl=a.nextPageUrl,{items:s,total:o,atEnd:l}}))),n)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){var e;this.subscriptions||(this.subscriptions=new se,(null===(e=this.options)||void 0===e?void 0:e.lookup)||(this.subscriptions.add(this.pager.observeAdditions().pipe(kn((e=>_i(e,!0)))).subscribe(Ti)),this.subscriptions.add(this.pager.observeAdditions().pipe(kn((e=>Ui(e,!0,this.parent)))).subscribe(Ti))))}fetchNext(e,t){return Si(this,void 0,void 0,(function*(){const n=MusicKit.getInstance();try{return yield n.api.music(e,t)}catch(r){const i=null==r?void 0:r.data.status;if(401===i||403===i)return yield li(),n.api.music(e,t);throw r}}))}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){switch(e.type){case"playlists":case"library-playlists":return this.createMediaPlaylist(e);case"artists":case"library-artists":return this.createMediaArtist(e);case"albums":case"library-albums":return this.createMediaAlbum(e);case"songs":case"library-songs":case"music-videos":case"library-music-videos":return this.createMediaItem(e)}}createMediaPlaylist(e){var t,n;const r=this.createFromLibrary(e),i=(null===(t=r.description)||void 0===t?void 0:t.standard)||(null===(n=r.description)||void 0===n?void 0:n.short),a=`apple:${e.type}:${e.id}`,s=this.getCatalogId(e),o={src:a,itemType:wr.Playlist,externalUrl:r.url||void 0,title:r.name,description:i?A(i):void 0,thumbnails:this.createThumbnails(r),owner:r.curatorName?{name:r.curatorName}:void 0,modifiedAt:Math.floor(new Date(r.lastModifiedDate).valueOf()/1e3)||void 0,unplayable:!r.playParams||void 0,isPinned:xi.isPinned(a),inLibrary:Rr.get(a,e.type.startsWith("library-")||void 0),apple:{catalogId:s}};return o.rating=Vr.get(o),o.pager=new Ai(`${e.href}/tracks`,void 0,void 0,o),o}createMediaArtist(e){var t,n;const r=this.createFromLibrary(e),i=(null===(t=r.editorialNotes)||void 0===t?void 0:t.standard)||(null===(n=r.editorialNotes)||void 0===n?void 0:n.short),a=this.getCatalogId(e);return{itemType:wr.Artist,src:`apple:${e.type}:${e.id}`,externalUrl:r.url||void 0,title:r.name,description:i?A(i):void 0,thumbnails:this.createThumbnails(r),genres:this.getGenres(r),pager:this.createArtistAlbumsPager(e),apple:{catalogId:a}}}createArtistTopTracks(e){const t=this.createFromLibrary(e);return{itemType:wr.Album,src:`apple:top-tracks:${e.id}`,title:"Top Tracks",thumbnails:this.createThumbnails(t),artist:t.name,genres:this.getGenres(t),pager:this.createTopTracksPager(e),synthetic:!0,inLibrary:!1,apple:{catalogId:""}}}createMediaAlbum(e){var t,n;const r=this.createFromLibrary(e),i=`apple:${e.type}:${e.id}`,a=(null===(t=r.editorialNotes)||void 0===t?void 0:t.standard)||(null===(n=r.editorialNotes)||void 0===n?void 0:n.short),s=this.getCatalogId(e),o={itemType:wr.Album,src:i,externalUrl:r.url||void 0,title:r.name,description:a?A(a):void 0,thumbnails:this.createThumbnails(r),artist:r.artistName,trackCount:r.trackCount,genres:this.getGenres(r),year:new Date(r.releaseDate).getFullYear()||0,unplayable:!r.playParams||void 0,inLibrary:Rr.get(i,e.type.startsWith("library-")||void 0),apple:{catalogId:s}};return o.rating=Vr.get(o),o.pager=new Ai(`${e.href}/tracks`,void 0,void 0,o),o}createMediaItem(e){var t,n,r,i,a;const s=this.createFromLibrary(e),{id:o,kind:l}=s.playParams||{id:e.id,kind:"music-videos"===e.type?"musicVideo":"song"},c=`apple:${e.type}:${o}`,u=(null===(t=s.editorialNotes)||void 0===t?void 0:t.standard)||(null===(n=s.editorialNotes)||void 0===n?void 0:n.short),d=e.type.startsWith("library-"),m=(null===(r=this.parent)||void 0===r?void 0:r.itemType)===wr.Playlist,h=this.getCatalogId(e);let f=s.url||void 0;!f&&h&&(null===(i=this.parent)||void 0===i?void 0:i.itemType)===wr.Album&&this.parent.externalUrl&&(f=`${this.parent.externalUrl}?i=${h}`);const p={itemType:wr.Media,mediaType:"musicVideo"===l?kr.Video:kr.Audio,src:c,externalUrl:f,title:s.name,description:u?A(u):void 0,thumbnails:this.createThumbnails(s),artists:[s.artistName],albumArtist:(null===(a=this.parent)||void 0===a?void 0:a.itemType)===wr.Album?this.parent.artist:void 0,album:s.albumName,duration:s.durationInMillis/1e3,genres:this.getGenres(s),disc:s.discNumber,track:s.trackNumber,year:new Date(s.releaseDate).getFullYear()||void 0,isrc:s.isrc,unplayable:!s.playParams||void 0,playedAt:0,inLibrary:Rr.get(c,d&&!m||void 0),apple:{catalogId:h}};return p.rating=Vr.get(p),p}getCatalogId(e){var t,n,r;if(e.type.startsWith("library-")){let i=null===(n=null===(t=e.attributes)||void 0===t?void 0:t.playParams)||void 0===n?void 0:n["library-playlists"===e.type?"globalId":"catalogId"];return i||(i=null===(r=this.getCatalog(e))||void 0===r?void 0:r.id),i||""}return e.id}createFromLibrary(e){var t;return k(e.attributes,null===(t=this.getCatalog(e))||void 0===t?void 0:t.attributes)}getCatalog(e){var t,n,r;return null===(r=null===(n=null===(t=e.relationships)||void 0===t?void 0:t.catalog)||void 0===n?void 0:n.data)||void 0===r?void 0:r[0]}createThumbnails({artwork:e}){return e?[this.createThumbnail(e,120),this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480)]:void 0}createThumbnail(e,t){return{url:MusicKit.formatArtworkURL(e,t,t),width:t,height:t}}createArtistAlbumsPager(e){const t=new Ai(`${e.href}/albums`);if(e.type.startsWith("library-"))return t;const n=this.createArtistTopTracks(e),r=new Yr([n]);return new yi(r,t)}createTopTracksPager(e){return new Ai(e.href,{"limit[artists:top-songs]":"20",views:"top-songs"},{maxSize:10},void 0,(e=>{var t,n,r;const i=(null===(n=null===(t=e.data[0])||void 0===t?void 0:t.views)||void 0===n?void 0:n["top-songs"])||e,a=i.data||[],s=i.next;return{items:a,total:null===(r=i.meta)||void 0===r?void 0:r.total,nextPageUrl:s}}))}getGenres({genreNames:e=[]}){return e.filter((e=>"Music"!==e))}}var Pi=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Ii={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},Ci={id:"apple/recommendations",title:"Recommended",icon:"playlist",itemType:wr.Playlist,search:()=>new Ai("/v1/me/recommendations",void 0,void 0,void 0,(({data:e=[],next:t,meta:n})=>{const r=e.map((e=>e.relationships.contents.data.filter((e=>"playlists"===e.type)))).flat();return{items:r,total:null==n?void 0:n.total,nextPageUrl:t}}))},Mi={id:"apple/recently-played",title:"Recently Played",icon:"clock",itemType:wr.Media,layout:Ii,search:()=>new Ai("/v1/me/recent/played/tracks",void 0,{pageSize:30,maxSize:200})},Oi={id:"apple/library-songs",title:"My Songs",icon:"tick",itemType:wr.Media,viewType:Sr.Library,layout:Ii,defaultHidden:!0,search:()=>new Ai("/v1/me/library/songs")},Ni={id:"apple/library-albums",title:"My Albums",icon:"tick",itemType:wr.Album,viewType:Sr.Library,search:()=>new Ai("/v1/me/library/albums",{"fields[library-albums]":"name,artistName,playParams","include[library-albums]":"catalog"})},$i={id:"apple/library-artists",title:"My Artists",icon:"tick",itemType:wr.Artist,viewType:Sr.Library,defaultHidden:!0,search:()=>new Ai("/v1/me/library/artists",{"fields[library-artists]":"name,playParams","include[library-artists]":"catalog","omit[resource:artists]":"relationships"})},zi={id:"apple/playlists",title:"My Playlists",icon:"tick",itemType:wr.Playlist,viewType:Sr.Library,search:()=>new Ai("/v1/me/library/playlists",{"fields[library-playlists]":"name,playParams","include[library-playlists]":"catalog"})},ji={id:"apple/library-videos",title:"My Videos",icon:"tick",itemType:wr.Media,mediaType:kr.Video,viewType:Sr.Library,layout:Ii,defaultHidden:!0,search:()=>new Ai("/v1/me/library/music-videos")},Li={id:"apple",name:"Apple Music",icon:"apple",url:"https://music.apple.com",serviceType:vr.PublicMedia,defaultHidden:!0,roots:[Di(wr.Media,{title:"Songs",layout:Ii}),Di(wr.Album,{title:"Albums"}),Di(wr.Artist,{title:"Artists"}),Di(wr.Playlist,{title:"Playlists"}),Di(wr.Media,{title:"Videos",layout:Ii,mediaType:kr.Video},{types:"music-videos"},{maxSize:250})],sources:[Oi,Ni,$i,zi,ji,Mi,Ci],labels:{[yr.AddToLibrary]:"Add to Apple Music Library",[yr.RemoveFromLibrary]:"Saved to Apple Music Library",[yr.Like]:"Love on Apple Music",[yr.Unlike]:"Unlove on Apple Music"},canRate:function(){return!1},canStore:function(e){switch(e.itemType){case wr.Media:case wr.Playlist:return!0;case wr.Album:return!e.synthetic;default:return!1}},compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:wr.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,t,n]=e.src.split(":"),r=t.startsWith("library-");return new Ai(`${r?"/v1/me/library":"/v1/catalog/{{storefrontId}}"}/playlists/${n}`,r?{"include[library-playlists]":"catalog","fields[library-playlists]":"name,playParams"}:{"omit[resource:playlists]":"relationships"})}}},getMetadata:function(e){var t;return Pi(this,void 0,void 0,(function*(){if(e.itemType===wr.Playlist&&e.isOwn)return e;let n=e;if(!e.externalUrl){const[,r,i]=e.src.split(":"),a=r.startsWith("library-"),s=new Ai(`${a?"/v1/me/library":"/v1/catalog/{{storefrontId}}"}/${r.replace("library-","")}/${i}${a?"/catalog":""}`,a?void 0:{[`omit[resource:${r.replace("library-","")}]`]:"relationships"},{lookup:!0}),o=yield Hr(s,{timeout:2e3});n=k(e,o[0]),n.description=(null===(t=o[0])||void 0===t?void 0:t.description)||e.description}return n.inLibrary=Rr.get(n.src,n.inLibrary),void 0===n.inLibrary&&Ui([n]),n.rating=Vr.get(n,n.rating),void 0===n.rating&&_i([n]),n}))},lookup:function(e,t,n=10,r){return Pi(this,void 0,void 0,(function*(){return e&&t?Hr(Fi(wr.Media,`${e} ${t}`,void 0,{pageSize:n,maxSize:n,lookup:!0}),{timeout:r}):[]}))},rate:function(e,t){return Pi(this,void 0,void 0,(function*(){const n=MusicKit.getInstance(),[,r,i]=e.src.split(":"),a=`/v1/me/ratings/${r}/${i}`;t?yield n.api.music(a,void 0,{fetchOptions:{method:"PUT",body:JSON.stringify({type:"rating",attributes:{value:t}})}}):yield n.api.music(a,void 0,{fetchOptions:{method:"DELETE"}})}))},store:function(e,t){var n;return Pi(this,void 0,void 0,(function*(){const r=MusicKit.getInstance(),[,i]=e.src.split(":"),a=i.replace("library-",""),s=null===(n=e.apple)||void 0===n?void 0:n.catalogId,o="/v1/me/library";if(t){const e=`ids[${a}]`;return r.api.music(o,{[e]:s},{fetchOptions:{method:"POST"}})}return r.api.music(`${o}/${a}/${s}`,void 0,{fetchOptions:{method:"DELETE"}})}))},observeIsLoggedIn:si,isLoggedIn:ai,login:function(){return ni(this,void 0,void 0,(function*(){if(!ai()){ri.log("connect");try{const e=MusicKit.getInstance();yield e.authorize(),ii.next(e.isAuthorized)}catch(e){ri.error(e)}}}))},logout:oi},Ri=Li;function Di(e,t,n,r){return Object.assign(Object.assign({},t),{itemType:e,id:`apple/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>Fi(e,t,n,r)})}function Fi(e,t,n,r){if(t){const i=Object.assign(Object.assign({},n),{term:t});if(!i.types){switch(e){case wr.Media:i.types="songs";break;case wr.Album:i.types="albums";break;case wr.Artist:i.types="artists";break;case wr.Playlist:i.types="playlists"}i[`omit[resource:${i.types}]`]="relationships"}const a=i.types;return new Ai("/v1/catalog/{{storefrontId}}/search",i,Object.assign({maxSize:250,pageSize:25},r),void 0,(e=>{var t;const n=e.results[a]||{data:[]},r=n.next,i=null===(t=e.meta)||void 0===t?void 0:t.total;return{items:n.data,total:i,nextPageUrl:r}}))}return new Yr}function _i(e,t=!1){return Pi(this,void 0,void 0,(function*(){const n=e[0];if(!n||!Li.canRate(n,t))return;const r=e.filter((e=>void 0===e.rating)).map((e=>{const[,,t]=e.src.split(":");return t}));if(0===r.length)return;const[,i]=n.src.split(":"),a=MusicKit.getInstance(),{data:{data:s}}=yield a.api.music(`/v1/me/ratings/${i}`,{ids:r});if(!s)return;const o=new Map(s.map((e=>[e.id,e.attributes.value])));zr.dispatch(r.map((e=>({match:t=>t.src===`apple:${i}:${e}`,values:{rating:o.get(e)||0}}))))}))}function Ui(e,t=!1,n){return Pi(this,void 0,void 0,(function*(){const r=e[0];if(!r||!Li.canStore(r,t))return;const i=(null==n?void 0:n.itemType)===wr.Album,a=e.filter((e=>void 0===e.inLibrary&&!(i&&e.src.startsWith("apple:library-")))).map((e=>{var t;return null===(t=e.apple)||void 0===t?void 0:t.catalogId})).filter((e=>!!e));if(0===a.length)return;let[,s]=r.src.split(":");s=s.replace("library-","");const o=MusicKit.getInstance(),{data:{resources:l}}=yield o.api.music("/v1/catalog/{{storefrontId}}",{[`fields[${s}]`]:"inLibrary","format[resources]":"map",[`ids[${s}]`]:a,"omit[resource]":"autos"}),c=l[s];if(!c)return;const u=new Map(Object.keys(c).map((e=>[e,c[e].attributes.inLibrary])));zr.dispatch(a.map((e=>({match:t=>{var n;return(null===(n=t.apple)||void 0===n?void 0:n.catalogId)===e},values:{inLibrary:u.get(e)||!1}}))))}))}class Vi extends Error{constructor(){super(),Object.setPrototypeOf(this,Vi.prototype)}}class Bi extends Vi{constructor(){super(...arguments),this.message="No music library found."}}class Hi extends Vi{constructor(){super(...arguments),this.message="No music video library found."}}class Yi extends fi{constructor(e){super(),this.fetch=e}fetchAt(){if(!this.disconnected&&!this.subscriptions){this.connect();const e=this.fetch();this.size$.next(e.length),this.items$.next(e)}}disconnect(){super.disconnect(),this.items.forEach((e=>{var t;return null===(t=e.pager)||void 0===t?void 0:t.disconnect()}))}}function Ki({icon:e,text:t,showConnectivity:n}){return r.createElement("span",{className:"media-source-label"},r.createElement($t,{name:e,className:n?"show-connectivity":""}),r.createElement("span",{className:"text"},t))}var Wi=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},qi=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Gi(e){var{service:t,settings:n,login:i}=e,a=qi(e,["service","settings","login"]);const s=t.id,[o,l]=(0,r.useState)(!1),[c,u]=(0,r.useState)(""),d=(0,r.useRef)(null),m=(0,r.useRef)(null),h=(0,r.useRef)(null),f=(0,r.useRef)(null),p=r.createElement(Ki,{icon:t.icon,text:`Log in to ${t.name}`}),v=(0,r.useCallback)((()=>Wi(this,void 0,void 0,(function*(){try{const e=m.current.value.replace(/\/+$/,""),t=h.current.value,r=f.current.value;if(n.host=e,l(!0),u("Connecting..."),"https:"===location.protocol&&!e.startsWith("https:"))throw Error("https required");const a=yield i(e,t,r);d.current.close(a)}catch(e){console.error(e),l(!1),e instanceof TypeError?u("Host not found"):u(e.message||e.statusText||"Error")}}))),[n,i]),b=(0,r.useCallback)((e=>{e.preventDefault(),v()}),[v]);return r.createElement(Lt,Object.assign({},a,{className:`login-dialog login-dialog-${t.id}`,title:p,ref:d}),r.createElement("form",{id:`${s}-login`,method:"dialog",onSubmit:b},r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("label",{htmlFor:`${s}-host`},"Host:"),r.createElement("input",{type:"url",id:`${s}-host`,name:`${s}-host`,autoFocus:!n.host,defaultValue:n.host,placeholder:"https://",required:!0,ref:m})),r.createElement("p",null,r.createElement("label",{htmlFor:`${s}-username`},"User:"),r.createElement("input",{type:"text",id:`${s}-username`,name:`${s}-username`,autoFocus:!!n.host,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",required:!0,ref:h})),r.createElement("p",null,r.createElement("label",{htmlFor:`${s}-password`},"Password:"),r.createElement("input",{type:"password",id:`${s}-password`,name:`${s}-password`,ref:f,required:!0}))),r.createElement("p",{className:"message "+(o?"":"error")},c),r.createElement(Vt,{submitText:"Login"})))}let Ji=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")),"");class Qi{constructor(e){this.storage=new D(e),this.libraryId$=new $e(this.storage.getString("libraryId"))}get audioLibraries(){return this.libraries.filter((e=>"musicvideos"!==e.type))}get device(){return"PC"}get deviceId(){let e=this.storage.getString("deviceId");return e||(e=Ji(),this.storage.setString("deviceId",e)),e}get host(){return this.storage.getString("host")}set host(e){this.storage.setString("host",e)}get libraryId(){return this.storage.getString("libraryId")}set libraryId(e){this.storage.setString("libraryId",e),this.libraryId$.next(e)}observeLibraryId(){return this.libraryId$.pipe(Or())}get libraries(){return this.storage.getJson("libraries")||[]}set libraries(e){const t=e.find((e=>e.id===this.libraryId))||e.find((e=>"music"===e.type&&M(e.title)))||e.find((e=>"music"===e.type))||e.find((e=>"audiobooks"===e.type));this.storage.setJson("libraries",e),this.libraryId=(null==t?void 0:t.id)||""}get serverId(){return this.storage.getString("serverId")}set serverId(e){this.storage.setString("serverId",e)}get token(){return this.storage.getString("token")}set token(e){this.storage.setString("token",e)}get userId(){return this.storage.getString("userId")}set userId(e){this.storage.setString("userId",e)}get videoLibraryId(){var e;return null===(e=this.libraries.find((e=>"musicvideos"===e.type)))||void 0===e?void 0:e.id}clear(){this.storage.removeItem("serverId"),this.storage.removeItem("userId"),this.storage.removeItem("token")}}const Xi=new Qi("emby");var Zi=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},ea=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function ta(e=Ua,t=Xi){return Zi(this,void 0,void 0,(function*(){return Dt((n=>r.createElement(na,Object.assign({},n,{service:e,settings:t}))),!0)}))}function na(e){var{service:t,settings:n}=e,i=ea(e,["service","settings"]);const a=(0,r.useCallback)(((e,t,r)=>Zi(this,void 0,void 0,(function*(){const{device:i,deviceId:a}=n,s=`MediaBrowser Client="ampcast", Version="0.8.22", Device="${i}", DeviceId="${a}"`,o=yield fetch(`${e}/Users/AuthenticateByName`,{method:"POST",headers:{"Content-Type":"application/json","X-Emby-Authorization":s},body:JSON.stringify({Username:t,Pw:r})});if(!o.ok)throw o;const l=yield o.json(),c=l.ServerId,u=l.User.Id,d=l.AccessToken;return JSON.stringify({serverId:c,userId:u,token:d})}))),[n]);return r.createElement(Gi,Object.assign({},i,{service:t,settings:n,login:a}))}var ra=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function ia(e,t,n){return ra(this,void 0,void 0,(function*(){const r=yield sa(e,t,{method:"GET",headers:{Accept:"application/json"}},n);return yield r.json()}))}function aa(e,t,n=Xi){return ra(this,void 0,void 0,(function*(){const r={UserId:n.userId,ParentId:n.libraryId,IncludeItemTypes:"Audio",SortBy:"SortName",Recursive:!0,Limit:500,StartIndex:0,EnableImages:!1,EnableUserData:!1,EnableTotalRecordCount:!1};switch(t){case wr.Album:r.IncludeItemTypes="MusicAlbum";break;case wr.Artist:r.IncludeItemTypes="AlbumArtist"}return((yield ia(e,r,n)).Items||[]).map((({Id:e,Name:t})=>({id:e||t,title:t})))}))}function sa(e,t,n,r=Xi){return ra(this,void 0,void 0,(function*(){const{host:i,device:a,deviceId:s,token:o}=r;if(!o)throw Error("No access token");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1)),n.headers=Object.assign(Object.assign({},n.headers),{"X-Emby-Authorization":`MediaBrowser Client="ampcast", Version="0.8.22", Device="${a}", DeviceId="${s}", Token="${o}"`});const l=yield fetch(`${i}/${e}`,n);if(!l.ok)throw l;return l}))}const oa={delete:function(e,t,n){return ra(this,void 0,void 0,(function*(){yield sa(e,t,{method:"DELETE"},n)}))},get:ia,getFilters:function(e,t,n){return ra(this,void 0,void 0,(function*(){return e===Sr.ByDecade?function(e,t){return ra(this,void 0,void 0,(function*(){const n=(new Date).getFullYear(),r=(yield aa("Years",e,t)).map((e=>Number(e.title))).filter((e=>e>500&&e<=n)),i=function(e,t){const n=t;return e.reduce(((e,t)=>{const r=n(t);return e[r]||(e[r]=[]),e[r].push(t),e}),{})}(r,(e=>10*Math.floor(e/10)));return Object.keys(i).sort().reverse().map((e=>({id:i[e].join(","),title:`${e}s`})))}))}(t,n):function(e,t){return ra(this,void 0,void 0,(function*(){return aa("Genres",e,t)}))}(t,n)}))},getMusicLibraries:function(e=Xi){var t;return ra(this,void 0,void 0,(function*(){const n=yield ia(`Users/${e.userId}/Views`,void 0,e);return((null===(t=n.Items)||void 0===t?void 0:t.filter((e=>/^(audiobooks|music|musicvideos)$/.test(e.CollectionType))))||[]).map((({Id:e,Name:t,CollectionType:n})=>({id:e,title:t,type:n})))}))},post:function(e,t={},n=Xi){return ra(this,void 0,void 0,(function*(){const r=JSON.stringify(t);yield sa(e,void 0,{method:"POST",headers:{"Content-Type":"application/json"},body:r},n)}))},getPlayableUrlFromSrc:function(e,t=Xi){const{host:n,userId:r,token:i,deviceId:a}=t;if(n&&r&&i&&a){const[,t,s,o]=e.split(":");return"video"===t?`${n}/Videos/${s}/stream?${new URLSearchParams({MediaSourceId:o||s,Static:"true",UserId:r,DeviceId:a,api_key:i})}`:`${n}/Audio/${s}/universal?${new URLSearchParams({MaxStreamingBitrate:"140000000",MaxSampleRate:"48000",TranscodingProtocol:"hls",TranscodingContainer:"ts",Container:"opus,webm|opus,mp3,aac,m4a|aac,m4a|alac,m4b|aac,flac,webma,webm|webma,wav,ogg",AudioCodec:"aac",Static:"true",UserId:r,api_key:i,DeviceId:a})}`}throw Error("Not logged in")}},la=oa;var ca=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const ua=new N("embyAuth"),da=new $e(""),ma=new $e(!1);function ha(){return ma.getValue()}function fa(e){Xi.token=e,da.next(e)}function pa(e,t,n){void 0===t&&(t=nn);var r=sn(e,t);return function(e,t){return ze((function(e,n){var i=null!=t?t:{},a=i.leading,s=void 0===a||a,o=i.trailing,l=void 0!==o&&o,c=!1,u=null,d=null,m=!1,h=function(){null==d||d.unsubscribe(),d=null,l&&(v(),m&&n.complete())},f=function(){d=null,m&&n.complete()},p=function(e){return d=yn(r).subscribe(je(n,h,f))},v=function(){if(c){c=!1;var e=u;u=null,n.next(e),!m&&p()}};e.subscribe(je(n,(function(e){c=!0,u=e,(!d||d.closed)&&(s?v():p())}),(function(){m=!0,(!(l&&c&&d)||d.closed)&&n.complete()})))}))}(0,n)}da.pipe(Or()).pipe(De((e=>""!==e)),kn((()=>function(){return ca(this,void 0,void 0,(function*(){try{const e=yield la.getMusicLibraries();return Xi.libraries=e,!0}catch(e){return ua.error(e),da.next(""),!1}}))}()))).subscribe(ma),fa(Xi.token);var va;!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(va||(va={}));const ba=new N("OffsetPager");class ya extends fi{constructor(e,t){super(t),this.fetch=e,this.fetchStates={},this.size=0}connect(){this.subscriptions||(super.connect(),this.subscriptions.add(this.fetches$.pipe(pa(200,void 0,{leading:!1,trailing:!0}),De((({index:e,length:t})=>t>0&&this.isInRange(e))),wn((({index:e,length:t})=>this.getPageNumbersFromIndex(e,t))),kn((e=>e)),kn((e=>this.fetchPage(e))),Fr((e=>(ba.error(e),this.error$.next(e),Gn(void 0)))),Vn(this.observeComplete())).subscribe(ba)))}get pageSize(){return this.config.pageSize||20}fetchPage(e){return t=this,n=void 0,i=function*(){if(this.fetchStates[e]!==va.Fulfilled&&this.fetchStates[e]!==va.Pending){this.fetchStates[e]=va.Pending;try{const t=yield this.fetch(e,this.pageSize);this.fetchStates[e]=va.Fulfilled,this.insertPage(e,t)}catch(t){throw this.fetchStates[e]=va.Rejected,t}}},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}insertPage(e,t){var n;const r=this.items.slice(),i=Math.min(t.total,null!==(n=this.maxSize)&&void 0!==n?n:1/0),a=Math.ceil(i/this.pageSize),s=(e-1)*this.pageSize;if(t.items.forEach(((e,t)=>r[t+s]=e)),r.length=i,t.items.length===i)for(let e=0;e<=a;e++)this.fetchStates[e+1]=va.Fulfilled;this.size=i,this.size$.next(i),this.items$.next(r)}getPageNumbersFromIndex(e,t){const n=this.size,r=Math.max(Math.ceil(this.pageSize/2),t),i=Math.max(e-r,0),a=Math.min(e+r+t-1,0===n?this.maxSize?this.maxSize-1:1/0:n-1),s=this.getPageNumberFromIndex(i),o=this.getPageNumberFromIndex(a);if(s===o)return[s];{const e=[];for(let t=s;t<=o;t++)e.push(t);return e}}getPageNumberFromIndex(e){return Math.floor(e/this.pageSize)+1}isInRange(e){return 0===this.size?e>=0:e>=0&&e<this.size}}class ga{constructor(e,t={},n,r){this.path=e,this.params=t,this.parent=r,this.pageSize=Math.min((null==n?void 0:n.maxSize)||1/0,(null==n?void 0:n.pageSize)||200),this.pager=new ya((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},n))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){var t,n,r,i,a,s;return r=this,i=void 0,s=function*(){const r=Object.assign(Object.assign({IncludeItemTypes:"Audio",Fields:"AudioInfo,Genres,ParentIndexNumber,Path,ProductionYear,Overview,PresentationUniqueKey",EnableUserData:!0,Recursive:!0,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!0},this.params),{Limit:String(this.pageSize),StartIndex:String((e-1)*this.pageSize)}),i=yield la.get(this.path,r);return i.Type?{items:[this.createMediaObject(i)],total:1}:{items:(null===(t=i.Items)||void 0===t?void 0:t.map((e=>this.createMediaObject(e))))||[],total:i.TotalRecordCount||(null===(n=i.Items)||void 0===n?void 0:n.length)}},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,o)}l((s=s.apply(r,i||[])).next())}))}createMediaObject(e){var t;if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===wr.Folder&&e.IsFolder)return this.createMediaFolder(e);{let t;switch(e.Type){case"MusicArtist":t=this.createMediaArtist(e);break;case"MusicAlbum":t=this.createMediaAlbum(e);break;case"Playlist":t=this.createMediaPlaylist(e);break;default:t=this.createMediaItemFromTrack(e)}return Ua.canRate(t)&&(t.rating=this.getRating(t,e)),t}}createMediaArtist(e){var t;return{itemType:wr.Artist,src:`emby:artist:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",description:e.Overview||void 0,playCount:(null===(t=e.UserData)||void 0===t?void 0:t.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),pager:this.createArtistAlbumsPager(e)}}createMediaAlbum(e){var t,n;return{itemType:wr.Album,src:`emby:album:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),trackCount:e.ChildCount||void 0,pager:this.createAlbumTracksPager(e),artist:e.AlbumArtist||void 0,year:e.ProductionYear||void 0}}createMediaPlaylist(e){var t,n;const r=`emby:playlist:${e.Id}`;return{src:r,itemType:wr.Playlist,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),trackCount:e.ChildCount||void 0,pager:this.createPlaylistPager(e),isPinned:xi.isPinned(r)}}createMediaFolder(e){var t;const n=this.getFileName(e.Path||"")||e.Name||"[unknown]",r={itemType:wr.Folder,src:`emby:folder:${e.Id}`,title:e.Name||"[unknown]",fileName:n,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===wr.Folder?`${this.parent.path}/${n}`:"/",parent:this.parent};return r.pager=this.createFolderPager(r),r}createMediaItemFromTrack(e){var t,n,r;const i="Video"===e.MediaType;return{itemType:wr.Media,mediaType:i?kr.Video:kr.Audio,src:`emby:${i?"video":"audio"}:${e.Id}:${e.PresentationUniqueKey||""}`,externalUrl:this.getExternalUrl(e),fileName:this.getFileName(e.Path||"")||e.Name||"[unknown]",title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,year:e.ProductionYear||void 0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),artists:(null===(r=e.Artists)||void 0===r?void 0:r.length)?e.Artists:e.AlbumArtist?[e.AlbumArtist]:void 0,albumArtist:e.AlbumArtist||void 0,album:e.Album||void 0,disc:e.Album&&e.ParentIndexNumber||void 0,track:e.Album&&e.IndexNumber||0}}createThumbnails(e){var t;const n=(null===(t=e.ImageTags)||void 0===t?void 0:t.Primary)?e.Id:e.AlbumId;return n?[this.createThumbnail(n,120),this.createThumbnail(n,240),this.createThumbnail(n,360),this.createThumbnail(n,480)]:void 0}createThumbnail(e,t,n=t){return{url:`${Xi.host}/Items/${e}/Images/Primary?fillWidth=${t}&fillHeight=${n}`,width:t,height:n}}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),n=new Yr([t]),r=new ga(`Users/${Xi.userId}/Items`,{AlbumArtistIds:e.Id,IncludeItemTypes:"MusicAlbum",SortBy:"ProductionYear,SortName",SortOrder:"Descending"});return new yi(void 0,r,n)}createArtistAllTracks(e){return{itemType:wr.Album,src:`emby:all-tracks:${e.Id}`,title:"All Songs",artist:e.Name||"",thumbnails:this.createThumbnails(e),pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new ga(`Users/${Xi.userId}/Items`,{ArtistIds:e.Id,IncludeItemTypes:"Audio",SortBy:"SortName",SortOrder:"Ascending"})}createAlbumTracksPager(e){return new ga(`Users/${Xi.userId}/Items`,{ParentId:e.Id,SortBy:"ParentIndexNumber,IndexNumber",SortOrder:"Ascending"})}createPlaylistPager(e){return new ga(`Playlists/${e.Id}/Items`,{UserId:Xi.userId,MediaType:"Audio",Fields:"ChildCount"})}createFolderPager(e){var t;const[,,n]=e.src.split(":"),r=new ga(`Users/${Xi.userId}/Items`,{ParentId:n,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path,PresentationUniqueKey",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,FileName",SortOrder:"Ascending"},{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===wr.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new Yr([e]);return new yi(t,r)}return r}getExternalUrl(e){return`${Xi.host}/web/index.html#!/item?id=${e.Id}&serverId=${Xi.serverId}`}getFileName(e){return e.split(/[/\\]/).pop()}getRating(e,t){const n=t.UserData;return Vr.get(e,n?n.IsFavorite?1:0:void 0)}}ga.minPageSize=10,ga.maxPageSize=500;const wa=ga;var Ea=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const ka="emby",xa="AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName",Sa={view:"details",fields:["Index","Artist","Title","Album","Duration","Genre","PlayCount"]},Ta={id:"emby/liked-songs",title:"My Songs",icon:"heart",itemType:wr.Media,viewType:Sr.Ratings,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>Ya({ParentId:Ka(),Filters:"IsFavorite",SortBy:"AlbumArtist,Album,SortName"})},Aa={id:"emby/liked-albums",title:"My Albums",icon:"heart",itemType:wr.Album,viewType:Sr.Ratings,search:()=>Ya({ParentId:Ka(),Filters:"IsFavorite",IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"})},Pa={id:"emby/liked-artists",title:"My Artists",icon:"heart",itemType:wr.Artist,viewType:Sr.Ratings,defaultHidden:!0,search:()=>new wa("Artists/AlbumArtists",{ParentId:Ka(),isFavorite:!0,UserId:Xi.userId})},Ia={id:"emby/recently-played",title:"Recently Played",icon:"clock",itemType:wr.Media,viewType:Sr.RecentlyPlayed,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>Ya({ParentId:Ka(),SortBy:"DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},Ca={id:"emby/most-played",title:"Most Played",icon:"most-played",itemType:wr.Media,viewType:Sr.MostPlayed,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>Ya({ParentId:Ka(),SortBy:"PlayCount,DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},Ma={id:"emby/playlists",title:"Playlists",icon:"playlist",itemType:wr.Playlist,secondaryLayout:Sa,search:()=>Ya({ParentId:Ka(),SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Playlist"})},Oa={id:"emby/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:wr.Media,viewType:Sr.ByGenre,defaultHidden:!0,search:e=>e?Ya({ParentId:Ka(),GenreIds:e.id,IncludeItemTypes:"Audio",SortBy:xa}):new Yr},Na={id:"emby/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:wr.Album,viewType:Sr.ByGenre,search:e=>e?Ya({ParentId:Ka(),GenreIds:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new Yr},$a={id:"emby/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:wr.Artist,viewType:Sr.ByGenre,defaultHidden:!0,search:e=>e?new wa("Artists/AlbumArtists",{ParentId:Ka(),GenreIds:e.id,UserId:Xi.userId}):new Yr},za={id:"emby/tracks-by-decade",title:"Songs by Decade",icon:"calendar",itemType:wr.Media,viewType:Sr.ByDecade,defaultHidden:!0,search:e=>e?Ya({ParentId:Ka(),Years:e.id,IncludeItemTypes:"Audio",SortBy:xa}):new Yr},ja={id:"emby/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:wr.Album,viewType:Sr.ByDecade,search:e=>e?Ya({ParentId:Ka(),Years:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new Yr},La={id:"emby/random-tracks",title:"Random Songs",icon:"shuffle",itemType:wr.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>Ya({ParentId:Ka(),IncludeItemTypes:"Audio",SortBy:"Random"},{maxSize:100})},Ra={id:"emby/random-albums",title:"Random Albums",icon:"shuffle",itemType:wr.Album,search:()=>Ya({ParentId:Ka(),IncludeItemTypes:"MusicAlbum",SortBy:"Random"},{maxSize:100})},Da={id:"emby/videos",title:"Music Videos",icon:"video",itemType:wr.Media,mediaType:kr.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search({q:e=""}={}){const t=Xi.videoLibraryId;if(!t)throw new Hi;return Ya({ParentId:t,SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",SearchTerm:e})}},Fa={id:"emby/folders",title:"Folders",icon:"folder",itemType:wr.Folder,viewType:Sr.Folders,search(){const e={itemType:wr.Folder,src:"",title:"Folders",fileName:"",path:""};return e.pager=new Yi((()=>Xi.libraries.map((({id:t,title:n})=>{const r={itemType:wr.Folder,src:`emby:folder:${t}`,title:n,fileName:n,path:`/${n}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new Yr([i]),s=new wa(`Users/${Xi.userId}/Items`,{ParentId:t,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path,PresentationUniqueKey",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,FileName",SortOrder:"Ascending"},void 0,r);return r.pager=new yi(a,s),r})))),e.pager}},_a={id:ka,icon:ka,name:"Emby",url:"https://emby.media/",serviceType:vr.PersonalMedia,defaultHidden:!0,roots:[Ba(wr.Media,{title:"Songs"}),Ba(wr.Album,{title:"Albums"}),Ba(wr.Artist,{title:"Artists"}),Ba(wr.Playlist,{title:"Playlists",secondaryLayout:Sa})],sources:[Ta,Aa,Pa,Ca,Ia,Ma,Oa,Na,$a,za,ja,La,Ra,Da,Fa],labels:{[yr.Like]:"Add to Emby Favorites",[yr.Unlike]:"Remove from Emby Favorites"},get audioLibraries(){return Xi.audioLibraries},get libraryId(){return Xi.libraryId},set libraryId(e){Xi.libraryId=e},get libraries(){return Xi.libraries},set libraries(e){Xi.libraries=e},observeLibraryId:()=>Xi.observeLibraryId(),canRate:Va,canStore:()=>!1,compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:wr.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":");return Ya({ids:t,IncludeItemTypes:"Playlist"})}}},getFilters:function(e,t){return Ea(this,void 0,void 0,(function*(){return la.getFilters(e,t)}))},getMetadata:function(e){return Ea(this,void 0,void 0,(function*(){if(!Va(e)||void 0!==e.rating)return e;const t=Vr.get(e);if(void 0!==t)return Object.assign(Object.assign({},e),{rating:t});const[,,n]=e.src.split(":"),r=new wa(`Users/${Xi.userId}/Items/${n}`,void 0,{pageSize:1,maxSize:1}),i=yield Hr(r,{timeout:2e3});return k(e,i[0])}))},getPlayableUrlFromSrc:function(e){return la.getPlayableUrlFromSrc(e,Xi)},lookup:function(e,t,n=10,r){return Ea(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:n,maxSize:n,lookup:!0};return Hr(Ha(wr.Media,t,{Artists:e},i),{timeout:r})}))},rate:function(e,t){return Ea(this,void 0,void 0,(function*(){const[,,n]=e.src.split(":"),r=`Users/${Xi.userId}/FavoriteItems/${n}`;t?yield la.post(r):yield la.delete(r)}))},observeIsLoggedIn:function(){return ma.pipe(Or())},isLoggedIn:ha,login:function(){return ca(this,void 0,void 0,(function*(){if(!ha()){ua.log("connect");try{const e=yield ta();if(e){const{serverId:t,userId:n,token:r}=JSON.parse(e);Xi.serverId=t,Xi.userId=n,fa(r)}}catch(e){ua.error(e)}}}))},logout:function(){return ca(this,void 0,void 0,(function*(){ua.log("disconnect"),Xi.clear(),fa(""),ma.next(!1)}))}},Ua=_a;function Va(e){switch(e.itemType){case wr.Album:return!e.synthetic;case wr.Folder:return!1;default:return!0}}function Ba(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`emby/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>Ha(e,t)})}function Ha(e,t,n,r){const i=Object.assign({ParentId:Ka(),SortBy:"SortName",SearchTerm:t.trim()},n);if(e===wr.Artist)return new wa("Artists",Object.assign(Object.assign({},i),{UserId:Xi.userId}),r);switch(e){case wr.Media:i.IncludeItemTypes="Audio",i.SortBy=xa;break;case wr.Album:i.IncludeItemTypes="MusicAlbum",i.SortBy="AlbumArtist,SortName";break;case wr.Playlist:i.IncludeItemTypes="Playlist"}return Ya(i,r)}function Ya(e,t){return new wa(`Users/${Xi.userId}/Items`,e,t)}function Ka(){const e=Xi.libraryId;if(!e)throw new Bi;return e}Vr.addObserver(_a);const Wa=new Qi("jellyfin");var qa=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Ga={delete:function(e,t){return qa(this,void 0,void 0,(function*(){return la.delete(e,t,Wa)}))},get:function(e,t){return qa(this,void 0,void 0,(function*(){return la.get(e,t,Wa)}))},getFilters:function(e,t){return qa(this,void 0,void 0,(function*(){return la.getFilters(e,t,Wa)}))},getMusicLibraries:function(){return qa(this,void 0,void 0,(function*(){return la.getMusicLibraries(Wa)}))},post:function(e,t={}){return qa(this,void 0,void 0,(function*(){return la.post(e,t,Wa)}))},getPlayableUrlFromSrc:function(e){return la.getPlayableUrlFromSrc(e,Wa)}};var Ja=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Qa=new N("jellyfinAuth"),Xa=new $e(""),Za=new $e(!1);function es(){return Za.getValue()}function ts(e){Wa.token=e,Xa.next(e)}Xa.pipe(Or()).pipe(De((e=>""!==e)),kn((()=>function(){return Ja(this,void 0,void 0,(function*(){try{const e=yield Ga.getMusicLibraries();return Wa.libraries=e,!0}catch(e){return Qa.error(e),Xa.next(""),!1}}))}()))).subscribe(Za),ts(Wa.token);class ns{constructor(e,t={},n,r){this.path=e,this.params=t,this.parent=r,this.pageSize=(null==n?void 0:n.pageSize)||200,this.pager=new ya((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},n))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){var t,n,r,i,a,s;return r=this,i=void 0,s=function*(){const r=Object.assign(Object.assign({IncludeItemTypes:"Audio",Fields:"AudioInfo,Genres,Path",EnableUserData:!0,Recursive:!0,ImageTypeLimit:1,EnableImageTypes:"Primary",EnableTotalRecordCount:!0},this.params),{Limit:String(this.pageSize),StartIndex:String((e-1)*this.pageSize)}),i=yield Ga.get(this.path,r);return i.Type?{items:[this.createMediaObject(i)],total:1}:{items:(null===(t=i.Items)||void 0===t?void 0:t.map((e=>this.createMediaObject(e))))||[],total:i.TotalRecordCount||(null===(n=i.Items)||void 0===n?void 0:n.length)}},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(n,o)}l((s=s.apply(r,i||[])).next())}))}createMediaObject(e){var t;if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===wr.Folder&&e.IsFolder)return this.createMediaFolder(e);{let t;switch(e.Type){case"MusicArtist":t=this.createMediaArtist(e);break;case"MusicAlbum":t=this.createMediaAlbum(e);break;case"Playlist":t=this.createMediaPlaylist(e);break;default:t=this.createMediaItem(e)}return xs.canRate(t)&&(t.rating=this.getRating(t,e)),t}}createMediaArtist(e){var t;return{itemType:wr.Artist,src:`jellyfin:artist:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",playCount:(null===(t=e.UserData)||void 0===t?void 0:t.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),pager:this.createArtistAlbumsPager(e)}}createMediaAlbum(e){var t,n;return{itemType:wr.Album,src:`jellyfin:album:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),trackCount:e.ChildCount||void 0,pager:this.createAlbumTracksPager(e),artist:e.AlbumArtist||void 0,year:e.ProductionYear||void 0}}createMediaPlaylist(e){var t,n;const r=`jellyfin:playlist:${e.Id}`;return{src:r,itemType:wr.Playlist,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),trackCount:e.ChildCount||void 0,pager:this.createPlaylistPager(e),isPinned:xi.isPinned(r)}}createMediaFolder(e){var t;const n=this.getFileName(e.Path||"")||e.Name||"[unknown]",r={itemType:wr.Folder,src:`jellyfin:folder:${e.Id}`,title:e.Name||"[unknown]",fileName:n,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===wr.Folder?`${this.parent.path}/${n}`:"/",parent:this.parent};return r.pager=this.createFolderPager(r),r}createMediaItem(e){var t,n,r;const i="Video"===e.MediaType;return{itemType:wr.Media,mediaType:i?kr.Video:kr.Audio,src:`jellyfin:${i?"video":"audio"}:${e.Id}`,externalUrl:this.getExternalUrl(e),fileName:this.getFileName(e.Path||"")||e.Name||"[unknown]",title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,year:e.ProductionYear||void 0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e),artists:(null===(r=e.Artists)||void 0===r?void 0:r.length)?e.Artists:e.AlbumArtist?[e.AlbumArtist]:void 0,albumArtist:e.AlbumArtist||void 0,album:e.Album||void 0,disc:e.Album&&e.ParentIndexNumber||void 0,track:e.Album&&e.IndexNumber||0}}createThumbnails(e){var t;const n=(null===(t=e.ImageTags)||void 0===t?void 0:t.Primary)?e.Id:e.AlbumId;return n?[this.createThumbnail(n,120),this.createThumbnail(n,240),this.createThumbnail(n,360),this.createThumbnail(n,480)]:void 0}createThumbnail(e,t,n=t){return{url:`${Wa.host}/Items/${e}/Images/Primary?fillWidth=${t}&fillHeight=${n}`,width:t,height:n}}createAlbumTracksPager(e){return new ns(`Users/${Wa.userId}/Items`,{ParentId:e.Id,SortBy:"SortName",SortOrder:"Ascending"})}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),n=new Yr([t]),r=new ns(`Users/${Wa.userId}/Items`,{AlbumArtistIds:e.Id,IncludeItemTypes:"MusicAlbum",SortBy:"ProductionYear,SortName",SortOrder:"Descending,Ascending"});return new yi(void 0,r,n)}createArtistAllTracks(e){return{itemType:wr.Album,src:`jellyfin:all-tracks:${e.Id}`,title:"All Songs",artist:e.Name||"",thumbnails:this.createThumbnails(e),pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new ns(`Users/${Wa.userId}/Items`,{ArtistIds:e.Id,IncludeItemTypes:"Audio",SortBy:"Name",SortOrder:"Ascending"})}createPlaylistPager(e){return new ns(`Playlists/${e.Id}/Items`,{UserId:Wa.userId,MediaType:"Audio",Fields:"ChildCount"})}createFolderPager(e){var t;const[,,n]=e.src.split(":"),r=new ns(`Users/${Wa.userId}/Items`,{ParentId:n,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,SortName",SortOrder:"Ascending"},{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===wr.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new Yr([e]);return new yi(t,r)}return r}getExternalUrl(e){return`${Wa.host}/web/index.html#!/details?id=${e.Id}&serverId=${Wa.serverId}`}getFileName(e){return e.split(/[/\\]/).pop()}getRating(e,t){const n=t.UserData;return Vr.get(e,n?n.IsFavorite?1:0:void 0)}}ns.minPageSize=10,ns.maxPageSize=500;const rs=ns;var is=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const as="jellyfin",ss={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","PlayCount"]},os={id:"jellyfin/liked-songs",title:"My Songs",icon:"heart",itemType:wr.Media,viewType:Sr.Ratings,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>Ps({ParentId:Is(),Filters:"IsFavorite",SortBy:"AlbumArtist,Album,SortName"})},ls={id:"jellyfin/liked-albums",title:"My Albums",icon:"heart",itemType:wr.Album,viewType:Sr.Ratings,search:()=>Ps({ParentId:Is(),Filters:"IsFavorite",IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"})},cs={id:"jellyfin/liked-artists",title:"My Artists",icon:"heart",itemType:wr.Artist,viewType:Sr.Ratings,defaultHidden:!0,search:()=>new rs("Artists/AlbumArtists",{ParentId:Is(),isFavorite:!0,UserId:Wa.userId})},us={id:"jellyfin/recently-played",title:"Recently Played",icon:"clock",itemType:wr.Media,viewType:Sr.RecentlyPlayed,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>Ps({ParentId:Is(),SortBy:"DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},ds={id:"jellyfin/most-played",title:"Most Played",icon:"most-played",itemType:wr.Media,viewType:Sr.MostPlayed,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>Ps({ParentId:Is(),SortBy:"PlayCount,DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},ms={id:"jellyfin/playlists",title:"Playlists",icon:"playlist",itemType:wr.Playlist,secondaryLayout:ss,search:()=>Ps({ParentId:Is(),SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Playlist"})},hs={id:"jellyfin/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:wr.Media,viewType:Sr.ByGenre,defaultHidden:!0,search:e=>e?Ps({ParentId:Is(),GenreIds:e.id,IncludeItemTypes:"Audio",SortBy:"AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName"}):new Yr},fs={id:"jellyfin/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:wr.Album,viewType:Sr.ByGenre,search:e=>e?Ps({ParentId:Is(),GenreIds:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new Yr},ps={id:"jellyfin/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:wr.Artist,viewType:Sr.ByGenre,defaultHidden:!0,search:e=>e?new rs("Artists/AlbumArtists",{ParentId:Is(),GenreIds:e.id,UserId:Wa.userId}):new Yr},vs={id:"jellyfin/tracks-by-decade",title:"Songs by Decade",icon:"calendar",itemType:wr.Media,viewType:Sr.ByDecade,defaultHidden:!0,search:e=>e?Ps({ParentId:Is(),Years:e.id,IncludeItemTypes:"Audio",SortBy:"AlbumArtist,Album,ParentIndexNumber,IndexNumber,SortName"}):new Yr},bs={id:"jellyfin/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:wr.Album,viewType:Sr.ByDecade,search:e=>e?Ps({ParentId:Is(),Years:e.id,IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"}):new Yr},ys={id:"jellyfin/random-tracks",title:"Random Songs",icon:"shuffle",itemType:wr.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>Ps({ParentId:Is(),IncludeItemTypes:"Audio",SortBy:"Random"},{maxSize:100})},gs={id:"jellyfin/random-albums",title:"Random Albums",icon:"shuffle",itemType:wr.Album,search:()=>Ps({ParentId:Is(),IncludeItemTypes:"MusicAlbum",SortBy:"Random"},{maxSize:100})},ws={id:"jellyfin/videos",title:"Music Videos",icon:"video",itemType:wr.Media,mediaType:kr.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search({q:e=""}={}){const t=Wa.videoLibraryId;if(!t)throw new Hi;return Ps({ParentId:t,SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"MusicVideo",SearchTerm:e})}},Es={id:"jellyfin/folders",title:"Folders",icon:"folder",itemType:wr.Folder,viewType:Sr.Folders,search(){const e={itemType:wr.Folder,src:"",title:"Folders",fileName:"",path:""};return e.pager=new Yi((()=>Wa.libraries.map((({id:t,title:n})=>{const r={itemType:wr.Folder,src:`jellyfin:folder:${t}`,title:n,fileName:n,path:`/${n}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new Yr([i]),s=new rs(`Users/${Wa.userId}/Items`,{ParentId:t,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio,MusicVideo",Fields:"AudioInfo,Genres,UserData,ParentId,Path",EnableUserData:!0,Recursive:!1,SortBy:"IsFolder,IndexNumber,SortName",SortOrder:"Ascending"},void 0,r);return r.pager=new yi(a,s),r})))),e.pager}},ks={id:as,icon:as,name:"Jellyfin",url:"https://jellyfin.org",serviceType:vr.PersonalMedia,defaultHidden:!0,roots:[Ts(wr.Media,{title:"Songs"}),Ts(wr.Album,{title:"Albums"}),Ts(wr.Artist,{title:"Artists"}),Ts(wr.Playlist,{title:"Playlists",secondaryLayout:ss})],sources:[os,ls,cs,ds,us,ms,hs,fs,ps,vs,bs,ys,gs,ws,Es],labels:{[yr.Like]:"Add to Jellyfin Favorites",[yr.Unlike]:"Remove from Jellyfin Favorites"},get audioLibraries(){return Wa.audioLibraries},get libraryId(){return Wa.libraryId},set libraryId(e){Wa.libraryId=e},get libraries(){return Wa.libraries},set libraries(e){Wa.libraries=e},observeLibraryId:()=>Wa.observeLibraryId(),canRate:Ss,canStore:()=>!1,compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:wr.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":");return Ps({ids:t,IncludeItemTypes:"Playlist"})}}},getFilters:function(e,t){return is(this,void 0,void 0,(function*(){return Ga.getFilters(e,t)}))},getMetadata:function(e){return is(this,void 0,void 0,(function*(){if(!Ss(e)||void 0!==e.rating)return e;const t=Vr.get(e);if(void 0!==t)return Object.assign(Object.assign({},e),{rating:t});const[,,n]=e.src.split(":"),r=new rs(`Users/${Wa.userId}/Items/${n}`,void 0,{pageSize:1,maxSize:1}),i=yield Hr(r,{timeout:2e3});return k(e,i[0])}))},getPlayableUrlFromSrc:function(e){return Ga.getPlayableUrlFromSrc(e)},lookup:function(e,t,n=10,r){return is(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:n,maxSize:n,lookup:!0};return Hr(As(wr.Media,t,{Artists:e},i),{timeout:r})}))},rate:function(e,t){return is(this,void 0,void 0,(function*(){const[,,n]=e.src.split(":"),r=`Users/${Wa.userId}/FavoriteItems/${n}`;t?yield Ga.post(r):yield Ga.delete(r)}))},observeIsLoggedIn:function(){return Za.pipe(Or())},isLoggedIn:es,login:function(){return Ja(this,void 0,void 0,(function*(){if(!es()){Qa.log("connect");try{const e=yield ta(xs,Wa);if(e){const{serverId:t,userId:n,token:r}=JSON.parse(e);Wa.serverId=t,Wa.userId=n,ts(r)}}catch(e){Qa.error(e)}}}))},logout:function(){return Ja(this,void 0,void 0,(function*(){Qa.log("disconnect"),Wa.clear(),ts(""),Za.next(!1)}))}},xs=ks;function Ss(e){switch(e.itemType){case wr.Album:return!e.synthetic;case wr.Folder:return!1;default:return!0}}function Ts(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`jellyfin/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>As(e,t)})}function As(e,t,n,r){const i=Object.assign({ParentId:Is(),SortBy:"SortName",SearchTerm:t.trim()},n);if(e===wr.Artist)return new rs("Artists",Object.assign(Object.assign({},i),{UserId:Wa.userId}),r);switch(e){case wr.Media:i.IncludeItemTypes="Audio",i.SortBy="AlbumArtist,Album,SortName";break;case wr.Album:i.IncludeItemTypes="MusicAlbum",i.SortBy="AlbumArtist,SortName";break;case wr.Playlist:i.IncludeItemTypes="Playlist"}return Ps(i,r)}function Ps(e,t){return new rs(`Users/${Wa.userId}/Items`,e,t)}function Is(){const e=Wa.libraryId;if(!e)throw new Bi;return e}Vr.addObserver(ks);var Cs=n(2568),Ms=n.n(Cs);const Os=new D("lastfm"),Ns={get token(){return Os.getString("token")},set token(e){Os.setString("token",e)},get userId(){return Os.getString("userId")},set userId(e){Os.setString("userId",e)},get sessionKey(){return Os.getString("sessionKey")},set sessionKey(e){Os.setString("sessionKey",e)},get firstScrobbledAt(){return Os.getString("firstScrobbledAt")},set firstScrobbledAt(e){Os.setString("firstScrobbledAt",e)},get playCount(){return Os.getNumber("playCount")},set playCount(e){Os.setNumber("playCount",e)},clear(){Os.clear()}};var $s=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const zs=new N("lastfmAuth"),js=new $e(""),Ls=new $e("");function Rs(){return""!==js.getValue()}function Ds(){return js.pipe(Or()).pipe(wn((e=>""!==e)),Or())}function Fs(e){const t=Object.keys(e);let n="";return t.sort(),t.forEach((t=>n+=t+e[t])),n+=qr,Ms()(n)}Ls.next(Ns.sessionKey),js.next(Ns.token);var _s=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Us=new N("lastfmApi"),Vs=new class{constructor(){this.host="https://ws.audioscrobbler.com/2.0",this.placeholderImage="2a96cbd8b46e442fc41c2b86b821562f.png"}scrobble(e){return _s(this,void 0,void 0,(function*(){Us.log("scrobble",{items:e});const t="track.scrobble";if(1===e.length){const n=e[0],r=String(n.playedAt);yield this.post(Object.assign({method:t,timestamp:r},this.getScrobbleParams(n)))}else if(e.length>0){const n={};e.forEach(((e,t)=>{const r=this.getScrobbleParams(e);n[`timestamp[${t}]`]=String(e.playedAt),Object.keys(r).forEach((e=>{n[`${e}[${t}]`]=r[e]}))})),yield this.post(Object.assign({method:t},n))}}))}updateNowPlaying(e){return _s(this,void 0,void 0,(function*(){Us.log("updateNowPlaying",{item:e});try{this.canScrobble(e)&&(yield this.post(Object.assign({method:"track.updateNowPlaying"},this.getScrobbleParams(e))))}catch(t){Us.log('Failed to update "now playing":',{item:e}),Us.error(t)}}))}getUserInfo(){return _s(this,void 0,void 0,(function*(){return this.get({method:"user.getInfo",user:Ns.userId})}))}createThumbnails(e){const t=e?[this.createThumbnail(e[0],34),this.createThumbnail(e[1],64),this.createThumbnail(e[2],174),this.createThumbnail(e[3],300)].filter(l):[];return 0===t.length?void 0:t}get(e){return _s(this,void 0,void 0,(function*(){const t=`${this.host}?${new URLSearchParams(Object.assign(Object.assign({},e),{api_key:Wr,format:"json"}))}`,n=yield fetch(t,{method:"GET"});if(!n.ok)throw n;return n.json()}))}post(e){return _s(this,void 0,void 0,(function*(){const t=Ns.token,n=Ns.sessionKey,r=Fs(e=Object.assign(Object.assign({},e),{api_key:Wr,token:t,sk:n})),i=`${new URLSearchParams(e)}&api_sig=${r}`,a=yield fetch(this.host,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i});if(!a.ok)throw a;return a}))}getScrobbleParams(e){const t={};return t.track=e.title,t.artist=e.artists[0],e.album&&"[Unknown Album]"!==e.album&&(t.album=e.album,e.albumArtist&&(t.albumArtist=e.albumArtist)),e.duration&&(t.duration=String(Math.round(e.duration))),e.track&&(t.trackNumber=String(e.track)),e.recording_mbid&&(t.mbid=e.recording_mbid),t}canScrobble(e){var t;return!!e&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30}createThumbnail(e,t,n=t){if(e){const r=e["#text"];if(r&&!r.endsWith(this.placeholderImage))return{url:r,width:t,height:n}}}},Bs=Vs;class Hs{constructor(e,t,n,r){this.album=r,this.defaultConfig={minPageSize:Hs.minPageSize,maxPageSize:Hs.maxPageSize,pageSize:50},this.pageNumber=1,this.playCountName="playcount";const i=Object.assign(Object.assign({},this.defaultConfig),n),{page:a}=e,s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["page"]);this.pageNumber=Number(a)||1,this.method=e.method,this.playCountName=i.playCountName||"playcount",this.pager=new vi(((e=this.defaultConfig.pageSize)=>{return n=this,r=void 0,a=function*(){const n=this.pageNumber,r=yield Bs.get(Object.assign(Object.assign({},s),{page:n,limit:e}));this.pageNumber++;const{items:i,total:a,atEnd:o,itemType:l}=t(r);return{items:this.createMediaObjects(l,i),total:a,atEnd:o}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a}),i)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createMediaObjects(e,t){switch(e){case wr.Artist:return t.map((e=>this.createMediaArtist(e)));case wr.Album:return t.map((e=>this.createMediaAlbum(e)));case wr.Media:return t.map((e=>this.createMediaItem(e)));default:return[]}}createMediaItem(e){var t,n,r,i,a,s;const o=e.date&&Number(e.date.uts)||0,l=null===(t=e["@attr"])||void 0===t?void 0:t.rank;return Object.assign(Object.assign({},this.createMediaObject(wr.Media,e)),{mediaType:kr.Audio,src:o?`lastfm:listen:${o}`:`lastfm:track:${Ji()}`,artists:e.artist?[e.artist.name]:void 0,album:(null===(n=this.album)||void 0===n?void 0:n.name)||(null===(r=e.album)||void 0===r?void 0:r["#text"]),albumArtist:null===(i=this.album)||void 0===i?void 0:i.artist.name,release_mbid:(null===(a=this.album)||void 0===a?void 0:a.mbid)||(null===(s=e.album)||void 0===s?void 0:s.mbid),duration:Number(e.duration)||0,track:l&&Number(l)||void 0,rating:"loved"in e?Number(e.loved)||0:"user.getLovedTracks"===this.method?1:void 0,playedAt:o})}createMediaAlbum(e){var t;return Object.assign(Object.assign({},this.createMediaObject(wr.Album,e)),{src:`lastfm:album:${Ji()}`,artist:e.artist.name,year:(null===(t=e.wiki)||void 0===t?void 0:t.published)&&new Date(e.wiki.published).getFullYear()||void 0,pager:this.createAlbumPager(e)})}createMediaArtist(e){return Object.assign(Object.assign({},this.createMediaObject(wr.Artist,e)),{src:`lastfm:artist:${Ji()}`,pager:this.createArtistAlbumsPager(e)})}createArtistTopTracks(e){return{itemType:wr.Album,title:"Top Tracks",thumbnails:Bs.createThumbnails(e.image),src:`lastfm:top-tracks:${Ji()}`,artist:e.name,pager:this.createTopTracksPager(e),synthetic:!0}}createMediaObject(e,t){return{itemType:e,title:t.name,playCount:Number(t[this.playCountName])||void 0,globalPlayCount:"userplaycount"===this.playCountName&&Number(t.playcount)||void 0,thumbnails:Bs.createThumbnails(t.image),externalUrl:t.url||void 0}}createArtistAlbumsPager(e){const t=this.createArtistTopTracks(e),n=new Yr([t]),r=new Hs({method:"artist.getTopAlbums",artist:e.name},(({topalbums:e})=>{const t=e["@attr"];return{items:e.album,total:Number(t.total)||void 0,atEnd:t.page===t.totalPages,itemType:wr.Album}}),{maxSize:100,playCountName:"userplaycount"});return new yi(n,r)}createAlbumPager(e){return new Hs({method:"album.getInfo",album:e.name,artist:e.artist.name,user:Ns.userId},(({album:e})=>{if(e.tracks){const t=e.tracks.track,n=(t?Array.isArray(t)?t:[t]:[]).map((t=>Object.assign(Object.assign({},t),{album:{"#text":e.name},image:t.image||e.image})));return{items:n,total:n.length,atEnd:!0,itemType:wr.Media}}throw Error("No track info")}),{playCountName:"userplaycount"},e)}createTopTracksPager(e){return new Hs({method:"artist.getTopTracks",artist:e.name},(({toptracks:e})=>{const t=e["@attr"];return{items:e.track,total:Number(t.total)||void 0,atEnd:t.page===t.totalPages,itemType:wr.Media}}),{pageSize:10,maxSize:10})}}Hs.minPageSize=10,Hs.maxPageSize=200;const Ys=Hs;class Ks extends Ys{constructor(e,t){super(Object.assign(Object.assign({},e),{method:"user.getRecentTracks",extended:"1",user:Ns.userId}),(({recenttracks:e})=>{var t,n;const r=e["@attr"]||{},i=e.track,a=i?Array.isArray(i)?i:[i]:[],s="true"===(null===(n=null===(t=a[0])||void 0===t?void 0:t["@attr"])||void 0===n?void 0:n.nowplaying),o=Number(r.page)||1,l=Number(r.totalPages)||1,c=1===l||o===l,u=Number(r.total)||void 0;return s&&a.shift(),{items:a,total:u,atEnd:c,itemType:wr.Media}}),t)}}var Ws=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const qs={view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},Gs={view:"details",fields:["AlbumTrack","Title","Artist"]},Js={id:"lastfm/history",title:"History",icon:"clock",itemType:wr.Media,search:({startAt:e=0}={})=>new Ks(e?{to:e}:void 0)},Qs={id:"lastfm/recently-played",title:"Recently Played",icon:"clock",itemType:wr.Media,search:()=>new Ks},Xs={id:"lastfm/loved-tracks",title:"Loved Tracks",icon:"heart",itemType:wr.Media,viewType:Sr.Ratings,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear"]},search:()=>new Ys({method:"user.getLovedTracks",user:Ns.userId},(({lovedtracks:e})=>{const t=e["@attr"]||{},n=e.track,r=n?Array.isArray(n)?n:[n]:[],i=Number(t.page)||1,a=Number(t.totalPages)||1,s=1===a||i===a;return{items:r,total:Number(t.total)||void 0,atEnd:s,itemType:wr.Media}}))},Zs={id:"lastfm",name:"last.fm",icon:"lastfm",url:"https://www.last.fm",serviceType:vr.Scrobbler,defaultHidden:!0,roots:[Qs],sources:[no("user.getTopTracks",{title:"Top Tracks",itemType:wr.Media,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","PlayCount"]}}),no("user.getTopAlbums",{title:"Top Albums",itemType:wr.Album,layout:qs,secondaryLayout:Gs}),no("user.getTopArtists",{title:"Top Artists",itemType:wr.Artist,layout:{view:"card minimal",fields:["Thumbnail","Title","PlayCount"]},secondaryLayout:qs,tertiaryLayout:Gs}),Xs,Js],labels:{[yr.Like]:"Love on last.fm",[yr.Unlike]:"Unlove on last.fm"},canRate:function(e){var t;return e.itemType===wr.Media&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])},canStore:()=>!1,compareForRating:function(e,t){var n,r,i;return e.itemType===wr.Media&&(e.itemType===t.itemType&&!!e.title&&!!(null===(n=e.artists)||void 0===n?void 0:n[0])&&to(e.title,t.title)&&to(null===(r=e.artists)||void 0===r?void 0:r[0],null===(i=t.artists)||void 0===i?void 0:i[0]))},getMetadata:function(e){return Ws(this,void 0,void 0,(function*(){if(e.itemType!==wr.Media||void 0!==e.rating)return e;const t={method:"track.getInfo",user:Ns.userId};if(e.recording_mbid)t.mbid=e.recording_mbid;else{const{title:n,artists:r=[]}=e;if(t.artist=r[0],t.track=n,!t.artist)return e}const{track:n}=yield Bs.get(t);if(!n||"error"in n)throw Error((null==n?void 0:n.message)||"Not found");{const t={};return n.album&&(t.album=n.album.title,t.albumArtist=n.album.artist,e.thumbnails||(t.thumbnails=Bs.createThumbnails(n.album.image))),Object.assign(Object.assign(Object.assign({},e),t),{rating:Vr.get(e,Number(n.userloved)||0),playCount:Number(n.userplaycount)||0,globalPlayCount:Number(n.playcount)||0})}}))},rate:function(e,t){return Ws(this,void 0,void 0,(function*(){if(e.itemType===wr.Media){const{title:n,artists:r=[]}=e,i=r[0];n&&i&&(yield Bs.post({method:t?"track.love":"track.unlove",track:n,artist:i}))}}))},observeIsLoggedIn:Ds,isLoggedIn:Rs,login:function(){return $s(this,void 0,void 0,(function*(){if(!Rs()){zs.log("connect");try{const e=yield function(){return $s(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const n=location.hostname,r=("localhost"===n?`http://${n}:${location.port}`:`https://${n}`)+"/auth/lastfm/callback/";let i=null;const a=n=>{if(/(localhost|ampcast)/.test(n.origin)){if(clearInterval(s),window.removeEventListener("message",a,!1),null==i||i.close(),i=null,n.origin!==location.origin)return void t({message:`Origin ${n.origin} does not match ${location.origin}`});e(n.data.token)}};window.addEventListener("message",a,!1),i=window.open(`https://www.last.fm/api/auth?api_key=${Wr}&cb=${r}`,"last.fm","popup");const s=setInterval((()=>{(null==i?void 0:i.closed)&&(clearInterval(s),t({message:"access_denied"}))}),500)}))}))}(),t=yield function(e){return $s(this,void 0,void 0,(function*(){const t="auth.getSession",n=Fs({api_key:Wr,token:e,method:t}),r=yield fetch(`https://ws.audioscrobbler.com/2.0?method=${t}&api_key=${Wr}&token=${e}&api_sig=${n}&format=json`);if(!r.ok)throw r;const{session:i}=yield r.json();return Ns.userId=i.name,Ns.token=e,Ns.sessionKey=i.key,i.key}))}(e);Ls.next(t),js.next(e)}catch(e){zs.error(e)}}}))},logout:function(){return $s(this,void 0,void 0,(function*(){zs.log("disconnect"),Ns.clear(),Ls.next(""),js.next("")}))}},eo=Zs;function to(e,t=""){return 0===e.localeCompare(t,void 0,{sensitivity:"accent"})}function no(e,t){return Object.assign(Object.assign({},t),{id:`lastfm/top/${e.slice(11).toLowerCase()}`,icon:"star",searchable:!1,search:({period:n="overall"}={})=>new Ys({method:e,period:n,user:Ns.userId},(n=>{const[,r]=e.toLowerCase().split("."),i=n[r.slice(3)],a=i["@attr"],s=i[r.slice(6,-1)],o=Number(a.page)||1,l=Number(a.totalPages)||1,c=1===l||o===l;return{items:s,total:Number(a.total)||void 0,atEnd:c,itemType:t.itemType}}))})}Vr.addObserver(Zs,5);const ro=new D("listenbrainz"),io={get token(){return ro.getString("token")},set token(e){ro.setString("token",e)},get userId(){return ro.getString("userId")},set userId(e){ro.setString("userId",e)},get firstScrobbledAt(){return ro.getString("firstScrobbledAt")},set firstScrobbledAt(e){ro.setString("firstScrobbledAt",e)},clear(){ro.clear()}};var ao=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const so=new N("listenbrainzApi"),oo=new class{constructor(){this.host="https://api.listenbrainz.org/1",this.rateLimitRemainingCalls=2,this.rateLimitResetTime=0}rate(e,t){return ao(this,void 0,void 0,(function*(){if(e.recording_msid||e.recording_mbid){const n="feedback/recording-feedback",r={score:t};e.recording_msid&&(r.recording_msid=e.recording_msid),e.recording_mbid&&(r.recording_mbid=e.recording_mbid);const i=yield this.post(n,r);if(!i.ok)throw i}}))}addRatings(e){return ao(this,void 0,void 0,(function*(){if((e=e.filter((e=>!!e.recording_msid||!!e.recording_mbid))).length>0){const t=yield this.getRatings(e);zr.dispatch(e.map(((e,n)=>({match:t=>yl(t,e),values:{rating:t[n]}}))))}}))}getRatings(e){return ao(this,void 0,void 0,(function*(){if((e=e.filter((e=>!!e.recording_msid||!!e.recording_mbid))).length>0){const[t,n]=d(e,(e=>!!e.recording_mbid)),r=t.map((e=>e.recording_mbid)),i=n.map((e=>e.recording_msid)),a={};r.length>0&&(a.recording_mbids=r),i.length>0&&(a.recording_msids=i);const{feedback:s}=yield this.get(`feedback/user/${io.userId}/get-feedback-for-recordings`,a);return e.map((e=>{var t;return 1===(null===(t=s.find((t=>!!e.recording_mbid&&e.recording_mbid===t.recording_mbid||!!e.recording_msid&&e.recording_msid===t.recording_msid)))||void 0===t?void 0:t.score)?1:0}))}return[]}))}getListeningActivity({range:e="all_time"}={}){return ao(this,void 0,void 0,(function*(){const{payload:{listening_activity:t}}=yield this.get(`stats/user/${io.userId}/listening-activity`,{range:e});return t}))}getListenCount(){return ao(this,void 0,void 0,(function*(){const{payload:{count:e}}=yield this.get(`user/${io.userId}/listen-count`);return e}))}getListens(e){return ao(this,void 0,void 0,(function*(){return yield this.get(`user/${io.userId}/listens`,e)}))}scrobble(e){return ao(this,void 0,void 0,(function*(){e.length>0&&(so.log("scrobble",{items:e}),yield this.post("submit-listens",{listen_type:1===e.length?"single":"import",payload:e.map((e=>({listened_at:e.playedAt,track_metadata:this.getScrobbleParams(e)})))}))}))}updateNowPlaying(e){return ao(this,void 0,void 0,(function*(){so.log("updateNowPlaying",{item:e});try{this.canScrobble(e)&&(yield this.post("submit-listens",{listen_type:"playing_now",payload:[{track_metadata:this.getScrobbleParams(e)}]}))}catch(t){so.log('Failed to update "now playing":',{item:e}),so.error(t)}}))}get(e,t,n){return ao(this,void 0,void 0,(function*(){t&&(e=`${e}?${new URLSearchParams(t)}`);const r=yield this.fetch(e,{method:"GET"},n);if(!r.ok||204===r.status)throw r;return r.json()}))}post(e,t){return ao(this,void 0,void 0,(function*(){const n=JSON.stringify(t);return this.fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:n},!0)}))}fetch(e,t,n=!1){return ao(this,void 0,void 0,(function*(){yield this.applyRateLimiting(),n&&(t.headers=Object.assign(Object.assign({},t.headers),{Authorization:`Token ${io.token}`})),e.startsWith("/")&&(e=e.slice(1));const r=yield window.fetch(`${this.host}/${e}`,t);if(!r.ok)throw r;const i=r.headers;return i.has("x-ratelimit-remaining")&&(this.rateLimitRemainingCalls=Number(i.get("x-ratelimit-remaining"))||1),i.has("x-ratelimit-reset-in")&&(this.rateLimitResetTime=Date.now()+1e3*(Number(i.get("x-ratelimit-reset-in"))||1)),this.rateLimitRemainingCalls<5&&so.log({rateLimitRemainingCalls:this.rateLimitRemainingCalls,rateLimitReset:new Date(this.rateLimitResetTime).toISOString()}),r}))}getScrobbleParams(e){const t={media_player:"ampcast",media_player_version:"0.8.22",submission_client:"ampcast"};e.duration&&(t.duration=Math.round(e.duration)),e.track&&(t.tracknumber=e.track),e.artist_mbids&&(t.artist_mbids=e.artist_mbids),e.release_mbid&&(t.release_mbid=e.release_mbid),e.recording_mbid&&(t.recording_mbid=e.recording_mbid),e.isrc&&(t.isrc=e.isrc);const[n]=e.src.split(":");switch(n){case"spotify":e.externalUrl&&(t.origin_url=e.externalUrl,t.spotify_id=e.externalUrl),t.music_service="spotify.com";break;case"apple":e.externalUrl&&(t.origin_url=e.externalUrl),t.music_service="music.apple.com";break;case"youtube":e.externalUrl&&(t.origin_url=e.externalUrl),t.music_service="youtube.com";break;case"jellyfin":t.music_service_name="Jellyfin";break;case"plex":t.music_service_name="Plex";break;case"blob":case"file":t.music_service_name="Local file"}const r={track_name:e.title,artist_name:e.artists[0],additional_info:t};return e.album&&"[Unknown Album]"!==e.album&&(r.release_name=e.album),r}canScrobble(e){var t;return!!e&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30}applyRateLimiting(){return new Promise((e=>{if(this.rateLimitRemainingCalls)this.rateLimitRemainingCalls--,e();else{const t=this.rateLimitResetTime-Date.now();t>0?setTimeout(e,t):e()}}))}},lo=oo;var co=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function uo(e){var{href:t,className:n="",children:i=t}=e,a=co(e,["href","className","children"]);return r.createElement("a",Object.assign({},a,{className:`external-link ${n}`,href:t,target:"_blank",rel:"noopener"}),r.createElement("span",{className:"external-link-text"},i),r.createElement($t,{name:"link"}))}var mo=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function ho(e){const t=vl.id,[n,i]=(0,r.useState)(!1),[a,s]=(0,r.useState)(""),o=(0,r.useRef)(null),l=(0,r.useRef)(null),c=(0,r.useRef)(null),u="https://listenbrainz.org/profile/",d=r.createElement(Ki,{icon:vl.icon,text:`Log in to ${vl.name}`}),m=(0,r.useCallback)((()=>mo(this,void 0,void 0,(function*(){try{const e=l.current.value,t=c.current.value;io.userId=e,i(!0),s("Connecting...");const n=yield fetch("https://api.listenbrainz.org/1/validate-token",{headers:{"Content-Type":"application/json",Authorization:`Token ${t}`}});if(!n.ok)throw n;const{valid:r,user_name:a}=yield n.json();if(!r)throw Error("Invalid token");if(a!==e)throw Error("Token not valid for this user");s(""),o.current.close(JSON.stringify({userId:e,token:t}))}catch(e){console.error(e),s(e.message||e.statusText||"Error")}i(!1)}))),[]),h=(0,r.useCallback)((e=>{e.preventDefault(),m()}),[m]);return r.createElement(Lt,Object.assign({},e,{className:"listenbrainz-login-dialog login-dialog",title:d,ref:o}),r.createElement("form",{id:`${t}-login`,method:"dialog",onSubmit:h},r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("label",{htmlFor:`${t}-username`},"User:"),r.createElement("input",{type:"text",id:`${t}-username`,name:`${t}-username`,autoFocus:!0,required:!0,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",ref:l})),r.createElement("p",null,r.createElement("label",{htmlFor:`${t}-token`},"Token:"),r.createElement("input",{type:"password",id:`${t}-token`,name:`${t}-token`,required:!0,ref:c}))),r.createElement("p",{className:"message "+(n?"":"error")},a),r.createElement("p",{className:"listenbrainz-link service-link"},r.createElement(uo,{href:u},r.createElement($t,{name:"listenbrainz"}),u)),r.createElement(Vt,{submitText:"Login"})))}var fo=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const po=new N("listenbrainzAuth"),vo=new $e("");function bo(){return""!==vo.getValue()}function yo(){return vo.pipe(Or()).pipe(wn((e=>""!==e)),Or())}vo.next(io.token);var go=n(6998),wo=n.n(go);const Eo="https://musicbrainz.org",ko=new D("youtube"),xo={get connectedAt(){return ko.getNumber("connectedAt")},set connectedAt(e){ko.setNumber("connectedAt",e)},clear(){ko.clear()}};var So=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const To=new N("youtubeAuth"),Ao="https://www.googleapis.com/auth/youtube.readonly",Po=["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],Io=new $e("");function Co(){return""!==Oo()}function Mo(){return Io.pipe(Or()).pipe(wn((e=>""!==e)),Or())}function Oo(){return Io.getValue()}function No(){return So(this,void 0,void 0,(function*(){return window.gapi||(yield c("https://apis.google.com/js/api.js")),window.gapi}))}function $o(){return So(this,void 0,void 0,(function*(){const e=yield No();return e.client?e.client:new Promise(((t,n)=>{e.load("client",{callback:()=>{const r={apiKey:Jr,clientId:Qr,discoveryDocs:Po,scope:Ao};e.client.init(r).then((()=>t(e.client)),n)},onerror:n})}))}))}function zo(){var e,t;return So(this,void 0,void 0,(function*(){return(null===(t=null===(e=window.google)||void 0===e?void 0:e.accounts)||void 0===t?void 0:t.oauth2)||(yield c("https://accounts.google.com/gsi/client")),google.accounts.oauth2}))}Mo().pipe(fr((e=>!e))).subscribe((e=>xo.connectedAt=e?Date.now():0)),Mo().pipe(De((e=>e)),Br(1),kn((()=>Promise.all([No(),$o()]))),Re((([e,t])=>{e.load("client:auth2",(()=>{e.auth2.getAuthInstance().isSignedIn.listen((e=>{if(e){const e=t.getToken();Io.next((null==e?void 0:e.access_token)||"")}else Io.next("")}))}))}))).subscribe(To),xo.connectedAt&&Rn($o()).pipe(wn((e=>e.getToken())),Re((e=>Io.next((null==e?void 0:e.access_token)||"")))).subscribe(To);var jo=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Lo=new N("youtubeCache");class Ro extends wt.ZP{constructor(){super("ampcast/youtube/cache"),this.version(1).stores({entries:"&key, timeStamp"}),setTimeout((()=>this.removeExpired()))}store(e,t){return jo(this,void 0,void 0,(function*(){try{yield this.entries.put({key:e,response:t,timeStamp:Date.now()})}catch(e){Lo.error(e)}}))}fetch(e){return jo(this,void 0,void 0,(function*(){try{const t=yield this.entries.get(e);return null==t?void 0:t.response}catch(e){Lo.error(e)}}))}removeExpired(){const e=Date.now()-12096e5;this.entries.where("timeStamp").below(e).delete()}}const Do=new Ro;var Fo=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},_o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class Uo{constructor(e,t,n){this.defaultConfig={pageSize:Uo.maxPageSize},this.nextPageToken=void 0,this.pageNumber=1,this.config=Object.assign(Object.assign({},this.defaultConfig),n),this.pager=new vi((()=>Fo(this,void 0,void 0,(function*(){return this.fetchPage(e,t)}))),this.config)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems({kind:e,items:t=[]},n){return Fo(this,void 0,void 0,(function*(){switch(e){case"youtube#playlistListResponse":return t.map((e=>this.createMediaPlaylist(e)));case"youtube#playlistItemListResponse":{const e=t.map((e=>e.contentDetails.videoId));return(yield this.fetchVideos(e,n)).map((e=>this.createMediaItem(e)))}case"youtube#searchListResponse":{const e=t.map((e=>e.id.videoId));return(yield this.fetchVideos(e,n)).map((e=>this.createMediaItem(e)))}default:return t.map((e=>this.createMediaItem(e)))}}))}createMediaPlaylist(e){var t,n,r;const i=`youtube:playlist:${e.id}`;return{src:i,itemType:wr.Playlist,externalUrl:`${Ho}/playlist?list=${e.id}`,title:(null===(t=e.snippet)||void 0===t?void 0:t.title)||e.id,thumbnails:this.mapThumbnails(null===(n=e.snippet)||void 0===n?void 0:n.thumbnails),trackCount:null===(r=e.contentDetails)||void 0===r?void 0:r.itemCount,owner:this.createOwner(e.snippet),pager:this.createPlaylistPager(e.id),isPinned:xi.isPinned(i)}}createMediaItem(e){var t,n,r,i,a;return{itemType:wr.Media,mediaType:kr.Video,src:`youtube:video:${e.id}`,externalUrl:Go(e.id),title:(null===(t=e.snippet)||void 0===t?void 0:t.title)||e.id,duration:this.parseDuration(null===(n=e.contentDetails)||void 0===n?void 0:n.duration),thumbnails:this.mapThumbnails(null===(r=e.snippet)||void 0===r?void 0:r.thumbnails),owner:this.createOwner(e.snippet),globalRating:this.parseNumber(null===(i=e.statistics)||void 0===i?void 0:i.likeCount),globalPlayCount:this.parseNumber(null===(a=e.statistics)||void 0===a?void 0:a.viewCount),playedAt:0}}createOwner({channelId:e="",channelTitle:t=""}){return e?{name:t,url:`${Ho}/channel/${e}`}:void 0}createPlaylistPager(e){return new Uo("/playlistItems",{playlistId:e,part:"contentDetails",fields:"items(contentDetails(videoId))"})}mapThumbnails(e){if(e)return Object.keys(e).map((t=>e[t]))}parseDuration(e=""){const[,t=0,n=0,r=0]=/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/.exec(e)||[];return 60*Number(t)*60+60*Number(n)+Number(r)||0}fetchPage(e,t){return Fo(this,void 0,void 0,(function*(){const n=this.createCacheKey(e,t,this.pageNumber),r=yield this.getFromCache(n),i=this.nextPageToken,a=yield this.fetch(e,Object.assign(Object.assign({},t),{fields:`etag,kind,pageInfo,nextPageToken,${t.fields||"items"}`,maxResults:String(this.config.pageSize),pageToken:i}),r),{pageInfo:s,nextPageToken:o}=a,l=_o(a,["pageInfo","nextPageToken"]),c=yield this.createItems(l,n),u=null==s?void 0:s.totalResults,d=!o;return this.nextPageToken=o,this.pageNumber++,yield this.saveToCache(n,a),{items:c,total:u,atEnd:d}}))}fetchVideos(e,t){return Fo(this,void 0,void 0,(function*(){const n=`${t}/videos`,r=yield this.getFromCache(n),i=yield this.fetch("/videos",{id:e.join(","),part:"contentDetails,snippet,statistics",fields:`etag,${Uo.videoFields}`},r);return yield this.saveToCache(n,i),i.items||[]}))}fetch(e,t,n){return Fo(this,void 0,void 0,(function*(){const r=yield $o(),i=(null==n?void 0:n.etag)?{"If-None-Match":n.etag}:void 0,{result:a,status:s,statusText:o}=yield r.request({path:`https://www.googleapis.com/youtube/v3${e}`,params:t,headers:i});if(a)return a;if(304===s&&n)return n;throw Error(o||`Error (${s})`)}))}getFromCache(e){return Fo(this,void 0,void 0,(function*(){return Do.fetch(e)}))}saveToCache(e,t){return Fo(this,void 0,void 0,(function*(){this.config.noCache||(yield Do.store(e,t))}))}createCacheKey(e,t,n){const{fields:r}=t,i=_o(t,["fields"]);return`${e}?${new URLSearchParams(i)}#${n}`}parseNumber(e){if(null!=e&&!isNaN(Number(e)))return Number(e)}}Uo.minPageSize=5,Uo.maxPageSize=50,Uo.videoFields="items(id,snippet(title,thumbnails,channelId,channelTitle),contentDetails(duration),statistics(viewCount,likeCount))",Uo.playlistFields="items(id,snippet(title,thumbnails,channelId,channelTitle),contentDetails(itemCount))";const Vo=Uo;var Bo=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Ho="https://www.youtube.com",Yo={view:"card",fields:["Thumbnail","Title","Duration","Owner","Views"]},Ko={id:"youtube/likes",title:"Likes",icon:"thumbs-up",itemType:wr.Media,mediaType:kr.Video,viewType:Sr.Ratings,layout:Yo,defaultHidden:!0,search:()=>new Vo("/videos",{myRating:"like",part:"snippet,contentDetails,statistics",fields:Vo.videoFields})},Wo={id:"youtube/playlists",title:"Playlists",icon:"playlist",itemType:wr.Playlist,secondaryLayout:Yo,search:()=>new Vo("/playlists",{mine:"true",part:"snippet,contentDetails",fields:Vo.playlistFields})};function qo(e=""){if(e.startsWith("youtube:"))return e;const t=wo()(e);if(t)return`youtube:video:${t}`;if(/youtu\.?be/.test(e)){const t=new URLSearchParams(new URL(e).search).get("list")||"";if(t)return`youtube:playlist:${t}`}return""}function Go(e){return`${Ho}/watch?v=${e}`}function Jo(e){return Bo(this,void 0,void 0,(function*(){const t=Go(e),n=yield fetch(`${Ho}/oembed?url=${t}&format=json`);if(!n.ok)switch(n.status){case 401:throw Error("Embedding prevented by channel owner");case 403:throw Error("Private video");case 404:throw Error("Video does not exist");default:throw Error(`${n.statusText} (${n.status})`)}const r=yield n.json();return{itemType:wr.Media,mediaType:kr.Video,src:`youtube:video:${e}`,externalUrl:t,title:r.title,aspectRatio:r.width/r.height||16/9,duration:0,track:0,thumbnails:[{url:r.thumbnail_url,width:r.thumbnail_width,height:r.thumbnail_height}],owner:{name:r.author_name,url:r.author_url},playedAt:0}}))}const Qo={id:"youtube",name:"YouTube",icon:"youtube",url:"https://www.youtube.com",serviceType:vr.PublicMedia,defaultHidden:!0,defaultNoScrobble:!0,roots:[{id:"youtube/search/videos",title:"Video",icon:"search",itemType:wr.Media,mediaType:kr.Video,layout:Yo,searchable:!0,search:({q:e=""}={})=>e?new Vo("/search",{q:e,type:"video",videoCategoryId:"10",part:"id",fields:"items(id(videoId))"},{maxSize:Vo.maxPageSize,noCache:!0}):new Yr}],sources:[Ko,Wo],canRate:()=>!1,canStore:()=>!1,compareForRating:()=>!1,createSourceFromPin:function(e){return{title:e.title,itemType:wr.Playlist,id:e.src,icon:"pin",isPin:!0,secondaryLayout:Object.assign(Object.assign({},Yo),{view:"card compact"}),search(){const[,,t]=e.src.split(":");return new Vo("/playlists",{id:t,part:"snippet,contentDetails",fields:Vo.playlistFields})}}},observeIsLoggedIn:Mo,isLoggedIn:Co,login:function(){return So(this,void 0,void 0,(function*(){if(!Co()){To.log("connect");try{const e=yield function(){return So(this,void 0,void 0,(function*(){const e=google.accounts.oauth2;return new Promise(((t,n)=>{e.initTokenClient({client_id:Qr,scope:Ao,prompt:"",callback:e=>{e.error?n(e.error_description):t(e.access_token)},error_callback:e=>{n(e.message)}}).requestAccessToken()}))}))}();Io.next(e)}catch(e){To.error(e)}}}))},logout:function(){return So(this,void 0,void 0,(function*(){To.log("disconnect");const e=Oo();e&&(yield zo()).revoke(e,(()=>Io.next("")))}))}},Xo=Qo;const Zo=new N("ListenBrainzHistoryPager");class el{constructor(e,t=!1){this.fetchListenCount=t,this.size$=new di(1),this.nextPageParams=void 0,this.pager=new vi(((t=50)=>{return n=this,r=void 0,a=function*(){try{const{payload:n}=yield lo.get(`user/${io.userId}/listens`,Object.assign(Object.assign(Object.assign({},e),{count:t}),this.nextPageParams)),r=n.listens,i=this.createItems(r),a=i.length<t;return this.nextPageParams=a?void 0:{max_ts:r.at(-1).listened_at-1},{items:i,atEnd:a}}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.size$.pipe(Or())}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new se,this.subscriptions.add(this.pager.observeAdditions().pipe(kn((e=>lo.addRatings(e)))).subscribe(Zo)),this.fetchListenCount&&this.subscriptions.add(Rn(lo.getListenCount()).pipe(Re((e=>this.size$.next(e)))).subscribe(Zo)))}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){var t,n,r;const i=e.track_metadata,a=i.additional_info,s=(null===(t=i.mbid_mapping)||void 0===t?void 0:t.recording_mbid)||void 0,o=this.getPlayableSrc(a)||"";return{itemType:wr.Media,mediaType:o.startsWith("youtube:")?kr.Video:kr.Audio,src:`listenbrainz:listen:${e.listened_at}`,title:i.track_name,addedAt:e.inserted_at,artists:i.artist_name?[i.artist_name]:void 0,albumArtist:null==a?void 0:a.release_artist_name,album:i.release_name,duration:(null==a?void 0:a.duration)||((null==a?void 0:a.duration_ms)?Math.round(a.duration_ms/1e3):0),track:(null==a?void 0:a.tracknumber)||(null==a?void 0:a.track_number),disc:null==a?void 0:a.discnumber,isrc:null==a?void 0:a.isrc,externalUrl:s?`${Eo}/recording/${s}`:void 0,recording_mbid:s,recording_msid:e.recording_msid||void 0,release_mbid:null===(n=i.mbid_mapping)||void 0===n?void 0:n.release_mbid,artist_mbids:null===(r=i.mbid_mapping)||void 0===r?void 0:r.artist_mbids,playedAt:e.listened_at,link:{src:o,externalUrl:this.getExternalUrl(null==a?void 0:a.origin_url)}}}getExternalUrl(e){if(e&&/youtu\.?be/.test(e)){const t=wo()(e);if(t)return Go(t)}return e||void 0}getPlayableSrc(e){var t;if(e){if(e.spotify_id)return this.getSpotifySrc(e.spotify_id);const n=e.origin_url;if(n){if(n.includes("apple.com"))return this.getAppleSrc(n);if(n.includes("spotify.com"))return this.getSpotifySrc(n);if(/youtu\.?be/.test(n))return qo(n)}const r=(null===(t=e.music_service_name)||void 0===t?void 0:t.toLowerCase())||"",i=_d().map((e=>e.id));for(const e of i)if(r.includes(e))return`${e}:`}}getAppleSrc(e){if(e){const t=e.split("i=").pop();if(t)return`apple:song:${t}`}}getSpotifySrc(e){if(e){const t=e.split("/").pop();if(t)return`spotify:track:${t}`}}isNoContentError(e){return 204===(null==e?void 0:e.status)}}el.maxPageSize=100;const tl=el;class nl{constructor(){let e=0;this.pager=new vi(((t=50)=>{return n=this,r=void 0,a=function*(){try{const n=yield lo.get(`feedback/user/${io.userId}/get-feedback`,{score:1,metadata:!0,offset:e,count:t});e+=t;const r=this.createItems(n.feedback),i=n.total_count;return{items:r,total:i,atEnd:n.offset+r.length>=i}}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){var t,n;const r=e.track_metadata,i=r.additional_info,a=e.recording_mbid;return{itemType:wr.Media,mediaType:kr.Audio,src:`listenbrainz:track:${Ji()}`,title:r.track_name,artists:r.artist_name?[r.artist_name]:void 0,albumArtist:null==i?void 0:i.release_artist_name,album:r.release_name,duration:(null==i?void 0:i.duration)||((null==i?void 0:i.duration_ms)?Math.round(i.duration_ms/1e3):0),track:(null==i?void 0:i.tracknumber)||(null==i?void 0:i.track_number),disc:null==i?void 0:i.discnumber,isrc:null==i?void 0:i.isrc,externalUrl:a?`${Eo}/recording/${a}`:void 0,recording_mbid:a,recording_msid:e.recording_msid||void 0,release_mbid:null===(t=r.mbid_mapping)||void 0===t?void 0:t.release_mbid,artist_mbids:null===(n=r.mbid_mapping)||void 0===n?void 0:n.artist_mbids,playedAt:0,rating:1}}isNoContentError(e){return 204===(null==e?void 0:e.status)}}nl.maxPageSize=100;const rl=nl;var il=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const al=new class{constructor(){this.host="https://musicbrainz.org/ws/2",this.lastCall=0}getISRCs(e){return il(this,void 0,void 0,(function*(){return(yield this.get(`/recording/${e}`,{inc:"isrcs"})).isrcs||[]}))}getRecordingsByISRC(e){return il(this,void 0,void 0,(function*(){return(yield this.get(`/isrc/${e}`)).recordings||[]}))}get(e,t={}){return il(this,void 0,void 0,(function*(){e.startsWith("/")&&(e=e.slice(1)),t.fmt="json",e=`${e}?${new URLSearchParams(t)}`,yield this.applyRateLimiting(),this.lastCall=Date.now();const n=yield fetch(`${this.host}/${e}`,{method:"GET",headers:{"User-Agent":"ampcast/0.8.22 ( rekkyrosso@gmail.com )"}});if(!n.ok)throw n;return yield n.json()}))}applyRateLimiting(){return new Promise((e=>{const t=Date.now()-this.lastCall;t>1e3?e():setTimeout((()=>e),t)}))}};class sl{constructor(e,t){this.release_mbid=e,this.pager=new vi((()=>{return n=this,r=void 0,a=function*(){var n;const{media:r=[]}=yield al.get(`release/${e}`,{inc:"recordings"});return{items:this.createItems((null===(n=r[0])||void 0===n?void 0:n.tracks)||[],t),atEnd:!0}},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a}))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems(e,t){return e.map((e=>this.createItem(e,t)))}createItem(e,t){const n=e.recording,r=n.id||void 0;return{itemType:wr.Media,mediaType:kr.Audio,src:`musicbrainz:track:${r||Ji()}`,title:e.title,artists:(null==t?void 0:t.artist)?[t.artist]:void 0,albumArtist:null==t?void 0:t.artist,album:null==t?void 0:t.title,duration:e.length/1e3||0,track:e.number?Number(e.number):void 0,recording_mbid:r,release_mbid:this.release_mbid,year:(null==t?void 0:t.year)||new Date(n["first-release-date"]).getUTCFullYear()||void 0,playedAt:0,externalUrl:r?`https://musicbrainz.org/recording/${r}`:void 0}}}const ol=new N("ListenBrainzStatsPager");class ll{constructor(e,t){let n=0;this.pager=new vi(((r=50)=>{return i=this,a=void 0,o=function*(){try{const i=yield lo.get(e,Object.assign(Object.assign({},t),{offset:n,count:r}));return n+=r,this.createPage(i)}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{l(o.next(e))}catch(e){t(e)}}function r(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof s?e:new s((function(t){t(e)}))}(t.value).then(n,r)}l((o=o.apply(i,a||[])).next())}));var i,a,s,o}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new se,this.subscriptions.add(this.pager.observeAdditions().pipe(wn((e=>e.filter((e=>e.itemType===wr.Media)))),De((e=>e.length>0)),kn((e=>lo.addRatings(e)))).subscribe(ol)))}createPage(e){if(this.isRecordingsResponse(e)){const t=e.payload,n=t.recordings.map((e=>this.createMediaItem(e))),r=t.total_recording_count;return{items:n,total:r,atEnd:t.offset+n.length>=r}}if(this.isReleasesResponse(e)){const t=e.payload,n=t.releases.map((e=>this.createMediaAlbum(e))),r=t.total_release_count;return{items:n,total:r,atEnd:t.offset+n.length>=r}}if(this.isArtistsResponse(e)){const t=e.payload,n=t.artists.map((e=>this.createMediaArtist(e))),r=t.total_artist_count;return{items:n,total:r,atEnd:t.offset+n.length>=r}}throw Error("Unknown response")}createMediaArtist(e){var t;const n=(null===(t=e.artist_mbids)||void 0===t?void 0:t[0])||void 0;return{itemType:wr.Artist,src:`listenbrainz:artist:${Ji()}`,externalUrl:n?`${Eo}/artist/${n}`:void 0,title:e.artist_name,artist_mbid:n,playCount:e.listen_count,pager:new Yr}}createMediaAlbum(e){const t=e.release_mbid||void 0,n={itemType:wr.Album,src:`listenbrainz:album:${Ji()}`,externalUrl:t?`${Eo}/release/${t}`:void 0,title:e.release_name,artist:e.artist_name,release_mbid:t,artist_mbids:e.artist_mbids,playCount:e.listen_count};return Object.assign(Object.assign({},n),{pager:t?new sl(t,n):new Yr})}createMediaItem(e){const t=e.recording_mbid||void 0;return{itemType:wr.Media,mediaType:kr.Audio,src:`listenbrainz:track:${Ji()}`,externalUrl:t?`${Eo}/recording/${t}`:void 0,title:e.track_name,artists:e.artist_name?[e.artist_name]:void 0,album:e.release_name,duration:0,recording_mbid:t,release_mbid:e.release_mbid||void 0,artist_mbids:e.artist_mbids,playCount:e.listen_count,playedAt:0}}isRecordingsResponse(e){return"total_recording_count"in e.payload}isReleasesResponse(e){return"total_release_count"in e.payload}isArtistsResponse(e){return"total_artist_count"in e.payload}isNoContentError(e){return 204===(null==e?void 0:e.status)}}const cl={id:"listenbrainz/history",title:"History",icon:"clock",itemType:wr.Media,search:({startAt:e=0}={})=>new tl(e?{max_ts:e}:void 0)},ul={id:"listenbrainz/recently-played",title:"Recently Played",icon:"clock",itemType:wr.Media,search:()=>new tl},dl={id:"listenbrainz/loved-tracks",title:"Loved Tracks",icon:"heart",itemType:wr.Media,viewType:Sr.Ratings,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear"]},search:()=>new rl},ml={id:"listenbrainz/top/tracks",title:"Top Tracks",icon:"star",itemType:wr.Media,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","PlayCount"]},search:e=>new ll(`stats/user/${io.userId}/recordings`,e)},hl={id:"listenbrainz/top/albums",title:"Top Albums",icon:"star",itemType:wr.Album,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},search:e=>new ll(`stats/user/${io.userId}/releases`,e)},fl={id:"listenbrainz/top/artists",title:"Top Artists",icon:"star",itemType:wr.Artist,layout:{view:"card minimal",fields:["Thumbnail","Title","PlayCount"]},secondaryLayout:{view:"none"},search:e=>new ll(`stats/user/${io.userId}/artists`,e)},pl={id:"listenbrainz",name:"ListenBrainz",icon:"listenbrainz",url:"https://listenbrainz.org",serviceType:vr.Scrobbler,defaultHidden:!0,roots:[ul],sources:[ml,hl,fl,dl,cl],labels:{[yr.Like]:"Love on ListenBrainz",[yr.Unlike]:"Unlove on ListenBrainz"},canRate:bl,canStore:()=>!1,compareForRating:yl,rate:function(e,t){return n=this,r=void 0,a=function*(){bl(e)&&(yield lo.rate(e,t))},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a},observeIsLoggedIn:yo,isLoggedIn:bo,login:function(){return fo(this,void 0,void 0,(function*(){if(!bo()){po.log("connect");try{const e=yield function(){return mo(this,void 0,void 0,(function*(){return Dt(ho,!0)}))}();if(e){const{userId:t,token:n}=JSON.parse(e);io.userId=t,io.token=n,vo.next(n)}}catch(e){po.error(e)}}}))},logout:function(){return fo(this,void 0,void 0,(function*(){po.log("disconnect"),io.clear(),vo.next("")}))}},vl=pl;function bl(e){return e.itemType===wr.Media&&!(!e.recording_mbid&&!e.recording_msid)}function yl(e,t){return e.itemType===wr.Media&&e.itemType===t.itemType&&(!!e.recording_mbid&&e.recording_mbid===t.recording_mbid||!!e.recording_msid&&e.recording_msid===t.recording_msid)}Vr.addObserver(pl,5);const gl=new D("subsonic"),wl=new $e(gl.getString("libraryId")),El={get audioLibraries(){return this.libraries},get host(){return gl.getString("host")},set host(e){gl.setString("host",e)},get credentials(){return gl.getString("credentials")},set credentials(e){gl.setString("credentials",e)},get libraryId(){return gl.getString("libraryId")},set libraryId(e){gl.setString("libraryId",e),wl.next(e)},observeLibraryId:()=>wl.pipe(Or()),get libraries(){return gl.getJson("libraries")||[]},set libraries(e){gl.setJson("libraries",e),e.find((e=>e.id===this.libraryId))||(this.libraryId="")},get userName(){return gl.getString("userName")},set userName(e){gl.setString("userName",e)},clear(){gl.removeItem("userName"),gl.removeItem("credentials")}},kl=El;var xl=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function Sl(e,t,{host:n,credentials:r}=kl){return xl(this,void 0,void 0,(function*(){if(!r)throw Error("No subsonic credentials");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1));const i=yield fetch(`${n}/rest/${e}${e.includes("?")?"&":"?"}${r}`,{method:"GET",headers:{Accept:"application/json"}});if(!i.ok)throw i;const{"subsonic-response":a}=yield i.json();if(a.error)throw Error(a.error.message||"Failed");return a}))}function Tl(e,t=kl){var n;return xl(this,void 0,void 0,(function*(){const r=yield Sl("getAlbumList",t.libraryId?Object.assign(Object.assign({},e),{musicFolderId:t.libraryId}):e,t);return(null===(n=r.albumList.album)||void 0===n?void 0:n.map((e=>Object.assign(Object.assign({},e),{name:e.name||e.album||"[Unknown Album]"}))))||[]}))}function Al(e=kl){return xl(this,void 0,void 0,(function*(){return(yield Sl("getArtists",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).artists.index.map((e=>e.artist)).flat()}))}function Pl(){return xl(this,void 0,void 0,(function*(){const e=[];let t=10*Math.floor((new Date).getFullYear()/10);for(;t>=1930;)e.push({id:String(t),title:`${t}s`}),t-=10;return e}))}function Il(e,t){var n;return xl(this,void 0,void 0,(function*(){const r=yield Sl("getGenres",void 0,t);return(null===(n=r.genres.genre)||void 0===n?void 0:n.map((({value:t,albumCount:n,songCount:r})=>{const i=e===wr.Album?n:r;return{id:t,title:`${t} (${i})`,count:i}})).filter((e=>e.count>0)).sort(((e,t)=>e.count===t.count?e.title.localeCompare(t.title):t.count-e.count)))||[]}))}function Cl(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getMusicDirectory",{id:e},t)).directory}))}const Ml={get:Sl,getAlbum:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getAlbum",{id:e},t)).album}))},getAlbumInfo:function(e,t,n){return xl(this,void 0,void 0,(function*(){return(yield Sl("getAlbumInfo"+(t?"":"2"),{id:e},n)).albumInfo}))},getAlbumTracks:function(e,t,n){return xl(this,void 0,void 0,(function*(){return t?(yield Sl("getMusicDirectory",{id:e},n)).directory.child||[]:(yield Sl("getAlbum",{id:e},n)).album.song||[]}))},getAlbumsByDecade:function(e,t,n,r){return xl(this,void 0,void 0,(function*(){const i=Number(e);return Tl({type:"byYear",fromYear:i+9,toYear:i,size:n,offset:t},r)}))},getAlbumsByGenre:function(e,t,n,r){return xl(this,void 0,void 0,(function*(){return Tl({type:"byGenre",genre:e,size:n,offset:t},r)}))},getArtist:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getArtist",{id:e},t)).artist}))},getArtists:Al,getArtistAlbums:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getArtist",{id:e},t)).artist.album||[]}))},getArtistInfo:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getArtistInfo2",{id:e},t)).artistInfo2}))},getArtistTopTracks:function(e,t=50,n){return xl(this,void 0,void 0,(function*(){return(yield Sl("getTopSongs",{artist:e,count:t},n)).topSongs.song||[]}))},getDecades:Pl,getFilters:function(e,t,n){return xl(this,void 0,void 0,(function*(){return e===Sr.ByDecade?Pl():Il(t,n)}))},getGenres:Il,getIndexes:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getIndexes",{musicFolderId:e},t)).indexes.index||[]}))},getLikedAlbums:function(e,t,n){return xl(this,void 0,void 0,(function*(){return Tl({type:"starred",size:t,offset:e},n)}))},getLikedArtists:function(e=kl){return xl(this,void 0,void 0,(function*(){return(yield Sl("getStarred2",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).starred2.artist||[]}))},getLikedSongs:function(e=kl){return xl(this,void 0,void 0,(function*(){return(yield Sl("getStarred2",e.libraryId?{musicFolderId:e.libraryId}:void 0,e)).starred2.song||[]}))},getMostPlayed:function(e,t,n){return xl(this,void 0,void 0,(function*(){return Tl({type:"frequent",size:t,offset:e},n)}))},getMusicDirectory:Cl,getMusicDirectoryItems:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Cl(e,t)).child.sort(((e,t)=>e.isDir===t.isDir?e.isDir?e.title.localeCompare(t.title):0:e.isDir?-1:1))}))},getMusicLibraries:function(e){var t;return xl(this,void 0,void 0,(function*(){const n=yield Sl("getMusicFolders",void 0,e);return(null===(t=n.musicFolders.musicFolder)||void 0===t?void 0:t.sort(((e,t)=>e.name.localeCompare(t.name))).map((({id:e,name:t})=>({id:String(e),title:t}))))||[]}))},getPlayableUrlFromSrc:function(e,{host:t,credentials:n}=kl){const[,,r]=e.split(":");return`${t}/rest/stream?id=${r}&${n}`},getPlaylist:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getPlaylist",{id:e},t)).playlist}))},getPlaylists:function(e){return xl(this,void 0,void 0,(function*(){return(yield Sl("getPlaylists",void 0,e)).playlists.playlist||[]}))},getPlaylistItems:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getPlaylist",{id:e},t)).playlist.entry||[]}))},getRandomAlbums:function(e=100,t){return xl(this,void 0,void 0,(function*(){return Tl({type:"random",size:e,offset:0},t)}))},getRandomArtists:function(e=100,t){return xl(this,void 0,void 0,(function*(){return f(yield Al(t)).slice(0,e)}))},getRandomSongs:function(e=100,t=kl){return xl(this,void 0,void 0,(function*(){return(yield Sl("getRandomSongs",t.libraryId?{musicFolderId:t.libraryId,size:e}:{size:e},t)).randomSongs.song||[]}))},getRecentlyPlayed:function(e,t,n){return xl(this,void 0,void 0,(function*(){return Tl({type:"recent",size:t,offset:e},n)}))},getSong:function(e,t){return xl(this,void 0,void 0,(function*(){return(yield Sl("getSong",{id:e},t)).song}))},getSongsByGenre:function(e,t,n,r=kl){return xl(this,void 0,void 0,(function*(){const i={genre:e,offset:t,count:n};return(yield Sl("getSongsByGenre",r.libraryId?Object.assign(Object.assign({},i),{musicFolderId:r.libraryId}):i,r)).songsByGenre.song||[]}))},getVideos:function(e){return xl(this,void 0,void 0,(function*(){return(yield Sl("getVideos",void 0,e)).videos.video||[]}))},scrobble:function(e,t){return xl(this,void 0,void 0,(function*(){return Sl("scrobble",e,t)}))},searchAlbums:function(e,t,n,r=kl){var i;return xl(this,void 0,void 0,(function*(){const a={query:e,albumCount:n,albumOffset:t,songCount:0,artistCount:0},s=yield Sl("search2",r.libraryId?Object.assign(Object.assign({},a),{musicFolderId:r.libraryId}):a,r);return(null===(i=s.searchResult2.album)||void 0===i?void 0:i.map((e=>Object.assign(Object.assign({},e),{name:e.name||e.album||"[Unknown Album]"}))))||[]}))},searchArtists:function(e,t,n,r=kl){return xl(this,void 0,void 0,(function*(){const i={query:e,artistOffset:t,artistCount:n,songCount:0,albumCount:0};return(yield Sl("search3",r.libraryId?Object.assign(Object.assign({},i),{musicFolderId:r.libraryId}):i,r)).searchResult3.artist||[]}))},searchSongs:function(e,t,n,r=kl){return xl(this,void 0,void 0,(function*(){const i={query:e,songOffset:t,songCount:n,albumCount:0,artistCount:0};return(yield Sl("search3",r.libraryId?Object.assign(Object.assign({},i),{musicFolderId:r.libraryId}):i,r)).searchResult3.song||[]}))}},Ol=Ml,Nl=new D("navidrome"),$l={get host(){return Nl.getString("host")},set host(e){Nl.setString("host",e)},get credentials(){return Nl.getString("credentials")},set credentials(e){Nl.setString("credentials",e)},get token(){return Nl.getString("token")},set token(e){Nl.setString("token",e)},get userId(){return Nl.getString("userId")},set userId(e){Nl.setString("userId",e)},clear(){Nl.removeItem("token"),Nl.removeItem("credentials"),Nl.removeItem("userId")}};var zl=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function jl(e){const t=(0,r.useCallback)(((e,t,n)=>zl(this,void 0,void 0,(function*(){const r=yield fetch(`${e}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:t,password:n})});if(!r.ok)throw r;const{token:i,subsonicSalt:a,subsonicToken:s,id:o}=yield r.json(),l=`u=${t}&s=${a}&t=${s}&v=1.16.1&c=ampcast&f=json`;return JSON.stringify({userId:o,token:i,credentials:l})}))),[]);return r.createElement(Gi,Object.assign({},e,{service:dc,settings:$l,login:t}))}var Ll=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function Rl(e,t){return Ll(this,void 0,void 0,(function*(){const n=yield Dl(e,t,{method:"GET",headers:{Accept:"application/json"}});return yield n.json()}))}function Dl(e,t,n){return Ll(this,void 0,void 0,(function*(){const{host:r,token:i}=$l;if(!i)throw Error("No access token");(e=t?`${e}?${new URLSearchParams(t)}`:e).startsWith("/")&&(e=e.slice(1)),n.headers=Object.assign(Object.assign({},n.headers),{"x-nd-authorization":`Bearer ${i}`});const a=yield fetch(`${r}/api/${e}`,n);if(!a.ok)throw a;return a}))}const Fl={get:Rl,getFilters:function(e){return Ll(this,void 0,void 0,(function*(){return e===Sr.ByDecade?Ol.getDecades():function(){return Ll(this,void 0,void 0,(function*(){return(yield Rl("genre",{_sort:"name"})).map((({id:e,name:t})=>({id:e,title:t})))}))}()}))},getPage:function(e,t){return Ll(this,void 0,void 0,(function*(){const n=yield Dl(e,t,{method:"GET",headers:{Accept:"application/json"}});let r=yield n.json(),i=0;return Array.isArray(r)?i=Number(n.headers.get("X-Total-Count"))||r.length:(r=[r],i=1),{items:r,total:i}}))},getPlayableUrlFromSrc:function(e){return Ol.getPlayableUrlFromSrc(e,$l)}},_l=Fl;var Ul=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Vl=new N("navidromeAuth"),Bl=new $e(""),Hl=new $e(!1);function Yl(){return Hl.getValue()}function Kl(e){$l.token=e,Bl.next(e)}Bl.pipe(Or()).pipe(De((e=>""!==e)),kn((()=>function(){return Ul(this,void 0,void 0,(function*(){try{return yield _l.get("playlist",{_end:1}),!0}catch(e){return Vl.error(e),Bl.next(""),!1}}))}()))).subscribe(Hl),Kl($l.token);class Wl{constructor(e,t,n,r){this.itemType=e,this.path=t,this.params=n,this.pageSize=(null==r?void 0:r.pageSize)||200,this.pager=new ya((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},r))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){return t=this,n=void 0,i=function*(){const t=(e-1)*this.pageSize,n=t+this.pageSize,{items:r,total:i}=yield _l.getPage(this.path,Object.assign(Object.assign({},this.params),{_start:t,_end:n}));return{items:r.map((e=>this.createMediaObject(e))),total:i}},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}createMediaObject(e){let t;switch(this.itemType){case wr.Album:t=this.createMediaAlbum(e);break;case wr.Artist:t=this.createMediaArtist(e);break;case wr.Playlist:t=this.createMediaPlaylist(e);break;default:t=this.createMediaItemFromSong(e)}return dc.canRate(t)&&(t.rating=this.getRating(t,e)),t}createMediaItemFromSong(e){var t;const n=e.mediaFileId||e.id;return{itemType:wr.Media,mediaType:kr.Audio,src:`navidrome:audio:${n}`,externalUrl:this.getExternalUrl(`album/${e.albumId}`),title:e.title,addedAt:this.parseDate(e.createdAt),artists:[e.artist],albumArtist:e.albumArtist,album:e.album,duration:e.duration,track:e.trackNumber,disc:e.discNumber,rating:e.starred?1:0,year:e.year,playedAt:this.parseDate(e.playDate),playCount:e.playCount,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),thumbnails:this.createThumbnails(e.albumId),recording_mbid:e.mbzTrackId}}createMediaAlbum(e){var t;const n=e.id;return{itemType:wr.Album,src:`navidrome:album:${n}`,externalUrl:this.getExternalUrl(`album/${n}`),title:e.name,addedAt:this.parseDate(e.createdAt),artist:e.albumArtist,rating:e.starred?1:0,year:e.minYear||e.maxYear,playedAt:this.parseDate(e.playDate),playCount:e.playCount,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),pager:new Wl(wr.Media,"song",{album_id:n,_sort:"album"}),thumbnails:this.createThumbnails(n),release_mbid:e.mbzAlbumId}}createMediaArtist(e){var t;const n=e.id,r=Object.keys(e).some((e=>/ImageUrl$/.test(e)));return{itemType:wr.Artist,src:`navidrome:artist:${n}`,externalUrl:this.getExternalUrl(`artist/${n}`),title:e.name,description:A(e.biography)||void 0,rating:e.starred?1:0,genres:null===(t=e.genres)||void 0===t?void 0:t.map((e=>e.name)),pager:this.createArtistAlbumsPager(e),thumbnails:r?this.createThumbnails(n):void 0,artist_mbid:e.mbzArtistId}}createMediaPlaylist(e){const t=e.id,n=`navidrome:playlist:${t}`;return{itemType:wr.Playlist,src:n,externalUrl:this.getExternalUrl(`playlist/${t}`),title:e.name,description:A(e.comment),addedAt:this.parseDate(e.createdAt),duration:e.duration,trackCount:e.songCount,pager:new Wl(wr.Media,`playlist/${t}/tracks`,{playlist_id:t}),thumbnails:this.createThumbnails(t),isPinned:xi.isPinned(n),isOwn:e.ownerId===$l.userId,owner:{name:e.ownerName}}}getExternalUrl(e){return`${$l.host}/app/#/${e}/show`}getRating(e,t){return Vr.get(e,t.starred?1:0)}parseDate(e){const t=Date.parse(e)||0;return t<0?0:Math.round(t/1e3)}createThumbnails(e){return e?[this.createThumbnail(e,120),this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480)]:void 0}createThumbnail(e,t,n=t){const{host:r}=$l;return{url:`${r}/rest/getCoverArt?id=${e}&size=${t}&{navidrome-credentials}`,width:t,height:n}}createArtistAlbumsPager(e){const t=this.createArtistAllTracks(e),n=new Yr([t]),r=new Wl(wr.Album,"album",{album_artist_id:e.id,_sort:"minYear",_order:"DESC"});return new yi(void 0,r,n)}createArtistAllTracks(e){const t=Object.keys(e).some((e=>/ImageUrl$/.test(e)));return{itemType:wr.Album,src:`navidrome:all-tracks:${e.id}`,title:"All Songs",artist:e.name,thumbnails:t?this.createThumbnails(e.id):void 0,pager:this.createAllTracksPager(e),synthetic:!0}}createAllTracksPager(e){return new Wl(wr.Media,"song",{artist:e.name,_sort:"title"})}}Wl.minPageSize=10,Wl.maxPageSize=500;const ql=Wl;var Gl=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Jl="navidrome",Ql="order_album_artist_name,order_album_name,disc_number,track_number",Xl="order_album_artist_name,order_album_name",Zl={id:"navidrome/liked-songs",title:"My Songs",icon:"heart",itemType:wr.Media,viewType:Sr.Ratings,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","AlbumAndYear","Duration"]},search:()=>new ql(wr.Media,"song",{starred:!0,_sort:"starred_at",_order:"DESC"})},ec={id:"navidrome/liked-albums",title:"My Albums",icon:"heart",itemType:wr.Album,viewType:Sr.Ratings,search:()=>new ql(wr.Album,"album",{starred:!0,_sort:"starred_at",_order:"DESC"})},tc={id:"navidrome/liked-artists",title:"My Artists",icon:"heart",itemType:wr.Artist,viewType:Sr.Ratings,defaultHidden:!0,search:()=>new ql(wr.Artist,"artist",{starred:!0,_sort:"starred_at",_order:"DESC"})},nc={id:"navidrome/recently-played",title:"Recently Played",icon:"clock",itemType:wr.Media,viewType:Sr.RecentlyPlayed,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>new ql(wr.Media,"song",{_sort:"play_date",_order:"DESC"})},rc={id:"navidrome/most-played",title:"Most Played",icon:"most-played",itemType:wr.Media,viewType:Sr.MostPlayed,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>new ql(wr.Media,"song",{_sort:"play_count",_order:"DESC"})},ic={id:"navidrome/playlists",title:"Playlists",icon:"playlist",itemType:wr.Playlist,secondaryLayout:{view:"details",fields:["Index","Artist","Title","Album","Track","Duration","PlayCount"]},search:()=>new ql(wr.Playlist,"playlist",{_sort:"name"})},ac={id:"navidrome/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:wr.Media,viewType:Sr.ByGenre,defaultHidden:!0,search:e=>e?new ql(wr.Media,"song",{genre_id:e.id,_sort:Ql}):new Yr},sc={id:"navidrome/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:wr.Album,viewType:Sr.ByGenre,search:e=>e?new ql(wr.Album,"album",{genre_id:e.id,_sort:Xl}):new Yr},oc={id:"navidrome/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:wr.Artist,viewType:Sr.ByGenre,defaultHidden:!0,search:e=>e?new ql(wr.Artist,"artist",{genre_id:e.id,_sort:"name"}):new Yr},lc={id:"navidrome/random-tracks",title:"Random Songs",icon:"shuffle",itemType:wr.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>new ql(wr.Media,"song",{_sort:"random"},{maxSize:100})},cc={id:"navidrome/random-albums",title:"Random Albums",icon:"shuffle",itemType:wr.Album,search:()=>new ql(wr.Album,"album",{_sort:"random"},{maxSize:100})},uc={id:Jl,icon:Jl,name:"Navidrome",url:"https://www.navidrome.org/",serviceType:vr.PersonalMedia,defaultHidden:!0,roots:[hc(wr.Media,{title:"Songs"}),hc(wr.Album,{title:"Albums"}),hc(wr.Artist,{title:"Artists"}),hc(wr.Playlist,{title:"Playlists"})],sources:[Zl,ec,tc,nc,rc,ic,ac,sc,oc,lc,cc],labels:{[yr.Like]:"Add to Navidrome Favorites",[yr.Unlike]:"Remove from Navidrome Favorites"},canRate:mc,canStore:()=>!1,compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:wr.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":");return new ql(wr.Playlist,`playlist/${t}`)}}},getFilters:function(e){return Gl(this,void 0,void 0,(function*(){return _l.getFilters(e)}))},getMetadata:function(e){return Gl(this,void 0,void 0,(function*(){const t=e.itemType,[,,n]=e.src.split(":");if(t===wr.Album&&void 0===e.description){const t=yield Ol.getAlbumInfo(n,!1,$l);e=Object.assign(Object.assign({},e),{description:A(t.notes)})}if(!mc(e)||void 0!==e.rating)return e;const r=Vr.get(e);if(void 0!==r)return Object.assign(Object.assign({},e),{rating:r});const i=t===wr.Artist?"artist":t===wr.Album?"album":"song",a=new ql(t,`${i}/${n}`,{pageSize:1,maxSize:1}),s=yield Hr(a,{timeout:2e3});return k(e,s[0])}))},getPlayableUrlFromSrc:function(e){return _l.getPlayableUrlFromSrc(e)},getThumbnailUrl:function(e){return e.replace("{navidrome-credentials}",$l.credentials)},lookup:function(e,t,n=10,r){return Gl(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:n,maxSize:n,lookup:!0};return Hr(new ql(wr.Media,"song",{title:`${e} ${t}`,_sort:"order_artist_name,order_album_name,track_number"},i),{timeout:r})}))},rate:function(e,t){return Gl(this,void 0,void 0,(function*(){const[,,n]=e.src.split(":"),r=t?"star":"unstar";switch(e.itemType){case wr.Media:yield Ol.get(r,{id:n},$l);break;case wr.Album:yield Ol.get(r,{albumId:n},$l);break;case wr.Artist:yield Ol.get(r,{artistId:n},$l)}}))},observeIsLoggedIn:function(){return Hl.pipe(Or())},isLoggedIn:Yl,login:function(){return Ul(this,void 0,void 0,(function*(){if(!Yl()){Vl.log("connect");try{const e=yield function(){return zl(this,void 0,void 0,(function*(){return Dt(jl,!0)}))}();if(e){const{userId:t,token:n,credentials:r}=JSON.parse(e);$l.userId=t,$l.credentials=r,Kl(n)}}catch(e){Vl.error(e)}}}))},logout:function(){return Ul(this,void 0,void 0,(function*(){Vl.log("disconnect"),$l.clear(),Kl(""),Hl.next(!1)}))}},dc=uc;function mc(e){switch(e.itemType){case wr.Media:case wr.Artist:return!0;case wr.Album:return!e.synthetic;default:return!1}}function hc(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`navidrome/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search({q:t=""}={}){switch(t=t.trim(),e){case wr.Media:return new ql(e,"song",{title:t,_sort:Ql});case wr.Album:return new ql(e,"album",{name:t,_sort:Xl});case wr.Artist:return new ql(e,"artist",{name:t,_sort:"name"});case wr.Playlist:return new ql(e,"playlist",{q:t,_sort:"name"});default:return new Yr}}})}Vr.addObserver(uc);const fc=new D("plex"),pc=new $e(fc.getString("libraryId")),vc={get audioLibraries(){return this.libraries},get clientId(){let e=fc.getString("clientId");return e||(e=Ji(),fc.setString("clientId",e)),e},get connection(){return fc.getJson("connection")},set connection(e){fc.setJson("connection",e)},get host(){var e;return(null===(e=this.connection)||void 0===e?void 0:e.uri)||""},get libraryId(){return fc.getString("libraryId")},set libraryId(e){fc.setString("libraryId",e),pc.next(e)},observeLibraryId:()=>pc.pipe(Or()),get libraries(){return fc.getJson("libraries")||[]},set libraries(e){const t=e.find((e=>e.id===this.libraryId))||e.find((e=>M(e.title)))||e[0];fc.setJson("libraries",e),this.libraryId=(null==t?void 0:t.id)||""},get server(){return fc.getJson("server")},set server(e){fc.setJson("server",e)},get serverToken(){var e;return(null===(e=this.server)||void 0===e?void 0:e.accessToken)||""},get userToken(){return fc.getString("userToken")},set userToken(e){fc.setString("userToken",e)},get userId(){return fc.getString("userId")},set userId(e){fc.setString("userId",e)},clear(){fc.removeItem("userId"),fc.removeItem("userToken"),fc.removeItem("server"),fc.removeItem("connection")}};var bc;!function(e){e.Episode="4",e.Artist="8",e.Album="9",e.Track="10",e.Clip="14",e.Playlist="15"}(bc||(bc={}));const yc=bc;var gc=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function wc(e){var{headers:t,body:n}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["headers","body"]);return gc(this,void 0,void 0,(function*(){return t=Object.assign(Object.assign({},t),{Accept:"application/json"}),n&&(t=Object.assign(Object.assign({},t),{"Content-Type":"application/json"}),n=JSON.stringify(n)),(yield Ec(Object.assign({headers:t,body:n},r))).json()}))}function Ec({host:e=vc.host,path:t,method:n="GET",params:r,headers:i,body:a,token:s,keepalive:o}){return gc(this,void 0,void 0,(function*(){if(!e)throw Error("No Plex connection.");(t=r?`${t}?${new URLSearchParams(r)}`:t).startsWith("/")||(t=`/${t}`),s||(s=e===vc.host?vc.serverToken:vc.userToken);const l=yield fetch(`${e}${t}`,{method:n,headers:Object.assign(Object.assign({},i),kc(s)),body:a,keepalive:o});if(!l.ok)throw l;return l}))}function kc(e){const t={"X-Plex-Product":"ampcast","X-Plex-Version":"0.8.22","X-Plex-Platform":K.displayName,"X-Plex-Platform-Version":K.version,"X-Plex-Device":K.os,"X-Plex-Device-Name":K.displayName,"X-Plex-Client-Identifier":vc.clientId,"X-Plex-Model":"hosted","Accept-Encoding":"gzip, deflate, br"};return e&&(t["X-Plex-Token"]=e),t}function xc(e="all"){return`/library/sections/${Sc()}/${e}`}function Sc(){const e=vc.libraryId;if(!e)throw new Bi;return e}const Tc={fetch:Ec,fetchJSON:wc,getFilters:function(e,t){return gc(this,void 0,void 0,(function*(){return e===Sr.ByDecade?function(){return gc(this,void 0,void 0,(function*(){const{MediaContainer:{Directory:e}}=yield wc({path:xc("decade"),params:{type:yc.Album}}),t=10*Math.floor((new Date).getFullYear()/10);return e.filter((({key:e})=>Number(e)>500&&Number(e)<=t)).map((({key:e,title:t})=>({id:e,title:t})))}))}():function(e){return gc(this,void 0,void 0,(function*(){const t=function(e){switch(e){case wr.Album:return yc.Album;case wr.Artist:return yc.Artist;case wr.Playlist:return yc.Playlist;default:return yc.Track}}(e),{MediaContainer:{Directory:n}}=yield wc({path:xc("genre"),params:{type:t}});return n.map((({key:e,title:t})=>({id:e,title:t})))}))}(t)}))},getMusicLibraries:function(){return gc(this,void 0,void 0,(function*(){const{MediaContainer:{Directory:e}}=yield wc({path:"/library/sections"});return e.filter((e=>"artist"===e.type)).map((({key:e,title:t})=>({id:e,title:t})))}))}};var Ac=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Pc=new N("plexAuth"),Ic="https://plex.tv/api/v2",Cc=new $e(""),Mc=new $e(!1),Oc=new $e(!1);let Nc;function $c(){return Oc.getValue()}function zc(){return Oc.pipe(Or())}function jc(e){vc.userToken=e,Cc.next(e)}jc(vc.userToken),Cc.pipe(Or()).pipe(De((e=>""!==e)),Re((()=>Ac(void 0,void 0,void 0,(function*(){const e=(e,t)=>Ac(void 0,void 0,void 0,(function*(){try{return yield Tc.fetch({host:e.uri,path:"/",method:"HEAD",token:t}),e}catch(e){return null}})),t=vc.connection;if(t){if(yield e(t,vc.serverToken))return Pc.log(`Using existing ${t.local?"local":"public"} connection.`),void Mc.next(!0);vc.server=null,vc.connection=null}Pc.log("Searching for a connection...");try{const t=(yield function(){return Ac(this,void 0,void 0,(function*(){return Tc.fetchJSON({host:Ic,path:"/resources",params:{includeHttps:"1"}})}))}()).filter((e=>"server"===e.provides));for(const n of t){const t=yield Promise.all([...n.connections.map((t=>e(t,n.accessToken)))]),r=t.filter(l);if(r.length){const e=r.find((e=>e.local))||r[0];return vc.server=n,vc.connection=e,Pc.log(`Using ${e.local?"local":"public"} connection.`),void Mc.next(!0)}}Pc.log("Could not establish a connection.")}catch(e){Pc.log(e),Cc.next("")}}))))).subscribe(Pc),Mc.pipe(De((e=>e)),Re((()=>Ac(void 0,void 0,void 0,(function*(){try{const e=yield Tc.getMusicLibraries();vc.libraries=e}catch(e){Pc.error(e)}finally{Oc.next(!0)}}))))).subscribe(Pc);class Lc{constructor(e,t,n,r){var i;this.path=e,this.params=t,this.parent=r,this.pageSize=Math.min((null==n?void 0:n.maxSize)||1/0,(null==n?void 0:n.pageSize)||((null===(i=vc.connection)||void 0===i?void 0:i.local)?Lc.maxPageSize:200)),this.pager=new ya((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},n))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){return t=this,n=void 0,i=function*(){const t=yield Tc.fetchJSON({path:this.path,params:this.params,headers:{"X-Plex-Container-Size":String(this.pageSize),"X-Plex-Container-Start":String((e-1)*this.pageSize)}}),{MediaContainer:{Metadata:n=[],size:r,totalSize:i}}=t;return{items:n.map((e=>this.createMediaObject(e))),total:i||r}},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}createMediaObject(e){switch(e.type){case"clip":return this.createMediaItemFromVideo(e);case"album":return this.createMediaAlbum(e);case"artist":return this.createMediaArtist(e);case"playlist":return this.createMediaPlaylist(e);case"track":return this.createMediaItemFromTrack(e);default:return this.createMediaFolder(e)}}createMediaItemFromTrack(e){const[t]=e.Media,[n]=t.Part,r=(e.title||"").trim(),i=!!r,a=i?"[Unknown Album]"===e.parentTitle?void 0:e.parentTitle||void 0:void 0,s=this.getFileName(n.file)||"[Unknown]";return{itemType:wr.Media,mediaType:kr.Audio,src:`plex:audio:${n.key}`,externalUrl:this.getExternalUrl(`/library/metadata/${e.parentRatingKey}`),fileName:s,title:r||s.replace(/\.\w+/,""),addedAt:e.addedAt,artists:i?e.originalTitle?[e.originalTitle]:e.grandparentTitle?[e.grandparentTitle]:void 0:void 0,albumArtist:a&&!e.originalTitle?e.grandparentTitle:void 0,album:a,duration:e.duration/1e3,track:a?e.index:void 0,disc:a&&e.index?e.parentIndex:void 0,rating:this.getRating(e),year:e.parentYear,playedAt:e.lastViewedAt||0,playCount:e.viewCount,plex:{ratingKey:e.ratingKey},thumbnails:this.createThumbnails(e.thumb||e.parentThumb||e.grandparentThumb)}}createMediaAlbum(e){var t;return{itemType:wr.Album,src:`plex:album:${e.ratingKey}`,externalUrl:this.getExternalUrl(`/library/metadata/${e.ratingKey}`),title:e.title||"",description:e.summary,addedAt:e.addedAt,artist:e.parentTitle,rating:this.getRating(e),year:e.year,playedAt:e.lastViewedAt,playCount:e.viewCount,genres:null===(t=e.Genre)||void 0===t?void 0:t.map((e=>e.tag)),plex:{ratingKey:e.ratingKey},pager:new Lc(e.key),thumbnails:this.createThumbnails(e.thumb||e.parentThumb)}}createMediaArtist(e){var t,n;return{itemType:wr.Artist,src:`plex:artist:${e.ratingKey}`,externalUrl:this.getExternalUrl(`/library/metadata/${e.ratingKey}`),title:e.title,description:e.summary,country:null===(t=e.Country)||void 0===t?void 0:t.map((e=>e.tag)).join(", "),addedAt:e.addedAt,rating:this.getRating(e),genres:null===(n=e.Genre)||void 0===n?void 0:n.map((e=>e.tag)),plex:{ratingKey:e.ratingKey},pager:this.createArtistAlbumsPager(e),thumbnails:this.createThumbnails(e.thumb)}}createMediaItemFromVideo(e){const[t]=e.Media,[n]=t.Part;return{itemType:wr.Media,mediaType:kr.Video,src:`plex:video:${n.key}`,externalUrl:e.art?this.getExternalUrl(e.art.replace(/\/art\/\d+$/,"")):"",fileName:this.getFileName(n.file),title:e.title||"Video",addedAt:e.addedAt,artists:e.grandparentTitle?[e.grandparentTitle]:void 0,duration:e.duration/1e3,playedAt:e.lastViewedAt||0,playCount:e.viewCount,plex:{ratingKey:e.ratingKey},thumbnails:this.createThumbnails(e.thumb)}}createMediaPlaylist(e){const t=`plex:playlist:${e.key}`;return{itemType:wr.Playlist,src:t,externalUrl:this.getExternalUrl(`/playlists/${e.ratingKey}`,"playlist"),title:e.title,description:e.summary,addedAt:e.addedAt,duration:e.duration/1e3,playedAt:e.lastViewedAt,playCount:e.viewCount,trackCount:e.leafCount,plex:{ratingKey:e.ratingKey},pager:new Lc(e.key),thumbnails:this.createThumbnails(e.composite),isPinned:xi.isPinned(t)}}createMediaFolder(e){var t;const n={itemType:wr.Folder,src:`plex:folder:${e.key}`,title:e.title,fileName:e.title,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===wr.Folder?`${this.parent.path}/${e.title}`:"/",parent:this.parent};return n.pager=this.createFolderPager(n),n}get webHost(){var e;const t=null===(e=vc.server)||void 0===e?void 0:e.clientIdentifier;return t?`https://app.plex.tv/desktop/#!/server/${t}`:""}getExternalUrl(e,t="details"){const n=this.webHost;return n?`${n}/${t}?key=${encodeURIComponent(e)}`:""}getFileName(e){return e.split(/[/\\]/).pop()}getRating(e){return Math.round((e.userRating||0)/2)}createThumbnails(e){return e?[this.createThumbnail(e,120),this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480)]:void 0}createThumbnail(e,t,n=t){return{url:`${vc.host}/photo/:/transcode?url=${encodeURIComponent(e)}&width=${t}&height=${n}&minSize=1&upscale=1&X-Plex-Token={plex-token}`,width:t,height:n}}createFolderPager(e){var t;const[,,n]=e.src.split(":"),r=new Lc(n,void 0,{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===wr.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new Yr([e]);return new yi(t,r)}return r}createArtistAlbumsPager(e){const t=this.createArtistOtherTracks(e),n=new Yr([t]),r=new Lc(xc(),{"artist.id":e.ratingKey,type:yc.Album,sort:"year:desc,originallyAvailableAt:desc,artist.titleSort:desc,album.titleSort,album.index"});return new yi(void 0,r,n)}createArtistOtherTracks(e){return{itemType:wr.Album,src:`plex:other-tracks:${e.ratingKey}`,title:"Other Tracks",artist:e.title,thumbnails:this.createThumbnails(e.thumb),pager:this.createOtherTracksPager(e),synthetic:!0}}createOtherTracksPager(e){return new Lc(xc(),{originalTitle:e.title,type:yc.Track})}}Lc.minPageSize=10,Lc.maxPageSize=1e3;const Rc=Lc;var Dc=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Fc={view:"card compact",fields:["Thumbnail","Title","Artist","Year","Rate"]},_c={view:"details",fields:["AlbumTrack","Artist","Title","Duration","PlayCount","Rate"]},Uc={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","PlayCount","Rate"]},Vc={id:"plex/recently-played",title:"Recently Played",icon:"clock",itemType:wr.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>new Rc(xc(),{type:yc.Track,"lastViewedAt>":"0",sort:"lastViewedAt:desc"})},Bc={id:"plex/most-played",title:"Most Played",icon:"most-played",itemType:wr.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Rate"]},search:()=>new Rc(xc(),{type:yc.Track,"viewCount>":"1",sort:"viewCount:desc,lastViewedAt:desc"})},Hc={id:"plex/top-tracks",title:"Top Tracks",icon:"star",itemType:wr.Media,viewType:Sr.Ratings,layout:{view:"details",fields:["Rate","Artist","Title","Album","Track","Duration","PlayCount"]},search:()=>new Rc(xc(),{type:yc.Track,"track.userRating>":"1",sort:"track.userRating:desc,viewCount:desc,lastViewedAt:desc"})},Yc={id:"plex/top-albums",title:"Top Albums",icon:"star",itemType:wr.Album,viewType:Sr.Ratings,layout:Fc,secondaryLayout:_c,search:()=>new Rc(xc(),{type:yc.Album,"album.userRating>":"1",sort:"album.userRating:desc,viewCount:desc,lastViewedAt:desc"})},Kc={id:"plex/top-artists",title:"Top Artists",icon:"star",itemType:wr.Artist,viewType:Sr.Ratings,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Title","Genre","Rate"]},tertiaryLayout:_c,search:()=>new Rc(xc(),{type:yc.Artist,"artist.userRating>":"1",sort:"artist.userRating:desc,viewCount:desc,lastViewedAt:desc"})},Wc={id:"plex/playlists",title:"Playlists",icon:"playlist",itemType:wr.Playlist,secondaryLayout:Uc,search:()=>(Sc(),new Rc("/playlists/all",{type:yc.Playlist,playlistType:"audio"}))},qc={id:"plex/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:wr.Album,viewType:Sr.ByGenre,search:e=>e?new Rc(xc(),{genre:e.id,type:yc.Album}):new Yr},Gc={id:"plex/artists-by-genre",title:"Artists by Genre",icon:"genre",itemType:wr.Artist,viewType:Sr.ByGenre,defaultHidden:!0,search:e=>e?new Rc(xc(),{genre:e.id,type:yc.Artist}):new Yr},Jc={id:"plex/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:wr.Album,viewType:Sr.ByDecade,search:e=>e?new Rc(xc(),{decade:e.id,type:yc.Album}):new Yr},Qc={id:"plex/random-tracks",title:"Random Tracks",icon:"shuffle",itemType:wr.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search:()=>new Rc(xc(),{type:yc.Track,sort:"random"},{maxSize:100})},Xc={id:"plex/random-albums",title:"Random Albums",icon:"shuffle",itemType:wr.Album,layout:Fc,secondaryLayout:_c,search:()=>new Rc(xc(),{type:yc.Album,sort:"random"},{maxSize:100})},Zc={id:"plex/videos",title:"Music Videos",icon:"video",itemType:wr.Media,mediaType:kr.Video,searchable:!0,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Artist","Title","Year","Duration"]},search:({q:e=""}={})=>new Rc(xc("extras/all"),{title:e,type:yc.Artist,extraType:yc.Episode})},eu={id:"plex/folders",title:"Folders",icon:"folder",itemType:wr.Folder,viewType:Sr.Folders,search(){const e={itemType:wr.Folder,src:"plex:folder:",title:"Folders",fileName:"",path:""};return e.pager=new Yi((()=>vc.libraries.map((({id:t,title:n})=>{const r={itemType:wr.Folder,src:`plex:folder:/library/sections/${t}/folder`,title:n,fileName:n,path:`/${n}`},i=Object.assign(Object.assign({},e),{fileName:"../"}),a=new Yr([i]),s=new Rc(`library/sections/${t}/folder`,{includeCollections:"1"},void 0,r);return r.pager=new yi(a,s),r})))),e.pager}},tu={id:"plex",name:"Plex",icon:"plex",url:"https://www.plex.tv",serviceType:vr.PersonalMedia,defaultHidden:!0,roots:[iu(wr.Media,{title:"Tracks",layout:{view:"details",fields:["Artist","Title","Album","Track","Duration","PlayCount","Rate"]}}),iu(wr.Album,{title:"Albums"}),iu(wr.Artist,{title:"Artists"}),iu(wr.Playlist,{title:"Playlists",secondaryLayout:Uc})],sources:[Hc,Yc,Kc,Bc,Vc,Wc,qc,Gc,Jc,Qc,Xc,Zc,eu],get audioLibraries(){return vc.audioLibraries},get libraryId(){return vc.libraryId},set libraryId(e){vc.libraryId=e},get libraries(){return vc.libraries},set libraries(e){vc.libraries=e},observeLibraryId:()=>vc.observeLibraryId(),canRate:ru,canStore:()=>!1,compareForRating:function(e,t){return e.plex.ratingKey===t.plex.ratingKey},createSourceFromPin:function(e){return{title:e.title,itemType:wr.Playlist,id:e.src,icon:"pin",isPin:!0,search:()=>new Rc(`/playlists/${e.plex.ratingKey}`,{type:yc.Playlist,playlistType:"audio"})}},getFilters:function(e,t){return Dc(this,void 0,void 0,(function*(){return Tc.getFilters(e,t)}))},getMetadata:function(e){return Dc(this,void 0,void 0,(function*(){if(!ru(e)||void 0!==e.rating)return e;const t=Vr.get(e);if(void 0!==t)return Object.assign(Object.assign({},e),{rating:t});const n=e.itemType===wr.Playlist?`/playlists/${e.plex.ratingKey}`:`/library/metadata/${e.plex.ratingKey}`,r=new Rc(n,void 0,{pageSize:1,maxSize:1}),i=yield Hr(r,{timeout:2e3});return k(e,i[0])}))},getPlayableUrlFromSrc:function(e){const{host:t,serverToken:n}=vc;if(t&&n){const[,,r]=e.split(":");return`${t}${r}?X-Plex-Token=${n}`}throw Error("Not logged in")},getThumbnailUrl:function(e){return e.replace("{plex-token}",vc.serverToken)},lookup:function(e,t,n=10,r){return Dc(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:n,maxSize:n,lookup:!0},a=e=>Dc(this,void 0,void 0,(function*(){return Hr(au(wr.Media,t,e,i),{timeout:r})}));return h((yield Promise.all([a({"artist.title":e}),a({originalTitle:e})])).flat(),"src")}))},rate:function(e,t){return Dc(this,void 0,void 0,(function*(){yield Tc.fetch({path:"/:/rate",method:"PUT",params:{key:e.plex.ratingKey,identifier:"com.plexapp.plugins.library",rating:2*t||-1}})}))},observeIsLoggedIn:zc,isLoggedIn:$c,login:function(){return Ac(this,void 0,void 0,(function*(){if(!$c()){Pc.log("connect");try{const{id:e,authToken:t}=yield function(){return Ac(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const n=location.hostname,r=("localhost"===n?`http://${n}:${location.port}`:`https://${n}`)+"/auth/plex/callback/";let i=null;const a=n=>{if(/(localhost|ampcast)/.test(n.origin)){if(clearInterval(o),window.removeEventListener("message",a,!1),null==i||i.close(),i=null,n.origin!==location.origin)return void t({message:`Origin ${n.origin} does not match ${location.origin}`});let r=10;const s=()=>Ac(this,void 0,void 0,(function*(){r--;try{const{authToken:n,id:i}=yield Tc.fetchJSON({host:Ic,path:`/pins/${Nc.id}`});n?e({id:i,authToken:n}):r?setTimeout(s,200):t("Timeout")}catch(e){t(e)}}));s()}};window.addEventListener("message",a,!1);const s=`clientID=${vc.clientId}&code=${Nc.code}&forwardUrl=${encodeURIComponent(r)}&context%5Bdevice%5D%5Bproduct%5D=ampcast`;i=window.open(`https://app.plex.tv/auth#?${s}`,"Plex","popup");const o=setInterval((()=>{(null==i?void 0:i.closed)&&(clearInterval(o),t({message:"access_denied"}))}),500)}))}))}();vc.userId=e,jc(t)}catch(e){Pc.error(e)}}}))},logout:function(){return Ac(this,void 0,void 0,(function*(){Pc.log("disconnect"),vc.clear(),jc(""),Mc.next(!1),Oc.next(!1)}))}},nu=tu;function ru(e,t){if(t)return!1;switch(e.itemType){case wr.Album:return!e.synthetic;case wr.Artist:return!0;case wr.Media:return e.mediaType===kr.Audio;default:return!1}}function iu(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`plex/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>au(e,t)})}function au(e,t,n,r){Sc();const i=e===wr.Playlist?"/playlists/all":xc(),a=Object.assign({},n);switch(t&&(a.title=t.trim()),e){case wr.Media:a.type=yc.Track;break;case wr.Album:a.type=yc.Album;break;case wr.Artist:a.type=yc.Artist;break;case wr.Playlist:a.type=yc.Playlist,a.playlistType="audio"}return new Rc(i,a,r)}Vr.addObserver(tu);var su=n(5754);const ou=new(n.n(su)()),lu=new D("spotify/auth"),cu=new D("spotify/user","memory");var uu=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const du=new N("spotifyAuth"),mu=location.hostname,hu=("localhost"===mu?`http://${mu}:${location.port}`:`https://${mu}`)+"/auth/spotify/callback/",fu="https://accounts.spotify.com";let pu;const vu=new $e("");function bu(){return vu.pipe(Or())}function yu(){return""!==vu.getValue()}function gu(){return uu(this,void 0,void 0,(function*(){du.log("refreshToken");const e=Eu(),t=null==e?void 0:e.refresh_token;if(t){const e=yield fetch(`${fu}/api/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:Gr,grant_type:"refresh_token",refresh_token:t})});if(!e.ok)throw yield xu(),e;const n=yield e.json();return yield wu(n),n.access_token}throw yield xu(),Error("No 'refresh_token'")}))}function wu(e){return uu(this,void 0,void 0,(function*(){try{const{access_token:t,refresh_token:n}=e;lu.setJson("token",{access_token:t,refresh_token:n}),ou.setAccessToken(e.access_token),yield Su(),ku(t)}catch(e){du.error(e),yield xu()}}))}function Eu(){return lu.getJson("token")}function ku(e){vu.next(e)}function xu(){return uu(this,void 0,void 0,(function*(){lu.removeItem("token"),cu.clear(),yield function(){return uu(this,void 0,void 0,(function*(){const e=function(e){let t="";for(let e=0;e<64;e++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return t}();lu.setString("code_verifier",e),pu=yield function(e){return uu(this,void 0,void 0,(function*(){const t=yield crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}))}(e)}))}(),vu.next("")}))}function Su(){return uu(this,void 0,void 0,(function*(){if(!cu.getString("userId")){const e=yield ou.getMe();cu.setString("userId",e.id),cu.setString("market",e.country)}}))}uu(void 0,void 0,void 0,(function*(){try{const e=Eu();if(e){try{ou.setAccessToken(e.access_token),yield Su(),ku(e.access_token)}catch(e){if(401!==e.status)throw e;yield gu()}return}}catch(e){du.error(e)}yield xu()}));var Tu=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Au=new N("SpotifyPager");class Pu{constructor(e,t,n){this.defaultConfig={minPageSize:Pu.minPageSize,maxPageSize:Pu.maxPageSize,pageSize:Pu.maxPageSize},this.pageNumber=1,this.config=Object.assign(Object.assign({},this.defaultConfig),t),this.pager=new vi(((t=this.defaultConfig.pageSize)=>Tu(this,void 0,void 0,(function*(){var r;const i=(this.pageNumber-1)*t,a=()=>Tu(this,void 0,void 0,(function*(){const{items:r,total:a,next:s}=yield e(i,t);return this.pageNumber++,{items:r.map((e=>this.createMediaObject(e,n))),total:a,atEnd:!s}}));try{return yield a()}catch(e){if(401===e.status)return yield gu(),yield a();if(429===e.status){const t=Number(null===(r=e.headers)||void 0===r?void 0:r.get("Retry-After"));if(t&&t<=10)return yield P(1e3*t),yield a();throw e}throw e}}))),this.config)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new se,this.config.lookup||this.subscriptions.add(this.pager.observeAdditions().pipe(kn((e=>this.addInLibrary(e)))).subscribe(Au)))}createMediaObject(e,t){switch(e.type){case"episode":return this.createMediaItemFromEpisode(e);case"artist":return this.createMediaArtist(e);case"album":return this.createMediaAlbum(e,t);case"playlist":return this.createMediaPlaylist(e,t);case"track":return this.createMediaItemFromTrack(e,t)}}createMediaItemFromEpisode(e){return{itemType:wr.Media,mediaType:kr.Audio,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,duration:e.duration_ms/1e3,thumbnails:e.images,unplayable:!1===e.is_playable,playedAt:e.played_at?Math.floor((new Date(e.played_at).getTime()||0)/1e3):0}}createMediaAlbum(e,t){var n;return{itemType:wr.Album,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,artist:e.artists.map((e=>e.name)).join(", "),year:new Date(e.release_date).getFullYear(),thumbnails:e.images,trackCount:null===(n=e.tracks)||void 0===n?void 0:n.total,pager:this.createAlbumPager(e),inLibrary:Rr.get(e.uri,t)}}createMediaArtist(e){return{itemType:wr.Artist,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,genres:e.genres,thumbnails:e.images,pager:this.createArtistAlbumsPager(e)}}createArtistTopTracks(e){return{itemType:wr.Album,src:`spotify:top-tracks:${e.id}`,title:"Top Tracks",artist:e.name,thumbnails:e.images,pager:this.createTopTracksPager(e),synthetic:!0}}createMediaPlaylist(e,t){const n=e.owner.id===cu.getString("userId");return{itemType:wr.Playlist,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,description:e.description?A(e.description):void 0,thumbnails:e.images,trackCount:e.tracks.total,pager:this.createPlaylistPager(e),owner:{name:e.owner.display_name||"",url:e.owner.external_urls.spotify},isPinned:xi.isPinned(e.uri),isOwn:n,inLibrary:!n&&Rr.get(e.uri,t)}}createMediaItemFromTrack(e,t){var n,r,i,a,s;const o=/album|compilation/i.test((null===(n=e.album)||void 0===n?void 0:n.album_type)||"")?e.album:void 0;return{itemType:wr.Media,mediaType:kr.Audio,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,artists:null===(r=e.artists)||void 0===r?void 0:r.map((e=>e.name)),albumArtist:null==o?void 0:o.artists.map((e=>e.name)).join(", "),album:null==o?void 0:o.name,duration:e.duration_ms/1e3,playedAt:e.played_at?Math.floor((new Date(e.played_at).getTime()||0)/1e3):0,genres:null===(i=e.album)||void 0===i?void 0:i.genres,disc:e.disc_number,track:e.track_number,year:e.album&&new Date(e.album.release_date).getUTCFullYear()||void 0,isrc:null===(a=e.external_ids)||void 0===a?void 0:a.isrc,thumbnails:null===(s=e.album)||void 0===s?void 0:s.images,unplayable:!1===e.is_playable,inLibrary:Rr.get(e.uri,t)}}createArtistAlbumsPager(e){const t=this.getMarket(),n=this.createArtistTopTracks(e),r=new Yr([n]),i=new Pu(((n,r)=>Tu(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield ou.getArtistAlbums(e.id,{offset:n,limit:r,market:t,include_groups:"album,compilation,single"});return{items:i,total:a,next:s}}))));return new yi(r,i)}createTopTracksPager(e){const t=this.getMarket();return new Pu(((n,r)=>Tu(this,void 0,void 0,(function*(){const{tracks:i}=yield ou.getArtistTopTracks(e.id,t,{offset:n,limit:r,market:t});return{items:i,next:""}}))),{pageSize:10,maxSize:10})}createAlbumPager(e){var t;const n=null===(t=e.tracks)||void 0===t?void 0:t.items;if(n&&n.length===e.total_tracks)return new Yi((()=>{const t=n.map((t=>this.createMediaItemFromTrack(Object.assign(Object.assign({},t),{album:e}))));return this.addInLibrary(t),t}));{const t=this.getMarket();return new Pu(((n,r)=>Tu(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield ou.getAlbumTracks(e.id,{offset:n,limit:r,market:t});return{items:i.map((t=>Object.assign(Object.assign({},t),{album:e}))),total:a,next:s}}))))}}createPlaylistPager(e){var t;const n=null===(t=e.tracks)||void 0===t?void 0:t.items;if(n&&n.length===e.tracks.total)return new Yi((()=>{const e=n.filter((e=>!!e.track)).map((e=>this.createMediaItemFromTrack(e.track)));return this.addInLibrary(e),e}));{const t=this.getMarket();return new Pu(((n,r)=>Tu(this,void 0,void 0,(function*(){const{items:i,total:a,next:s}=yield ou.getPlaylistTracks(e.id,{offset:n,limit:r,market:t});return{items:i.map((e=>e.track)).filter(l),total:a,next:s}}))))}}getMarket(){return cu.getString("market")}addInLibrary(e){return Tu(this,void 0,void 0,(function*(){const t=e[0];if(t){const n=e.filter((e=>void 0===e.inLibrary&&Uu.canStore(e,!0))).map((e=>{const[,,t]=e.src.split(":");return t}));if(0===n.length)return;let r=[];r=t.itemType===wr.Album?yield ou.containsMySavedAlbums(n):yield ou.containsMySavedTracks(n),zr.dispatch(e.map((({src:e},t)=>({match:t=>t.src===e,values:{inLibrary:r[t]}}))))}}))}}Pu.minPageSize=10,Pu.maxPageSize=50;const Iu=Pu;var Cu=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Mu=new N("spotify"),Ou={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},Nu={view:"details",fields:["Index","Artist","Title","Album","Track","Duration"]},$u={id:"spotify/recently-played",title:"Recently Played",icon:"clock",itemType:wr.Media,defaultHidden:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search(){return new Iu(((e,t)=>Cu(this,void 0,void 0,(function*(){const{items:e,total:n}=yield ou.getMyRecentlyPlayedTracks({limit:t});return{items:e.map((e=>Object.assign({played_at:e.played_at},e.track))),total:n,next:void 0}}))),{maxSize:50,pageSize:50})}},zu={id:"spotify/top-tracks",title:"Top Tracks",icon:"star",itemType:wr.Media,layout:Ou,search(){return new Iu(((e,t)=>Cu(this,void 0,void 0,(function*(){return ou.getMyTopTracks({offset:e,limit:t})}))))}},ju={id:"spotify/top-artists",title:"Top Artists",icon:"star",itemType:wr.Artist,search(){return new Iu(((e,t)=>Cu(this,void 0,void 0,(function*(){return ou.getMyTopArtists({offset:e,limit:t})}))))}},Lu={id:"spotify/liked-songs",title:"My Songs",icon:"heart",itemType:wr.Media,viewType:Sr.Library,layout:Ou,search(){const e=Ku();return new Iu(((t,n)=>Cu(this,void 0,void 0,(function*(){const{items:r,total:i,next:a}=yield ou.getMySavedTracks({offset:t,limit:n,market:e});return{items:r.map((e=>e.track)),total:i,next:a}}))),void 0,!0)}},Ru={id:"spotify/liked-albums",title:"My Albums",icon:"heart",itemType:wr.Album,viewType:Sr.Library,search(){const e=Ku();return new Iu(((t,n)=>Cu(this,void 0,void 0,(function*(){const{items:r,total:i,next:a}=yield ou.getMySavedAlbums({offset:t,limit:n,market:e});return{items:r.map((e=>e.album)),total:i,next:a}}))),{calculatePageSize:!0},!0)}},Du={id:"spotify/playlists",title:"My Playlists",icon:"heart",itemType:wr.Playlist,viewType:Sr.Library,secondaryLayout:Nu,search(){const e=Ku();return new Iu(((t,n)=>Cu(this,void 0,void 0,(function*(){const{items:r,total:i,next:a}=yield ou.getUserPlaylists(void 0,{offset:t,limit:n,market:e});return{items:r,total:i,next:a}}))),void 0,!0)}},Fu={id:"spotify/featured-playlists",title:"Featured Playlists",icon:"playlist",itemType:wr.Playlist,secondaryLayout:Nu,search(){const e=Ku();return new Iu(((t,n)=>Cu(this,void 0,void 0,(function*(){const{playlists:{items:r,total:i,next:a}}=yield ou.getFeaturedPlaylists({offset:t,limit:n,market:e});return{items:r,total:i,next:a}}))))}},_u={id:"spotify",name:"Spotify",icon:"spotify",url:"https://www.spotify.com",serviceType:vr.PublicMedia,defaultHidden:!0,roots:[Hu(wr.Media,{title:"Songs",layout:Ou}),Hu(wr.Album,{title:"Albums"}),Hu(wr.Artist,{title:"Artists"}),Hu(wr.Playlist,{title:"Playlists",secondaryLayout:Nu})],sources:[Lu,Ru,Du,$u,zu,ju,Fu],icons:{[yr.AddToLibrary]:"heart",[yr.RemoveFromLibrary]:"heart-fill"},labels:{[yr.AddToLibrary]:"Add to Spotify Library",[yr.RemoveFromLibrary]:"Remove from Spotify Library"},canRate:()=>!1,canStore:Vu,compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:wr.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":"),n=Ku();return new Iu((()=>Cu(this,void 0,void 0,(function*(){return{items:[yield ou.getPlaylist(t,{market:n,fields:"id,type,external_urls,name,description,images,owner,uri,tracks.total"})],total:1}}))))}}},getMetadata:function(e){return Cu(this,void 0,void 0,(function*(){if(!Vu(e)||void 0!==e.inLibrary)return e;const t=Rr.get(e.src);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const[,,n]=e.src.split(":");switch(e.itemType){case wr.Album:{const[t]=yield ou.containsMySavedAlbums([n]);return Object.assign(Object.assign({},e),{inLibrary:t})}case wr.Media:{const[t]=yield ou.containsMySavedTracks([n]);return Object.assign(Object.assign({},e),{inLibrary:t})}case wr.Playlist:{const[t]=yield ou.areFollowingPlaylist(n,[cu.getString("userId")]);return Object.assign(Object.assign({},e),{inLibrary:t})}default:return e}}))},lookup:function(e,t,n=10,r){return Cu(this,void 0,void 0,(function*(){if(!e||!t)return[];const i=e=>e.replace(/['"]/g," "),a={pageSize:n,maxSize:n,lookup:!0};return Hr(Yu(wr.Media,`${i(e)} ${i(t)}`,a),{timeout:r})}))},store:function(e,t){return Cu(this,void 0,void 0,(function*(){return Bu([e],t)}))},observeIsLoggedIn:function(){return bu().pipe(wn((e=>""!==e)),Or())},isLoggedIn:yu,login:function(){return uu(this,void 0,void 0,(function*(){if(!yu()){du.log("connect");try{const e=yield function(){return uu(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{let n=null;const r=i=>{if(/(localhost|ampcast)/.test(i.origin)){if(clearInterval(a),window.removeEventListener("message",r,!1),null==n||n.close(),n=null,i.origin!==location.origin)return void t({message:`Origin ${i.origin} does not match ${location.origin}`});(function(e){return uu(this,void 0,void 0,(function*(){const t=lu.getString("code_verifier"),n=yield fetch(`${fu}/api/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:Gr,grant_type:"authorization_code",code:e,redirect_uri:hu,code_verifier:t})});if(!n.ok)throw n;return yield n.json()}))})(i.data.code).then(e,t)}};window.addEventListener("message",r,!1);const i=new URLSearchParams({client_id:Gr,scope:["user-read-recently-played","user-read-playback-position","user-top-read","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","streaming","user-read-email","user-read-private","playlist-read-private","playlist-modify-private","playlist-modify-public","user-library-read","user-library-modify"].join(" "),redirect_uri:hu,response_type:"code",code_challenge_method:"S256",code_challenge:pu});n=window.open(`${fu}/authorize?${i}`,"Spotify","popup");const a=setInterval((()=>{(null==n?void 0:n.closed)&&(clearInterval(a),t({message:"access_denied"}))}),500)}))}))}();yield wu(e)}catch(e){du.error(e)}}}))},logout:function(){return uu(this,void 0,void 0,(function*(){du.log("disconnect"),yield xu()}))}},Uu=_u;function Vu(e,t){switch(e.itemType){case wr.Album:return!e.synthetic;case wr.Media:return!0;case wr.Playlist:return!e.isOwn&&!t;default:return!1}}function Bu(e,t){return Cu(this,void 0,void 0,(function*(){const n=e[0];if(!n)return;const r=e.map((e=>{const[,,t]=e.src.split(":");return t})),i=()=>Cu(this,void 0,void 0,(function*(){switch(n.itemType){case wr.Album:t?yield Promise.all(u(r,20).map((e=>ou.addToMySavedAlbums(e)))):yield Promise.all(u(r,20).map((e=>ou.removeFromMySavedAlbums(e))));break;case wr.Media:t?yield Promise.all(u(r,50).map((e=>ou.addToMySavedTracks(e)))):yield Promise.all(u(r,50).map((e=>ou.removeFromMySavedTracks(e))));break;case wr.Playlist:t?yield Promise.all(r.map((e=>ou.followPlaylist(e)))):yield Promise.all(r.map((e=>ou.unfollowPlaylist(e))))}}));try{yield i()}catch(e){if(401!==e.status)throw e;yield gu(),yield i()}}))}function Hu(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`spotify/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>Yu(e,t)})}function Yu(e,t,n){return t?new Iu(function(e,t){const n=Ku();switch(e){case wr.Media:return(e,r)=>Cu(this,void 0,void 0,(function*(){const{tracks:{items:i,total:a,next:s}}=yield ou.searchTracks(t,{offset:e,limit:r,market:n});return{items:i,total:a,next:s}}));case wr.Album:return(e,r)=>Cu(this,void 0,void 0,(function*(){const{albums:{items:i,total:a,next:s}}=yield ou.searchAlbums(t,{offset:e,limit:r,market:n});return{items:i,total:a,next:s}}));case wr.Artist:return(e,r)=>Cu(this,void 0,void 0,(function*(){const{artists:{items:i,total:a,next:s}}=yield ou.searchArtists(t,{offset:e,limit:r,market:n});return{items:i,total:a,next:s}}));case wr.Playlist:return(e,r)=>Cu(this,void 0,void 0,(function*(){const{playlists:{items:i,total:a,next:s}}=yield ou.searchPlaylists(t,{offset:e,limit:r,market:n});return{items:i,total:a,next:s}}));default:throw TypeError("Search not supported for this type of media")}}(e,t),Object.assign({maxSize:250},n)):new Yr}function Ku(){return cu.getString("market")}function Wu(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Nn(e);return ze((function(t,r){for(var i=e.length,a=new Array(i),s=e.map((function(){return!1})),o=!1,l=function(t){yn(e[t]).subscribe(je(r,(function(e){a[t]=e,o||s[t]||(s[t]=!0,(o=s.every(Pe))&&(s=null))}),he))},c=0;c<i;c++)l(c);t.subscribe(je(r,(function(e){if(o){var t=ee([e],Z(a));r.next(n?n.apply(void 0,ee([],Z(t))):t)}})))}))}function qu(e){return De((function(t,n){return e<=n}))}function Gu(e,t){return t?function(n){return Dn(t.pipe(Br(1),ze((function(e,t){e.subscribe(je(t,he))}))),n.pipe(Gu(e)))}:kn((function(t,n){return yn(e(t,n)).pipe(Br(1),function(e){return wn((function(){return e}))}(t))}))}function Ju(e,t){void 0===t&&(t=nn);var n=sn(e,t);return Gu((function(){return n}))}Rr.observeRemovals("spotify").pipe(wn((e=>{var t;switch(null===(t=e[0])||void 0===t?void 0:t.itemType){case wr.Media:return e.slice(0,500);case wr.Album:return e.slice(0,200);case wr.Playlist:return e.slice(0,10);default:return[]}})),De((e=>e.length>0)),Dr((e=>Bu(e,!1).then((()=>e)))),Dr((e=>Rr.applyRemovals(e))),Fr((e=>(Mu.error(e),[])))).subscribe(Mu);var Qu,Xu,Zu,ed=re((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}})),td=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},nd=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},rd=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const id=new N("SpotifyPlayer"),ad="Spotify player not connected",sd=(e,t)=>e.paused===t.paused&&e.position===t.position;Qu=new WeakMap,Xu=new WeakMap,Zu=new WeakMap;const od=new class{constructor(e){this.accessToken$=e,this.player=null,this.paused$=new $e(!0),this.src$=new $e(""),this.currentTrackSrc$=new $e(""),this.error$=new Oe,this.playerReady$=new $e(!1),this.playerStarted$=new $e(!1),this.state$=new $e(null),this.loadedSrc="",this.isLoggedIn=!1,this.deviceId="",this.hidden=!0,this.loop=!1,Qu.set(this,!1),Xu.set(this,!0),Zu.set(this,1),this.onSpotifyWebPlaybackSDKReady=()=>{id.log("onSpotifyWebPlaybackSDKReady"),this.observeAccessToken().pipe(De((e=>""!==e)),kn((e=>this.connect(e))),Re((()=>this.playerReady$.next(!0))),Br(1)).subscribe(id)},window.onSpotifyWebPlaybackSDKReady=this.onSpotifyWebPlaybackSDKReady,this.observeReady().pipe(Re((()=>this.player.activateElement())),Br(1)).subscribe(id),this.observeReady().pipe(Un((()=>this.observeIsLoggedIn())),Un((e=>e?this.observePaused():Fn)),Un((e=>e?Fn:this.observeSrc())),Wu(this.observeAccessToken()),Un((([e,t])=>e&&e!==this.loadedSrc?Gn(void 0).pipe(Un((()=>this.loadError?this.reconnect(t):Gn(void 0))),kn((()=>this.addToQueue(e,t))),Fr((t=>(this.loadedSrc="",this.loadError={src:e,error:t},this.error$.next(t),this.currentTrackSrc$.next(""),Fn))),Br(1)):Fn))).subscribe(id),this.observeSrc().subscribe((()=>this.currentTrackSrc$.next(""))),this.observeState().pipe(Re((e=>{var t,n;const r=null===(n=null===(t=e.track_window)||void 0===t?void 0:t.current_track)||void 0===n?void 0:n.uri;r&&this.loadedSrc===this.src&&this.currentTrackSrc!==r&&this.currentTrackSrc$.next(r)}))).subscribe(id),this.currentTrackSrc$.pipe(De((e=>!!e)),Un((()=>this.observeCurrentTrackState().pipe(qu(2),kn((e=>!e.paused&&this.paused?(id.log("State mismatch: pausing..."),this.safePause()):e.paused&&!this.paused?(id.log("State mismatch: resuming..."),this.safePlay()):Gn(void 0))),Br(1))))).subscribe(id),this.observeIsLoggedIn().pipe(fr((e=>e===this.isLoggedIn)),Re((e=>{this.isLoggedIn=e,e||this.paused||this.error$.next(Error(ad))}))).subscribe(id),this.observeIsLoggedIn().pipe(De((e=>e)),Br(1),kn((()=>c("https://sdk.scdn.co/spotify-player.js")))).subscribe(id),this.observeError().subscribe(id.error)}get autoplay(){return nd(this,Qu,"f")}set autoplay(e){nd(this,Qu,"f")!==e&&(rd(this,Qu,e,"f"),e&&this.playerStarted$.next(!0))}get muted(){return nd(this,Xu,"f")}set muted(e){nd(this,Xu,"f")!==e&&(rd(this,Xu,e,"f"),this.safeVolume(e?0:this.volume))}get volume(){return nd(this,Zu,"f")}set volume(e){nd(this,Zu,"f")!==e&&(rd(this,Zu,e,"f"),this.safeVolume(this.muted?0:e))}observeCurrentTime(){return _n(this.observeCurrentTrackState(),this.observePaused().pipe(Un((e=>e?this.getCurrentState():on(250).pipe(kn((()=>this.getCurrentState()))))))).pipe(wn((e=>{var t,n;return(null===(n=null===(t=null==e?void 0:e.track_window)||void 0===t?void 0:t.current_track)||void 0===n?void 0:n.uri)===this.currentTrackSrc?e.position/1e3:0})),Or())}observeDuration(){return this.observeCurrentTrackState().pipe(wn((e=>e.duration/1e3)),Or())}observeEnded(){return this.observePlaying().pipe(Un((()=>this.observeCurrentTrackState())),Or(sd),Wu(this.observePaused()),wn((([e,t])=>!t&&e.paused&&0===e.position)),De((e=>e)),wn((()=>{})))}observeError(){return this.error$}observePlaying(){return this.observeCurrentTrackState().pipe(Or(sd),Wu(this.observePaused()),wn((([e,t])=>!t&&!e.paused)),Or(),De((e=>e)),wn((()=>{})))}observeCurrentTrackState(){return this.observeState().pipe(De((e=>{var t,n;return(null===(n=null===(t=e.track_window)||void 0===t?void 0:t.current_track)||void 0===n?void 0:n.uri)===this.currentTrackSrc})))}appendTo(){}load(e){id.log("load",{src:e}),this.src$.next(e),this.autoplay&&this.paused$.next(!1),this.player&&this.isLoggedIn?this.autoplay&&e===this.loadedSrc&&this.safePlay():this.autoplay&&this.error$.next(Error(ad))}play(){var e;id.log("play"),this.paused$.next(!1),this.player&&this.isLoggedIn?this.src===(null===(e=this.loadError)||void 0===e?void 0:e.src)?this.error$.next(this.loadError.error):this.src===this.loadedSrc&&this.safePlay():this.isLoggedIn||this.error$.next(Error(ad))}pause(){id.log("pause"),this.paused$.next(!0),this.safePause()}stop(){id.log("stop"),this.paused$.next(!0),this.safeStop()}seek(e){var t;null===(t=this.player)||void 0===t||t.seek(1e3*e)}resize(){}getCurrentState(){var e;return td(this,void 0,void 0,(function*(){return(null===(e=this.player)||void 0===e?void 0:e.getCurrentState())||null}))}get paused(){return this.paused$.getValue()}get src(){return this.src$.getValue()}get currentTrackSrc(){return this.currentTrackSrc$.getValue()}observeAccessToken(){return this.accessToken$}observeIsLoggedIn(){return this.observeAccessToken().pipe(wn((e=>!!e)),Or())}observePaused(){return this.paused$.pipe(Or())}observeReady(){return Cr([this.playerReady$,this.playerStarted$]).pipe(De((([e,t])=>e&&t)),wn((()=>{})),Br(1))}observeSrc(){return this.src$.pipe(Or())}observeState(){return this.state$.pipe(De(l))}addToQueue(e,t,n=3){var r;return td(this,void 0,void 0,(function*(){if(e!==this.src)return;if(!t)throw Error(ad);const i=yield fetch(`https://api.spotify.com/v1/me/player/play?device_id=${this.deviceId}`,{method:"PUT",body:JSON.stringify({uris:[e],position_ms:0}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!i.ok){if(n>0)switch(i.status){case 401:{const t=yield gu();return this.addToQueue(e,t,--n)}case 429:{const n=Number(null===(r=i.headers)||void 0===r?void 0:r.get("Retry-After"));if(n&&n<=5)return yield P(1e3*n),this.addToQueue(e,t,0);throw i}case 404:case 502:case 503:return yield this.reconnect(t),this.addToQueue(e,t,--n)}throw i}this.loadError=void 0,this.loadedSrc=e}))}connect(e){return td(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{let r=!1;const i=new Spotify.Player({name:"ampcast",getOAuthToken:t=>td(this,void 0,void 0,(function*(){r&&(e=yield gu()),r=!0,t(e)})),volume:this.muted?0:this.volume});i.addListener("initialization_error",n),i.addListener("authentication_error",n),i.addListener("account_error",n),i.addListener("playback_error",(e=>this.error$.next(e))),i.addListener("player_state_changed",(e=>this.state$.next(e))),i.addListener("not_ready",(()=>{id.log("not_ready"),this.deviceId="",n("not_ready")})),i.addListener("ready",(({device_id:e})=>{id.log("ready"),this.player=i,this.deviceId=e,t(i)})),i.connect()}))}))}disconnect(){return td(this,void 0,void 0,(function*(){this.loadedSrc="",this.currentTrackSrc$.next(""),this.loadError=void 0;const e=this.player;e&&(e.removeListener("initialization_error"),e.removeListener("authentication_error"),e.removeListener("account_error"),e.removeListener("playback_error"),e.removeListener("player_state_changed"),e.removeListener("not_ready"),e.removeListener("ready"),yield this.safePause(),e.disconnect())}))}reconnect(e){return td(this,void 0,void 0,(function*(){return id.log("reconnect"),t=Rn(this.disconnect()).pipe(Ju(1e3),kn((()=>this.connect(e))),Ju(3e3),wn((()=>{}))),new Promise((function(e,n){var r=new ke({next:function(t){e(t),r.unsubscribe()},error:n,complete:function(){n(new ed)}});t.subscribe(r)}));var t}))}safePause(){return td(this,void 0,void 0,(function*(){try{this.player&&this.loadedSrc&&(yield this.player.pause())}catch(e){id.error(e)}}))}safePlay(){return td(this,void 0,void 0,(function*(){try{this.player&&this.loadedSrc&&(yield this.player.resume())}catch(e){this.error$.next(e)}}))}safeStop(){return td(this,void 0,void 0,(function*(){try{if(this.player&&this.loadedSrc){yield this.player.pause();const e=yield this.getCurrentState();(null==e?void 0:e.position)&&(yield this.player.seek(0))}}catch(e){id.error(e)}}))}safeVolume(e){var t;return td(this,void 0,void 0,(function*(){try{yield null===(t=this.player)||void 0===t?void 0:t.setVolume(e)}catch(e){id.error(e)}}))}}(bu());var ld=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function cd(e){const t=(0,r.useCallback)(((e,t,n)=>ld(this,void 0,void 0,(function*(){const r=Ji(12),i=Ms()(n+r),a=new URLSearchParams({u:t,t:i,s:r,v:"1.13.0",c:"ampcast",f:"json"}).toString(),s=yield fetch(`${e}/rest/ping?${a}`);if(!s.ok)throw s;const{"subsonic-response":o}=yield s.json();if(o.error)throw Error(o.error.message||"Failed");return JSON.stringify({userName:t,credentials:a})}))),[]);return r.createElement(Gi,Object.assign({},e,{service:zd,settings:kl,login:t}))}var ud=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const dd=new N("subsonicAuth"),md=new $e(""),hd=new $e(!1);function fd(){return hd.getValue()}function pd(e){kl.credentials=e,md.next(e)}md.pipe(Or()).pipe(De((e=>""!==e)),kn((()=>function(){return ud(this,void 0,void 0,(function*(){try{const e=yield Ol.getMusicLibraries();return kl.libraries=e,!0}catch(e){return dd.error(e),md.next(""),!1}}))}()))).subscribe(hd),pd(kl.credentials);var vd=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};class bd{constructor(e,t,n,r){this.parent=r,this.pageNumber=1,this.pageSize=(null==n?void 0:n.pageSize)||200,this.pager=new vi((()=>vd(this,void 0,void 0,(function*(){const n=this.pageSize,r=(this.pageNumber-1)*n,{items:i,total:a,atEnd:s}=yield t(r,n);return this.pageNumber++,{items:i.map((t=>this.createMediaObject(e,t))),total:a,atEnd:s}}))),Object.assign({pageSize:this.pageSize},n))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createMediaObject(e,t){var n;let r;switch(e){case wr.Album:r=this.createMediaAlbum(t);break;case wr.Artist:r=this.createMediaArtist(t);break;case wr.Playlist:r=this.createMediaPlaylist(t);break;case wr.Folder:r=this.createFolderItem(t);break;default:r=this.createMediaItem(t)}return zd.canRate(r)&&(r.itemType!==wr.Album||(null===(n=r.subsonic)||void 0===n?void 0:n.isDir))&&(r.rating=this.getRating(r,t)),r}createMediaItem(e){return"video"===e.type?this.createMediaItemFromVideo(e):this.createMediaItemFromSong(e)}createFolderItem(e){return"type"in e?this.createMediaItem(e):this.createMediaFolder(e)}createMediaItemFromSong(e){return{itemType:wr.Media,mediaType:kr.Audio,src:`subsonic:audio:${e.id}`,fileName:this.getFileName(e.path||"")||"[unknown]",title:e.title,artists:[e.artist],album:e.album,duration:e.duration,track:e.track,disc:e.discNumber,year:e.year,playedAt:0,playCount:e.playCount,genres:e.genre?[e.genre]:void 0,thumbnails:this.createThumbnails(e.coverArt)}}createMediaItemFromVideo(e){return{itemType:wr.Media,mediaType:kr.Video,src:`subsonic:video:${e.id}`,fileName:this.getFileName(e.path||"")||"[unknown]",title:e.title,duration:e.duration,playedAt:0,playCount:e.playCount,thumbnails:this.createThumbnails(e.id)}}createMediaAlbum(e){return{itemType:wr.Album,src:`subsonic:album:${e.id}`,title:e.name,addedAt:this.parseDate(e.created),artist:e.artist,year:e.year,playCount:e.playCount,genres:e.genre?[e.genre]:void 0,pager:this.createAlbumTracksPager(e),thumbnails:this.createThumbnails(e.coverArt),subsonic:{isDir:e.isDir}}}createMediaArtist(e){return{itemType:wr.Artist,src:`subsonic:artist:${e.id}`,title:e.name,pager:this.createArtistAlbumsPager(e),thumbnails:this.createThumbnails(e.coverArt)}}createMediaPlaylist(e){const t=`subsonic:playlist:${e.id}`;return{src:t,itemType:wr.Playlist,title:e.name,description:e.comment,addedAt:this.parseDate(e.created),duration:e.duration,trackCount:e.songCount,pager:this.createPlaylistItemsPager(e),thumbnails:this.createThumbnails(e.coverArt),isPinned:xi.isPinned(t),isOwn:e.owner===kl.userName,owner:{name:e.owner}}}createMediaFolder(e){var t;const n=e.title||"[unknown]",r={itemType:wr.Folder,src:`subsonic:folder:${e.id}`,title:n,fileName:n,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===wr.Folder?`${this.parent.path}/${n}`:"/",parent:this.parent};return r.pager=this.createFolderPager(r),r}getRating(e,t){return Vr.get(e,t.starred?1:0)}parseDate(e){const t=Date.parse(e)||0;return t<0?0:Math.round(t/1e3)}createThumbnails(e){return e?[this.createThumbnail(e,120),this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480)]:void 0}createThumbnail(e,t,n=t){return{url:`${kl.host}/rest/getCoverArt?id=${e}&size=${t}&{subsonic-credentials}`,width:t,height:n}}getFileName(e){return e.split(/[/\\]/).pop()}createAlbumTracksPager(e){return e.song?new Yr(e.song.map((e=>this.createMediaObject(wr.Media,e)))):new bd(wr.Media,(()=>vd(this,void 0,void 0,(function*(){return{items:yield Ol.getAlbumTracks(e.id,e.isDir),atEnd:!0}}))))}createArtistAlbumsPager(e){const t=this.createArtistTopTracks(e),n=new Yr([t]),r=e.album?new Yr(e.album.map((e=>this.createMediaObject(wr.Album,e)))):new bd(wr.Album,(()=>vd(this,void 0,void 0,(function*(){return{items:yield Ol.getArtistAlbums(e.id),atEnd:!0}}))),void 0);return new yi(n,r)}createArtistTopTracks(e){return{itemType:wr.Album,src:`subsonic:top-tracks:${e.id}`,title:"Top Songs",artist:e.name,thumbnails:this.createThumbnails(e.coverArt),pager:this.createTopTracksPager(e),synthetic:!0}}createTopTracksPager(e){return new bd(wr.Media,(()=>vd(this,void 0,void 0,(function*(){return{items:yield Ol.getArtistTopTracks(e.name),atEnd:!0}}))))}createPlaylistItemsPager(e){return e.entry?new Yr(e.entry.map((e=>this.createMediaObject(wr.Media,e)))):new bd(wr.Media,(()=>vd(this,void 0,void 0,(function*(){return{items:yield Ol.getPlaylistItems(e.id),atEnd:!0}}))))}createFolderPager(e){var t;const[,,n]=e.src.split(":"),r=new bd(wr.Folder,(()=>vd(this,void 0,void 0,(function*(){return{items:yield Ol.getMusicDirectoryItems(n),atEnd:!0}}))),{pageSize:this.pageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===wr.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new Yr([e]);return new yi(t,r)}return r}}bd.minPageSize=10,bd.maxPageSize=500;const yd=bd;var gd=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const wd="subsonic",Ed={id:"subsonic/liked-songs",title:"My Songs",icon:"heart",itemType:wr.Media,viewType:Sr.Ratings,layout:{view:"details",fields:["Artist","Title","Album","Track","Duration","Genre","PlayCount"]},search(){return new yd(wr.Media,(()=>gd(this,void 0,void 0,(function*(){return{items:yield Ol.getLikedSongs(),atEnd:!0}}))))}},kd={id:"subsonic/liked-albums",title:"My Albums",icon:"heart",itemType:wr.Album,viewType:Sr.Ratings,search(){return new yd(wr.Album,((e,t)=>gd(this,void 0,void 0,(function*(){return{items:yield Ol.getLikedAlbums(e,t)}}))))}},xd={id:"subsonic/recently-played",title:"Recently Played",icon:"clock",itemType:wr.Album,viewType:Sr.RecentlyPlayed,search(){return new yd(wr.Album,((e,t)=>gd(this,void 0,void 0,(function*(){return{items:yield Ol.getRecentlyPlayed(e,t)}}))))}},Sd={id:"subsonic/most-played",title:"Most Played",icon:"most-played",itemType:wr.Album,viewType:Sr.MostPlayed,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},secondaryLayout:{view:"details",fields:["Index","Title","Artist","Duration","PlayCount"]},search(){return new yd(wr.Album,((e,t)=>gd(this,void 0,void 0,(function*(){return{items:yield Ol.getMostPlayed(e,t)}}))))}},Td={id:"subsonic/playlists",title:"Playlists",icon:"playlist",itemType:wr.Playlist,secondaryLayout:{view:"details",fields:["Index","Artist","Title","Album","Track","Duration","PlayCount"]},search(){return new yd(wr.Playlist,(()=>gd(this,void 0,void 0,(function*(){return{items:yield Ol.getPlaylists(),atEnd:!0}}))))}},Ad={id:"subsonic/tracks-by-genre",title:"Songs by Genre",icon:"genre",itemType:wr.Media,viewType:Sr.ByGenre,defaultHidden:!0,layout:{view:"details",fields:["Artist","Title","Album","Track","Duration","PlayCount"]},search(e){return e?new yd(wr.Media,((t,n)=>gd(this,void 0,void 0,(function*(){return{items:yield Ol.getSongsByGenre(e.id,t,n),total:e.count}})))):new Yr}},Pd={id:"subsonic/albums-by-genre",title:"Albums by Genre",icon:"genre",itemType:wr.Album,viewType:Sr.ByGenre,search(e){return e?new yd(wr.Album,((t,n)=>gd(this,void 0,void 0,(function*(){return{items:yield Ol.getAlbumsByGenre(e.id,t,n),total:e.count}})))):new Yr}},Id={id:"subsonic/albums-by-decade",title:"Albums by Decade",icon:"calendar",itemType:wr.Album,viewType:Sr.ByDecade,search(e){return e?new yd(wr.Album,((t,n)=>gd(this,void 0,void 0,(function*(){return{items:yield Ol.getAlbumsByDecade(e.id,t,n)}})))):new Yr}},Cd={id:"subsonic/random-tracks",title:"Random Songs",icon:"shuffle",itemType:wr.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},search(){return new yd(wr.Media,(()=>gd(this,void 0,void 0,(function*(){return{items:yield Ol.getRandomSongs(100),atEnd:!0}}))))}},Md={id:"subsonic/random-albums",title:"Random Albums",icon:"shuffle",itemType:wr.Album,search(){return new yd(wr.Album,(()=>gd(this,void 0,void 0,(function*(){return{items:yield Ol.getRandomAlbums(100),atEnd:!0}}))))}},Od={id:"subsonic/videos",title:"Music Videos",icon:"video",itemType:wr.Media,mediaType:kr.Video,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Title","Duration"]},search(){return new yd(wr.Media,(()=>gd(this,void 0,void 0,(function*(){return{items:yield Ol.getVideos(),atEnd:!0}}))))}},Nd={id:"subsonic/folders",title:"Folders",icon:"folder",itemType:wr.Folder,viewType:Sr.Folders,search(){const e={itemType:wr.Folder,src:"",title:"Folders",fileName:"",path:""},t=(e,t)=>e.name.localeCompare(t.name);return e.pager=new Yi((()=>kl.libraries.map((({id:n,title:r})=>{const i={itemType:wr.Folder,src:`subsonic:folder:${n}`,title:r,fileName:r,path:`/${r}`},a=Object.assign(Object.assign({},e),{fileName:"../"}),s=new Yr([a]),o=new yd(wr.Folder,(()=>gd(this,void 0,void 0,(function*(){return{items:(yield Ol.getIndexes(n)).map((e=>e.artist.map((({id:e,name:t})=>({id:e,name:t,title:t}))))).flat().sort(t),atEnd:!0}}))),void 0,i);return i.pager=new yi(s,o),i})))),e.pager}},$d={id:wd,icon:wd,name:"Subsonic",url:"http://www.subsonic.org/",serviceType:vr.PersonalMedia,defaultHidden:!0,roots:[Ld(wr.Media,{title:"Songs"}),Ld(wr.Album,{title:"Albums"}),Ld(wr.Artist,{title:"Artists"})],sources:[Ed,kd,xd,Sd,Td,Ad,Pd,Id,Cd,Md,Od,Nd],labels:{[yr.Like]:"Like on Subsonic",[yr.Unlike]:"Unlike on Subsonic"},get audioLibraries(){return kl.audioLibraries},get libraryId(){return kl.libraryId},set libraryId(e){kl.libraryId=e},get libraries(){return kl.libraries},set libraries(e){kl.libraries=e},observeLibraryId:()=>kl.observeLibraryId(),canRate:jd,canStore:()=>!1,compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:wr.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":");return new yd(wr.Playlist,(()=>gd(this,void 0,void 0,(function*(){return{items:[yield Ol.getPlaylist(t)],atEnd:!0}}))))}}},getFilters:function(e,t){return gd(this,void 0,void 0,(function*(){return Ol.getFilters(e,t)}))},getMetadata:function(e){var t;return gd(this,void 0,void 0,(function*(){const n=e.itemType,[,,r]=e.src.split(":");if(n===wr.Album&&void 0===e.description){const n=yield Ol.getAlbumInfo(r,null===(t=e.subsonic)||void 0===t?void 0:t.isDir);e=Object.assign(Object.assign({},e),{description:A(n.notes),release_mbid:n.musicBrainzId})}else if(n===wr.Artist&&void 0===e.description){const t=yield Ol.getArtistInfo(r);e=Object.assign(Object.assign({},e),{description:A(t.biography),artist_mbid:t.musicBrainzId})}if(!jd(e)||void 0!==e.rating)return e;const i=Vr.get(e);if(void 0!==i)return Object.assign(Object.assign({},e),{rating:i});if(n===wr.Album){const t=yield Rd(e),n=yield Ol.getMusicDirectory(t);return Object.assign(Object.assign({},e),{rating:n.starred?1:0})}{const t=yield Ol.getSong(r);return Object.assign(Object.assign({},e),{rating:t.starred?1:0})}}))},getPlayableUrlFromSrc:function(e){return Ol.getPlayableUrlFromSrc(e)},getThumbnailUrl:function(e){return e.replace("{subsonic-credentials}",kl.credentials)},lookup:function(e,t,n=10,r){return gd(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:n,maxSize:n,lookup:!0};return Hr(new yd(wr.Media,((n,r)=>gd(this,void 0,void 0,(function*(){return{items:yield Ol.searchSongs(`${e} ${t}`,n,r)}}))),i),{timeout:r})}))},rate:function(e,t){return gd(this,void 0,void 0,(function*(){const n=t?"star":"unstar";switch(e.itemType){case wr.Media:{const[,,t]=e.src.split(":");yield Ol.get(n,{id:t});break}case wr.Album:{const t=yield Rd(e);yield Ol.get(n,{id:t});break}}}))},observeIsLoggedIn:function(){return hd.pipe(Or())},isLoggedIn:fd,login:function(){return ud(this,void 0,void 0,(function*(){if(!fd()){dd.log("connect");try{const e=yield function(){return ld(this,void 0,void 0,(function*(){return Dt(cd,!0)}))}();if(e){const{userName:t,credentials:n}=JSON.parse(e);kl.userName=t,pd(n)}}catch(e){dd.error(e)}}}))},logout:function(){return ud(this,void 0,void 0,(function*(){dd.log("disconnect"),kl.clear(),pd(""),hd.next(!1)}))}},zd=$d;function jd(e){switch(e.itemType){case wr.Media:return!0;case wr.Album:return!e.synthetic;default:return!1}}function Ld(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`subsonic/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search({q:t=""}={}){return(t=t.trim())?new yd(e,((n,r)=>gd(this,void 0,void 0,(function*(){switch(e){case wr.Media:return{items:yield Ol.searchSongs(t,n,r)};case wr.Album:return{items:yield Ol.searchAlbums(t,n,r)};case wr.Artist:return{items:yield Ol.searchArtists(t,n,r)};default:throw TypeError("Search not supported for this type of media")}})))):new Yr}})}function Rd(e){var t;return gd(this,void 0,void 0,(function*(){const[,,n]=e.src.split(":");if(null===(t=e.subsonic)||void 0===t?void 0:t.isDir)return n;const[{parent:r}]=yield Ol.getAlbumTracks(n);return r||""}))}Vr.addObserver($d);const Dd=new N("mediaServices");function Fd(){return[Ri,Uu,Xo,Ua,xs,dc,nu,zd,eo,vl]}function _d(){return Fd().filter((e=>!!e.lookup))}function Ud(){return Fd().filter(Kd)}function Vd(e){return Fd().find((t=>t.id===e))}function Bd({src:e=""}={}){const[t]=(null==e?void 0:e.split(":"))||[""];return Vd(t)}function Hd(e){return!!e&&Yd(e.src)}function Yd(e){if(e){const[t,n,r]=e.split(":");return"blob"===t||"file"===t||!!r&&!!n&&function(e){const t=Vd(e);return!!t&&t.serviceType!==vr.Scrobbler}(t)}return!1}function Kd(e){return Gd(e,vr.PersonalMedia)}function Wd(e){return Gd(e,vr.PublicMedia)}function qd(e){return Gd(e,vr.Scrobbler)}function Gd(e,t){return function(e){return!!e&&"serviceType"in e}(e)&&e.serviceType===t}function Jd({servicesRef:e,onSubmit:t}){const[n,i,a]=(0,r.useMemo)((()=>[Fd().filter(Wd),Ud(),Fd().filter(qd)]),[]);return r.createElement("form",{className:"media-library-settings-general",method:"dialog",onSubmit:t,ref:e},r.createElement("fieldset",null,r.createElement("legend",null,"Media Services"),r.createElement(Qd,{services:n})),r.createElement("fieldset",null,r.createElement("legend",null,"Personal Media"),r.createElement(Qd,{services:i})),r.createElement("fieldset",null,r.createElement("legend",null,"Listening History"),r.createElement(Qd,{services:a})),r.createElement(Vt,null))}function Qd({services:e}){const t=(0,r.useId)();return r.createElement("ul",{className:"checkbox-list"},e.map((e=>r.createElement("li",{key:e.id},r.createElement("input",{id:`${t}-${e.id}`,type:"checkbox",value:e.id,defaultChecked:mr(e)}),r.createElement("label",{htmlFor:`${t}-${e.id}`},r.createElement(Ki,{icon:e.icon,text:e.name}))))))}function Xd(e){const t=(0,r.useRef)(null),n=(0,r.useCallback)((()=>{const e=t.current.elements,n={};for(const t of e)"checkbox"===t.type&&(n[t.value]=!t.checked);hr(n)}),[]);return r.createElement(Lt,Object.assign({},e,{className:"settings-dialog media-service-selection-dialog",title:"Media Service Selection"}),r.createElement("p",null,"Select any services you are interested in."),r.createElement(Jd,{servicesRef:t,onSubmit:n}))}Rn(Fd()).pipe(kn((e=>e.observeIsLoggedIn().pipe(fr((e=>!e)),Re((t=>Dd.log(`${e.name} ${t?"":"dis"}connected`))))))).subscribe(Dd);var Zd=n(4511),em=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function tm(e){var{service:t}=e,n=em(e,["service"]);return r.createElement("p",null,r.createElement("button",Object.assign({},n,{className:"branded login",onClick:t.login}),"Log in to ",t.name))}function nm({service:e}){return r.createElement("p",null,"You need to be logged in to"," ",e.serviceType===vr.Scrobbler?"access your data":"play music"," from"," ",e.name,".")}function rm({service:e}){return r.createElement("p",{className:"service-link"},r.createElement($t,{name:e.icon}),r.createElement(uo,{href:e.url}))}function im(){const{musicKit:e,error:t}=function(){const[e,t]=(0,r.useState)(null),[n,i]=(0,r.useState)(null);return(0,r.useEffect)((()=>{const e=Rn(ui()).subscribe({next:t,error:i});return()=>e.unsubscribe()}),[]),{musicKit:e,error:n}}();return r.createElement("div",{className:"panel"},r.createElement("div",{className:"page login"},r.createElement(nm,{service:Ri}),r.createElement(tm,{service:Ri,disabled:!e}),t?r.createElement("p",{className:"error"},"Could not load Apple MusicKit library."):null,r.createElement(rm,{service:Ri})))}function am({service:e}){return r.createElement("div",{className:"panel"},r.createElement("div",{className:"page login"},r.createElement(nm,{service:e}),r.createElement(tm,{service:e}),r.createElement(rm,{service:e})))}function sm(){return(0,r.useEffect)((()=>{const e=new Oe,t=e.pipe(kn((e=>sn(e))),kn((()=>function(){return Ac(this,void 0,void 0,(function*(){return Nc=yield Tc.fetchJSON({host:Ic,path:"/pins",method:"POST",params:{strong:"true"}}),Nc}))}())),wn((e=>1e3*e.expiresIn)),Re((t=>e.next(t)))).subscribe();return e.next(0),()=>t.unsubscribe()})),r.createElement(am,{service:nu})}function om({service:e}){return r.createElement("div",{className:"dev-mode note"},r.createElement("p",null,"This application is in ",r.createElement("strong",null,"development mode"),"."),r.createElement("p",null,"You currently need to be an approved user to access services from ",e.name,"."))}function lm(){return r.createElement("div",{className:"panel"},r.createElement("div",{className:"page login"},r.createElement(om,{service:Uu}),r.createElement("p",null,"You need to be logged in to play music from Spotify.*"),r.createElement(tm,{service:Uu}),r.createElement("p",null,r.createElement("small",null,"*Spotify Premium required.")),r.createElement(rm,{service:Uu})))}function cm(e,t){return void 0===t&&(t=nn),ze((function(n,r){var i=null,a=null,s=null,o=function(){if(i){i.unsubscribe(),i=null;var e=a;a=null,r.next(e)}};function l(){var n=s+e,a=t.now();if(a<n)return i=this.schedule(void 0,n-a),void r.add(i);o()}n.subscribe(je(r,(function(n){a=n,s=t.now(),i||(i=t.schedule(l,e),r.add(i))}),(function(){o(),r.complete()}),void 0,(function(){a=i=null})))}))}function um(e){return new Promise(((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)}))}function dm(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=um(n);return(e,n)=>r.then((r=>n(r.transaction(t,e).objectStore(t))))}let mm;function hm(){return mm||(mm=dm("keyval-store","keyval")),mm}function fm(e,t=hm()){return t("readonly",(t=>um(t.get(e))))}function pm(e,t,n=hm()){return n("readwrite",(n=>(n.put(t,e),um(n.transaction))))}var vm;!function(e){e.Looking="looking",e.NotFound="not-found"}(vm||(vm={}));const bm=vm;var ym=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const gm=new N("file");function wm(e){var t,r,i;return ym(this,void 0,void 0,(function*(){const{parseBlob:a}=yield Promise.all([n.e(463),n.e(12)]).then(n.bind(n,2463));let s;try{s=yield a(e,{duration:!0,skipCovers:!0})}catch(t){gm.log(`Error parsing file: ${e.name}`),gm.error(t),s={format:{},common:{}}}const{common:o,format:l}=s,c=e.type.startsWith("video"),u=l.duration||(yield function(e){return ym(this,void 0,void 0,(function*(){return new Promise((t=>{const n=e.type.startsWith("video"),r=document.createElement(n?"video":"audio"),i=URL.createObjectURL(e),a=()=>{const e=r.error?0:r.duration;r.ondurationchange=null,r.onerror=null,r.src="",r.removeAttribute("src"),URL.revokeObjectURL(i),t(e)};r.ondurationchange=a,r.onerror=a,r.onended=a,r.muted=!0,r.src=i}))}))}(e)),d=(e=0)=>Math.floor(Number(e))||0;return{itemType:wr.Media,mediaType:c?kr.Video:kr.Audio,src:`blob:${Ji()}`,externalUrl:"",title:o.title||e.name.replace(/\.\w+$/,""),artists:o.artist?[o.artist]:o.artists,albumArtist:o.album&&o.albumartist||"",album:o.album||"",genres:o.genre,duration:u?Number(u.toFixed(3)):0,track:d(null===(t=o.track)||void 0===t?void 0:t.no),disc:d(null===(r=o.disk)||void 0===r?void 0:r.no),year:d(o.year),mood:o.mood||"",rating:Number(o.rating)||0,isrc:null===(i=o.isrc)||void 0===i?void 0:i[0],recording_mbid:o.musicbrainz_recordingid,playedAt:0,blob:e}}))}var Em=n(4909),km=n.n(Em),xm=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Sm=new N("localdb/listens"),Tm=[],Am=new $e(Tm);class Pm extends wt.ZP{constructor(){super("ampcast/listens"),this.version(1).stores({items:"&playedAt, src, lastfmScrobbledAt, listenbrainzScrobbledAt"})}}const Im=new Pm;function Cm(){return Am.pipe(De((e=>e!==Tm)))}function Mm(e,t,n){const r=Math.min(e/2,240);return t=Math.floor(t/1e3),(n=Math.floor(n/1e3))-t>r}function Om(e){return xm(this,void 0,void 0,(function*(){try{e.length>0&&(yield Im.items.bulkPut(e))}catch(e){Sm.error(e)}}))}function Nm(e,t=30){return Math.round(e.playedAt/t)}function $m(e,t,n=5){const r=t.playedAt,i=r-n,a=r+t.duration+n;for(const n of e){if(n.playedAt<i)return;if(n.playedAt>i&&n.playedAt<a&&jm(t,n,.75))return n}}function zm(e,t){const n=Am.getValue();return function(e,t,n=5){const r=t.playedAt;if(r)for(let i=0;i<e.length;i++){const a=e[i-1];if(a&&a.playedAt<r)return;const s=e[i],o=s.playedAt-n,l=s.playedAt+s.duration+n;if(r>o&&r<l&&jm(s,t,.75))return s}}(n,e,t)||function(e,t){return e.find((e=>t.src===e.src||t.externalUrl&&t.externalUrl===e.externalUrl||t.isrc&&t.isrc===e.isrc||t.recording_mbid&&t.recording_mbid===e.recording_mbid))}(n,e)||Qm(n,e)}function jm(e,t,n){return S(e.title,t.title,n)}function Lm(e){return xm(this,void 0,void 0,(function*(){const t=`${e}ScrobbledAt`,n=Math.floor(Date.now()/1e3)-1209600,r=yield Im.items.where(t).equals(0).toArray();yield Om(r.filter((e=>e.playedAt<n)).map((e=>Object.assign(Object.assign({},e),{[t]:-1}))))}))}xm(void 0,void 0,void 0,(function*(){try{yield Lm("lastfm"),yield Lm("listenbrainz")}catch(e){Sm.error(e)}(0,wt.Y1)((()=>Im.items.orderBy("playedAt").reverse().toArray())).subscribe(Am)}));const Rm=new Oe,Dm=new Oe,Fm=new D("lookup"),_m={get preferredService(){return Fm.getString("preferredService")},set preferredService(e){Fm.setString("preferredService",e)}};var Um=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Vm=new N("lookupStore");class Bm extends wt.ZP{constructor(){super("ampcast/lookup"),this.version(1).stores({items:"&[service+artist+title]"})}add(e,t,n,r){return Um(this,void 0,void 0,(function*(){try{e&&(Vm.log("add",{service:e,artist:t,title:n,items:r}),t=t.toLowerCase(),n=n.toLowerCase(),r=r.map((e=>C(e))),yield this.items.put({service:e,artist:t,title:n,items:r}))}catch(e){Vm.error(e)}}))}get(e,t,n){return Um(this,void 0,void 0,(function*(){return this.items.get([e,t.toLowerCase(),n.toLowerCase()])}))}}const Hm=new Bm;var Ym=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},Km=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Wm=new N("lookup");let qm="";function Gm(e,t){return Ym(this,void 0,void 0,(function*(){try{if(!e.lookup)return[];const{artist:n,title:r}=ih(t),i=yield Hm.get(e.id,n,r);if(i)return i.items;if(e.isLoggedIn()){const i=e=>rh(e).replace(/[([].*$/,"").replace(/['"]/g," ").replace(/\s\s+/g," "),a=Xm(yield e.lookup(i(t.albumArtist||ah(n)),i(ah(r)),10,2e3),t);return yield Hm.add(e.id,n,r,a),a}}catch(e){Wm.error(e)}return[]}))}function Jm(e,t,n){return Ym(this,void 0,void 0,(function*(){const r=_d().filter((e=>e!==n&&e.isLoggedIn()===t));return 0===r.length?[]:(yield Promise.all([...r.map((t=>Gm(t,e)))])).flat()}))}function Qm(e,t){const{artist:n,title:r}=ih(t);if(!n||!r)return;const i=_m.preferredService||qm;let a=Xm(e,t);return a=x(a,(e=>th(e,t))),i&&(a=x(a,(e=>e.src.startsWith(i)))),a[0]}function Xm(e,t){let n=e.filter((e=>eh(e,t,!0)));return 0===n.length&&(n=e.filter((e=>eh(e,t,!1)))),n}const Zm=/\s*(feat\.|[([]?\s?feat[\s.]).*$/i;function eh(e,t,n){return(function(e,t,n){let r=t.title;if(!r)return!1;if(nh(r,e.title))return!0;if(n)return!1;const i=rh(e.title);if(r=rh(r),nh(r,i))return!0;const[,...a]=e.artists||[];if(a.length>0){const e=a.length>1?` & ${a.pop()}`:"";if(nh(r,`${i} (feat. ${a.join(", ")}${e})`))return!0}return!(!Zm.test(r)||!nh(ah(r),i))||!(!Zm.test(e.title)||!nh(r,ah(i)))}(e,t,n)||function(e,t){if(!th(e,t))return!1;if(e.track!==t.track)return!1;const n=rh(e.title),r=rh(t.title);return!(!n.startsWith(r)&&!r.startsWith(n))||S(n,r,.75)}(e,t))&&function(e,t,n){var r;const i=null===(r=t.artists)||void 0===r?void 0:r[0];if(!i)return!1;const a=e.artists;if(!a)return!1;const s=a[0];if(!s)return!1;if(nh(i,s))return!0;if(n)return!1;if(nh(rh(i),rh(s)))return!0;if(nh(ah(i),ah(s)))return!0;const o=t.albumArtist;if(o&&nh(rh(o),rh(s)))return!0;if(nh(ah(i),e.albumArtist))return!0;const l=",;&|/".split("").map((e=>[e,`${e} `,` ${e} `])).flat();for(const e of l){const[t]=a[0].split(e);if(nh(i,t))return!0;if(a.length>1&&nh(i,a.join(e)))return!0}return!1}(e,t,n)}function th(e,t){return!(!e.album||!t.album)&&nh(rh(t.album),rh(e.album))}function nh(e,t=""){return 0===e.localeCompare(t,void 0,{sensitivity:"accent"})}function rh(e){return km()(e).replace(/\s\s+/g," ")}function ih(e){return{artist:e.artists&&e.artists[0]||"",title:e.title}}function ah(e){return e.replace(Zm,"")}const sh=new D("playlist"),oh=new $e(sh.getJson("settings",{allowDuplicates:!0,showLineNumbers:!0,zeroPadLineNumbers:!0,showSourceIcons:!0})),lh={observe:function(){return oh},get:function(){return oh.getValue()},set:function(e){sh.setJson("settings",e),oh.next(e)}};var ch=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const uh=new N("playlist"),dh=dm("ampcast/playlist","keyval"),mh=[],hh=new $e(mh),fh=new $e("");function ph(){return hh.getValue()}function vh(e){e=e.concat(),hh.next(e),0===e.length?yh(""):gh()||yh(e[0].id)}function bh(){return fh.getValue()}function yh(e){fh.next(e)}function gh(){const e=ph(),t=bh();return e.find((e=>e.id===t))||null}function wh(e){yh(e.id)}function Eh(){return Cr([hh,fh]).pipe(wn((([e,t])=>{var n;return null!==(n=e.find((e=>e.id===t)))&&void 0!==n?n:null})),Or())}function kh(){return Cr([hh,fh]).pipe(wn((([e,t])=>e.findIndex((e=>e.id===t)))),Or())}function xh(){const e=hh.getValue(),t=bh();return e.findIndex((e=>e.id===t))}function Sh(){return hh.getValue().length}function Th(e){const t=bh();if(t){const n=ph(),r=n.findIndex((e=>e.id===t));if(-1!==r){const t=n[r+e];t&&wh(t)}}}function Ah(e,t){return ch(this,void 0,void 0,(function*(){const n=ph(),r=lh.get().allowDuplicates;let i=yield function(e){return ch(this,void 0,void 0,(function*(){const t=e=>"itemType"in e&&e.itemType===wr.Album;let n=[];if(Array.isArray(e))if(t(e[0])){const t=yield Promise.all(e.map((e=>Ih(e))));for(const e of t)n=n.concat(e)}else n=yield Promise.all(e.map((e=>Ch(e))));else n=t(e)?yield Ih(e):e instanceof FileList?yield Promise.all(Array.from(e).map((e=>wm(e)))):[yield Ch(e)];return n.filter(l)}))}(e);if(r||(i=i.filter((e=>-1===n.findIndex((t=>t.src===e.src))))),i.length>0){const e=i.map((e=>Object.assign(Object.assign({},C(e)),{id:Ji()})));t>=0&&t<n.length?(n.splice(t,0,...e),vh(n)):vh(n.concat(e))}}))}function Ph(e){const t=ph(),n=Array.isArray(e)?e:[e],r=t.filter((e=>!n.includes(e)));if(r.length!==t.length){const e=xh(),t=bh(),n=r.findIndex((e=>e.id===t));if(-1===n)if(-1===e)yh("");else{const t=r[e]||r.at(-1);yh((null==t?void 0:t.id)||"")}vh(r)}}function Ih(e){return ch(this,void 0,void 0,(function*(){return Hr(e.pager,{keepAlive:!0})}))}function Ch(e){return ch(this,void 0,void 0,(function*(){return e instanceof File?/^(audio|video)/.test(e.type)?wm(e):null:e}))}const Mh={get atEnd(){return xh()===Sh()-1},get atStart(){return 0===Sh()||0===xh()},observe:function(){return hh.pipe(De((e=>e!==mh)))},observeCurrentIndex:kh,observeCurrentItem:Eh,observeNextItem:function(){return Cr([hh,fh]).pipe(wn((([e,t])=>{const n=e.findIndex((e=>e.id===t));return-1===n?null:e[n+1]||null})),Or())},observeSize:function(){return hh.pipe(wn((e=>e.length)),Or())},getCurrentIndex:xh,getCurrentItem:gh,setCurrentItem:wh,add:function(e){return ch(this,void 0,void 0,(function*(){return Ah(e,-1)}))},clear:function(){vh([])},eject:function(){const e=gh();e&&Ph(e)},insert:function(e){return ch(this,void 0,void 0,(function*(){return Ah(e,xh()+1)}))},insertAt:Ah,moveSelection:function(e,t){return ch(this,void 0,void 0,(function*(){const n=ph(),r=n[t];if(e.includes(r))return;const i=n.filter((t=>!e.includes(t))),a=i.indexOf(r);a>=0?(i.splice(a,0,...e),vh(i)):vh(i.concat(e))}))},next:function(){Th(1)},prev:function(){Th(-1)},remove:Ph,removeAt:function(e){const t=function(e){var t;return null!==(t=ph()[e])&&void 0!==t?t:null}(e);t&&Ph(t)},reverseAt:function(e,t){const n=ph(),r=n.slice(e,e+t).reverse();n.splice(e,t,...r),vh(n)},shuffle:function(e){const t=ph().slice();if(t.length>0){const n=gh();if(e&&n){const e=f(t.filter((e=>e!==n)));e.unshift(n),vh(e)}else{const e=f(t);vh(e),wh(e[0])}}}},Oh=Mh;ch(void 0,void 0,void 0,(function*(){var e,t;const n=null!==(e=yield fm("items",dh))&&void 0!==e?e:[],r=null!==(t=yield fm("currently-playing-id",dh))&&void 0!==t?t:"";hh.next(n),fh.next(r)})),hh.pipe(qu(2),cm(200),kn((e=>pm("items",e=e.map((e=>{if(e.lookupStatus){const{lookupStatus:t}=e;return function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["lookupStatus"])}return e})),dh)))).subscribe(uh),fh.pipe(qu(2),cm(200),kn((e=>pm("currently-playing-id",e,dh)))).subscribe(uh),Rm.pipe(Re((({lookupItem:e})=>{const t=ph(),n=t.findIndex((t=>t.src===e.src));if(-1!==n){const e=t[n];t[n]=Object.assign(Object.assign({},e),{lookupStatus:bm.Looking}),vh(t)}}))).subscribe(uh),Dm.pipe(Re((({lookupItem:e,foundItem:t})=>{const n=ph(),r=n.findIndex((t=>t.src===e.src));if(-1!==r){const e=n[r];n[r]=t?Object.assign(Object.assign({},t),{id:e.id,lookupStatus:void 0}):Object.assign(Object.assign({},e),{lookupStatus:bm.NotFound}),vh(n)}}))).subscribe(uh);var Nh,$h,zh=n(1062),jh=n.n(zh),Lh=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Rh=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const Dh=(e,t)=>e.width===t.width&&e.height===t.height,Fh=16/9,_h={autohide:1,autoplay:0,controls:0,disablekb:1,enablejsapi:1,fs:0,iv_load_policy:3,modestbranding:1,rel:0,showinfo:0};var Uh;!function(e){e[e.UNSTARTED=-1]="UNSTARTED",e[e.ENDED=0]="ENDED",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.BUFFERING=3]="BUFFERING",e[e.CUED=5]="CUED"}(Uh||(Uh={})),Nh=new WeakMap,$h=new WeakMap;const Vh=class{constructor(e){this.player=null,this.src$=new $e(""),this.size$=new $e({width:0,height:0}),this.error$=new Oe,this.ready$=new Oe,this.state$=new Oe,this.videoId$=new $e(""),Nh.set(this,!0),$h.set(this,1),this.autoplay=!1,this.loop=!1;const t=this.element=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div"),i=this.logger=new N(`YouTubePlayer/${e}`);this.targetId=`youtube-iframe-${e}`,t.hidden=!0,t.className="youtube-video",n.className="youtube-video-wrapper",r.id=this.targetId,n.append(r),t.append(n),this.observeReady().pipe(kn((()=>this.observeSrc())),fr((e=>!e)),Re((e=>{const t=this.player,[,n,r,i="0"]=e.split(":"),a=Number(i)||0;if(r){if("playlist"===n){const e={list:r,listType:n,index:a};this.autoplay?t.loadPlaylist(e):t.cuePlaylist(e)}else this.autoplay?t.loadVideoById(r,a):t.cueVideoById(r,a);this.loadError=void 0}else t.stopVideo()}))).subscribe(i),this.observeReady().pipe(kn((()=>this.observeVideoSize())),Re((({width:e,height:t})=>this.player.setSize(e,t)))).subscribe(i),this.observeState().pipe(De((e=>e===Uh.ENDED&&this.loop)),Re((()=>this.player.seekTo(0,!0)))).subscribe(i),this.observeState().pipe(De((e=>e===Uh.PLAYING)),Re((()=>this.element.style.visibility=""))).subscribe(i),this.observeState().pipe(wn((()=>{var e;return this.getVideoId((null===(e=this.player)||void 0===e?void 0:e.getVideoUrl())||"")})),Re((e=>this.videoId$.next(e)))).subscribe(i),this.observeError().subscribe(i.error)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e,e&&(this.element.style.visibility="hidden")}get muted(){return Lh(this,Nh,"f")}set muted(e){Lh(this,Nh,"f")!==e&&(Rh(this,Nh,e,"f"),this.player&&(e?this.player.mute():0!==this.volume&&this.player.unMute()))}get volume(){return Lh(this,$h,"f")}set volume(e){Lh(this,$h,"f")!==e&&(Rh(this,$h,e,"f"),this.player&&(this.player.setVolume(100*e),0===e?this.player.mute():this.muted||this.player.unMute()))}observeCurrentTime(){return this.observeState().pipe(Un((e=>{var t;return e===Uh.PLAYING?sn(250-Math.round(1e3*this.player.getCurrentTime())%250,250).pipe(wn((()=>this.player.getCurrentTime())),Vn(this.observeState())):Gn((null===(t=this.player)||void 0===t?void 0:t.getCurrentTime())||0)})))}observeDuration(){return this.observeState().pipe(wn((()=>{var e;return(null===(e=this.player)||void 0===e?void 0:e.getDuration())||0})),De((e=>0!==e)),Or())}observeEnded(){return this.observeState().pipe(De((e=>e===Uh.ENDED&&!this.loop)),wn((()=>{})))}observeError(){return this.error$}observePlaying(){return this.observeState().pipe(De((e=>e===Uh.PLAYING)),wn((()=>{})))}observeVideoId(){return this.videoId$.pipe(Or())}appendTo(e){e.appendChild(this.element),this.createPlayer()}load(e){this.logger.log("load",{src:e}),this.player||this.createPlayer(),this.autoplay&&this.player&&e===this.src?this.player.playVideo():this.src$.next(e)}play(){var e;this.logger.log("play"),this.player?this.src===(null===(e=this.loadError)||void 0===e?void 0:e.src)?this.error$.next(this.loadError.error):this.player.playVideo():this.error$.next(Error("YouTube player not loaded"))}pause(){var e;this.logger.log("pause"),null===(e=this.player)||void 0===e||e.pauseVideo()}stop(){var e;this.logger.log("stop"),null===(e=this.player)||void 0===e||e.stopVideo()}seek(e){var t;null===(t=this.player)||void 0===t||t.seekTo(e,!0)}resize(e,t){this.size$.next({width:e,height:t})}destroy(){var e;null===(e=this.player)||void 0===e||e.destroy(),this.element.remove()}get src(){return this.src$.getValue()}observeAspectRatio(){return this.observeVideoId().pipe(Un((e=>e?this.getAspectRatio(e):Gn(Fh))),Or())}observeReady(){return this.ready$.pipe(Br(1))}observeSize(){return this.size$.pipe(Or(Dh),De((({width:e,height:t})=>e*t>0)))}observeSrc(){return this.src$.pipe(Or())}observeState(){return this.state$}observeVideoSize(){return Cr([this.observeSize(),this.observeAspectRatio()]).pipe(wn((([{width:e,height:t},n])=>{const r=Math.max(Math.round(e/n),t);return{width:Math.max(Math.round(r*n),e),height:r}})),Or(Dh))}createPlayer(){if(!this.player&&this.element.isConnected){const e=jh()(this.targetId,{playerVars:_h});e.on("ready",(({target:e})=>{this.player=e,e.setVolume(100*this.volume),(this.muted||0===this.volume)&&e.mute(),this.ready$.next(void 0)})),e.on("stateChange",(({data:e})=>{this.state$.next(e)})),e.on("error",(e=>{this.loadError={src:this.src,error:e},this.error$.next(e)}))}}getAspectRatio(e){return Rn(Jo(e)).pipe(Vn(sn(3e3)),Vn(this.observeVideoId().pipe(qu(1))),wn((({aspectRatio:e})=>e||Fh)),Fr((t=>(this.logger.log(`Could not obtain oembed info (videoId=${e}): ${t.message}`),this.loadError={src:this.src,error:t},this.error$.next(t),Gn(Fh)))))}getPlayerState(){return this.player?this.player.getPlayerState():Uh.UNSTARTED}getVideoId(e){if(e.startsWith("youtube:video")){const[,,t]=e.split(":");return t}return wo()(e)||""}};var Bh=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};let Hh=0;class Yh extends Vh{constructor(e){super("loader-"+Hh++),this.load(e)}loadPlaylist(){return Bh(this,void 0,void 0,(function*(){return yield this.cue(),this.player.getPlaylist()||[]}))}observeVideoSize(){return Fn}loadDuration(){return Bh(this,void 0,void 0,(function*(){return yield this.cue(),this.player.getDuration()||0}))}cue(){return new Promise(((e,t)=>{const n=this.observeCued(),r=_n(this.observeError(),sn(3e3).pipe(wn((()=>Error("timeout")))));n.pipe(Vn(r),Br(1)).subscribe({next:e}),r.pipe(Vn(n),Br(1)).subscribe({next:t}),setTimeout((()=>this.appendTo(document.body)))}))}observeCued(){return this.observeState().pipe(De((e=>e===Uh.CUED)),wn((()=>{})),Br(1))}}var Kh=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function Wh(){const e=(0,r.useRef)(null),[t,n]=(0,r.useState)(""),i=(0,r.useCallback)((t=>Kh(this,void 0,void 0,(function*(){try{t.preventDefault();const r=e.current.value,i=wo()(r),a=yield Jo(i),s=yield function(e){return Bh(this,void 0,void 0,(function*(){const t=new Yh(e);try{return yield t.loadDuration()}finally{t.destroy()}}))}(a.src);yield Oh.add(Object.assign(Object.assign({},a),{duration:s})),n("Queued")}catch(e){n(e.message||"This video cannot be embedded")}}))),[]),a=(0,r.useCallback)((()=>{n("");const t=e.current.value;let r="Not a valid YouTube url.";/^https?/.test(t)&&/youtu\.?be/.test(t)&&(r="Not a YouTube video.",wo()(t)&&(r="")),e.current.setCustomValidity(r)}),[]);return r.createElement("form",{className:"add-youtube-video",onSubmit:i},r.createElement("fieldset",null,r.createElement("legend",null,"Add video from YouTube url:"),r.createElement("p",{className:"text-with-button"},r.createElement("input",{type:"url",required:!0,onInput:a,ref:e}),r.createElement("button",{title:"Add to playlist"},r.createElement($t,{name:"playlist-add"}))),r.createElement("p",null,r.createElement("output",null,t))))}function qh(){const{client:e,error:t}=function(){const[e,t]=(0,r.useState)(null),[n,i]=(0,r.useState)(null);return(0,r.useEffect)((()=>{const e=Rn(zo()).subscribe({next:t,error:i});return()=>e.unsubscribe()}),[]),{client:e,error:n}}();return r.createElement("div",{className:"panel"},r.createElement("div",{className:"page login"},r.createElement(om,{service:Xo}),r.createElement("p",null,"You can still play YouTube videos without being logged in.",r.createElement("br",null),"But you need to be logged in to search for music and access your playlists."),r.createElement(tm,{service:Xo,disabled:!e}),t?r.createElement("p",{className:"error"},"Could not load Google client library."):null,r.createElement(Wh,null),r.createElement(rm,{service:Xo})))}function Gh({service:e}){switch(e.id){case"apple":return r.createElement(im,null);case"plex":return r.createElement(sm,null);case"spotify":return r.createElement(lm,null);case"youtube":return r.createElement(qh,null);default:return r.createElement(am,{service:e})}}function Jh(e,t){const[n,i]=(0,r.useState)(t),a=(0,r.useMemo)(e,[e]);return(0,r.useEffect)((()=>{const e=a.subscribe(i);return()=>e.unsubscribe()}),[a]),n}function Qh({children:e}){return r.createElement("div",{className:"panel empty-screen"},e)}function Xh({error:e,children:t}){return r.createElement("div",{className:"panel error-screen"},r.createElement("div",{className:"error-screen-content"},r.createElement("h2",null,"Error"),r.createElement("pre",{className:"note error"},(null==e?void 0:e.message)||String(e)),t))}function Zh({min:e="1970",max:t=ef(),value:n=t,onSelect:i}){const[a,s]=(0,r.useState)((()=>String(new Date(n).getFullYear()))),o=function(e,t){const[n,i]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const n=[],r=new Date(e),a=new Date(t),s=r.getFullYear();let o=a.getFullYear();for(;o>=s;)n.push(o),o--;i(n)}),[e,t]),n}(e,t);(0,r.useEffect)((()=>{null==i||i(a)}),[i,a]);const l=(0,r.useCallback)((e=>{s(e.target.value)}),[]);return r.createElement("span",{className:"year-picker"},r.createElement("select",{defaultValue:a,onChange:l},o.map((e=>r.createElement("option",{value:e,key:e},e)))))}function ef(){const e=new Date;return String(e.getFullYear())}const tf=(()=>{const e=new Intl.DateTimeFormat(navigator.language,{month:"short"}).format;return[...Array(12).keys()].map((t=>e(new Date(2022,t,2))))})();function nf({min:e="1970-01",max:t=v(),value:n=t,onSelect:i}){const a=(0,r.useRef)(null),[s,o]=(0,r.useState)((()=>String(new Date(n).getFullYear()))),[l,c]=(0,r.useState)((()=>new Date(n).getMonth())),u=function(e,t,n){const[i,a]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const r=[],i=new Date(t),s=new Date(n),o=Number(e)===i.getFullYear()?i.getMonth():0;let l=Number(e)===s.getFullYear()?s.getMonth():11;for(;l>=o;)r.push(l),l--;a(r)}),[e,t,n]),i}(s,e,t);(0,r.useEffect)((()=>{const e=u[0];void 0!==e&&(a.current.value=String(e),c(e))}),[u]),(0,r.useEffect)((()=>{-1!==l&&(null==i||i(`${s}-${String(l+1).padStart(2,"0")}`))}),[i,s,l]);const d=(0,r.useCallback)((e=>{c(-1),o(e)}),[]),m=(0,r.useCallback)((e=>{c(Number(e.target.value))}),[]);return r.createElement("span",{className:"month-picker"},r.createElement(Zh,{min:e,max:t,value:s,onSelect:d}),r.createElement("select",{defaultValue:l,onChange:m,key:s,ref:a},u.map((e=>r.createElement("option",{value:e,key:e},tf[e])))))}function rf({min:e="1970-01-01",max:t=p(),value:n=t,onSelect:i}){const a=(0,r.useRef)(null),[s,o]=(0,r.useState)((()=>v(n))),[l,c]=(0,r.useState)((()=>new Date(n).getDate())),u=function(e,t,n){const[i,a]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const r=[],i=new Date(t),s=new Date(n),o=e.split("-").map(Number),l=o[0],c=o[1]-1,u=l===i.getFullYear()&&c===i.getMonth()?i.getDate():1;let d=l===s.getFullYear()&&c===s.getMonth()?s.getDate():new Date(l,c+1,0).getDate();for(;d>=u;)r.push(d),d--;a(r)}),[e,t,n]),i}(s,e,t);(0,r.useEffect)((()=>{const e=u[0];e&&(a.current.value=String(e),c(e))}),[u]),(0,r.useEffect)((()=>{l&&(null==i||i(`${s}-${String(l).padStart(2,"0")}`))}),[i,s,l]);const d=(0,r.useCallback)((e=>{c(0),o(e)}),[]),m=(0,r.useCallback)((e=>{c(Number(e.target.value))}),[]);return r.createElement("span",{className:"date-picker"},r.createElement(nf,{min:e,max:t,value:s,onSelect:d}),r.createElement("select",{defaultValue:l,onChange:m,key:s,ref:a},u.map((e=>r.createElement("option",{value:e,key:e},e)))))}function af({icon:e,children:t}){return r.createElement("h2",{className:"page-header"},r.createElement(Ki,{icon:e,text:t}))}var sf,of,lf=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},cf=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};sf=new WeakMap,of=new WeakMap;const uf=class{constructor(e,t,n,r){this.players=t,this.selectPlayer=n,this.loadPlayer=r,this.player$=new $e(null),this.error$=new Oe,sf.set(this,!1),of.set(this,!1);const i=this.element=document.createElement("div");i.className=e,t.forEach((e=>{e.autoplay=!1,e.muted=!0,e.hidden=!0,e.appendTo(i)}))}get autoplay(){return lf(this,sf,"f")}set autoplay(e){cf(this,sf,e,"f"),this.currentPlayer&&(this.currentPlayer.autoplay=e)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e,this.currentPlayer&&(this.currentPlayer.hidden=e)}get loop(){return this.players[0].loop}set loop(e){this.players.forEach((t=>t.loop=e))}get muted(){return lf(this,of,"f")}set muted(e){cf(this,of,e,"f"),this.currentPlayer&&(this.currentPlayer.muted=e)}get volume(){return this.players[0].volume}set volume(e){this.players.forEach((t=>t.volume=e))}observeCurrentTime(){return this.observeCurrentPlayer().pipe(Un((e=>e?e.observeCurrentTime():Gn(0))),Or())}observeDuration(){return this.observeCurrentPlayer().pipe(Un((e=>e?e.observeDuration():Fn)),Or())}observeEnded(){return this.observeCurrentPlayer().pipe(Un((e=>e?e.observeEnded():Fn)))}observeError(){return this.observeCurrentPlayer().pipe(Un((e=>e?_n(this.error$,e.observeError()):Fn)))}observePlaying(){return this.observeCurrentPlayer().pipe(Un((e=>e?e.observePlaying():Fn)))}appendTo(e){e.appendChild(this.element)}load(e){const t=this.currentPlayer,n=this.selectPlayer(e);if(this.player$.next(null),t&&t!==n&&(t.muted=!0,t.hidden=!0,t.stop()),this.player$.next(n),n)try{n.autoplay=this.autoplay,this.loadPlayer(n,e),n.muted=this.muted,n.hidden=this.hidden}catch(e){this.error$.next(e)}else this.error$.next(Error("No player found."))}play(){var e;this.autoplay=!0,null===(e=this.currentPlayer)||void 0===e||e.play()}pause(){var e;this.autoplay=!1,null===(e=this.currentPlayer)||void 0===e||e.pause()}stop(){var e;this.autoplay=!1,null===(e=this.currentPlayer)||void 0===e||e.stop()}seek(e){var t;null===(t=this.currentPlayer)||void 0===t||t.seek(e)}resize(e,t){e*t>0&&this.players.forEach((n=>n.resize(e,t)))}get currentPlayer(){return this.player$.getValue()}observeCurrentPlayer(){return this.player$.pipe(Or())}};var df;df=new WeakMap;const mf=class{constructor(){df.set(this,!1),this.loop=!0,this.muted=!0,this.volume=0}get autoplay(){return function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,df,"f")}set autoplay(e){!function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,df,e,"f")}observeCurrentTime(){return Fn}observeDuration(){return Fn}observeEnded(){return Fn}observeError(){return Fn}observePlaying(){return Fn}seek(){}};class hf{constructor(e,t){this.error$=new Oe,this.src="",this.autoplay=!1;const n=this.element=document.createElement(e);n.hidden=!0,n.muted=!0,n.autoplay=!1,n.className=`html5-${e} html5-${e}-${t}`,n.crossOrigin="anonymous",In(n,"error").pipe(wn((()=>n.error))).subscribe(this.error$),this.logger=new N(`HTML5Player/${e}/${t}`),this.observeError().subscribe(this.logger.error)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e}get loop(){return this.element.loop}set loop(e){this.element.loop=e}get muted(){return this.element.muted}set muted(e){this.element.muted=e}get volume(){return this.element.volume}set volume(e){this.element.volume=e}observeCurrentTime(){return In(this.element,"timeupdate").pipe(wn((()=>this.element.currentTime)),wn((e=>isFinite(e)?e:0)))}observeDuration(){return In(this.element,"durationchange").pipe(wn((()=>this.element.duration)),De((e=>isFinite(e))))}observeEnded(){return In(this.element,"ended").pipe(wn((()=>{})))}observeError(){return this.error$}observePlaying(){return In(this.element,"playing").pipe(wn((()=>{})))}appendTo(e){e.appendChild(this.element)}load(e){this.logger.log("load"),this.src=e;try{if(this.autoplay){const e=this.getMediaSrc(this.src);this.element.setAttribute("src",e),this.safePlay()}}catch(e){this.error$.next(e)}}play(){this.logger.log("play");try{const e=this.getMediaSrc(this.src);this.element.getAttribute("src")!==e&&this.element.setAttribute("src",e),this.safePlay()}catch(e){this.error$.next(e)}}pause(){this.logger.log("pause"),this.element.pause()}stop(){this.logger.log("stop"),this.element.pause(),this.element.currentTime=0}seek(e){this.element.currentTime=e}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}getMediaSrc(e){var t,n;const r=Bd({src:e});return null!==(n=null===(t=null==r?void 0:r.getPlayableUrlFromSrc)||void 0===t?void 0:t.call(r,e))&&void 0!==n?n:e}safePlay(){return e=this,t=void 0,r=function*(){try{yield this.element.play()}catch(e){this.error$.next(e)}},new((n=void 0)||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}));var e,t,n,r}}const ff=new D("visualizer/settings"),pf={get ambientVideoEnabled(){return ff.getBoolean("ambientVideoEnabled")},set ambientVideoEnabled(e){var t;e!==this.ambientVideoEnabled&&(ff.setBoolean("ambientVideoEnabled",e),e||("ambientvideo"===this.provider&&ff.setString("provider",""),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&ff.removeItem("lockedVisualizer")),vf.next(this))},get ambientVideoSource(){return ff.getString("ambientVideoSource")},set ambientVideoSource(e){var t;e!==this.ambientVideoSource&&(ff.setString("ambientVideoSource",e),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&ff.removeItem("lockedVisualizer"),vf.next(this))},get beatsOverlay(){return ff.getBoolean("beatsOverlay")},set beatsOverlay(e){e!==this.beatsOverlay&&(ff.setBoolean("beatsOverlay",e),vf.next(this))},get useAmbientVideoSource(){return ff.getBoolean("useAmbientVideoSource")},set useAmbientVideoSource(e){var t;e!==this.useAmbientVideoSource&&(ff.setBoolean("useAmbientVideoSource",e),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&ff.removeItem("lockedVisualizer"),vf.next(this))},get lockedVisualizer(){return ff.getJson("lockedVisualizer")},set lockedVisualizer(e){if(e){const{providerId:t,name:n}=e;ff.setJson("lockedVisualizer",{providerId:t,name:n})}else ff.removeItem("lockedVisualizer");vf.next(this)},get provider(){return ff.getString("provider")},set provider(e){var t;e!==this.provider&&(ff.setString("provider",e),e&&(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)!==e&&ff.removeItem("lockedVisualizer"),vf.next(this))}},vf=new $e(pf),bf=pf;function yf(){return vf}const gf=new $e({currentItem:null,currentTime:0,startedAt:0,endedAt:0,duration:0,paused:!0});function wf(){return gf}function Ef(){return wf().pipe(De((e=>0!==e.startedAt)),Or(((e,t)=>e.startedAt===t.startedAt)))}function kf(){return wf().pipe(De((e=>0!==e.endedAt)),Or(((e,t)=>e.endedAt===t.endedAt)))}function xf(e=1e4){return Ef().pipe(Un((()=>wf().pipe(pa(e,void 0,{trailing:!0}),Vn(kf())))))}function Sf(){return wf().pipe(wn((e=>e.paused)),Or())}function Tf(){const e=gf.getValue();e.startedAt&&(e.endedAt||gf.next(Object.assign(Object.assign({},e),{endedAt:Date.now()})),gf.next(Object.assign(Object.assign({},e),{startedAt:0,endedAt:0})))}Eh().subscribe((e=>{Tf(),gf.next(Object.assign(Object.assign({},gf.getValue()),{currentItem:e,currentTime:0,duration:(null==e?void 0:e.duration)||0,startedAt:0,endedAt:0}))}));const Af={get paused(){return gf.getValue().paused},observePlaybackState:wf,observePlaybackStart:Ef,observePlaybackEnd:kf,observePlaybackProgress:xf,observeCurrentTime:function(){return wf().pipe(wn((e=>e.currentTime)),Or())},observeDuration:function(){return wf().pipe(wn((e=>e.duration)),Or())},observePaused:Sf,getCurrentTime:function(){return gf.getValue().currentTime},setCurrentTime:function(e){const t=gf.getValue();(e=Math.max(Math.min(Math.floor(isFinite(e)?e:0),t.duration),0))!==t.currentTime&&gf.next(Object.assign(Object.assign({},t),{currentTime:e}))},getDuration:function(){return gf.getValue().duration},setDuration:function(e){const t=gf.getValue();if((e=Math.max(Math.floor(isFinite(e)?e:0),0))!==t.duration){const n=Math.min(t.currentTime,e);gf.next(Object.assign(Object.assign({},t),{duration:e,currentTime:n}))}},play:function(){const e=gf.getValue();e.currentItem&&e.paused&&gf.next(Object.assign(Object.assign({},e),{paused:!1}))},pause:function(){const e=gf.getValue();e.paused||gf.next(Object.assign(Object.assign({},e),{paused:!0}))},stop:function(){const e=gf.getValue();if(!e.paused||0!==e.currentTime||0!==e.startedAt&&0===e.endedAt){const t=Object.assign(Object.assign({},e),{paused:!0,currentTime:0,endedAt:e.endedAt||(e.startedAt?Date.now():0)});gf.next(t),e.startedAt&&gf.next(Object.assign(Object.assign({},t),{startedAt:0,endedAt:0}))}},started:function(){const e=gf.getValue();e.startedAt||gf.next(Object.assign(Object.assign({},e),{startedAt:Date.now()}))},ended:Tf};function Pf(e,t,n,r,i){var a=e*e,s=a*e;return((1-3*e+3*a-s)*t+(4-6*a+3*s)*n+(1+3*e+3*a-3*s)*r+s*i)/6}function If(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],s=r>0?e[r-1]:2*i-a,o=r<t-1?e[r+2]:2*a-i;return Pf((n-r/t)*t,s,i,a,o)}}function Cf(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}const Mf=Math.sqrt(50),Of=Math.sqrt(10),Nf=Math.sqrt(2);function $f(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/Math.pow(10,i),s=a>=Mf?10:a>=Of?5:a>=Nf?2:1;let o,l,c;return i<0?(c=Math.pow(10,-i)/s,o=Math.round(e*c),l=Math.round(t*c),o/c<e&&++o,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*s,o=Math.round(e/c),l=Math.round(t/c),o*c<e&&++o,l*c>t&&--l),l<o&&.5<=n&&n<2?$f(e,t,2*n):[o,l,c]}function zf(e,t,n){if(!((n=+n)>0))return[];if((e=+e)==(t=+t))return[e];const r=t<e,[i,a,s]=r?$f(t,e,n):$f(e,t,n);if(!(a>=i))return[];const o=a-i+1,l=new Array(o);if(r)if(s<0)for(let e=0;e<o;++e)l[e]=(a-e)/-s;else for(let e=0;e<o;++e)l[e]=(a-e)*s;else if(s<0)for(let e=0;e<o;++e)l[e]=(i+e)/-s;else for(let e=0;e<o;++e)l[e]=(i+e)*s;return l}var jf,Lf=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Rf(e){if(!(t=Lf.exec(e)))throw new Error("invalid format: "+e);var t;return new Df({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function Df(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function Ff(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function _f(e,t){var n=Ff(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Rf.prototype=Df.prototype,Df.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Uf={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>_f(100*e,t),r:_f,s:function(e,t){var n=Ff(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(jf=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,s=r.length;return a===s?r:a>s?r+new Array(a-s+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+Ff(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Vf(e){return e}var Bf,Hf,Yf=Array.prototype.map,Kf=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Wf(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function qf(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Gf(e){let t,n,r;function i(e,r,i=0,a=e.length){if(i<a){if(0!==t(r,r))return a;do{const t=i+a>>>1;n(e[t],r)<0?i=t+1:a=t}while(i<a)}return i}return 2!==e.length?(t=Wf,n=(t,n)=>Wf(e(t),n),r=(t,n)=>e(t)-n):(t=e===Wf||e===qf?e:Jf,n=e,r=e),{left:i,center:function(e,t,n=0,a=e.length){const s=i(e,t,n,a-1);return s>n&&r(e[s-1],t)>-r(e[s],t)?s-1:s},right:function(e,r,i=0,a=e.length){if(i<a){if(0!==t(r,r))return a;do{const t=i+a>>>1;n(e[t],r)<=0?i=t+1:a=t}while(i<a)}return i}}}function Jf(){return 0}Bf=function(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?Vf:(t=Yf.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],s=0,o=t[0],l=0;i>0&&o>0&&(l+o+1>r&&(o=Math.max(1,r-l)),a.push(e.substring(i-=o,i+o)),!((l+=o+1)>r));)o=t[s=(s+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",s=void 0===e.decimal?".":e.decimal+"",o=void 0===e.numerals?Vf:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Yf.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"−":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=Rf(e)).fill,n=e.align,d=e.sign,m=e.symbol,h=e.zero,f=e.width,p=e.comma,v=e.precision,b=e.trim,y=e.type;"n"===y?(p=!0,y="g"):Uf[y]||(void 0===v&&(v=12),b=!0,y="g"),(h||"0"===t&&"="===n)&&(h=!0,t="0",n="=");var g="$"===m?i:"#"===m&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",w="$"===m?a:/[%p]/.test(y)?l:"",E=Uf[y],k=/[defgprs%]/.test(y);function x(e){var i,a,l,m=g,x=w;if("c"===y)x=E(e)+x,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:E(Math.abs(e),v),b&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0==+e&&"+"!==d&&(S=!1),m=(S?"("===d?d:c:"-"===d||"("===d?"":d)+m,x=("s"===y?Kf[8+jf/3]:"")+x+(S&&"("===d?")":""),k)for(i=-1,a=e.length;++i<a;)if(48>(l=e.charCodeAt(i))||l>57){x=(46===l?s+e.slice(i+1):e.slice(i))+x,e=e.slice(0,i);break}}p&&!h&&(e=r(e,1/0));var T=m.length+e.length+x.length,A=T<f?new Array(f-T+1).join(t):"";switch(p&&h&&(e=r(A+e,A.length?f-x.length:1/0),A=""),n){case"<":e=m+e+x+A;break;case"=":e=m+A+e+x;break;case"^":e=A.slice(0,T=A.length>>1)+m+e+x+A.slice(T);break;default:e=A+m+e+x}return o(e)}return v=void 0===v?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v)),x.toString=function(){return e+""},x}return{format:d,formatPrefix:function(e,t){var n,r=d(((e=Rf(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor((n=t,((n=Ff(Math.abs(n)))?n[1]:NaN)/3)))),a=Math.pow(10,-i),s=Kf[8+i/3];return function(e){return r(a*e)+s}}}}({thousands:",",grouping:[3],currency:["$",""]}),Hf=Bf.format,Bf.formatPrefix;const Qf=Gf(Wf),Xf=Qf.right,Zf=(Qf.left,Gf((function(e){return null===e?NaN:+e})).center,Xf);function ep(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function tp(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function np(){}var rp=.7,ip=1/rp,ap="\\s*([+-]?\\d+)\\s*",sp="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",op="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",lp=/^#([0-9a-f]{3,8})$/,cp=new RegExp(`^rgb\\(${ap},${ap},${ap}\\)$`),up=new RegExp(`^rgb\\(${op},${op},${op}\\)$`),dp=new RegExp(`^rgba\\(${ap},${ap},${ap},${sp}\\)$`),mp=new RegExp(`^rgba\\(${op},${op},${op},${sp}\\)$`),hp=new RegExp(`^hsl\\(${sp},${op},${op}\\)$`),fp=new RegExp(`^hsla\\(${sp},${op},${op},${sp}\\)$`),pp={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function vp(){return this.rgb().formatHex()}function bp(){return this.rgb().formatRgb()}function yp(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=lp.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?gp(t):3===n?new kp(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?wp(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?wp(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=cp.exec(e))?new kp(t[1],t[2],t[3],1):(t=up.exec(e))?new kp(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=dp.exec(e))?wp(t[1],t[2],t[3],t[4]):(t=mp.exec(e))?wp(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=hp.exec(e))?Ip(t[1],t[2]/100,t[3]/100,1):(t=fp.exec(e))?Ip(t[1],t[2]/100,t[3]/100,t[4]):pp.hasOwnProperty(e)?gp(pp[e]):"transparent"===e?new kp(NaN,NaN,NaN,0):null}function gp(e){return new kp(e>>16&255,e>>8&255,255&e,1)}function wp(e,t,n,r){return r<=0&&(e=t=n=NaN),new kp(e,t,n,r)}function Ep(e,t,n,r){return 1===arguments.length?((i=e)instanceof np||(i=yp(i)),i?new kp((i=i.rgb()).r,i.g,i.b,i.opacity):new kp):new kp(e,t,n,null==r?1:r);var i}function kp(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function xp(){return`#${Pp(this.r)}${Pp(this.g)}${Pp(this.b)}`}function Sp(){const e=Tp(this.opacity);return`${1===e?"rgb(":"rgba("}${Ap(this.r)}, ${Ap(this.g)}, ${Ap(this.b)}${1===e?")":`, ${e})`}`}function Tp(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Ap(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function Pp(e){return((e=Ap(e))<16?"0":"")+e.toString(16)}function Ip(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new Mp(e,t,n,r)}function Cp(e){if(e instanceof Mp)return new Mp(e.h,e.s,e.l,e.opacity);if(e instanceof np||(e=yp(e)),!e)return new Mp;if(e instanceof Mp)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),s=NaN,o=a-i,l=(a+i)/2;return o?(s=t===a?(n-r)/o+6*(n<r):n===a?(r-t)/o+2:(t-n)/o+4,o/=l<.5?a+i:2-a-i,s*=60):o=l>0&&l<1?0:s,new Mp(s,o,l,e.opacity)}function Mp(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function Op(e){return(e=(e||0)%360)<0?e+360:e}function Np(e){return Math.max(0,Math.min(1,e||0))}function $p(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}ep(np,yp,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:vp,formatHex:vp,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return Cp(this).formatHsl()},formatRgb:bp,toString:bp}),ep(kp,Ep,tp(np,{brighter(e){return e=null==e?ip:Math.pow(ip,e),new kp(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?rp:Math.pow(rp,e),new kp(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new kp(Ap(this.r),Ap(this.g),Ap(this.b),Tp(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:xp,formatHex:xp,formatHex8:function(){return`#${Pp(this.r)}${Pp(this.g)}${Pp(this.b)}${Pp(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:Sp,toString:Sp})),ep(Mp,(function(e,t,n,r){return 1===arguments.length?Cp(e):new Mp(e,t,n,null==r?1:r)}),tp(np,{brighter(e){return e=null==e?ip:Math.pow(ip,e),new Mp(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?rp:Math.pow(rp,e),new Mp(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new kp($p(e>=240?e-240:e+120,i,r),$p(e,i,r),$p(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new Mp(Op(this.h),Np(this.s),Np(this.l),Tp(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Tp(this.opacity);return`${1===e?"hsl(":"hsla("}${Op(this.h)}, ${100*Np(this.s)}%, ${100*Np(this.l)}%${1===e?")":`, ${e})`}`}}));const zp=e=>()=>e;function jp(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):zp(isNaN(e)?t:e)}const Lp=function e(t){var n=function(e){return 1==(e=+e)?jp:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):zp(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=Ep(e)).r,(t=Ep(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),s=jp(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=s(t),e+""}}return r.gamma=e,r}(1);function Rp(e){return function(t){var n,r,i=t.length,a=new Array(i),s=new Array(i),o=new Array(i);for(n=0;n<i;++n)r=Ep(t[n]),a[n]=r.r||0,s[n]=r.g||0,o[n]=r.b||0;return a=e(a),s=e(s),o=e(o),r.opacity=1,function(e){return r.r=a(e),r.g=s(e),r.b=o(e),r+""}}}function Dp(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),s=new Array(r);for(n=0;n<i;++n)a[n]=Kp(e[n],t[n]);for(;n<r;++n)s[n]=t[n];return function(e){for(n=0;n<i;++n)s[n]=a[n](e);return s}}function Fp(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function _p(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Up(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=Kp(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}Rp(If),Rp((function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],s=e[(r+1)%t],o=e[(r+2)%t];return Pf((n-r/t)*t,i,a,s,o)}}));var Vp=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Bp=new RegExp(Vp.source,"g");function Hp(e,t){var n,r,i,a=Vp.lastIndex=Bp.lastIndex=0,s=-1,o=[],l=[];for(e+="",t+="";(n=Vp.exec(e))&&(r=Bp.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),o[s]?o[s]+=i:o[++s]=i),(n=n[0])===(r=r[0])?o[s]?o[s]+=r:o[++s]=r:(o[++s]=null,l.push({i:s,x:_p(n,r)})),a=Bp.lastIndex;return a<t.length&&(i=t.slice(a),o[s]?o[s]+=i:o[++s]=i),o.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)o[(n=l[r]).i]=n.x(e);return o.join("")})}function Yp(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function Kp(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?zp(t):("number"===i?_p:"string"===i?(n=yp(t))?(t=n,Lp):Hp:t instanceof yp?Lp:t instanceof Date?Fp:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?Dp:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Up:_p:Yp))(e,t)}function Wp(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function qp(e){return+e}var Gp=[0,1];function Jp(e){return e}function Qp(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function Xp(e,t,n){var r=e[0],i=e[1],a=t[0],s=t[1];return i<r?(r=Qp(i,r),a=n(s,a)):(r=Qp(r,i),a=n(a,s)),function(e){return a(r(e))}}function Zp(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),s=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<r;)i[s]=Qp(e[s],e[s+1]),a[s]=n(t[s],t[s+1]);return function(t){var n=Zf(e,t,1,r)-1;return a[n](i[n](t))}}function ev(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function tv(e){return Math.log(e)}function nv(e){return Math.exp(e)}function rv(e){return-Math.log(-e)}function iv(e){return-Math.exp(-e)}function av(e){return isFinite(e)?+("1e"+e):e<0?0:e}function sv(e){return(t,n)=>-e(-t,n)}function ov(){const e=function(e){const t=e(tv,nv),n=t.domain;let r,i,a=10;function s(){return r=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}(a),i=function(e){return 10===e?av:e===Math.E?Math.exp:t=>Math.pow(e,t)}(a),n()[0]<0?(r=sv(r),i=sv(i),e(rv,iv)):e(tv,nv),t}return t.base=function(e){return arguments.length?(a=+e,s()):a},t.domain=function(e){return arguments.length?(n(e),s()):n()},t.ticks=e=>{const t=n();let s=t[0],o=t[t.length-1];const l=o<s;l&&([s,o]=[o,s]);let c,u,d=r(s),m=r(o);const h=null==e?10:+e;let f=[];if(!(a%1)&&m-d<h){if(d=Math.floor(d),m=Math.ceil(m),s>0){for(;d<=m;++d)for(c=1;c<a;++c)if(u=d<0?c/i(-d):c*i(d),!(u<s)){if(u>o)break;f.push(u)}}else for(;d<=m;++d)for(c=a-1;c>=1;--c)if(u=d>0?c/i(-d):c*i(d),!(u<s)){if(u>o)break;f.push(u)}2*f.length<h&&(f=zf(s,o,h))}else f=zf(d,m,Math.min(m-d,h)).map(i);return l?f.reverse():f},t.tickFormat=(e,n)=>{if(null==e&&(e=10),null==n&&(n=10===a?"s":","),"function"!=typeof n&&(a%1||null!=(n=Rf(n)).precision||(n.trim=!0),n=Hf(n)),e===1/0)return n;const s=Math.max(1,a*e/t.ticks().length);return e=>{let t=e/i(Math.round(r(e)));return t*a<a-.5&&(t*=a),t<=s?n(e):""}},t.nice=()=>n(function(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],s=e[i];return s<a&&(n=r,r=i,i=n,n=a,a=s,s=n),e[r]=t.floor(a),e[i]=t.ceil(s),e}(n(),{floor:e=>i(Math.floor(r(e))),ceil:e=>i(Math.ceil(r(e)))})),t}(function(){var e,t,n,r,i,a,s=Gp,o=Gp,l=Kp,c=Jp;function u(){var e,t,n,l=Math.min(s.length,o.length);return c!==Jp&&(e=s[0],t=s[l-1],e>t&&(n=e,e=t,t=n),c=function(n){return Math.max(e,Math.min(t,n))}),r=l>2?Zp:Xp,i=a=null,d}function d(t){return null==t||isNaN(t=+t)?n:(i||(i=r(s.map(e),o,l)))(e(c(t)))}return d.invert=function(n){return c(t((a||(a=r(o,s.map(e),_p)))(n)))},d.domain=function(e){return arguments.length?(s=Array.from(e,qp),u()):s.slice()},d.range=function(e){return arguments.length?(o=Array.from(e),u()):o.slice()},d.rangeRound=function(e){return o=Array.from(e),l=Wp,u()},d.clamp=function(e){return arguments.length?(c=!!e||Jp,u()):c!==Jp},d.interpolate=function(e){return arguments.length?(l=e,u()):l},d.unknown=function(e){return arguments.length?(n=e,d):n},function(n,r){return e=n,t=r,u()}}()).domain([1,10]);return e.copy=()=>{return(t=e,n=ov(),n.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())).base(e.base());var t,n},ev.apply(e,arguments),e}var lv=n(4843);const cv=[16.35,17.32,18.35,19.45,20.6,21.83,23.12,24.5,25.96,27.5,29.14,30.87].map(((e,t)=>{const n=[{index:t,value:e}];for(let r=1;r<12;r++)n[r]={index:t,value:e*Math.pow(2,r)};return n})).flat().sort(((e,t)=>e.value-t.value));function uv(e,t,n){return function(e,t){const n=e*t,r=n+t,i=cv.filter((e=>e.value>=n&&e.value<r));if(i.length>0)return i.map((({index:e})=>({index:e,value:1})));for(let e=0;e<cv.length;e++){const t=cv[e];if(t.value>r){const i=cv[e-1],a=t.value-i.value;return[{index:i.index,value:1-(r-i.value)/a},{index:t.index,value:1-(t.value-n)/a}]}}return[]}(t,n).map((({index:t,value:n})=>e[t]*n)).reduce(((e,t)=>e+t),0)}var dv,mv=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};dv=new WeakMap;const hv=new class{constructor(e){this.intervalTypes=["bars","beats","sections","segments","tatums"],this.animationFrameId=0,this.currentTrackId="",this.currentTrackAnalysis=null,this.trackAnalysis={},this.initialTrackProgress=0,this.initialStart=0,this.trackProgress=0,this.active=!1,this.queues={volume:[],beat:[]},this.activeIntervals$=new $e({bars:{},beats:{},sections:{},segments:{},tatums:{}}),dv.set(this,0),this.fftSize=2048,this.volumeSmoothing=100,e.observeCurrentTrackState().subscribe((t=>mv(this,void 0,void 0,(function*(){var n,r;const i=null===(r=null===(n=null==t?void 0:t.track_window)||void 0===n?void 0:n.current_track)||void 0===r?void 0:r.id;if(i&&this.currentTrackId!==i){this.currentTrackId=i,this.currentTrackAnalysis=null;try{this.currentTrackAnalysis=yield ou.getAudioAnalysisForTrack(i),t=yield e.getCurrentState()}catch(e){console.error(e),this.currentTrackAnalysis=null,t=null}}t&&this.currentTrackAnalysis&&this.updateState(t),this.active=!(!this.currentTrackAnalysis||!t||t.paused||t.loading),this.active?this.start():this.stop()}))))}get bar(){return this.activeIntervals.bars}get beat(){return this.activeIntervals.beats}get frequencyBinCount(){return this.fftSize/2}get section(){return this.activeIntervals.sections}get segment(){return this.activeIntervals.segments}get tatum(){return this.activeIntervals.tatums}get volume(){return function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,dv,"f")}observeBar(){return this.observeActiveIntervals().pipe(wn((e=>e.bars)),Or())}observeBeat(){return this.observeActiveIntervals().pipe(wn((e=>e.beats)),Or())}observeSection(){return this.observeActiveIntervals().pipe(wn((e=>e.sections)),Or())}observeSegment(){return this.observeActiveIntervals().pipe(wn((e=>e.segments)),Or())}observeTatum(){return this.observeActiveIntervals().pipe(wn((e=>e.tatums)),Or())}getByteFrequencyData(e){if(!this.active)return void e.fill(0);const t=this.segment.pitches;if(t){const n=If([.5,1,.5])(this.beat.progress)*this.volume,r=(this.segment.timbre[1]-180)/360,i=this.frequencyBinCount;for(let a=0;a<i;a++){let s=(a-i/2-r*i)/i+1;(s<0||s>2)&&(s=0);const o=Math.sin(s*(Math.PI/2)),l=uv(t,a,this.sampleSize);e[a]=(l+o)/2*255*n}}else e.fill(0)}getFloatFrequencyData(e){if(!this.active)return void e.fill(0);const t=e.length,n=new Uint8Array(t);this.getByteFrequencyData(n);for(let r=0;r<t;r++)e[r]=n[r]-128}getByteTimeDomainData(e){if(!this.active)return void e.fill(0);const t=e.length,n=new Float32Array(t);this.getFloatTimeDomainData(n);const r=Uint8Array.from(n);for(let n=0;n<t;n++)e[n]=r[n]}getFloatTimeDomainData(e){if(!this.active)return void e.fill(0);const t=e.length,n=new Float32Array(t);this.getFloatFrequencyData(n);const{real:r,imag:i}=(0,lv.rS)(n);for(let n=0;n<t;n++)e[n]=Math.sqrt(r[n]*r[n]+i[n]*i[n])-128}get activeIntervals(){return this.activeIntervals$.getValue()}get sampleSize(){return 22050/this.frequencyBinCount}observeActiveIntervals(){return Sf().pipe(Un((e=>e?Fn:this.activeIntervals$)),De((()=>this.active)))}updateState(e){return mv(this,void 0,void 0,(function*(){this.trackAnalysis=JSON.parse(JSON.stringify(this.currentTrackAnalysis)),this.intervalTypes.forEach((e=>{const t=this.trackAnalysis[e];t[0].duration=t[0].start+t[0].duration,t[0].start=0,t.forEach((e=>{this.isSegment(e)&&(e.loudness_max_time=1e3*e.loudness_max_time),e.start=1e3*(e.start||0),e.duration=1e3*(e.duration||0)}))})),this.initialTrackProgress=e.position,this.trackProgress=e.position,this.initialStart=window.performance.now()}))}setActiveIntervals(){const e=this.activeIntervals,t=e=>{const t=this.trackAnalysis[e],n=this.trackProgress;for(let e=0;e<t.length;e++){if(e===t.length-1)return e;if(t[e].start<n&&n<t[e+1].start)return e}return 0};this.intervalTypes.forEach((n=>{const r=t(n);null!=e[n].start&&r===e[n].index||(e[n]=Object.assign(Object.assign({},this.trackAnalysis[n][r]),{index:r}));const{start:i,duration:a}=e[n],s=this.trackProgress-i;e[n].elapsed=s,e[n].progress=this.easeOutQuart(s/a)})),this.activeIntervals$.next(e)}getVolume(){const{loudness_max:e,loudness_start:t,loudness_max_time:n,duration:r,elapsed:i,start:a,index:s}=this.activeIntervals.segments;if(!this.trackAnalysis.segments[s+1])return 0;const o=this.trackAnalysis.segments[s+1].loudness_start,l=a+i;if(i<n){const r=Math.min(1,i/n);return this.interpolate(t,e)(r)}{const t=l-(a+n),i=r-n,s=Math.min(1,t/i);return this.interpolate(e,o)(s)}}start(){this.animationFrameId||(this.animationFrameId=requestAnimationFrame((e=>this.tick(e))))}stop(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}tick(e){if(this.animationFrameId=requestAnimationFrame((e=>this.tick(e))),!this.active)return;this.trackProgress=e-this.initialStart+this.initialTrackProgress,this.setActiveIntervals();const t=this.getVolume(),n=this.queues;function r(e){return e.reduce(((e,t)=>e+t))/e.length}n.volume.unshift(t),n.volume.length>400&&n.volume.pop(),n.beat.unshift(t),n.beat.length>this.volumeSmoothing&&n.beat.pop();const i=ov().domain([Cf(n.volume),r(n.volume)]).range([0,1]),a=r(n.beat);!function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,dv,i(a)||0,"f")}interpolate(e,t){return n=>e*(1-n)+t*n}isSegment(e){return"loudness_max_time"in e}easeOutQuart(e){return e=Math.min(Math.max(0,e),1),1- --e*e*e*e}}(od);class fv extends AnalyserNode{constructor(e,t){super(e,t),this.isPlayingSpotify=!1,Ef().subscribe((({currentItem:e})=>{this.isPlayingSpotify=!!(null==e?void 0:e.src.startsWith("spotify:"))}))}getByteFrequencyData(e){this.isPlayingSpotify?hv.getByteFrequencyData(e):super.getByteFrequencyData(e)}getFloatFrequencyData(e){this.isPlayingSpotify?hv.getFloatFrequencyData(e):super.getFloatFrequencyData(e)}getByteTimeDomainData(e){this.isPlayingSpotify?hv.getByteTimeDomainData(e):super.getByteTimeDomainData(e)}getFloatTimeDomainData(e){this.isPlayingSpotify?hv.getFloatTimeDomainData(e):super.getFloatTimeDomainData(e)}}class pv extends AudioContext{createAnalyser(e){return new fv(this,e)}}const vv=new pv,bv=vv.createAnalyser({fftSize:2048,smoothingTimeConstant:0});let yv,gv;bv.connect(vv.destination);const wv=new $e(vv.createMediaElementSource(new Audio));function Ev(){return wv.pipe(Or())}Ef().subscribe((({currentItem:e})=>{if(null==e?void 0:e.src.startsWith("apple:")){if(!gv){const e=document.querySelector("audio#apple-music-player");e&&(gv=vv.createMediaElementSource(e))}gv&&wv.next(gv)}else{if(!yv){const e=document.querySelector("audio.html5-audio");e&&(yv=vv.createMediaElementSource(e))}yv&&wv.next(yv)}})),Ev().pipe(qu(1)).subscribe((e=>e.connect(bv)));const kv=new N("WaveformPlayer");class xv extends mf{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.currentVisualizer="",this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-waveform"}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e||this.animationFrameId||this.render())}appendTo(e){e.append(this.canvas)}load(e){e&&(kv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.config=e.config,this.render()))}play(){kv.log("play"),this.animationFrameId||this.render()}pause(){kv.log("pause"),this.cancelAnimation()}stop(){kv.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.renderFrame()}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(e=performance.now()){this.renderFrame(e),this.autoplay&&!this.hidden&&(this.animationFrameId=requestAnimationFrame((e=>this.render(e))))}renderFrame(e=performance.now()){var t,n;const r=this.context2D,i=this.canvas.width,a=this.canvas.height,s=this.analyser;null===(n=null===(t=this.config)||void 0===t?void 0:t.onPaint)||void 0===n||n.call(t,{context2D:r,width:i,height:a,now:e,analyser:s})}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}const Sv=new xv(bv);Sv.load({providerId:"waveform",name:"beats",config:{onPaint:({context2D:e,width:t,height:n,analyser:r})=>{const i=r.frequencyBinCount,a=new Uint8Array(i);r.getByteFrequencyData(a),e.clearRect(0,0,t,n),e.fillStyle=`rgba(255, 255, 255, ${document.fullscreenElement?.45:.6})`,e.strokeStyle="rgba(0, 0, 0, .9)",e.shadowColor="rgba(0, 0, 0, .6)",e.lineWidth=1,e.shadowBlur=2,e.shadowOffsetX=2,e.shadowOffsetY=2;const s=(t-48)/12,o=.0075*n,l=i/12;let c,u=4;for(let t=0;t<i;t+=l){const r=a.slice(t,t+l).reduce(((e,t)=>e+t),0)/l;c=o*r,e.fillRect(u,n-c/2,s,c/2+4),e.strokeRect(u,n-c/2,s,c/2+4),u+=s+4}}}});const Tv=Sv,Av=new N("ambientVideoPlayer"),Pv=new hf("video","ambient"),Iv=new Vh("ambient"),Cv=new D("ambientVideoPlayer");function Mv(){return bf.useAmbientVideoSource&&bf.ambientVideoSource?"user-progress":"progress"}const Ov=new uf("ambient-video-player",[Pv,Iv,Tv],(function(e){return e?e.src.startsWith("youtube:")?Iv:Pv:null}),(function(e,t){const n=t.src;if(n.startsWith("youtube:")){const[,,t]=n.split(":"),r=Mv(),i=Cv.getJson(r,{})[t]||("progress"===r?120:0);e.load(`${n}:${i}`)}else e.load(n)}));Ov.loop=!0,Ov.volume=0,Ov.hidden=!0;const Nv=new class extends mf{constructor(e,t){super(),this.videoPlayer=e,this.beatsPlayer=t,yf().pipe(wn((e=>e.beatsOverlay)),Or()).subscribe((e=>{this.beatsPlayer.hidden=this.hidden||!e}))}get autoplay(){return this.videoPlayer.autoplay}set autoplay(e){this.videoPlayer.autoplay=e,this.beatsPlayer.autoplay=e}get hidden(){return this.videoPlayer.hidden}set hidden(e){this.videoPlayer.hidden=e,this.beatsPlayer.hidden=e||!bf.beatsOverlay}observeCurrentTime(){return this.videoPlayer.observeCurrentTime()}observeDuration(){return this.videoPlayer.observeDuration()}observeEnded(){return this.videoPlayer.observeEnded()}observeError(){return this.videoPlayer.observeError()}observePlaying(){return this.videoPlayer.observePlaying()}appendTo(e){this.videoPlayer.appendTo(e)}load(e){this.videoPlayer.load(e),this.autoplay&&bf.beatsOverlay&&this.beatsPlayer.play()}play(){this.videoPlayer.play(),bf.beatsOverlay&&this.beatsPlayer.play()}pause(){this.videoPlayer.pause(),this.beatsPlayer.pause()}stop(){this.videoPlayer.stop(),this.beatsPlayer.stop()}resize(e,t){this.videoPlayer.resize(e,t);const n=document.fullscreenElement?20:10;this.beatsPlayer.resize(At.fontSize*n,At.fontSize*n*.225)}}(Ov,Tv);Iv.observeVideoId().pipe(Un((e=>e?Iv.observeCurrentTime().pipe(wn(Math.round),Or(),De((e=>e>0&&e%30==0)),Wu(Iv.observeDuration()),De((([,e])=>e>600)),Re((([t])=>{const n=Mv(),r=Cv.getJson(n,{});r[e]=t,Cv.setJson(n,r)}))):Fn))).subscribe(Av),yf().pipe(wn((e=>e.ambientVideoSource)),Or(),qu(1),Re((()=>Cv.removeItem("user-progress")))).subscribe(Av);const $v="\nmo2re_RX3Bs blXien2Jh_o etiatMRgFcM DYsMJiwiZSI _MZ7UZ5frCI HCx1Z92PjJE dIP7wWY4Znw gW4nffCscYs\nA1m0SEqmmbE 9uZ8CCa0t4Y 35CTu7dWzo8 wz_ItcoR0-c jS4-FmNEDKo Tz77vqH_LJw K73lfmxDVR0 W8ayfyRWUrg\ncbuldALGsaQ AJZon2grzmA H5ASEM9dMiA GE2YEq7vaLc MYGOdJNAzrI Oszl95YWfbs b0-IkxXyhmY hoYPURX2RuE\nH6Xy97CD9Hs p-OUNPqRzII XaTxLSPh_Is 1n3ezT1cvAM CWU1pZVw0xM ry1Q7KaQdxM VlC5LSTvoj0 j-bG0j3-KzE\n1bClbVe4QyI f6OZ01vvmko o4jE24WixcI BIej9P2LrzM dxw91a7C5BQ lN9LdcAQnjw VVkZKzTbWQs vXCB1zGGFiY\nJHARFKMl8dU KSB1AZ0-I74 IGqfU6cJJc8 8zg22-ZCUfE WMlR8eJRS3I l4D6bnIdehk A5pbF_YBulo dRFRsKobN9I\nBur1ChHBNsQ IlDvBTDGanI SqMzG8xsynw mOmwk3WyYnw im2eWwIiTOc lxQS58t39_U yk076o8NF3k oggiHfuV4m8\np_GnUkm-G1M xVMsAgHy_IY VdZkfef44JI ZxOd8tmdsIM fszuqfJWKxc 0LGL_lx9XcA i_hU5eUrVIs qtwWkv9OdF0\nuZjCNtOeZG4 ZpXnEvW0XD0 -C8TYbhnVTU WzxSiEWK3cg ZE8vuq4aqNA 7HMw3bcIgRE ZJiCEDweLl8 lyh2kAjcmSY\nvFwqZ4qAUkE QLbPYQcUcgM xwf7EssFnXU n_7gkhSjSjY vvm8b2jAfv0 XkRFSnxXQ_w Ee0Qh_nIoHw 78rppSvbh7A\nNXIaYDJql1c VWHTlq5Fcr8 ZkRjihsMdp8 e1M6jHcRrlM z9Ug-3qhrwY mA30W2dHQIo XIhEPwTMjWk -Tm4H4CrKT0\nT6tapzmF_n0 7QetsPh7BPM xBDqge4w-XA suWbFuw1O_I OvStKpL5Ujo ZX8fSO8uTPg xX9xfFT-Qw0 hf3r9TNSsyY\n-WIamcIaipI Zjc6DwVDvq0 eHjoav_sb88 7E0WVROBsEE BvLIJSmzAnY YPurG3WT8xI 0ocUnSG4oQQ EkmJlmU7uqw\naC7s2UVXt3c EJArkl7K29k 9eFVeErnUzg CLDzwdixWsk B1-yyoNMUzs Ab5I38wGxko sVuqgnXD9AE yMcNorxM9IQ\nY0U0HAwpw2s G20ZaQfTWgs Nde5P8Ob2xg f-Xul0mdBCA ExStG9rRkoY tMzCwwvHwN0 iaVmsp7dU1Y TV4J01qGE8E\nMPch_urCew8 eYpCCSAW3aw XfBNIrQ5JKQ -b68N6Q4Qus H3mdjo7kYiQ 9CJLtzzUphU yy-aMo2ds2k fVRSSNkq3Bk\nLtPGmDskDiY U9rtWGI6H5A NHa506wwN0Y sFSrJSEFXu8 ubQKAfwSLDA aFsNz5VMyC8 h6yhFP_qUro GlotnVckHG4\nPEgQ0dIOB5c KWz3SXWnFys MGRDy2PqCGk 4DcMcAHrURw ETwbuC3p1ls iszl1WqjQIk njcvxMb8TVQ Vpi5By3PG68\nhNNN5xPyyeY 8ls8xBn70gM 2XREaQqoU1U MXL2qjIL4qI 9YqbQcfIre0 nAMkwo2eSbY 8DRItK-C7vU WdtkaLxc464\nPaIH77c53LA FSlhSL8bFoI XLuV3_a-ro0 mo7mUJZV6DM IqWPDr8KCmQ v-QS_Kh_i6o zowLNSKyfI0 Xn8tufsbSz0\n7gG4l70v8mw thurNCHVo08 YgryBZTMVZY XAmU3yQc90M KBUg3U3MRao v_My9t4gadA Xwb1xsWClCM KlH1g1x6RJk\nyFqew9NnNvk LMSmWzCqlPE oN3glsVrnRY PPBV3hem5iM eqzVRpevI8s nSJ67PGjQfQ EoBF2xRsbAc KDUYy3xwCFs\nRZOcoZS_52Q pSP9_otXcTU H36qe8NatNQ qgfd-uWTVwg Blu_yCEFYvk HeYMIBFtwh4 fb0QX7DbqLg kdqyAA0ILD4\nriZWEoGKyuU 4qo9bKRxgYA t0j_GdkG1BM hLq9J32lGRs zfc53CpvlZ4 IjNKQbm4AQ8 hg2FDCmqNkg tG991Undnbc\nsh8l2-cCAGQ XDE5pd4V_xc C2BVXFIX7bY ySPxZpoqXZ8 hiEUaLX4cCM 3F4l-6GwkKM F399teRPBaY 2jw2eAIW8sU\nWsCCYv2adkM wmV7Po_E0pw 9Rvtm2zGEl4 DGlAMkUjcY0 h2s_WOkfTXk 0VhxPdtX0xg 6vuFh6NNa70 ukOHqdPbYYg\nH6OmEQ8RqVk qPp315pPVSI FQqj6gN7M6M Xrwks9O2-JQ ipRwt3TDgY4 aVqRyfRviwA X33dmu12C5c QEwzFKoG7tk\nh98nR30UD8Q Z7WpAwRjprI ilqlSBYfCGs V6SoeDWDon0 d-Hwz42Vfw4 RCdAP0e4W4w 22dlye7h3qU p7l6JQApzak\nblSZ365wpfQ ADF4KgfhzPs jSRvD7Uma1g uLMC6bL_q38 k9DuPxFQ7HQ 7f2taFPyqxc vHf4WQtJvdI NXg0IKlrz-Q\nORHIVufNfRM RT4hEmX5OJ0 H3GL5jO53NU acTsYqhq-AA vp2yiZnjK0w eR5vsN1Lq4E yyNl2HuCTHk 55w2VtMNuvY\n7qXiAaxxGBs m6m6bqHiT6U l5jUOT0XiUM NLxwmtJSvk4 dv_QzcJGHAE kaPD4n9uQ2k r7HpeG2ofU0 O1AQcFpPs04\n44ih4WRTyGg W5BmjLsEsB0 JkNlFaei_k8 2ttB1FzBpZ4 k3Q1vse7In8 7xltSb3VBJQ ojbiGfhnjTU _Qb7TJ-T1HM\ngvT3gIDSwq8 4X95pykbYTY BPDznHIgVMA OIA5xQWkk2U 2uQ58Xwx1V4 UVjCFpYMR6A -uww0BzTb7g EqWBy5i8LyQ\nszErNcJMCdA 5k1DGpr_qDw YNEkjkh0bYo jmjrpHYegzc eXcbc2gmDsA rVLOQB5kGGw F8MN0o6RS9o viim_l9gbF8\nsBtYWK817-0 g0IvwhzSIW0 y7vz1qQGUd8 -0ewPjoBBNI S1emxk9UWBE 1muEwEFDKgk P0MbbslO62E TX9U62sj5nM\nwwXpkTd1CaQ W2A_PcIhUVM ZIb8u6uJwBo TWjid2dVjMk gdJjc6l6iII n3Dru5y3ROc OOf4Z7tyLVM iDXDrTKJehk\nwYhliE9O_3k nw0uvJZonBc cK7x6lUUsYo ltNMSx_imZU e2AUzM6QgGs 3cxyYOXiJss AsD5u6k6dKI d_hx39kXDUg\nhlvfDL3nSoo 6L2xYzu724E URy2Ak-WRpE 9N-sp0FaZEA yttvb9ByOtY ctqujFKaFZQ orTy-IqN9_I JdkM1EBCCKs\nef1wAfrMg5I eN-RZVkFGj0 KPV1hFJIXrg -bp4Bgs7MaQ u1rRUwx_Vy4 iTjgWeJMUJo WL9EOfzoSsA xrCNwCD-z-M\nCC3AanQdQZA ZGLrP5eawdY HoOghpRTkvs N787WRdI35A Cw0d-nqSNE8 2vifO3_gjiM OeJ5xXrbkfU vkYBLYAGavM\njP4gBqxfheI HHi8qOtHnhE oN8q7p57nZw 6vnxzfejWN4 gVamQ6jodK0 iU5QjAbuhec qLIU_90P4Ac z8k_ximc8Og\nZFBoN7yIMZw 4mexI7cACZk bx-0YlFprqc NDWpXTg3koc Vo2AcHSCRiQ UrfJgjQt1SY WXI7byeZk5s y8d7Ihe0IwE\nubmUJcwor3k CGslieDL-04 w7ljU-lmaK4 I0B21LjeSUQ PyFN_FYwqvc bxy9PFJRJ0g ahmrb5EYoxY HGxuVWpN8vQ\nDNR1zyr5Go4 eyPhudLTuis aPWXL4ahxdY JB0A8Me8EKk dGy_6qyyY7c rxrDLgt5YFA uhcocK-td5E 4Z5FLeh7P18\nVB0zDS9ITmk VukLV0AoeFA CouF-tNHV3g lTvYjERVAnY S27YOjpgaaE 24uCC_-zaaE DslTxXsDLsw xilGAQPx5Xw\n9eu4yqpxQGU FDqQlAUDZyk R1OHRQoJOP0 fbqmVbEj9fg asL1AN3hifU fd8spJiYS0k 3ma3yXXc3V8 1U1We59en3s\niNm7PPqO6rM CLRk8SgtVS4 VYO8Biwffns 9Wm8Ij8rHIE ZMOC332wC7A doORhRob3Qg E2sSvVCRI4s 2aVxI4PSiDI\nE6Ww7lpuZ2k Ueqm3PQKYPk eFiKAcbp2MY dAfMgDBeqwU MsUOx11_eLk LAFK1EvwulU OF0iDephya8 L_mlofcsRaA\neZe4Q_58UTU NXObT_Fl-xI H222V6b4DCg _WkkH31sTMI ALJcKvnOjHM 85Y1N8avsXs NCY42RnUpCE 48rsDblF5Ig\n0Tpq2mLtXDc Zp1Oajc7VQw WGi4XiEGe8M b6L40CEYVyM Mw9qiV7XlFs UgHKb_7884o mvIYmMo906E VoXOYFlJTuI\nfsjdpo1o-J8 k9rKpHXwA1E MTG3VA-m6qk cU3XY6Ii8v0 NBIdmswtcnM k5sznEJz8BA R8W3U0Mu6t4 7iSOMLkFizU\n6KBo0GhU9XM d5R3FK9vLBs N5b7Iy4W0ow 2FE1_YK5OPI pughd7ysJyQ A-mPDdnzipI 6gqU-HL68wE RKWLu6UHryQ\nVIlQIVVLWVs 6A-kQCdEIpI _lisL6tLbdg VarS6olPfTA va306f9aN3A YlPawyXaMJI wjMf_bEfqIc hNC6-bxHJac\nJBm1ainuk-c PkF4EKJQOOg 0aMUCiKjBDI D1KsEOUqCEU JdE_xc1rQBY omlVslJvzxQ FoS3732REf0 kNMOaRRBat4\nqqC80mXlOKo MS2asGj1-_M NmP0RylitI4 IahW6hJ1-SM 9MIJm1NeUpE 2qzbMPpgtDw H3UY2gQfj-s 9kekiNImlsI\n5zUCClmhjF0 88jpBZdsrT8 UdFae3BAH38 MAFdQs_yWvg BHgDL6ODWSU p7G1lkYIFTM yAKSGmQkjxM 7TML_MTQdg4\nFGCIBbg0IYk oaQ8UXlKDiw 5rf_gOfa7O4 MYG6FeY4SKg AVzdfRpE9Q0 1UxoHtG2qas o7XgU4ut6jQ IcOYM87wTRc\noPetbPLA8dM eQIzdzSTH08 tpRBHKAJ_tU sTy4stPcD0E p4jroQX6Hwk y2Zl-KXvdSk zffchwaq6KE jv7hNnJEWPU\nDN-BxbMH264 mWaC_VSncEg 8x5Yzxi3LhA 0Txa_T4pHY4 McT_FUPZR5k 5rTo8-CPgU4 WbUgBaEsugI QytjUFgcmWw\n6BLY2zj6pq0 W5Y0deEEszo U6jAaBK7idQ rHZlMW_zxaE 4Xp4J5RYns0 Xsf2ThMqNBM lUbOyYp91NU dpuTxI8KAyc\nOIoAJfLDW1U bXK3EZ1AOZ0 nV62c0XBLDg 7ZWSdWxHAzY LVJHOKOIXK4 8QdnY1lACEs BfkdRwJAeu8 qyCXiUtWhD0\nXLNixgPHzao Q-iZMkvHnFw O47-jQYPznA H0RwPrdQs9g 5hkJkYLounY tlgv2urELis zHAbIALBaog cvoo5xXtiEA\nRpHnKaxt_OQ GsqsG3axUCs eMv6SCniTPg 5BdpkKiY3Fw _85ElkxtQa4 xCfEA0kuNww zsdPYFPTdw0 9pTT6867XJ4\nDUhdSWsapuA EmxS4JvlT5k CGBPXRi1nrM P9iRIGoIc9g Cy3okiPj26M TaKvapV_BwU jg5mnvYmrzU eG89_Vk_cqE\nwqoJj3ZJnXA N3DgwOn9yGI mvUV0FNBnGI 5FJWKoV07VM VaTBFaLFvHk EwlhQziQ-kw c9Ydsd89vWc Id83Esvmmb0\n09h57SoWrvE kwgeurY2omQ uLZlVUnQYY8 4jdV5FbvHpM 44KChB6CQOI XCUk8cRysW4 OdsIYD9F6Og _8fm1yqbPA4\n0hvAQ9hE-V0 df2q8ciX2rU p08ErTYMOh0 MvmxZj9Bo1I fDZYQD1GDd4 cJwiiXmPg-Y fWnlQnposC4 pYqScYQZ-o8\nQ7W4JISNmQk fryghm20GnQ jgtcAEUtgF4 XPKTAyKWoIo n5PqysUA4lU 0bJWDOTyCTY YJJA6pUx2FY JBlJrTkJxi0\nhsNMJp8G5tA pO13fJttJBE iw44ObI2cig 0KIWOl_lF2A 001TlVo_jmg kt0qIFPQBJg 0tZ2Y8kpCLI bzADvjia-mw\nqZezMIk7Oq4 ZHNYXUmEGoU 8dFr3YqPaeg M9KXG8jCq2U djP_T_rp09s Tyd_wjLfA_E ymRww99Yb-I zQrgF2izz2Y\nW0Kl0QfMEPo 5bwHtF7fR94 IXSTdSv-Jlo mf5E3FDZ6rY 7JsOhtl_zG4 vr5dCRHAgb0 Di9jRVy7WHk cVdfUy_VMTY\nLD_jcIQGl0Q ZXas8NdyLsE ELUl-cAtUIE --qCu9yL5H8 74wsGjTZzGg Wey4zHA4nPg VArhsYKbKzk t76IJmQKzKA\nl1RxmWxXQcM 7HagxwgIRcY gJgwJwg6Deg 1mD8V2trqcw i5ZbYQ1Nok4 YE3iWysmcBQ vdycBdIx-do UE-J2Dt8LNs\nx_dVi_PC_sc\n".match(/\S+/g).map((e=>({providerId:"ambientvideo",name:e,src:`youtube:video:${e}`})));const zv=new N("ambientvideo/visualizers");zv.log(`default (total=${$v.length})`);const jv=new $e([]);yf().pipe(cm(1),wn((e=>!!e.ambientVideoEnabled)),Or(),Un((e=>e?yf().pipe(wn((e=>!!e.useAmbientVideoSource)),Or(),Un((e=>e?yf().pipe(wn((e=>e.ambientVideoSource||"")),Or(),Un((e=>e?function(e){return t=this,n=void 0,i=function*(){const t=qo(e),[,n,r]=t.split(":");let i=[r];return"playlist"===n&&(i=yield function(e){return Bh(this,void 0,void 0,(function*(){const t=new Yh(e);try{return yield t.loadPlaylist()}finally{t.destroy()}}))}(t)),i.map((e=>({providerId:"ambientvideo",name:e,src:`youtube:video:${e}`})))},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e):Gn([])))):Gn($v)))):Gn([]))),Fr((e=>(zv.error(e),Gn([]))))).subscribe(jv);const Lv={id:"ambientvideo",name:"Ambient Video",defaultHidden:!0,player:Nv,get visualizers(){return jv.getValue()},observeVisualizers:function(){return jv}},Rv=new N("AmpShaderPlayer");const Dv=new $e([]);setTimeout((()=>{return e=void 0,t=void 0,i=function*(){const{default:e}=yield n.e(595).then(n.bind(n,7281));e&&Dv.next(e)},new((r=void 0)||(r=Promise))((function(n,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((i=i.apply(e,t||[])).next())}));var e,t,r,i}),1e3);const Fv=new class extends mf{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.gl=this.canvas.getContext("webgl2"),this.animationFrameId=0,this.fragTheme=null,this.fragTime=null,this.fragChannelTime=null,this.fragDate=null,this.program=null,this.vertexShader=null,this.fragmentShader=null,this.startTime=performance.now(),this.currentVisualizer="";const t=this.gl;this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-ampshader";const n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,t.R8,512,2,0,t.RED,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);const r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r);const i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW)}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e||this.animationFrameId||this.render())}appendTo(e){e.append(this.canvas)}load(e){e&&(Rv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.createShader(e.shader),this.render()))}play(){Rv.log("play"),this.animationFrameId||this.render()}pause(){Rv.log("pause"),this.cancelAnimation()}stop(){Rv.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){const n=this.canvas,r=this.gl;if(n.width=e,n.height=t,r.viewport(0,0,e,t),this.program){const e=r.getUniformLocation(this.program,"iResolution");r.uniform2f(e,n.width,n.height),this.renderFrame()}}get currentDate(){const e=new Date;return[e.getFullYear(),e.getMonth(),e.getDate(),3600*e.getHours()+60*e.getMinutes()+e.getSeconds()+.001*e.getMilliseconds()]}get currentTime(){return(performance.now()-this.startTime)/1e3}get themeColor(){const{r:e,g:t,b:n}=new nt(At.frameColor).toRgb();return[e,t,n,1]}clear(){}createShader(e){const t=this.gl;this.program&&(t.detachShader(this.program,this.vertexShader),t.detachShader(this.program,this.fragmentShader),t.deleteProgram(this.program),this.program=null,this.vertexShader=null,this.fragmentShader=null);const n=this.vertexShader=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(n,"#version 300 es\nin vec4 as_Position;void main(void){gl_Position=as_Position;}"),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n));const r=this.fragmentShader=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(r));const i=t.createProgram();t.attachShader(i,n),t.attachShader(i,r),t.linkProgram(i),t.useProgram(i);const a=t.getAttribLocation(i,"as_Position");t.enableVertexAttribArray(a),t.vertexAttribPointer(a,2,t.FLOAT,!1,0,0),this.fragTheme=t.getUniformLocation(i,"iTheme"),t.uniform4f(this.fragTheme,...this.themeColor),this.startTime=performance.now();const s=this.currentTime;this.fragTime=t.getUniformLocation(i,"iTime"),t.uniform1f(this.fragTime,s),this.fragChannelTime=t.getUniformLocation(i,"iChannelTime"),t.uniform1fv(this.fragChannelTime,new Float32Array([s,0,0,0])),this.fragDate=t.getUniformLocation(i,"iDate"),t.uniform4f(this.fragDate,...this.currentDate);const o=t.getUniformLocation(i,"iResolution");t.uniform2f(o,this.canvas.width,this.canvas.height),this.program=i}render(){this.renderFrame(),this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((()=>this.render())))}renderFrame(){if(this.program){const e=this.gl,t=this.analyser.frequencyBinCount,n=new Uint8Array(t),r=new Uint8Array(t),i=new Uint8Array(1024);this.analyser.getByteFrequencyData(n),this.analyser.getByteTimeDomainData(r);for(let e=0;e<512;e++)i[e]=n[e],i[e+512]=r[e];const a=this.currentTime;e.uniform1f(this.fragTime,a),e.uniform1fv(this.fragChannelTime,new Float32Array([a,0,0,0])),e.uniform4f(this.fragDate,...this.currentDate),e.uniform4f(this.fragTheme,...this.themeColor),e.texImage2D(e.TEXTURE_2D,0,e.R8,512,2,0,e.RED,e.UNSIGNED_BYTE,i),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}(bv),_v={id:"ampshader",name:"ampshader",player:Fv,get visualizers(){return Dv.getValue()},observeVisualizers:function(){return Dv}};var Uv=n(8841);const Vv=new N("AudioMotionPlayer"),Bv="audiomotion",Hv=[{providerId:Bv,name:"Anemone",options:{radial:!0,ledBars:!1,spinSpeed:1,mode:8,barSpace:0,gradient:"ampcast-rainbow",reflexRatio:.4,showPeaks:!0,mirror:-1,maxFreq:8e3,lineWidth:2,fillAlpha:.2}},{providerId:Bv,name:"Classic LEDs",options:{mode:7,barSpace:0,gradient:"ampcast-classic",ledBars:!0,lumiBars:!1,radial:!1,reflexRatio:0,showPeaks:!0}},{providerId:Bv,name:"Mirror wave",options:{mode:10,fillAlpha:.6,gradient:"ampcast-rainbow",lineWidth:2,mirror:-1,radial:!1,reflexAlpha:1,reflexBright:1,reflexRatio:.5,showPeaks:!1}},{providerId:Bv,name:"Radial overlay",options:{mode:5,barSpace:.1,gradient:"ampcast-prism",radial:!0,ledBars:!1,showPeaks:!0,spinSpeed:1}},{providerId:Bv,name:"Reflex Bars",options:{mode:5,barSpace:.25,gradient:"ampcast-prism",lumiBars:!1,radial:!1,reflexAlpha:.25,reflexBright:1,reflexFit:!0,reflexRatio:.3,ledBars:!1,showPeaks:!0}}],Yv=new class extends mf{constructor(e,t){super(),this.currentVisualizer="";const n=this.element=document.createElement("div");n.hidden=!0,n.className="visualizer visualizer-audiomotion";const r=this.visualizer=new Uv.Z(n,{audioCtx:e,showBgColor:!1,overlay:!0,showScaleX:!1,showScaleY:!1,connectSpeakers:!1});t.subscribe((e=>{this.audioSourceNode=e,this.element.hidden||r.connectInput(e)})),At.observe().pipe(Re((()=>this.registerGradients()))).subscribe(Vv)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden!==e&&(this.element.hidden=e,e?this.visualizer.disconnectInput():this.audioSourceNode&&this.visualizer.connectInput(this.audioSourceNode))}appendTo(e){e.append(this.element)}load(e){e&&(Vv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.visualizer.setOptions(e.options))),this.autoplay&&this.visualizer.toggleAnalyzer(!0)}play(){Vv.log("play"),this.visualizer.toggleAnalyzer(!0)}pause(){Vv.log("pause"),this.visualizer.toggleAnalyzer(!1)}stop(){Vv.log("stop"),this.visualizer.toggleAnalyzer(!0)}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}registerGradients(){const e=new nt(At.isMediaButtonLight?At.mediaButtonColor:At.defaultMediaButtonColor),t=[new nt(At.mediaButtonColor),new nt(At.defaultMediaButtonColor),new nt(At.frameColor),new nt(At.frameTextColor),new nt(At.backgroundColor),new nt(At.textColor)].filter((e=>e.getBrightness()<200&&e.getLuminance()>.3&&e.toHsl().s>.3)).sort(((e,t)=>t.getLuminance()-e.getLuminance()))[0]||e,n=t.tetrad().map((e=>e.toRgbString())).slice(1);this.visualizer.registerGradient("ampcast-classic",{bgColor:At.black,colorStops:[n[0],{pos:.6,color:n[1]},n[2]]}),this.visualizer.registerGradient("ampcast-prism",{bgColor:At.black,colorStops:At.getVisualizerColors()}),this.visualizer.registerGradient("ampcast-rainbow",{bgColor:At.black,colorStops:e.analogous().map((e=>e.toRgbString()))})}}(vv,Ev()),Kv={id:"audiomotion",name:"audioMotion-analyzer",externalUrl:"https://audiomotion.dev/",player:Yv,visualizers:Hv,observeVisualizers:()=>Gn(Hv)};var Wv=n(2238),qv=n.n(Wv);const Gv=new N("ButterchurnPlayer");const Jv=new $e([]);function Qv(){return Jv.getValue()}setTimeout((()=>{return e=void 0,t=void 0,i=function*(){const e="butterchurn",{default:t}=yield n.e(577).then(n.t.bind(n,6607,23));if(t){Jv.next(Object.keys(t).map((n=>({providerId:e,name:n,data:t[n]}))));const{default:r}=yield n.e(271).then(n.t.bind(n,3710,23));r&&Jv.next(Qv().concat(Object.keys(r).map((t=>({providerId:e,name:t,data:r[t]})))))}},new((r=void 0)||(r=Promise))((function(n,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(s,o)}l((i=i.apply(e,t||[])).next())}));var e,t,r,i}),1e3);const Xv={id:"butterchurn",name:"Butterchurn (Milkdrop)",externalUrl:"https://butterchurnviz.com/",player:new class extends mf{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.error$=new Oe,this.animationFrameId=0,this.currentVisualizer="",this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-butterchurn",(this.visualizer=qv().createVisualizer(e.context,this.canvas,{width:400,height:200})).connectAudio(e)}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?this.visualizer.disconnectAudio(this.analyser):(this.visualizer.connectAudio(this.analyser),this.animationFrameId||this.render()))}observeError(){return this.error$}appendTo(e){e.append(this.canvas)}load(e){e&&(Gv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.visualizer.loadPreset(e.data,.5),this.render()))}play(){Gv.log("play"),this.animationFrameId||this.render()}pause(){Gv.log("pause"),this.cancelAnimation()}stop(){Gv.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.visualizer.render(),this.visualizer.setRendererSize(e,t),this.visualizer.render()}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(){if(this.animationFrameId)this.visualizer.render();else try{this.visualizer.render()}catch(e){Gv.error(e),this.error$.next(e)}this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((()=>this.render())))}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}(bv),get visualizers(){return Qv()},observeVisualizers:function(){return Jv}},Zv=new N("SpotifyVizPlayer");let eb="",tb="";const nb={volumeSmoothing:10,onBar(){const e=At.getVisualizerColors();eb=tb||E(e),tb=E(e.filter((e=>e!==tb)))},onPaint({context2D:e,height:t,width:n,now:r,analyser:i}){const a=If([0,10*i.volume,0])(i.bar.progress),s=If([0,300*i.volume,0])(i.beat.progress),{r:o,g:l,b:c}=new nt(At.black).toRgb(),u=`${o},${l},${c}`;e.fillStyle=`rgba(${u},0.08)`,e.fillRect(0,0,n,t),e.lineWidth=a,e.strokeStyle=Lp(eb,tb)(i.bar.progress),function(e,t,n,r,i,a=5){const s=e=>r*Math.sin(e/i+t)+n,{width:o}=e.canvas;e.beginPath();for(let t=-50;t<o+50;t+=a)-50===t?e.moveTo(t,s(t)):e.lineTo(t,s(t))}(e,r/50,t/2,50*i.volume,100),e.stroke(),e.fillStyle=`rgb(${u})`,e.beginPath(),e.lineWidth=s,function(e,t,n,r,i=0,a=2*Math.PI){e.beginPath(),e.arc(t,n,r,i,a),e.closePath()}(e,n/2,t/2,i.volume*t/5+s/10),e.stroke(),e.fill()}},rb=[{providerId:"spotifyviz",name:"example by zachwinter",config:nb,externalUrl:"https://github.com/zachwinter/spotify-viz/blob/master/client/example.js"}],ib={id:"spotifyviz",name:"spotify-viz",externalUrl:"https://github.com/zachwinter/spotify-viz/",player:new class extends mf{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.currentVisualizer="",this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-spotifyviz",e.observeBar().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onBar)||void 0===n||n.call(t,e)})),e.observeBeat().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onBeat)||void 0===n||n.call(t,e)})),e.observeSection().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onSection)||void 0===n||n.call(t,e)})),e.observeSegment().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onSegment)||void 0===n||n.call(t,e)})),e.observeTatum().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onTatum)||void 0===n||n.call(t,e)}))}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e||this.animationFrameId||this.render())}appendTo(e){e.append(this.canvas)}load(e){var t,n;e&&(Zv.log("load",e.name),this.currentVisualizer!==e.name&&(this.currentVisualizer=e.name,this.cancelAnimation(),this.config=e.config,this.analyser.volumeSmoothing=null!==(n=null===(t=e.config)||void 0===t?void 0:t.volumeSmoothing)&&void 0!==n?n:100,this.render()))}play(){Zv.log("play"),this.animationFrameId||this.render()}pause(){Zv.log("pause"),this.cancelAnimation()}stop(){Zv.log("stop"),this.cancelAnimation(),this.clear()}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.renderFrame()}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(e=performance.now()){this.renderFrame(e),this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((e=>this.render(e))))}renderFrame(e=performance.now()){var t,n;const r=this.context2D,i=this.canvas.width,a=this.canvas.height,s=this.analyser;null===(n=null===(t=this.config)||void 0===t?void 0:t.onPaint)||void 0===n||n.call(t,{context2D:r,width:i,height:a,now:e,analyser:s})}cancelAnimation(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}}(hv),visualizers:rb,observeVisualizers:()=>Gn(rb)};function ab(){return At.isLight&&At.isFrameLight?At.frameColor:At.isTextLight?At.textColor:At.frameTextColor}const sb=[{providerId:"waveform",name:"wave",config:{onPaint:({context2D:e,width:t,height:n,analyser:r})=>{const i=r.frequencyBinCount,a=new Uint8Array(i),s=t/i;let o=0;e.lineWidth=Math.round(At.fontSize/4),e.clearRect(0,0,t,n),e.strokeStyle=ab(),e.beginPath(),r.getByteTimeDomainData(a);for(let t=0;t<i;t++){const r=a[t]/128*n/2;0===t?e.moveTo(o,r):e.lineTo(o,r),o+=s}e.lineTo(t,n/2),e.stroke()}}},{providerId:"waveform",name:"bars",config:{onPaint:({context2D:e,width:t,height:n,analyser:r})=>{const i=r.frequencyBinCount,a=new Uint8Array(i);r.getByteFrequencyData(a),e.clearRect(0,0,t,n),e.fillStyle=ab();const s=(t-30)/16,o=.0075*n,l=i/16;let c,u=0;for(let t=0;t<i;t+=l){const r=a.slice(t,t+l).reduce(((e,t)=>e+t),0)/l;c=o*r,e.fillRect(u,n-c/2,s,c/2),u+=s+2}}}}],ob=sb,lb={id:"waveform",name:"Waveform",externalUrl:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API",player:new xv(bv),visualizers:ob,observeVisualizers:()=>Gn(ob)},cb=new N("visualizerProviders");function ub(){return[Lv,_v,Kv,Xv,ib,lb]}function db(e){return ub().find((t=>t.id===e))}function mb(e){var t;return(null===(t=db(e))||void 0===t?void 0:t.visualizers)||[]}Rn(ub()).pipe(kn((e=>e.observeVisualizers().pipe(wn((e=>e.length)),fr((e=>0===e)),Re((t=>cb.log(`${e.name} (total=${t})`))))))).subscribe(cb);const hb=new N("visualizerPlayer"),fb=new uf("visualizer-player",ub().map((e=>e.player)),(function(e){return function(e){var t;return null===(t=db(e))||void 0===t?void 0:t.player}(e.providerId)||null}),(function(e,t){e.load(t)}));fb.loop=!0,fb.muted=!0,fb.volume=.07,fb.observeError().subscribe(hb.error);const pb=fb;var vb,bb,yb=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},gb=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const wb=new N("MusicKitPlayer"),Eb="Apple Music player not connected";vb=new WeakMap,bb=new WeakMap;const kb=new class{constructor(e){this.isLoggedIn$=e,this.paused$=new $e(!0),this.duration$=new Oe,this.currentTime$=new Oe,this.ended$=new Oe,this.playing$=new Oe,this.error$=new Oe,this.playerLoaded$=new Oe,this.playerActivated$=new $e(!1),this.src$=new $e(""),this.loadedSrc="",this.isLoggedIn=!1,this.hasPlayed=!1,this.loop=!1,this.autoplay=!1,vb.set(this,!0),bb.set(this,1),this.onPlaybackStateChange=({state:e})=>{switch(e){case MusicKit.PlaybackStates.playing:{const[,,e]=this.src.split(":"),t=this.player.nowPlayingItem;!1===(null==t?void 0:t.isPlayable)&&(null==t?void 0:t.id)===e?(this.error$.next(Error("Unplayable")),this.stop()):this.paused?this.pause():this.playing$.next(void 0);break}case MusicKit.PlaybackStates.ended:this.ended$.next(void 0)}},this.onPlaybackDurationChange=({duration:e})=>{this.duration$.next(e)},this.onPlaybackTimeChange=({currentPlaybackTime:e})=>{this.currentTime$.next(e)},this.onPlaybackError=e=>{this.error$.next(e)};const t=this.element=document.createElement("div");t.hidden=!0,t.className="apple-video",t.id="apple-music-video-container",this.observeIsLoggedIn().pipe(De((e=>e)),Re((()=>{const e=this.player=MusicKit.getInstance(),t=MusicKit.Events;e.addEventListener(t.playbackStateDidChange,this.onPlaybackStateChange),e.addEventListener(t.playbackDurationDidChange,this.onPlaybackDurationChange),e.addEventListener(t.playbackTimeDidChange,this.onPlaybackTimeChange),e.addEventListener(t.mediaPlaybackError,this.onPlaybackError),e.volume=this.muted?0:this.volume,this.playerLoaded$.next(void 0)})),Br(1)).subscribe(wb),this.observeReady().pipe(Un((()=>this.observeIsLoggedIn())),Un((e=>e?this.observePaused():Fn)),Un((e=>e?Fn:this.observeSrc())),Un((e=>{if(e&&e!==this.loadedSrc){if(!this.canPlay(e))return this.error$.next(Error(this.getUnplayableReason(e))),Fn;const[,t,n]=e.split(":"),r=t.replace("library-","").replace(/s$/,"").replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));return Rn(this.player.setQueue({[r]:n})).pipe(Un((()=>(this.loadedSrc=e,this.autoplay?this.safePlay():Fn))),Fr((e=>(this.loadedSrc="",this.error$.next(e),Fn))))}return Fn}))).subscribe(wb),this.observeIsLoggedIn().pipe(fr((e=>e===this.isLoggedIn)),Re((e=>{var t;this.isLoggedIn=e,e||(this.loadedSrc="",this.paused&&!(null===(t=this.player)||void 0===t?void 0:t.isPlaying)||(this.stop(),this.error$.next(Error(Eb))))}))).subscribe(wb),this.observeError().subscribe(wb.error),this.observeError().pipe(De((()=>{var e;return!1===(null===(e=this.player)||void 0===e?void 0:e.isAuthorized)})),Un((()=>li())),Fr((()=>Fn))).subscribe(wb)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e}get muted(){return yb(this,vb,"f")}set muted(e){yb(this,vb,"f")!==e&&(gb(this,vb,e,"f"),this.player&&(this.player.volume=e?0:this.volume))}get volume(){return yb(this,bb,"f")}set volume(e){yb(this,bb,"f")!==e&&(gb(this,bb,e,"f"),this.player&&(this.player.volume=this.muted?0:e))}observeCurrentTime(){return this.currentTime$.pipe(Or())}observeDuration(){return this.duration$.pipe(Or())}observePlaying(){return this.playing$}observeEnded(){return this.ended$}observeError(){return this.error$}appendTo(e){e.appendChild(this.element)}load(e){wb.log("load",{src:e}),this.autoplay&&this.playerActivated$.next(!0),this.src$.next(e),this.autoplay&&this.paused$.next(!1),this.player&&this.isLoggedIn?this.autoplay&&(e===this.loadedSrc?this.safePlay():this.canPlay(e)||this.error$.next(Error(this.getUnplayableReason(e)))):this.autoplay&&this.error$.next(Error(Eb))}play(){wb.log("play"),this.playerActivated$.next(!0),this.paused$.next(!1),this.player&&this.isLoggedIn?this.src===this.loadedSrc?this.safePlay():this.canPlay(this.src)||this.error$.next(Error(this.getUnplayableReason(this.src))):this.isLoggedIn||this.error$.next(Error(Eb))}pause(){var e;wb.log("pause"),this.paused$.next(!0),(null===(e=this.player)||void 0===e?void 0:e.isPlaying)&&this.player.pause()}stop(){wb.log("stop"),this.paused$.next(!0),this.hasPlayed&&this.player.stop()}seek(e){var t;null===(t=this.player)||void 0===t||t.seekToTime(e)}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}get paused(){return this.paused$.getValue()}get src(){return this.src$.getValue()}observeIsLoggedIn(){return this.isLoggedIn$}observePaused(){return this.paused$.pipe(Or())}observeReady(){return this.playerLoaded$.pipe(Un((()=>this.playerActivated$)),De((e=>e)),wn((()=>{})),Br(1))}observeSrc(){return this.src$.pipe(Or())}canPlay(e){return!this.getUnplayableReason(e)}getUnplayableReason(e){var t;const[,n,r]=e.split(":");return"UNPLAYABLE"===r?"Unplayable":/video/i.test(n)&&(null===(t=this.player)||void 0===t?void 0:t.version.startsWith("1"))?"Video playback not supported":""}safePlay(){var e,t,n,r,i;return t=this,n=void 0,i=function*(){try{this.src&&this.src===this.loadedSrc&&!1===(null===(e=this.player)||void 0===e?void 0:e.isPlaying)&&(yield this.player.play(),this.hasPlayed=!0)}catch(e){this.error$.next(e)}},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}))}}(si()),xb=new hf("audio","main"),Sb=new hf("video","main"),Tb=new Vh("main"),Ab=new uf("media-player",[xb,Sb,Tb,kb,od],(function(e){return e?e.src.startsWith("youtube:")?Tb:e.src.startsWith("apple:")?kb:e.src.startsWith("spotify:")?od:e.mediaType===kr.Video?Sb:xb:null}),(function(e,t){if(null==t?void 0:t.unplayable){const n=t.src.split(":");n[2]="UNPLAYABLE",e.load(n.join(":"))}else e.load(function(e){return e?e.blob?URL.createObjectURL(e.blob):e.src||"":""}(t))}));var Pb=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Ib=new N("embyReporting");function Cb(e,t,n,r,i){return Pb(this,void 0,void 0,(function*(){try{const[,,a]=e.src.split(":");yield la.post("Sessions/Playing/Progress",{ItemId:a,IsPaused:n,PositionTicks:Math.floor(1e7*t),PlayMethod:"Transcode",EventName:r},i)}catch(e){Ib.error(e)}}))}function Mb(e,t){const n=new N(`${e.id}Scrobbler`),r=t=>{var n;return!!(null===(n=t.currentItem)||void 0===n?void 0:n.src.startsWith(`${e.id}:`))};e.observeIsLoggedIn().pipe(Un((e=>e?Ef():Fn)),De(r),kn((({currentItem:e})=>function(e,t){return Pb(this,void 0,void 0,(function*(){try{const[,,n]=e.src.split(":");yield la.post("Sessions/Playing",{ItemId:n,IsPaused:!1,PositionTicks:0,PlayMethod:"Transcode"},t)}catch(e){Ib.error(e)}}))}(e,t)))).subscribe(n),e.observeIsLoggedIn().pipe(Un((e=>e?kf():Fn)),De(r),kn((({currentItem:e,currentTime:n})=>function(e,t,n){return Pb(this,void 0,void 0,(function*(){try{const[,,r]=e.src.split(":");yield la.post("Sessions/Playing/Stopped",{ItemId:r,IsPaused:!1,PositionTicks:Math.floor(1e7*t),PlayMethod:"Transcode"},n)}catch(e){Ib.error(e)}}))}(e,n,t)))).subscribe(n),e.observeIsLoggedIn().pipe(Un((e=>e?xf(1e4):Fn)),De(r),De((({currentTime:e})=>e>0)),kn((({currentItem:e,currentTime:n,paused:r})=>Cb(e,n,r,"timeupdate",t)))).subscribe(n),e.observeIsLoggedIn().pipe(Un((e=>e?Ef():Fn)),Un((e=>r(e)?wf().pipe(Or(((e,t)=>e.paused===t.paused)),qu(1),Vn(kf())):Fn)),kn((({currentItem:e,currentTime:n,paused:r})=>Cb(e,n,r,r?"pause":"unpause",t)))).subscribe(n)}Mb(Ua,Xi),Mb(xs,Wa);const Ob=new D("scrobbling"),Nb=new $e(Ob.getJson("noScrobble",{})),$b=new $e(Ob.getJson("options",{}));function zb(e,t){var n;const r=Nb.getValue()[e.id];return!(null!==(n=null==r?void 0:r[t.id])&&void 0!==n?n:t.defaultNoScrobble)}function jb(e,t){const n=Nb.getValue(),r=n[e.id],i=Object.assign(Object.assign({},r),t),a=Object.assign(Object.assign({},n),{[e.id]:i});Ob.setJson("noScrobble",a),Nb.next(a)}function Lb(e){var t;return!!(null===(t=$b.getValue()[e.id])||void 0===t?void 0:t.updateNowPlaying)}function Rb(e,t){const n=$b.getValue(),r=n[e.id],i=Object.assign(Object.assign({},r),t),a=Object.assign(Object.assign({},n),{[e.id]:i});Ob.setJson("options",a),$b.next(a)}const Db={canScrobble:zb,setNoScrobble:jb,canUpdateNowPlaying:Lb,updateOptions:Rb};const Fb=new N("lastfmScrobbler");function _b(e){const t=Bd(e);return!t||Db.canScrobble(eo,t)}Ds().pipe(Un((e=>e?Ef():Fn)),De((()=>Db.canUpdateNowPlaying(eo))),wn((({currentItem:e})=>e)),De(l),De((e=>_b(e))),kn((e=>Bs.updateNowPlaying(e)))).subscribe(Fb),Ds().pipe(Un((e=>e?Cm():Fn)),wn((e=>e.filter((e=>!e.lastfmScrobbledAt)))),cm(1e4),kn((e=>function(e){return t=this,n=void 0,i=function*(){try{if(0===e.length)return;const t=e[0].playedAt+Math.floor(e[0].duration),n=e.at(-1).playedAt,r=new Ks({from:n-30,to:t+30,limit:Ks.maxPageSize}),i=yield Hr(r),a=i.map((e=>Nm(e,30))),[s,o]=d(e,(e=>!_b(e)||a.includes(Nm(e,30))||!!$m(i,e)));if(yield Om(s.map((e=>Object.assign(Object.assign({},e),{lastfmScrobbledAt:-1})))),o.length>0){o.reverse(),o.length=Math.min(o.length,50),yield Bs.scrobble(o);const e=Math.floor(Date.now()/1e3);yield Om(o.map((t=>Object.assign(Object.assign({},t),{lastfmScrobbledAt:e}))))}}catch(e){Fb.error(e)}},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e)))).subscribe(Fb);const Ub=new N("listenbrainzScrobbler");function Vb(e){const t=Bd(e);return!t||Db.canScrobble(vl,t)}yo().pipe(Un((e=>e?Ef():Fn)),De((()=>Db.canUpdateNowPlaying(vl))),wn((({currentItem:e})=>e)),De(l),De((e=>Vb(e))),kn((e=>lo.updateNowPlaying(e)))).subscribe(Ub),yo().pipe(Un((e=>e?Cm():Fn)),wn((e=>e.filter((e=>!e.listenbrainzScrobbledAt)))),cm(1e4),kn((e=>function(e){return t=this,n=void 0,i=function*(){try{if(0===e.length)return;const t=e[0].playedAt+Math.floor(e[0].duration),n=e.at(-1).playedAt,r=new tl({min_ts:n-30,max_ts:t+30,count:tl.maxPageSize}),i=yield Hr(r),a=i.map((e=>Nm(e,30))),[s,o]=d(e,(e=>!Vb(e)||a.includes(Nm(e,30))||!!$m(i,e)));if(yield Om(s.map((e=>Object.assign(Object.assign({},e),{listenbrainzScrobbledAt:-1})))),o.length>0){o.reverse(),o.length=Math.min(o.length,50),yield lo.scrobble(o);const e=Math.floor(Date.now()/1e3);yield Om(o.map((t=>Object.assign(Object.assign({},t),{listenbrainzScrobbledAt:e}))))}}catch(e){Ub.error(e)}},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e)))).subscribe(Ub);var Bb=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Hb=new N("subsonicReporting");function Yb(e,t){const n=new N(`${e.id}Scrobbler`),r=t=>{var n;return!!(null===(n=t.currentItem)||void 0===n?void 0:n.src.startsWith(`${e.id}:`))};e.observeIsLoggedIn().pipe(Un((e=>e?Ef():Fn)),De(r),kn((({currentItem:e})=>function(e,t){return Bb(this,void 0,void 0,(function*(){try{const[,,n]=e.src.split(":");yield Ol.scrobble({id:n,submission:!1},t)}catch(e){Hb.error(e)}}))}(e,t)))).subscribe(n),e.observeIsLoggedIn().pipe(Un((e=>e?kf():Fn)),De(r),kn((({currentItem:e,startedAt:n})=>function(e,t,n){return Bb(this,void 0,void 0,(function*(){try{if(Mm(e.duration,t,Date.now())){const[,,r]=e.src.split(":");yield Ol.scrobble({id:r,time:t,submission:!0},n)}}catch(e){Hb.error(e)}}))}(e,n,t)))).subscribe(n)}Yb(dc,$l);var Kb=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Wb=new N("plexReporting");let qb=null;function Gb(e,t,n){return Kb(this,void 0,void 0,(function*(){try{yield Jb(e,t,n)}catch(e){Wb.error(e)}}))}function Jb(e,t,n,r){return Kb(this,void 0,void 0,(function*(){if(!qb)return void Wb.warn(`Cannot report state (${n}): playQueue not defined`);const[,,i]=e.src.split(":");yield Tc.fetch({path:"/:/timeline",params:{key:i,ratingKey:e.plex.ratingKey,playQueueItemID:String(qb.playQueueSelectedItemID),state:n,hasMDE:"1",time:String(Math.floor(1e3*t)),duration:String(Math.floor(1e3*e.duration))},keepalive:r})}))}const Qb=new N("plexScrobbler"),Xb=e=>{var t;return!!(null===(t=e.currentItem)||void 0===t?void 0:t.src.startsWith("plex:"))};zc().pipe(Un((e=>e?Ef():Fn)),De(Xb),kn((({currentItem:e})=>function(e){return Kb(this,void 0,void 0,(function*(){try{const[,,t]=e.src.split(":");qb=null,qb=yield function(e){return Kb(this,void 0,void 0,(function*(){return Tc.fetchJSON({path:"/playQueues",method:"POST",params:{type:"music",continuous:"0",uri:`server://${vc.server.clientIdentifier}/com.plexapp.plugins.library/${e}`,repeat:"0",own:"1",includeExternalMedia:"1"}})}))}(t),yield Jb(e,0,"playing")}catch(e){Wb.error(e)}}))}(e)))).subscribe(Qb),zc().pipe(Un((e=>e?kf():Fn)),De(Xb),kn((({currentItem:e})=>function(e){return Kb(this,void 0,void 0,(function*(){try{yield Jb(e,0,"stopped",!0),qb=null}catch(e){Wb.error(e)}}))}(e)))).subscribe(Qb),zc().pipe(Un((e=>e?xf(1e4):Fn)),De(Xb),De((({currentTime:e})=>e>0)),kn((({currentItem:e,currentTime:t,paused:n})=>Gb(e,t,n?"paused":"playing")))).subscribe(Qb),zc().pipe(Un((e=>e?Ef():Fn)),Un((e=>Xb(e)?wf().pipe(Or(((e,t)=>e.paused===t.paused)),qu(1),Vn(kf())):Fn)),kn((({currentItem:e,currentTime:t,paused:n})=>Gb(e,t,n?"paused":"playing")))).subscribe(Qb),Yb(zd,kl);const Zb=new N("mediaPlayback/scrobbler");kf().pipe(kn((e=>function(e){var t;return xm(this,void 0,void 0,(function*(){try{const n=e.currentItem;if(!n||!e.startedAt||!e.endedAt)throw Error("Invalid playback state");if(n.title&&(null===(t=n.artists)||void 0===t?void 0:t[0])&&n.duration>30&&Mm(n.duration,e.startedAt,e.endedAt)){const{id:t,lookupStatus:r}=n,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(n,["id","lookupStatus"]);Sm.log("add",{listen:i}),yield Im.items.add(Object.assign(Object.assign({},i),{playedAt:Math.floor(e.startedAt/1e3),lastfmScrobbledAt:0,listenbrainzScrobbledAt:0}))}}catch(e){Sm.error(e)}}))}(e)))).subscribe(Zb);const ey=new N("mediaPlayback"),ty=new D("mediaPlayback"),ny=new D("mediaPlayback","session"),ry=new $e(!1),iy=new Oe;let ay="forward";function sy(){return Oh.observeCurrentItem()}function oy(){return Af.observeCurrentTime()}function ly(){return Af.observeDuration()}function cy(){return Ab.observeEnded()}function uy(){return Ab.observeError()}function dy(){return Af.observePaused()}function my(){return Af.observePlaybackStart()}function hy(){return Af.observePlaybackEnd()}function fy(){return Ab.observePlaying()}function py(e){ey.log("load",{item:e}),Ab.load(e),Ab.autoplay&&Af.play()}function vy(){ey.log("play"),ay="forward",Ty(),Af.play(),Af.paused||(Ab.play(),pb.play())}function by(){ey.log("pause"),Py.stopAfterCurrent=!1,Ty(),Af.pause(),Ab.pause(),pb.pause()}function yy(e){ey.log("seek",{time:b(e)}),Ab.seek(e)}function gy(){ey.log("stop"),Py.stopAfterCurrent=!1,Ty(),Af.stop(),Ab.stop(),pb.stop()}function wy(){ay="backward",Oh.atStart||(Py.stopAfterCurrent=!1,Sy(),Oh.prev())}function Ey(){ay="forward",Oh.atEnd||(Py.stopAfterCurrent=!1,Sy(),Oh.next())}function ky(){Py.stopAfterCurrent=!1,Sy(),Oh.eject()}function xy(){return Cr([Oh.observeCurrentIndex(),Oh.observeSize()]).pipe(wn((([e,t])=>e===t-1)),Or())}function Sy(){Af.paused||!1!==ry.getValue()||(Af.stop(),Ab.stop(),Af.play()),ry.next(!0)}function Ty(){ry.next(!1)}function Ay(e){return t=this,n=void 0,i=function*(){if(!Hd(e)){const t=yield function(e){return Ym(this,void 0,void 0,(function*(){try{if(!e)return;if(Hd(e))return e;t=e,Rm.next({lookupItem:t});const n=yield function(e){return Ym(this,void 0,void 0,(function*(){const t=zm(e);if(t)return t;const{link:n}=e,r=Km(e,["link"]);if(n&&Hd(n))return Object.assign(Object.assign({},r),n);const{artist:i,title:a}=ih(e);if(!i||!a)return;let s=[];const o=Bd(n);return o&&(s=yield Gm(o,e)),0===s.length&&(s=yield Jm(e,!0,o)),0===s.length&&(s=yield Jm(e,!1,o)),Qm(s,e)}))}(e);return n&&([qm]=n.src.split(":")),function(e,t){Dm.next({lookupItem:e,foundItem:t?k(t,e):void 0})}(e,n),n}catch(e){Wm.error(e)}var t}))}(e);if(t)return Object.assign(Object.assign({},e),t)}return e},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}const Py={stopAfterCurrent:!1,get autoplay(){return Ab.autoplay},set autoplay(e){Ab.autoplay=e,pb.autoplay=e},get hidden(){return!1},get loop(){return!1},get muted(){return Ab.muted},set muted(e){ny.setBoolean("muted",e),Ab.muted=e},get paused(){return Af.paused},get volume(){return Ab.volume},set volume(e){ty.setNumber("volume",e),Ab.volume=e},observeCurrentItem:sy,observeCurrentTime:oy,observeDuration:ly,observeEnded:cy,observeError:uy,observePaused:dy,observePlaying:fy,observePlaybackStart:my,observePlaybackEnd:hy,observePlaybackProgress:function(e){return Af.observePlaybackProgress(e)},observePlaybackState:function(){return Af.observePlaybackState()},appendTo:function(e){const t=e.querySelector("#playback");Ab.appendTo(t),pb.appendTo(t)},load:py,play:vy,pause:by,stop:gy,seek:yy,resize:function(e,t){Ab.resize(e,t),pb.resize(e,t)},next:Ey,prev:wy,shuffle:function(){Oh.shuffle()}},Iy=Py;Py.muted=ny.getBoolean("muted"),Py.volume=ty.getNumber("volume",1),Ab.observeCurrentTime().subscribe((e=>Af.setCurrentTime(e))),Ab.observeDuration().subscribe((e=>Af.setDuration(e))),Ab.observePlaying().subscribe((()=>Af.started())),Ab.observeEnded().subscribe((()=>Af.ended())),Ab.observePlaying().subscribe((()=>ay="forward")),Ab.observeEnded().pipe(Wu(xy()),Vn(iy)).subscribe((([,e])=>{e||Py.stopAfterCurrent?gy():Oh.next()})),Ab.observeError().pipe(cm(2e3),Wu(dy(),Oh.observeCurrentIndex().pipe(wn((e=>0===e)),Or()),xy()),Vn(iy)).subscribe((([,e,t,n])=>{e||(n||t&&"backward"===ay?gy():"backward"===ay?Oh.prev():Oh.next())})),Oh.observeSize().pipe(wn((e=>0===e)),Or(),fr((e=>e)),De((e=>e))).subscribe(gy),ry.pipe(cm(250),De((e=>e))).subscribe((()=>{Py.autoplay=!Af.paused,ry.next(!1)})),ry.pipe(Or(),Un((e=>e?Fn:sy())),Or(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),Un((e=>e?Ay(e):Gn(null))),Re(py)).subscribe(ey),ry.pipe(Or(),Un((e=>e?Fn:Oh.observeNextItem())),Or(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),cm(3e3),Un((e=>e?Ay(e):Fn))).subscribe(ey),In(window,"pagehide").subscribe((function(){iy.next(void 0),gy()})),ly().pipe(wn(b),Or()).subscribe(ey.rx("duration")),oy().pipe(De((e=>Math.round(e)%30==0)),wn(b)).subscribe(ey.rx("currentTime")),fy().subscribe(ey.rx("playing")),cy().subscribe(ey.rx("ended")),my().subscribe(ey.rx("playbackStart")),hy().subscribe(ey.rx("playbackEnd"));var Cy=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function My(e){var{icon:t,className:n=""}=e,i=Cy(e,["icon","className"]);return r.createElement("button",Object.assign({},i,{className:`icon-button icon-button-${t} ${n}`,type:"button",onMouseDown:w,onMouseUp:g}),r.createElement($t,{name:t}))}var Oy=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Ny(e){var{className:t="",children:n}=e,i=Oy(e,["className","children"]);return r.createElement("div",Object.assign({},i,{className:`icon-buttons ${t}`}),n)}function $y({children:e,onClose:t,x:n,y:i,align:a="left"}){const s=(0,r.useRef)(null),o=(0,r.useRef)(document.activeElement),[l,c]=(0,r.useState)({visibility:"hidden"}),[u,d]=(0,r.useState)([]),[m,h]=(0,r.useState)("");(0,r.useEffect)((()=>{const e={},t=s.current,r=Array.from(t.querySelectorAll("button"));"right"===a||n+t.offsetWidth>document.body.clientWidth?e.left=n-t.offsetWidth+"px":e.left=`${n}px`,i+t.offsetHeight>document.body.clientHeight?e.top=i-t.offsetHeight+"px":e.top=`${i}px`,d(r),c(e)}),[a,n,i]),(0,r.useEffect)((()=>{const e=u.find((e=>!e.disabled));null==e||e.focus(),h((null==e?void 0:e.id)||"")}),[u]),(0,r.useEffect)((()=>{const e=_n(sn(0).pipe(Un((()=>In(document,"mousedown",{capture:!0}).pipe(De((e=>!s.current.contains(e.target))))))),In(document,"keydown",{capture:!0}).pipe(De((e=>"Escape"===e.code||"Tab"===e.code))),In(window,"blur")).subscribe((()=>{var e;null===(e=o.current)||void 0===e||e.focus(),t()}));return()=>e.unsubscribe()}),[t]);const f=(0,r.useCallback)((e=>{var n;let r=e.target;for(;r&&"BUTTON"!==r.nodeName;)r=r.parentElement;(null==r?void 0:r.value)&&!r.disabled&&(null===(n=o.current)||void 0===n||n.focus(),t(r.value))}),[t]),p=(0,r.useCallback)((e=>{let t=u.indexOf(document.activeElement);"ArrowDown"===e.code?(e.stopPropagation(),t++):"ArrowUp"===e.code&&(e.stopPropagation(),t--),t=Math.min(Math.max(t,0),u.length-1);const n=u[t];n&&!n.disabled&&(n.focus(),h(n.id))}),[u]),v=(0,r.useCallback)((e=>{let t=e.target;for(;t&&"BUTTON"!==t.nodeName;)t=t.parentElement;t&&!t.disabled&&(t.focus(),h(t.id))}),[]);return r.createElement("ul",{className:"popup-menu",tabIndex:-1,role:"menu","aria-label":"Actions","aria-activedescendant":m,style:l,onClick:f,onContextMenu:y,onKeyDown:p,onMouseOver:v,ref:s},e)}var zy=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function jy(e){var{className:t="",label:n,acceleratorKey:i="",role:a="menuitem"}=e,s=zy(e,["className","label","acceleratorKey","role"]);const o=(0,r.useId)();return r.createElement("li",{className:`popup-menu-item ${t}`},r.createElement("button",Object.assign({},s,{id:o,role:a,tabIndex:-1,onMouseDown:w,onMouseUp:g}),r.createElement("span",{className:"popup-menu-item-label"},n),r.createElement("span",{className:"popup-menu-item-accelerator-key"},i)))}var Ly=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Ry(e){var{className:t="",checked:n=!1}=e,i=Ly(e,["className","checked"]);return r.createElement(jy,Object.assign({},i,{className:`popup-menu-item-checkbox ${t}`,role:"menuitemcheckbox","aria-checked":n}))}function Dy(){return r.createElement("li",{className:"popup-menu-separator",role:"separator"})}var Fy=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function _y(e,t,n,a){return Fy(this,void 0,void 0,(function*(){return new Promise(((s,o)=>{const l=document.getElementById("popup"),c=document.createElement("div"),u=(0,i.s)(c);try{const i=e=>{u.unmount(),c.remove(),s(e)};l.append(c),u.render(r.createElement(e,{x:t,y:n,align:a,onClose:i}))}catch(e){u.unmount(),c.remove(),o(e)}}))}))}var Uy=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},Vy=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function By(e,t,n,i,a="left"){return Uy(this,void 0,void 0,(function*(){return _y((n=>r.createElement(Hy,Object.assign({},n,{items:e,isContextMenu:t}))),n,i,a)}))}function Hy(e){var{items:t,isContextMenu:n}=e,i=Vy(e,["items","isContextMenu"]);const a=t[0],s=1===t.length&&!!a,o=t.every((e=>e.itemType===wr.Media||e.itemType===wr.Album));return r.createElement($y,Object.assign({},i),o?r.createElement(Yy,null):null,n&&s?r.createElement(Ky,{item:a}):null,s?r.createElement(jy,{label:"Info...",value:yr.Info,acceleratorKey:`${K.ctrlKeyStr}+I`,key:yr.Info}):null)}function Yy(){return r.createElement(r.Fragment,null,r.createElement(jy,{label:"Queue",value:yr.Queue,acceleratorKey:"Enter",key:yr.Queue}),r.createElement(jy,{label:"Play next",value:yr.PlayNext,acceleratorKey:"Shift+Enter",key:yr.PlayNext}),r.createElement(jy,{label:"Play now",value:yr.PlayNow,acceleratorKey:`${K.ctrlKeyStr}+Enter`,key:yr.PlayNow}),r.createElement(Dy,null))}function Ky({item:e}){const t=Bd(e);return r.createElement(r.Fragment,null,e.itemType===wr.Playlist&&(null==t?void 0:t.createSourceFromPin)?r.createElement(jy,{label:e.isPinned?"Unpin":"Pin",value:e.isPinned?yr.Unpin:yr.Pin,key:e.isPinned?yr.Unpin:yr.Pin}):null,void 0!==e.rating&&(null==t?void 0:t.canRate(e,!0))?r.createElement(jy,{label:e.rating?Zy(t,yr.Unlike):Zy(t,yr.Like),value:e.rating?yr.Unlike:yr.Like,key:e.rating?yr.Unlike:yr.Like}):null,!1===e.inLibrary&&(null==t?void 0:t.canStore(e,!0))?r.createElement(jy,{label:Zy(t,yr.AddToLibrary),value:yr.AddToLibrary,key:yr.AddToLibrary}):null,"apple"!==(null==t?void 0:t.id)&&!0===e.inLibrary&&(null==t?void 0:t.canStore(e,!0))?r.createElement(jy,{label:Zy(t,yr.RemoveFromLibrary),value:yr.RemoveFromLibrary,key:yr.RemoveFromLibrary}):null,r.createElement(Dy,null))}function Wy({value:e=0,tabIndex:t=0,onChange:n}){const[i,a]=(0,r.useState)((()=>Math.max(e-1,0))),[s,o]=(0,r.useState)(-1),[l,c]=(0,r.useState)(!1),u=(0,r.useCallback)((t=>{switch(t.key){case"ArrowLeft":if(0===i&&1===e)null==n||n(0);else if(i>0){const e=i-1;a(e),null==n||n(e+1)}break;case"ArrowRight":if(0===i&&0===e)null==n||n(1);else if(i<4){const e=i+1;a(e),null==n||n(e+1)}}}),[i,e,n]);return r.createElement("div",{className:"star-rating",tabIndex:t,onKeyDown:u,onMouseDown:w,onMouseUp:g,onMouseLeave:()=>o(-1)},r.createElement("button",{className:"star-rating-button "+(0===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(0),1===e?(c(!0),null==n||n(0)):null==n||n(1)},onMouseEnter:()=>{o(0),c(!1)}},-1===s&&e>0||0===s&&!l||s>0?"★":"☆"),r.createElement("button",{className:"star-rating-button "+(1===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(1),2===e?null==n||n(1):null==n||n(2)},onMouseEnter:()=>o(1)},-1===s&&e>1||s>=1?"★":"☆"),r.createElement("button",{className:"star-rating-button "+(2===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(2),3===e?null==n||n(2):null==n||n(3)},onMouseEnter:()=>o(2)},-1===s&&e>2||s>=2?"★":"☆"),r.createElement("button",{className:"star-rating-button "+(3===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(3),4===e?null==n||n(3):null==n||n(4)},onMouseEnter:()=>o(3)},-1===s&&e>3||s>=3?"★":"☆"),r.createElement("button",{className:"star-rating-button "+(4===i?"selected":""),type:"button",tabIndex:-1,onClick:()=>{a(4),5===e?null==n||n(4):null==n||n(5)},onMouseEnter:()=>o(4)},-1===s&&e>4||4===s?"★":"☆"))}var qy=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const Gy={[yr.AddToLibrary]:"plus",[yr.RemoveFromLibrary]:"tick-fill",[yr.Rate]:"star",[yr.Like]:"heart",[yr.Unlike]:"heart-fill"},Jy={[yr.AddToLibrary]:"Add to library",[yr.RemoveFromLibrary]:"Remove from library",[yr.Rate]:"Rate",[yr.Like]:"Like",[yr.Unlike]:"Unlike"};function Qy({item:e,inline:t}){const n=Bd(e),i=t?-1:void 0,a=(0,r.useCallback)((()=>qy(this,void 0,void 0,(function*(){e.itemType===wr.Playlist&&(e.isPinned?yield Lg(yr.Unpin,[e]):yield Lg(yr.Pin,[e]))}))),[e]),s=(0,r.useCallback)((()=>qy(this,void 0,void 0,(function*(){e.rating?yield Lg(yr.Unlike,[e]):yield Lg(yr.Like,[e])}))),[e]),o=(0,r.useCallback)((()=>qy(this,void 0,void 0,(function*(){e.inLibrary?yield Lg(yr.RemoveFromLibrary,[e]):yield Lg(yr.AddToLibrary,[e])}))),[e]),l=(0,r.useCallback)((t=>qy(this,void 0,void 0,(function*(){const n=t.target.getBoundingClientRect(),r=yield By([e],!1,n.right,n.bottom,"right");r&&(yield Lg(r,[e]))}))),[e]),c=(0,r.useCallback)((t=>qy(this,void 0,void 0,(function*(){yield Lg(yr.Rate,[e],t)}))),[e]);return r.createElement(Ny,null,t?r.createElement(My,{icon:"menu",title:"More...",tabIndex:i,onClick:l,key:"menu"}):null,e.itemType===wr.Playlist&&(null==n?void 0:n.createSourceFromPin)?r.createElement(My,{icon:e.isPinned?"pin-fill":"pin",title:e.isPinned?"Unpin":"Pin to sidebar",tabIndex:i,onClick:a,key:"pin"}):null,n?r.createElement(r.Fragment,null,void 0!==e.rating&&(null==n?void 0:n.canRate(e,t))?"plex"===n.id?r.createElement(Wy,{value:e.rating,tabIndex:i,onChange:c}):r.createElement(My,{icon:e.rating?Xy(n,yr.Unlike):Xy(n,yr.Like),title:e.rating?Zy(n,yr.Unlike):Zy(n,yr.Like),tabIndex:i,onClick:s,key:"rate"}):null,void 0!==e.inLibrary&&(null==n?void 0:n.canStore(e,t))?r.createElement(My,{icon:e.inLibrary?Xy(n,yr.RemoveFromLibrary):Xy(n,yr.AddToLibrary),title:e.inLibrary?Zy(n,yr.RemoveFromLibrary):Zy(n,yr.AddToLibrary),tabIndex:i,disabled:"apple"===n.id&&e.inLibrary,onClick:o,key:"store"}):null):null)}function Xy(e,t){var n;return(null===(n=e.icons)||void 0===n?void 0:n[t])||Gy[t]}function Zy(e,t){var n;return(null===(n=e.labels)||void 0===n?void 0:n[t])||Jy[t]}var eg=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const tg=new N("musicbrainz/coverart");class ng extends wt.ZP{constructor(){super("ampcast/musicbrainz/coverart"),this.version(2).stores({items:"&mbid, [album+artist], thumbnails"})}}const rg=new ng;function ig(e){switch(e){case"small":return 250;case"large":return 500;default:return Number(e)||0}}function ag({item:e,size:t,className:n=""}){const[i,a]=(0,r.useState)(!1),[s,o]=(0,r.useState)((()=>e.thumbnails)),l=!!(null==s?void 0:s.length),c=l?function(e,t=240){if(1===e.length)return e[0];let n=e.filter((e=>og(e)<1.34));return 0===n.length&&(n=e.filter((e=>og(e)<1.5)),0===n.length&&(n=e)),t*=window.devicePixelRatio||1,n.sort(((e,n)=>Math.abs(e.height-t)-Math.abs(n.height-t))),n[0]}(s,t):void 0,u=c?sg(c):"",d=function(e){switch(e.itemType){case wr.Artist:return"artist";case wr.Album:return"album";case wr.Media:return e.mediaType===kr.Video?"video":"audio";case wr.Playlist:return"playlist";case wr.Folder:return"folder"}}(e);(0,r.useEffect)((()=>o(e.thumbnails)),[e.thumbnails]),(0,r.useEffect)((()=>{if(!l){if(e.itemType===wr.Media){const t=zm(e);if(t&&t.thumbnails)return void o(t.thumbnails)}const t=Rn(function(e){var t;return eg(this,void 0,void 0,(function*(){if(!e||e.itemType!==wr.Album&&e.itemType!==wr.Media)return;let n=!1;const r=e.release_mbid;if(r){const e=yield rg.items.get(r);if(n=!!e,null==e?void 0:e.thumbnails)return e.thumbnails}let i,a;if(e.itemType===wr.Album?(i=e.title,a=e.artist):(i=e.album,a=e.albumArtist||(null===(t=e.artists)||void 0===t?void 0:t[0])),i&&a){const e=yield rg.items.get({album:i,artist:a});if(e)return e.thumbnails}if(r&&!n)try{const e=yield function(e){return eg(this,void 0,void 0,(function*(){const t=yield fetch(`https://coverartarchive.org/release/${e}`);if(!t.ok)throw t;return t.json()}))}(r),t=e.images.filter((e=>e.front&&e.approved))[0],n=t?Object.keys(t.thumbnails).filter((e=>0!==ig(e))).map((e=>({url:t.thumbnails[e],width:ig(e),height:ig(e)}))):[];return yield rg.items.put(0===n.length?{mbid:r}:{mbid:r,album:i,artist:a,thumbnails:n}),n}catch(e){404===e.status?yield rg.items.put({mbid:r}):tg.error(e)}}))}(e)).subscribe(o);return()=>t.unsubscribe()}}),[l,e]);const m=(0,r.useCallback)((()=>a(!0)),[]);return r.createElement("figure",{className:`cover-art ${n}`},u&&!i?r.createElement("img",{className:"cover-art-image",src:u,alt:`${e.title}: Cover art`,onError:m}):d?r.createElement($t,{className:"cover-art-image",name:d}):null)}function sg(e){return Fd().reduce(((e,t)=>{var n,r;return null!==(r=null===(n=null==t?void 0:t.getThumbnailUrl)||void 0===n?void 0:n.call(t,e))&&void 0!==r?r:e}),(null==e?void 0:e.url)||"")}function og({width:e,height:t}){return e/t}function lg({className:e,children:t}){const n=(0,r.useRef)(null),[i,a]=(0,r.useState)(0),s=(0,r.useCallback)((({scrollHeight:e})=>a(e)),[]);return r.createElement("div",{className:`text-box ${e}`,style:{height:`${i}px`},ref:n},r.createElement("div",{style:{position:"relative",height:"100%"}},r.createElement(Wn,{onResize:s},t)))}const cg=new N("Media/useCurrentItem");var ug=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function dg(e){const t=function(e){const[t,n]=(0,r.useState)(e),[i,a]=(0,r.useState)("");return(0,r.useEffect)((()=>{if(i!==e.src){const t=Bd(e);if(null==t?void 0:t.getMetadata){const r=Rn(t.getMetadata(e)).pipe(Re((t=>{a(e.src),n(Object.assign(Object.assign({},e),t))}))).subscribe(cg);return()=>r.unsubscribe()}a(e.src)}}),[e,i]),(0,r.useEffect)((()=>{const e=zr.observe().pipe(Re((e=>{for(const{match:r,values:i}of e)if(r(t)){n(Object.assign(Object.assign({},t),i));break}}))).subscribe(cg);return()=>e.unsubscribe()}),[t]),t}(e.item);if(e.debug)return r.createElement(Ig,{item:t});switch(t.itemType){case wr.Media:return r.createElement(mg,{item:t});case wr.Artist:return r.createElement(fg,{item:t});case wr.Album:return r.createElement(hg,{item:t});case wr.Playlist:return r.createElement(pg,{item:t});case wr.Folder:return r.createElement(vg,{item:t})}}function mg({item:e}){var t;return r.createElement("article",{className:"media-info media-item-info"},r.createElement("div",{className:"media-info-main"},r.createElement(Pg,{item:e}),r.createElement(bg,{title:e.title}),r.createElement(gg,{artist:null===(t=e.artists)||void 0===t?void 0:t.join(", ")}),r.createElement(kg,{album:e.album,year:e.year}),r.createElement(xg,{album:e.album,disc:e.disc,track:e.track}),r.createElement(wg,{owner:e.owner,src:e.src}),r.createElement(Qy,{item:e})),r.createElement(yg,{description:e.description}),r.createElement(Eg,{url:e.externalUrl,src:e.src}))}function hg({item:e}){return r.createElement("article",{className:"media-info album-info"},r.createElement("div",{className:"media-info-main"},r.createElement(Pg,{item:e}),r.createElement(bg,{title:e.title}),r.createElement(gg,{artist:e.artist}),r.createElement(Sg,{year:e.year}),r.createElement(Qy,{item:e})),r.createElement(yg,{description:e.description}),r.createElement(Eg,{url:e.externalUrl,src:e.src}))}function fg({item:e}){return r.createElement("article",{className:"media-info artist-info"},r.createElement("div",{className:"media-info-main"},r.createElement(Pg,{item:e}),r.createElement(bg,{title:e.title}),r.createElement(Tg,{genres:e.genres}),r.createElement(Ag,{country:e.country}),r.createElement(Qy,{item:e})),r.createElement(yg,{description:e.description}),r.createElement(Eg,{url:e.externalUrl,src:e.src}))}function pg({item:e}){return r.createElement("article",{className:"media-info playlist-info"},r.createElement("div",{className:"media-info-main"},r.createElement(Pg,{item:e}),r.createElement(bg,{title:e.title}),r.createElement(wg,{owner:e.owner,src:e.src}),r.createElement(Tg,{genres:e.genres}),r.createElement(Qy,{item:e})),r.createElement(yg,{description:e.description}),r.createElement(Eg,{url:e.externalUrl,src:e.src}))}function vg({item:e}){return r.createElement("article",{className:"media-info folder-info"},r.createElement("div",{className:"media-info-main"},r.createElement(Pg,{item:e}),r.createElement(bg,{title:e.title})))}function bg({title:e}){return r.createElement("h3",{className:"title"},e||"(no title)")}function yg({description:e}){const t=null==e?void 0:e.trim().split(/[\n\r]+/);return(null==t?void 0:t.length)?r.createElement(lg,{className:"blurb"},t.map(((e,t)=>r.createElement("p",{key:t},e)))):null}function gg({artist:e}){return e?r.createElement("h4",{className:"artist"},"By: ",e):null}function wg({src:e,owner:t}){if(!t||!t.name)return null;const[n]=e.split(":"),i="youtube"===n?"Channel":"Curator";return r.createElement("p",{className:"owner"},i,":"," ",t.url?r.createElement(uo,{href:t.url},t.name):t.name)}function Eg({src:e,url:t=""}){let[n]=e.split(":"),i=n;switch(n){case"musicbrainz":i="MusicBrainz";break;case"listenbrainz":/musicbrainz/.test(t)?(i="MusicBrainz",n="musicbrainz"):i="ListenBrainz";break;case"blob":case"file":i="local file system";break;default:{const e=Vd(n);e&&(i=e.name)}}return r.createElement("p",{className:"external-view"},r.createElement($t,{name:n}),t?r.createElement(uo,{href:t},"View on ",i):r.createElement("span",{className:"external-provider"},"Provided by ",i))}function kg({album:e,year:t}){return e&&t?r.createElement("h4",{className:"album"},"From: ",e," (",t,")"):e?r.createElement("h4",{className:"album"},"From: ",e):t?r.createElement("h4",{className:"album"},"Year: ",t):null}function xg({album:e,disc:t=1,track:n}){return e&&n?r.createElement("p",{className:"track"},"Track: ",n,t>1?` (Disc ${t})`:""):null}function Sg({year:e}){return e?r.createElement("p",{className:"year"},"Year: ",e):null}function Tg({genres:e}){return e?r.createElement("p",{className:"genre"},"Genre: ",e.join(", ")):null}function Ag({country:e}){return e?r.createElement("p",{className:"country"},"Country: ",e):null}function Pg(e){return r.createElement("div",{className:"thumbnail"},r.createElement(ag,Object.assign({},e)))}function Ig(e){const t=e.item,{pager:n,parent:i}=t,a=ug(t,["pager","parent"]);return r.createElement("article",{className:"media-info debug"},r.createElement("pre",null,JSON.stringify(a,void 0,2)),r.createElement(Eg,{url:a.externalUrl,src:a.src}))}function Cg(e){const[t,n]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{if(e.current){const e=document.querySelectorAll(".focus");for(const t of e)t.classList.toggle("focus",!1)}const t=In(document,"keydown",{capture:!0}).subscribe((t=>{var r;t.repeat||(t.ctrlKey&&t.shiftKey&&"Digit8"===t.code?n((e=>!e)):t[K.ctrlKey]&&!t.shiftKey&&"KeyI"===t.code&&(t.preventDefault(),null===(r=e.current)||void 0===r||r.close()))}));return()=>t.unsubscribe()}),[e]),{debug:t}}var Mg=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},Og=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Ng(e){return Mg(this,void 0,void 0,(function*(){yield Dt((t=>r.createElement($g,Object.assign({},t,{item:e}))))}))}function $g(e){var{item:t}=e,n=Og(e,["item"]);const i=(0,r.useRef)(null),{debug:a}=Cg(i),s=function(e){switch(e.itemType){case wr.Playlist:return"Playlist info";case wr.Album:return"Album info";case wr.Artist:return"Artist info";case wr.Folder:return"Folder info";default:return"Media info"}}(t);return r.createElement(Lt,Object.assign({},n,{className:"media-info-dialog",title:s,ref:i}),r.createElement("form",{method:"dialog"},r.createElement(dg,{item:t,debug:a}),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",null,"Close"))))}var zg=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const jg=new N("ampcast/actions");function Lg(e,t,n){return zg(this,void 0,void 0,(function*(){const r=t[0];if(!r)return;const i=r.itemType;switch(e){case yr.PlayNow:case yr.PlayNext:case yr.Queue:!function(e,t){zg(this,void 0,void 0,(function*(){const n=t[0];if(!n)return;const r=n.itemType;if(r===wr.Media||r===wr.Album)switch(e){case yr.PlayNow:case yr.PlayNext:e===yr.PlayNow&&(Iy.autoplay=!0),r===wr.Media?yield Oh.insert(t):yield Oh.insert(n),e===yr.PlayNow&&Oh.next();break;case yr.Queue:r===wr.Media?yield Oh.add(t):yield Oh.add(n)}}))}(e,t);break;case yr.Like:case yr.Unlike:case yr.Rate:case yr.AddToLibrary:case yr.RemoveFromLibrary:!function(e,t,n){zg(this,void 0,void 0,(function*(){if(t)try{switch(e){case yr.Like:yield Vr.rate(t,1);break;case yr.Unlike:yield Vr.rate(t,0);break;case yr.Rate:"number"==typeof n&&(yield Vr.rate(t,n));break;case yr.AddToLibrary:yield Rr.store(t,!0);break;case yr.RemoveFromLibrary:yield Rr.store(t,!1)}}catch(r){jg.warn("Failed to perform action:",{action:e,item:t,payload:n}),jg.error(r)}}))}(e,r,n);break;case yr.Pin:i===wr.Playlist&&(yield xi.pin(t));break;case yr.Unpin:i===wr.Playlist&&(yield xi.unpin(t));break;case yr.Info:yield Ng(r)}}))}let Rg=null,Dg="none";const Fg={getData:function(e){return"#globalDrag"===e.dataTransfer.getData("text")?Rg:null},getEffect:function(e){return"#globalDrag"===e.dataTransfer.getData("text")?Dg:"none"},set:function(e,t,n){e.dataTransfer.setData("text","#globalDrag"),e.dataTransfer.effectAllowed=n,Rg=t,Dg=n},unset:function(){Rg=null,Dg="none"}};function _g(e){const t=(0,r.useRef)();return(0,r.useEffect)((()=>{t.current=e}),[e]),t.current}function Ug({style:e,title:t}){return r.createElement("div",{className:"list-view-cell",style:e},t)}function Vg({col:e,onResize:t}){const[n,i]=(0,r.useState)(-1),[a,s]=(0,r.useState)(0),o=-1!==n,{width:l,index:c}=e,u=(0,r.useCallback)((e=>{e.preventDefault(),0===e.button&&(i(e.screenX),s(l))}),[l]);(0,r.useEffect)((()=>t(e.index,l)),[e.index,l,t]);const d=(0,r.useCallback)((e=>{t(c,Math.max(20,a+(e.screenX-n)))}),[n,a,c,t]),m=(0,r.useCallback)((()=>{i(-1),s(0)}),[]);return(0,r.useEffect)((()=>{if(o)return document.documentElement.style.cursor="col-resize",document.body.classList.add("dragging"),document.addEventListener("mouseup",m),document.addEventListener("mousemove",d),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",d)}}),[o,d,m]),r.createElement("span",{className:"column-resizer",onMouseDown:u,style:{left:e.left+l-4+"px"}})}function Bg({width:e,height:t,cols:n,sizeable:i,onColumnResize:a}){const s=(0,r.useCallback)(((e,t)=>{null==a||a(e,t)}),[a]);return r.createElement("header",{className:"list-view-head",style:{width:`${e}px`}},r.createElement("div",{className:"list-view-row",style:{width:`${e}px`,height:`${t}px`}},n.map((e=>r.createElement(Ug,Object.assign({},e,{key:e.index}))))," ",i&&n.map((e=>r.createElement(Vg,{col:e,onResize:s,key:e.index})))))}function Hg({rowIndex:e,col:{className:t="",render:n,style:i},item:a}){return r.createElement("div",{className:`list-view-cell ${t}`,style:i},n(a,e))}function Yg({item:e,className:t,id:n,rowIndex:i,height:a,selected:s,cols:o,setSize:l,dragIndex:c}){const u=`${t} ${s?"selected selected-text":""} ${c===l?i===l-1?"drag-over-last":"":c===i?"drag-over":""}`;return r.createElement("li",{role:"option",className:`list-view-row ${u}`,id:n,"aria-selected":s,"aria-setsize":l,"aria-posinset":i+1,style:{height:`${a}px`,transform:`translateY(${a*i}px)`}},o.map((t=>r.createElement(Hg,{rowIndex:i,col:t,item:e,key:t.index}))))}function Kg({listViewId:e,title:t,width:n,height:i,rowHeight:a,cols:s,items:o,itemKey:l,itemClassName:c,selectedId:u,selectedIds:d,scrollTop:m,overScan:h=2,draggable:f,dragIndex:p,multiple:v=!1}){const b=(0,r.useRef)(null),y=o.length,g=Math.floor(m/a),w=Math.floor(i/a),E=Math.max(0,g-h),k=Math.min(y,w+2*h),x=o.slice(E,E+k);return r.createElement("ol",{role:"listbox",className:"list-view-body",draggable:f,style:{width:n?`${n}px`:void 0},"aria-label":t,"aria-multiselectable":v,"aria-activedescendant":u,ref:b},x.map(((t,n)=>r.createElement(Yg,{className:c(t),id:`${e}-${t[l]}`,rowIndex:E+n,height:a,selected:!!t&&d.includes(t[l]),cols:s,item:t,setSize:y,dragIndex:p,key:t[l]}))))}const Wg=[],qg=()=>"",Gg=["ArrowUp","ArrowDown","PageUp","PageDown"];function Jg({items:e=[],itemKey:t,title:n,itemClassName:i=qg,layout:a,className:s="",selectedIndex:o=-1,draggable:l,droppable:c,droppableTypes:u=[],multiple:d,reorderable:m,disabled:h,onClick:f,onDoubleClick:p,onContextMenu:v,onDrop:b,onDelete:y,onEnter:g,onInfo:w,onRowIndexChange:E,onScrollIndexChange:k,onPageSizeChange:x,onSelect:S,onMove:T,listViewRef:A}){const P=(0,r.useId)(),I=(0,r.useRef)(null),C=(0,r.useRef)(null),M=(0,r.useRef)(null),O=(0,r.useRef)(null),N=(0,r.useRef)(null),$="details"===a.view&&a.showTitles,z="details"===a.view&&a.sizeable,[j,L]=(0,r.useState)(-1),[R,D]=(0,r.useState)(0),[F,_]=(0,r.useState)(0),[U,V]=(0,r.useState)(0),[B,H]=(0,r.useState)(0),[Y,W]=function(e){const[t,n]=(0,r.useState)([]),i="details"===e.view&&e.sizeable;(0,r.useEffect)((()=>{const t="details"===e.view,r=t&&e.sizeable;n(e.cols.reduce(((e,n,i)=>{const a=e[i-1],s=a?a.left+a.width:0,{title:o="",className:l="",align:c="left",width:u=200}=n,d=r?{left:`${s}px`,width:`${u}px`,textAlign:c}:t?{textAlign:c}:{};return e.push(Object.assign(Object.assign({},n),{title:o,className:l,align:c,index:i,left:s,width:u,style:d})),e}),[]))}),[e]);const a=(0,r.useCallback)(((e,r)=>{i&&t[e].width!==r&&n(t.reduce(((t,n,i)=>{if(i>=e){const a=t[i-1],s=a?a.left+a.width:0,o=i===e?r:n.width,l={left:`${s}px`,width:`${o}px`,textAlign:n.align};t.push(Object.assign(Object.assign({},n),{left:s,width:o,style:l}))}else t.push(n);return t}),[]))}),[t,i]);return[t,a]}(a),q=(0,r.useMemo)((()=>Y.reduce(((e,t)=>e+t.width),0)),[Y]),G=B?Math.max(Math.floor(F/B),1)-($?1:0):0,J=e.length,{selectedItems:Q,selectAll:X,selectAt:Z,selectRange:ee,toggleSelectionAt:te}=function(e,t,n){const[i,a]=(0,r.useState)([]),s=_g(e);(0,r.useEffect)((()=>{if(e!==s){const s=e.filter((e=>i.some((n=>n[t]===e[t]))));if(o=s,(r=i).length!==o.length||!r.every(((e,t)=>o[t]===e))){const t=e.length;if(t>0&&0===s.length)if(n<t){const t=e[n];a(t?[t]:[])}else{const n=e[t-1];a(n?[n]:[])}else a(s)}}var r,o}),[s,e,i,t,n]);const o=(0,r.useCallback)((()=>{a(e.slice())}),[e]),l=(0,r.useCallback)((t=>{const n=e[t];a(n?[n]:[])}),[e]),c=(0,r.useCallback)(((t,n)=>{const r=Math.min(t,n),i=Math.max(t,n),s=e.slice(r,i+1);a(s)}),[e]),u=(0,r.useCallback)(((t,n)=>{const r=e[t],s=i.includes(r);s!==n&&a(s?i.filter((e=>e!==r)):e.filter((e=>i.includes(e)||e===r)))}),[e,i]);return{selectedItems:i,selectAll:o,selectAt:l,selectRange:c,toggleSelectionAt:u}}(e,t,j),ne=Q.length>0,re=Ct(),[ie,ae]=(0,r.useState)(-1),[se,oe]=(0,r.useState)(-1),[le,ce]=(0,r.useState)(-1),ue=0===J,de=-1!==le,me=B?Math.floor(R/B):0,he=Jn(Gg)&&!(0===j||j===J-1),fe=_g(e),[pe,ve]=(0,r.useState)((()=>Q)),[be,ye,ge,we]=l?Q:[],Ee=e[j]?`${P}-${e[j][t]}`:"",ke=(0,r.useMemo)((()=>Q.map((e=>e[t]))),[Q,t]),xe=(0,r.useCallback)((()=>C.current.focus()),[]),Se=(0,r.useCallback)((e=>{const t=M.current,n=Math.floor(R/B);if(e>=n+G-1){const n=(J+($?1:0))*B,r=J-G-1,i=Math.min(J-1,e+1)-G,a=i===r?n:i*B;t.scrollTo({top:a})}else if(e<=n){const n=Math.max(0,e-1)*B;t.scrollTo({top:n})}}),[R,B,G,$,J]),Te=(0,r.useCallback)((e=>{Se(e),Z(e),L(e)}),[Se,Z]);(0,r.useEffect)((()=>{I.current={focus:xe,scrollIntoView:Te,scrollTo:Se,selectAll:X,selectAt:Z},A&&(A.current=Object.assign(A.current||{},I.current))}),[A,xe,Te,Se,X,Z]),(0,r.useEffect)((()=>{var e;null===(e=I.current)||void 0===e||e.scrollIntoView(o)}),[o]),(0,r.useEffect)((()=>null==E?void 0:E(j)),[j,E]),(0,r.useEffect)((()=>null==k?void 0:k(me)),[me,k]),(0,r.useEffect)((()=>null==x?void 0:x(G)),[G,x]),(0,r.useEffect)((()=>null==S?void 0:S(pe)),[pe,S]),(0,r.useEffect)((()=>L(Math.min(J-1,j))),[J,j]),(0,r.useEffect)((()=>{if(fe&&e.length!==fe.length){const n=fe[j];if(n){const r=e.findIndex((e=>e&&e[t]===n[t]));-1!==r&&L(r)}}}),[e,fe,j,t]),(0,r.useEffect)((()=>{he||ve(Q)}),[Q,he]),(0,r.useEffect)((()=>{ue&&L(-1)}),[ue]),(0,r.useEffect)((()=>{!d&&Q.length>1&&Z(j)}),[d,j,Q,Z]);const Ae=(0,r.useCallback)((t=>{switch(t.code){case"Enter":t.stopPropagation(),t.repeat||null==g||g(Q,t[K.ctrlKey],t.shiftKey);break;case"Delete":t.stopPropagation(),null==y||y(Q);break;case"KeyI":if(t.stopPropagation(),t.preventDefault(),t[K.ctrlKey]&&!t.shiftKey&&!t.repeat){null==w||w(Q);break}break;case"KeyA":t[K.ctrlKey]&&!t.shiftKey&&(t.preventDefault(),t.stopPropagation(),t.repeat||X());break;case"ShiftLeft":case"ShiftRight":t.repeat||ae(j);break;case"Space":t.preventDefault(),t.repeat||(t[K.ctrlKey]?(t.stopPropagation(),te(j)):Q.includes(e[j])||(t.stopPropagation(),te(j,!0)));break;default:{const n=e.length,r=function(e,t,n,r){switch(e){case"ArrowUp":t-=1;break;case"ArrowDown":t+=1;break;case"PageUp":t-=n-1;break;case"PageDown":t+=n-1;break;case"Home":t=0;break;case"End":t=r-1;break;default:return-1}return Math.min(Math.max(t,0),r-1)}(t.key,j,G,n);-1!==r&&(t.preventDefault(),r!==j&&(t.stopPropagation(),Se(r),L(r)),d&&t.shiftKey&&-1!==ie?ee(ie,r):t[K.ctrlKey]||Z(r))}}}),[j,e,G,g,y,w,Se,X,Z,ee,te,Q,d,ie]),Pe=(0,r.useCallback)((e=>{const t=Qg(e);-1!==t&&(L(t),d&&e.shiftKey?-1===ie?ee(t,j):ee(ie,t):d&&e[K.ctrlKey]?te(t):function(e){const t=Xg(e);return!!(null==t?void 0:t.classList.contains("selected"))}(e)||Z(t))}),[Z,te,ee,j,ie,d]),Ie=(0,r.useCallback)((e=>{if(0===e.button){const t=Qg(e);-1!==t&&(!d||e[K.ctrlKey]||e.shiftKey||Z(t))}}),[Z,d]),Ce=(0,r.useCallback)((e=>{"Shift"===e.key&&ae(-1)}),[]),Me=(0,r.useCallback)((({clientWidth:e,clientHeight:t})=>{V(e),_(t)}),[]),Oe=(0,r.useCallback)((({top:e})=>{D(e)}),[]);Pt(O,(()=>{H(O.current.getBoundingClientRect().height)})),(0,r.useEffect)((()=>{C.current.classList.toggle("thin",20*re>U)}),[re,U]);const Ne=(0,r.useCallback)((t=>{const n=Qg(t);-1!==n&&(t.preventDefault(),null==f||f(e[n],n))}),[e,f]),$e=(0,r.useCallback)((e=>{if(e.preventDefault(),-1===e.button){const t=function(e,t){return e.querySelector(`li[aria-posinset="${t+1}"]`)}(C.current,j);if(t){const n=t.getBoundingClientRect();null==v||v(Q,Math.min(n.left+U,n.right),n.bottom,j,e.button)}}else null==v||v(Q,e.pageX,e.pageY,Qg(e),e.button)}),[j,Q,v,U]),ze=(0,r.useCallback)((t=>{const n=Qg(t);-1!==n&&(t.preventDefault(),null==p||p(e[n],n))}),[e,p]);(0,r.useEffect)((()=>{const e=N.current;for(;e.hasChildNodes();)e.removeChild(e.lastChild);const t=Array.from(C.current.querySelectorAll(".list-view-body:not(list-view-drag-image) li.selected"));t.length=Math.min(t.length,4);for(let n=0;n<t.length;n++){const r=t[n].cloneNode(!0);r.removeAttribute("id"),r.removeAttribute("role"),r.style.transform=`translateY(${B*n}px)`,e.appendChild(r)}}),[be,ye,ge,we,B]);const je=(0,r.useCallback)((e=>{const t=e.dataTransfer;if(l||m){t.setDragImage(N.current,-16,-16);let n="none";n=l&&m?"copyMove":l?"copy":"move",Fg.set(e,Q,n),ce(j)}else t.effectAllowed="none"}),[l,m,Q,j]),Le=(0,r.useCallback)((e=>{e.preventDefault(),e.stopPropagation();const t=e.dataTransfer;if(c||m){const n=t.types.includes("text/plain");let r=Qg(e);-1===r&&(r=J),de?m&&n?(t.dropEffect="move",oe(r)):(t.dropEffect="none",oe(-1)):c&&(n||Zg(t.items,u))?(t.dropEffect="copy",oe(r)):(t.dropEffect="none",oe(-1))}else de?t.dropEffect="copy":(t.dropEffect="none",oe(-1))}),[J,de,c,u,m]),Re=(0,r.useCallback)((e=>{if(c||m){const t=e.dataTransfer;let n=Qg(e);-1===n&&(n=J);const r=Fg.getEffect(e);if("copy"===r){const t=Fg.getData(e);t&&(null==b||b(t,n))}else if("move"===r){const e=le<n?-1:0;null==T||T(Q,n),L(n+e)}else c&&Zg(t.items,u)&&(null==b||b(t.files,n))}oe(-1),e.preventDefault(),e.stopPropagation()}),[J,Q,c,u,m,le,b,T]),De=(0,r.useCallback)((()=>{Fg.unset(),ce(-1)}),[]),Fe=(0,r.useCallback)((()=>{oe(-1)}),[]),_e=(0,r.useCallback)((()=>{d||ne||Z(Math.max(j,0))}),[ne,j,d,Z]);return r.createElement("div",{className:`list-view list-view-${a.view} ${s}`,tabIndex:h?void 0:ue?-1:0,onClick:Ne,onContextMenu:$e,onDoubleClick:ze,onDragStart:je,onDragEnter:Le,onDragOver:Le,onDragLeave:Fe,onDragEnd:De,onDrop:Re,onFocus:_e,onKeyDown:Ae,onKeyUp:Ce,onMouseDown:Pe,onMouseUp:Ie,ref:C},r.createElement(Wn,{scrollWidth:z?q:void 0,scrollHeight:(J+(c?1:0)+($?1:0))*B,scrollAmount:B,droppable:c||m&&de,onResize:Me,onScroll:Oe,scrollableRef:M},$&&r.createElement(ln,null,r.createElement(Bg,{width:q,height:B,sizeable:z,cols:Y,onColumnResize:W})),r.createElement(Kg,{title:n,width:z?q:void 0,height:F,rowHeight:B,cols:Y,items:e,itemKey:t,itemClassName:i,listViewId:P,selectedId:Ee,selectedIds:h?Wg:ke,scrollTop:R,dragIndex:se,draggable:!h&&(l||m),multiple:d}),r.createElement("div",{className:"list-view-cursor",style:{width:z?`${q}px`:void 0,transform:`translateY(${Math.max(j,0)*B}px)`},ref:O})),r.createElement("ul",{className:"list-view-drag-image list-view-body","aria-hidden":!0,ref:N}))}function Qg(e){let t=0;const n=Xg(e);return n&&(t=Number(n.getAttribute("aria-posinset"))||0),t-1}function Xg(e){let t=e.target;for(;t&&!(null==t?void 0:t.hasAttribute("aria-posinset"));)t=t.parentElement;return t}function Zg(e,t){return-1!==Array.from(e).findIndex((e=>t.some((t=>((e,t)=>{const[n,r]=e.split("/"),[i,a]=t.split("/");return n===i&&(r===a||"*"===r)})(t,e.type)))))}function ew(){return Jh(Eh,null)}function tw({children:e}){return r.createElement("footer",{className:"status-bar"},e)}function nw({items:e,size:t,maxSize:n,error:i,loading:a,loadingText:s="Loading",selectedCount:o,itemName:l="item",itemNamePlural:c=l+"s"}){let u="";if(a)u=r.createElement("span",{className:"message"},s,"...");else if(e.length>0){const i=e.reduce((e=>e+1),0),a=r.createElement("span",{className:"selected"},"(",rw(o)," selected)"),s=i===t?`${t.toLocaleString()} ${1===t?l:c}`:`Loaded ${rw(i)} of ${void 0===t?n||`${rw(e.length)}+`:rw(n?Math.min(t,n):t)} ${c}`;u=r.createElement("span",{className:"message"},s," ",a)}else if(i){const e=function(e){return String(e.message||e.statusText||iw[e.status]||e.status||"")}(i);u=r.createElement(r.Fragment,null,r.createElement($t,{name:"error"}),r.createElement("span",{className:"message error"},e?`Error: ${e}`:"Error"))}else u=r.createElement("span",{className:"message"},"0 ",c);return r.createElement(tw,null,u)}function rw(e=0){return(e=Number(e))<1e4?String(e):e.toLocaleString()}const iw={401:"Unauthorized",403:"Forbidden",404:"Not found",408:"Timeout",429:"Too many requests",500:"Internal server error",502:"Bad gateway",503:"Service unavailable",504:"Timeout"},aw=(0,r.memo)((function({time:e}){const t=100/6,n=new Date(e);let i=n.getHours()+n.getMinutes()/60,a=Math.min(i,6),s=i-a;return i>12&&(i=24-i,s=Math.min(i,6),a=i-s),r.createElement("span",{role:"presentation",className:"sun-clock",title:n.toLocaleTimeString(),style:{"--am-alpha":a*t+"%","--pm-alpha":s*t+"%"}})}));function sw({time:e,className:t}){return r.createElement("time",{className:t},b(e))}const ow={view:"details",fields:["Title","Genre","Owner"]};const lw=e=>r.createElement(sw,{className:"text",time:e.duration||0});function cw({value:e=""}){return""===e?null:r.createElement("span",{className:"text"},e)}const uw={Index:{title:"#",render:(e,t)=>t+1,className:"index",align:"right",width:60},Artist:{title:"Artist",render:e=>{var t;return r.createElement(cw,{value:e.itemType===wr.Media?null===(t=e.artists)||void 0===t?void 0:t.join(", "):e.artist})},className:"artist"},AlbumArtist:{title:"Album Artist",render:e=>r.createElement(cw,{value:e.albumArtist}),className:"artist"},AlbumTrack:{title:"#",render:e=>r.createElement("span",{className:"text"},e.track?r.createElement(r.Fragment,null,r.createElement("span",{className:"disc"},e.disc||"?","."),e.track):"-"),align:"right",width:60,className:"index"},Title:{title:"Title",render:e=>r.createElement(cw,{value:e.title}),className:"title"},IconTitle:{title:"Title",render:e=>{const t=Bd(e);return t?r.createElement(Ki,{icon:t.icon,text:e.title}):r.createElement(cw,{value:e.title})},className:"title"},Blurb:{title:"Description",render:e=>r.createElement(cw,{value:e.description}),className:"blurb"},Album:{title:"Album",render:e=>r.createElement(cw,{value:e.album}),className:"album"},AlbumAndYear:{title:"Album",render:e=>r.createElement(cw,{value:e.album?e.year?`${e.album} (${e.year})`:e.album:e.year}),className:"album"},Track:{title:"Track",render:e=>r.createElement(cw,{value:e.track||"-"}),align:"right",width:80,className:"track"},Duration:{title:"Time",render:lw,align:"right",width:120,className:"duration"},FileIcon:{title:"Thumbnail",render:(e,t)=>{const n=e.itemType===wr.Media?e.mediaType===kr.Video?"file-video":"file-audio":0===t&&e.fileName.startsWith("../")?"folder-up":"folder";return r.createElement("figure",{className:"cover-art"},r.createElement($t,{className:"cover-art-image",name:n}))},className:"thumbnail"},FileName:{title:"FileName",render:e=>r.createElement(cw,{value:e.fileName}),className:"title"},PlayCount:{title:"Plays",render:e=>r.createElement(cw,{value:dw(e.playCount)}),align:"right",width:80,className:"play-count"},TrackCount:{title:"Tracks",render:e=>r.createElement(cw,{value:dw(e.trackCount)}),align:"right",width:120,className:"track-count"},Year:{title:"Year",render:e=>r.createElement(cw,{value:e.year||""}),width:120,className:"year"},Views:{title:"Views",render:e=>void 0===e.globalPlayCount?null:r.createElement(cw,{value:mw(e.globalPlayCount,"view")}),className:"views"},Genre:{title:"Genre",render:e=>{var t;return r.createElement(cw,{value:null===(t=e.genres)||void 0===t?void 0:t.join(", ")})},className:"genre"},Owner:{title:"Owner",render:e=>{var t;return r.createElement(cw,{value:null===(t=e.owner)||void 0===t?void 0:t.name})},className:"owner"},LastPlayed:{title:"Last played",render:e=>{if(!e.playedAt)return r.createElement("span",{className:"text last-played"},"unplayed");const t=new Date(1e3*e.playedAt),n=function(e){const t=Date.now()-e,n=6e4;if(t<12e4)return"just now";const r=36e5;if(t<54e5)return`${Math.round(t/n)} mins ago`;const i=24*r;if(t<1.5*i)return`${Math.round(t/r)} hours ago`;if(t<12*i)return`${Math.round(t/i)} days ago`;const a=7*i;if(t<10*a)return`${Math.round(t/a)} weeks ago`;const s=365*i;return t<s?`${Math.round(t/2592e6)} months ago`:t<2*s?"1 year ago":`${Math.floor(t/s)} years ago`}(t.valueOf());return r.createElement("time",{className:"text last-played",title:t.toLocaleDateString()},n)},className:"played-at"},ListenDate:{title:"Played On",render:e=>{if(!e.playedAt)return"";const t=1e3*e.playedAt;return r.createElement("time",{className:"text"},r.createElement(aw,{time:t}),r.createElement("span",{className:"date"},new Date(t).toLocaleDateString()))},className:"played-at listen-date"},Thumbnail:{title:"Thumbnail",render:e=>r.createElement(ag,{item:e}),className:"thumbnail"},Rate:{title:r.createElement(Wy,{value:0,tabIndex:-1}),render:e=>{const t=(0,r.useCallback)((t=>{return n=void 0,r=void 0,a=function*(){yield Lg(yr.Rate,[e],t)},new((i=void 0)||(i=Promise))((function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a}),[e]);return r.createElement(Wy,{value:e.rating,tabIndex:-1,onChange:t})},align:"right",width:120,className:"rate"}};function dw(e){if(null==e)return"";const t=Number(e);return isNaN(t)?"":t.toLocaleString()}function mw(e=0,t="listen",n=t+"s"){return 1===e?`1 ${t}`:e<1e3?`${e} ${n}`:e<1e5?`${(e/1e3).toFixed(1).replace(".0","")}K  ${n}`:e<1e6?`${Math.round(e/1e3)}K  ${n}`:e<1e8?`${(e/1e6).toFixed(1).replace(".0","")}M  ${n}`:e<1e9?`${Math.round(e/1e6)}M  ${n}`:`${(e/1e9).toFixed(1).replace(".0","")}B  ${n}`}var hw=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))},fw=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function pw(e){var{className:t="",pager:n=null,statusBar:i=!0,loadingText:a,onDoubleClick:s,onEnter:o,onSelect:l}=e,c=fw(e,["className","pager","statusBar","loadingText","onDoubleClick","onEnter","onSelect"]);const u=function(e=ow){return(0,r.useMemo)((()=>function(e){if("none"===e.view)return{view:"details",cols:[]};const{view:t,fields:n}=e,i=n.map((e=>uw[e]));return i.push({title:r.createElement($t,{name:"menu"}),render:e=>r.createElement(Qy,{item:e,inline:!0}),className:"actions",align:"right",width:80}),"details"===t?{view:t,cols:i,showTitles:!0,sizeable:!0}:{view:t,cols:i}}(e)),[e])}(c.layout),[d,m]=(0,r.useState)(0),[h,f]=(0,r.useState)(0),[{items:p,loaded:v,error:b,size:y,maxSize:g},w]=function(e){const[t,n]=function(){const e=(0,r.useRef)(null);null===e.current&&(e.current=new Oe);const t=(0,r.useCallback)((t=>{e.current.next(t)}),[]);return[e.current,t]}(),[i,a]=(0,r.useState)([]),[s,o]=(0,r.useState)(void 0),[l,c]=(0,r.useState)(void 0),[u,d]=(0,r.useState)(),[m,h]=(0,r.useState)(!1),f=(0,r.useMemo)((()=>({items:i,size:s,maxSize:l,error:u,loaded:m})),[i,s,l,u,m]),p=(0,r.useCallback)(((e,t)=>{n([e,t])}),[n]);return(0,r.useEffect)((()=>{if(a([]),o(void 0),c(void 0),d(void 0),h(!1),!e)return;const n=e.observeItems(),r=e.observeSize(),i=e.observeError(),s=_n(n,i).pipe(Br(1),wn((()=>!0))),l=Dn(Gn([]),Gn([]).pipe(Ju(0))),u=new se;return u.add(Dn(l,n).subscribe(a)),u.add(r.subscribe(o)),u.add(i.subscribe(d)),u.add(s.subscribe(h)),u.add(t.subscribe((([t,n])=>{e.fetchAt(t,n)}))),c(e.maxSize),()=>u.unsubscribe()}),[e,t]),[f,p]}(n),[E,k]=(0,r.useState)(0),x=ew(),S=function(e){const[t,n]=(0,r.useState)("");return(0,r.useEffect)((()=>{let t=0;"details"!==e.view&&e.cols.forEach((e=>{/played-at/.test(e.className)&&(t=2),2!==t&&/duration|track-count|play-count/.test(e.className)&&(t=1)})),n(t?`clip-${t}`:"")}),[e]),t}(u);(0,r.useEffect)((()=>{d>=0&&h>0&&w(d,h)}),[w,d,h,n]);const T=(0,r.useCallback)((e=>{k(e.length),null==l||l(e)}),[l]),A=(0,r.useCallback)(((e,t,n,r,i)=>hw(this,void 0,void 0,(function*(){if(0===e.length)return;const r=yield By(e,!0,t,n,-1===i?"right":"left");r&&(yield Lg(r,e))}))),[]),P=(0,r.useCallback)(((e,t)=>hw(this,void 0,void 0,(function*(){vw(e)?yield Lg(yr.Queue,[e]):null==s||s(e,t)}))),[s]),I=(0,r.useCallback)(((e,t,n)=>hw(this,void 0,void 0,(function*(){e.every(vw)?t||n?t&&!n?yield Lg(yr.PlayNow,e):n&&!t&&(yield Lg(yr.PlayNext,e)):yield Lg(yr.Queue,e):null==o||o(e,t,n)}))),[o]),C=(0,r.useCallback)((e=>hw(this,void 0,void 0,(function*(){yield Lg(yr.Info,e)}))),[]),M=(0,r.useCallback)((e=>{if((null==e?void 0:e.itemType)===wr.Media){const[t]=e.src.split(":");return`source-${t} ${e.src===(null==x?void 0:x.src)?"playing":""} ${e.unplayable?"unplayable":""}`}return""}),[x]);return r.createElement("div",{className:`panel ${t} ${S}`},r.createElement(Jg,Object.assign({},c,{className:"media-list",layout:u,items:p,itemClassName:M,itemKey:"src",selectedIndex:0===p.length?-1:0,onContextMenu:A,onDoubleClick:P,onEnter:I,onInfo:C,onPageSizeChange:f,onScrollIndexChange:m,onSelect:T})),i?r.createElement(nw,{items:p,error:b,size:y,maxSize:g,loading:!!n&&!v,loadingText:a,selectedCount:E}):null)}function vw(e){return e.itemType===wr.Media||e.itemType===wr.Album}var bw=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const yw={view:"card compact",fields:["Thumbnail","Title","Artist","Year"]};function gw(e){var{className:t="",layout:n=yw,draggable:i=!0}=e,a=bw(e,["className","layout","draggable"]);return r.createElement(pw,Object.assign({},a,{className:`albums ${t}`,layout:n,draggable:i}))}var ww=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Ew={view:"details",fields:["Artist","Title","Album","Track","Duration","Genre","PlayCount"]};function kw(e){var{className:t="",layout:n=Ew,multiple:i=!0,draggable:a=!0}=e,s=ww(e,["className","layout","multiple","draggable"]);return r.createElement(pw,Object.assign({},s,{className:`media-items ${t}`,layout:n,multiple:i,draggable:a}))}const xw={view:"details",fields:["AlbumTrack","Title","Artist","Duration"]};function Sw(e,t=xw){const[n,i]=(0,r.useState)(t);return(0,r.useEffect)((()=>{if((null==e?void 0:e.synthetic)&&"details"===t.view){const e=t.fields.slice();"Track"!==e[0]&&"AlbumTrack"!==e[0]||(e[0]="Index");const n=e.indexOf("Duration");-1!==n&&e.splice(n+1,0,"Album","Year"),i({view:"details",fields:m(e)})}else i(t)}),[e,t]),n}var Tw=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Aw(e){var t,{source:n}=e,i=Tw(e,["source"]);const[a,s]=(0,r.useState)(null),o=Sw(a,n.secondaryLayout),l=(0,r.useCallback)((([e])=>{s(e||null)}),[]),c=r.createElement(gw,Object.assign({},i,{title:n.title,onSelect:l})),u=r.createElement(kw,{title:a?`${a.title}: Tracks`:"",className:"album-tracks "+((null==a?void 0:a.multiDisc)?"multi-disc":""),pager:null==a?void 0:a.pager,layout:o,key:null==a?void 0:a.src});return r.createElement("div",{className:"panel"},"none"===(null===(t=n.secondaryLayout)||void 0===t?void 0:t.view)?c:r.createElement(Nt,{id:"album-browser-layout",arrange:"rows",primaryIndex:0},c,u))}var Pw=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Iw={view:"card compact",fields:["Thumbnail","Title","Genre"]};function Cw(e){var{className:t="",layout:n=Iw}=e,i=Pw(e,["className","layout"]);return r.createElement(pw,Object.assign({},i,{className:`artists ${t}`,layout:n}))}var Mw=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Ow={view:"card compact",fields:["Thumbnail","Title","Year"]};function Nw(e){var t,n,{source:i}=e,a=Mw(e,["source"]);const[s,o]=(0,r.useState)(null),[l,c]=(0,r.useState)(null),u=Sw(l,i.tertiaryLayout),d=(0,r.useCallback)((([e])=>{o(e||null)}),[]),m=(0,r.useCallback)((([e])=>{c(e||null)}),[]),h=r.createElement(Cw,Object.assign({},a,{title:i.title,onSelect:d})),f=r.createElement(gw,{title:s?`${s.title}: Albums`:"",className:"artist-albums",pager:null==s?void 0:s.pager,layout:i.secondaryLayout||Ow,onSelect:m,key:null==s?void 0:s.src}),p=r.createElement(kw,{title:l?`${l.title}: Tracks`:"",className:"album-tracks "+((null==l?void 0:l.multiDisc)?"multi-disc":""),pager:null==l?void 0:l.pager,layout:u,key:null==l?void 0:l.src});return r.createElement("div",{className:"panel"},"none"===(null===(t=i.secondaryLayout)||void 0===t?void 0:t.view)?h:"none"===(null===(n=i.tertiaryLayout)||void 0===n?void 0:n.view)?r.createElement(Nt,{id:"artist-album-browser-layout",arrange:"rows",primaryIndex:0},h,f):r.createElement(Nt,{id:"artist-browser-layout",arrange:"columns",primaryIndex:1},h,r.createElement(Nt,{id:"artist-album-browser-layout",arrange:"rows",primaryIndex:0},f,p)))}var $w=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function zw(e){var{source:t}=e,n=$w(e,["source"]);return r.createElement("div",{className:"panel"},r.createElement(kw,Object.assign({},n,{title:t.title})),";")}var jw=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Lw={view:"card compact",fields:["Thumbnail","Title","TrackCount","Owner"]};function Rw(e){var{className:t="",layout:n=Lw}=e,i=jw(e,["className","layout"]);return r.createElement(pw,Object.assign({},i,{className:`playlists ${t}`,layout:n}))}var Dw=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Fw={view:"card",fields:["Thumbnail","IconTitle","TrackCount","Owner"]},_w={view:"card compact",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]};function Uw(e){var{source:t}=e,n=Dw(e,["source"]);const[i,a]=(0,r.useState)(null);(0,r.useEffect)((()=>()=>xi.unlock()),[t]),(0,r.useEffect)((()=>{i&&xi.lock(i)}),[i]);const s=(0,r.useCallback)((([e])=>{a(e||null)}),[]);return r.createElement("div",{className:"panel pinned-playlist"},r.createElement(Rw,Object.assign({},n,{title:t.title,layout:t.layout||Fw,onSelect:s,statusBar:!1,disabled:!0})),r.createElement(kw,{title:`${t.title}: Tracks`,className:"playlist-items",pager:null==i?void 0:i.pager,layout:t.secondaryLayout||_w}))}var Vw=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Bw={view:"details",fields:["Index","Artist","Title","Album","Duration","Genre"]};function Hw(e){var t,{source:n}=e,i=Vw(e,["source"]);const[a,s]=(0,r.useState)(null),o=(0,r.useCallback)((([e])=>{s(e||null)}),[]),l=r.createElement(Rw,Object.assign({},i,{title:n.title,onSelect:o})),c=r.createElement(kw,{title:a?`${a.title}: Tracks`:"",className:"playlist-items",pager:null==a?void 0:a.pager,layout:n.secondaryLayout||Bw,key:null==a?void 0:a.src});return r.createElement("div",{className:"panel"},"none"===(null===(t=n.secondaryLayout)||void 0===t?void 0:t.view)?l:r.createElement(Nt,{id:"playlist-browser-layout",arrange:"rows",primaryIndex:0},l,c))}function Yw(e){var t;return(null===(t=window.MusicKit)||void 0===t?void 0:t.version.startsWith("3"))?r.createElement(zw,Object.assign({},e,{service:Ri})):r.createElement(Kw,null)}function Kw(){return r.createElement(Qh,null,r.createElement("div",{className:"note"},r.createElement("p",null,r.createElement("strong",null,"Apple MusicKit beta required.")),r.createElement("p",null,"You need to enable ",r.createElement("strong",null,"MusicKit beta")," from the Settings screen to watch videos from ",Ri.name,".")))}function Ww(e){return"apple"===e.service.id?r.createElement(Yw,Object.assign({},e)):r.createElement(zw,Object.assign({},e))}function qw(e){switch(e.source.itemType){case wr.Artist:return r.createElement(Nw,Object.assign({},e));case wr.Album:return r.createElement(Aw,Object.assign({},e));case wr.Playlist:return e.source.isPin?r.createElement(Uw,Object.assign({},e)):r.createElement(Hw,Object.assign({},e));default:return e.source.mediaType===kr.Video?r.createElement(Ww,Object.assign({},e)):r.createElement(zw,Object.assign({},e))}}function Gw(e,t){const[n,i]=(0,r.useState)(null);return(0,r.useEffect)((()=>{const n=(null==e?void 0:e.search(t))||null;return i(n),()=>null==n?void 0:n.disconnect()}),[e,t]),n}var Jw=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Qw={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","ListenDate"]};function Xw(e){var{service:t,source:n,minDate:i="2010-01-01"}=e,a=Jw(e,["service","source","minDate"]);const[s,o]=(0,r.useState)(0),l=function(e,t=0){return Gw(e,(0,r.useMemo)((()=>({startAt:t})),[t]))}(n,s),c=(0,r.useCallback)((e=>{const t=new Date,n=new Date(e);n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate()?o(0):o(Math.floor(n.valueOf()/1e3))}),[]);return r.createElement(r.Fragment,null,r.createElement(af,{icon:t.icon},t.name,":",r.createElement(rf,{min:i,onSelect:c})),r.createElement(qw,Object.assign({},a,{service:t,source:n,pager:l,layout:n.layout||Qw})))}const Zw="2002-11-20",eE=new N("lastfm/useHistoryStart");function tE(){const e=function(){const[e,t]=(0,r.useState)((()=>Ns.firstScrobbledAt)),n=""===e||e===Zw;return(0,r.useEffect)((()=>{if(n){t(Zw);const e=Rn(Bs.getUserInfo()).pipe(wn((e=>Number(e.user.playcount))),kn((e=>{return e?Gn(e):(n=ne(t=()=>Error("No history."))?t:function(){return t},new Ie((function(e){return e.error(n())})));var t,n})),wn((e=>Math.floor(e/50))),wn((e=>new Ks({page:e},{pageSize:50}))),kn((e=>Hr(e))),wn((e=>e.at(-1))),De(l),wn((e=>new Date(1e3*e.playedAt))),wn(p),Re((e=>Ns.firstScrobbledAt=e)),Re(t)).subscribe(eE);return()=>e.unsubscribe()}}),[n]),e}();return r.createElement(Xw,{service:eo,source:Js,minDate:e})}class nE extends fi{disconnect(){super.disconnect(),this.items.forEach((e=>{var t;return null===(t=e.pager)||void 0===t?void 0:t.disconnect()}))}fetchAt(){}next(e){this.disconnected||(this.subscriptions||this.connect(),this.size$.next(e.length),this.items$.next(e))}}var rE=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const iE={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]};function aE(e){var{service:t,source:n,total:i}=e,a=rE(e,["service","source","total"]);const[,s]=(0,r.useReducer)((e=>e++),0);return(0,r.useEffect)((()=>{const e=Rn(on(6e4)).subscribe(s);return()=>e.unsubscribe()}),[]),r.createElement(r.Fragment,null,r.createElement(af,{icon:t.icon},void 0===i?t.name:r.createElement(r.Fragment,null,t.name,": ",i.toLocaleString()," ",qd(t)?"scrobbles":"plays")),r.createElement(qw,Object.assign({},a,{service:t,source:n,layout:n.layout||iE})))}var sE=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const oE=new N("LastFmRecentlyPlayedBrowser");function lE(){const{pager:e,total:t}=function(){const e=(0,r.useMemo)((()=>Math.floor(Date.now()/1e3)),[]),[t,n]=(0,r.useState)(null),[i,a]=(0,r.useState)(void 0);return(0,r.useEffect)((()=>{const t=new nE,r=new Ks({to:e}),i=new yi(t,r),s=_n(Cm().pipe(qu(1),Ju(2e4)),on(3e5)),o=new se;return o.add(r.observeItems().pipe(fr((e=>0===e.length)),Br(1),wn((e=>e[0].playedAt)),Un((e=>s.pipe(kn((()=>function(e){return sE(this,void 0,void 0,(function*(){const t=new Ks({from:e});return yield Hr(t)}))}(e+1))),Re((e=>t.next(e))))))).subscribe(oE)),o.add(i.observeSize().pipe(Re(a)).subscribe(oE)),t.next([]),n(i),()=>o.unsubscribe()}),[e]),{pager:t,total:i}}();return r.createElement(aE,{service:eo,source:Qs,pager:e,total:t})}var cE=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const uE=[{value:"overall",text:"All time"},{value:"12month",text:"Year"},{value:"1month",text:"Month"},{value:"7day",text:"Week"}];function dE(e){var{source:t}=e,n=cE(e,["source"]);const i=(0,r.useId)(),[a,s]=(0,r.useState)(),o=function(e,t="overall"){return Gw(e,(0,r.useMemo)((()=>({period:t})),[t]))}(t,a),l=(0,r.useCallback)((e=>{s(e.target.value)}),[]);return r.createElement(r.Fragment,null,r.createElement(af,{icon:eo.icon},eo.name,": ",t.title),r.createElement("div",{className:"lastfm-period-selector options"},r.createElement("ul",{className:"lastfm-periods"},uE.map((({value:e,text:t})=>r.createElement("li",{className:"lastfm-period",key:e},r.createElement("input",{id:`${i}-period-${e}`,type:"radio",name:"lastfm-period",value:e,defaultChecked:"overall"===e,onChange:l}),r.createElement("label",{htmlFor:`${i}-period-${e}`},t)))))),r.createElement(qw,Object.assign({},n,{service:eo,source:t,pager:o,layout:t.layout})))}const mE="2015-09-17";function hE(){const e=function(){const[e,t]=(0,r.useState)(io.firstScrobbledAt),n=""===e||e===mE;return(0,r.useEffect)((()=>{if(n){t(mE);const e=Rn(lo.getListeningActivity()).pipe(wn((e=>e.find((e=>e.listen_count>0)))),De(l),wn((e=>p(1e3*Number(e.from_ts)))),Re((e=>io.firstScrobbledAt=e)),Br(1)).subscribe(t);return()=>e.unsubscribe()}}),[n]),e}();return r.createElement(Xw,{service:vl,source:cl,minDate:e})}var fE=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const pE=new N("ListenBrainzRecentlyPlayedBrowser");function vE(){const{pager:e,total:t}=function(){const e=(0,r.useMemo)((()=>Math.floor(Date.now()/1e3)),[]),[t,n]=(0,r.useState)(null),[i,a]=(0,r.useState)(void 0);return(0,r.useEffect)((()=>{const t=new nE,r=new tl({max_ts:e},!0),i=new yi(t,r),s=_n(Cm().pipe(qu(1),Ju(2e4)),on(3e5)),o=new se;return o.add(r.observeItems().pipe(fr((e=>0===e.length)),Br(1),wn((e=>e[0].playedAt)),Un((e=>s.pipe(kn((()=>function(e){return fE(this,void 0,void 0,(function*(){const t=new tl({min_ts:e});return yield Hr(t)}))}(e+1))),Re((e=>t.next(e))))))).subscribe(pE)),o.add(i.observeSize().pipe(Re(a)).subscribe(pE)),t.next([]),n(i),()=>o.unsubscribe()}),[e]),{pager:t,total:i}}();return r.createElement(aE,{service:vl,source:ul,pager:e,total:t})}const bE=[{value:"all_time",text:"All time"},{value:"year",text:"Year"},{value:"month",text:"Month"},{value:"week",text:"Week"}];function yE({source:e}){const t=(0,r.useId)(),[n,i]=(0,r.useState)(),a=function(e,t="all_time"){return Gw(e,(0,r.useMemo)((()=>({range:t})),[t]))}(e,n),s=(0,r.useCallback)((e=>{i(e.target.value)}),[]);return r.createElement(r.Fragment,null,r.createElement(af,{icon:vl.icon},vl.name,": ",e.title),r.createElement("div",{className:"listenbrainz-range-selector options"},r.createElement("ul",{className:"listenbrainz-ranges"},bE.map((({value:e,text:n})=>r.createElement("li",{className:"listenbrainz-range",key:e},r.createElement("input",{id:`${t}-range-${e}`,type:"radio",name:"listenbrainz-range",value:e,defaultChecked:"all_time"===e,onChange:s}),r.createElement("label",{htmlFor:`${t}-range-${e}`},n)))))),r.createElement(qw,{service:vl,source:e,pager:a,layout:e.layout}))}function gE({icon:e,placeholder:t="Search",onSubmit:n}){const i=(0,r.useRef)(null),a=(0,r.useCallback)((e=>{const t=i.current.value;e.preventDefault(),null==n||n(t)}),[n]);return r.createElement("form",{className:"search-bar",onSubmit:a},r.createElement("p",{className:"text-with-button"},e?r.createElement($t,{name:e}):null,r.createElement("input",{type:"search",placeholder:t,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",ref:i}),r.createElement("button",{type:"submit",title:"Search"},r.createElement($t,{name:"search"}))))}function wE({sources:e,onSourceChange:t}){const n=(0,r.useId)(),i=(0,r.useCallback)((n=>{const r=Number(n.target.value),i=e[r];null==t||t(i)}),[e,t]);return r.createElement("div",{className:"media-source-selector options"},r.createElement("ul",{className:"media-sources"},e.map(((e,t)=>r.createElement("li",{className:"media-source",key:e.id},r.createElement("input",{id:`${n}-${e.id}`,type:"radio",name:n,value:t,defaultChecked:0===t,onChange:i}),r.createElement("label",{htmlFor:`${n}-${e.id}`},e.title))))))}function EE({service:e,sources:t}){const[n,i]=(0,r.useState)((()=>t[0])),[a,s]=(0,r.useState)(""),o=function(e,t=""){return Gw(e,(0,r.useMemo)((()=>({q:t})),[t]))}(n,a),l=!!n.searchable,c=!l&&!n.isPin;return r.createElement(r.Fragment,null,c?r.createElement(af,{icon:e.icon},e.name,": ",n.title):null,l?r.createElement(gE,{icon:e.icon,placeholder:`Search ${e.name}`,onSubmit:s}):null,t.length>1?r.createElement(wE,{sources:t,onSourceChange:i}):null,r.createElement(qw,{service:e,source:n,pager:o,layout:n.layout,loadingText:a?"Searching":void 0}))}function kE({service:e,viewType:t,itemType:n,onSelect:i}){const a=(0,r.useId)(),[s,o]=(0,r.useState)([]),[l,c]=(0,r.useState)(),u=t===Sr.ByDecade?"Decade":"Genre";(0,r.useEffect)((()=>{l&&i&&i(l)}),[l,i]),(0,r.useEffect)((()=>{const r=Rn(e.getFilters(t,n)).subscribe(o);return()=>r.unsubscribe()}),[e,t,n]),(0,r.useEffect)((()=>{l||c(s[0])}),[s,l]);const d=(0,r.useCallback)((e=>{c(s[Number(e.target.value)])}),[s]);return r.createElement("div",{className:"filter-selector"},r.createElement("label",{htmlFor:a},u,":"),r.createElement("select",{id:a,onChange:d},s.map(((e,t)=>r.createElement("option",{key:e.id,value:t},e.title)))))}function xE({service:e,source:t}){const[n,i]=(0,r.useState)(),a=Gw(t,n);return r.createElement(r.Fragment,null,r.createElement(af,{icon:e.icon},e.name,": ",t.title),r.createElement(kE,{service:e,viewType:t.viewType,itemType:t.itemType,onSelect:i}),r.createElement(qw,{service:e,source:t,pager:a,layout:t.layout}))}var SE=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const TE={view:"card minimal",fields:["FileIcon","FileName"]};function AE(e){var{className:t="",layout:n=TE,multiple:i=!0,draggable:a=!0,onSelect:s}=e,o=SE(e,["className","layout","multiple","draggable","onSelect"]);const[l,c]=(0,r.useState)([]),u=(0,r.useMemo)((()=>i&&l.every((e=>e.itemType===wr.Media))),[i,l]),d=(0,r.useMemo)((()=>a&&l.every((e=>e.itemType===wr.Media))),[a,l]),m=(0,r.useCallback)((e=>{c(e),null==s||s(e)}),[s]);return r.createElement(pw,Object.assign({},o,{className:`folder-items ${t}`,layout:n,multiple:u,draggable:d,onSelect:m}))}var PE=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function IE({service:e,source:t}){const[n,i]=(0,r.useState)(null),[a,s]=(0,r.useState)("/");(0,r.useEffect)((()=>{const e=t.search();return i(e),s("/"),()=>e.disconnect()}),[t]);const o=(0,r.useCallback)((e=>PE(this,void 0,void 0,(function*(){e.itemType===wr.Folder&&(i(e.pager),s(e.path||"/"))}))),[]),l=(0,r.useCallback)((e=>PE(this,void 0,void 0,(function*(){if(1===e.length){const t=e[0];(null==t?void 0:t.itemType)===wr.Folder&&(i(t.pager),s(t.path||"/"))}}))),[]);return r.createElement(r.Fragment,null,r.createElement(af,{icon:e.icon},e.name,": ",a),r.createElement("div",{className:"panel"},r.createElement(AE,{title:`Path: ${a}`,pager:n,onEnter:l,onDoubleClick:o})))}function CE({service:e,sources:t}){const n=1===t.length?t[0]:null;switch((0,r.useEffect)((()=>{(null==n?void 0:n.viewType)===Sr.Library?Rr.lock(e.id,n.itemType):Rr.unlock()}),[e,n]),(0,r.useEffect)((()=>{(null==n?void 0:n.viewType)===Sr.Ratings?Vr.lock(e.id,n.itemType):Vr.unlock()}),[e,n]),(0,r.useEffect)((()=>()=>{Rr.unlock(),Vr.unlock()}),[e]),null==n?void 0:n.id){case"lastfm/top/tracks":case"lastfm/top/albums":case"lastfm/top/artists":return r.createElement(dE,{source:n});case"listenbrainz/top/tracks":case"listenbrainz/top/albums":case"listenbrainz/top/artists":return r.createElement(yE,{source:n});case"lastfm/history":return r.createElement(tE,null);case"listenbrainz/history":return r.createElement(hE,null);case"lastfm/recently-played":return r.createElement(lE,null);case"listenbrainz/recently-played":return r.createElement(vE,null);default:switch(null==n?void 0:n.viewType){case Sr.ByDecade:case Sr.ByGenre:return r.createElement(xE,{service:e,source:n});case Sr.Folders:return r.createElement(IE,{service:e,source:n});default:return r.createElement(EE,{service:e,sources:t})}}}function ME({service:e,sources:t}){const n=Jh(e.observeIsLoggedIn,!1),i=function(e){return(0,r.useMemo)((()=>function({error:t}){return t instanceof Vi?r.createElement(Qh,null,r.createElement("div",{className:"note"},r.createElement("p",null,(null==t?void 0:t.message)||String(t)))):r.createElement(Xh,{error:t},e&&r.createElement("p",{className:"buttons"},r.createElement("button",{className:"disconnect",onClick:e.logout},"Reconnect to ",e.name,"...")))}),[e])}(e),a=`${e.id}/${e.libraryId||"*"}/${t.map((e=>e.id))}`;return r.createElement("div",{className:`media-browser ${e.id}-browser`,key:a},n?r.createElement(Zd.SV,{fallbackRender:i},r.createElement(CE,{service:e,sources:t})):r.createElement(Gh,{service:e}))}function OE(e){return e.sources.filter(mr).map((t=>({id:t.id,label:r.createElement(Ki,{icon:t.icon,text:t.title}),value:r.createElement(ME,{service:e,sources:[t]})}))).concat(function(e){return xi.getPinsForService(e.id).map((t=>{var n;return null===(n=e.createSourceFromPin)||void 0===n?void 0:n.call(e,t)})).filter(l).map((t=>({id:t.id,label:r.createElement(Ki,{icon:t.icon,text:t.title}),value:r.createElement(ME,{service:e,sources:[t]})})))}(e))}const NE=new D("sources");function $E({onSelect:e}){const t=(0,r.useRef)(null),n=function(){const[e,t]=(0,r.useState)();return(0,r.useEffect)((()=>{const e=_n(dr.pipe(De((e=>e!==ur)),wn((()=>{}))),_n(...Ud().filter((e=>!!e.observeLibraryId)).map((e=>e.observeLibraryId()))).pipe(wn((()=>{}))),xi.observe()),n=xi.observe().pipe(Br(1),Un((()=>e)),wn((()=>Fd().filter(mr).map((e=>function(e){return{id:e.id,label:r.createElement(Ki,{icon:e.icon,text:e.name,showConnectivity:!0}),value:r.createElement(ME,{service:e,sources:e.roots}),startExpanded:!0,children:OE(e)}}(e)))))).subscribe(t);return()=>n.unsubscribe()}),[]),e}();return(0,r.useEffect)((()=>{t.current.focus()}),[]),(0,r.useEffect)((()=>{0===(null==n?void 0:n.length)&&Dt(Xd,!0)}),[n]),r.createElement("div",{className:"panel media-sources"},r.createElement(sr,{roots:n||[],onSelect:e,storageId:NE.id,treeViewRef:t}))}var zE=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function jE(e){var{id:t,item:n,index:i,selected:a}=e,s=zE(e,["id","item","index","selected"]);const o=(0,r.useCallback)((e=>{e.target.focus()}),[]);return r.createElement("button",Object.assign({},s,{className:"tab",type:"button",id:`${t}-tab-${i}`,tabIndex:a?0:-1,role:"tab","aria-selected":a,"aria-controls":`${t}-panel-${i}`,onMouseDown:o}),n.tab)}function LE({id:e,item:t,index:n,hidden:i}){return r.createElement("div",{className:"tab-panel",id:`${e}-panel-${n}`,hidden:i,role:"tabpanel","aria-labelledby":`${e}-tab-${n}`},t.panel)}function RE({label:e,items:t,className:n=""}){const i=(0,r.useId)(),a=(0,r.useRef)(null),[s,o]=(0,r.useState)([]),[l,c]=(0,r.useState)(0);(0,r.useEffect)((()=>{o(Array.from(a.current.querySelectorAll("button")))}),[]);const u=(0,r.useCallback)((e=>{let t=l;"ArrowRight"===e.code?(e.stopPropagation(),t++):"ArrowLeft"===e.code&&(e.stopPropagation(),t--),t=Math.min(Math.max(t,0),s.length-1);const n=s[t];n&&!n.disabled&&n.focus()}),[l,s]),d=(0,r.useCallback)((e=>{const t=e.target;if(t.id){const e=Number(t.id.split("-").pop());c(e)}}),[]);return r.createElement("div",{className:`tab-list ${n}`},r.createElement("ul",{className:"tab-list-tabs",role:"tablist","aria-label":e,onFocus:d,onKeyDown:u,ref:a},t.map(((e,t)=>r.createElement("li",{role:"presentation",key:t},r.createElement(jE,{id:i,item:e,index:t,selected:t===l}))))),r.createElement("div",{className:"tab-list-panels"},t.map(((e,t)=>r.createElement(LE,{id:i,item:e,index:t,hidden:t!==l,key:t})))))}function DE(){return Jh((0,r.useMemo)((()=>()=>_n(At.observe(),St.observeUserThemes()).pipe(wn((()=>Object.assign({},At.current))))),[]),At.current)}function FE(){return Jh((0,r.useMemo)((()=>()=>St.observeUserThemes()),[]),[])}var _E=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function UE(e){var{colorName:t,onChange:n}=e,i=_E(e,["colorName","onChange"]);const a=(0,r.useCallback)((e=>{const r=e.target.value;At[t]=r,null==n||n(r)}),[t,n]);return r.createElement("input",Object.assign({},i,{type:"color",onChange:a}))}function VE({label:e,backgroundColorName:t,textColorName:n,defaultBackgroundColor:i,defaultTextColor:a,suggestedColors:s,nextSuggestion:o,trackingColor:l="frame"}){const c=DE(),u=i&&a,d=c[t],m=c[n],[h,f]=(0,r.useState)((()=>d||i||"")),[p,v]=(0,r.useState)((()=>m||a||"")),b=!d&&!m,y=(0,r.useCallback)((()=>{if(s&&o){const[e,r]=s;At[t]=e,At[n]=r,o()}}),[t,n,s,o]),g=(0,r.useCallback)((()=>{b?(At[t]=h,At[n]=p):(At[t]="",At[n]="")}),[b,t,n,h,p]),w=(0,r.useCallback)((()=>{const e=At[t],r=At[n];At[t]=r,At[n]=e}),[t,n]);return r.createElement("p",{className:"color-pair "+(b?"locked":"")},r.createElement("label",null,e,":"),r.createElement(UE,{colorName:t,value:d||i,title:`${e} background color`,disabled:b,onChange:f}),r.createElement(My,{icon:"swap",title:"Swap",onClick:w,disabled:b}),r.createElement(UE,{colorName:n,value:m||a,title:`${e} text color`,disabled:b,onChange:v}),u?r.createElement(My,{icon:b?"locked":"unlocked",title:b?"Allow editing":`Lock to ${l} color`,onClick:g}):null,s&&o?r.createElement("button",{className:"small",type:"button",onClick:y},"Suggest"):null)}function BE(e,t){var n=new nt(e),r=new nt(t);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)}function HE(e,t,n){void 0===n&&(n={includeFallbackColors:!1,level:"AA",size:"small"});for(var r=null,i=0,a=n.includeFallbackColors,s=n.level,o=n.size,l=0,c=t;l<c.length;l++){var u=c[l],d=BE(e,u);d>i&&(i=d,r=new nt(u))}return function(e,t,n){var r,i;void 0===n&&(n={level:"AA",size:"small"});var a=BE(e,t);switch((null!==(r=n.level)&&void 0!==r?r:"AA")+(null!==(i=n.size)&&void 0!==i?i:"small")){case"AAsmall":case"AAAlarge":return a>=4.5;case"AAlarge":return a>=3;case"AAAsmall":return a>=7;default:return!1}}(e,r,{level:s,size:o})||!a?r:(n.includeFallbackColors=!1,HE(e,["#fff","#000"],n))}var YE=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function KE(e){var{renderItem:t=String,className:n=""}=e,i=YE(e,["renderItem","className"]);const a=(0,r.useMemo)((()=>({view:"details",cols:[{render:t}]})),[t]);return r.createElement(Jg,Object.assign({},i,{className:`list-box ${n}`,layout:a}))}var WE=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function qE(e){return WE(this,void 0,void 0,(function*(){return!St.getUserTheme(e)||Kt({title:"My themes",message:`Overwrite existing theme '${e}'?`,okLabel:"Save",storageId:"overwrite-user-theme",system:!0})}))}var GE=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function JE(e){var{suggestedName:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["suggestedName"]);const i=(0,r.useId)(),a=(0,r.useMemo)((()=>e=>e.name),[]),[s,o]=(0,r.useState)(t),l=(0,r.useRef)(null),c=(0,r.useRef)(null),u=FE(),d=(0,r.useCallback)((e=>{o(e.target.value)}),[]),m=(0,r.useCallback)((([e])=>{e&&(c.current.value=e.name,o(e.name))}),[]),h=(0,r.useCallback)((()=>GE(this,void 0,void 0,(function*(){s&&(yield qE(s))&&l.current.close(s)}))),[s]),f=(0,r.useCallback)((e=>GE(this,void 0,void 0,(function*(){e.preventDefault(),h()}))),[h]);return r.createElement(Lt,Object.assign({},n,{className:"save-theme-dialog",title:"Save Theme",onSubmit:f,ref:l}),r.createElement("form",{method:"dialog"},r.createElement("p",{className:"prompt-message"},r.createElement("label",{htmlFor:i},"Name: "),r.createElement("input",{type:"text",id:i,defaultValue:t,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",onChange:d,ref:c})),r.createElement(KE,{title:"My themes",items:u,itemKey:"name",renderItem:a,onDoubleClick:h,onSelect:m}),r.createElement(Vt,{value:s,submitText:"Save"})))}var QE=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const XE=[{tab:"General",panel:r.createElement((function(){const e=(0,r.useId)(),t=DE(),n=(0,r.useRef)(null),i=(0,r.useRef)(null),a=(0,r.useRef)(null),s=(0,r.useMemo)((()=>At.fontSize),[]),o=(0,r.useMemo)((()=>St.getDefaultThemes()),[]),l=FE(),c=!!t.userTheme;(0,r.useEffect)((()=>{const e=document.getElementById("system").style;return e.setProperty("--font-size",String(At.fontSize)),()=>{At.restore(),e.removeProperty("--font-size")}}),[]);const u=(0,r.useCallback)((()=>At.save()),[]),d=(0,r.useCallback)((()=>{const e=a.current.checked?St.getUserTheme(i.current.value):St.getDefaultTheme(n.current.value);e&&At.apply(e)}),[]),m=(0,r.useCallback)((e=>{At.fontSize=e.target.valueAsNumber}),[]);return r.createElement("form",{className:"appearance-settings-general",method:"dialog",onSubmit:u},r.createElement("fieldset",null,r.createElement("legend",null,"Theme"),r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("input",{type:"radio",name:"theme-source",id:`${e}-default-themes`,value:"",checked:!c,onChange:d}),r.createElement("label",{htmlFor:`${e}-default-themes`},"Default themes:"),r.createElement("select",{value:c?void 0:t.name,disabled:c,onChange:d,ref:n},o.map((({name:e})=>r.createElement("option",{value:e,key:e},e))))),r.createElement("p",null,r.createElement("input",{type:"radio",name:"theme-source",id:`${e}-user-themes`,value:"user",checked:c,disabled:0===l.length,onChange:d,ref:a}),r.createElement("label",{htmlFor:`${e}-user-themes`},"My themes:"),r.createElement("select",{value:c?t.name:void 0,onChange:d,disabled:!c,ref:i},l.map((({name:e})=>r.createElement("option",{value:e,key:e},e))))))),r.createElement("fieldset",null,r.createElement("legend",null,"Preferences"),r.createElement("div",{className:"table-layout"},r.createElement("p",{className:"font-size"},r.createElement("label",{htmlFor:"theme-fontSize"},"Font Size:"),r.createElement("input",{type:"range",id:"theme-fontSize",min:12,max:28,step:.4,defaultValue:s,onChange:m})))),r.createElement(Vt,null))}),null)},{tab:"Theme Editor",panel:r.createElement((function(){const e=(0,r.useId)(),t=DE(),n=`${t.name}${At.edited?" (edited)":""}`,i=`${!!t.userTheme}/${t.name}`,[a,s]=function(e){const[t,n]=(0,r.useState)([]),[i,a]=(0,r.useState)(-1);(0,r.useEffect)((()=>{const t=new nt(e),r=m([...t.triad(),...t.tetrad(),...t.splitcomplement(),...t.analogous(),...t.monochromatic(),t.lighten(),t.darken(),t.saturate(),t.desaturate(),t.greyscale(),t.brighten()].map((e=>e.toHexString()))).map((e=>new nt(e))),i=r.reverse().map((e=>[e.toHexString(),HE(e,["black","white"],{includeFallbackColors:!0,level:"AA",size:"large"}).toHexString()]));n(f(i)),a(-1===i.length?-1:0)}),[e]);const s=(0,r.useCallback)((()=>{a((e=>e===t.length-1?-1===t.length?-1:0:e+1))}),[t]);return[t[i],s]}(t.frameColor);(0,r.useEffect)((()=>{const e=document.getElementById("system").style;return e.setProperty("--font-size",String(At.fontSize)),()=>{At.restore(),e.removeProperty("--font-size")}}),[]);const o=(0,r.useCallback)((()=>{At.save()}),[]),l=(0,r.useCallback)((()=>{!function(e){var t,n,i,a;t=this,n=void 0,a=function*(){const t=yield Dt((t=>r.createElement(JE,Object.assign({},t,{suggestedName:e}))),!0);t&&(At.name=t,At.userTheme=!0,yield St.save(At.current))},new((i=void 0)||(i=Promise))((function(e,r){function s(e){try{l(a.next(e))}catch(e){r(e)}}function o(e){try{l(a.throw(e))}catch(e){r(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(s,o)}l((a=a.apply(t,n||[])).next())}))}(t.name)}),[t]),c=(0,r.useCallback)((e=>{At.spacing=e.target.valueAsNumber}),[]),u=(0,r.useCallback)((e=>{At.roundness=e.target.valueAsNumber}),[]),d=(0,r.useCallback)((e=>{At.flat=e.target.checked}),[]);return r.createElement("form",{className:"theme-editor",method:"dialog",onSubmit:o},r.createElement("div",{className:"table-layout"},r.createElement("p",{className:"theme-name"},r.createElement("label",{htmlFor:`${e}-theme-name`},"Name:"),r.createElement("input",{type:"text",id:`${e}-theme-name`,value:n,spellCheck:!1,readOnly:!0,tabIndex:-1}),r.createElement("button",{className:"small",type:"button",onClick:l},"Save as…")),r.createElement(VE,{label:"Frame",backgroundColorName:"frameColor",textColorName:"frameTextColor",key:`${i}/frame`}),r.createElement(VE,{label:"Content",backgroundColorName:"backgroundColor",textColorName:"textColor",key:`${i}/content`}),r.createElement(VE,{label:"Selection",backgroundColorName:"selectedBackgroundColor",textColorName:"selectedTextColor",suggestedColors:a,nextSuggestion:s,key:`${i}/selection`}),r.createElement(VE,{label:"Media button",backgroundColorName:"mediaButtonColor",textColorName:"mediaButtonTextColor",defaultBackgroundColor:At.defaultMediaButtonColor,defaultTextColor:At.defaultMediaButtonTextColor,key:`${i}/media-button`}),r.createElement(VE,{label:"Button",backgroundColorName:"buttonColor",textColorName:"buttonTextColor",defaultBackgroundColor:At.defaultButtonColor,defaultTextColor:At.defaultButtonTextColor,key:`${i}/button`}),r.createElement(VE,{label:"Scrollbar",backgroundColorName:"scrollbarColor",textColorName:"scrollbarTextColor",defaultBackgroundColor:At.defaultScrollbarColor,defaultTextColor:At.defaultScrollbarTextColor,trackingColor:"button",key:`${i}/scrollbar`}),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-theme-spacing`},"Spacing:"),r.createElement("input",{type:"range",id:`${e}-theme-spacing`,min:0,max:1,step:.01,value:t.spacing,onChange:c})),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-theme-roundness`},"Roundness:"),r.createElement("input",{type:"range",id:`${e}-theme-roundness`,min:0,max:1,step:.01,value:t.roundness,onChange:u})),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-theme-flat`},"Flat:"),r.createElement("input",{type:"checkbox",id:`${e}-theme-flat`,checked:t.flat,onChange:d}))),r.createElement(Vt,null))}),null)},{tab:"My Themes",panel:r.createElement((function(){const e=(0,r.useRef)(null),t=(0,r.useMemo)((()=>e=>e.name),[]),n=(0,r.useRef)(null),i=FE(),[a,s]=(0,r.useState)(""),[o,l]=(0,r.useState)([]),[c]=o;(0,r.useEffect)((()=>{if(a){const t=i.findIndex((e=>e.name===a));-1!==t&&(e.current.selectAt(t),s(""))}}),[i,a]);const u=(0,r.useCallback)((()=>QE(this,void 0,void 0,(function*(){if(c){const e=c.name,t=yield Gt({title:"My themes",suggestedValue:e,okLabel:"Rename",system:!0});t&&(yield qE(t))&&(yield St.rename(e,t),s(t))}}))),[c]),d=(0,r.useCallback)((()=>QE(this,void 0,void 0,(function*(){if(c){const e=c.name,t=St.getUserTheme(e);if(t){const{userTheme:n}=t,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(t,["userTheme"]);!function(e,t,n="text/json"){const r=document.createElement("a");r.href=window.URL.createObjectURL(new Blob([t],{type:n})),r.download=e,r.type=n,r.click()}(`${e}.json`,JSON.stringify(r,void 0,4))}}}))),[c]),m=(0,r.useCallback)((()=>QE(this,void 0,void 0,(function*(){if(c){const e=c.name,t=yield function(e){return t=this,n=void 0,i=function*(){return Kt({title:"My themes",message:`Delete theme '${e}'?`,okLabel:"Delete",storageId:"delete-user-theme",system:!0})},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e);t&&(yield St.remove(e),l([]))}}))),[c]),h=(0,r.useCallback)((()=>{n.current.click()}),[]),f=(0,r.useCallback)((e=>QE(this,void 0,void 0,(function*(){var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];n&&(yield function(e){return t=this,n=void 0,i=function*(){const t="Import theme",n=!0;try{const r=yield e.text(),i=JSON.parse(r);if(!At.validate(i))return void(yield _t({title:t,message:"Not a valid theme.",system:n}));let a=i.name,s=!1;for(;a&&!s;)a=yield Gt({title:t,suggestedValue:a,okLabel:"Import",system:n}),a&&(s=yield qE(a),s&&(yield St.save(Object.assign(Object.assign({},i),{name:a}))))}catch(e){console.error(e),yield _t({title:t,message:"Could not load theme.",system:n})}},new((r=void 0)||(r=Promise))((function(e,a){function s(e){try{l(i.next(e))}catch(e){a(e)}}function o(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(s,o)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(n),e.target.value="")}))),[]);return r.createElement("form",{className:"user-themes",method:"dialog"},r.createElement("h3",null,"My themes:"),r.createElement(KE,{title:"My themes",items:i,itemKey:"name",renderItem:t,onDelete:m,onSelect:l,listViewRef:e}),r.createElement("p",{className:"user-themes-buttons"},r.createElement("button",{type:"button",onClick:u,disabled:!c},"Rename…"),r.createElement("button",{type:"button",onClick:d,disabled:!c},"Export…"),r.createElement("button",{className:"user-themes-delete",type:"button",onClick:m,disabled:!c},"Delete")),r.createElement("fieldset",{className:"user-themes-import"},r.createElement("legend",null,"Import themes"),r.createElement("p",null,r.createElement("input",{type:"file",accept:"text/json,.json",onChange:f,ref:n}),r.createElement("button",{type:"button",onClick:h},"Import…"))),r.createElement(Vt,null))}),null)}];function ZE({lookupRef:e,onSubmit:t}){const n=(0,r.useId)(),i=_m.preferredService;return r.createElement("form",{className:"lookup-settings",method:"dialog",onSubmit:t},r.createElement("label",{htmlFor:`${n}-lookup-services`},"Preferred Service:"),r.createElement("select",{id:`${n}-lookup-services`,defaultValue:i,ref:e},r.createElement("option",{value:""},"(none)"),_d().map((e=>r.createElement("option",{value:e.id,key:e.id},e.name)))),r.createElement("div",{className:"note"},r.createElement("p",null,"To enable playback from last.fm and ListenBrainz, Ampcast will search your logged in services to find a match."),r.createElement("p",null,"Exact matches are preferred. If you have several exact matches then the match from the preferred lookup service is used.")),r.createElement(Vt,null))}var ek=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function tk(){const e=(0,r.useId)(),t=(0,r.useRef)(null),n=(0,r.useCallback)((()=>ek(this,void 0,void 0,(function*(){Zr.useMusicKitBeta=t.current.checked,(yield Kt({title:"Reload required",message:r.createElement(r.Fragment,null,r.createElement("p",null,"You need to reload for changes to take effect."),r.createElement("p",null,"Reload now?")),okLabel:"Reload",system:!0}))&&(yield Ri.logout(),location.reload())}))),[]);return r.createElement("form",{className:"apple-beta-settings",method:"dialog",onSubmit:n},r.createElement("fieldset",null,r.createElement("legend",null,"MusicKit*"),r.createElement("p",null,r.createElement("input",{type:"radio",name:"use-musickit",id:`${e}-musickit-stable`,defaultChecked:!Zr.useMusicKitBeta}),r.createElement("label",{htmlFor:`${e}-musickit-stable`},"Stable version")),r.createElement("p",null,r.createElement("input",{type:"radio",name:"use-musickit",id:`${e}-musickit-beta`,defaultChecked:Zr.useMusicKitBeta,ref:t}),r.createElement("label",{htmlFor:`${e}-musickit-beta`},"Beta version"))),r.createElement("div",{className:"note"},r.createElement("p",null,"MusicKit beta enables playback of music videos."),r.createElement("p",null,"However, this release of MusicKit is still undergoing changes and may be unstable. If you experience any problems then use the stable release."),r.createElement("p",null,"You will need to reload the page for changes to take effect. And you will need to log in again.")),r.createElement("p",null,r.createElement("small",null,"*MusicKit is a JavaScript library supplied by Apple that provides access to Apple Music services and media playback.")),r.createElement(Vt,null))}function nk({service:e}){const t=(0,r.useId)(),n=(0,r.useRef)(null),i=Jh(e.observeIsLoggedIn,!1),a=(0,r.useCallback)((()=>{const e=n.current.elements,t={};for(const n of e)t[n.value]=!n.checked;hr(t)}),[]);return r.createElement("form",{className:"media-service-settings-general",method:"dialog",onSubmit:a},r.createElement("p",null,r.createElement("button",{type:"button",className:"disconnect",onClick:e.logout,disabled:!i},i?"Disconnect...":"Not connected")),r.createElement("fieldset",{ref:n},r.createElement("legend",null,"Display"),r.createElement("ul",{className:"checkbox-list"},e.sources.map((e=>r.createElement("li",{key:e.id},r.createElement("input",{id:`${t}-${e.id}`,type:"checkbox",value:e.id,defaultChecked:mr(e)}),r.createElement("label",{htmlFor:`${t}-${e.id}`},e.title)))))),r.createElement(Vt,null))}function rk({service:e}){const t=(0,r.useId)(),n=(0,r.useRef)(null),i=e.libraryId,a=function(e){const t=Jh(e.observeIsLoggedIn,!1),[n,i]=(0,r.useState)((()=>e.audioLibraries||[]));return(0,r.useEffect)((()=>{if(t&&e.getLibraries){const t=Rn(e.getLibraries()).subscribe((t=>{e.libraries=t,i(e.audioLibraries||[])}));return()=>t.unsubscribe()}}),[e,t]),n}(e),s=(0,r.useCallback)((()=>{e.libraryId=n.current.value}),[e]);return r.createElement("form",{className:"personal-media-library-settings",method:"dialog",onSubmit:s},r.createElement("label",{htmlFor:`${t}-libraries`},"Preferred Library:"),r.createElement("select",{id:`${t}-libraries`,defaultValue:i,ref:n},a.map((({id:e,title:t})=>r.createElement("option",{value:e,key:e},t)))),r.createElement(Vt,null))}var ik=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function ak({service:e}){const t=(0,r.useMemo)((()=>e=>e.title),[]),[n,i]=(0,r.useState)((()=>xi.getPinsForService(e.id))),[a,s]=(0,r.useState)([]),o=(0,r.useCallback)((()=>ik(this,void 0,void 0,(function*(){const t=xi.getPinsForService(e.id);yield xi.unpin(t.filter((e=>-1===n.findIndex((t=>t.src===e.src)))))}))),[e,n]),l=(0,r.useCallback)((()=>{const e=a.map((e=>e.src));i((t=>t.filter((t=>!e.includes(t.src))))),s([])}),[a]);return r.createElement("form",{className:"pinned-settings",method:"dialog",onSubmit:o},r.createElement("h3",null,"Pinned playlists:"),r.createElement(KE,{title:"Pinned playlists",items:n,itemKey:"src",multiple:!0,renderItem:t,onDelete:l,onSelect:s}),r.createElement("p",{className:"pinned-settings-buttons"},r.createElement("button",{type:"button",disabled:0===a.length,onClick:l},"Remove")),r.createElement(Vt,null))}function sk({service:e}){const t=(0,r.useId)(),n=(0,r.useRef)(null),i=(0,r.useRef)(null),a=(0,r.useMemo)((()=>Fd().filter((e=>!qd(e)))),[]),s=(0,r.useCallback)((()=>{const t=n.current.elements,r={};for(const e of t)r[e.value]=!e.checked;jb(e,r);const a=i.current.elements,s={};for(const e of a)s[e.value]=e.checked;Rb(e,s)}),[e]);return r.createElement("form",{className:"scrobbling-settings",method:"dialog",onSubmit:s},r.createElement("fieldset",{ref:n},r.createElement("legend",null,"Scrobble"),r.createElement("ul",null,a.map((n=>r.createElement("li",{key:n.id},r.createElement("input",{id:`${t}-${n.id}`,type:"checkbox",value:n.id,defaultChecked:zb(e,n),disabled:"youtube"===n.id}),r.createElement("label",{htmlFor:`${t}-${n.id}`},n.name)))))),r.createElement("fieldset",{ref:i},r.createElement("legend",null,"Options"),r.createElement("ul",null,r.createElement("li",null,r.createElement("input",{id:`${t}-scrobbling-options`,type:"checkbox",value:"updateNowPlaying",defaultChecked:Lb(e)}),r.createElement("label",{htmlFor:`${t}-scrobbling-options`},'Update "Now Playing"')))),r.createElement(Vt,null))}function ok({service:e}){const t=(0,r.useMemo)((()=>{const t=[{tab:"General",panel:r.createElement(nk,{service:e})}];return"libraryId"in e&&t.push({tab:"Library",panel:r.createElement(rk,{service:e})}),e.serviceType===vr.Scrobbler&&t.push({tab:"Scrobbling",panel:r.createElement(sk,{service:e})}),e.createSourceFromPin&&t.push({tab:"Pinned",panel:r.createElement(ak,{service:e})}),"apple"===e.id&&t.push({tab:"Beta",panel:r.createElement(tk,null)}),t}),[e]);return r.createElement(RE,{className:`media-service-settings ${e.id}-settings`,items:t,label:e.name})}const lk=[{tab:"General",panel:r.createElement((function(){const e=(0,r.useId)(),t=(0,r.useMemo)((()=>lh.get()),[]),n=Jh(lh.observe,t),i=(0,r.useRef)(null),a=(0,r.useRef)(null),s=(0,r.useRef)(null),o=(0,r.useRef)(null),l=(0,r.useCallback)((()=>{lh.set(t)}),[t]),c=(0,r.useCallback)((()=>{lh.set({allowDuplicates:i.current.checked,showLineNumbers:a.current.checked,zeroPadLineNumbers:s.current.checked,showSourceIcons:o.current.checked})}),[]);return r.createElement("form",{className:"playlist-settings-general",method:"dialog"},r.createElement("fieldset",null,r.createElement("legend",null,"Content"),r.createElement("p",null,r.createElement("input",{id:`${e}-allow-duplicates`,type:"checkbox",checked:n.allowDuplicates,onChange:c,ref:i}),r.createElement("label",{htmlFor:`${e}-allow-duplicates`},"Allow duplicates"))),r.createElement("fieldset",null,r.createElement("legend",null,"Display"),r.createElement("p",null,r.createElement("input",{id:`${e}-item-numbers`,type:"checkbox",checked:n.showLineNumbers,onChange:c,ref:a}),r.createElement("label",{htmlFor:`${e}-item-numbers`},"Show line numbers")),r.createElement("p",null,r.createElement("input",{id:`${e}-zero-pad`,type:"checkbox",checked:n.zeroPadLineNumbers,disabled:!n.showLineNumbers,onChange:c,ref:s}),r.createElement("label",{htmlFor:`${e}-zero-pad`},"Zero pad line numbers")),r.createElement("p",null,r.createElement("input",{id:`${e}-source-icons`,type:"checkbox",checked:n.showSourceIcons,onChange:c,ref:o}),r.createElement("label",{htmlFor:`${e}-source-icons`},"Show media source icons"))),r.createElement(Vt,{onCancel:l}))}),null)}];function ck({providerRef:e,ambientVideoEnabled:t,onSubmit:n}){const i=(0,r.useId)(),a=bf.provider;return r.createElement("form",{className:"visualizer-settings-general",method:"dialog"},r.createElement("p",null,r.createElement("label",{htmlFor:`${i}-visualizer-provider`},"Provider:"),r.createElement("select",{id:`${i}-visualizer-provider`,defaultValue:a,ref:e},r.createElement("option",{value:"none"},"(none)"),r.createElement("option",{value:""},"(random)"),ub().filter((e=>"ambientvideo"!==e.id||t)).map((e=>r.createElement("option",{value:e.id,key:e.id},e.name))))),r.createElement(Vt,{onSubmit:n}))}function uk({ambientVideoEnabledRef:e,ambientVideoSourceRef:t,useAmbientVideoSourceRef:n,beatsOverlayEnabledRef:i,onAmbientVideoEnabledChange:a,onSubmit:s}){const o=(0,r.useId)(),[l,c]=(0,r.useState)((()=>!!bf.useAmbientVideoSource)),u=(0,r.useCallback)((()=>{t.current.validity.valid||n.current.checked||(t.current.value=""),c(n.current.checked)}),[t,n]),d=(0,r.useCallback)((()=>{const e=t.current.value;let n="Not a valid YouTube url.";/^https?/.test(e)&&/youtu\.?be/.test(e)&&(n="Not a YouTube video or playlist.",qo(e)&&(n="")),t.current.setCustomValidity(n)}),[t]),m=(0,r.useCallback)((()=>{a(e.current.checked)}),[e,a]);return r.createElement("form",{className:"ambient-video-settings",method:"dialog"},r.createElement("p",null,r.createElement("input",{id:`${o}-ambient-video-enabled`,type:"checkbox",defaultChecked:bf.ambientVideoEnabled,onChange:m,ref:e}),r.createElement("label",{htmlFor:`${o}-ambient-video-enabled`},"Enable ambient video")),r.createElement("fieldset",null,r.createElement("legend",null,"Source"),r.createElement("p",null,r.createElement("input",{type:"radio",name:"video-source",id:`${o}-source-default`,defaultChecked:!bf.useAmbientVideoSource,onChange:u}),r.createElement("label",{htmlFor:`${o}-source-default`},"Default videos")),r.createElement("p",null,r.createElement("input",{type:"radio",name:"video-source",id:`${o}-source-youtube`,defaultChecked:bf.useAmbientVideoSource,onChange:u,ref:n}),r.createElement("label",{id:`${o}-source-youtube-label`,htmlFor:`${o}-source-youtube`},"YouTube video or playlist:")),r.createElement("p",null,r.createElement("input",{type:"url",defaultValue:bf.ambientVideoSource,disabled:!l,required:l,onInput:d,"aria-labelledby":`${o}-source-youtube-label`,ref:t}))),r.createElement("p",null,r.createElement("input",{id:`${o}-beats-overlay`,type:"checkbox",defaultChecked:bf.beatsOverlay,ref:i}),r.createElement("label",{htmlFor:`${o}-beats-overlay`},'Show "beats" overlay')),r.createElement(Vt,{onSubmit:s}))}function dk(){const e=(0,r.useRef)(null),t=(0,r.useRef)(null),n=(0,r.useRef)(null),i=(0,r.useRef)(null),a=(0,r.useRef)(null),[s,o]=(0,r.useState)(bf.ambientVideoEnabled),l=(0,r.useCallback)((()=>{bf.provider=e.current.value,bf.ambientVideoEnabled=t.current.checked,bf.useAmbientVideoSource=i.current.checked,bf.ambientVideoSource=n.current.value,bf.beatsOverlay=a.current.checked}),[]),c=(0,r.useMemo)((()=>[{tab:"General",panel:r.createElement(ck,{providerRef:e,ambientVideoEnabled:s,onSubmit:l})},{tab:"Ambient Video",panel:r.createElement(uk,{ambientVideoEnabledRef:t,ambientVideoSourceRef:n,useAmbientVideoSourceRef:i,beatsOverlayEnabledRef:a,onAmbientVideoEnabledChange:o,onSubmit:l})}]),[s,l]);return r.createElement(RE,{className:"visualizer-settings",items:c,label:"Visualizers"})}function mk(e){return r.createElement(Lt,Object.assign({},e,{className:"settings-dialog visualizer-settings-dialog",title:"Visualizer Settings"}),r.createElement(dk,null))}const hk=[{id:"services",label:r.createElement(Ki,{text:"Media Services",icon:"globe"}),value:r.createElement((function(){const e=(0,r.useRef)(null),t=(0,r.useRef)(null),n=(0,r.useCallback)((()=>{const n=e.current.elements,r={};for(const e of n)"checkbox"===e.type&&(r[e.value]=!e.checked);hr(r),_m.preferredService=t.current.value}),[]),i=(0,r.useMemo)((()=>[{tab:"General",panel:r.createElement(Jd,{onSubmit:n,servicesRef:e})},{tab:"Lookup",panel:r.createElement(ZE,{onSubmit:n,lookupRef:t})}]),[n]);return r.createElement(RE,{className:"media-library-settings",items:i,label:"Media Services"})}),null),startExpanded:!0,children:Fd().map((e=>({id:e.id,label:r.createElement(Ki,{icon:e.icon,text:e.name}),value:r.createElement(ok,{service:e,key:e.id})})))},{id:"visualizer",label:r.createElement(Ki,{text:"Visualizer",icon:"visualizer"}),value:r.createElement(dk,null)},{id:"playlist",label:r.createElement(Ki,{text:"Playlist",icon:"playlist"}),value:r.createElement((function(){return r.createElement(RE,{className:"playlist-settings",items:lk,label:"Playlist Settings"})}),null)},{id:"appearance",label:r.createElement(Ki,{text:"Appearance",icon:"palette"}),value:r.createElement((function(){return r.createElement(RE,{className:"appearance-settings",items:XE,label:"Appearance"})}),null)}],fk=()=>hk,pk=new D("settings-sources");function vk(e){const t=fk(),[n,i]=(0,r.useState)(null);return r.createElement(Lt,Object.assign({},e,{className:"settings-dialog",title:"Settings"}),r.createElement(sr,{className:"settings-dialog-sources",roots:t,storageId:pk.id,onSelect:i}),r.createElement("div",{className:"settings-dialog-source"},n))}const bk=(0,r.memo)((function(){const[e,t]=(0,r.useState)(null),n=(0,r.useCallback)((()=>{Dt(vk,!0)}),[]);return r.createElement("div",{className:"media-library"},r.createElement("header",{className:"media-library-head"},r.createElement("h1",{className:"media-library-title"},r.createElement("span",{className:"app-name"},r.createElement($t,{className:"app-icon",name:"ampcast"}),r.createElement("span",{className:"app-text"},"ampcast"))," ",r.createElement("span",{className:"app-version"},"0.8.22")),r.createElement(My,{icon:"settings",className:"in-frame",title:"Settings",onClick:n})),r.createElement("div",{className:"media-library-body"},r.createElement(Nt,{id:"media-library-layout",arrange:"columns",primaryIndex:1},r.createElement($E,{onSelect:t}),e||r.createElement(Qh,null))))})),yk=new N("visualizer"),gk={providerId:"none",name:""},wk=new $e(gk),Ek=new Oe,kk=[...Array(75).fill("butterchurn"),...Array(10).fill("ampshader"),...Array(4).fill("audiomotion"),...Array(1).fill("waveform")],xk=[...Array(70).fill("ampshader"),...Array(10).fill("spotifyviz")],Sk=Array(10).fill("ambientvideo"),Tk=Array(20).fill("ambientvideo");function Ak(){return wk}function Pk(){return Ck().pipe(wn((e=>db(e))),Un((e=>e?e.observeVisualizers():Gn([]))))}function Ik(){return yf().pipe(wn((e=>!!e.lockedVisualizer)),Or())}function Ck(){return yf().pipe(wn((e=>e.provider||"")),Or())}function Mk(e){Ek.next(e)}function Ok(){bf.lockedVisualizer=wk.getValue()}function Nk(){bf.lockedVisualizer=null}function $k(e,t=1){var n;null===(n=db(e))||void 0===n||n.observeVisualizers().pipe(fr((e=>0===e.length)),Wu(Ak()),Re((([,e])=>{e===gk&&Mk("sync")})),Br(t)).subscribe(yk)}function zk(){return Jh(Ak,null)}function jk(e){const[t,n]=(0,r.useState)(null);return(0,r.useEffect)((()=>{null==t&&null!=e&&n(e)}),[t,e]),t}function Lk({visualizer:e}){return r.createElement("article",{className:"visualizer-info"},r.createElement(Rk,{visualizer:e}),r.createElement(Dk,{visualizer:e}))}function Rk({visualizer:e}){return r.createElement("h3",null,"Visualizer: ",function(e){if(e){const t=db(e.providerId);if(t)return t.name}return"none"}(e))}function Dk({visualizer:e}){var t;const n="ambientvideo"===(null==e?void 0:e.providerId)&&e.src.startsWith("youtube:"),i=e?e.externalUrl||(null===(t=db(e.providerId))||void 0===t?void 0:t.externalUrl):void 0;return n?r.createElement(Fk,{visualizer:e}):(null==e?void 0:e.name)?r.createElement(r.Fragment,null,r.createElement("h4",null,"Name: ",e.name),i?r.createElement("p",{className:"external-view"},r.createElement("span",null,"Url:")," ",r.createElement(uo,{href:i})):null):null}function Fk({visualizer:e}){const t=function(e){const[t,,n]=e.split(":"),[i,a]=(0,r.useState)(null);return(0,r.useEffect)((()=>{if(a(null),"youtube"===t&&n){const e=Rn(Jo(n)).subscribe(a);return()=>e.unsubscribe()}}),[t,n]),i}(e.src);return t?r.createElement("div",{className:"youtube-video-info"},r.createElement("h4",null,"Title: ",t.title),r.createElement(wg,{owner:t.owner,src:t.src}),r.createElement("p",{className:"external-view"},"View on YouTube: ",r.createElement($t,{name:"youtube"})," ",r.createElement(uo,{href:t.externalUrl}))):null}function _k(e){const t=(0,r.useRef)(null),{debug:n}=Cg(t),i=ew(),a=zk(),s=jk(i),o=jk(a);return r.createElement(Lt,Object.assign({},e,{className:"currently-playing-dialog media-info-dialog",title:"Media Info",ref:t}),r.createElement("form",{method:"dialog"},s?r.createElement(dg,{item:s,debug:n}):r.createElement("p",null,"The playlist is empty."),s&&s.mediaType!==kr.Video?r.createElement(Lk,{visualizer:o}):null,r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",null,"Close"))))}function Uk(){const e=(0,r.useRef)(null),t=(0,r.useRef)(null);return(0,r.useEffect)((()=>{let e;const n=()=>{const r=t.current,i=r.getContext("2d"),a=i.createImageData(r.width,r.height),s=new Uint32Array(a.data.buffer);for(let e=0;e<s.length;e++)s[e]=(255*Math.random()|0)<<24;i.putImageData(a,0,0),e=requestAnimationFrame((()=>n()))};return e=requestAnimationFrame((()=>n())),()=>cancelAnimationFrame(e)}),[]),Pt(e,(()=>{const n=t.current,r=e.current.getBoundingClientRect();n.width=r.width,n.height=r.height})),r.createElement("div",{className:"static",ref:e},r.createElement("canvas",{ref:t}))}Eh().pipe(cm(200)).subscribe((()=>Mk("item"))),pb.observeError().subscribe((()=>Mk("error"))),Pk().subscribe((()=>Mk("provider"))),Ek.pipe(qn((e=>"click"===e?sn(50):Gn(void 0)))).pipe(Wu(Eh(),yf()),wn((([e,t,n])=>function(e,t,n){if(!e||e.mediaType===kr.Video||e.duration<30)return gk;const r="error"===n,i=e.src.startsWith("spotify:"),a=t.lockedVisualizer;let s=(null==a?void 0:a.providerId)||t.provider;switch(s){case"spotifyviz":if(!i)return gk;break;case"audiomotion":case"butterchurn":if(i)return gk;break;case"none":return gk}if(a)return r?gk:function(e,t){return mb(e).find((e=>e.name===t))}(a.providerId,a.name)||gk;const o=wk.getValue();if(s=t.provider,!s){let e=i?xk:kk;t.ambientVideoEnabled&&(e=e.concat(i?Tk:Sk)),s=E(e),"click"===n&&s===o.providerId&&1===mb(s).length&&(s=E(e,s))}const l=mb(s);return r&&t.provider&&1===l.length?gk:E(l,o)||gk}(t,n,e)))).subscribe(wk),Ak().pipe(Re((e=>pb.load(e)))).subscribe(yk),$k("ampshader"),$k("butterchurn",2);const Vk=(0,r.memo)((function(){const e=Jh(Pk,[]),t=Jh(Ik,!1),n=Jh(Ck,void 0),i="none"!==n,a=!t&&(!n||e.length>1),s=function(){const e=ew(),t=zk(),[n,i]=(0,r.useState)("");return(0,r.useEffect)((()=>{(null==e?void 0:e.src.startsWith("youtube:"))?i("youtube"):(null==e?void 0:e.src.startsWith("apple:"))&&(null==e?void 0:e.mediaType)===kr.Video?i("apple"):"ambientvideo"===(null==t?void 0:t.providerId)&&(null==t?void 0:t.src.startsWith("youtube:"))?i("youtube"):i("")}),[e,t]),n}(),[o,l]=(0,r.useState)(0),c=(0,r.useCallback)((()=>{Dt(_k)}),[]),u=(0,r.useCallback)((()=>{Dt(mk,!0)}),[]),d=(0,r.useCallback)((()=>{l(o+1),0===o&&setTimeout((()=>Mk("click")))}),[o]);return(0,r.useEffect)((()=>{if(o){const e=sn(500).subscribe((()=>l(0)));return()=>e.unsubscribe()}}),[o]),r.createElement("div",{className:"visualizer-controls"},i&&o?r.createElement(Uk,null):null,r.createElement(Ny,{className:"visualizer-controls-settings"},r.createElement(My,{className:"with-overlay",icon:"info",title:"Info",tabIndex:-1,onClick:c}),r.createElement(My,{className:"with-overlay",icon:"settings",title:"Settings",tabIndex:-1,onClick:u})),i?r.createElement(Ny,{className:"visualizer-controls-selector"},r.createElement(My,{className:"with-overlay",icon:t?"locked":"unlocked",title:t?"Unlock":"Lock the current visualizer",tabIndex:-1,onClick:t?Nk:Ok}),a?r.createElement(My,{className:"with-overlay",icon:"right",title:"Next visualizer",tabIndex:-1,onClick:d}):null):null,s?r.createElement($t,{className:"source-icon",name:s}):null)}));function Bk(){return Jh(dy,!0)}const Hk=(0,r.memo)((function(){var e;const t=ew(),n=Bk(),i=function(){const[e,t]=(0,r.useState)("searching"),n=ew(),i=null==n?void 0:n.id;return(0,r.useEffect)((()=>t("searching")),[i]),(0,r.useEffect)((()=>{switch(null==n?void 0:n.lookupStatus){case bm.Looking:t("searching");break;case bm.NotFound:t("error");break;default:if(n){if(Hd(n)){t("loading");const e=new se;return e.add(fy().pipe(Br(1)).subscribe((()=>t("playing")))),e.add(uy().pipe(Br(1)).subscribe((()=>t("error")))),()=>e.unsubscribe()}t("searching")}else t("playing")}}),[n]),e}(),[a,s]=(0,r.useState)(!1),[o,l]=(0,r.useState)(!1),c=null==t?void 0:t.id;return(0,r.useEffect)((()=>{l(!0);const e=setTimeout((()=>l(!1)),5e3);return()=>clearTimeout(e)}),[c]),(0,r.useEffect)((()=>{if("error"===i)s(!0),l(!1);else if(s(!1),"playing"===i){const e=setTimeout((()=>s(!0)),4500);return()=>clearTimeout(e)}}),[i]),r.createElement("div",{className:`interstitial ${i} ${a?"ready":""} ${o?"is-recent":""}`},r.createElement("div",{className:"currently-playing"},t?r.createElement(r.Fragment,null,r.createElement("h2",null,t.title),(null===(e=t.artists)||void 0===e?void 0:e.length)?r.createElement(r.Fragment,null,r.createElement("span",{className:"by"},"by"),r.createElement("h3",null,t.artists.join(", "))):null):r.createElement("p",null,"The playlist is empty.")),r.createElement("p",{className:"interstitial-state"},n?"":"error"===i?i:`${i}...`))}));n(6234);const Yk=(0,r.memo)((function(){const e=(0,r.useRef)(null),[t,n]=(0,r.useState)(!1),i=ew(),a=(null==i?void 0:i.mediaType)===kr.Video,s=function(e,t=200){const[n,i]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{if(e){const n=In(e,"mousemove").pipe(Re((()=>i(!0))),cm(t),Re((()=>i(!1)))).subscribe();return()=>n.unsubscribe()}i(!1)}),[e,t]),n}(e.current,4e3),o=zk(),l=!o||"none"===o.providerId;(0,r.useEffect)((()=>{Iy.appendTo(e.current)}),[]),(0,r.useEffect)((()=>{const t=In(document,"fullscreenchange").pipe(wn((()=>document.fullscreenElement===e.current))).subscribe(n);return()=>t.unsubscribe()}),[]),Pt(e,(()=>{const t=e.current;Iy.resize(t.clientWidth,t.clientHeight)}));const c=(0,r.useCallback)((()=>{t?document.exitFullscreen():e.current.requestFullscreen()}),[t]);return r.createElement("div",{className:`panel media ${a?"is-playing-video":""} ${l?"no-visualizer":""}  ${s?"":"idle"}`,onDoubleClick:c,ref:e},r.createElement("div",{id:"playback"}),r.createElement(Hk,null),r.createElement(Vk,null))}));var Kk=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Wk(e){var{icon:t,className:n=""}=e,i=Kk(e,["icon","className"]);const a=(0,r.useRef)(null),s=(0,r.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),a.current.classList.toggle("active",!0)}),[]);return r.createElement("button",Object.assign({},i,{className:`media-button media-button-${t} ${n}`,type:"button",onMouseDown:s,ref:a}),r.createElement($t,{name:t}))}const qk=(0,r.memo)((function(){const[e,t]=(0,r.useState)((()=>Iy.muted)),[n,i]=(0,r.useState)((()=>Iy.volume)),a=n<=.33?"low":n<=.67?"medium":"high";(0,r.useEffect)((()=>{Iy.muted=e}),[e]),(0,r.useEffect)((()=>{Iy.volume=n}),[n]);const s=(0,r.useCallback)((e=>{const n=e.target.valueAsNumber;i(n),t(0===n)}),[]),o=(0,r.useCallback)((()=>{i((t=>e?t||.1:t)),t(!e)}),[e]);return r.createElement("div",{className:`volume-control volume-${a}`},r.createElement(My,{icon:e?"muted":"volume",className:"in-frame","aria-label":e?"Unmute":"Mute",title:e?"unmute":"mute",onClick:o}),r.createElement("input",{type:"range","aria-label":"Volume",min:0,max:1,step:.01,value:e?0:n,onChange:s}))}));function Gk(e){const t=Jh(kh,xh()),n=Bk();return r.createElement($y,Object.assign({},e),r.createElement(Ry,{label:"Stop after current",value:"stop-after-current",checked:Iy.stopAfterCurrent,disabled:n,key:"stop-after-current"}),r.createElement(jy,{label:"Jump to current",value:"jump-to-current",disabled:-1===t,key:"jump-to-current"}),r.createElement(Dy,null),r.createElement(jy,{label:"Shuffle",value:"shuffle",key:"shuffle"}),r.createElement(Dy,null),r.createElement(jy,{label:"Clear",value:"clear",key:"clear"}))}var Jk=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};function Qk({listViewRef:e}){const t=Jh(kh,-1),n=Jh(oy,0),i=Jh(ly,0),a=Bk(),s=(0,r.useCallback)((e=>{yy(e.target.valueAsNumber)}),[]),o=(0,r.useCallback)((n=>Jk(this,void 0,void 0,(function*(){const i=e.current,s=n.target.getBoundingClientRect();switch(yield function(e,t){return n=this,i=void 0,s=function*(){return _y((e=>r.createElement(Gk,Object.assign({},e))),e,t)},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{l(s.next(e))}catch(e){t(e)}}function o(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(r,o)}l((s=s.apply(n,i||[])).next())}));var n,i,a,s}(s.right,s.bottom+4)){case"jump-to-current":i.scrollIntoView(t),i.focus();break;case"stop-after-current":Iy.stopAfterCurrent=!Iy.stopAfterCurrent;break;case"clear":Oh.clear();break;case"shuffle":yield Oh.shuffle(!a),i.scrollIntoView(0)}}))),[e,t,a]),l=(0,r.useCallback)((()=>Jk(this,void 0,void 0,(function*(){Oh.atStart||(Iy.prev(),e.current.scrollIntoView(t-1))}))),[e,t]),c=(0,r.useCallback)((()=>Jk(this,void 0,void 0,(function*(){Oh.atEnd||(Iy.next(),e.current.scrollIntoView(t+1))}))),[e,t]);return r.createElement("div",{className:"media-controls"},r.createElement("div",{className:"current-time-control"},r.createElement(sw,{time:n}),r.createElement("input",{id:"playhead",type:"range","aria-label":"Seek",min:0,max:i,step:1,value:n,disabled:a,onChange:s})),r.createElement("div",{className:"playback-control"},r.createElement(qk,null),r.createElement("div",{className:"media-buttons"},r.createElement(Wk,{"aria-label":"Previous track",icon:"prev",onClick:l}),r.createElement(Wk,{"aria-label":a?"Play":"Pause",icon:a?"play":"pause",onClick:a?vy:by}),r.createElement(Wk,{"aria-label":"Stop",icon:"stop",onClick:gy}),r.createElement(Wk,{"aria-label":"Next track",icon:"next",onClick:c})),r.createElement("div",{className:"media-buttons-more"},r.createElement(Wk,{title:"More...",icon:"menu",onClick:o}))))}var Xk=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Zk(e){var{items:t,selectedItems:n,rowIndex:i}=e,a=Xk(e,["items","selectedItems","rowIndex"]);const s=t.length,o=n.length,l=0===s,c=o===s,u=1===o;return r.createElement($y,Object.assign({},a),-1===i?null:r.createElement(r.Fragment,null,u?r.createElement(jy,{label:"Play",value:"play",acceleratorKey:"Enter",key:"play"}):null,r.createElement(jy,{label:"Remove",value:"remove",acceleratorKey:"Del",key:"remove"}),u?r.createElement(jy,{label:"Info...",value:"info",acceleratorKey:`${K.ctrlKeyStr}+I`,key:"info"}):null),r.createElement(Dy,null),c?null:r.createElement(jy,{label:"Select all",value:"select-all",acceleratorKey:`${K.ctrlKeyStr}+A`,key:"select-all"}),!u&&function(e,t){const n=e.findIndex((e=>e===t[0]));return t.every(((t,r)=>t===e[n+r]))}(t,n)?r.createElement(jy,{label:"Reverse selection",value:"reverse-selection",key:"reverse-selection"}):null,r.createElement(Dy,null),l?null:r.createElement(jy,{label:"Clear",value:"clear",key:"clear"}))}const ex={view:"details",showTitles:!1,cols:[{title:"#",render:()=>null,align:"right",className:"index"},{title:"Source",render:function({src:e,lookupStatus:t}){const[n]=e.split(":");let i;switch(t){case bm.Looking:i="lookup-looking";break;case bm.NotFound:i="lookup-not-found";break;default:i=Yd(e)?n:"lookup-pending"}return r.createElement($t,{name:i,className:"youtube"===n?"":"show-connectivity"})},align:"center",className:"source"},{title:"Title",render:function({title:e,artists:t}){return(null==t?void 0:t.length)?r.createElement(r.Fragment,null,r.createElement("span",{className:"artist-text"},t.join("/")),r.createElement("span",{role:"separator"},"-"),r.createElement("span",{className:"title-text"},e)):r.createElement("span",{className:"title-text"},e)},className:"title"},{title:"Time",render:lw,align:"right",className:"duration"}]};var tx=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function s(e){try{l(r.next(e))}catch(e){a(e)}}function o(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(s,o)}l((r=r.apply(e,t||[])).next())}))};const nx=["audio/*","video/*"];function rx(e){var{onSelect:t,onPlay:n,onEject:i,listViewRef:a}=e,s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["onSelect","onPlay","onEject","listViewRef"]);const o=Jh(Oh.observe,[]),l=function(e){const t=ew(),n=Bk(),i=String(e).length,{zeroPadLineNumbers:a,showLineNumbers:s,showSourceIcons:o}=Jh(lh.observe,lh.get());return(0,r.useMemo)((()=>Object.assign(Object.assign({},ex),{cols:ex.cols.filter((e=>{switch(e.className){case"index":return s;case"source":return o;default:return!0}})).map((e=>"index"===e.className?Object.assign(Object.assign({},e),{render:(e,s)=>{const o=function(e,t=0){return r.createElement("span",{className:"number"},String(e+1).padStart(t,"0"))}(s,a?i:0);return e.id===(null==t?void 0:t.id)?r.createElement(r.Fragment,null,r.createElement($t,{name:n?"pause":"play"}),o):o}}):e))})),[a,s,o,i,t,n])}(o.length),c=ew(),[u,d]=(0,r.useState)(0),m=(0,r.useCallback)((e=>{const[t]=e.src.split(":");return`source-${t} ${e.id===(null==c?void 0:c.id)?"playing":""} ${e.unplayable||e.lookupStatus===bm.NotFound?"unplayable":""}`}),[c]),h=(0,r.useCallback)((e=>{d(e.length),null==t||t(e)}),[t]),f=(0,r.useCallback)((e=>{null==n||n(e)}),[n]),p=(0,r.useCallback)((e=>{1===e.length&&(null==n||n(e[0]))}),[n]),v=(0,r.useCallback)((e=>{1===e.length&&e[0]===c?null==i||i():Oh.remove(e)}),[i,c]),b=(0,r.useCallback)((([e])=>tx(this,void 0,void 0,(function*(){e&&(yield Ng(e))}))),[]),y=(0,r.useCallback)(((e,t,i,s,l)=>tx(this,void 0,void 0,(function*(){if(0===o.length)return;const c=yield function(e,t,n,i,a,s="left"){return o=this,l=void 0,u=function*(){return _y((i=>r.createElement(Zk,Object.assign({},i,{items:e,selectedItems:t,rowIndex:n}))),i,a,s)},new((c=void 0)||(c=Promise))((function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof c?e:new c((function(t){t(e)}))}(t.value).then(n,r)}i((u=u.apply(o,l||[])).next())}));var o,l,c,u}(o,e,s,t,i,-1===l?"right":"left");switch(c){case"play":null==n||n(e[0]);break;case"remove":Oh.remove(e);break;case"info":yield Ng(e[0]);break;case"select-all":a.current.selectAll();break;case"reverse-selection":{const t=o.findIndex((t=>t===e[0]));Oh.reverseAt(t,e.length);break}case"clear":Oh.clear()}}))),[n,o,a]);return r.createElement("div",{className:"playlist"},r.createElement(Jg,Object.assign({},s,{title:"Playlist",className:"media-list",layout:l,items:o,itemKey:"id",itemClassName:m,selectedIndex:0===o.length?-1:0,droppable:!0,droppableTypes:nx,multiple:!0,reorderable:!0,onContextMenu:y,onDelete:v,onDoubleClick:f,onDrop:Oh.insertAt,onEnter:p,onInfo:b,onMove:Oh.moveSelection,onSelect:h,listViewRef:a})),r.createElement(nw,{items:o,size:o.length,selectedCount:u}))}const ix=(0,r.memo)((function(){const e=(0,r.useRef)(null),t=ew(),n=Bk(),i=(0,r.useCallback)((e=>{e===t?Iy.play():(Iy.load(null),Iy.autoplay=!0,Oh.setCurrentItem(e))}),[t]);return r.createElement("div",{className:"media-playback "+(n?"paused":"")},r.createElement(Nt,{id:"media-playback-layout",arrange:"rows"},r.createElement("div",{className:"panel playback"},r.createElement(Qk,{listViewRef:e}),r.createElement(rx,{onPlay:i,onEject:ky,listViewRef:e})),r.createElement(Yk,null)))}));function ax(e){const t=e.dataTransfer;t&&(e.preventDefault(),t.effectAllowed="none",t.dropEffect="none")}function sx(e=null){var t,n;const r=navigator.mediaSession;r&&(e&&(r.metadata=new MediaMetadata({title:e.title,artist:null===(t=e.artists)||void 0===t?void 0:t.join(", "),album:e.artists?"":e.album,artwork:null===(n=e.thumbnails)||void 0===n?void 0:n.map((e=>({src:sg(e),sizes:`${e.width}x${e.height}`})))})),r.setActionHandler("play",vy),r.setActionHandler("pause",by),r.setActionHandler("stop",gy),r.setActionHandler("previoustrack",wy),r.setActionHandler("nexttrack",Ey),r.setActionHandler("seekto",(e=>{null!=e.seekTime&&yy(e.seekTime)})))}function ox(e){switch(e.key){case" ":e.target&&!("form"in e.target)&&(e.preventDefault(),lx());break;case"MediaPlayPause":e.preventDefault(),lx();break;case"MediaStop":e.preventDefault(),Iy.stop();break;case"MediaTrackPrevious":e.preventDefault(),Iy.prev();break;case"MediaTrackNext":e.preventDefault(),Iy.next()}}function lx(){Iy.paused?Iy.play():Iy.pause()}const cx=new D("desktopWarning");function ux(){const[e,t]=(0,r.useState)((()=>K.desktop||cx.getBoolean("dismissed"))),n=(0,r.useCallback)((()=>{cx.setBoolean("dismissed",!0),t(!0)}),[]);return e?null:r.createElement("div",{className:"desktop-warning"},r.createElement("h1",null,"ampcast"," ","0.8.22"),r.createElement("p",null,"This application is intended for a desktop browser."),r.createElement("p",null,r.createElement("button",{onClick:n},"Proceed")))}(0,i.s)(document.getElementById("app")).render(r.createElement(r.StrictMode,null,r.createElement((function(){return(0,r.useEffect)((()=>{document.body.classList.add(`browser-${K.name.replace(/\s+/g,"-")}`)}),[]),(0,r.useEffect)((()=>{const e=new se;return Fd().forEach((t=>{const n=t.observeIsLoggedIn().subscribe((e=>{document.body.classList.toggle(`${t.id}-connected`,e),document.body.classList.toggle(`${t.id}-not-connected`,!e)}));e.add(n)})),()=>e.unsubscribe()}),[]),(0,r.useEffect)((()=>{let e=!1;const t=document.getElementById("app"),n=document.getElementById("system"),r=new se,i=e=>In(e,"focusin").subscribe((()=>{const t=e.querySelector(".focus");t!==document.activeElement&&(null==t||t.classList.toggle("focus",!1),document.activeElement.classList.toggle("focus",!0))}));return document.activeElement.classList.toggle("focus",!0),r.add(In(document,"keydown",{capture:!0}).subscribe((()=>{e=!0}))),r.add(In(document,"mousedown",{capture:!0}).subscribe((()=>{e=!1}))),r.add(In(document,"focusin").subscribe((()=>{document.body.classList.toggle("focus-visible",e)}))),r.add(In(document,"focusout").subscribe((e=>{if(!e.relatedTarget){const e=(document.querySelector(".system .settings-dialog")?n:document).querySelectorAll(".focus");for(const t of e)t.classList.toggle("focus",!1)}}))),r.add(In(document,"mouseup",{capture:!0}).subscribe((()=>{const e=document.querySelectorAll(".active");for(const t of e)t.classList.toggle("active",!1)}))),r.add(In(n,"mousedown").subscribe(g)),r.add(i(t)),r.add(i(n)),()=>r.unsubscribe()}),[]),(0,r.useEffect)((()=>{const e=In(document,"dragenter"),t=In(document,"dragover"),n=In(document,"drop"),r=_n(e,t).pipe(Re(ax)),i=_n(r,n.pipe(Re(y))).subscribe();return()=>i.unsubscribe()}),[]),function(){const e=ew(),t=Jh(my,null),n=Jh(oy,0),i=Jh(ly,0);(0,r.useEffect)((()=>{var e;null===(e=navigator.mediaSession)||void 0===e||e.setPositionState({duration:i,position:n,playbackRate:1})}),[i,n]),(0,r.useEffect)((()=>sx(null==t?void 0:t.currentItem)),[t]),(0,r.useEffect)((()=>sx(e)),[e])}(),(0,r.useEffect)((()=>{document.getElementById("system").addEventListener("keydown",g),document.getElementById("popup").addEventListener("keydown",g),document.body.addEventListener("keydown",ox)}),[]),r.createElement("main",null,r.createElement(Nt,{id:"main-layout",arrange:"columns"},r.createElement(bk,null),r.createElement(ix,null)),r.createElement(ux,null))}),null)))}},e=>{e.O(0,[136,529,503],(()=>(8399,e(e.s=8399)))),e.O()}]);