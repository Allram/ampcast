(globalThis.webpackChunkampcast=globalThis.webpackChunkampcast||[]).push([[296],{6998:function(e){e.exports=function(e,t){if(null==t&&(t={fuzzy:!0}),/youtu\.?be/.test(e)){var n,r=[/youtu\.be\/([^#\&\?]{11})/,/\?v=([^#\&\?]{11})/,/\&v=([^#\&\?]{11})/,/embed\/([^#\&\?]{11})/,/\/v\/([^#\&\?]{11})/];for(n=0;n<r.length;++n)if(r[n].test(e))return r[n].exec(e)[1];if(t.fuzzy){var i=e.split(/[\/\&\?=#\.\s]/g);for(n=0;n<i.length;++n)if(/^[^#\&\?]{11}$/.test(i[n]))return i[n]}}return null}},745:(e,t,n)=>{"use strict";var r=n(3935);t.s=r.createRoot,r.hydrateRoot},6657:e=>{e.exports=function(e,t,n){"use strict";if(e===t)return 1;if(""===t)return 0;var r=0,i=e.toLowerCase(),a=e.length,o=t.toLowerCase(),s=t.length,l=0,c=1;n=n?1-n:0;for(var u=0;u<s;u+=1){var d=i.indexOf(o[u],l);if(-1===d){if(!n)return 0;c+=n}else{var m=0;l===d?m=.7:(m=.1," "===e[d-1]&&(m+=.8)),e[d]===t[u]&&(m+=.1),r+=m,l=d+1}}var h=.5*(r/a+r/s)/c;return o[0]===i[0]&&h<.85&&(h+=.15),h}},7784:(e,t,n)=>{"use strict";var r=n(7294),i=n(745),a=n(6657),o=n.n(a),s=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};function l(e){return null!=e}function c(e){return s(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{const r="ampcast-loaded";let i=document.querySelector(`script[src="${e}"]`);(null==i?void 0:i.hasAttribute(r))?t():(i||(i=document.createElement("script"),i.async=!0,i.src=e),i.addEventListener("load",(function(){this.setAttribute(r,""),t()})),i.addEventListener("error",(()=>n(`Failed to load script: '${e}'`))),i.parentElement||document.head.appendChild(i))}))}))}function u(e,t=1){if(t<=0)return[];const n=[...e],r=[];for(;n.length;)r.push(n.splice(0,t));return r}function d(e,t){const n=[],r=[];for(const i of e)t(i)?n.push(i):r.push(i);return[n,r]}function m(e){return e.filter(((e,t,n)=>t===n.findIndex((t=>e===t))))}function h(e,t){return e.filter(((e,n,r)=>n===r.findIndex((n=>e[t]===n[t]))))}function f(e){let t=e.length;for(;t>0;){const n=Math.floor(Math.random()*t);t--;const r=e[t];e[t]=e[n],e[n]=r}return e}function p(e=Date.now()){return`${(e=new Date(e)).getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function v(e){return p(e).slice(0,7)}function b(e){return new Date(Math.round(1e3*(e||0))).toISOString().slice(11,19).replace(/^[0:]+(.{4,})$/,"$1")}function g(e){e.preventDefault()}function y(e){e.stopPropagation()}function w(e){e.preventDefault(),e.stopPropagation()}function E(e,t){return 1===e.length?e[0]:(void 0!==t&&(e=e.filter((e=>e!==t))),e[Math.floor(Math.random()*e.length)])}function x(e,t={}){return m(Object.keys(e).concat(Object.keys(t))).reduce(((n,r)=>(void 0!==e[r]?n[r]=e[r]:void 0!==t[r]&&(n[r]=t[r]),n)),{})}function k(e,t,n){const r=e.filter(t,n);return 0===r.length?e:r}function S(e,t,n=.9){return Math.max(o()(e,t,.99),o()(t,e,.99))>=n}const C=document.createElement("p");function P(e){return C.innerHTML=e,C.textContent||""}class T{constructor(e="",t=!1,n=window.console){const r=e?` ${e}:`:"",i=(e,t)=>e&&t?`${e}/${t}`:t||e,a=(...t)=>{e.startsWith(T.only)&&n.log(...t)};this.log=(...e)=>a(`##${r}`,...e),this.warn=(...e)=>a(`###${r}`,...e),this.error=t=>{e.startsWith(T.only)&&(a(`####${r} ERROR`),n.error(t))},t&&(this.next=this.log,this.complete=()=>this.log("***complete***")),this.id=r=>new T(i(e,r),t,n),this.rx=t=>new T(i(e,t),!0,n),this.only=()=>this}}T.only="";const A=T,I=new Map,O={get length(){return I.size},clear(){I.clear()},key(e){var t;return null!==(t=[...I.keys()][e])&&void 0!==t?t:null},getItem(e){var t;return null!==(t=I.get(String(e)))&&void 0!==t?t:null},setItem(e,t){I.set(String(e),String(t))},removeItem(e){I.delete(String(e))}},M=O,N=new A("LiteStorage");class ${constructor(e,t="local"){const n=`${t}-${e}`;if($.ids.includes(n))throw Error(`Duplicate storageId: ${n}`);switch($.ids.push(n),this.id=`ampcast/${e}`,t){case"local":this.storage=localStorage;break;case"session":this.storage=sessionStorage;break;case"memory":this.storage=M}}getBoolean(e){const t=this.getItem(e);return!!t&&"false"!==t}setBoolean(e,t){this.setItem(e,String(!!t))}getJson(e,t=null){const n=this.getItem(e);try{return n?JSON.parse(n):t}catch(e){N.error(e)}return null!=t?t:null}setJson(e,t){try{null==t?this.removeItem(e):this.setItem(e,JSON.stringify(t))}catch(e){N.error(e)}}getNumber(e,t=0){var n;const r=Number(null!==(n=this.getItem(e))&&void 0!==n?n:t);return isNaN(r)?t:r}setNumber(e,t){this.setItem(e,String(Number(t)||0))}getString(e,t=""){var n;return String(null!==(n=this.getItem(e))&&void 0!==n?n:t)}setString(e,t){this.setItem(e,t)}getItem(e){return this.storage.getItem(`${this.id}/${e}`)}setItem(e,t){e=`${this.id}/${e}`,null==t?this.storage.removeItem(e):this.storage.setItem(e,t)}removeItem(e){this.storage.removeItem(`${this.id}/${e}`)}clear(){const e=`${this.id}/`,t=[];for(let n=0;n<this.storage.length;n++){const r=this.storage.key(n);r.startsWith(e)&&t.push(r)}t.forEach((e=>this.storage.removeItem(e)))}}$.ids=[];const z=$,j=(0,n(3631).qY)(),L=(null==j?void 0:j.name)||"unknown",R=/^edge/.test(L)?"Microsoft Edge":L.replace(/^\w/,(e=>e.toUpperCase())),_=(null==j?void 0:j.version)||"0",D=(null==j?void 0:j.os)||"unknown",F="Mac OS"===D?"metaKey":"ctrlKey",V="Mac OS"===D?"âŒ˜":"Ctrl",U={name:L,displayName:R,version:_,os:D,desktop:!/^(iOS|Android OS|BlackBerry OS|Windows Mobile|Amazon OS)$/.test(D),ctrlKey:F,ctrlKeyStr:V},B=new z("layout"),H={get:(e,t=0)=>B.getNumber(e,t),set(e,t){B.setNumber(e,t)}};var Y=function(e,t){return Y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Y(e,t)};function K(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Y(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function W(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}}function q(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function J(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function Q(e,t,n){if(n||2===arguments.length)for(var r,i=0,a=t.length;i<a;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function X(e){return this instanceof X?(this.v=e,this):new X(e)}function G(e){return"function"==typeof e}function Z(e){var t=e((function(e){Error.call(e),e.stack=(new Error).stack}));return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}Object.create,Object.create;var ee=Z((function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map((function(e,t){return t+1+") "+e.toString()})).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}}));function te(e,t){if(e){var n=e.indexOf(t);0<=n&&e.splice(n,1)}}var ne=function(){function e(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return e.prototype.unsubscribe=function(){var e,t,n,r,i;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var o=q(a),s=o.next();!s.done;s=o.next())s.value.remove(this)}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=o.return)&&t.call(o)}finally{if(e)throw e.error}}else a.remove(this);var l=this.initialTeardown;if(G(l))try{l()}catch(e){i=e instanceof ee?e.errors:[e]}var c=this._finalizers;if(c){this._finalizers=null;try{for(var u=q(c),d=u.next();!d.done;d=u.next()){var m=d.value;try{ae(m)}catch(e){i=null!=i?i:[],e instanceof ee?i=Q(Q([],J(i)),J(e.errors)):i.push(e)}}}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=u.return)&&r.call(u)}finally{if(n)throw n.error}}}if(i)throw new ee(i)}},e.prototype.add=function(t){var n;if(t&&t!==this)if(this.closed)ae(t);else{if(t instanceof e){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}},e.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},e.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},e.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&te(t,e)},e.prototype.remove=function(t){var n=this._finalizers;n&&te(n,t),t instanceof e&&t._removeParent(this)},e.EMPTY=((t=new e).closed=!0,t),e;var t}(),re=ne.EMPTY;function ie(e){return e instanceof ne||e&&"closed"in e&&G(e.remove)&&G(e.add)&&G(e.unsubscribe)}function ae(e){G(e)?e():e.unsubscribe()}var oe={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},se={setTimeout:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=se.delegate;return(null==i?void 0:i.setTimeout)?i.setTimeout.apply(i,Q([e,t],J(n))):setTimeout.apply(void 0,Q([e,t],J(n)))},clearTimeout:function(e){var t=se.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0};function le(e){se.setTimeout((function(){var t=oe.onUnhandledError;if(!t)throw e;t(e)}))}function ce(){}var ue=de("C",void 0,void 0);function de(e,t,n){return{kind:e,value:t,error:n}}var me=null;function he(e){if(oe.useDeprecatedSynchronousErrorHandling){var t=!me;if(t&&(me={errorThrown:!1,error:null}),e(),t){var n=me,r=n.errorThrown,i=n.error;if(me=null,r)throw i}}else e()}var fe=function(e){function t(t){var n=e.call(this)||this;return n.isStopped=!1,t?(n.destination=t,ie(t)&&t.add(n)):n.destination=Ee,n}return K(t,e),t.create=function(e,t,n){return new ge(e,t,n)},t.prototype.next=function(e){this.isStopped?we(function(e){return de("N",e,void 0)}(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?we(de("E",void 0,e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?we(ue,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(ne),pe=Function.prototype.bind;function ve(e,t){return pe.call(e,t)}var be=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){ye(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){ye(e)}else ye(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){ye(e)}},e}(),ge=function(e){function t(t,n,r){var i,a,o=e.call(this)||this;return G(t)||!t?i={next:null!=t?t:void 0,error:null!=n?n:void 0,complete:null!=r?r:void 0}:o&&oe.useDeprecatedNextContext?((a=Object.create(t)).unsubscribe=function(){return o.unsubscribe()},i={next:t.next&&ve(t.next,a),error:t.error&&ve(t.error,a),complete:t.complete&&ve(t.complete,a)}):i=t,o.destination=new be(i),o}return K(t,e),t}(fe);function ye(e){var t;oe.useDeprecatedSynchronousErrorHandling?(t=e,oe.useDeprecatedSynchronousErrorHandling&&me&&(me.errorThrown=!0,me.error=t)):le(e)}function we(e,t){var n=oe.onStoppedNotification;n&&se.setTimeout((function(){return n(e,t)}))}var Ee={closed:!0,next:ce,error:function(e){throw e},complete:ce},xe="function"==typeof Symbol&&Symbol.observable||"@@observable";function ke(e){return e}var Se=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var r=this,i=function(e){return e&&e instanceof fe||function(e){return e&&G(e.next)&&G(e.error)&&G(e.complete)}(e)&&ie(e)}(e)?e:new ge(e,t,n);return he((function(){var e=r,t=e.operator,n=e.source;i.add(t?t.call(i,n):n?r._subscribe(i):r._trySubscribe(i))})),i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=Ce(t))((function(t,r){var i=new ge({next:function(t){try{e(t)}catch(e){r(e),i.unsubscribe()}},error:r,complete:t});n.subscribe(i)}))},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[xe]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0===(n=e).length?ke:1===n.length?n[0]:function(e){return n.reduce((function(e,t){return t(e)}),e)})(this);var n},e.prototype.toPromise=function(e){var t=this;return new(e=Ce(e))((function(e,n){var r;t.subscribe((function(e){return r=e}),(function(e){return n(e)}),(function(){return e(r)}))}))},e.create=function(t){return new e(t)},e}();function Ce(e){var t;return null!==(t=null!=e?e:oe.Promise)&&void 0!==t?t:Promise}var Pe=Z((function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})),Te=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return K(t,e),t.prototype.lift=function(e){var t=new Ae(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new Pe},t.prototype.next=function(e){var t=this;he((function(){var n,r;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var i=q(t.currentObservers),a=i.next();!a.done;a=i.next())a.value.next(e)}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(n)throw n.error}}}}))},t.prototype.error=function(e){var t=this;he((function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var n=t.observers;n.length;)n.shift().error(e)}}))},t.prototype.complete=function(){var e=this;he((function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}}))},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,n=this,r=n.hasError,i=n.isStopped,a=n.observers;return r||i?re:(this.currentObservers=null,a.push(e),new ne((function(){t.currentObservers=null,te(a,e)})))},t.prototype._checkFinalizedStatuses=function(e){var t=this,n=t.hasError,r=t.thrownError,i=t.isStopped;n?e.error(r):i&&e.complete()},t.prototype.asObservable=function(){var e=new Se;return e.source=this,e},t.create=function(e,t){return new Ae(e,t)},t}(Se),Ae=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return K(t,e),t.prototype.next=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===n||n.call(t,e)},t.prototype.error=function(e){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===n||n.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,n;return null!==(n=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==n?n:re},t}(Te),Ie=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return K(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){var e=this,t=e.hasError,n=e.thrownError,r=e._value;if(t)throw n;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(Te);function Oe(e){return function(t){if(function(e){return G(null==e?void 0:e.lift)}(t))return t.lift((function(t){try{return e(t,this)}catch(e){this.error(e)}}));throw new TypeError("Unable to lift unknown Observable type")}}function Me(e,t,n,r,i){return new Ne(e,t,n,r,i)}var Ne=function(e){function t(t,n,r,i,a,o){var s=e.call(this,t)||this;return s.onFinalize=a,s.shouldUnsubscribe=o,s._next=n?function(e){try{n(e)}catch(e){t.error(e)}}:e.prototype._next,s._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,s._complete=r?function(){try{r()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,s}return K(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;e.prototype.unsubscribe.call(this),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}},t}(fe);function $e(e,t,n){var r=G(e)||t||n?{next:e,error:t,complete:n}:e;return r?Oe((function(e,t){var n;null===(n=r.subscribe)||void 0===n||n.call(r);var i=!0;e.subscribe(Me(t,(function(e){var n;null===(n=r.next)||void 0===n||n.call(r,e),t.next(e)}),(function(){var e;i=!1,null===(e=r.complete)||void 0===e||e.call(r),t.complete()}),(function(e){var n;i=!1,null===(n=r.error)||void 0===n||n.call(r,e),t.error(e)}),(function(){var e,t;i&&(null===(e=r.unsubscribe)||void 0===e||e.call(r)),null===(t=r.finalize)||void 0===t||t.call(r)})))})):ke}function ze(e,t){return Oe((function(n,r){var i=0;n.subscribe(Me(r,(function(n){return e.call(t,n,i++)&&r.next(n)})))}))}function je(e,t){(function(e){return"string"==typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)})(e)&&(e="100%");var n=function(e){return"string"==typeof e&&-1!==e.indexOf("%")}(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t))}function Le(e){return Math.min(1,Math.max(0,e))}function Re(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function _e(e){return e<=1?"".concat(100*Number(e),"%"):e}function De(e){return 1===e.length?"0"+e:String(e)}function Fe(e,t,n){e=je(e,255),t=je(t,255),n=je(n,255);var r=Math.max(e,t,n),i=Math.min(e,t,n),a=0,o=0,s=(r+i)/2;if(r===i)o=0,a=0;else{var l=r-i;switch(o=s>.5?l/(2-r-i):l/(r+i),r){case e:a=(t-n)/l+(t<n?6:0);break;case t:a=(n-e)/l+2;break;case n:a=(e-t)/l+4}a/=6}return{h:a,s:o,l:s}}function Ve(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*n*(t-e):n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function Ue(e,t,n){e=je(e,255),t=je(t,255),n=je(n,255);var r=Math.max(e,t,n),i=Math.min(e,t,n),a=0,o=r,s=r-i,l=0===r?0:s/r;if(r===i)a=0;else{switch(r){case e:a=(t-n)/s+(t<n?6:0);break;case t:a=(n-e)/s+2;break;case n:a=(e-t)/s+4}a/=6}return{h:a,s:l,v:o}}function Be(e,t,n,r){var i=[De(Math.round(e).toString(16)),De(Math.round(t).toString(16)),De(Math.round(n).toString(16))];return r&&i[0].startsWith(i[0].charAt(1))&&i[1].startsWith(i[1].charAt(1))&&i[2].startsWith(i[2].charAt(1))?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function He(e){return Ye(e)/255}function Ye(e){return parseInt(e,16)}var Ke={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};var We="(?:".concat("[-\\+]?\\d*\\.\\d+%?",")|(?:").concat("[-\\+]?\\d+%?",")"),qe="[\\s|\\(]+(".concat(We,")[,|\\s]+(").concat(We,")[,|\\s]+(").concat(We,")\\s*\\)?"),Je="[\\s|\\(]+(".concat(We,")[,|\\s]+(").concat(We,")[,|\\s]+(").concat(We,")[,|\\s]+(").concat(We,")\\s*\\)?"),Qe={CSS_UNIT:new RegExp(We),rgb:new RegExp("rgb"+qe),rgba:new RegExp("rgba"+Je),hsl:new RegExp("hsl"+qe),hsla:new RegExp("hsla"+Je),hsv:new RegExp("hsv"+qe),hsva:new RegExp("hsva"+Je),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function Xe(e){return Boolean(Qe.CSS_UNIT.exec(String(e)))}var Ge=function(){function e(t,n){var r;if(void 0===t&&(t=""),void 0===n&&(n={}),t instanceof e)return t;"number"==typeof t&&(t=function(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}(t)),this.originalInput=t;var i=function(e){var t,n,r,i={r:0,g:0,b:0},a=1,o=null,s=null,l=null,c=!1,u=!1;return"string"==typeof e&&(e=function(e){if(0===(e=e.trim().toLowerCase()).length)return!1;var t=!1;if(Ke[e])e=Ke[e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var n=Qe.rgb.exec(e);return n?{r:n[1],g:n[2],b:n[3]}:(n=Qe.rgba.exec(e))?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=Qe.hsl.exec(e))?{h:n[1],s:n[2],l:n[3]}:(n=Qe.hsla.exec(e))?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=Qe.hsv.exec(e))?{h:n[1],s:n[2],v:n[3]}:(n=Qe.hsva.exec(e))?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=Qe.hex8.exec(e))?{r:Ye(n[1]),g:Ye(n[2]),b:Ye(n[3]),a:He(n[4]),format:t?"name":"hex8"}:(n=Qe.hex6.exec(e))?{r:Ye(n[1]),g:Ye(n[2]),b:Ye(n[3]),format:t?"name":"hex"}:(n=Qe.hex4.exec(e))?{r:Ye(n[1]+n[1]),g:Ye(n[2]+n[2]),b:Ye(n[3]+n[3]),a:He(n[4]+n[4]),format:t?"name":"hex8"}:!!(n=Qe.hex3.exec(e))&&{r:Ye(n[1]+n[1]),g:Ye(n[2]+n[2]),b:Ye(n[3]+n[3]),format:t?"name":"hex"}}(e)),"object"==typeof e&&(Xe(e.r)&&Xe(e.g)&&Xe(e.b)?(t=e.r,n=e.g,r=e.b,i={r:255*je(t,255),g:255*je(n,255),b:255*je(r,255)},c=!0,u="%"===String(e.r).substr(-1)?"prgb":"rgb"):Xe(e.h)&&Xe(e.s)&&Xe(e.v)?(o=_e(e.s),s=_e(e.v),i=function(e,t,n){e=6*je(e,360),t=je(t,100),n=je(n,100);var r=Math.floor(e),i=e-r,a=n*(1-t),o=n*(1-i*t),s=n*(1-(1-i)*t),l=r%6;return{r:255*[n,o,a,a,s,n][l],g:255*[s,n,n,o,a,a][l],b:255*[a,a,s,n,n,o][l]}}(e.h,o,s),c=!0,u="hsv"):Xe(e.h)&&Xe(e.s)&&Xe(e.l)&&(o=_e(e.s),l=_e(e.l),i=function(e,t,n){var r,i,a;if(e=je(e,360),t=je(t,100),n=je(n,100),0===t)i=n,a=n,r=n;else{var o=n<.5?n*(1+t):n+t-n*t,s=2*n-o;r=Ve(s,o,e+1/3),i=Ve(s,o,e),a=Ve(s,o,e-1/3)}return{r:255*r,g:255*i,b:255*a}}(e.h,o,l),c=!0,u="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(a=e.a)),a=Re(a),{ok:c,format:e.format||u,r:Math.min(255,Math.max(i.r,0)),g:Math.min(255,Math.max(i.g,0)),b:Math.min(255,Math.max(i.b,0)),a}}(t);this.originalInput=t,this.r=i.r,this.g=i.g,this.b=i.b,this.a=i.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(r=n.format)&&void 0!==r?r:i.format,this.gradientType=n.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=i.ok}return e.prototype.isDark=function(){return this.getBrightness()<128},e.prototype.isLight=function(){return!this.isDark()},e.prototype.getBrightness=function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},e.prototype.getLuminance=function(){var e=this.toRgb(),t=e.r/255,n=e.g/255,r=e.b/255;return.2126*(t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4))+.7152*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.0722*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))},e.prototype.getAlpha=function(){return this.a},e.prototype.setAlpha=function(e){return this.a=Re(e),this.roundA=Math.round(100*this.a)/100,this},e.prototype.isMonochrome=function(){return 0===this.toHsl().s},e.prototype.toHsv=function(){var e=Ue(this.r,this.g,this.b);return{h:360*e.h,s:e.s,v:e.v,a:this.a}},e.prototype.toHsvString=function(){var e=Ue(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),r=Math.round(100*e.v);return 1===this.a?"hsv(".concat(t,", ").concat(n,"%, ").concat(r,"%)"):"hsva(".concat(t,", ").concat(n,"%, ").concat(r,"%, ").concat(this.roundA,")")},e.prototype.toHsl=function(){var e=Fe(this.r,this.g,this.b);return{h:360*e.h,s:e.s,l:e.l,a:this.a}},e.prototype.toHslString=function(){var e=Fe(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),r=Math.round(100*e.l);return 1===this.a?"hsl(".concat(t,", ").concat(n,"%, ").concat(r,"%)"):"hsla(".concat(t,", ").concat(n,"%, ").concat(r,"%, ").concat(this.roundA,")")},e.prototype.toHex=function(e){return void 0===e&&(e=!1),Be(this.r,this.g,this.b,e)},e.prototype.toHexString=function(e){return void 0===e&&(e=!1),"#"+this.toHex(e)},e.prototype.toHex8=function(e){return void 0===e&&(e=!1),function(e,t,n,r,i){var a,o=[De(Math.round(e).toString(16)),De(Math.round(t).toString(16)),De(Math.round(n).toString(16)),De((a=r,Math.round(255*parseFloat(a)).toString(16)))];return i&&o[0].startsWith(o[0].charAt(1))&&o[1].startsWith(o[1].charAt(1))&&o[2].startsWith(o[2].charAt(1))&&o[3].startsWith(o[3].charAt(1))?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}(this.r,this.g,this.b,this.a,e)},e.prototype.toHex8String=function(e){return void 0===e&&(e=!1),"#"+this.toHex8(e)},e.prototype.toHexShortString=function(e){return void 0===e&&(e=!1),1===this.a?this.toHexString(e):this.toHex8String(e)},e.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},e.prototype.toRgbString=function(){var e=Math.round(this.r),t=Math.round(this.g),n=Math.round(this.b);return 1===this.a?"rgb(".concat(e,", ").concat(t,", ").concat(n,")"):"rgba(".concat(e,", ").concat(t,", ").concat(n,", ").concat(this.roundA,")")},e.prototype.toPercentageRgb=function(){var e=function(e){return"".concat(Math.round(100*je(e,255)),"%")};return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}},e.prototype.toPercentageRgbString=function(){var e=function(e){return Math.round(100*je(e,255))};return 1===this.a?"rgb(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%)"):"rgba(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%, ").concat(this.roundA,")")},e.prototype.toName=function(){if(0===this.a)return"transparent";if(this.a<1)return!1;for(var e="#"+Be(this.r,this.g,this.b,!1),t=0,n=Object.entries(Ke);t<n.length;t++){var r=n[t],i=r[0];if(e===r[1])return i}return!1},e.prototype.toString=function(e){var t=Boolean(e);e=null!=e?e:this.format;var n=!1,r=this.a<1&&this.a>=0;return t||!r||!e.startsWith("hex")&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this.a?this.toName():this.toRgbString()},e.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},e.prototype.clone=function(){return new e(this.toString())},e.prototype.lighten=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.l+=t/100,n.l=Le(n.l),new e(n)},e.prototype.brighten=function(t){void 0===t&&(t=10);var n=this.toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-t/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-t/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-t/100*255))),new e(n)},e.prototype.darken=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.l-=t/100,n.l=Le(n.l),new e(n)},e.prototype.tint=function(e){return void 0===e&&(e=10),this.mix("white",e)},e.prototype.shade=function(e){return void 0===e&&(e=10),this.mix("black",e)},e.prototype.desaturate=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.s-=t/100,n.s=Le(n.s),new e(n)},e.prototype.saturate=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.s+=t/100,n.s=Le(n.s),new e(n)},e.prototype.greyscale=function(){return this.desaturate(100)},e.prototype.spin=function(t){var n=this.toHsl(),r=(n.h+t)%360;return n.h=r<0?360+r:r,new e(n)},e.prototype.mix=function(t,n){void 0===n&&(n=50);var r=this.toRgb(),i=new e(t).toRgb(),a=n/100;return new e({r:(i.r-r.r)*a+r.r,g:(i.g-r.g)*a+r.g,b:(i.b-r.b)*a+r.b,a:(i.a-r.a)*a+r.a})},e.prototype.analogous=function(t,n){void 0===t&&(t=6),void 0===n&&(n=30);var r=this.toHsl(),i=360/n,a=[this];for(r.h=(r.h-(i*t>>1)+720)%360;--t;)r.h=(r.h+i)%360,a.push(new e(r));return a},e.prototype.complement=function(){var t=this.toHsl();return t.h=(t.h+180)%360,new e(t)},e.prototype.monochromatic=function(t){void 0===t&&(t=6);for(var n=this.toHsv(),r=n.h,i=n.s,a=n.v,o=[],s=1/t;t--;)o.push(new e({h:r,s:i,v:a})),a=(a+s)%1;return o},e.prototype.splitcomplement=function(){var t=this.toHsl(),n=t.h;return[this,new e({h:(n+72)%360,s:t.s,l:t.l}),new e({h:(n+216)%360,s:t.s,l:t.l})]},e.prototype.onBackground=function(t){var n=this.toRgb(),r=new e(t).toRgb(),i=n.a+r.a*(1-n.a);return new e({r:(n.r*n.a+r.r*r.a*(1-n.a))/i,g:(n.g*n.a+r.g*r.a*(1-n.a))/i,b:(n.b*n.a+r.b*r.a*(1-n.a))/i,a:i})},e.prototype.triad=function(){return this.polyad(3)},e.prototype.tetrad=function(){return this.polyad(4)},e.prototype.polyad=function(t){for(var n=this.toHsl(),r=n.h,i=[this],a=360/t,o=1;o<t;o++)i.push(new e({h:(r+o*a)%360,s:n.s,l:n.l}));return i},e.prototype.equals=function(t){return this.toRgbString()===new e(t).toRgbString()},e}();const Ze=JSON.parse('{"name":"Astronaut","backgroundColor":"#000000","textColor":"#95a5d6","frameColor":"#141415","frameTextColor":"#b1bdcd","selectedBackgroundColor":"#221650","selectedTextColor":"#ffffff","spacing":0.72,"roundness":0.57,"flat":false}'),et=JSON.parse('{"name":"Black Gold","backgroundColor":"#0d0c0c","textColor":"#a9aa92","frameColor":"#1c1c12","frameTextColor":"#e8e8bf","selectedBackgroundColor":"#545549","selectedTextColor":"#ffffff","spacing":0.375,"roundness":0.25,"flat":false}'),tt=JSON.parse('{"name":"(boring default)","backgroundColor":"#0d0f12","textColor":"#8facbc","frameColor":"#32312f","frameTextColor":"#d1d1d1","selectedBackgroundColor":"#163d5a","selectedTextColor":"#ebebeb","spacing":0.38,"roundness":0.48,"flat":false}'),nt=JSON.parse('{"name":"Debug","backgroundColor":"#9dceec","textColor":"#0e0425","frameColor":"#00af4d","frameTextColor":"#fbf6ac","selectedBackgroundColor":"#ffcd03","selectedTextColor":"#000000","buttonColor":"#f57d20","buttonTextColor":"#000000","scrollbarColor":"#dd1a21","scrollbarTextColor":"#fff579","mediaButtonColor":"#f4f4f4","mediaButtonTextColor":"#181818","spacing":0.38,"roundness":0.48,"flat":false}'),rt=JSON.parse('{"name":"Glacier","backgroundColor":"#d9e6e8","textColor":"#0d272b","frameColor":"#bfd4e8","frameTextColor":"#1c1c12","selectedBackgroundColor":"#ffffff","selectedTextColor":"#04030c","spacing":0.65,"roundness":0.3,"flat":false}'),it=JSON.parse('{"name":"Indigo","backgroundColor":"#06181e","textColor":"#d1d3f5","frameColor":"#43477a","frameTextColor":"#f3f3f7","selectedBackgroundColor":"#2c2e4f","selectedTextColor":"#ffffff","spacing":0.625,"roundness":0.84375,"flat":true}'),at=JSON.parse('{"name":"Moody Blue","backgroundColor":"#051a23","textColor":"#bec1c0","frameColor":"#125673","frameTextColor":"#d8eee7","selectedBackgroundColor":"#124373","selectedTextColor":"#ffffff","spacing":0.53125,"roundness":0.40625,"flat":false}'),ot=JSON.parse('{"name":"Pale Pink","backgroundColor":"#f7f7f7","textColor":"#120f0c","frameColor":"#cfbdd0","frameTextColor":"#121211","selectedBackgroundColor":"#b9d8f3","selectedTextColor":"#000000","spacing":0.375,"roundness":0.53125,"flat":true}'),st=JSON.parse('{"name":"Purplelicious (Winamp)","backgroundColor":"#000000","textColor":"#ffb464","frameColor":"#3e0445","frameTextColor":"#ffb464","selectedBackgroundColor":"#3e0445","selectedTextColor":"#ffb464","spacing":0.21875,"roundness":0.09375,"flat":false}'),lt=JSON.parse('{"name":"Radioactive","backgroundColor":"#0f0f10","textColor":"#d1f5d2","frameColor":"#322724","frameTextColor":"#c3feca","selectedBackgroundColor":"#43304b","selectedTextColor":"#ffffff","mediaButtonColor":"#c3feca","mediaButtonTextColor":"#021c05","spacing":0.73,"roundness":0.86,"flat":false}'),ct=JSON.parse('{"name":"Saddle","backgroundColor":"#271607","textColor":"#cbbe86","frameColor":"#331d0a","frameTextColor":"#fedfc3","selectedBackgroundColor":"#5d3512","selectedTextColor":"#ffffff","spacing":0.375,"roundness":0.34375,"flat":false}'),ut=JSON.parse('{"name":"Velvet","backgroundColor":"#160916","textColor":"#a7bdd2","frameColor":"#280b1f","frameTextColor":"#cdd1d6","mediaButtonColor":"#aa8f00","mediaButtonTextColor":"#0d0b04","selectedBackgroundColor":"#412438","selectedTextColor":"#ebebeb","spacing":1,"roundness":0.15,"flat":true}'),dt=JSON.parse('{"name":"Winamp Classic","backgroundColor":"#000000","textColor":"#00e200","frameColor":"#383757","frameTextColor":"#d2d2d2","buttonColor":"#464379","buttonTextColor":"#d2d2d2","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#040dae","selectedTextColor":"#d2d2d2","spacing":0.21875,"roundness":0.09375,"flat":false}'),mt=JSON.parse('{"name":"Winamp Modern (WACUP)","backgroundColor":"#14121c","textColor":"#8ac440","frameColor":"#1f1f36","frameTextColor":"#f0f0f0","mediaButtonColor":"#cccccc","mediaButtonTextColor":"#111111","selectedBackgroundColor":"#2f2f76","selectedTextColor":"#f0f0f0","spacing":0.21875,"roundness":0.09375,"flat":false}'),ht={name:"(none)",backgroundColor:"black",textColor:"white",frameColor:"black",frameTextColor:"white",selectedBackgroundColor:"blue",selectedTextColor:"white",buttonColor:"",buttonTextColor:"",scrollbarColor:"",scrollbarTextColor:"",mediaButtonColor:"",mediaButtonTextColor:"",spacing:0,roundness:0,flat:!1},ft=Object.assign(Object.assign({},ht),tt),pt=[ft,Ze,et,rt,it,at,ot,st,lt,ct,ut,dt,mt,nt];var vt=n(9520),bt=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};const gt=new A("themeStore");class yt extends vt.ZP{constructor(){super("ampcast/themes"),this.defaultThemes=new Map(pt.map((e=>[e.name,e]))),this.themes$=new Ie([]),this.version(1).stores({themes:"&name"}),(0,vt.Y1)((()=>this.themes.toArray())).subscribe(this.themes$)}observeUserThemes(){return this.themes$}getDefaultTheme(e){return this.defaultThemes.get(e)}getDefaultThemes(){return[...this.defaultThemes.values()]}getUserTheme(e){return this.getUserThemes().find((t=>t.name===e))}getUserThemes(){return this.themes$.getValue()}save(e){return bt(this,void 0,void 0,(function*(){try{gt.log("save",{theme:e}),yield this.themes.put(Object.assign(Object.assign({},e),{userTheme:!0}))}catch(e){gt.error(e)}}))}remove(e){return bt(this,void 0,void 0,(function*(){try{gt.log("remove",{name:e}),yield this.themes.delete(e)}catch(e){gt.error(e)}}))}rename(e,t){return bt(this,void 0,void 0,(function*(){try{const n=yield this.themes.get(e);if(!n)throw Error(`Theme '${e}' not found.`);yield this.themes.delete(e),yield this.themes.put(Object.assign(Object.assign({},n),{name:t,userTheme:!0}))}catch(e){gt.error(e)}}))}}const wt=new yt,Et=new A("theme"),xt=new class{constructor(){this.defaultFontSize=17.2,this.storage=new z("theme"),this.app=document.getElementById("app"),this.popup=document.getElementById("popup"),this.system=document.getElementById("system"),this.theme$=new Ie(ft),this.applyingUpdate=!1;const e=document.createElement("style");document.head.append(e),this.sheet=e.sheet,this.rootStyle=this.createStyle(":root"),this.appStyle=this.createStyle(".app"),this.playheadStyle=this.createStyle("#playhead"),this.system.classList.toggle("selection-dark",!0),this.restore(),this.observe().pipe($e((()=>this.applyAppStyles()))).subscribe(Et)}observe(){return this.theme$.pipe(ze((()=>!this.applyingUpdate)))}get backgroundColor(){return this.current.backgroundColor}set backgroundColor(e){this.setColor("backgroundColor",e)}get black(){if(this.isLight){const e=new Ge(this.defaultButtonColor).toHsl();return e.s-=.6*e.s,e.l-=.8*e.l,this.fromHsl(e)}return new Ge(this.backgroundColor).darken(33).toHexString()}get buttonColor(){return this.current.buttonColor}set buttonColor(e){this.setColor("buttonColor",e,this.defaultButtonColor),this.scrollbarColor=this.current.scrollbarColor}get buttonTextColor(){return this.current.buttonTextColor}set buttonTextColor(e){this.setColor("buttonTextColor",e,this.defaultButtonTextColor),this.scrollbarTextColor=this.current.scrollbarTextColor}get current(){return this.theme$.value}get defaultButtonColor(){const e=new Ge(this.frameColor).toHsl();return e.s+=.05,e.l+=.05,this.fromHsl(e)}get defaultButtonTextColor(){return this.frameTextColor}get defaultMediaButtonColor(){const e=new Ge(this.frameColor).toHsl();return e.s+=.33*(1-e.s),e.l+=.5*(1-e.l),this.fromHsl(e)}get defaultMediaButtonTextColor(){const e=new Ge(this.mediaButtonColor||this.defaultMediaButtonColor).toHsl();return e.s-=.5*e.s,e.l-=.9*e.l,this.fromHsl(e)}get defaultScrollbarColor(){return this.buttonColor||this.defaultButtonColor}get defaultScrollbarTextColor(){return this.buttonTextColor||this.defaultButtonTextColor}get edited(){const e=this.userTheme?wt.getUserTheme(this.name):wt.getDefaultTheme(this.name);return!!e&&!Object.keys(e).every((t=>e[t]===this[t]))}get flat(){return this.current.flat}set flat(e){this.app.classList.toggle("flat",!!e),this.popup.classList.toggle("flat",!!e),this.theme$.next(Object.assign(Object.assign({},this.current),{flat:e}))}get focusRingColor(){return this.isFrameDark?new Ge(this.isMediaButtonLight?this.mediaButtonColor:this.defaultMediaButtonColor).triad()[1].saturate(20).lighten(20).toHexString():new Ge(this.frameColor).triad()[2].saturate(33).darken(50).toHexString()}get fontSize(){return Number(this.rootStyle.getPropertyValue("--font-size"))||this.defaultFontSize}set fontSize(e){this.rootStyle.setProperty("--font-size",String(e)),this.createPlayheadSmiley()}get frameColor(){return this.current.frameColor}set frameColor(e){this.setColor("frameColor",e),this.buttonColor=this.current.buttonColor,this.mediaButtonColor=this.current.mediaButtonColor}get frameTextColor(){return this.current.frameTextColor}set frameTextColor(e){this.setColor("frameTextColor",e),this.buttonTextColor=this.current.buttonTextColor}get mediaButtonColor(){return this.current.mediaButtonColor}set mediaButtonColor(e){this.setColor("mediaButtonColor",e,this.defaultMediaButtonColor),this.mediaButtonTextColor=this.current.mediaButtonTextColor}get mediaButtonTextColor(){return this.current.mediaButtonTextColor}set mediaButtonTextColor(e){this.setColor("mediaButtonTextColor",e,this.defaultMediaButtonTextColor),this.createPlayheadSmiley()}get name(){return this.current.name}set name(e){this.theme$.next(Object.assign(Object.assign({},this.current),{name:e}))}get roundness(){return this.current.roundness}set roundness(e){this.setProperty("roundness",e),this.theme$.next(Object.assign(Object.assign({},this.current),{roundness:e}))}get scrollbarColor(){return this.current.scrollbarColor}set scrollbarColor(e){this.setColor("scrollbarColor",e,this.defaultScrollbarColor)}get scrollbarTextColor(){return this.current.scrollbarTextColor}set scrollbarTextColor(e){this.setColor("scrollbarTextColor",e,this.defaultScrollbarTextColor)}get selectedBackgroundColor(){return this.current.selectedBackgroundColor}set selectedBackgroundColor(e){this.setColor("selectedBackgroundColor",e);const t=new Ge(e);this.setProperty("selected-background-color-blurred",t.desaturate(50).setAlpha(.75).toRgbString())}get selectedTextColor(){return this.current.selectedTextColor}set selectedTextColor(e){this.setColor("selectedTextColor",e)}get spacing(){return this.current.spacing}set spacing(e){this.setProperty("spacing",e),this.theme$.next(Object.assign(Object.assign({},this.current),{spacing:e}))}get textColor(){return this.current.textColor}set textColor(e){this.setColor("textColor",e)}get isDark(){return new Ge(this.backgroundColor).isDark()}get isLight(){return new Ge(this.backgroundColor).isLight()}get isButtonDark(){return new Ge(this.buttonColor||this.defaultButtonColor).isDark()}get isButtonLight(){return new Ge(this.buttonColor||this.defaultButtonColor).isLight()}get isFrameDark(){return new Ge(this.frameColor).isDark()}get isFrameLight(){return new Ge(this.frameColor).isLight()}get isFrameTextDark(){return new Ge(this.frameTextColor).isDark()}get isFrameTextLight(){return new Ge(this.frameTextColor).isLight()}get isMediaButtonLight(){return new Ge(this.mediaButtonColor).isLight()}get isScrollbarDark(){return new Ge(this.scrollbarColor||this.defaultScrollbarColor).isDark()}get isScrollbarLight(){return new Ge(this.scrollbarColor||this.defaultScrollbarColor).isLight()}get isSelectionDark(){return new Ge(this.selectedBackgroundColor).isDark()}get isSelectionLight(){return new Ge(this.selectedBackgroundColor).isLight()}get isTextDark(){return new Ge(this.textColor).isDark()}get isTextLight(){return new Ge(this.textColor).isLight()}get userTheme(){return!!this.current.userTheme}set userTheme(e){this.theme$.next(Object.assign(Object.assign({},this.current),{userTheme:e}))}getVisualizerColors(){const e=new Ge(this.defaultMediaButtonColor);return[this.isDark?this.textColor:this.isFrameTextLight?this.frameTextColor:this.backgroundColor,...e.tetrad().map((e=>e.toRgbString()))]}apply(e){this.applyingUpdate=!0;const t=Object.assign(Object.assign(Object.assign({},ht),{userTheme:void 0}),e);this.frameColor=t.frameColor,this.frameTextColor=t.frameTextColor,Object.assign(this,t),this.applyingUpdate=!1,this.theme$.next(this.current)}applyAppStyles(){this.setProperty("black",this.black),this.setProperty("focus-ring-color",this.focusRingColor),this.toggleClasses(this.app),this.toggleClasses(this.popup)}restore(){const e=this.storage.getJson("current",ft);this.apply(e),this.fontSize=this.storage.getNumber("fontSize",this.defaultFontSize),this.system.classList.toggle("dark",this.isDark),this.system.classList.toggle("light",this.isLight)}save(){this.storage.setNumber("fontSize",this.fontSize),this.storage.setJson("current",this.current),this.system.classList.toggle("dark",this.isDark),this.system.classList.toggle("light",this.isLight)}validate(e){if(!e||"object"!=typeof e||"length"in e)return!1;const t={name:"string",frameColor:"string",frameTextColor:"string",backgroundColor:"string",textColor:"string",selectedBackgroundColor:"string",selectedTextColor:"string"},n={mediaButtonColor:"string",mediaButtonTextColor:"string",buttonColor:"string",buttonTextColor:"string",scrollbarColor:"string",scrollbarTextColor:"string",spacing:"number",roundness:"number",flat:"boolean"};return Object.keys(t).every((n=>n in e&&typeof e[n]===t[n]))&&Object.keys(e).every((r=>r in t||typeof e[r]===n[r]))}toggleClasses(e){const t=e.classList;t.toggle("dark",this.isDark),t.toggle("light",this.isLight),t.toggle("frame-dark",this.isFrameDark),t.toggle("frame-light",this.isFrameLight),t.toggle("frame-text-dark",this.isFrameTextDark),t.toggle("frame-text-light",this.isFrameTextLight),t.toggle("button-dark",this.isButtonDark),t.toggle("button-light",this.isButtonLight),t.toggle("scrollbar-dark",this.isScrollbarDark),t.toggle("scrollbar-light",this.isScrollbarLight),t.toggle("selection-dark",this.isSelectionDark),t.toggle("selection-light",this.isSelectionLight)}setColor(e,t,n){const r=this.toDashName(e);let i=t||n;if(i){"string"==typeof i&&(i=new Ge(i));const n=i.toHsl();this.setProperty(`${r}-h`,String(n.h)),this.setProperty(`${r}-s`,100*n.s+"%"),this.setProperty(`${r}-l`,100*n.l+"%"),this.theme$.next(Object.assign(Object.assign({},this.current),{[e]:t?i.toHexString():""}))}else this.setProperty(`${r}-h`,null),this.setProperty(`${r}-s`,null),this.setProperty(`${r}-l`,null),this.theme$.next(Object.assign(Object.assign({},this.current),{[e]:""}))}setProperty(e,t){this.appStyle.setProperty(`--${e}`,null==t?null:String(t))}createStyle(e){const t=this.sheet.insertRule(`${e}{}`);return this.sheet.cssRules[t].style}get smileyColor(){return this.mediaButtonTextColor||this.defaultMediaButtonTextColor}createPlayheadSmiley(){const e=new Ge(this.smileyColor).toRgbString(),t=[`<path fill='${e}' d='M 160.5,164.5 C 183.647,162.813 194.147,173.48 192,196.5C 186.494,211.009 175.994,216.842 160.5,214C 145.991,208.494 140.158,197.994 143,182.5C 145.683,173.318 151.517,167.318 160.5,164.5 Z'/>`,`<path fill='${e}' d='M 335.5,164.5 C 358.647,162.813 369.147,173.48 367,196.5C 361.494,211.009 350.994,216.842 335.5,214C 320.991,208.494 315.158,197.994 318,182.5C 320.683,173.318 326.517,167.318 335.5,164.5 Z'/>`,`<path fill='${e}' d='M 164.5,296.5 C 172.699,295.1 179.865,297.1 186,302.5C 201.99,327.582 224.823,341.582 254.5,344.5C 279.499,342.418 299.999,331.751 316,312.5C 318.955,308.756 321.789,304.922 324.5,301C 334.716,294.616 344.55,295.116 354,302.5C 358.296,308.845 359.63,315.845 358,323.5C 334.118,361.698 299.618,382.365 254.5,385.5C 209.382,382.365 174.882,361.698 151,323.5C 148.138,310.557 152.638,301.557 164.5,296.5 Z'/>`].join(""),n=this.createBase64SVG(512,512,t);this.playheadStyle.setProperty("--smiley",n),this.playheadStyle.setProperty("--thumb-size",`${Math.round(1.25*this.fontSize)}px`)}createBase64SVG(e,t,n){return`url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='${e}' height='${t}'>${n}</svg>")`}toDashName(e){return e.replace(/[A-Z]/g,(e=>`-${e.toLowerCase()}`))}fromHsl({h:e,s:t,l:n}){return t=Math.min(Math.max(t,0),1),n=Math.min(Math.max(n,0),1),new Ge({h:e,s:t,l:n}).toHexString()}};function kt(e,t){const n=(0,r.useRef)(t);(0,r.useEffect)((()=>{n.current=t}),[t]),(0,r.useEffect)((()=>{const t=e.current;if(t){const e=new ResizeObserver((()=>n.current()));return e.observe(t),()=>e.disconnect()}}),[e])}const St=document.createElement("div");function Ct(){const e=(0,r.useRef)(St),[t,n]=(0,r.useState)(0);return(0,r.useEffect)((()=>{St.parentElement||(document.body.append(St),n(Pt()))}),[]),kt(e,(()=>n(Pt()))),t}function Pt(){return parseFloat(getComputedStyle(St).fontSize)||xt.defaultFontSize}function Tt({vertical:e,primary:t,size:n,children:i}){const a={};return t||(e?a.height=`${n}px`:a.width=`${n}px`),r.createElement("div",{className:"layout-pane layout-pane-"+(t?"primary":"secondary"),style:a},i)}function At({id:e,arrange:t="columns",primaryIndex:n=0,children:i}){const a=(0,r.useRef)(null),[o,s]=(0,r.useState)({width:0,height:0}),[l,c]=(0,r.useState)(0),[u,d]=(0,r.useState)(0),[m,h]=(0,r.useState)(0),[f,p]=(0,r.useState)((()=>e?H.get(e):0)),[v,b]=(0,r.useState)(-1),[g,y]=(0,r.useState)(0),w=-1!==v,E=Ct(),x="rows"===t;(0,r.useEffect)((()=>{e&&H.set(e,f)}),[e,f]),(0,r.useLayoutEffect)((()=>{var e;if(E>0){const t=a.current,n=x?"minHeight":"minWidth",r=t.querySelector(":scope > .layout-pane-primary");if(r){r.style[n]="";const e=parseInt(getComputedStyle(r)[n],10);r.style[n]="unset",c(e||80)}const i=t.querySelector(":scope > .layout-pane-secondary");if(i){i.style[n]="";const r=parseInt(getComputedStyle(i)[n],10);i.style[n]="unset",d(r||80);const a=x?"offsetHeight":"offsetWidth",o=t.querySelector(":scope > .layout-splitter");h(null!==(e=null==o?void 0:o[a])&&void 0!==e?e:4)}}}),[x,E]),(0,r.useLayoutEffect)((()=>{const e=x?o.height:o.width;if(e>0){const t=e-m-f;t<l?p(Math.max(f-(l-t),0)):f<u&&p(Math.min(e-m-l,u))}}),[x,o,l,u,m,f]);const k=(0,r.useCallback)((e=>{if(0===e.button){const t=x?e.screenY:e.screenX;b(t),y(f),e.preventDefault()}}),[x,f]),S=(0,r.useCallback)((e=>{const t=(x?e.screenY:e.screenX)-v;p(0===n?g-t:g+t)}),[x,n,v,g]),C=(0,r.useCallback)((()=>{b(-1),y(0)}),[]);return(0,r.useEffect)((()=>{if(w)return document.documentElement.style.cursor=x?"ns-resize":"ew-resize",document.body.classList.add("dragging"),document.addEventListener("mouseup",C),document.addEventListener("mousemove",S),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",C),document.removeEventListener("mousemove",S)}}),[x,w,S,C]),kt(a,(()=>{const e=a.current;s({width:e.clientWidth,height:e.clientHeight})})),r.createElement("div",{className:`splitter splitter-${t}`,id:e,ref:a},r.Children.toArray(i).slice(0,2).map(((e,t)=>{const i=t===n,a=i?0:f,o=[];return 1===t&&o.push(r.createElement("div",{className:"layout-splitter "+(w?"active":""),role:"separator",onMouseDown:k,key:"splitter"})),o.push(r.createElement(Tt,{vertical:x,primary:i,size:a,key:t},e)),o})))}St.style.cssText="\n    position: absolute;\n    pointer-events: none;\n    visibility: hidden;\n    font-size: 1rem;\n    width: 1rem;\n    height: 1rem;\n";var It=function(e){function t(t,n){return e.call(this)||this}return K(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(ne),Ot={setInterval:function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i=Ot.delegate;return(null==i?void 0:i.setInterval)?i.setInterval.apply(i,Q([e,t],J(n))):setInterval.apply(void 0,Q([e,t],J(n)))},clearInterval:function(e){var t=Ot.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0},Mt=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return K(t,e),t.prototype.schedule=function(e,t){var n;if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r=this.id,i=this.scheduler;return null!=r&&(this.id=this.recycleAsyncId(i,r,t)),this.pending=!0,this.delay=t,this.id=null!==(n=this.id)&&void 0!==n?n:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),Ot.setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!=n&&this.delay===n&&!1===this.pending)return t;null!=t&&Ot.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n,r=!1;try{this.work(e)}catch(e){r=!0,n=e||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),n},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,n=this.scheduler,r=n.actions;this.work=this.state=this.scheduler=null,this.pending=!1,te(r,this),null!=t&&(this.id=this.recycleAsyncId(n,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(It),Nt={now:function(){return(Nt.delegate||Date).now()},delegate:void 0},$t=function(){function e(t,n){void 0===n&&(n=e.now),this.schedulerActionCtor=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(n,t)},e.now=Nt.now,e}(),zt=new(function(e){function t(t,n){void 0===n&&(n=$t.now);var r=e.call(this,t,n)||this;return r.actions=[],r._active=!1,r}return K(t,e),t.prototype.flush=function(e){var t=this.actions;if(this._active)t.push(e);else{var n;this._active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this._active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}($t))(Mt),jt=zt;function Lt(e){return e&&G(e.schedule)}function Rt(e,t,n){void 0===e&&(e=0),void 0===n&&(n=jt);var r=-1;return null!=t&&(Lt(t)?n=t:r=t),new Se((function(t){var i=function(e){return e instanceof Date&&!isNaN(e)}(e)?+e-n.now():e;i<0&&(i=0);var a=0;return n.schedule((function(){t.closed||(t.next(a++),0<=r?this.schedule(void 0,r):t.complete())}),i)}))}function _t(e,t){return void 0===e&&(e=0),void 0===t&&(t=zt),e<0&&(e=0),Rt(e,e,t)}function Dt({children:e}){return r.createElement(r.Fragment,null,e)}var Ft=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e};function Vt(e){return G(null==e?void 0:e.then)}function Ut(e){return G(e[xe])}function Bt(e){return Symbol.asyncIterator&&G(null==e?void 0:e[Symbol.asyncIterator])}function Ht(e){return new TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}var Yt="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator";function Kt(e){return G(null==e?void 0:e[Yt])}function Wt(e){return function(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),a=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){a.push([e,t,n,r])>1||s(e,t)}))})}function s(e,t){try{(n=i[e](t)).value instanceof X?Promise.resolve(n.value.v).then(l,c):u(a[0][2],n)}catch(e){u(a[0][3],e)}var n}function l(e){s("next",e)}function c(e){s("throw",e)}function u(e,t){e(t),a.shift(),a.length&&s(a[0][0],a[0][1])}}(this,arguments,(function(){var t,n,r;return W(this,(function(i){switch(i.label){case 0:t=e.getReader(),i.label=1;case 1:i.trys.push([1,,9,10]),i.label=2;case 2:return[4,X(t.read())];case 3:return n=i.sent(),r=n.value,n.done?[4,X(void 0)]:[3,5];case 4:return[2,i.sent()];case 5:return[4,X(r)];case 6:return[4,i.sent()];case 7:return i.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}}))}))}function qt(e){return G(null==e?void 0:e.getReader)}function Jt(e){if(e instanceof Se)return e;if(null!=e){if(Ut(e))return i=e,new Se((function(e){var t=i[xe]();if(G(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")}));if(Ft(e))return t=e,new Se((function(e){for(var n=0;n<t.length&&!e.closed;n++)e.next(t[n]);e.complete()}));if(Vt(e))return r=e,new Se((function(e){r.then((function(t){e.closed||(e.next(t),e.complete())}),(function(t){return e.error(t)})).then(null,le)}));if(Bt(e))return Qt(e);if(Kt(e))return n=e,new Se((function(e){var t,r;try{for(var i=q(n),a=i.next();!a.done;a=i.next()){var o=a.value;if(e.next(o),e.closed)return}}catch(e){t={error:e}}finally{try{a&&!a.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.complete()}));if(qt(e))return Qt(Wt(e))}var t,n,r,i;throw Ht(e)}function Qt(e){return new Se((function(t){(function(e,t){var n,r,i,a,o,s,l,c;return o=this,s=void 0,c=function(){var o,s;return W(this,(function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=q(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){!function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)}(r,i,(t=e[n](t)).done,t.value)}))}}}(e),l.label=1;case 1:return[4,n.next()];case 2:if((r=l.sent()).done)return[3,4];if(o=r.value,t.next(o),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s=l.sent(),i={error:s},[3,11];case 6:return l.trys.push([6,,9,10]),r&&!r.done&&(a=n.return)?[4,a.call(n)]:[3,8];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}}))},new((l=void 0)||(l=Promise))((function(e,t){function n(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof l?e:new l((function(t){t(e)}))}(t.value).then(n,r)}i((c=c.apply(o,s||[])).next())}))})(e,t).catch((function(e){return t.error(e)}))}))}function Xt(e,t){return Oe((function(n,r){var i=0;n.subscribe(Me(r,(function(n){r.next(e.call(t,n,i++))})))}))}function Gt(e,t,n,r,i){void 0===r&&(r=0),void 0===i&&(i=!1);var a=t.schedule((function(){n(),i?e.add(this.schedule(null,r)):this.unsubscribe()}),r);if(e.add(a),!i)return a}function Zt(e,t,n){return void 0===n&&(n=1/0),G(t)?Zt((function(n,r){return Xt((function(e,i){return t(n,e,r,i)}))(Jt(e(n,r)))}),n):("number"==typeof t&&(n=t),Oe((function(t,r){return function(e,t,n,r,i,a,o,s){var l=[],c=0,u=0,d=!1,m=function(){!d||l.length||c||t.complete()},h=function(e){return c<r?f(e):l.push(e)},f=function(e){c++;var i=!1;Jt(n(e,u++)).subscribe(Me(t,(function(e){t.next(e)}),(function(){i=!0}),void 0,(function(){if(i)try{c--;for(;l.length&&c<r;)e=void 0,e=l.shift(),f(e);m()}catch(e){t.error(e)}var e})))};return e.subscribe(Me(t,h,(function(){d=!0,m()}))),function(){}}(t,r,e,n)})))}var en=Array.isArray;function tn(e){return Xt((function(t){return function(e,t){return en(t)?e.apply(void 0,Q([],J(t))):e(t)}(e,t)}))}var nn=["addListener","removeListener"],rn=["addEventListener","removeEventListener"],an=["on","off"];function on(e,t,n,r){if(G(n)&&(r=n,n=void 0),r)return on(e,t,n).pipe(tn(r));var i=J(function(e){return G(e.addEventListener)&&G(e.removeEventListener)}(e)?rn.map((function(r){return function(i){return e[r](t,i,n)}})):function(e){return G(e.addListener)&&G(e.removeListener)}(e)?nn.map(sn(e,t)):function(e){return G(e.on)&&G(e.off)}(e)?an.map(sn(e,t)):[],2),a=i[0],o=i[1];if(!a&&Ft(e))return Zt((function(e){return on(e,t,n)}))(Jt(e));if(!a)throw new TypeError("Invalid event target");return new Se((function(e){var t=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.next(1<t.length?t:t[0])};return a(t),function(){return o(t)}}))}function sn(e,t){return function(n){return function(r){return e[n](t,r)}}}function ln(e){return void 0===e&&(e=1/0),Zt(ke,e)}var cn=new Se((function(e){return e.complete()}));function un(e){return e[e.length-1]}function dn(e){return G(un(e))?e.pop():void 0}function mn(e){return Lt(un(e))?e.pop():void 0}function hn(e,t){return void 0===t&&(t=0),Oe((function(n,r){n.subscribe(Me(r,(function(n){return Gt(r,e,(function(){return r.next(n)}),t)}),(function(){return Gt(r,e,(function(){return r.complete()}),t)}),(function(n){return Gt(r,e,(function(){return r.error(n)}),t)})))}))}function fn(e,t){return void 0===t&&(t=0),Oe((function(n,r){r.add(e.schedule((function(){return n.subscribe(r)}),t))}))}function pn(e,t){if(!e)throw new Error("Iterable cannot be null");return new Se((function(n){Gt(n,t,(function(){var r=e[Symbol.asyncIterator]();Gt(n,t,(function(){r.next().then((function(e){e.done?n.complete():n.next(e.value)}))}),0,!0)}))}))}function vn(e,t){return t?function(e,t){if(null!=e){if(Ut(e))return function(e,t){return Jt(e).pipe(fn(t),hn(t))}(e,t);if(Ft(e))return function(e,t){return new Se((function(n){var r=0;return t.schedule((function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())}))}))}(e,t);if(Vt(e))return function(e,t){return Jt(e).pipe(fn(t),hn(t))}(e,t);if(Bt(e))return pn(e,t);if(Kt(e))return function(e,t){return new Se((function(n){var r;return Gt(n,t,(function(){r=e[Yt](),Gt(n,t,(function(){var e,t,i;try{t=(e=r.next()).value,i=e.done}catch(e){return void n.error(e)}i?n.complete():n.next(t)}),0,!0)})),function(){return G(null==r?void 0:r.return)&&r.return()}}))}(e,t);if(qt(e))return function(e,t){return pn(Wt(e),t)}(e,t)}throw Ht(e)}(e,t):Jt(e)}function bn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=mn(e),r=function(e,t){return"number"==typeof un(e)?e.pop():1/0}(e),i=e;return i.length?1===i.length?Jt(i[0]):ln(r)(vn(i,n)):cn}function gn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return ln(1)(vn(e,mn(e)))}function yn(e,t){return Oe((function(n,r){var i=null,a=0,o=!1,s=function(){return o&&!i&&r.complete()};n.subscribe(Me(r,(function(n){null==i||i.unsubscribe();var o=0,l=a++;Jt(e(n,l)).subscribe(i=Me(r,(function(e){return r.next(t?t(n,e,l,o++):e)}),(function(){i=null,s()})))}),(function(){o=!0,s()})))}))}function wn(e){return Oe((function(t,n){Jt(e).subscribe(Me(n,(function(){return n.complete()}),ce)),!n.closed&&t.subscribe(n)}))}function En(e,t){switch(t.type){case"resize":{const n=Math.max(t.clientSize,0),r=Math.max(t.scrollSize,n);if(n!==e.clientSize||r!==e.scrollSize){const t=r-n,i=xn(e.position,t);return Object.assign(Object.assign({},e),{position:i,max:t,clientSize:n,scrollSize:r})}return e}case"scrollBy":{const n=xn(e.position+t.amount,e.max);return n!==e.position?Object.assign(Object.assign({},e),{position:n}):e}case"scrollTo":{const n=xn(t.position,e.max);return n!==e.position?Object.assign(Object.assign({},e),{position:n}):e}default:return e}}function xn(e,t){return Math.min(Math.max(e,0),t)}const kn={position:0,max:0,clientSize:0,scrollSize:0};const Sn=(0,r.memo)((function(e){var{scrollableId:t,orientation:n,scrollAmount:i,onChange:a,onResize:o,scrollbarRef:s}=e,l=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["scrollableId","orientation","scrollAmount","onChange","onResize","scrollbarRef"]);const c=(0,r.useRef)(null),u=(0,r.useRef)(null),{position:d,max:m,clientSize:h,scrollSize:f,resize:p,scrollBy:v,scrollTo:b}=function(){const[{position:e,max:t,clientSize:n,scrollSize:i},a]=(0,r.useReducer)(En,kn),o=(0,r.useCallback)(((e,t)=>a({type:"resize",clientSize:e,scrollSize:t})),[]),s=(0,r.useCallback)((e=>a({type:"scrollTo",position:e})),[]);return{position:e,max:t,clientSize:n,scrollSize:i,scrollTo:s,scrollBy:(0,r.useCallback)((e=>a({type:"scrollBy",amount:e})),[]),resize:o}}(),[g,y]=(0,r.useState)(0),[E,x]=(0,r.useState)(0),[k,S]=(0,r.useState)(0),[C,P]=(0,r.useState)(-1),[T,A]=(0,r.useState)(0),I=-1!==C,O="vertical"===n,M=Math.ceil(d/m*(E-k));(0,r.useEffect)((()=>{s.current={scrollBy:v,scrollTo:b}}),[s,v,b]),(0,r.useLayoutEffect)((()=>p(l.clientSize,l.scrollSize)),[l.clientSize,l.scrollSize,p]),(0,r.useLayoutEffect)((()=>null==a?void 0:a(d)),[d,a]),(0,r.useLayoutEffect)((()=>null==o?void 0:o(g)),[g,o]),kt(c,(()=>{const e=c.current.getBoundingClientRect();x(O?e.height:e.width),y(O?e.width:e.height)})),kt(u,(()=>{const e=u.current.getBoundingClientRect();S(O?e.height:e.width)}));const N=(0,r.useCallback)(((e,t)=>{const n=()=>s.current.scrollBy(t),r=t=>t.target===e,i=on(document,"mouseup"),a=on(e,"mouseover").pipe(Xt(r),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=mn(e);return Oe((function(t,r){(n?gn(e,t,n):gn(e,t)).subscribe(r)}))}(!0)),o=bn(a,on(e,"mouseout").pipe(ze(r),Xt((()=>!1)))).pipe(yn(((e,t)=>e?Rt(0===t?400:0,40):cn)),wn(i)).subscribe(n);return n(),()=>o.unsubscribe()}),[s]),$=(0,r.useCallback)((e=>{if(0===e.button)return N(e.target,-i)}),[i,N]),z=(0,r.useCallback)((e=>{if(0===e.button)return N(e.target,i)}),[i,N]),j=(0,r.useCallback)((e=>{if(0===e.button){const t=O?e.nativeEvent.offsetY:e.nativeEvent.offsetX;return N(e.target,t<M?-h:h)}}),[O,h,M,N]),L=(0,r.useCallback)((e=>{e.stopPropagation(),0===e.button&&(P(O?e.screenY:e.screenX),A(M))}),[O,M]),R=(0,r.useCallback)((e=>{const t=O?e.screenY:e.screenX;b((T+(t-C))*m/(E-k))}),[O,C,T,m,k,E,b]),_=(0,r.useCallback)((()=>{P(-1),A(0)}),[]);return(0,r.useEffect)((()=>{if(I)return document.body.classList.add("dragging"),document.addEventListener("mouseup",_),document.addEventListener("mousemove",R),()=>{document.body.classList.remove("dragging"),document.removeEventListener("mouseup",_),document.removeEventListener("mousemove",R)}}),[I,R,_]),r.createElement("div",{className:`scrollbar scrollbar-${n}`,role:"scrollbar","aria-controls":t,"aria-orientation":n,"aria-valuenow":Number((100*d/m).toFixed(1)),"aria-valuemin":0,"aria-valuemax":100,onContextMenu:w,onMouseDown:w},r.createElement("div",{className:"scrollbar-button scrollbar-button-decrement",onMouseDown:$},r.createElement("svg",{className:"icon",viewBox:"0 0 50 50"},r.createElement("polygon",{points:O?"0,50 25,0 50,50":"50,0 0,25 50,50"}))),r.createElement("div",{className:"scrollbar-track",onMouseDown:j,ref:c},r.createElement("div",{className:"scrollbar-thumb",onMouseDown:L,style:{[O?"height":"width"]:E*(f?h/f:0)+"px",transform:`translate${O?"Y":"X"}(${M}px)`},ref:u})),r.createElement("div",{className:"scrollbar-button scrollbar-button-increment",onMouseDown:z},r.createElement("svg",{className:"icon",viewBox:"0 0 50 50"},r.createElement("polygon",{points:O?"0,0 25,50 50,0":"0,0 50,25 0,50"}))))}));function Cn({children:e,scrollWidth:t=0,scrollHeight:n=0,scrollAmount:i=10,droppable:a,onResize:o,onScroll:s,scrollableRef:l}){const c=(0,r.useId)(),u=(0,r.useRef)(null),m=(0,r.useRef)(null),h=(0,r.useRef)(null),f=(0,r.useRef)(null),p=(0,r.useRef)(null),v=(0,r.useRef)(null),[b,g]=(0,r.useState)(0),[y,w]=(0,r.useState)(0),[E,x]=(0,r.useState)(0),[k,S]=(0,r.useState)(0),[C,P]=(0,r.useState)(0),[T,A]=(0,r.useState)(t),[I,O]=(0,r.useState)(n),[M,N]=(0,r.useState)(0),[$,z]=(0,r.useState)(0),[j,L]=(0,r.useState)(!1),[R,_]=(0,r.useState)(!1),[D,F]=(0,r.useState)(0),V=Math.max(M-(R?y:0),0),U=Math.max($-(j?b:0),0);(0,r.useEffect)((()=>{l&&(l.current={scrollTo:({left:e,top:t})=>{void 0!==e&&p.current.scrollTo(e),void 0!==t&&v.current.scrollTo(t)}})}),[l]),(0,r.useLayoutEffect)((()=>{T&&V?L(T-V>1):_(!1)}),[T,V]),(0,r.useLayoutEffect)((()=>{_(!(!I||!U)&&I-U>1)}),[I,U]),(0,r.useLayoutEffect)((()=>{u.current.classList.toggle("overflow-x",j)}),[j]),(0,r.useLayoutEffect)((()=>{u.current.classList.toggle("overflow-y",R)}),[R]),(0,r.useLayoutEffect)((()=>{var e;A(0===t?(null===(e=m.current)||void 0===e?void 0:e.scrollWidth)||0:t)}),[t]),(0,r.useLayoutEffect)((()=>{var e;O(0===n?(null===(e=m.current)||void 0===e?void 0:e.scrollHeight)||0:n)}),[n]);const B=(0,r.useCallback)((()=>{const e=u.current;N(e.clientWidth),z(e.clientHeight),x(e.getBoundingClientRect().top)}),[]),H=(0,r.useCallback)((()=>{var e;const r=m.current,i=f.current;0===t&&A(r.scrollWidth),0===n&&O(i.scrollHeight+((null===(e=h.current)||void 0===e?void 0:e.clientHeight)||0));const{clientWidth:a,clientHeight:s}=r,{scrollWidth:l,scrollHeight:c}=i;null==o||o({clientWidth:a,clientHeight:s,scrollWidth:l,scrollHeight:c})}),[t,n,o]);kt(u,B),kt(m,H),kt(f,H),(0,r.useLayoutEffect)((()=>{null==s||s({left:k,top:C})}),[k,C,s]);const Y=(0,r.useCallback)((e=>{v.current.scrollBy(3*i*Math.sign(e.deltaY))}),[i]),K=(0,r.useCallback)((e=>{const t=e.nativeEvent.clientY-E;t+i/2>$?F(i):t<i&&F(-i)}),[E,$,i]);(0,r.useEffect)((()=>{if(D){const e=()=>v.current.scrollBy(D),t=_t(100).subscribe(e);return()=>t.unsubscribe()}}),[D]);const W=(0,r.useCallback)((()=>F(0)),[]),[q,J]=d(r.Children.toArray(e),(e=>(null==e?void 0:e.type)===Dt));return r.createElement("div",{className:"scrollable",id:c,onWheel:Y,ref:u},r.createElement("div",{className:"scrollable-content",onDragOver:a?K:void 0,onDragLeave:a?W:void 0,onDragEnd:a?W:void 0,onDrop:a?W:void 0,style:{right:R?`${y}px`:"0",bottom:j?`${b}px`:"0",transform:`translateX(-${k}px)`},ref:m},q?r.createElement("div",{className:"scrollable-head",ref:h},q):null,r.createElement("div",{className:"scrollable-body",style:{width:t?`${t}px`:void 0}},r.createElement("div",{className:"scrollable-body-content",style:{transform:`translateY(-${C}px)`},ref:f},J))),r.createElement(Sn,{scrollableId:c,orientation:"horizontal",clientSize:V,scrollSize:T,scrollAmount:i,onChange:S,onResize:g,scrollbarRef:p}),r.createElement(Sn,{scrollableId:c,orientation:"vertical",clientSize:U,scrollSize:I,scrollAmount:i,onChange:P,onResize:w,scrollbarRef:v}))}function Pn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return vn(e,mn(e))}function Tn(e,t=200){const[n,i]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const n=t=>!e||e.includes(t.code),r=(e,t)=>on(document,e,{capture:!0}).pipe(ze(n),Xt((()=>t))),a=bn(r("keydown",!0),r("keyup",!1)).pipe((o=e=>e?Pn(0):Rt(t),Oe((function(e,t){var n=!1,r=null,i=null,a=function(){if(null==i||i.unsubscribe(),i=null,n){n=!1;var e=r;r=null,t.next(e)}};e.subscribe(Me(t,(function(e){null==i||i.unsubscribe(),n=!0,r=e,i=Me(t,a,ce),Jt(o(e)).subscribe(i)}),(function(){a(),t.complete()}),void 0,(function(){r=i=null})))})))).subscribe(i);var o;return()=>a.unsubscribe()}),[e,t]),n}function An(e){return(0,r.useMemo)((()=>In(e)),[e])}function In(e){return e.reduce(((e,t)=>(e.push(t.id),t.children?e.concat(In(t.children)):e)),[])}function On(e){return{storeExpandedState:(0,r.useCallback)(((t,n)=>{e&&localStorage.setItem(`${e}/${t}`,String(!!n))}),[e]),retrieveExpandedState:(0,r.useCallback)(((t,n=!1)=>{if(e){const r=localStorage.getItem(`${e}/${t}`);return"string"==typeof r?"true"===r:n}return n}),[e]),storeSelectedNodeId:(0,r.useCallback)((t=>{e&&localStorage.setItem(`${e}/selectedId`,t)}),[e]),retrieveSelectedNodeId:(0,r.useCallback)((t=>e&&localStorage.getItem(`${e}/selectedId`)||t),[e])}}function Mn(e,t){return e.reduce(((e,n)=>(t(n.id,n.startExpanded)&&e.push(n.id),n.children?e.concat(Mn(n.children,t)):e)),[])}function Nn(e,t){return(0,r.useMemo)((()=>$n(e,t)),[e,t])}function $n(e,t){return e.reduce(((e,n)=>(e.push(n.id),n.children&&t.includes(n.id)?e.concat($n(n.children,t)):e)),[])}var zn=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function jn({id:e,label:t,children:n=[],selectedId:i,expandedIds:a,level:o,rowHeight:s,nodeIndex:l,setSize:c,emptyMarker:u,onSelect:d,onToggle:m}){const h=a.includes(e),f=0!==n.length,p=e===i,v=`${f?"expandable":""} ${h?"expanded":""} ${p?"selected":""} ${0===n.length?"empty":""}`,b=(0,r.useCallback)((e=>{e.stopPropagation()}),[]),g=(0,r.useCallback)((t=>{t.stopPropagation(),null==d||d(e)}),[e,d]),y=(0,r.useCallback)((t=>{t.stopPropagation(),null==m||m(e)}),[e,m]),w=(0,r.useCallback)((t=>{t.stopPropagation(),null==m||m(e),h&&Fn(n,i)&&(null==d||d(e))}),[e,i,h,n,d,m]);return r.createElement("li",{className:`tree-view-node ${v}`,id:`tree-view-node-${e}`,role:"treeitem","aria-selected":p?"true":void 0,"aria-expanded":h?"true":void 0,"aria-labelledby":`tree-view-node-label-${e}`,"aria-level":o,"aria-setsize":c,"aria-posinset":l+1,onMouseDown:g},r.createElement("span",{className:"tree-view-row "+(p?"selected-text":""),onDoubleClick:y,style:{height:`${s}px`}},f?r.createElement("svg",{className:"tree-view-node-marker",viewBox:`0 0 ${h?320:256} 512`,onMouseDown:b,onClick:w},h?r.createElement("path",{d:"M143 352.3L7 216.3c-9.4-9.4-9.4-24.6 0-33.9l22.6-22.6c9.4-9.4 24.6-9.4 33.9 0l96.4 96.4 96.4-96.4c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9l-136 136c-9.2 9.4-24.4 9.4-33.8 0z"}):r.createElement("path",{d:"M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"})):u&&r.createElement("svg",{className:"tree-view-node-marker empty-marker",viewBox:"0 0 24 24",onMouseDown:b},r.createElement("circle",{cx:"12",cy:"12",r:"4"})),r.createElement("span",{className:"tree-view-node-label",id:`tree-view-node-label-${e}`},t)),h&&r.createElement("ul",{className:"tree-view-node-children",role:"group"},n.map(((e,t)=>{var{id:l}=e,c=zn(e,["id"]);return r.createElement(jn,Object.assign({},c,{id:l,selectedId:i,expandedIds:a,level:o+1,rowHeight:s,nodeIndex:t,setSize:n.length,onSelect:d,onToggle:m,key:l}))}))))}var Ln=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Rn=24,_n=["ArrowUp","ArrowDown"];function Dn({roots:e,className:t="",storageId:n,onContextMenu:i,onDelete:a,onEnter:o,onInfo:s,onSelect:l,treeViewRef:c}){const u=(0,r.useRef)(null),d=(0,r.useRef)(null),m=(0,r.useRef)(null),{storeSelectedNodeId:h,retrieveSelectedNodeId:f}=On(n),[p,v]=(0,r.useState)(""),{expandedIds:b,toggle:g}=function(e,t){const{storeExpandedState:n,retrieveExpandedState:i}=On(t),a=An(e),[o,s]=(0,r.useState)((()=>Mn(e,i)));(0,r.useEffect)((()=>{s(Mn(e,i))}),[e,i]),(0,r.useEffect)((()=>{const e=o.filter((e=>a.includes(e)));e.length!==o.length&&s(e)}),[a,o]);const l=(0,r.useCallback)(((e,t)=>{const r=o.includes(e);r!==t&&(s(r?o.filter((t=>t!==e)):o.concat(e)),n(e,!r))}),[o,n]);return{expandedIds:o,toggle:l}}(e,n),y=Nn(e,b),w=y.indexOf(p),[E,x]=(0,r.useState)(0),[k,S]=(0,r.useState)(Rn),[C,P]=(0,r.useState)(0),T=Math.floor(E/k)-1,A=y.length,I=Vn(e,p),O=Tn(_n)&&!(0===w||w===A-1),[M,N]=(0,r.useState)((()=>I)),$=(0,r.useCallback)((()=>u.current.focus()),[]);(0,r.useEffect)((()=>{c&&(c.current={focus:$})}),[c,$]),(0,r.useEffect)((()=>{!p&&e.length>0&&v(f(e[0].id))}),[e,p,f]),(0,r.useLayoutEffect)((()=>{if(!Fn(e,p)){const t=e.find((e=>null==p?void 0:p.startsWith(`${e.id}/`)))||e[0];v(null==t?void 0:t.id)}}),[e,p]),(0,r.useLayoutEffect)((()=>{null==l||l(M)}),[M,l]),(0,r.useEffect)((()=>{p&&h(p)}),[p,h]),(0,r.useEffect)((()=>{O||N(I)}),[I,O]);const z=(0,r.useCallback)((e=>{e.preventDefault(),null==i||i(I,e.pageX,e.pageY)}),[I,i]),j=(0,r.useCallback)((e=>{switch(e.code){case"Enter":e.stopPropagation(),e.repeat||null==o||o(I);break;case"Delete":e.stopPropagation(),e.repeat||null==a||a(I);break;case"KeyI":e.stopPropagation(),!e[U.ctrlKey]||e.shiftKey||e.repeat||null==s||s(I);break;case"ArrowLeft":e.stopPropagation(),e.repeat||g(p,!1);break;case"ArrowRight":e.stopPropagation(),e.repeat||g(p,!0);break;default:{const t=function(e,t,n){switch(e){case"ArrowUp":return t[t.indexOf(n)-1]||n;case"ArrowDown":return t[t.indexOf(n)+1]||n;case"Home":return t[0]||n;case"End":return t[t.length-1]||n;default:return""}}(e.key,y,p);if(t&&(e.preventDefault(),t!==p)){e.stopPropagation();const n=d.current,r=Math.floor(C/k),i=y.indexOf(t);if(i>=r+T-1){const e=A*k,t=A-T-1,r=Math.min(A-1,i+1)-T,a=r===t?e:r*k;n.scrollTo({top:a})}else if(i<=r){const e=Math.max(0,i-1)*k;n.scrollTo({top:e})}v(t)}}}}),[y,p,I,k,T,A,C,a,o,s,g]),L=(0,r.useCallback)((({clientHeight:e})=>x(e)),[]),R=(0,r.useCallback)((({top:e})=>P(e)),[]);return kt(m,(()=>{S(m.current.getBoundingClientRect().height)})),r.createElement("div",{className:`tree-view ${t}`,tabIndex:0,onContextMenu:z,onKeyDown:j,ref:u},r.createElement(Cn,{scrollAmount:k,onResize:L,onScroll:R,scrollableRef:d},r.createElement("ul",{role:"tree"},e.map(((t,n)=>{var{id:i}=t,a=Ln(t,["id"]);return r.createElement(jn,Object.assign({},a,{id:i,selectedId:p,expandedIds:b,level:1,rowHeight:k,nodeIndex:n,setSize:e.length,emptyMarker:!0,onSelect:v,onToggle:g,key:i}))}))),r.createElement("div",{className:"tree-view-cursor",style:{transform:`translateY(${w*k}px)`},ref:m})))}function Fn(e,t){for(const n of e){if(n.id===t)return!0;if(n.children&&Fn(n.children,t))return!0}return!1}function Vn(e,t){return e.reduce(((e,n)=>{if(void 0===e)if(n.id===t)e=n.value;else if(n.children)return Vn(n.children,t);return e}),void 0)}var Un;!function(e){e.Pin="pin",e.Unpin="unpin",e.Like="like",e.Unlike="unlike",e.Rate="rate",e.Info="info",e.AddToLibrary="library-add",e.RemoveFromLibrary="library-remove",e.PlayNow="play-now",e.PlayNext="play-next",e.Queue="queue"}(Un||(Un={}));const Bn=Un;var Hn;!function(e){e[e.Media=0]="Media",e[e.Album=1]="Album",e[e.Artist=2]="Artist",e[e.Playlist=3]="Playlist",e[e.Folder=4]="Folder"}(Hn||(Hn={}));const Yn=Hn;var Kn;!function(e){e[e.Default=0]="Default",e[e.History=1]="History",e[e.RecentlyPlayed=2]="RecentlyPlayed",e[e.MostPlayed=3]="MostPlayed",e[e.Library=4]="Library",e[e.Ratings=5]="Ratings"}(Kn||(Kn={}));const Wn=Kn;var qn=Array.isArray,Jn=Object.getPrototypeOf,Qn=Object.prototype,Xn=Object.keys;function Gn(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=mn(e),r=dn(e),i=function(e){if(1===e.length){var t=e[0];if(qn(t))return{args:t,keys:null};if((r=t)&&"object"==typeof r&&Jn(r)===Qn){var n=Xn(t);return{args:n.map((function(e){return t[e]})),keys:n}}}var r;return{args:e,keys:null}}(e),a=i.args,o=i.keys;if(0===a.length)return vn([],n);var s=new Se(function(e,t,n){return void 0===n&&(n=ke),function(r){Zn(t,(function(){for(var i=e.length,a=new Array(i),o=i,s=i,l=function(i){Zn(t,(function(){var l=vn(e[i],t),c=!1;l.subscribe(Me(r,(function(e){a[i]=e,c||(c=!0,s--),s||r.next(n(a.slice()))}),(function(){--o||r.complete()})))}),r)},c=0;c<i;c++)l(c)}),r)}}(a,n,o?function(e){return function(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})}(o,e)}:ke));return r?s.pipe(tn(r)):s}function Zn(e,t,n){e?Gt(n,e,t):t()}function er(e,t){return void 0===t&&(t=ke),e=null!=e?e:tr,Oe((function(n,r){var i,a=!0;n.subscribe(Me(r,(function(n){var o=t(n);!a&&e(i,o)||(a=!1,i=o,r.next(n))})))}))}function tr(e,t){return e===t}const nr=new Te,rr={dispatch:function(e){const t=Array.isArray(e)?e:[e];nr.next(t)},observe:function(){return nr}};var ir=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};class ar extends vt.ZP{constructor(){super("ampcast/library-removals"),this.libraryRemovals$=new Ie([]),this.lock$=new Ie(null),this.version(1).stores({libraryRemovals:"&src"}),(0,vt.Y1)((()=>this.libraryRemovals.toArray())).subscribe(this.libraryRemovals$)}observeRemovals(e){return Gn([this.libraryRemovals$,this.lock$]).pipe(ze((([e])=>e.length>0)),Xt((([t])=>t.filter((t=>t.src.startsWith(`${e}:`)&&!this.isLocked(t))))),er(((e,t)=>{const n=e.map((e=>e.src)).sort(),r=t.map((e=>e.src)).sort();return String(n)===String(r)})))}lock(e,t){this.lock$.next({serviceId:e,itemType:t})}unlock(){this.lock$.next(null)}store(e,t){return ir(this,void 0,void 0,(function*(){const n=e.src,[r]=n.split(":"),i=jl(r);if(!i)throw Error(`Service not found '${r}'.`);if(!i.store)throw Error(`store() not supported by ${r}.`);this.isLocked(e)?t?yield this.libraryRemovals.delete(n):yield this.libraryRemovals.put(this.createLibraryObject(e)):yield i.store(e,t),rr.dispatch({match:e=>e.src===n,values:{inLibrary:t}})}))}applyRemovals(e){return ir(this,void 0,void 0,(function*(){if(e.length>0){const t=e.map((e=>e.src));yield this.libraryRemovals.bulkDelete(t),rr.dispatch({match:e=>t.includes(e.src),values:{inLibrary:!1}})}}))}get(e,t){return!this.isRemoved(e)&&t}isRemoved(e){return-1!==this.libraryRemovals$.getValue().findIndex((t=>t.src===e))}isLocked(e){const t=this.lock$.getValue();if(t){const[n]=e.src.split(":");return t.serviceId===n&&t.itemType===e.itemType}return!1}createLibraryObject(e){if("pager"in e){const{pager:t}=e;return function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["pager"])}return e}}const or=new ar;function sr(e,t){return G(t)?Zt(e,t,1):Zt(e,1)}function lr(e){return Oe((function(t,n){var r,i=null,a=!1;i=t.subscribe(Me(n,void 0,void 0,(function(o){r=Jt(e(o,lr(e)(t))),i?(i.unsubscribe(),i=null,r.subscribe(n)):a=!0}))),a&&(i.unsubscribe(),i=null,r.subscribe(n))}))}var cr=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};class ur extends vt.ZP{constructor(){super("ampcast/rating-removals"),this.ratingRemovals$=new Ie([]),this.lock$=new Ie(null),this.logger=new A("ratingStore"),this.version(1).stores({ratingRemovals:"&src"}),(0,vt.Y1)((()=>this.ratingRemovals.toArray())).subscribe(this.ratingRemovals$)}addObserver(e,t=10){if(!e.rate)return void this.logger.error(`rate() not supported by ${e.id}.`);const n=this.logger.id(e.id);this.observeRemovals(e.id).pipe(Xt((e=>e.slice(0,t))),sr((t=>Promise.all(t.map((t=>e.rate(t,0).then((()=>t))))))),sr((e=>this.applyRemovals(e))),lr((e=>(n.error(e),[])))).subscribe(n)}observeRemovals(e){return Gn([this.ratingRemovals$,this.lock$]).pipe(ze((([e])=>e.length>0)),Xt((([t])=>t.filter((t=>t.src.startsWith(`${e}:`)&&!this.isLocked(t))))),er(((e,t)=>{const n=e.map((e=>e.src)).sort(),r=t.map((e=>e.src)).sort();return String(n)===String(r)})))}lock(e,t){this.lock$.next({serviceId:e,itemType:t})}unlock(){this.lock$.next(null)}rate(e,t){return cr(this,void 0,void 0,(function*(){const n=e.src,[r]=n.split(":"),i=jl(r);if(!i)throw Error(`Service not found '${r}'.`);if(!i.rate)throw Error(`rate() not supported by ${r}.`);{const n=this.getRemovedItem(e);this.isLocked(e)?t?(n&&(yield this.ratingRemovals.delete(n.src)),t>1&&(yield i.rate(e,t))):n||(yield this.ratingRemovals.put(this.createRatingObject(e))):(n&&(yield this.ratingRemovals.delete(n.src)),yield i.rate(e,t)),rr.dispatch({match:t=>i.compareForRating(t,e),values:{rating:t}})}}))}get(e,t){return this.getRemovedItem(e)?0:t}applyRemovals(e){return cr(this,void 0,void 0,(function*(){const t=e.map((e=>this.getRemovedItem(e))).filter(l);if(t.length>0){const e=t.map((e=>e.src));yield this.ratingRemovals.bulkDelete(e),rr.dispatch({match:e=>{const[n]=e.src.split(":"),r=jl(n);return t.some((t=>null==r?void 0:r.compareForRating(e,t)))},values:{rating:0}})}}))}getRemovedItem(e){const[t]=e.src.split(":"),n=jl(t);if(null==n?void 0:n.rate)return this.ratingRemovals$.getValue().find((t=>n.compareForRating(t,e)))}isLocked(e){const t=this.lock$.getValue();if(t){const[n]=e.src.split(":");return t.serviceId===n&&t.itemType===e.itemType}return!1}createRatingObject(e){if("pager"in e){const{pager:t}=e;return function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["pager"])}return e}}const dr=new ur;function mr(e){return e<=0?function(){return cn}:Oe((function(t,n){var r=0;t.subscribe(Me(n,(function(t){++r<=e&&(n.next(t),e<=r&&n.complete())})))}))}function hr(e,{timeout:t=5e3,keepAlive:n=!1}={}){return new Promise(((r,i)=>{const a=n?void 0:()=>e.disconnect(),o=e.observeItems(),s=bn(e.observeError(),Rt(t).pipe(Xt((()=>Error("timeout")))));o.pipe(wn(s),mr(1)).subscribe({next:r,complete:a}),s.pipe(wn(o),mr(1)).subscribe({next:i,complete:a}),e.fetchAt(0)}))}class fr{constructor(e=[]){this.items=e}get maxSize(){}observeItems(){return Pn(this.items)}observeSize(){return Pn(this.items.length)}observeError(){return cn}fetchAt(){}disconnect(){this.items.forEach((e=>{var t;return null===(t=e.pager)||void 0===t?void 0:t.disconnect()}))}}const pr="eyJhbGciOiJFUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6Ijk3RjI2N1daRDkifQ.eyJpYXQiOjE2NzY5MTcxNzEsImV4cCI6MTY5MjQ2OTE3MSwiaXNzIjoiODM4Nk5ERlhMQiJ9.gb8gDSxxWxSQNKWz_OtyMumKDn8wil6kYAMYHcNgzYhr9k0QS7R8JJp_3DCJxy_9KlgGe7wmlLESpvsQ2Zd2Pg".toString(),vr="41bd731be5b78200d2bbaea2312b917b".toString(),br="78aa93b641329f00e68cf1542356b8fc".toString(),gr="68c1c915728f4b9da193da1028692f0d".toString(),yr="AIzaSyD-cQaU5ntJBcCEBAbmK5pIXD4FQ19fdho".toString(),wr="364143070327-sgopc15lidje8uq4l16k1u8pqo2hpc4o.apps.googleusercontent.com".toString(),Er=new z("apple"),xr={get useMusicKitBeta(){return Er.getBoolean("useMusicKitBeta")},set useMusicKitBeta(e){Er.setBoolean("useMusicKitBeta",e)},clear(){Er.clear()}};var kr=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};class Sr{constructor(e){this.MusicKit=e}get version(){return this.MusicKit.version}get Events(){return this.MusicKit.Events}get PlaybackStates(){return this.MusicKit.PlaybackStates}configure(e){return kr(this,void 0,void 0,(function*(){const t=this.MusicKit.configure(e);return this.instance=t,Object.defineProperties(t,{volume:{get:()=>t.player.volume,set:e=>t.player.volume=e},queue:{get:()=>t.player.queue},isPlaying:{get:()=>t.player.isPlaying},nowPlayingItem:{get:()=>t.player.nowPlayingItem}}),Object.defineProperties(t.api,{music:{get:()=>(e,t,n)=>this.music(e,t,n)}}),this.instance}))}getInstance(){const e=this.instance;if(e)return e.api.music||Object.defineProperties(e.api,{music:{get:()=>(e,t,n)=>this.music(e,t,n)}}),e;throw Error("Not configured.")}formatArtworkURL(e,t,n){return this.MusicKit.formatArtworkURL(e,t,n)}music(e,t,n){return kr(this,void 0,void 0,(function*(){const r=this.getInstance();t&&(e=`${e}${e.includes("?")?"&":"?"}${new URLSearchParams(t)}`),e=e.replace("{{storefrontId}}",r.storefrontId);const i=(null==n?void 0:n.fetchOptions)||{};i.headers||(i.headers={}),i.headers=Object.assign(Object.assign({},i.headers),{authorization:`Bearer ${r.developerToken}`,"music-user-token":r.musicUserToken});const a=yield fetch(`https://api.music.apple.com${e}`,i);if(!a.ok)throw a;return{data:yield a.json()}}))}}var Cr=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::appleAuth");const Pr=new A("appleAuth"),Tr=new Ie("");function Ar(){return""!==Tr.getValue()}function Ir(){return Tr.pipe(er()).pipe(Xt((e=>""!==e)),er())}function Or(){return Cr(this,void 0,void 0,(function*(){return window.MusicKit?MusicKit.getInstance():new Promise(((e,t)=>{c(`https://js-cdn.music.apple.com/musickit/v${xr.useMusicKitBeta?3:1}/musickit.js`).then(void 0,t),document.addEventListener("musickitloaded",(()=>Cr(this,void 0,void 0,(function*(){Pr.log("Loaded MusicKit version",MusicKit.version),window.MusicKit.version.startsWith("1")&&(window.MusicKit=new Sr(MusicKit));try{const t=yield window.MusicKit.configure({developerToken:pr,app:{name:"ampcast",build:"0.8.12"},sourceType:8,suppressErrorDialog:!0});e(t)}catch(e){t(e)}}))))}))}))}var Mr;!function(){Cr(this,void 0,void 0,(function*(){const e=yield Or();if(e.isAuthorized){const t=yield e.authorize();Pr.log("Access token successfully obtained."),Tr.next(t)}}))}(),function(e){e[e.Audio=0]="Audio",e[e.Video=1]="Video"}(Mr||(Mr={}));const Nr=Mr,$r=new A("DualPager");class zr{constructor(e,t){this.topPager=e,this.mainPager=t,this.fetches$=new Ie({index:0,length:0}),this.disconnected=!1}get maxSize(){}observeItems(){return Gn([this.topPager.observeItems(),this.mainPager.observeItems()]).pipe(Xt((([e,t])=>e.concat(t))))}observeSize(){return Gn([this.topPager.observeSize(),this.mainPager.observeSize()]).pipe(Xt((([e,t])=>e+t)))}observeError(){return this.mainPager.observeError()}disconnect(){var e;this.disconnected||(this.disconnected=!0,null===(e=this.subscriptions)||void 0===e||e.unsubscribe(),this.topPager.disconnect(),this.mainPager.disconnect())}fetchAt(e,t){this.disconnected?$r.warn("disconnected"):(this.subscriptions||this.connect(),this.fetches$.next({index:e,length:t}))}connect(){this.subscriptions||(this.subscriptions=new ne,this.subscriptions.add(Gn([this.topPager.observeSize(),this.observeFetches()]).pipe($e((([e,t])=>this.mainPager.fetchAt(Math.max(t.index-e,0),t.length)))).subscribe($r)))}observeFetches(){return this.fetches$.pipe(ze((e=>e.length>0)))}}var jr=function(e){function t(t,n,r){void 0===t&&(t=1/0),void 0===n&&(n=1/0),void 0===r&&(r=Nt);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=n,i._timestampProvider=r,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=n===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,n),i}return K(t,e),t.prototype.next=function(t){var n=this,r=n.isStopped,i=n._buffer,a=n._infiniteTimeWindow,o=n._timestampProvider,s=n._windowTime;r||(i.push(t),!a&&i.push(o.now()+s)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),n=this._infiniteTimeWindow,r=this._buffer.slice(),i=0;i<r.length&&!e.closed;i+=n?1:2)e.next(r[i]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this,t=e._bufferSize,n=e._timestampProvider,r=e._buffer,i=e._infiniteTimeWindow,a=(i?1:2)*t;if(t<1/0&&a<r.length&&r.splice(0,r.length-a),!i){for(var o=n.now(),s=0,l=1;l<r.length&&r[l]<=o;l+=2)s=l;s&&r.splice(0,s+1)}},t}(Te);const Lr=[],Rr=new A("AbstractPager");let _r=0;class Dr{constructor(e={}){this.config=e,this.items$=new Ie(Lr),this.size$=new jr(1),this.error$=new jr(1),this.fetches$=new Ie({index:0,length:0}),this.disconnected=!1}get maxSize(){return this.config.maxSize}observeAdditions(){return this.items$.pipe(Oe((function(e,t){var n,r=!1;e.subscribe(Me(t,(function(e){var i=n;n=e,r&&t.next([i,e]),r=!0})))})),Xt((([e,t])=>t.filter((t=>!e.find((e=>(null==e?void 0:e.src)===t.src)))))),ze((e=>e.length>0)))}observeItems(){return this.items$.pipe(ze((e=>e!==Lr)))}observeSize(){return this.size$.pipe(er())}observeError(){return this.error$}disconnect(){this.disconnected||(this.disconnected=!0,this.subscriptions&&(this.subscriptions.unsubscribe(),_r--),this.items.forEach((e=>{var t;return null===(t=e.pager)||void 0===t?void 0:t.disconnect()})),this.items$.complete(),this.size$.complete(),this.error$.complete())}fetchAt(e,t=this.config.pageSize){if(this.disconnected)Rr.warn("disconnected");else{if(t||(t=50),!this.subscriptions&&(this.connect(),this.config.calculatePageSize)){const{minPageSize:e=10,maxPageSize:n=100}=this.config,r=10*Math.ceil(2*t/10);this.config.pageSize=Math.max(Math.min(r,n),e)}this.fetches$.next({index:e,length:t})}}get items(){return this.items$.getValue()}observeComplete(){return Gn([this.observeItems(),this.observeSize()]).pipe(ze((([e,t])=>e.reduce((e=>e+1),0)===t)),Xt((([e])=>e)),mr(1))}connect(){this.disconnected||this.subscriptions||(_r++,_r>100&&Rr.warn(`Too many pagers? Connected pagers=${_r}.`),this.subscriptions=new ne,this.config.lookup||(this.subscriptions.add(this.observeAdditions().pipe($e((e=>this.addMissingTrackCounts(e)))).subscribe(Rr)),this.subscriptions.add(rr.observe().pipe($e((e=>this.applyChanges(e)))).subscribe(Rr))))}applyChanges(e){let t=!1;const n=this.items.map((n=>{for(const{match:r,values:i}of e)if(r(n))return t=!0,Object.assign(Object.assign({},n),i);return n}));t&&this.items$.next(n)}addMissingTrackCounts(e){e.forEach((e=>{e.itemType===Yn.Playlist&&!e.trackCount&&e.pager&&this.subscriptions.add(e.pager.observeSize().pipe($e((t=>{const n=e.src,r=this.items.findIndex((e=>e.src===n));if(-1!==r){const e=this.items.slice(),n=e[r];e[r]=Object.assign(Object.assign({},n),{trackCount:t}),this.items$.next(e)}}))).subscribe(Rr))}))}}const Fr=new A("SequentialPager");class Vr extends Dr{constructor(e,t){super(t),this.fetchNext=e,this.fetching$=new Ie(!1),this.maxEmptyCount=2,this.emptyCount=0}connect(){this.subscriptions||(super.connect(),this.subscriptions.add(this.observeShouldFetch().pipe($e((()=>this.fetching$.next(!0))),sr((()=>this.fetchNext(this.config.pageSize))),$e((e=>this.addPage(e))),lr((e=>(Fr.error(e),this.error$.next(e),Pn(void 0)))),$e((()=>this.fetching$.next(!1))),wn(this.observeComplete()),mr(100)).subscribe(Fr)))}observeShouldFetch(){const e=Gn([this.fetches$,this.items$]).pipe(Xt((([{index:e,length:t},n])=>e+2*t>=n.length)),ze((e=>e)),Xt((()=>{})),mr(1));return this.fetching$.pipe(yn((t=>t?cn:e)))}addPage(e){var t,n;const r=(e.items||[]).filter(l),i=h(this.items.concat(r),"src");i.length===this.items.length&&this.emptyCount++,i.length=Math.min(i.length,null!==(t=this.maxSize)&&void 0!==t?t:1/0);const a=e.atEnd||i.length===this.maxSize||this.emptyCount>this.maxEmptyCount?i.length:e.total;void 0!==a&&this.size$.next(Math.min(a,null!==(n=this.maxSize)&&void 0!==n?n:1/0)),this.items$.next(i)}}class Ur extends Dr{constructor(e){super(),this.fetch=e}fetchAt(e){if(!this.disconnected&&!this.subscriptions){this.connect();const t=this.fetch(e);this.size$.next(t.length),this.items$.next(t)}}disconnect(){super.disconnect(),this.items.forEach((e=>{var t;return null===(t=e.pager)||void 0===t?void 0:t.disconnect()}))}}var Br=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};const Hr=new A("pinStore"),Yr=[];class Kr extends vt.ZP{constructor(){super("ampcast/pins"),this.pins$=new Ie(Yr),this.lockedPin$=new Ie(null),this.version(1).stores({pins:"&src"}),(0,vt.Y1)((()=>this.pins.toArray())).subscribe(this.pins$)}lock(e){this.lockedPin$.next(e)}unlock(){this.lockedPin$.next(null)}pin(e){return Br(this,void 0,void 0,(function*(){try{const t=Array.isArray(e)?e:[e];Hr.log("pin",{playlists:t}),yield this.pins.bulkPut(t.map((e=>{const{pager:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["pager"]);return Object.assign(Object.assign({},n),{isPinned:!0})}))),rr.dispatch(t.map((e=>({match:t=>t.src===e.src,values:{isPinned:!0}}))))}catch(e){Hr.error(e)}}))}unpin(e){return Br(this,void 0,void 0,(function*(){try{const t=Array.isArray(e)?e:[e];Hr.log("unpin",{playlists:t}),yield this.pins.bulkDelete(t.map((e=>e.src))),rr.dispatch(t.map((e=>({match:t=>t.src===e.src,values:{isPinned:!1}}))))}catch(e){Hr.error(e)}}))}isPinned(e){return-1!==this.pins$.getValue().findIndex((t=>t.src===e))}observe(){return Gn([this.pins$,this.lockedPin$]).pipe(ze((([e])=>e!==Yr)),Xt((([e])=>e)))}getPinsForService(e){const t=this.pins$.getValue().slice(),n=this.lockedPin$.getValue();return n&&!t.find((e=>e.src===n.src))&&t.push(n),t.filter((t=>t.src.startsWith(`${e}:`))).sort(((e,t)=>e.title.localeCompare(t.title,void 0,{sensitivity:"accent",ignorePunctuation:!0})))}}const Wr=new Kr;var qr=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};const Jr=new A("MusicKitPager");class Qr{static defaultToPage(e){var t,n,r;const i=(null===(n=null===(t=e.data[0])||void 0===t?void 0:t.relationships)||void 0===n?void 0:n.tracks)||e,a=i.data||[],o=i.next;return{items:a,total:null===(r=i.meta)||void 0===r?void 0:r.total,nextPageUrl:o}}constructor(e,t,n,r,i=Qr.defaultToPage){this.options=n,this.parent=r,this.nextPageUrl=void 0,this.pager=new Vr((n=>qr(this,void 0,void 0,(function*(){const r=yield this.fetchNext(this.nextPageUrl||e,n?t?Object.assign(Object.assign({},t),{limit:n}):{limit:n}:t),a=i(r.data),o=this.createItems(a.items),s=a.total,l=!a.nextPageUrl;return this.nextPageUrl=a.nextPageUrl,{items:o,total:s,atEnd:l}}))),n)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){var e;this.subscriptions||(this.subscriptions=new ne,(null===(e=this.options)||void 0===e?void 0:e.lookup)||(this.subscriptions.add(this.pager.observeAdditions().pipe(Zt((e=>ui(e,!0)))).subscribe(Jr)),this.subscriptions.add(this.pager.observeAdditions().pipe(Zt((e=>di(e,!0,this.parent)))).subscribe(Jr))))}fetchNext(e,t){return qr(this,void 0,void 0,(function*(){return MusicKit.getInstance().api.music(e,t)}))}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){switch(e.type){case"playlists":case"library-playlists":return this.createMediaPlaylist(e);case"artists":case"library-artists":return this.createMediaArtist(e);case"albums":case"library-albums":return this.createMediaAlbum(e);case"songs":case"library-songs":case"music-videos":case"library-music-videos":return this.createMediaItem(e)}}createMediaPlaylist(e){var t,n;const r=this.createFromLibrary(e),i=(null===(t=r.description)||void 0===t?void 0:t.standard)||(null===(n=r.description)||void 0===n?void 0:n.short),a=`apple:${e.type}:${e.id}`,o=this.getCatalogId(e),s={src:a,itemType:Yn.Playlist,externalUrl:r.url||void 0,title:r.name,description:i?P(i):void 0,thumbnails:this.createThumbnails(r),owner:r.curatorName?{name:r.curatorName}:void 0,modifiedAt:Math.floor(new Date(r.lastModifiedDate).valueOf()/1e3)||void 0,unplayable:!r.playParams||void 0,isPinned:Wr.isPinned(a),inLibrary:or.get(a,e.type.startsWith("library-")||void 0),apple:{catalogId:o}};return s.rating=dr.get(s),s.pager=new Qr(`${e.href}/tracks`,void 0,void 0,s),s}createMediaArtist(e){var t,n;const r=this.createFromLibrary(e),i=(null===(t=r.editorialNotes)||void 0===t?void 0:t.standard)||(null===(n=r.editorialNotes)||void 0===n?void 0:n.short),a=this.getCatalogId(e);return{itemType:Yn.Artist,src:`apple:${e.type}:${e.id}`,externalUrl:r.url||void 0,title:r.name,description:i?P(i):void 0,thumbnails:this.createThumbnails(r),genres:this.getGenres(r),pager:this.createArtistAlbumsPager(e),apple:{catalogId:a}}}createArtistTopTracks(e){const t=this.createFromLibrary(e);return{itemType:Yn.Album,src:`apple:top-tracks:${e.id}`,title:"Top Tracks",thumbnails:this.createThumbnails(t),artist:t.name,genres:this.getGenres(t),pager:this.createTopTracksPager(e),synthetic:!0,inLibrary:!1,apple:{catalogId:""}}}createMediaAlbum(e){var t,n;const r=this.createFromLibrary(e),i=`apple:${e.type}:${e.id}`,a=(null===(t=r.editorialNotes)||void 0===t?void 0:t.standard)||(null===(n=r.editorialNotes)||void 0===n?void 0:n.short),o=this.getCatalogId(e),s={itemType:Yn.Album,src:i,externalUrl:r.url||void 0,title:r.name,description:a?P(a):void 0,thumbnails:this.createThumbnails(r),artist:r.artistName,trackCount:r.trackCount,genres:this.getGenres(r),year:new Date(r.releaseDate).getFullYear()||0,unplayable:!r.playParams||void 0,inLibrary:or.get(i,e.type.startsWith("library-")||void 0),apple:{catalogId:o}};return s.rating=dr.get(s),s.pager=new Qr(`${e.href}/tracks`,void 0,void 0,s),s}createMediaItem(e){var t,n,r,i,a;const o=this.createFromLibrary(e),{id:s,kind:l}=o.playParams||{id:e.id,kind:"music-videos"===e.type?"musicVideo":"song"},c=`apple:${e.type}:${s}`,u=(null===(t=o.editorialNotes)||void 0===t?void 0:t.standard)||(null===(n=o.editorialNotes)||void 0===n?void 0:n.short),d=e.type.startsWith("library-"),m=(null===(r=this.parent)||void 0===r?void 0:r.itemType)===Yn.Playlist,h=this.getCatalogId(e);let f=o.url||void 0;!f&&h&&(null===(i=this.parent)||void 0===i?void 0:i.itemType)===Yn.Album&&this.parent.externalUrl&&(f=`${this.parent.externalUrl}?i=${h}`);const p={itemType:Yn.Media,mediaType:"musicVideo"===l?Nr.Video:Nr.Audio,src:c,externalUrl:f,title:o.name,description:u?P(u):void 0,thumbnails:this.createThumbnails(o),artists:[o.artistName],albumArtist:(null===(a=this.parent)||void 0===a?void 0:a.itemType)===Yn.Album?this.parent.artist:void 0,album:o.albumName,duration:o.durationInMillis/1e3,genres:this.getGenres(o),disc:o.discNumber,track:o.trackNumber,year:new Date(o.releaseDate).getFullYear()||void 0,isrc:o.isrc,unplayable:!o.playParams||void 0,playedAt:0,inLibrary:or.get(c,d&&!m||void 0),apple:{catalogId:h}};return p.rating=dr.get(p),p}getCatalogId(e){var t,n,r;if(e.type.startsWith("library-")){let i=null===(n=null===(t=e.attributes)||void 0===t?void 0:t.playParams)||void 0===n?void 0:n["library-playlists"===e.type?"globalId":"catalogId"];return i||(i=null===(r=this.getCatalog(e))||void 0===r?void 0:r.id),i||""}return e.id}createFromLibrary(e){var t;return x(e.attributes,null===(t=this.getCatalog(e))||void 0===t?void 0:t.attributes)}getCatalog(e){var t,n,r;return null===(r=null===(n=null===(t=e.relationships)||void 0===t?void 0:t.catalog)||void 0===n?void 0:n.data)||void 0===r?void 0:r[0]}createThumbnails({artwork:e}){return e?[this.createThumbnail(e,120),this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480)]:void 0}createThumbnail(e,t){return{url:MusicKit.formatArtworkURL(e,t,t),width:t,height:t}}createArtistAlbumsPager(e){const t=new Qr(`${e.href}/albums`);if(e.type.startsWith("library-"))return t;const n=this.createArtistTopTracks(e),r=new Ur((()=>[n]));return r.fetchAt(0),new zr(r,t)}createTopTracksPager(e){return new Qr(e.href,{"limit[artists:top-songs]":"20",views:"top-songs"},{maxSize:20},void 0,(e=>{var t,n,r;const i=(null===(n=null===(t=e.data[0])||void 0===t?void 0:t.views)||void 0===n?void 0:n["top-songs"])||e,a=i.data||[],o=i.next;return{items:a,total:null===(r=i.meta)||void 0===r?void 0:r.total,nextPageUrl:o}}))}getGenres({genreNames:e=[]}){return e.filter((e=>"Music"!==e))}}var Xr=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::apple");const Gr={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},Zr={id:"apple/recommendations",title:"Recommended",icon:"playlist",itemType:Yn.Playlist,defaultHidden:!0,search:()=>new Qr("/v1/me/recommendations",void 0,void 0,void 0,(({data:e=[],next:t,meta:n})=>{const r=e.map((e=>e.relationships.contents.data.filter((e=>"playlists"===e.type)))).flat();return{items:r,total:null==n?void 0:n.total,nextPageUrl:t}}))},ei={id:"apple/recently-played",title:"Recently Played",icon:"clock",itemType:Yn.Media,layout:Gr,search:()=>new Qr("/v1/me/recent/played/tracks",void 0,{pageSize:30,maxSize:200})},ti={id:"apple/library-songs",title:"My Songs",icon:"tick",itemType:Yn.Media,viewType:Wn.Library,layout:Gr,defaultHidden:!0,search:()=>new Qr("/v1/me/library/songs")},ni={id:"apple/library-albums",title:"My Albums",icon:"tick",itemType:Yn.Album,viewType:Wn.Library,search:()=>new Qr("/v1/me/library/albums",{"fields[library-albums]":"name,artistName,playParams","include[library-albums]":"catalog"})},ri={id:"apple/library-artists",title:"My Artists",icon:"tick",itemType:Yn.Artist,viewType:Wn.Library,defaultHidden:!0,search:()=>new Qr("/v1/me/library/artists",{"fields[library-artists]":"name,playParams","include[library-artists]":"catalog","omit[resource:artists]":"relationships"})},ii={id:"apple/playlists",title:"Playlists",icon:"playlist",itemType:Yn.Playlist,viewType:Wn.Library,search:()=>new Qr("/v1/me/library/playlists",{"fields[library-playlists]":"name,playParams","include[library-playlists]":"catalog"})},ai={id:"apple/library-videos",title:"My Videos",icon:"tick",itemType:Yn.Media,viewType:Wn.Library,layout:Gr,defaultHidden:!0,search:()=>new Qr("/v1/me/library/music-videos")},oi={id:"apple",name:"Apple Music",icon:"apple",url:"https://music.apple.com",roots:[li(Yn.Media,{title:"Songs",layout:Gr}),li(Yn.Album,{title:"Albums"}),li(Yn.Artist,{title:"Artists"}),li(Yn.Playlist,{title:"Playlists"}),li(Yn.Media,{title:"Videos",layout:Gr},{types:"music-videos"},{maxSize:250})],sources:[ti,ni,ri,ai,ei,ii,Zr],labels:{[Bn.AddToLibrary]:"Add to Apple Music Library",[Bn.RemoveFromLibrary]:"Saved to Apple Music Library",[Bn.Like]:"Love on Apple Music",[Bn.Unlike]:"Unlove on Apple Music"},canRate:function(){return!1},canStore:function(e){switch(e.itemType){case Yn.Media:case Yn.Playlist:return!0;case Yn.Album:return!e.synthetic;default:return!1}},compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:Yn.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,t,n]=e.src.split(":"),r=t.startsWith("library-");return new Qr(`${r?"/v1/me/library":"/v1/catalog/{{storefrontId}}"}/playlists/${n}`,r?{"include[library-playlists]":"catalog","fields[library-playlists]":"name,playParams"}:{"omit[resource:playlists]":"relationships"})}}},getMetadata:function(e){var t;return Xr(this,void 0,void 0,(function*(){if(e.itemType===Yn.Playlist&&e.isOwn)return e;let n=e;if(!e.externalUrl){const[,r,i]=e.src.split(":"),a=r.startsWith("library-"),o=new Qr(`${a?"/v1/me/library":"/v1/catalog/{{storefrontId}}"}/${r.replace("library-","")}/${i}${a?"/catalog":""}`,a?void 0:{[`omit[resource:${r.replace("library-","")}]`]:"relationships"},{lookup:!0}),s=yield hr(o,{timeout:2e3});n=x(e,s[0]),n.description=(null===(t=s[0])||void 0===t?void 0:t.description)||e.description}return n.inLibrary=or.get(n.src,n.inLibrary),void 0===n.inLibrary&&di([n]),n.rating=dr.get(n,n.rating),void 0===n.rating&&ui([n]),n}))},lookup:function(e,t,n=10,r){return Xr(this,void 0,void 0,(function*(){return e&&t?hr(ci(Yn.Media,`${e} ${t}`,void 0,{pageSize:n,maxSize:n,lookup:!0}),{timeout:r}):[]}))},rate:function(e,t){return Xr(this,void 0,void 0,(function*(){const n=MusicKit.getInstance(),[,r,i]=e.src.split(":"),a=`/v1/me/ratings/${r}/${i}`;t?yield n.api.music(a,void 0,{fetchOptions:{method:"PUT",body:JSON.stringify({type:"rating",attributes:{value:t}})}}):yield n.api.music(a,void 0,{fetchOptions:{method:"DELETE"}})}))},store:function(e,t){var n;return Xr(this,void 0,void 0,(function*(){const r=MusicKit.getInstance(),[,i]=e.src.split(":"),a=i.replace("library-",""),o=null===(n=e.apple)||void 0===n?void 0:n.catalogId,s="/v1/me/library";if(t){const e=`ids[${a}]`;return r.api.music(s,{[e]:o},{fetchOptions:{method:"POST"}})}return r.api.music(`${s}/${a}/${o}`,void 0,{fetchOptions:{method:"DELETE"}})}))},observeIsLoggedIn:Ir,isLoggedIn:Ar,login:function(){return Cr(this,void 0,void 0,(function*(){if(!Ar())try{const e=yield Or(),t=yield e.authorize();Pr.log("Access token successfully obtained."),Tr.next(t)}catch(e){Pr.log("Could not obtain access token."),Pr.error(e)}}))},logout:function(){return Cr(this,void 0,void 0,(function*(){yield MusicKit.getInstance().unauthorize(),Tr.next("")}))}},si=oi;function li(e,t,n,r){return Object.assign(Object.assign({},t),{itemType:e,id:`apple/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>ci(e,t,n,r)})}function ci(e,t,n,r){if(t){const i=Object.assign(Object.assign({},n),{term:t});if(!i.types){switch(e){case Yn.Media:i.types="songs";break;case Yn.Album:i.types="albums";break;case Yn.Artist:i.types="artists";break;case Yn.Playlist:i.types="playlists"}i[`omit[resource:${i.types}]`]="relationships"}const a=i.types;return new Qr("/v1/catalog/{{storefrontId}}/search",i,Object.assign({maxSize:250,pageSize:25},r),void 0,(e=>{var t;const n=e.results[a]||{data:[]},r=n.next,i=null===(t=e.meta)||void 0===t?void 0:t.total;return{items:n.data,total:i,nextPageUrl:r}}))}return new fr}function ui(e,t=!1){return Xr(this,void 0,void 0,(function*(){const n=e[0];if(!n||!oi.canRate(n,t))return;const r=e.filter((e=>void 0===e.rating)).map((e=>{const[,,t]=e.src.split(":");return t}));if(0===r.length)return;const[,i]=n.src.split(":"),a=MusicKit.getInstance(),{data:{data:o}}=yield a.api.music(`/v1/me/ratings/${i}`,{ids:r});if(!o)return;const s=new Map(o.map((e=>[e.id,e.attributes.value])));rr.dispatch(r.map((e=>({match:t=>t.src===`apple:${i}:${e}`,values:{rating:s.get(e)||0}}))))}))}function di(e,t=!1,n){return Xr(this,void 0,void 0,(function*(){const r=e[0];if(!r||!oi.canStore(r,t))return;const i=(null==n?void 0:n.itemType)===Yn.Album,a=e.filter((e=>void 0===e.inLibrary&&!(i&&e.src.startsWith("apple:library-")))).map((e=>{var t;return null===(t=e.apple)||void 0===t?void 0:t.catalogId})).filter((e=>!!e));if(0===a.length)return;let[,o]=r.src.split(":");o=o.replace("library-","");const s=MusicKit.getInstance(),{data:{resources:l}}=yield s.api.music("/v1/catalog/{{storefrontId}}",{[`fields[${o}]`]:"inLibrary","format[resources]":"map",[`ids[${o}]`]:a,"omit[resource]":"autos"}),c=l[o];if(!c)return;const u=new Map(Object.keys(c).map((e=>[e,c[e].attributes.inLibrary])));rr.dispatch(a.map((e=>({match:t=>{var n;return(null===(n=t.apple)||void 0===n?void 0:n.catalogId)===e},values:{inLibrary:u.get(e)||!1}}))))}))}let mi=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>e+((t&=63)<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_")),"");const hi=new z("jellyfin"),fi={get host(){return hi.getString("host")},set host(e){hi.setString("host",e)},get device(){return"PC"},get deviceId(){let e=hi.getString("deviceId");return e||(e=mi(),hi.setString("deviceId",e)),e},get serverId(){return hi.getString("serverId")},set serverId(e){hi.setString("serverId",e)},get token(){return hi.getString("token")},set token(e){hi.setString("token",e)},get userId(){return hi.getString("userId")},set userId(e){hi.setString("userId",e)},clear(){hi.removeItem("serverId"),hi.removeItem("userId"),hi.removeItem("token")}};var pi=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};function vi(e,t){return pi(this,void 0,void 0,(function*(){const{device:n,deviceId:r,token:i}=fi;if(!i)throw Error("No access token.");return e.startsWith("/")&&(e=e.slice(1)),t.headers=Object.assign(Object.assign({},t.headers),{"X-Emby-Authorization":`MediaBrowser Client="ampcast", Version="0.8.12", Device="${n}", DeviceId="${r}", Token="${i}"`}),window.fetch(`${fi.host}/${e}`,t)}))}console.log("module::jellyfinApi");const bi={delete:function(e,t={}){return pi(this,void 0,void 0,(function*(){return vi(`${e}?${new URLSearchParams(t)}`,{method:"DELETE"})}))},get:function(e,t={}){return pi(this,void 0,void 0,(function*(){return vi(`${e}?${new URLSearchParams(t)}`,{method:"GET"})}))},post:function(e,t={}){return pi(this,void 0,void 0,(function*(){const n=JSON.stringify(t);return vi(e,{method:"POST",headers:{"Content-Type":"application/json"},body:n})}))},getPlayableUrlFromSrc:function(e){const{host:t,userId:n,token:r,deviceId:i}=fi;if(t&&n&&r&&i){const[,,a]=e.split(":");return`${t}/Audio/${a}/universal?${new URLSearchParams({MaxStreamingBitrate:"140000000",MaxSampleRate:"48000",TranscodingProtocol:"hls",TranscodingContainer:"ts",Container:"opus,webm|opus,mp3,aac,m4a|aac,m4a|alac,m4b|aac,flac,webma,webm|webma,wav,ogg",AudioCodec:"aac",static:"true",UserId:n,api_key:r,DeviceId:i})}`}throw Error("Not logged in.")}},gi=bi;function yi({name:e,className:t=""}){switch(t=`icon icon-${e} ${t}`,e){case"ampcast":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("circle",{cx:"12",cy:"12",r:"8",strokeWidth:"4",stroke:"orange",fill:"black"}),r.createElement("circle",{cx:"12",cy:"12",r:"2",stroke:"none",fill:"white"}));case"play":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"}));case"pause":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M144 479H48c-26.5 0-48-21.5-48-48V79c0-26.5 21.5-48 48-48h96c26.5 0 48 21.5 48 48v352c0 26.5-21.5 48-48 48zm304-48V79c0-26.5-21.5-48-48-48h-96c-26.5 0-48 21.5-48 48v352c0 26.5 21.5 48 48 48h96c26.5 0 48-21.5 48-48z"}));case"stop":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"}));case"volume":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{className:"high medium",stroke:"none",d:"M11.536 14.01A8.473 8.473 0 0 0 14.026 8a8.473 8.473 0 0 0-2.49-6.01l-.708.707A7.476 7.476 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303l.708.707z"}),r.createElement("path",{className:"medium",stroke:"none",d:"M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.483 5.483 0 0 1 11.025 8a5.483 5.483 0 0 1-1.61 3.89l.706.706z"}),r.createElement("path",{stroke:"none",d:"M8.707 11.182A4.486 4.486 0 0 0 10.025 8a4.486 4.486 0 0 0-1.318-3.182L8 5.525A3.489 3.489 0 0 1 9.025 8 3.49 3.49 0 0 1 8 10.475l.707.707zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06z"}));case"muted":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06zm7.137 2.096a.5.5 0 0 1 0 .708L12.207 8l1.647 1.646a.5.5 0 0 1-.708.708L11.5 8.707l-1.646 1.647a.5.5 0 0 1-.708-.708L10.793 8 9.146 6.354a.5.5 0 1 1 .708-.708L11.5 7.293l1.646-1.647a.5.5 0 0 1 .708 0z"}));case"prev":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M64 468V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12v176.4l195.5-181C352.1 22.3 384 36.6 384 64v384c0 27.4-31.9 41.7-52.5 24.6L136 292.7V468c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12z"}));case"next":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M384 44v424c0 6.6-5.4 12-12 12h-48c-6.6 0-12-5.4-12-12V291.6l-195.5 181C95.9 489.7 64 475.4 64 448V64c0-27.4 31.9-41.7 52.5-24.6L312 219.3V44c0-6.6 5.4-12 12-12h48c6.6 0 12 5.4 12 12z"}));case"info":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"}));case"menu":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"}));case"settings":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M487.4 315.7l-42.6-24.6c4.3-23.2 4.3-47 0-70.2l42.6-24.6c4.9-2.8 7.1-8.6 5.5-14-11.1-35.6-30-67.8-54.7-94.6-3.8-4.1-10-5.1-14.8-2.3L380.8 110c-17.9-15.4-38.5-27.3-60.8-35.1V25.8c0-5.6-3.9-10.5-9.4-11.7-36.7-8.2-74.3-7.8-109.2 0-5.5 1.2-9.4 6.1-9.4 11.7V75c-22.2 7.9-42.8 19.8-60.8 35.1L88.7 85.5c-4.9-2.8-11-1.9-14.8 2.3-24.7 26.7-43.6 58.9-54.7 94.6-1.7 5.4.6 11.2 5.5 14L67.3 221c-4.3 23.2-4.3 47 0 70.2l-42.6 24.6c-4.9 2.8-7.1 8.6-5.5 14 11.1 35.6 30 67.8 54.7 94.6 3.8 4.1 10 5.1 14.8 2.3l42.6-24.6c17.9 15.4 38.5 27.3 60.8 35.1v49.2c0 5.6 3.9 10.5 9.4 11.7 36.7 8.2 74.3 7.8 109.2 0 5.5-1.2 9.4-6.1 9.4-11.7v-49.2c22.2-7.9 42.8-19.8 60.8-35.1l42.6 24.6c4.9 2.8 11 1.9 14.8-2.3 24.7-26.7 43.6-58.9 54.7-94.6 1.5-5.5-.7-11.3-5.6-14.1zM256 336c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}));case"album":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("circle",{cx:"12",cy:"12",r:"8.5",strokeWidth:"6.5",fill:"none"}),r.createElement("circle",{cx:"12",cy:"12",r:"2",stroke:"none"}));case"locked":return r.createElement("svg",{className:t,viewBox:"0 0 448 512",transform:"scale(0.95)"},r.createElement("path",{d:"M400 224h-24v-72C376 68.2 307.8 0 224 0S72 68.2 72 152v72H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48zm-104 0H152v-72c0-39.7 32.3-72 72-72s72 32.3 72 72v72z"}));case"unlocked":return r.createElement("svg",{className:t,viewBox:"0 0 576 512",transform:"scale(0.95)"},r.createElement("path",{d:"M423.5 0C339.5.3 272 69.5 272 153.5V224H48c-26.5 0-48 21.5-48 48v192c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V272c0-26.5-21.5-48-48-48h-48v-71.1c0-39.6 31.7-72.5 71.3-72.9 40-.4 72.7 32.1 72.7 72v80c0 13.3 10.7 24 24 24h32c13.3 0 24-10.7 24-24v-80C576 68 507.5-.3 423.5 0z"}));case"left":return r.createElement("svg",{className:t,viewBox:"0 0 320 512"},r.createElement("path",{d:"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z"}));case"right":return r.createElement("svg",{className:t,viewBox:"0 0 320 512"},r.createElement("path",{d:"M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z"}));case"saved":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z"}));case"unsaved":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{d:"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM272 80v80H144V80h128zm122 352H54a6 6 0 0 1-6-6V86a6 6 0 0 1 6-6h42v104c0 13.255 10.745 24 24 24h176c13.255 0 24-10.745 24-24V83.882l78.243 78.243a6 6 0 0 1 1.757 4.243V426a6 6 0 0 1-6 6zM224 232c-48.523 0-88 39.477-88 88s39.477 88 88 88 88-39.477 88-88-39.477-88-88-88zm0 128c-22.056 0-40-17.944-40-40s17.944-40 40-40 40 17.944 40 40-17.944 40-40 40z"}));case"close":return r.createElement("svg",{className:t,viewBox:"0 0 64 64"},r.createElement("path",{d:"M 10.5,-0.5 C 12.1667,-0.5 13.8333,-0.5 15.5,-0.5C 20.7971,5.29805 26.2971,10.9647 32,16.5C 37.0314,10.303 42.5314,4.63636 48.5,-0.5C 49.8333,-0.5 51.1667,-0.5 52.5,-0.5C 55.8333,3.5 59.5,7.16667 63.5,10.5C 63.5,11.8333 63.5,13.1667 63.5,14.5C 57.7019,19.7971 52.0353,25.2971 46.5,31C 52.0353,36.7029 57.7019,42.2029 63.5,47.5C 63.5,49.1667 63.5,50.8333 63.5,52.5C 59.5,55.8333 55.8333,59.5 52.5,63.5C 50.8333,63.5 49.1667,63.5 47.5,63.5C 42.1604,57.8275 36.8271,52.1608 31.5,46.5C 25.479,51.8543 19.8123,57.521 14.5,63.5C 13.1667,63.5 11.8333,63.5 10.5,63.5C 7.16667,59.5 3.5,55.8333 -0.5,52.5C -0.5,50.8333 -0.5,49.1667 -0.5,47.5C 5.17254,42.1604 10.8392,36.8271 16.5,31.5C 10.8392,26.1729 5.17254,20.8396 -0.5,15.5C -0.5,13.8333 -0.5,12.1667 -0.5,10.5C 3.5,7.16667 7.16667,3.5 10.5,-0.5 Z"}));case"audio":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("path",{stroke:"none",d:"M12 3v10.55c-.59-.34-1.27-.55-2-.55-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4V7h4V3h-6z"}));case"video":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{strokeWidth:.5,d:"M0 5a2 2 0 0 1 2-2h7.5a2 2 0 0 1 1.983 1.738l3.11-1.382A1 1 0 0 1 16 4.269v7.462a1 1 0 0 1-1.406.913l-3.111-1.382A2 2 0 0 1 9.5 13H2a2 2 0 0 1-2-2V5zm11.5 5.175 3.5 1.556V4.269l-3.5 1.556v4.35zM2 4a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h7.5a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H2z"}));case"star":return r.createElement("svg",{className:t,viewBox:"0 0 576 512"},r.createElement("path",{className:"icon-star-outer",d:"M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z"}),r.createElement("path",{className:"icon-star-inner",d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}));case"star-fill":return r.createElement("svg",{className:t,viewBox:"0 0 576 512"},r.createElement("path",{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"}));case"heart":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M458.4 64.3C400.6 15.7 311.3 23 256 79.3 200.7 23 111.4 15.6 53.6 64.3-21.6 127.6-10.6 230.8 43 285.5l175.4 178.7c10 10.2 23.4 15.9 37.6 15.9 14.3 0 27.6-5.6 37.6-15.8L469 285.6c53.5-54.7 64.7-157.9-10.6-221.3zm-23.6 187.5L259.4 430.5c-2.4 2.4-4.4 2.4-6.8 0L77.2 251.8c-36.5-37.2-43.9-107.6 7.3-150.7 38.9-32.7 98.9-27.8 136.5 10.5l35 35.7 35-35.7c37.8-38.5 97.8-43.2 136.5-10.6 51.1 43.1 43.5 113.9 7.3 150.8z"}));case"heart-fill":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M47.6 300.4L228.3 469.1c7.5 7 17.4 10.9 27.7 10.9s20.2-3.9 27.7-10.9L464.4 300.4c30.4-28.3 47.6-68 47.6-109.5v-5.8c0-69.9-50.5-129.5-119.4-141C347 36.5 300.6 51.4 268 84L256 96 244 84c-32.6-32.6-79-47.5-124.6-39.9C50.5 55.6 0 115.2 0 185.1v5.8c0 41.5 17.2 81.2 47.6 109.5z"}));case"thumbs-up":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M466.27 286.69C475.04 271.84 480 256 480 236.85c0-44.015-37.218-85.58-85.82-85.58H357.7c4.92-12.81 8.85-28.13 8.85-46.54C366.55 31.936 328.86 0 271.28 0c-61.607 0-58.093 94.933-71.76 108.6-22.747 22.747-49.615 66.447-68.76 83.4H32c-17.673 0-32 14.327-32 32v240c0 17.673 14.327 32 32 32h64c14.893 0 27.408-10.174 30.978-23.95 44.509 1.001 75.06 39.94 177.802 39.94 7.22 0 15.22.01 22.22.01 77.117 0 111.986-39.423 112.94-95.33 13.319-18.425 20.299-43.122 17.34-66.99 9.854-18.452 13.664-40.343 8.99-62.99zm-61.75 53.83c12.56 21.13 1.26 49.41-13.94 57.57 7.7 48.78-17.608 65.9-53.12 65.9h-37.82c-71.639 0-118.029-37.82-171.64-37.82V240h10.92c28.36 0 67.98-70.89 94.54-97.46 28.36-28.36 18.91-75.63 37.82-94.54 47.27 0 47.27 32.98 47.27 56.73 0 39.17-28.36 56.72-28.36 94.54h103.99c21.11 0 37.73 18.91 37.82 37.82.09 18.9-12.82 37.81-22.27 37.81 13.489 14.555 16.371 45.236-5.21 65.62zM88 432c0 13.255-10.745 24-24 24s-24-10.745-24-24 10.745-24 24-24 24 10.745 24 24z"}));case"tick":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),r.createElement("path",{stroke:"none",d:"M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.235.235 0 0 1 .02-.022z"}));case"plus":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"}),r.createElement("path",{stroke:"none",d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}));case"tick-fill":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm10.03 4.97a.75.75 0 0 1 .011 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.75.75 0 0 1 1.08-.022z"}));case"artist":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"}));case"folder":return r.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.25)"},r.createElement("path",{stroke:"none",d:"m9.17 6 2 2H20v10H4V6h5.17M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"}));case"folder-up":return r.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.25)"},r.createElement("path",{stroke:"none",d:"M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V6h5.17l2 2H20v10zM9.41 14.42 11 12.84V17h2v-4.16l1.59 1.59L16 13.01 12.01 9 8 13.01l1.41 1.41z"}));case"file-audio":return r.createElement("svg",{className:t,strokeWidth:"0",viewBox:"0 0 16 16"},r.createElement("path",{d:"M14.341 3.579c-0.347-0.473-0.831-1.027-1.362-1.558s-1.085-1.015-1.558-1.362c-0.806-0.591-1.197-0.659-1.421-0.659h-7.75c-0.689 0-1.25 0.561-1.25 1.25v13.5c0 0.689 0.561 1.25 1.25 1.25h11.5c0.689 0 1.25-0.561 1.25-1.25v-9.75c0-0.224-0.068-0.615-0.659-1.421v0zM12.271 2.729c0.48 0.48 0.856 0.912 1.134 1.271h-2.406v-2.405c0.359 0.278 0.792 0.654 1.271 1.134v0zM14 14.75c0 0.136-0.114 0.25-0.25 0.25h-11.5c-0.135 0-0.25-0.114-0.25-0.25v-13.5c0-0.135 0.115-0.25 0.25-0.25 0 0 7.749-0 7.75 0v3.5c0 0.276 0.224 0.5 0.5 0.5h3.5v9.75z"}),r.createElement("path",{d:"M11.817 6.113c-0.116-0.095-0.268-0.133-0.415-0.104l-5 1c-0.234 0.047-0.402 0.252-0.402 0.49v3.701c-0.294-0.128-0.636-0.201-1-0.201-1.105 0-2 0.672-2 1.5s0.895 1.5 2 1.5 2-0.672 2-1.5v-3.59l4-0.8v2.091c-0.294-0.128-0.636-0.201-1-0.201-1.105 0-2 0.672-2 1.5s0.895 1.5 2 1.5 2-0.672 2-1.5v-5c0-0.15-0.067-0.292-0.183-0.387z"}));case"file-video":return r.createElement("svg",{className:t,viewBox:"0 0 16 16",strokeWidth:"0"},r.createElement("path",{d:"M14.341 3.579c-0.347-0.473-0.831-1.027-1.362-1.558s-1.085-1.015-1.558-1.362c-0.806-0.591-1.197-0.659-1.421-0.659h-7.75c-0.689 0-1.25 0.561-1.25 1.25v13.5c0 0.689 0.561 1.25 1.25 1.25h11.5c0.689 0 1.25-0.561 1.25-1.25v-9.75c0-0.224-0.068-0.615-0.659-1.421v0 0zM12.271 2.729c0.48 0.48 0.856 0.912 1.134 1.271h-2.406v-2.405c0.359 0.278 0.792 0.654 1.271 1.134v0 0zM14 14.75c0 0.136-0.114 0.25-0.25 0.25h-11.5c-0.135 0-0.25-0.114-0.25-0.25v-13.5c0-0.135 0.115-0.25 0.25-0.25 0 0 7.749-0 7.75 0v3.5c0 0.276 0.224 0.5 0.5 0.5h3.5v9.75z"}),r.createElement("path",{d:"M4 8h5v5h-5v-5z"}),r.createElement("path",{d:"M9 10l3-2v5l-3-2z"}));case"most-played":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M2 3a.5.5 0 0 0 .5.5h11a.5.5 0 0 0 0-1h-11A.5.5 0 0 0 2 3zm2-2a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 0-1h-7A.5.5 0 0 0 4 1zm2.765 5.576A.5.5 0 0 0 6 7v5a.5.5 0 0 0 .765.424l4-2.5a.5.5 0 0 0 0-.848l-4-2.5z"}),r.createElement("path",{stroke:"none",d:"M1.5 14.5A1.5 1.5 0 0 1 0 13V6a1.5 1.5 0 0 1 1.5-1.5h13A1.5 1.5 0 0 1 16 6v7a1.5 1.5 0 0 1-1.5 1.5h-13zm13-1a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-.5-.5h-13A.5.5 0 0 0 1 6v7a.5.5 0 0 0 .5.5h13z"}));case"clock":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5 0-200-89.5-200-200S145.5 56 256 56s200 89.5 200 200-89.5 200-200 200zm61.8-104.4l-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6 0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"}));case"globe":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855-.143.268-.276.56-.395.872.705.157 1.472.257 2.282.287V1.077zM4.249 3.539c.142-.384.304-.744.481-1.078a6.7 6.7 0 0 1 .597-.933A7.01 7.01 0 0 0 3.051 3.05c.362.184.763.349 1.198.49zM3.509 7.5c.036-1.07.188-2.087.436-3.008a9.124 9.124 0 0 1-1.565-.667A6.964 6.964 0 0 0 1.018 7.5h2.49zm1.4-2.741a12.344 12.344 0 0 0-.4 2.741H7.5V5.091c-.91-.03-1.783-.145-2.591-.332zM8.5 5.09V7.5h2.99a12.342 12.342 0 0 0-.399-2.741c-.808.187-1.681.301-2.591.332zM4.51 8.5c.035.987.176 1.914.399 2.741A13.612 13.612 0 0 1 7.5 10.91V8.5H4.51zm3.99 0v2.409c.91.03 1.783.145 2.591.332.223-.827.364-1.754.4-2.741H8.5zm-3.282 3.696c.12.312.252.604.395.872.552 1.035 1.218 1.65 1.887 1.855V11.91c-.81.03-1.577.13-2.282.287zm.11 2.276a6.696 6.696 0 0 1-.598-.933 8.853 8.853 0 0 1-.481-1.079 8.38 8.38 0 0 0-1.198.49 7.01 7.01 0 0 0 2.276 1.522zm-1.383-2.964A13.36 13.36 0 0 1 3.508 8.5h-2.49a6.963 6.963 0 0 0 1.362 3.675c.47-.258.995-.482 1.565-.667zm6.728 2.964a7.009 7.009 0 0 0 2.275-1.521 8.376 8.376 0 0 0-1.197-.49 8.853 8.853 0 0 1-.481 1.078 6.688 6.688 0 0 1-.597.933zM8.5 11.909v3.014c.67-.204 1.335-.82 1.887-1.855.143-.268.276-.56.395-.872A12.63 12.63 0 0 0 8.5 11.91zm3.555-.401c.57.185 1.095.409 1.565.667A6.963 6.963 0 0 0 14.982 8.5h-2.49a13.36 13.36 0 0 1-.437 3.008zM14.982 7.5a6.963 6.963 0 0 0-1.362-3.675c-.47.258-.995.482-1.565.667.248.92.4 1.938.437 3.008h2.49zM11.27 2.461c.177.334.339.694.482 1.078a8.368 8.368 0 0 0 1.196-.49 7.01 7.01 0 0 0-2.275-1.52c.218.283.418.597.597.932zm-.488 1.343a7.765 7.765 0 0 0-.395-.872C9.835 1.897 9.17 1.282 8.5 1.077V4.09c.81-.03 1.577-.13 2.282-.287z"}));case"visualizer":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M4 11H2v3h2v-3zm5-4H7v7h2V7zm5-5v12h-2V2h2zm-2-1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h2a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1h-2zM6 7a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v7a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V7zm-5 4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3z"}));case"palette":return r.createElement("svg",{className:t,viewBox:"0 0 16 16"},r.createElement("path",{stroke:"none",d:"M8 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zm4 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3zM5.5 7a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm.5 6a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z"}),r.createElement("path",{stroke:"none",d:"M16 8c0 3.15-1.866 2.585-3.567 2.07C11.42 9.763 10.465 9.473 10 10c-.603.683-.475 1.819-.351 2.92C9.826 14.495 9.996 16 8 16a8 8 0 1 1 8-8zm-8 7c.611 0 .654-.171.655-.176.078-.146.124-.464.07-1.119-.014-.168-.037-.37-.061-.591-.052-.464-.112-1.005-.118-1.462-.01-.707.083-1.61.704-2.314.369-.417.845-.578 1.272-.618.404-.038.812.026 1.16.104.343.077.702.186 1.025.284l.028.008c.346.105.658.199.953.266.653.148.904.083.991.024C14.717 9.38 15 9.161 15 8a7 7 0 1 0-7 7z"}));case"pin":return r.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.125)"},r.createElement("path",{stroke:"none",d:"M14 4v5c0 1.12.37 2.16 1 3H9c.65-.86 1-1.9 1-3V4h4m3-2H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3V4h1c.55 0 1-.45 1-1s-.45-1-1-1z"}));case"pin-fill":return r.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.125)"},r.createElement("path",{stroke:"none",fillRule:"evenodd",d:"M16 9V4h1c.55 0 1-.45 1-1s-.45-1-1-1H7c-.55 0-1 .45-1 1s.45 1 1 1h1v5c0 1.66-1.34 3-3 3v2h5.97v7l1 1 1-1v-7H19v-2c-1.66 0-3-1.34-3-3z"}));case"link":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{stroke:"none",d:"M320 0c-17.7 0-32 14.3-32 32s14.3 32 32 32h82.7L201.4 265.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L448 109.3V192c0 17.7 14.3 32 32 32s32-14.3 32-32V32c0-17.7-14.3-32-32-32H320zM80 32C35.8 32 0 67.8 0 112V432c0 44.2 35.8 80 80 80H400c44.2 0 80-35.8 80-80V320c0-17.7-14.3-32-32-32s-32 14.3-32 32V432c0 8.8-7.2 16-16 16H80c-8.8 0-16-7.2-16-16V112c0-8.8 7.2-16 16-16H192c17.7 0 32-14.3 32-32s-14.3-32-32-32H80z"}));case"search":return r.createElement("svg",{className:t,viewBox:"0 0 16 16",transform:"scale(0.875)"},r.createElement("path",{stroke:"none",d:"M15.504 13.616l-3.79-3.223c-0.392-0.353-0.811-0.514-1.149-0.499 0.895-1.048 1.435-2.407 1.435-3.893 0-3.314-2.686-6-6-6s-6 2.686-6 6 2.686 6 6 6c1.486 0 2.845-0.54 3.893-1.435-0.016 0.338 0.146 0.757 0.499 1.149l3.223 3.79c0.552 0.613 1.453 0.665 2.003 0.115s0.498-1.452-0.115-2.003zM6 10c-2.209 0-4-1.791-4-4s1.791-4 4-4 4 1.791 4 4-1.791 4-4 4z"}));case"swap":return r.createElement("svg",{className:t,viewBox:"0 0 448 512"},r.createElement("path",{stroke:"none",d:"M438.6 150.6c12.5-12.5 12.5-32.8 0-45.3l-96-96c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.7 96 32 96C14.3 96 0 110.3 0 128s14.3 32 32 32l306.7 0-41.4 41.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l96-96zm-333.3 352c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 416 416 416c17.7 0 32-14.3 32-32s-14.3-32-32-32l-306.7 0 41.4-41.4c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3l96 96z"}));case"playlist-add":return r.createElement("svg",{className:t,viewBox:"0 0 24 24"},r.createElement("path",{stroke:"none",d:"M14 10H3v2h11v-2zm0-4H3v2h11V6zm4 8v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zM3 16h7v-2H3v2z"}));case"recently-added":return r.createElement("svg",{className:t,viewBox:"0 0 384 512"},r.createElement("path",{d:"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48z"}),r.createElement("rect",{x:"177",y:"220",width:"40",height:"210",strokeWidth:"20",strokeLinejoin:"round"}),r.createElement("rect",{x:"87",y:"310",width:"210",height:"40",strokeWidth:"20",strokeLinejoin:"round"}));case"playlist":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("path",{d:"M88 48C101.3 48 112 58.75 112 72V120C112 133.3 101.3 144 88 144H40C26.75 144 16 133.3 16 120V72C16 58.75 26.75 48 40 48H88zM480 64C497.7 64 512 78.33 512 96C512 113.7 497.7 128 480 128H192C174.3 128 160 113.7 160 96C160 78.33 174.3 64 192 64H480zM480 224C497.7 224 512 238.3 512 256C512 273.7 497.7 288 480 288H192C174.3 288 160 273.7 160 256C160 238.3 174.3 224 192 224H480zM480 384C497.7 384 512 398.3 512 416C512 433.7 497.7 448 480 448H192C174.3 448 160 433.7 160 416C160 398.3 174.3 384 192 384H480zM16 232C16 218.7 26.75 208 40 208H88C101.3 208 112 218.7 112 232V280C112 293.3 101.3 304 88 304H40C26.75 304 16 293.3 16 280V232zM88 368C101.3 368 112 378.7 112 392V440C112 453.3 101.3 464 88 464H40C26.75 464 16 453.3 16 440V392C16 378.7 26.75 368 40 368H88z"}));case"file":case"blob":return r.createElement("svg",{className:t,viewBox:"0 0 448 512",transform:"scale(0.875)"},r.createElement("path",{fill:"#00cccc",d:"M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"}));case"apple":return r.createElement("svg",{className:t,viewBox:"0 0 24 24",transform:"scale(1.1) translate(0,-1)"},r.createElement("path",{fillRule:"nonzero",d:"M11.624 7.222c-.876 0-2.232-.996-3.66-.96-1.884.024-3.612 1.092-4.584 2.784-1.956 3.396-.504 8.412 1.404 11.172.936 1.344 2.04 2.856 3.504 2.808 1.404-.06 1.932-.912 3.636-.912 1.692 0 2.172.912 3.66.876 1.512-.024 2.472-1.368 3.396-2.724 1.068-1.56 1.512-3.072 1.536-3.156-.036-.012-2.94-1.128-2.976-4.488-.024-2.808 2.292-4.152 2.4-4.212-1.32-1.932-3.348-2.148-4.056-2.196-1.848-.144-3.396 1.008-4.26 1.008zm3.12-2.832c.78-.936 1.296-2.244 1.152-3.54-1.116.048-2.46.744-3.264 1.68-.72.828-1.344 2.16-1.176 3.432 1.236.096 2.508-.636 3.288-1.572z"}));case"plex":return r.createElement("svg",{className:t,viewBox:"0 0 122.88 122.88"},r.createElement("path",{className:"icon-plex-outer",d:"M18.43,0h86.02c10.18,0,18.43,8.25,18.43,18.43v86.02c0,10.18-8.25,18.43-18.43,18.43H18.43 C8.25,122.88,0,114.63,0,104.45l0-86.02C0,8.25,8.25,0,18.43,0L18.43,0z"}),r.createElement("polygon",{className:"icon-plex-inner",points:"61.44,16.8 35.52,16.8 61.44,61.44 35.52,106.08 61.44,106.08 87.36,61.44 61.44,16.8"}));case"jellyfin":return r.createElement("svg",{className:t,viewBox:"0 0 512 512"},r.createElement("defs",null,r.createElement("linearGradient",{id:"jellyfin-linear-gradient",gradientUnits:"userSpaceOnUse",x1:"110.25",y1:"213.3",x2:"496.14",y2:"436.09"},r.createElement("stop",{offset:"0",style:{stopColor:"#aa5cc3"}}),r.createElement("stop",{offset:"1",style:{stopColor:"#00a4dc"}}))),r.createElement("path",{d:"M256,201.6c-20.4,0-86.2,119.3-76.2,139.4s142.5,19.9,152.4,0S276.5,201.6,256,201.6z"}),r.createElement("path",{d:"M256,23.3c-61.6,0-259.8,359.4-229.6,420.1s429.3,60,459.2,0S317.6,23.3,256,23.3z M406.5,390.8c-19.6,39.3-281.1,39.8-300.9,0s110.1-275.3,150.4-275.3S426.1,351.4,406.5,390.8z"}));case"spotify":return r.createElement("svg",{className:t,viewBox:"0 0 168 168"},r.createElement("path",{stroke:"none",d:"m83.996 0.277c-46.249 0-83.743 37.493-83.743 83.742 0 46.251 37.494 83.741 83.743 83.741 46.254 0 83.744-37.49 83.744-83.741 0-46.246-37.49-83.738-83.745-83.738l0.001-0.004zm38.404 120.78c-1.5 2.46-4.72 3.24-7.18 1.73-19.662-12.01-44.414-14.73-73.564-8.07-2.809 0.64-5.609-1.12-6.249-3.93-0.643-2.81 1.11-5.61 3.926-6.25 31.9-7.291 59.263-4.15 81.337 9.34 2.46 1.51 3.24 4.72 1.73 7.18zm10.25-22.805c-1.89 3.075-5.91 4.045-8.98 2.155-22.51-13.839-56.823-17.846-83.448-9.764-3.453 1.043-7.1-0.903-8.148-4.35-1.04-3.453 0.907-7.093 4.354-8.143 30.413-9.228 68.222-4.758 94.072 11.127 3.07 1.89 4.04 5.91 2.15 8.976v-0.001zm0.88-23.744c-26.99-16.031-71.52-17.505-97.289-9.684-4.138 1.255-8.514-1.081-9.768-5.219-1.254-4.14 1.08-8.513 5.221-9.771 29.581-8.98 78.756-7.245 109.83 11.202 3.73 2.209 4.95 7.016 2.74 10.733-2.2 3.722-7.02 4.949-10.73 2.739z"}));case"lastfm":return r.createElement("svg",{className:t,viewBox:"0 0 455 455"},r.createElement("rect",{className:"icon-lastfm-inner",x:"5",y:"5",width:"445",height:"445"}),r.createElement("path",{className:"icon-lastfm-outer",fillRule:"evenodd",clipRule:"evenodd",d:"M0,0v455h455V0H0z M309.94,315.01c-62.425,0-84.085-28.145-95.625-63.145 L202.77,215.77c-8.65-26.33-18.75-46.915-50.505-46.915c-22.035,0-44.395,15.88-44.395,60.275c0,34.63,17.695,56.29,42.575,56.29 c28.145,0,46.915-20.94,46.915-20.94l11.565,31.385c0,0-19.495,19.125-60.275,19.125c-50.51,0-78.65-29.57-78.65-84.435 c0-56.99,28.14-90.565,81.19-90.565c47.99,0,72.165,17.325,87.305,64.235L250.41,240.3c8.65,26.35,23.805,45.47,60.25,45.47 c24.555,0,37.52-5.41,37.52-18.77c0-10.45-6.13-18.025-24.53-22.365l-24.53-5.76c-29.94-7.225-41.855-22.735-41.855-47.265 c0-39.335,31.755-51.6,64.215-51.6c36.82,0,59.18,13.34,62.07,45.82l-36.07,4.335c-1.445-15.53-10.82-22.015-28.145-22.015 c-15.88,0-25.625,7.21-25.625,19.475c0,10.84,4.685,17.325,20.565,20.94l23.085,5.055c31.035,7.21,47.64,22.365,47.64,51.585 C385,301.295,354.685,315.01,309.94,315.01z"}));case"listenbrainz":case"musicbrainz":return r.createElement("svg",{className:t,viewBox:"0 0 27 30"},r.createElement("polygon",{className:`icon-${e}-left`,stroke:"none",points:"13 1 1 8 1 22 13 29 13 1"}),r.createElement("polygon",{className:`icon-${e}-right`,stroke:"none",points:"14 1 26 8 26 22 14 29 14 1"}));case"youtube":return r.createElement("svg",{className:t,viewBox:"0 0 576 512",transform:"scale(1.125)"},r.createElement("rect",{className:"icon-youtube-inner",x:"144",y:"128",width:"288",height:"256"}),r.createElement("path",{className:"icon-youtube-outer",d:"M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"}));case"lookup-pending":return r.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 16 16"},r.createElement("title",null,"Lookup scheduled"),r.createElement("circle",{className:"icon-lookup-outer",cx:"8",cy:"8",r:"8",stroke:"none"}),r.createElement("path",{className:"icon-lookup-inner",d:"M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"}));case"lookup-looking":return r.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 100 100"},r.createElement("title",null,"Searching..."),r.createElement("circle",{className:"icon-lookup-outer",cx:"50",cy:"50",r:"50",stroke:"none"}),r.createElement("path",{className:"icon-lookup-inner",d:"M73,50c0-12.7-10.3-23-23-23S27,37.3,27,50 M30.9,50c0-10.5,8.5-19.1,19.1-19.1S69.1,39.5,69.1,50"},r.createElement("animateTransform",{attributeName:"transform",attributeType:"XML",type:"rotate",dur:"1s",from:"0 50 50",to:"360 50 50",repeatCount:"indefinite"})));case"lookup-not-found":return r.createElement("svg",{className:`${t} icon-lookup`,viewBox:"0 0 16 16",transform:"rotate(45)"},r.createElement("title",null,"Not found"),r.createElement("circle",{className:"icon-lookup-outer",cx:"8",cy:"8",r:"8",stroke:"none"}),r.createElement("path",{className:"icon-lookup-inner",d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}))}}var wi=n(908);const Ei={left:0,top:0},xi=(0,r.forwardRef)((function(e,t){var{title:n,className:i="",children:a,onClose:o}=e,s=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["title","className","children","onClose"]);const l=(0,r.useRef)(null),[c,u]=(0,r.useState)(Ei),[d,m]=(0,r.useState)(null),[h,f]=(0,r.useState)(Ei);(0,r.useImperativeHandle)(t,(()=>({close:e=>{l.current.open&&l.current.close(e)}}))),(0,r.useEffect)((()=>{const e=l.current;wi.Z.registerDialog(e),e.showModal()}),[]);const p=(0,r.useCallback)((()=>{l.current.close()}),[]),v=(0,r.useCallback)((()=>{o(l.current.returnValue)}),[o]),b=(0,r.useCallback)((e=>{let t=e.target;for(;t&&"BUTTON"!==t.nodeName;)t=t.parentElement;"#cancel"===(null==t?void 0:t.value)&&(e.preventDefault(),l.current.close())}),[]),g=(0,r.useCallback)((e=>{e.preventDefault(),0===e.button&&m({left:e.screenX,top:e.screenY})}),[]),w=(0,r.useCallback)((e=>{f({left:e.screenX-d.left,top:e.screenY-d.top})}),[d]),E=(0,r.useCallback)((e=>{u({left:c.left+(e.screenX-d.left),top:c.top+(e.screenY-d.top)}),f(Ei),m(null)}),[c,d]);return(0,r.useEffect)((()=>{if(d)return document.documentElement.style.cursor="default",document.body.classList.add("dragging"),document.addEventListener("mouseup",E),document.addEventListener("mousemove",w),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",E),document.removeEventListener("mousemove",w)}}),[d,w,E]),r.createElement("dialog",Object.assign({},s,{className:`dialog ${i}`,onClose:v,style:{transform:`translate(${c.left+h.left}px, ${c.top+h.top}px)`},ref:l}),r.createElement("header",{className:"dialog-head",onMouseDown:g},r.createElement("h2",null,n),r.createElement("div",{className:"dialog-close",role:"button",onClick:p,onMouseDown:y,"aria-label":"Close"},r.createElement(yi,{name:"close"}))),r.createElement("div",{className:"dialog-body",onClick:b},a))}));var ki=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};function Si(e,t=!1){return ki(this,void 0,void 0,(function*(){return new Promise(((n,a)=>{const o=document.createElement("div"),s=(0,i.s)(o);try{const i=e=>{s.unmount(),o.remove(),n(e)};document.getElementById(t?"system":"popup").append(o),s.render(r.createElement(e,{onClose:i}))}catch(e){s.unmount(),o.remove(),a(e)}}))}))}var Ci=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Pi({title:e,message:t,system:n=!1}){return i=this,a=void 0,s=function*(){"string"==typeof t&&(t=r.createElement("p",null,t)),yield Si((n=>r.createElement(Ti,Object.assign({},n,{title:e,message:t}))),n)},new((o=void 0)||(o=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function r(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof o?e:new o((function(t){t(e)}))}(t.value).then(n,r)}l((s=s.apply(i,a||[])).next())}));var i,a,o,s}function Ti(e){var{message:t,title:n="Message"}=e,i=Ci(e,["message","title"]);return r.createElement(xi,Object.assign({},i,{className:"alert-dialog",title:n}),r.createElement("form",{method:"dialog"},r.createElement("div",{className:"alert-message"},t),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",null,"OK"))))}var Ai=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))},Ii=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Oi=new z("confirm");function Mi({title:e,message:t,okLabel:n,storageId:i,system:a=!1}){return Ai(this,void 0,void 0,(function*(){return!(!i||!Oi.getBoolean(i))||("string"==typeof t&&(t=r.createElement("p",null,t)),"confirmed"===(yield Si((a=>r.createElement(Ni,Object.assign({},a,{title:e,message:t,okLabel:n,storageId:i}))),a)))}))}function Ni(e){var{title:t="Confirm",message:n,okLabel:i="OK",storageId:a}=e,o=Ii(e,["title","message","okLabel","storageId"]);const s=(0,r.useId)(),l=(0,r.useRef)(null),c=(0,r.useCallback)((()=>{a&&l.current.checked&&Oi.setBoolean(a,!0)}),[a]);return r.createElement(xi,Object.assign({},o,{className:"confirm-dialog",title:t}),r.createElement("form",{method:"dialog",onSubmit:c},r.createElement("div",{className:"confirm-message"},n),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",{value:"confirmed"},i)),a?r.createElement("footer",{className:"confirm-dialog-storage"},r.createElement("input",{id:s,type:"checkbox",ref:l}),r.createElement("label",{htmlFor:s},"Don't show this message again.")):null))}var $i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function zi(e){var t,n,i,a,{system:o=!1}=e,s=$i(e,["system"]);return t=this,n=void 0,a=function*(){return Si((e=>r.createElement(ji,Object.assign({},e,s))),o)},new((i=void 0)||(i=Promise))((function(e,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(o,s)}l((a=a.apply(t,n||[])).next())}))}function ji(e){var{title:t="Input",label:n,suggestedValue:i="",okLabel:a="OK"}=e,o=$i(e,["title","label","suggestedValue","okLabel"]);const s=(0,r.useId)(),[l,c]=(0,r.useState)(i),u=(0,r.useCallback)((e=>{c(e.target.value)}),[]);return r.createElement(xi,Object.assign({},o,{className:"prompt-dialog",title:t}),r.createElement("form",{method:"dialog"},n?r.createElement("p",{className:"prompt-message"},r.createElement("label",{htmlFor:s},n,": ")):null,r.createElement("p",null,r.createElement("input",{type:"text",id:s,defaultValue:i,autoFocus:!0,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",onChange:u})),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",{value:l},a))))}var Li=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};function Ri(e){const t=(0,r.useId)(),n=(0,r.useRef)(null),i=(0,r.useRef)(null),a=(0,r.useRef)(null),o=(0,r.useRef)(null),s=(0,r.useCallback)((()=>Li(this,void 0,void 0,(function*(){try{const e=a.current.value,t=o.current.value;fi.host=i.current.value.replace(/\/+$/,"");const{device:r,deviceId:s}=fi,l=`MediaBrowser Client="ampcast", Version="0.8.12", Device="${r}", DeviceId="${s}"`,c=yield fetch(`${fi.host}/Users/AuthenticateByName`,{method:"POST",headers:{"Content-Type":"application/json","X-Emby-Authorization":l},body:JSON.stringify({Username:e,Pw:t})});if(!c.ok)throw Error(`${c.status}: ${c.statusText}`);const u=yield c.json(),d=u.ServerId,m=u.User.Id,h=u.AccessToken;n.current.close(JSON.stringify({serverId:d,userId:m,token:h}))}catch(e){console.error(e)}}))),[]),l=(0,r.useCallback)((e=>{e.preventDefault(),s()}),[s]);return r.createElement(xi,Object.assign({},e,{className:"jellyfin-login-dialog",title:"Log in to Jellyfin",ref:n}),r.createElement("form",{method:"dialog",onSubmit:l},r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("label",{htmlFor:`${t}-host`},"Host:"),r.createElement("input",{type:"url",id:`${t}-host`,defaultValue:fi.host,placeholder:"https://",ref:i,required:!0})),r.createElement("p",null,r.createElement("label",{htmlFor:`${t}-username`},"User:"),r.createElement("input",{type:"text",id:`${t}-username`,autoFocus:!0,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",ref:a,required:!0})),r.createElement("p",null,r.createElement("label",{htmlFor:`${t}-password`},"Password:"),r.createElement("input",{type:"password",id:`${t}-password`,ref:o,required:!0}))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",null,"Login"))))}var _i=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::jellyfinAuth");const Di=new A("jellyfinAuth"),Fi=new Ie("");function Vi(){return""!==Fi.getValue()}function Ui(){return Fi.pipe(er()).pipe(Xt((e=>""!==e)),er())}function Bi(e){fi.token=e,e&&Di.log("Access token successfully obtained."),Fi.next(e)}Bi(fi.token);var Hi;!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(Hi||(Hi={}));const Yi=new A("OffsetPager");class Ki extends Dr{constructor(e,t){super(t),this.fetch=e,this.fetchStates={},this.size=0}connect(){this.subscriptions||(super.connect(),this.subscriptions.add(this.fetches$.pipe(ze((({index:e,length:t})=>t>0&&this.isInRange(e))),Xt((({index:e,length:t})=>this.getPageNumbersFromIndex(e,t))),Zt((e=>e)),Zt((e=>this.fetchPage(e))),lr((e=>(Yi.error(e),this.error$.next(e),Pn(void 0)))),wn(this.observeComplete())).subscribe(Yi)))}get pageSize(){return this.config.pageSize||20}fetchPage(e){return t=this,n=void 0,i=function*(){if(this.fetchStates[e]!==Hi.Fulfilled&&this.fetchStates[e]!==Hi.Pending){this.fetchStates[e]=Hi.Pending;try{const t=yield this.fetch(e,this.pageSize);this.fetchStates[e]=Hi.Fulfilled,this.insertPage(e,t)}catch(t){throw this.fetchStates[e]=Hi.Rejected,t}}},new((r=void 0)||(r=Promise))((function(e,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(o,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}insertPage(e,t){var n;const r=this.items.slice(),i=Math.min(t.total,null!==(n=this.maxSize)&&void 0!==n?n:1/0),a=Math.ceil(i/this.pageSize),o=(e-1)*this.pageSize,s=e===a;if(r.length=s||t.items.length<this.pageSize?o:i,t.items.forEach(((e,t)=>r[t+o]=e)),r.length=Math.min(r.length,i),t.items.length===i)for(let e=0;e<=a;e++)this.fetchStates[e+1]=Hi.Fulfilled;this.size=i,this.size$.next(i),this.items$.next(r)}getPageNumbersFromIndex(e,t){const n=this.size,r=Math.max(Math.ceil(this.pageSize/2),t),i=Math.max(e-r,0),a=Math.min(e+r+t-1,0===n?this.maxSize?this.maxSize-1:1/0:n-1),o=this.getPageNumberFromIndex(i),s=this.getPageNumberFromIndex(a);if(o===s)return[o];{const e=[];for(let t=o;t<=s;t++)e.push(t);return e}}getPageNumberFromIndex(e){return Math.floor(e/this.pageSize)+1}isInRange(e){return 0===this.size?e>=0:e>=0&&e<this.size}}class Wi{constructor(e,t={},n,r){this.path=e,this.params=t,this.parent=r,this.pageSize=(null==n?void 0:n.pageSize)||100,this.pager=new Ki((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},n))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems().pipe(Xt((e=>{var t;return(null===(t=this.parent)||void 0===t?void 0:t.itemType)===Yn.Folder?e.sort(((e,t)=>e.itemType===t.itemType?e.itemType===Yn.Folder?e.fileName.localeCompare(t.fileName):0:e.itemType===Yn.Folder?-1:1)):e})))}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){return t=this,n=void 0,i=function*(){const t=Object.assign(Object.assign({IncludeItemTypes:"Audio",Fields:"AudioInfo,Genres,Path",EnableUserData:!0,Recursive:!0,ImageTypeLimit:1,EnableImageTypes:"Primary"},this.params),{Limit:String(this.pageSize),StartIndex:String((e-1)*this.pageSize)}),n=yield gi.get(this.path,t);if(!n.ok)throw n;const r=yield n.json();return r.Type?{items:[this.createItem(r)],total:1}:{items:r.Items.map((e=>this.createItem(e))),total:r.TotalRecordCount}},new((r=void 0)||(r=Promise))((function(e,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(o,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}createItem(e){var t;if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Yn.Folder&&e.IsFolder)return this.createMediaFolder(e);{let t;switch(e.Type){case"MusicArtist":t=this.createMediaArtist(e);break;case"MusicAlbum":t=this.createMediaAlbum(e);break;case"Playlist":t=this.createMediaPlaylist(e);break;default:t=this.createMediaItemFromTrack(e)}return oa.canRate(t)&&(t.rating=this.getRating(t,e)),t}}createMediaArtist(e){var t;return{itemType:Yn.Artist,src:`jellyfin:album:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",playCount:(null===(t=e.UserData)||void 0===t?void 0:t.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e.Id),pager:this.createAlbumsPager(e)}}createMediaAlbum(e){var t,n;return{itemType:Yn.Album,src:`jellyfin:album:${e.Id}`,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e.Id),trackCount:e.ChildCount||void 0,pager:this.createAlbumPager(e),artist:e.AlbumArtist||void 0,year:e.ProductionYear||void 0}}createMediaPlaylist(e){var t,n;const r=`jellyfin:playlist:${e.Id}`;return{src:r,itemType:Yn.Playlist,externalUrl:this.getExternalUrl(e),title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,playedAt:(null===(t=e.UserData)||void 0===t?void 0:t.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):void 0,playCount:(null===(n=e.UserData)||void 0===n?void 0:n.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(e.Id),trackCount:e.ChildCount||void 0,pager:this.createPlaylistPager(e),isPinned:Wr.isPinned(r)}}createMediaFolder(e){var t;const n=this.getFileName(e.Path||"")||e.Name||"[unknown]",r={itemType:Yn.Folder,src:`jellyfin:folder:${e.Id}`,title:e.Name||"[unknown]",fileName:n,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===Yn.Folder?`${this.parent.path}/${n}`:"/",parent:this.parent};return r.pager=this.createFolderPager(r),r}createMediaItemFromTrack(e){var t,n,r;const i=(null===(t=e.ImageTags)||void 0===t?void 0:t.Primary)?e.Id:e.AlbumId;return{itemType:Yn.Media,mediaType:Nr.Audio,src:`jellyfin:audio:${e.Id}`,externalUrl:this.getExternalUrl(e),fileName:this.getFileName(e.Path||"")||e.Name||"[unknown]",title:e.Name||"",duration:e.RunTimeTicks?e.RunTimeTicks/1e7:0,year:e.ProductionYear||void 0,playedAt:(null===(n=e.UserData)||void 0===n?void 0:n.LastPlayedDate)?Math.floor(new Date(e.UserData.LastPlayedDate).getTime()/1e3):0,playCount:(null===(r=e.UserData)||void 0===r?void 0:r.PlayCount)||void 0,genres:e.Genres||void 0,thumbnails:this.createThumbnails(i),artists:e.Artists||(e.AlbumArtist?[e.AlbumArtist]:void 0),albumArtist:e.AlbumArtist||void 0,album:e.Album||void 0,disc:e.Album&&e.ParentIndexNumber||void 0,track:e.Album&&e.IndexNumber||0}}createThumbnails(e){return e?[this.createThumbnail(e,120),this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480)]:void 0}createThumbnail(e,t,n=t){return{url:`${fi.host}/Items/${e}/Images/Primary?fillWidth=${t}&fillHeight=${n}`,width:t,height:n}}createAlbumPager(e){return new Wi(`Users/${fi.userId}/Items`,{ParentId:e.Id,SortBy:"SortName",SortOrder:"Ascending"})}createAlbumsPager(e){return new Wi(`Users/${fi.userId}/Items`,{AlbumArtistIds:e.Id,IncludeItemTypes:"MusicAlbum",SortOrder:"Descending"})}createPlaylistPager(e){return new Wi(`Playlists/${e.Id}/Items`,{UserId:fi.userId,MediaType:"Audio",Fields:"ChildCount"})}createFolderPager(e){var t;const[,,n]=e.src.split(":"),r=new Wi(`Users/${fi.userId}/Items`,{ParentId:n,IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio",Fields:"AudioInfo,Genres,UserData,ParentId,Path",EnableUserData:!0,Recursive:!1,SortBy:"SortName",SortOrder:"Ascending"},{pageSize:Wi.maxPageSize},e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Yn.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new fr([e]);return new zr(t,r)}return r}getExternalUrl(e){return`${fi.host}/web/index.html#!/details?id=${e.Id}&serverId=${fi.serverId}`}getFileName(e){return e.split(/[/\\]/).pop()}getRating(e,t){const n=t.UserData;return dr.get(e,n?n.IsFavorite?1:0:void 0)}}Wi.minPageSize=10,Wi.maxPageSize=1e3;const qi=Wi;var Ji=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::jellyfin");const Qi="jellyfin",Xi={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","PlayCount"]},Gi={id:"jellyfin/liked-songs",title:"My Songs",icon:"heart",itemType:Yn.Media,viewType:Wn.Ratings,layout:{view:"details",fields:["Artist","Title","Album","Track","Duration","Genre","PlayCount"]},search:()=>ua({Filters:"IsFavorite",SortBy:"AlbumArtist,Album,SortName"})},Zi={id:"jellyfin/liked-albums",title:"My Albums",icon:"heart",itemType:Yn.Album,viewType:Wn.Ratings,search:()=>ua({Filters:"IsFavorite",IncludeItemTypes:"MusicAlbum",SortBy:"AlbumArtist,SortName"})},ea={id:"jellyfin/liked-artists",title:"My Artists",icon:"heart",itemType:Yn.Artist,viewType:Wn.Ratings,defaultHidden:!0,search:()=>new qi("Artists/AlbumArtists",{isFavorite:!0,UserId:fi.userId})},ta={id:"jellyfin/recently-played",title:"Recently Played",icon:"clock",itemType:Yn.Media,viewType:Wn.RecentlyPlayed,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>ua({SortBy:"DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},na={id:"jellyfin/most-played",title:"Most Played",icon:"most-played",itemType:Yn.Media,viewType:Wn.MostPlayed,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Genre"]},search:()=>ua({SortBy:"PlayCount,DatePlayed",SortOrder:"Descending",Filters:"IsPlayed"})},ra={id:"jellyfin/playlists",title:"Playlists",icon:"playlist",itemType:Yn.Playlist,secondaryLayout:Xi,search:()=>ua({SortBy:"SortName",SortOrder:"Ascending",IncludeItemTypes:"Playlist"})},ia={id:"jellyfin/folders",title:"Folders",icon:"folder",itemType:Yn.Folder,defaultHidden:!0,search(){const e={itemType:Yn.Folder,src:"",title:"Folders",fileName:"",path:""};return e.pager=new qi("Library/MediaFolders",{IncludeItemTypes:"Folder,MusicAlbum,MusicArtist,Audio",Fields:"AudioInfo,Genres,UserData,ParentId,Path",Recursive:!1,SortBy:"SortName",SortOrder:"Ascending"},{pageSize:qi.maxPageSize},e),e.pager}},aa={id:Qi,icon:Qi,name:"Jellyfin",url:"https://jellyfin.org",roots:[la(Yn.Media,{title:"Songs"}),la(Yn.Album,{title:"Albums"}),la(Yn.Artist,{title:"Artists"}),la(Yn.Playlist,{title:"Playlists",secondaryLayout:Xi})],sources:[Gi,Zi,ea,na,ta,ra,ia],labels:{[Bn.Like]:"Add to Jellyfin Favorites",[Bn.Unlike]:"Remove from Jellyfin Favorites"},canRate:sa,canStore:()=>!1,compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:Yn.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":");return ua({ids:t,IncludeItemTypes:"Playlist"})}}},getMetadata:function(e){return Ji(this,void 0,void 0,(function*(){if(!sa(e)||void 0!==e.rating)return e;const t=dr.get(e);if(void 0!==t)return Object.assign(Object.assign({},e),{rating:t});const[,,n]=e.src.split(":"),r=new qi(`Users/${fi.userId}/Items/${n}`,void 0,{pageSize:1,maxSize:1}),i=yield hr(r,{timeout:2e3});return x(e,i[0])}))},lookup:function(e,t,n=10,r){return Ji(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:n,maxSize:n,lookup:!0};return hr(ca(Yn.Media,t,{Artists:e},i),{timeout:r})}))},rate:function(e,t){return Ji(this,void 0,void 0,(function*(){const[,,n]=e.src.split(":"),r=`Users/${fi.userId}/FavoriteItems/${n}`;t?gi.post(r):gi.delete(r)}))},observeIsLoggedIn:Ui,isLoggedIn:Vi,login:function(){return _i(this,void 0,void 0,(function*(){if(!Vi())try{const e=yield function(){return Li(this,void 0,void 0,(function*(){return Si(Ri,!0)}))}();if(e){const{serverId:t,userId:n,token:r}=JSON.parse(e);fi.serverId=t,fi.userId=n,Bi(r)}}catch(e){Di.log("Could not obtain access token."),Di.error(e)}}))},logout:function(){return _i(this,void 0,void 0,(function*(){Bi(""),fi.clear()}))}},oa=aa;function sa(e){switch(e.itemType){case Yn.Album:return!e.synthetic;case Yn.Folder:return!1;default:return!0}}function la(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`jellyfin/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>ca(e,t)})}function ca(e,t,n,r){if(t){const i=Object.assign(Object.assign({},n),{SearchTerm:t});if(e===Yn.Artist)return new qi("Artists/AlbumArtists",Object.assign(Object.assign({},i),{UserId:fi.userId}),r);switch(e){case Yn.Media:i.IncludeItemTypes="Audio";break;case Yn.Album:i.IncludeItemTypes="MusicAlbum";break;case Yn.Playlist:i.IncludeItemTypes="Playlist"}return ua(i,r)}return new fr}function ua(e,t){return new qi(`Users/${fi.userId}/Items`,e,t)}dr.addObserver(aa);var da=n(2568),ma=n.n(da);const ha=new z("lastfm"),fa={get token(){return ha.getString("token")},set token(e){ha.setString("token",e)},get userId(){return ha.getString("userId")},set userId(e){ha.setString("userId",e)},get sessionKey(){return ha.getString("sessionKey")},set sessionKey(e){ha.setString("sessionKey",e)},get firstScrobbledAt(){return ha.getString("firstScrobbledAt")},set firstScrobbledAt(e){ha.setString("firstScrobbledAt",e)},get playCount(){return ha.getNumber("playCount")},set playCount(e){ha.setNumber("playCount",e)},get removeDuplicates(){return ha.getBoolean("removeDuplicates")},set removeDuplicates(e){ha.setBoolean("removeDuplicates",e)},clear(){ha.clear()}};var pa=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::lastfmAuth");const va=new A("lastfmAuth"),ba=new Ie(""),ga=new Ie("");function ya(){return""!==ba.getValue()}function wa(){return ba.pipe(er()).pipe(Xt((e=>""!==e)),er())}function Ea(e){const t=Object.keys(e);let n="";return t.sort(),t.forEach((t=>n+=t+e[t])),n+=br,ma()(n)}ga.next(fa.sessionKey),ba.next(fa.token);var xa=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::lastfmApi");const ka=new A("lastfmApi"),Sa=new class{constructor(){this.host="https://ws.audioscrobbler.com/2.0",this.placeholderImage="2a96cbd8b46e442fc41c2b86b821562f.png"}scrobble(e){return xa(this,void 0,void 0,(function*(){ka.log("scrobble",{items:e});const t="track.scrobble";if(1===e.length){const n=e[0],r=String(n.playedAt);yield this.post(Object.assign({method:t,timestamp:r},this.getScrobbleParams(n)))}else if(e.length>0){const n={};e.forEach(((e,t)=>{const r=this.getScrobbleParams(e);n[`timestamp[${t}]`]=String(e.playedAt),Object.keys(r).forEach((e=>{n[`${e}[${t}]`]=r[e]}))})),yield this.post(Object.assign({method:t},n))}}))}updateNowPlaying(e){return xa(this,void 0,void 0,(function*(){ka.log("updateNowPlaying",{item:e});try{this.canScrobble(e)&&(yield this.post(Object.assign({method:"track.updateNowPlaying"},this.getScrobbleParams(e))))}catch(t){ka.log('Failed to update "now playing":',{item:e}),ka.error(t)}}))}getUserInfo(){return xa(this,void 0,void 0,(function*(){return this.get({method:"user.getInfo",user:fa.userId})}))}createThumbnails(e){const t=e?[this.createThumbnail(e[0],34),this.createThumbnail(e[1],64),this.createThumbnail(e[2],174),this.createThumbnail(e[3],300)].filter(l):[];return 0===t.length?void 0:t}get(e){return xa(this,void 0,void 0,(function*(){const t=`${this.host}?${new URLSearchParams(Object.assign(Object.assign({},e),{api_key:vr,format:"json"}))}`,n=yield fetch(t,{method:"GET"});if(!n.ok)throw n;return n.json()}))}post(e){return xa(this,void 0,void 0,(function*(){const t=fa.token,n=fa.sessionKey,r=Ea(e=Object.assign(Object.assign({},e),{api_key:vr,token:t,sk:n})),i=`${new URLSearchParams(e)}&api_sig=${r}`,a=yield fetch(this.host,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:i});if(!a.ok)throw a;return a}))}getScrobbleParams(e){const t={};return t.track=e.title,t.artist=e.artists[0],e.album&&"[Unknown Album]"!==e.album&&(t.album=e.album,e.albumArtist&&(t.albumArtist=e.albumArtist)),e.duration&&(t.duration=String(Math.round(e.duration))),e.track&&(t.trackNumber=String(e.track)),e.recording_mbid&&(t.mbid=e.recording_mbid),t}canScrobble(e){var t;return!!e&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30}createThumbnail(e,t,n=t){if(e){const r=e["#text"];if(r&&!r.endsWith(this.placeholderImage))return{url:r,width:t,height:n}}}};class Ca{constructor(e,t,n,r){this.album=r,this.defaultConfig={minPageSize:Ca.minPageSize,maxPageSize:Ca.maxPageSize,pageSize:50},this.pageNumber=1,this.playCountName="playcount";const i=Object.assign(Object.assign({},this.defaultConfig),n),{page:a}=e,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["page"]);this.pageNumber=Number(a)||1,this.method=e.method,this.playCountName=i.playCountName||"playcount",this.pager=new Vr(((e=this.defaultConfig.pageSize)=>{return n=this,r=void 0,a=function*(){const n=this.pageNumber,r=yield Sa.get(Object.assign(Object.assign({},o),{page:n,limit:e}));this.pageNumber++;const{items:i,total:a,atEnd:s,itemType:l}=t(r);return{items:this.createMediaObjects(l,i),total:a,atEnd:s}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{l(a.next(e))}catch(e){t(e)}}function s(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(o,s)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a}),i)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createMediaObjects(e,t){switch(e){case Yn.Artist:return t.map((e=>this.createMediaArtist(e)));case Yn.Album:return t.map((e=>this.createMediaAlbum(e)));case Yn.Media:return t.map((e=>this.createMediaItem(e)));default:return[]}}createMediaItem(e){var t,n,r,i,a,o;const s=e.date&&Number(e.date.uts)||0,l=null===(t=e["@attr"])||void 0===t?void 0:t.rank;return Object.assign(Object.assign({},this.createMediaObject(Yn.Media,e)),{mediaType:Nr.Audio,src:s?`lastfm:listen:${s}`:`lastfm:track:${mi()}`,artists:e.artist?[e.artist.name]:void 0,album:(null===(n=this.album)||void 0===n?void 0:n.name)||(null===(r=e.album)||void 0===r?void 0:r["#text"]),albumArtist:null===(i=this.album)||void 0===i?void 0:i.artist.name,release_mbid:(null===(a=this.album)||void 0===a?void 0:a.mbid)||(null===(o=e.album)||void 0===o?void 0:o.mbid),duration:Number(e.duration)||0,track:l&&Number(l)||void 0,rating:"loved"in e?Number(e.loved)||0:"user.getLovedTracks"===this.method?1:void 0,playedAt:s})}createMediaAlbum(e){var t;return Object.assign(Object.assign({},this.createMediaObject(Yn.Album,e)),{src:`lastfm:album:${mi()}`,artist:e.artist.name,year:(null===(t=e.wiki)||void 0===t?void 0:t.published)&&new Date(e.wiki.published).getFullYear()||void 0,pager:this.createAlbumPager(e)})}createMediaArtist(e){return Object.assign(Object.assign({},this.createMediaObject(Yn.Artist,e)),{src:`lastfm:artist:${mi()}`,pager:this.createArtistAlbumsPager(e)})}createArtistTopTracks(e){return{itemType:Yn.Album,title:"Top Tracks",thumbnails:Sa.createThumbnails(e.image),src:`lastfm:top-tracks:${mi()}`,artist:e.name,pager:this.createTopTracksPager(e),synthetic:!0}}createMediaObject(e,t){return{itemType:e,title:t.name,playCount:Number(t[this.playCountName])||void 0,globalPlayCount:"userplaycount"===this.playCountName&&Number(t.playcount)||void 0,thumbnails:Sa.createThumbnails(t.image),externalUrl:t.url||void 0}}createArtistAlbumsPager(e){const t=this.createArtistTopTracks(e),n=new Ur((()=>[t])),r=new Ca({method:"artist.getTopAlbums",artist:e.name},(({topalbums:e})=>{const t=e["@attr"];return{items:e.album,total:Number(t.total)||void 0,atEnd:t.page===t.totalPages,itemType:Yn.Album}}),{maxSize:100,playCountName:"userplaycount"});return n.fetchAt(0),new zr(n,r)}createAlbumPager(e){return new Ca({method:"album.getInfo",album:e.name,artist:e.artist.name,user:fa.userId},(({album:e})=>{if(e.tracks){const t=e.tracks.track,n=(t?Array.isArray(t)?t:[t]:[]).map((t=>Object.assign(Object.assign({},t),{album:{"#text":e.name},image:t.image||e.image})));return{items:n,total:n.length,atEnd:!0,itemType:Yn.Media}}throw Error("No track info")}),{playCountName:"userplaycount"},e)}createTopTracksPager(e){return new Ca({method:"artist.getTopTracks",artist:e.name},(({toptracks:e})=>{const t=e["@attr"];return{items:e.track,total:Number(t.total)||void 0,atEnd:t.page===t.totalPages,itemType:Yn.Media}}),{maxSize:20})}}Ca.minPageSize=10,Ca.maxPageSize=200;const Pa=Ca;class Ta extends Pa{constructor(e,t){super(Object.assign(Object.assign({},e),{method:"user.getRecentTracks",extended:"1",user:fa.userId}),(({recenttracks:e})=>{var t,n;const r=e["@attr"]||{},i=e.track,a=i?Array.isArray(i)?i:[i]:[],o="true"===(null===(n=null===(t=a[0])||void 0===t?void 0:t["@attr"])||void 0===n?void 0:n.nowplaying),s=Number(r.page)||1,l=Number(r.totalPages)||1,c=1===l||s===l,u=Number(r.total)||void 0;return o&&a.shift(),{items:a,total:u,atEnd:c,itemType:Yn.Media}}),t)}}var Aa=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::lastfm");const Ia={view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},Oa={view:"details",fields:["Index","Title","Artist"]},Ma={id:"lastfm/history",title:"History",icon:"clock",itemType:Yn.Media,defaultHidden:!0,search:({startAt:e=0}={})=>new Ta(e?{to:e}:void 0)},Na={id:"lastfm/recently-played",title:"Recently Played",icon:"clock",itemType:Yn.Media,search:()=>new Ta},$a={id:"lastfm/loved-tracks",title:"Loved Tracks",icon:"heart",itemType:Yn.Media,viewType:Wn.Ratings,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear"]},defaultHidden:!0,search:()=>new Pa({method:"user.getLovedTracks",user:fa.userId},(({lovedtracks:e})=>{const t=e["@attr"]||{},n=e.track,r=n?Array.isArray(n)?n:[n]:[],i=Number(t.page)||1,a=Number(t.totalPages)||1,o=1===a||i===a;return{items:r,total:Number(t.total)||void 0,atEnd:o,itemType:Yn.Media}}))},za={id:"lastfm",name:"last.fm",icon:"lastfm",url:"https://www.last.fm",isScrobbler:!0,roots:[Na],sources:[Ra("user.getTopTracks",{title:"Top Tracks",itemType:Yn.Media,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","PlayCount"]}}),Ra("user.getTopAlbums",{title:"Top Albums",itemType:Yn.Album,layout:Ia,secondaryLayout:Oa}),Ra("user.getTopArtists",{title:"Top Artists",itemType:Yn.Artist,layout:{view:"card minimal",fields:["Thumbnail","Title","PlayCount"]},secondaryLayout:Ia,tertiaryLayout:Oa}),Ma,$a],labels:{[Bn.Like]:"Love on last.fm",[Bn.Unlike]:"Unlove on last.fm"},canRate:function(e){var t;return e.itemType===Yn.Media&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])},canStore:()=>!1,compareForRating:function(e,t){var n,r,i;return e.itemType===Yn.Media&&(e.itemType===t.itemType&&!!e.title&&!!(null===(n=e.artists)||void 0===n?void 0:n[0])&&La(e.title,t.title)&&La(null===(r=e.artists)||void 0===r?void 0:r[0],null===(i=t.artists)||void 0===i?void 0:i[0]))},getMetadata:function(e){return Aa(this,void 0,void 0,(function*(){if(e.itemType!==Yn.Media||void 0!==e.rating)return e;const t={method:"track.getInfo",user:fa.userId};if(e.recording_mbid)t.mbid=e.recording_mbid;else{const{title:n,artists:r=[]}=e;if(t.artist=r[0],t.track=n,!t.artist)return e}const{track:n}=yield Sa.get(t);if(!n||"error"in n)throw Error((null==n?void 0:n.message)||"Not found");{const t={};return n.album&&(t.album=n.album.title,t.albumArtist=n.album.artist,e.thumbnails||(t.thumbnails=Sa.createThumbnails(n.album.image))),Object.assign(Object.assign(Object.assign({},e),t),{rating:dr.get(e,Number(n.userloved)||0),playCount:Number(n.userplaycount)||0,globalPlayCount:Number(n.playcount)||0})}}))},rate:function(e,t){return Aa(this,void 0,void 0,(function*(){if(e.itemType===Yn.Media){const{title:n,artists:r=[]}=e,i=r[0];n&&i&&(yield Sa.post({method:t?"track.love":"track.unlove",track:n,artist:i}))}}))},observeIsLoggedIn:wa,isLoggedIn:ya,login:function(){return pa(this,void 0,void 0,(function*(){if(!ya())try{const e=yield function(){return pa(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const n=location.hostname,r=("localhost"===n?`http://${n}:${location.port}`:`https://${n}`)+"/auth/lastfm/callback/";let i=null;const a=n=>{if(/(localhost|ampcast)/.test(n.origin)){if(clearInterval(o),window.removeEventListener("message",a,!1),null==i||i.close(),i=null,n.origin!==location.origin)return void t({message:`Origin ${n.origin} does not match ${location.origin}`});e(n.data.token)}};window.addEventListener("message",a,!1),i=window.open(`https://www.last.fm/api/auth?api_key=${vr}&cb=${r}`,"last.fm","popup");const o=setInterval((()=>{(null==i?void 0:i.closed)&&(clearInterval(o),t({message:"access_denied"}))}),500)}))}))}(),t=yield function(e){return pa(this,void 0,void 0,(function*(){const t="auth.getSession",n=Ea({api_key:vr,token:e,method:t}),r=yield fetch(`https://ws.audioscrobbler.com/2.0?method=${t}&api_key=${vr}&token=${e}&api_sig=${n}&format=json`);if(!r.ok)throw r;const{session:i}=yield r.json();return fa.userId=i.name,fa.token=e,fa.sessionKey=i.key,i.key}))}(e);va.log("Access token successfully obtained."),ga.next(t),ba.next(e)}catch(e){va.log("Could not obtain access token."),va.error(e)}}))},logout:function(){return pa(this,void 0,void 0,(function*(){fa.clear(),ga.next(""),ba.next("")}))}},ja=za;function La(e,t=""){return 0===e.localeCompare(t,void 0,{sensitivity:"accent"})}function Ra(e,t){return Object.assign(Object.assign({},t),{id:`lastfm/top/${e.slice(11).toLowerCase()}`,icon:"star",searchable:!1,search:({period:n="overall"}={})=>new Pa({method:e,period:n,user:fa.userId},(n=>{const[,r]=e.toLowerCase().split("."),i=n[r.slice(3)],a=i["@attr"],o=i[r.slice(6,-1)],s=Number(a.page)||1,l=Number(a.totalPages)||1,c=1===l||s===l;return{items:o,total:Number(a.total)||void 0,atEnd:c,itemType:t.itemType}}))})}dr.addObserver(za,5);const _a=new z("listenbrainz"),Da={get token(){return _a.getString("token")},set token(e){_a.setString("token",e)},get userId(){return _a.getString("userId")},set userId(e){_a.setString("userId",e)},get firstScrobbledAt(){return _a.getString("firstScrobbledAt")},set firstScrobbledAt(e){_a.setString("firstScrobbledAt",e)},clear(){_a.clear()}};var Fa=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::listenbrainzApi");const Va=new A("listenbrainzApi"),Ua=new class{constructor(){this.host="https://api.listenbrainz.org/1",this.rateLimitRemainingCalls=2,this.rateLimitResetTime=0}rate(e,t){return Fa(this,void 0,void 0,(function*(){if(e.recording_msid||e.recording_mbid){const n="feedback/recording-feedback",r={score:t};e.recording_msid&&(r.recording_msid=e.recording_msid),e.recording_mbid&&(r.recording_mbid=e.recording_mbid);const i=yield this.post(n,r);if(!i.ok)throw i}}))}addRatings(e){return Fa(this,void 0,void 0,(function*(){if((e=e.filter((e=>!!e.recording_msid||!!e.recording_mbid))).length>0){const t=yield this.getRatings(e);rr.dispatch(e.map(((e,n)=>({match:t=>qo(t,e),values:{rating:t[n]}}))))}}))}getRatings(e){return Fa(this,void 0,void 0,(function*(){if((e=e.filter((e=>!!e.recording_msid||!!e.recording_mbid))).length>0){const[t,n]=d(e,(e=>!!e.recording_mbid)),r=t.map((e=>e.recording_mbid)),i=n.map((e=>e.recording_msid)),a={};r.length>0&&(a.recording_mbids=r),i.length>0&&(a.recording_msids=i);const{feedback:o}=yield this.get(`feedback/user/${Da.userId}/get-feedback-for-recordings`,a);return e.map((e=>{var t;return 1===(null===(t=o.find((t=>!!e.recording_mbid&&e.recording_mbid===t.recording_mbid||!!e.recording_msid&&e.recording_msid===t.recording_msid)))||void 0===t?void 0:t.score)?1:0}))}return[]}))}getListeningActivity({range:e="all_time"}={}){return Fa(this,void 0,void 0,(function*(){const{payload:{listening_activity:t}}=yield this.get(`stats/user/${Da.userId}/listening-activity`,{range:e});return t}))}getListenCount(){return Fa(this,void 0,void 0,(function*(){const{payload:{count:e}}=yield this.get(`user/${Da.userId}/listen-count`);return e}))}getListens(e){return Fa(this,void 0,void 0,(function*(){return yield this.get(`user/${Da.userId}/listens`,e)}))}scrobble(e){return Fa(this,void 0,void 0,(function*(){e.length>0&&(Va.log("scrobble",{items:e}),yield this.post("submit-listens",{listen_type:1===e.length?"single":"import",payload:e.map((e=>({listened_at:e.playedAt,track_metadata:this.getScrobbleParams(e)})))}))}))}updateNowPlaying(e){return Fa(this,void 0,void 0,(function*(){Va.log("updateNowPlaying",{item:e});try{this.canScrobble(e)&&(yield this.post("submit-listens",{listen_type:"playing_now",payload:[{track_metadata:this.getScrobbleParams(e)}]}))}catch(t){Va.log('Failed to update "now playing":',{item:e}),Va.error(t)}}))}get(e,t,n){return Fa(this,void 0,void 0,(function*(){t&&(e=`${e}?${new URLSearchParams(t)}`);const r=yield this.fetch(e,{method:"GET"},n);if(!r.ok||204===r.status)throw r;return r.json()}))}post(e,t){return Fa(this,void 0,void 0,(function*(){const n=JSON.stringify(t);return this.fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:n},!0)}))}fetch(e,t,n=!1){return Fa(this,void 0,void 0,(function*(){yield this.applyRateLimiting(),n&&(t.headers=Object.assign(Object.assign({},t.headers),{Authorization:`Token ${Da.token}`})),e.startsWith("/")&&(e=e.slice(1));const r=yield window.fetch(`${this.host}/${e}`,t);if(!r.ok)throw r;const i=r.headers;return i.has("x-ratelimit-remaining")&&(this.rateLimitRemainingCalls=Number(i.get("x-ratelimit-remaining"))||1),i.has("x-ratelimit-reset-in")&&(this.rateLimitResetTime=Date.now()+1e3*(Number(i.get("x-ratelimit-reset-in"))||1)),this.rateLimitRemainingCalls<5&&Va.log({rateLimitRemainingCalls:this.rateLimitRemainingCalls,rateLimitReset:new Date(this.rateLimitResetTime).toISOString()}),r}))}getScrobbleParams(e){const t={media_player:"ampcast",media_player_version:"0.8.12",submission_client:"ampcast"};e.duration&&(t.duration=Math.round(e.duration)),e.track&&(t.tracknumber=e.track),e.artist_mbids&&(t.artist_mbids=e.artist_mbids),e.release_mbid&&(t.release_mbid=e.release_mbid),e.recording_mbid&&(t.recording_mbid=e.recording_mbid),e.isrc&&(t.isrc=e.isrc);const[n]=e.src.split(":");switch(n){case"spotify":e.externalUrl&&(t.origin_url=e.externalUrl,t.spotify_id=e.externalUrl),t.music_service="spotify.com";break;case"apple":e.externalUrl&&(t.origin_url=e.externalUrl),t.music_service="music.apple.com";break;case"youtube":e.externalUrl&&(t.origin_url=e.externalUrl),t.music_service="youtube.com";break;case"jellyfin":t.music_service_name="Jellyfin";break;case"plex":t.music_service_name="Plex";break;case"blob":case"file":t.music_service_name="Local file"}const r={track_name:e.title,artist_name:e.artists[0],additional_info:t};return e.album&&"[Unknown Album]"!==e.album&&(r.release_name=e.album),r}canScrobble(e){var t;return!!e&&!!e.title&&!!(null===(t=e.artists)||void 0===t?void 0:t[0])&&e.duration>30}applyRateLimiting(){return new Promise((e=>{if(this.rateLimitRemainingCalls)this.rateLimitRemainingCalls--,e();else{const t=this.rateLimitResetTime-Date.now();t>0?setTimeout(e,t):e()}}))}},Ba=Ua;var Ha=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Ya(e){var{href:t,className:n="",children:i=t}=e,a=Ha(e,["href","className","children"]);return r.createElement("a",Object.assign({},a,{className:`external-link ${n}`,href:t,target:"_blank",rel:"noopener"}),r.createElement("span",{className:"external-link-text"},i),r.createElement(yi,{name:"link"}))}var Ka=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};function Wa(e){const t=(0,r.useId)(),n=(0,r.useRef)(null),i=(0,r.useRef)(null),a=(0,r.useRef)(null),o="https://listenbrainz.org/profile/",s=(0,r.useCallback)((()=>Ka(this,void 0,void 0,(function*(){try{const e=i.current.value,t=a.current.value;Da.userId=e;const r=yield fetch("https://api.listenbrainz.org/1/validate-token",{headers:{"Content-Type":"application/json",Authorization:`Token ${t}`}});if(!r.ok)throw r;const{valid:o,user_name:s}=yield r.json();if(!o)throw Error("Invalid token.");if(s!==e)throw Error("Token not valid for this user.");n.current.close(JSON.stringify({userId:e,token:t}))}catch(e){console.error(e)}}))),[]),l=(0,r.useCallback)((e=>{e.preventDefault(),s()}),[s]);return r.createElement(xi,Object.assign({},e,{className:"listenbrainz-login-dialog",title:"Log in to ListenBrainz",ref:n}),r.createElement("form",{method:"dialog",onSubmit:l},r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("label",{htmlFor:`${t}-username`},"User:"),r.createElement("input",{type:"text",id:`${t}-username`,autoFocus:!0,required:!0,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",ref:i})),r.createElement("p",null,r.createElement("label",{htmlFor:`${t}-token`},"Token:"),r.createElement("input",{type:"password",id:`${t}-token`,required:!0,ref:a}))),r.createElement("p",{className:"listenbrainz-link"},r.createElement(Ya,{href:o},r.createElement(yi,{name:"listenbrainz"}),o)),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",null,"Login"))))}var qa=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::listenbrainzAuth");const Ja=new A("listenbrainzAuth"),Qa=new Ie("");function Xa(){return""!==Qa.getValue()}function Ga(){return Qa.pipe(er()).pipe(Xt((e=>""!==e)),er())}Qa.next(Da.token);var Za=n(6998),eo=n.n(Za);const to="https://musicbrainz.org";var no=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::youtubeAuth");const ro=new A("youtubeAuth"),io="https://www.googleapis.com/auth/youtube.readonly",ao=["https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest"],oo=new Ie("");function so(){return""!==lo()}function lo(){return oo.getValue()}function co(){var e,t;return no(this,void 0,void 0,(function*(){return(null===(t=null===(e=window.google)||void 0===e?void 0:e.accounts)||void 0===t?void 0:t.oauth2)||(yield c("https://accounts.google.com/gsi/client")),google.accounts.oauth2}))}!function(){no(this,void 0,void 0,(function*(){const e=(yield function(){return no(this,void 0,void 0,(function*(){const e=yield function(){return no(this,void 0,void 0,(function*(){return window.gapi||(yield c("https://apis.google.com/js/api.js")),window.gapi}))}();return e.client?e.client:new Promise(((t,n)=>{e.load("client",{callback:()=>{const r={apiKey:yr,clientId:wr,discoveryDocs:ao,scope:io};e.client.init(r).then((()=>t(e.client)),n)},onerror:n})}))}))}()).getToken();e&&(ro.log("Access token successfully obtained."),oo.next(e.access_token)),gapi.load("client:auth2",(()=>{gapi.auth2.getAuthInstance().isSignedIn.listen((e=>{if(e){const e=gapi.client.getToken();oo.next((null==e?void 0:e.access_token)||"")}else oo.next("")}))}))}))}();var uo=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};const mo=new A("youtubeCache");class ho extends vt.ZP{constructor(){super("ampcast/youtube/cache"),this.version(1).stores({entries:"&key, timeStamp"}),setTimeout((()=>this.removeExpired()))}store(e,t){return uo(this,void 0,void 0,(function*(){try{yield this.entries.put({key:e,response:t,timeStamp:Date.now()})}catch(e){mo.error(e)}}))}fetch(e){return uo(this,void 0,void 0,(function*(){try{const t=yield this.entries.get(e);return null==t?void 0:t.response}catch(e){mo.error(e)}}))}removeExpired(){const e=Date.now()-12096e5;this.entries.where("timeStamp").below(e).delete()}}const fo=new ho;var po=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))},vo=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};class bo{constructor(e,t,n){this.defaultConfig={pageSize:bo.maxPageSize},this.nextPageToken=void 0,this.pageNumber=1,this.config=Object.assign(Object.assign({},this.defaultConfig),n),this.pager=new Vr((()=>po(this,void 0,void 0,(function*(){return this.fetchPage(e,t)}))),this.config)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems({kind:e,items:t=[]},n){return po(this,void 0,void 0,(function*(){switch(e){case"youtube#playlistListResponse":return t.map((e=>this.createMediaPlaylist(e)));case"youtube#playlistItemListResponse":{const e=t.map((e=>e.contentDetails.videoId));return(yield this.fetchVideos(e,n)).map((e=>this.createMediaItem(e)))}case"youtube#searchListResponse":{const e=t.map((e=>e.id.videoId));return(yield this.fetchVideos(e,n)).map((e=>this.createMediaItem(e)))}default:return t.map((e=>this.createMediaItem(e)))}}))}createMediaPlaylist(e){var t,n,r;const i=`youtube:playlist:${e.id}`;return{src:i,itemType:Yn.Playlist,externalUrl:`${wo}/playlist?list=${e.id}`,title:(null===(t=e.snippet)||void 0===t?void 0:t.title)||e.id,thumbnails:this.mapThumbnails(null===(n=e.snippet)||void 0===n?void 0:n.thumbnails),trackCount:null===(r=e.contentDetails)||void 0===r?void 0:r.itemCount,owner:this.createOwner(e.snippet),pager:this.createPlaylistPager(e.id),isPinned:Wr.isPinned(i)}}createMediaItem(e){var t,n,r,i,a;return{itemType:Yn.Media,mediaType:Nr.Video,src:`youtube:video:${e.id}`,externalUrl:Co(e.id),title:(null===(t=e.snippet)||void 0===t?void 0:t.title)||e.id,duration:this.parseDuration(null===(n=e.contentDetails)||void 0===n?void 0:n.duration),thumbnails:this.mapThumbnails(null===(r=e.snippet)||void 0===r?void 0:r.thumbnails),owner:this.createOwner(e.snippet),globalRating:this.parseNumber(null===(i=e.statistics)||void 0===i?void 0:i.likeCount),globalPlayCount:this.parseNumber(null===(a=e.statistics)||void 0===a?void 0:a.viewCount),playedAt:0}}createOwner({channelId:e="",channelTitle:t=""}){return e?{name:t,url:`${wo}/channel/${e}`}:void 0}createPlaylistPager(e){return new bo("/playlistItems",{playlistId:e,part:"contentDetails",fields:"items(contentDetails(videoId))"})}mapThumbnails(e){if(e)return Object.keys(e).map((t=>e[t]))}parseDuration(e=""){const[,t=0,n=0,r=0]=/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/.exec(e)||[];return 60*Number(t)*60+60*Number(n)+Number(r)||0}fetchPage(e,t){return po(this,void 0,void 0,(function*(){const n=this.createCacheKey(e,t,this.pageNumber),r=yield this.getFromCache(n),i=this.nextPageToken,a=yield this.fetch(e,Object.assign(Object.assign({},t),{fields:`etag,kind,pageInfo,nextPageToken,${t.fields||"items"}`,maxResults:String(this.config.pageSize),pageToken:i}),r),{pageInfo:o,nextPageToken:s}=a,l=vo(a,["pageInfo","nextPageToken"]),c=yield this.createItems(l,n),u=null==o?void 0:o.totalResults,d=!s;return this.nextPageToken=s,this.pageNumber++,yield this.saveToCache(n,a),{items:c,total:u,atEnd:d}}))}fetchVideos(e,t){return po(this,void 0,void 0,(function*(){const n=`${t}/videos`,r=yield this.getFromCache(n),i=yield this.fetch("/videos",{id:e.join(","),part:"contentDetails,snippet,statistics",fields:`etag,${bo.videoFields}`},r);return yield this.saveToCache(n,i),i.items||[]}))}fetch(e,t,n){return po(this,void 0,void 0,(function*(){const r=(null==n?void 0:n.etag)?{"If-None-Match":n.etag}:void 0;return gapi.client.request({path:`https://www.googleapis.com/youtube/v3${e}`,params:t,headers:r}).then((e=>po(this,void 0,void 0,(function*(){const{result:t,status:r,statusText:i}=e;if(t)return t;if(304===r&&n)return n;throw Error(i||`Error (${r})`)}))))}))}getFromCache(e){return po(this,void 0,void 0,(function*(){return fo.fetch(e)}))}saveToCache(e,t){return po(this,void 0,void 0,(function*(){this.config.noCache||(yield fo.store(e,t))}))}createCacheKey(e,t,n){const{fields:r}=t,i=vo(t,["fields"]);return`${e}?${new URLSearchParams(i)}#${n}`}parseNumber(e){if(null!=e&&!isNaN(Number(e)))return Number(e)}}bo.minPageSize=5,bo.maxPageSize=50,bo.videoFields="items(id,snippet(title,thumbnails,channelId,channelTitle),contentDetails(duration),statistics(viewCount,likeCount))",bo.playlistFields="items(id,snippet(title,thumbnails,channelId,channelTitle),contentDetails(itemCount))";const go=bo;var yo=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::youtube");const wo="https://www.youtube.com",Eo={view:"card",fields:["Thumbnail","Title","Duration","Owner","Views"]},xo={id:"youtube/likes",title:"Likes",icon:"thumbs-up",itemType:Yn.Media,viewType:Wn.Ratings,layout:Eo,defaultHidden:!0,search:()=>new go("/videos",{myRating:"like",part:"snippet,contentDetails,statistics",fields:go.videoFields})},ko={id:"youtube/playlists",title:"Playlists",icon:"playlist",itemType:Yn.Playlist,secondaryLayout:Eo,search:()=>new go("/playlists",{mine:"true",part:"snippet,contentDetails",fields:go.playlistFields})};function So(e=""){if(e.startsWith("youtube:"))return e;const t=eo()(e);if(t)return`youtube:video:${t}`;if(/youtu\.?be/.test(e)){const t=new URLSearchParams(new URL(e).search).get("list")||"";if(t)return`youtube:playlist:${t}`}return""}function Co(e){return`${wo}/watch?v=${e}`}function Po(e){return yo(this,void 0,void 0,(function*(){const t=Co(e),n=yield fetch(`${wo}/oembed?url=${t}&format=json`);if(!n.ok)switch(n.status){case 401:throw Error("Embedding prevented by channel owner.");case 403:throw Error("Private video.");case 404:throw Error("Video does not exist.");default:throw Error(`${n.statusText} (${n.status})`)}const r=yield n.json();return{itemType:Yn.Media,mediaType:Nr.Video,src:`youtube:video:${e}`,externalUrl:t,title:r.title,aspectRatio:r.width/r.height||16/9,duration:0,track:0,thumbnails:[{url:r.thumbnail_url,width:r.thumbnail_width,height:r.thumbnail_height}],owner:{name:r.author_name,url:r.author_url},playedAt:0}}))}const To={id:"youtube",name:"YouTube",icon:"youtube",url:"https://www.youtube.com",defaultNoScrobble:!0,roots:[{id:"youtube/search/videos",title:"Video",icon:"",itemType:Yn.Media,layout:Eo,searchable:!0,search:({q:e=""}={})=>e?new go("/search",{q:e,type:"video",videoCategoryId:"10",part:"id",fields:"items(id(videoId))"},{maxSize:go.maxPageSize,noCache:!0}):new fr}],sources:[xo,ko],canRate:()=>!1,canStore:()=>!1,compareForRating:()=>!1,createSourceFromPin:function(e){return{title:e.title,itemType:Yn.Playlist,id:e.src,icon:"pin",isPin:!0,secondaryLayout:Object.assign(Object.assign({},Eo),{view:"card compact"}),search(){const[,,t]=e.src.split(":");return new go("/playlists",{id:t,part:"snippet,contentDetails",fields:go.playlistFields})}}},observeIsLoggedIn:function(){return oo.pipe(er()).pipe(Xt((e=>""!==e)),er())},isLoggedIn:so,login:function(){return no(this,void 0,void 0,(function*(){if(!so())try{const e=yield function(){return no(this,void 0,void 0,(function*(){const e=yield co();return new Promise(((t,n)=>{e.initTokenClient({client_id:wr,scope:io,callback:e=>{e.error?n(e.error_description):(oo.next(e.access_token),t(e.access_token))}}).requestAccessToken()}))}))}();ro.log("Access token successfully obtained."),oo.next(e)}catch(e){ro.log("Could not obtain access token."),ro.error(e)}}))},logout:function(){return no(this,void 0,void 0,(function*(){const e=lo();e&&(yield co()).revoke(e,(()=>oo.next("")))}))}},Ao=To;const Io=new A("ListenBrainzHistoryPager");class Oo{constructor(e,t=!1){this.fetchListenCount=t,this.size$=new jr(1),this.nextPageParams=void 0,this.pager=new Vr(((t=50)=>{return n=this,r=void 0,a=function*(){try{const{payload:n}=yield Ba.get(`user/${Da.userId}/listens`,Object.assign(Object.assign(Object.assign({},e),{count:t}),this.nextPageParams)),r=n.listens,i=this.createItems(r),a=i.length<t;return this.nextPageParams=a?void 0:{max_ts:r.at(-1).listened_at-1},{items:i,atEnd:a}}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{l(a.next(e))}catch(e){t(e)}}function s(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(o,s)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.size$.pipe(er())}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new ne,this.subscriptions.add(this.pager.observeAdditions().pipe(Zt((e=>Ba.addRatings(e)))).subscribe(Io)),this.fetchListenCount&&this.subscriptions.add(vn(Ba.getListenCount()).pipe($e((e=>this.size$.next(e)))).subscribe(Io)))}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){var t,n,r;const i=e.track_metadata,a=i.additional_info,o=(null===(t=i.mbid_mapping)||void 0===t?void 0:t.recording_mbid)||void 0,s=this.getPlayableSrc(a)||"";return{itemType:Yn.Media,mediaType:s.startsWith("youtube:")?Nr.Video:Nr.Audio,src:`listenbrainz:listen:${e.listened_at}`,title:i.track_name,addedAt:e.inserted_at,artists:i.artist_name?[i.artist_name]:void 0,albumArtist:null==a?void 0:a.release_artist_name,album:i.release_name,duration:(null==a?void 0:a.duration)||((null==a?void 0:a.duration_ms)?Math.round(a.duration_ms/1e3):0),track:(null==a?void 0:a.tracknumber)||(null==a?void 0:a.track_number),disc:null==a?void 0:a.discnumber,isrc:null==a?void 0:a.isrc,externalUrl:o?`${to}/recording/${o}`:void 0,recording_mbid:o,recording_msid:e.recording_msid||void 0,release_mbid:null===(n=i.mbid_mapping)||void 0===n?void 0:n.release_mbid,artist_mbids:null===(r=i.mbid_mapping)||void 0===r?void 0:r.artist_mbids,playedAt:e.listened_at,link:{src:s,externalUrl:this.getExternalUrl(null==a?void 0:a.origin_url)}}}getExternalUrl(e){if(e&&/youtu\.?be/.test(e)){const t=eo()(e);if(t)return Co(t)}return e||void 0}getPlayableSrc(e){var t;if(e){if(e.spotify_id)return this.getSpotifySrc(e.spotify_id);const n=e.origin_url;if(n){if(n.includes("apple.com"))return this.getAppleSrc(n);if(n.includes("spotify.com"))return this.getSpotifySrc(n);if(/youtu\.?be/.test(n))return So(n)}const r=(null===(t=e.music_service_name)||void 0===t?void 0:t.toLowerCase())||"",i="jellyfin|spotify|youtube|apple|plex".split("|");for(const e of i)if(r.includes(e))return`${e}:`}}getAppleSrc(e){if(e){const t=e.split("i=").pop();if(t)return`apple:song:${t}`}}getSpotifySrc(e){if(e){const t=e.split("/").pop();if(t)return`spotify:track:${t}`}}isNoContentError(e){return 204===(null==e?void 0:e.status)}}Oo.maxPageSize=100;const Mo=Oo;class No{constructor(){let e=0;this.pager=new Vr(((t=50)=>{return n=this,r=void 0,a=function*(){try{const n=yield Ba.get(`feedback/user/${Da.userId}/get-feedback`,{score:1,metadata:!0,offset:e,count:t});e+=t;const r=this.createItems(n.feedback),i=n.total_count;return{items:r,total:i,atEnd:n.offset+r.length>=i}}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{l(a.next(e))}catch(e){t(e)}}function s(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(o,s)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems(e){return e.map((e=>this.createItem(e)))}createItem(e){var t,n;const r=e.track_metadata,i=r.additional_info,a=e.recording_mbid;return{itemType:Yn.Media,mediaType:Nr.Audio,src:`listenbrainz:track:${mi()}`,title:r.track_name,artists:r.artist_name?[r.artist_name]:void 0,albumArtist:null==i?void 0:i.release_artist_name,album:r.release_name,duration:(null==i?void 0:i.duration)||((null==i?void 0:i.duration_ms)?Math.round(i.duration_ms/1e3):0),track:(null==i?void 0:i.tracknumber)||(null==i?void 0:i.track_number),disc:null==i?void 0:i.discnumber,isrc:null==i?void 0:i.isrc,externalUrl:a?`${to}/recording/${a}`:void 0,recording_mbid:a,recording_msid:e.recording_msid||void 0,release_mbid:null===(t=r.mbid_mapping)||void 0===t?void 0:t.release_mbid,artist_mbids:null===(n=r.mbid_mapping)||void 0===n?void 0:n.artist_mbids,playedAt:0,rating:1}}isNoContentError(e){return 204===(null==e?void 0:e.status)}}No.maxPageSize=100;const $o=No;var zo=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::musicbrainzApi");const jo=new class{constructor(){this.host="https://musicbrainz.org/ws/2",this.lastCall=0}getISRCs(e){return zo(this,void 0,void 0,(function*(){return(yield this.get(`/recording/${e}`,{inc:"isrcs"})).isrcs||[]}))}getRecordingsByISRC(e){return zo(this,void 0,void 0,(function*(){return(yield this.get(`/isrc/${e}`)).recordings||[]}))}get(e,t={}){return zo(this,void 0,void 0,(function*(){e.startsWith("/")&&(e=e.slice(1)),t.fmt="json",e=`${e}?${new URLSearchParams(t)}`,yield this.applyRateLimiting(),this.lastCall=Date.now();const n=yield fetch(`${this.host}/${e}`,{method:"GET",headers:{"User-Agent":"ampcast/0.8.12 ( rekky.rosso@gmail.com )"}});if(!n.ok)throw n;return yield n.json()}))}applyRateLimiting(){return new Promise((e=>{const t=Date.now()-this.lastCall;t>1e3?e():setTimeout((()=>e),t)}))}};class Lo{constructor(e,t){this.release_mbid=e,this.pager=new Vr((()=>{return n=this,r=void 0,a=function*(){var n;const{media:r=[]}=yield jo.get(`release/${e}`,{inc:"recordings"});return{items:this.createItems((null===(n=r[0])||void 0===n?void 0:n.tracks)||[],t),atEnd:!0}},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{l(a.next(e))}catch(e){t(e)}}function s(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(o,s)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a}))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}createItems(e,t){return e.map((e=>this.createItem(e,t)))}createItem(e,t){const n=e.recording,r=n.id||void 0;return{itemType:Yn.Media,mediaType:Nr.Audio,src:`musicbrainz:track:${r||mi()}`,title:e.title,artists:(null==t?void 0:t.artist)?[t.artist]:void 0,albumArtist:null==t?void 0:t.artist,album:null==t?void 0:t.title,duration:e.length/1e3||0,track:e.number?Number(e.number):void 0,recording_mbid:r,release_mbid:this.release_mbid,year:(null==t?void 0:t.year)||new Date(n["first-release-date"]).getUTCFullYear()||void 0,playedAt:0,externalUrl:r?`https://musicbrainz.org/recording/${r}`:void 0}}}const Ro=new A("ListenBrainzStatsPager");class _o{constructor(e,t){let n=0;this.pager=new Vr(((r=50)=>{return i=this,a=void 0,s=function*(){try{const i=yield Ba.get(e,Object.assign(Object.assign({},t),{offset:n,count:r}));return n+=r,this.createPage(i)}catch(e){if(this.isNoContentError(e))return{items:[],atEnd:!0};throw e}},new((o=void 0)||(o=Promise))((function(e,t){function n(e){try{l(s.next(e))}catch(e){t(e)}}function r(e){try{l(s.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof o?e:new o((function(t){t(e)}))}(t.value).then(n,r)}l((s=s.apply(i,a||[])).next())}));var i,a,o,s}),{pageSize:50})}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new ne,this.subscriptions.add(this.pager.observeAdditions().pipe(Xt((e=>e.filter((e=>e.itemType===Yn.Media)))),ze((e=>e.length>0)),Zt((e=>Ba.addRatings(e)))).subscribe(Ro)))}createPage(e){if(this.isRecordingsResponse(e)){const t=e.payload,n=t.recordings.map((e=>this.createMediaItem(e))),r=t.total_recording_count;return{items:n,total:r,atEnd:t.offset+n.length>=r}}if(this.isReleasesResponse(e)){const t=e.payload,n=t.releases.map((e=>this.createMediaAlbum(e))),r=t.total_release_count;return{items:n,total:r,atEnd:t.offset+n.length>=r}}if(this.isArtistsResponse(e)){const t=e.payload,n=t.artists.map((e=>this.createMediaArtist(e))),r=t.total_artist_count;return{items:n,total:r,atEnd:t.offset+n.length>=r}}throw Error("Unknown response.")}createMediaArtist(e){var t;const n=(null===(t=e.artist_mbids)||void 0===t?void 0:t[0])||void 0;return{itemType:Yn.Artist,src:`listenbrainz:artist:${mi()}`,externalUrl:n?`${to}/artist/${n}`:void 0,title:e.artist_name,artist_mbid:n,playCount:e.listen_count,pager:new fr}}createMediaAlbum(e){const t=e.release_mbid||void 0,n={itemType:Yn.Album,src:`listenbrainz:album:${mi()}`,externalUrl:t?`${to}/release/${t}`:void 0,title:e.release_name,artist:e.artist_name,release_mbid:t,artist_mbids:e.artist_mbids,playCount:e.listen_count};return Object.assign(Object.assign({},n),{pager:t?new Lo(t,n):new fr})}createMediaItem(e){const t=e.recording_mbid||void 0;return{itemType:Yn.Media,mediaType:Nr.Audio,src:`listenbrainz:track:${mi()}`,externalUrl:t?`${to}/recording/${t}`:void 0,title:e.track_name,artists:e.artist_name?[e.artist_name]:void 0,album:e.release_name,duration:0,recording_mbid:t,release_mbid:e.release_mbid||void 0,artist_mbids:e.artist_mbids,playCount:e.listen_count,playedAt:0}}isRecordingsResponse(e){return"total_recording_count"in e.payload}isReleasesResponse(e){return"total_release_count"in e.payload}isArtistsResponse(e){return"total_artist_count"in e.payload}isNoContentError(e){return 204===(null==e?void 0:e.status)}}console.log("module::listenbrainz");const Do={id:"listenbrainz/history",title:"History",icon:"clock",itemType:Yn.Media,defaultHidden:!0,search:({startAt:e=0}={})=>new Mo(e?{max_ts:e}:void 0)},Fo={id:"listenbrainz/recently-played",title:"Recently Played",icon:"clock",itemType:Yn.Media,search:()=>new Mo},Vo={id:"listenbrainz/loved-tracks",title:"Loved Tracks",icon:"heart",itemType:Yn.Media,viewType:Wn.Ratings,defaultHidden:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear"]},search:()=>new $o},Uo={id:"listenbrainz/top/tracks",title:"Top Tracks",icon:"star",itemType:Yn.Media,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","PlayCount"]},search:e=>new _o(`stats/user/${Da.userId}/recordings`,e)},Bo={id:"listenbrainz/top/albums",title:"Top Albums",icon:"star",itemType:Yn.Album,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","Year","PlayCount"]},search:e=>new _o(`stats/user/${Da.userId}/releases`,e)},Ho={id:"listenbrainz/top/artists",title:"Top Artists",icon:"star",itemType:Yn.Artist,layout:{view:"card minimal",fields:["Thumbnail","Title","PlayCount"]},defaultHidden:!0,search:e=>new _o(`stats/user/${Da.userId}/artists`,e)},Yo={id:"listenbrainz",name:"ListenBrainz",icon:"listenbrainz",url:"https://listenbrainz.org",isScrobbler:!0,roots:[Fo],sources:[Uo,Bo,Ho,Do,Vo],labels:{[Bn.Like]:"Love on ListenBrainz",[Bn.Unlike]:"Unlove on ListenBrainz"},canRate:Wo,canStore:()=>!1,compareForRating:qo,rate:function(e,t){return n=this,r=void 0,a=function*(){Wo(e)&&(yield Ba.rate(e,t))},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{l(a.next(e))}catch(e){t(e)}}function s(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(o,s)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a},observeIsLoggedIn:Ga,isLoggedIn:Xa,login:function(){return qa(this,void 0,void 0,(function*(){if(!Xa())try{const e=yield function(){return Ka(this,void 0,void 0,(function*(){return Si(Wa,!0)}))}();if(e){const{userId:t,token:n}=JSON.parse(e);Da.userId=t,Da.token=n,Ja.log("Access token successfully obtained."),Qa.next(n)}}catch(e){Ja.log("Could not obtain access token."),Ja.error(e)}}))},logout:function(){return qa(this,void 0,void 0,(function*(){Qa.next(""),Da.clear()}))}},Ko=Yo;function Wo(e){return e.itemType===Yn.Media&&!(!e.recording_mbid&&!e.recording_msid)}function qo(e,t){return e.itemType===Yn.Media&&e.itemType===t.itemType&&(!!e.recording_mbid&&e.recording_mbid===t.recording_mbid||!!e.recording_msid&&e.recording_msid===t.recording_msid)}dr.addObserver(Yo,5);const Jo=new z("plex"),Qo={get clientId(){let e=Jo.getString("clientId");return e||(e=mi(),Jo.setString("clientId",e)),e},get connection(){return Jo.getJson("connection")},set connection(e){Jo.setJson("connection",e)},get host(){var e;return(null===(e=this.connection)||void 0===e?void 0:e.uri)||""},get libraryId(){return Jo.getString("libraryId")},set libraryId(e){Jo.setString("libraryId",e)},get server(){return Jo.getJson("server")},set server(e){Jo.setJson("server",e)},get serverToken(){var e;return(null===(e=this.server)||void 0===e?void 0:e.accessToken)||""},get userToken(){return Jo.getString("userToken")},set userToken(e){Jo.setString("userToken",e)},get userId(){return Jo.getString("userId")},set userId(e){Jo.setString("userId",e)},clear(){const e=this.clientId;Jo.clear(),e&&Jo.setString("clientId",e)}};var Xo=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};function Go({host:e=Qo.host,path:t,method:n="GET",params:r,headers:i,body:a,token:o,keepalive:s}){return Xo(this,void 0,void 0,(function*(){if(!e)throw Error("No Plex connection.");(t=r?`${t}?${new URLSearchParams(r)}`:t).startsWith("/")||(t=`/${t}`),o||(o=e===Qo.host?Qo.serverToken:Qo.userToken);const l=yield window.fetch(`${e}${t}`,{method:n,headers:Object.assign(Object.assign({},i),Zo(o)),body:a,keepalive:s});if(!l.ok)throw Error(l.statusText);return l}))}function Zo(e){const t={"X-Plex-Product":"ampcast","X-Plex-Version":"0.8.12","X-Plex-Platform":U.displayName,"X-Plex-Platform-Version":U.version,"X-Plex-Device":U.os,"X-Plex-Device-Name":U.displayName,"X-Plex-Client-Identifier":Qo.clientId,"X-Plex-Model":"hosted","Accept-Encoding":"gzip, deflate, br"};return e&&(t["X-Plex-Token"]=e),t}console.log("module::plexApi");const es={fetch:Go,fetchJSON:function(e){var{headers:t,body:n}=e,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["headers","body"]);return Xo(this,void 0,void 0,(function*(){return t=Object.assign(Object.assign({},t),{Accept:"application/json"}),n&&(t=Object.assign(Object.assign({},t),{"Content-Type":"application/json"}),n=JSON.stringify(n)),(yield Go(Object.assign({headers:t,body:n},r))).json()}))},getPlayableUrlFromSrc:function(e){const{host:t,serverToken:n}=Qo;if(t&&n){const[,,r]=e.split(":");return`${t}${r}?X-Plex-Token=${n}`}throw Error("Not logged in.")}},ts=es;var ns=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::plexAuth");const rs=new A("plexAuth"),is="https://plex.tv/api/v2",as=new Ie(""),os=new Ie(!1);let ss;function ls(){return""!==as.getValue()}function cs(){return as.pipe(er()).pipe(Xt((e=>""!==e)),er())}function us(e){Qo.userToken=e,e&&rs.log("Access token successfully obtained."),as.next(e)}us(Qo.userToken),cs().pipe(ze((e=>e)),$e((()=>ns(void 0,void 0,void 0,(function*(){const e=function(e,t){return ns(this,void 0,void 0,(function*(){try{return yield ts.fetch({host:e.uri,path:"/",method:"HEAD",token:t}),e}catch(e){return null}}))},t=Qo.connection;if(t){if(yield e(t,Qo.serverToken))return rs.log(`Using existing ${t.local?"local":"public"} connection.`),void os.next(!0);Qo.server=null,Qo.connection=null}rs.log("Searching for a connection...");try{const t=(yield function(){return ns(this,void 0,void 0,(function*(){return ts.fetchJSON({host:is,path:"/resources",params:{includeHttps:"1"}})}))}()).filter((e=>"server"===e.provides));for(const n of t){const t=yield Promise.all([...n.connections.map((t=>e(t,n.accessToken)))]),r=t.filter(l);if(r.length){const e=r.find((e=>e.local))||r[0];return Qo.server=n,Qo.connection=e,rs.log(`Using ${e.local?"local":"public"} connection.`),void os.next(!0)}}rs.log("Could not establish a connection.")}catch(e){rs.log(e),us("")}}))))).subscribe(rs),os.pipe(ze((e=>e)),$e((()=>ns(void 0,void 0,void 0,(function*(){rs.log("Connected");const{MediaContainer:{Directory:e}}=yield ts.fetchJSON({path:"/library/sections"}),t=e.find((e=>"artist"===e.type));Qo.libraryId=(null==t?void 0:t.key)||""}))))).subscribe(rs);class ds{constructor(e,t,n,r){var i;this.path=e,this.params=t,this.parent=r,this.pageSize=(null==n?void 0:n.pageSize)||((null===(i=Qo.connection)||void 0===i?void 0:i.local)?ds.maxPageSize:100),this.pager=new Ki((e=>this.fetch(e)),Object.assign({pageSize:this.pageSize},n))}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){this.pager.disconnect()}fetchAt(e,t){this.pager.fetchAt(e,t)}fetch(e){return t=this,n=void 0,i=function*(){const t=yield ts.fetchJSON({path:this.path,params:this.params,headers:{"X-Plex-Container-Size":String(this.pageSize),"X-Plex-Container-Start":String((e-1)*this.pageSize)}}),{MediaContainer:{Metadata:n=[],size:r,totalSize:i}}=t;return{items:n.map((e=>this.createItem(e))),total:i||r}},new((r=void 0)||(r=Promise))((function(e,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(o,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}createItem(e){switch(e.type){case"clip":return this.createMediaItemFromVideo(e);case"album":return this.createMediaAlbum(e);case"artist":return this.createMediaArtist(e);case"playlist":return this.createMediaPlaylist(e);case"track":return this.createMediaItemFromTrack(e);default:return this.createMediaFolder(e)}}createMediaItemFromTrack(e){const[t]=e.Media,[n]=t.Part,r=(e.title||"").trim(),i=!!r,a=i?"[Unknown Album]"===e.parentTitle?void 0:e.parentTitle||void 0:void 0,o=this.getFileName(n.file)||"[Unknown]";return{itemType:Yn.Media,mediaType:Nr.Audio,src:`plex:audio:${n.key}`,externalUrl:this.getExternalUrl(`/library/metadata/${e.parentRatingKey}`),fileName:o,title:r||o.replace(/\.\w+/,""),addedAt:e.addedAt,artists:i?e.originalTitle?[e.originalTitle]:e.grandparentTitle?[e.grandparentTitle]:void 0:void 0,albumArtist:a&&!e.originalTitle?e.grandparentTitle:void 0,album:a,duration:e.duration/1e3,track:a?e.index:void 0,rating:e.userRating||0,year:e.parentYear,playedAt:e.lastViewedAt||0,playCount:e.viewCount,plex:{ratingKey:e.ratingKey},thumbnails:this.createThumbnails(e.thumb)}}createMediaAlbum(e){var t;return{itemType:Yn.Album,src:`plex:album:${e.ratingKey}`,externalUrl:this.getExternalUrl(`/library/metadata/${e.ratingKey}`),title:e.title||"",description:e.summary,addedAt:e.addedAt,artist:e.parentTitle,rating:e.userRating||0,year:e.year,playedAt:e.lastViewedAt,playCount:e.viewCount,genres:null===(t=e.Genre)||void 0===t?void 0:t.map((e=>e.tag)),plex:{ratingKey:e.ratingKey},pager:this.createPager(e.key),thumbnails:this.createThumbnails(e.thumb)}}createMediaArtist(e){var t,n;return{itemType:Yn.Artist,src:`plex:album:${e.ratingKey}`,externalUrl:this.getExternalUrl(`/library/metadata/${e.ratingKey}`),title:e.title,description:e.summary,country:null===(t=e.Country)||void 0===t?void 0:t.map((e=>e.tag)).join(", "),addedAt:e.addedAt,rating:e.userRating||0,genres:null===(n=e.Genre)||void 0===n?void 0:n.map((e=>e.tag)),plex:{ratingKey:e.ratingKey},pager:this.createPager(`/library/sections/${Qo.libraryId}/all`,{"artist.id":e.ratingKey,type:"9",sort:"year:desc,originallyAvailableAt:desc,artist.titleSort:desc,album.titleSort,album.index"}),thumbnails:this.createThumbnails(e.thumb)}}createMediaItemFromVideo(e){const[t]=e.Media,[n]=t.Part;return{itemType:Yn.Media,mediaType:Nr.Video,src:`plex:video:${n.key}`,externalUrl:e.art?this.getExternalUrl(e.art.replace(/\/art\/\d+$/,"")):"",fileName:this.getFileName(n.file),title:e.title||"Video",addedAt:e.addedAt,artists:e.grandparentTitle?[e.grandparentTitle]:void 0,duration:e.duration/1e3,playedAt:e.lastViewedAt||0,playCount:e.viewCount,plex:{ratingKey:e.ratingKey},thumbnails:this.createThumbnails(e.thumb)}}createMediaPlaylist(e){const t=`plex:playlist:${e.key}`;return{itemType:Yn.Playlist,src:t,externalUrl:this.getExternalUrl(`/playlists/${e.ratingKey}`,"playlist"),title:e.title,description:e.summary,addedAt:e.addedAt,duration:e.duration/1e3,playedAt:e.lastViewedAt,playCount:e.viewCount,trackCount:e.leafCount,plex:{ratingKey:e.ratingKey},pager:this.createPager(e.key),thumbnails:this.createThumbnails(e.composite),isPinned:Wr.isPinned(t)}}createMediaFolder(e){var t;const n={itemType:Yn.Folder,src:`plex:folder:${e.key}`,title:e.title,fileName:e.title,path:(null===(t=this.parent)||void 0===t?void 0:t.itemType)===Yn.Folder?`${this.parent.path}/${e.title}`:"/",parent:this.parent};return n.pager=this.createFolderPager(n),n}get webHost(){var e;const t=null===(e=Qo.server)||void 0===e?void 0:e.clientIdentifier;return t?`https://app.plex.tv/desktop/#!/server/${t}`:""}getExternalUrl(e,t="details"){const n=this.webHost;return n?`${n}/${t}?key=${encodeURIComponent(e)}`:""}getFileName(e){return e.split(/[/\\]/).pop()}createThumbnails(e){return e?[this.createThumbnail(e,120),this.createThumbnail(e,240),this.createThumbnail(e,360),this.createThumbnail(e,480)]:void 0}createThumbnail(e,t,n=t){return{url:`${Qo.host}/photo/:/transcode?url=${encodeURIComponent(e)}&width=${t}&height=${n}&minSize=1&upscale=1&X-Plex-Token={plex-token}`,width:t,height:n}}createPager(e,t){return new ds(e,t)}createFolderPager(e){var t;const[,,n]=e.src.split(":"),r=new ds(n,void 0,void 0,e);if((null===(t=this.parent)||void 0===t?void 0:t.itemType)===Yn.Folder){const e=Object.assign(Object.assign({},this.parent),{fileName:`../${this.parent.fileName}`}),t=new fr([e]);return new zr(t,r)}return r}}ds.minPageSize=10,ds.maxPageSize=1e3;const ms=ds;var hs=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::plex");const fs={view:"details",fields:["Index","Artist","Title","Duration","PlayCount","Rate"]},ps={view:"details",fields:["Index","Artist","Title","Album","Track","Duration","PlayCount","Rate"]},vs={id:"plex/video",title:"Music Video",icon:"video",itemType:Yn.Media,searchable:!0,defaultHidden:!0,layout:{view:"details",fields:["Index","Artist","Title","Duration","PlayCount"]},search:({q:e=""}={})=>new ms(`/library/sections/${Qo.libraryId}/extras/all`,{title:e,type:"8",extraType:"4"})},bs={id:"plex/recently-played",title:"Recently Played",icon:"clock",itemType:Yn.Media,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search:()=>new ms(`/library/sections/${Qo.libraryId}/all`,{type:"10","lastViewedAt>":"0",sort:"lastViewedAt:desc"})},gs={id:"plex/most-played",title:"Most Played",icon:"most-played",itemType:Yn.Media,layout:{view:"details",fields:["PlayCount","Artist","Title","Album","Track","Duration","Rate"]},search:()=>new ms(`/library/sections/${Qo.libraryId}/all`,{type:"10","viewCount>":"1",sort:"viewCount:desc,lastViewedAt:desc"})},ys={id:"plex/top-tracks",title:"Top Tracks",icon:"star",itemType:Yn.Media,viewType:Wn.Ratings,layout:{view:"details",fields:["Rate","Artist","Title","Album","Track","Duration","PlayCount"]},search:()=>new ms(`/library/sections/${Qo.libraryId}/all`,{type:"10","track.userRating>":"1",sort:"track.userRating:desc,viewCount:desc,lastViewedAt:desc"})},ws={id:"plex/top-albums",title:"Top Albums",icon:"star",itemType:Yn.Album,viewType:Wn.Ratings,layout:{view:"card compact",fields:["Thumbnail","Title","Artist","Year","Rate"]},secondaryLayout:fs,search:()=>new ms(`/library/sections/${Qo.libraryId}/all`,{type:"9","album.userRating>":"1",sort:"album.userRating:desc,viewCount:desc,lastViewedAt:desc"})},Es={id:"plex/top-artists",title:"Top Artists",icon:"star",itemType:Yn.Artist,viewType:Wn.Ratings,defaultHidden:!0,layout:{view:"card compact",fields:["Thumbnail","Title","Genre","Rate"]},tertiaryLayout:fs,search:()=>new ms(`/library/sections/${Qo.libraryId}/all`,{type:"8","artist.userRating>":"1",sort:"artist.userRating:desc,viewCount:desc,lastViewedAt:desc"})},xs={id:"plex/playlists",title:"Playlists",icon:"playlist",itemType:Yn.Playlist,secondaryLayout:ps,search:()=>new ms("/playlists/all",{type:"15",playlistType:"audio"})},ks={id:"plex/folders",title:"Folders",icon:"folder",itemType:Yn.Folder,defaultHidden:!0,search({key:e=`library/sections/${Qo.libraryId}/folder`}={}){const t={itemType:Yn.Folder,src:"",title:"Folders",fileName:"",path:""};return t.pager=new ms(e,{includeCollections:"1"},void 0,t),t.pager}},Ss={id:"plex",name:"Plex",icon:"plex",url:"https://www.plex.tv",roots:[Ts(Yn.Media,{title:"Songs",layout:{view:"details",fields:["Artist","Title","Album","Track","Duration","PlayCount","Rate"]}}),Ts(Yn.Album,{title:"Albums"}),Ts(Yn.Artist,{title:"Artists"}),Ts(Yn.Playlist,{title:"Playlists",secondaryLayout:ps})],sources:[ys,ws,Es,gs,bs,xs,vs,ks],canRate:Ps,canStore:()=>!1,compareForRating:function(e,t){return e.plex.ratingKey===t.plex.ratingKey},createSourceFromPin:function(e){return{title:e.title,itemType:Yn.Playlist,id:e.src,icon:"pin",isPin:!0,search:()=>new ms(`/playlists/${e.plex.ratingKey}`,{type:"15",playlistType:"audio"})}},getMetadata:function(e){return hs(this,void 0,void 0,(function*(){if(!Ps(e)||void 0!==e.rating)return e;const t=dr.get(e);if(void 0!==t)return Object.assign(Object.assign({},e),{rating:t});const n=e.itemType===Yn.Playlist?`/playlists/${e.plex.ratingKey}`:`/library/metadata/${e.plex.ratingKey}`,r=new ms(n,void 0,{pageSize:1,maxSize:1}),i=yield hr(r,{timeout:2e3});return x(e,i[0])}))},lookup:function(e,t,n=10,r){return hs(this,void 0,void 0,(function*(){if(!e||!t)return[];const i={pageSize:n,maxSize:n,lookup:!0},a=e=>hs(this,void 0,void 0,(function*(){return hr(As(Yn.Media,t,e,i),{timeout:r})}));return h((yield Promise.all([a({"artist.title":e}),a({originalTitle:e})])).flat(),"src")}))},rate:function(e,t){return hs(this,void 0,void 0,(function*(){yield ts.fetch({path:"/:/rate",method:"PUT",params:{key:e.plex.ratingKey,identifier:"com.plexapp.plugins.library",rating:t||-1}})}))},observeIsLoggedIn:cs,isLoggedIn:ls,login:function(){return ns(this,void 0,void 0,(function*(){if(!ls())try{const{id:e,authToken:t}=yield function(){return ns(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{const n=location.hostname,r=("localhost"===n?`http://${n}:${location.port}`:`https://${n}`)+"/auth/plex/callback/";let i=null;const a=n=>{if(/(localhost|ampcast)/.test(n.origin)){if(clearInterval(s),window.removeEventListener("message",a,!1),null==i||i.close(),i=null,n.origin!==location.origin)return void t({message:`Origin ${n.origin} does not match ${location.origin}`});let r=10;const o=()=>ns(this,void 0,void 0,(function*(){r--;try{const{authToken:n,id:i}=yield ts.fetchJSON({host:is,path:`/pins/${ss.id}`});n?e({id:i,authToken:n}):r?setTimeout(o,200):t("Timeout.")}catch(e){t(e)}}));o()}};window.addEventListener("message",a,!1);const o=`clientID=${Qo.clientId}&code=${ss.code}&forwardUrl=${encodeURIComponent(r)}&context%5Bdevice%5D%5Bproduct%5D=ampcast`;i=window.open(`https://app.plex.tv/auth#?${o}`,"Plex","popup");const s=setInterval((()=>{(null==i?void 0:i.closed)&&(clearInterval(s),t({message:"access_denied"}))}),500)}))}))}();Qo.userId=e,us(t)}catch(e){rs.log("Could not obtain access token."),rs.error(e)}}))},logout:function(){return ns(this,void 0,void 0,(function*(){os.next(!1),us(""),Qo.clear()}))}},Cs=Ss;function Ps(e,t){if(t)return!1;switch(e.itemType){case Yn.Album:return!e.synthetic;case Yn.Artist:return!0;case Yn.Media:return e.mediaType===Nr.Audio;default:return!1}}function Ts(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`plex/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>As(e,t)})}function As(e,t,n,r){if(t){const i=e===Yn.Playlist?"/playlists/all":`/library/sections/${Qo.libraryId}/all`,a=Object.assign(Object.assign({},n),{title:t,sort:"titleSort:asc"});switch(e){case Yn.Media:a.type="10";break;case Yn.Album:a.type="9";break;case Yn.Artist:a.type="8";break;case Yn.Playlist:a.playlistType="audio",a.type="15"}return new ms(i,a,r)}return new fr}function Is(e){return Oe((function(t,n){var r=!1,i=0;t.subscribe(Me(n,(function(t){return(r||(r=!e(t,i++)))&&n.next(t)})))}))}dr.addObserver(Ss);var Os=n(5754),Ms=n.n(Os),Ns=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::spotifyAuth");const $s=new A("spotifyAuth"),zs=new z("spotify/auth"),js=location.hostname,Ls=("localhost"===js?`http://${js}:${location.port}`:`https://${js}`)+"/auth/spotify/callback/",Rs="https://accounts.spotify.com";let _s;const Ds=new Ie("");function Fs(){return Ds.pipe(er())}function Vs(){return""!==Ds.getValue()}function Us(){return Ns(this,void 0,void 0,(function*(){const e=Hs(),t=null==e?void 0:e.refresh_token;if(t){const e=yield fetch(`${Rs}/api/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:gr,grant_type:"refresh_token",refresh_token:t})});if(!e.ok)throw Ks(),e;const n=yield e.json();return Bs(n),n.access_token}throw Ks(),Error("No 'refresh_token'")}))}function Bs(e){const{access_token:t,refresh_token:n,expires_in:r}=e,i=new Date,a=new Date(i.setSeconds(i.getSeconds()+r)).toISOString();zs.setJson("token",{access_token:t,refresh_token:n,expires_at:a}),Ys(t)}function Hs(){const e=zs.getJson("token");return e&&(e.expires_at=new Date(e.expires_at)),e}function Ys(e){$s.log("Access token successfully obtained."),Ds.next(e)}function Ks(){zs.removeItem("token"),Ds.next("")}function Ws(){return Ns(this,void 0,void 0,(function*(){const e=function(e){let t="";for(let e=0;e<64;e++)t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return t}();zs.setString("code_verifier",e),_s=yield function(e){return Ns(this,void 0,void 0,(function*(){const t=yield crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}))}(e)}))}!function(){Ns(this,void 0,void 0,(function*(){try{const e=Hs();if(e)return void(e.expires_at.getTime()-Date.now()<=0?yield Us():Ys(e.access_token))}catch(e){$s.error(e),Ks()}yield Ws()}))}();var qs=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};const Js=new A("SpotifyPager");class Qs{constructor(e,t,n){this.defaultConfig={minPageSize:Qs.minPageSize,maxPageSize:Qs.maxPageSize,pageSize:Qs.maxPageSize},this.pageNumber=1,this.config=Object.assign(Object.assign({},this.defaultConfig),t),this.pager=new Vr(((t=this.defaultConfig.pageSize)=>qs(this,void 0,void 0,(function*(){const r=(this.pageNumber-1)*t,i=()=>qs(this,void 0,void 0,(function*(){const{items:i,total:a,next:o}=yield e(r,t);return this.pageNumber++,{items:i.map((e=>this.createMediaObject(e,n))),total:a,atEnd:!o}}));try{return yield i()}catch(e){if(401===e.status)return yield Us(),yield i();throw e}}))),this.config)}get maxSize(){return this.pager.maxSize}observeItems(){return this.pager.observeItems()}observeSize(){return this.pager.observeSize()}observeError(){return this.pager.observeError()}disconnect(){var e;this.pager.disconnect(),null===(e=this.subscriptions)||void 0===e||e.unsubscribe()}fetchAt(e,t){this.subscriptions||this.connect(),this.pager.fetchAt(e,t)}connect(){this.subscriptions||(this.subscriptions=new ne,this.config.lookup||this.subscriptions.add(this.pager.observeAdditions().pipe(Zt((e=>this.addInLibrary(e)))).subscribe(Js)))}createMediaObject(e,t){switch(e.type){case"episode":return this.createMediaItemFromEpisode(e);case"artist":return this.createMediaArtist(e);case"album":return this.createMediaAlbum(e,t);case"playlist":return this.createMediaPlaylist(e,t);case"track":return this.createMediaItemFromTrack(e,t)}}createMediaItemFromEpisode(e){return{itemType:Yn.Media,mediaType:Nr.Audio,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,duration:e.duration_ms/1e3,thumbnails:e.images,unplayable:!1===e.is_playable,playedAt:e.played_at?Math.floor((new Date(e.played_at).getTime()||0)/1e3):0}}createMediaAlbum(e,t){var n;return{itemType:Yn.Album,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,artist:e.artists.map((e=>e.name)).join(", "),year:new Date(e.release_date).getFullYear(),thumbnails:e.images,trackCount:null===(n=e.tracks)||void 0===n?void 0:n.total,pager:this.createAlbumPager(e),inLibrary:or.get(e.uri,t)}}createMediaArtist(e){return{itemType:Yn.Artist,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,genres:e.genres,thumbnails:e.images,pager:this.createArtistAlbumsPager(e)}}createArtistTopTracks(e){return{itemType:Yn.Album,src:`spotify:top-tracks:${e.id}`,title:"Top Tracks",artist:e.name,thumbnails:e.images,pager:this.createTopTracksPager(e),synthetic:!0}}createMediaPlaylist(e,t){const n=e.owner.id===el.getString("userId");return{itemType:Yn.Playlist,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,description:e.description?P(e.description):void 0,thumbnails:e.images,trackCount:e.tracks.total,pager:this.createPlaylistPager(e),owner:{name:e.owner.display_name||"",url:e.owner.external_urls.spotify},isPinned:Wr.isPinned(e.uri),isOwn:n,inLibrary:!n&&or.get(e.uri,t)}}createMediaItemFromTrack(e,t){var n,r,i,a,o;const s=/album|compilation/i.test((null===(n=e.album)||void 0===n?void 0:n.album_type)||"")?e.album:void 0;return{itemType:Yn.Media,mediaType:Nr.Audio,src:e.uri,externalUrl:e.external_urls.spotify,title:e.name,artists:null===(r=e.artists)||void 0===r?void 0:r.map((e=>e.name)),albumArtist:null==s?void 0:s.artists.map((e=>e.name)).join(", "),album:null==s?void 0:s.name,duration:e.duration_ms/1e3,playedAt:e.played_at?Math.floor((new Date(e.played_at).getTime()||0)/1e3):0,genres:null===(i=e.album)||void 0===i?void 0:i.genres,disc:s?e.disc_number:void 0,track:s?e.track_number:void 0,year:e.album&&new Date(e.album.release_date).getUTCFullYear()||void 0,isrc:null===(a=e.external_ids)||void 0===a?void 0:a.isrc,thumbnails:null===(o=e.album)||void 0===o?void 0:o.images,unplayable:!1===e.is_playable,inLibrary:or.get(e.uri,t)}}createArtistAlbumsPager(e){const t=this.getMarket(),n=this.createArtistTopTracks(e),r=new Ur((()=>[n])),i=new Qs(((n,r)=>qs(this,void 0,void 0,(function*(){const{items:i,total:a,next:o}=yield tl.getArtistAlbums(e.id,{offset:n,limit:r,market:t,include_groups:"album,compilation,single"});return{items:i,total:a,next:o}}))));return r.fetchAt(0),new zr(r,i)}createTopTracksPager(e){const t=this.getMarket();return new Qs(((n,r)=>qs(this,void 0,void 0,(function*(){const{tracks:i}=yield tl.getArtistTopTracks(e.id,t,{offset:n,limit:r,market:t});return{items:i,next:""}}))))}createAlbumPager(e){var t;const n=null===(t=e.tracks)||void 0===t?void 0:t.items;if(n&&n.length===e.total_tracks)return new Ur((()=>{const t=n.map((t=>this.createMediaItemFromTrack(Object.assign(Object.assign({},t),{album:e}))));return this.addInLibrary(t),t}));{const t=this.getMarket();return new Qs(((n,r)=>qs(this,void 0,void 0,(function*(){const{items:i,total:a,next:o}=yield tl.getAlbumTracks(e.id,{offset:n,limit:r,market:t});return{items:i.map((t=>Object.assign(Object.assign({},t),{album:e}))),total:a,next:o}}))))}}createPlaylistPager(e){var t;const n=null===(t=e.tracks)||void 0===t?void 0:t.items;if(n&&n.length===e.tracks.total)return new Ur((()=>{const e=n.filter((e=>!!e.track)).map((e=>this.createMediaItemFromTrack(e.track)));return this.addInLibrary(e),e}));{const t=this.getMarket();return new Qs(((n,r)=>qs(this,void 0,void 0,(function*(){const{items:i,total:a,next:o}=yield tl.getPlaylistTracks(e.id,{offset:n,limit:r,market:t});return{items:i.map((e=>e.track)).filter(l),total:a,next:o}}))))}}getMarket(){return el.getString("market")}addInLibrary(e){return qs(this,void 0,void 0,(function*(){const t=e[0];if(t){const n=e.filter((e=>void 0===e.inLibrary&&ml.canStore(e,!0))).map((e=>{const[,,t]=e.src.split(":");return t}));if(0===n.length)return;let r=[];r=t.itemType===Yn.Album?yield tl.containsMySavedAlbums(n):yield tl.containsMySavedTracks(n),rr.dispatch(e.map((({src:e},t)=>({match:t=>t.src===e,values:{inLibrary:r[t]}}))))}}))}}Qs.minPageSize=10,Qs.maxPageSize=50;const Xs=Qs;var Gs=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::spotify");const Zs=new A("spotify"),el=new z("spotify"),tl=new(Ms()),nl={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]},rl={view:"details",fields:["Index","Artist","Title","Album","Track","Duration"]},il={id:"spotify/recently-played",title:"Recently Played",icon:"clock",itemType:Yn.Media,defaultHidden:!0,layout:{view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]},search(){return new Xs(((e,t)=>Gs(this,void 0,void 0,(function*(){const{items:e,total:n}=yield tl.getMyRecentlyPlayedTracks({limit:t});return{items:e.map((e=>Object.assign({played_at:e.played_at},e.track))),total:n,next:void 0}}))),{maxSize:50,pageSize:50})}},al={id:"spotify/top-tracks",title:"Top Tracks",icon:"star",itemType:Yn.Media,layout:nl,search(){return new Xs(((e,t)=>Gs(this,void 0,void 0,(function*(){return tl.getMyTopTracks({offset:e,limit:t})}))))}},ol={id:"spotify/top-artists",title:"Top Artists",icon:"star",itemType:Yn.Artist,defaultHidden:!0,search(){return new Xs(((e,t)=>Gs(this,void 0,void 0,(function*(){return tl.getMyTopArtists({offset:e,limit:t})}))))}},sl={id:"spotify/liked-songs",title:"My Songs",icon:"heart",itemType:Yn.Media,viewType:Wn.Library,layout:nl,search(){const e=bl();return new Xs(((t,n)=>Gs(this,void 0,void 0,(function*(){const{items:r,total:i,next:a}=yield tl.getMySavedTracks({offset:t,limit:n,market:e});return{items:r.map((e=>e.track)),total:i,next:a}}))),void 0,!0)}},ll={id:"spotify/liked-albums",title:"My Albums",icon:"heart",itemType:Yn.Album,viewType:Wn.Library,search(){const e=bl();return new Xs(((t,n)=>Gs(this,void 0,void 0,(function*(){const{items:r,total:i,next:a}=yield tl.getMySavedAlbums({offset:t,limit:n,market:e});return{items:r.map((e=>e.album)),total:i,next:a}}))),{calculatePageSize:!0},!0)}},cl={id:"spotify/playlists",title:"Playlists",icon:"playlist",itemType:Yn.Playlist,viewType:Wn.Library,secondaryLayout:rl,search(){const e=bl();return new Xs(((t,n)=>Gs(this,void 0,void 0,(function*(){const{items:r,total:i,next:a}=yield tl.getUserPlaylists(void 0,{offset:t,limit:n,market:e});return{items:r,total:i,next:a}}))),void 0,!0)}},ul={id:"spotify/featured-playlists",title:"Featured Playlists",icon:"playlist",itemType:Yn.Playlist,defaultHidden:!0,secondaryLayout:rl,search(){const e=bl();return new Xs(((t,n)=>Gs(this,void 0,void 0,(function*(){const{playlists:{items:r,total:i,next:a}}=yield tl.getFeaturedPlaylists({offset:t,limit:n,market:e});return{items:r,total:i,next:a}}))))}},dl={id:"spotify",name:"Spotify",icon:"spotify",url:"https://www.spotify.com",roots:[pl(Yn.Media,{title:"Songs",layout:nl}),pl(Yn.Album,{title:"Albums"}),pl(Yn.Artist,{title:"Artists"}),pl(Yn.Playlist,{title:"Playlists",secondaryLayout:rl})],sources:[sl,ll,il,al,ol,cl,ul],icons:{[Bn.AddToLibrary]:"heart",[Bn.RemoveFromLibrary]:"heart-fill"},labels:{[Bn.AddToLibrary]:"Add to Spotify Library",[Bn.RemoveFromLibrary]:"Remove from Spotify Library"},canRate:()=>!1,canStore:hl,compareForRating:function(e,t){return e.src===t.src},createSourceFromPin:function(e){return{title:e.title,itemType:Yn.Playlist,id:e.src,icon:"pin",isPin:!0,search(){const[,,t]=e.src.split(":"),n=bl();return new Xs((()=>Gs(this,void 0,void 0,(function*(){return{items:[yield tl.getPlaylist(t,{market:n,fields:"id,type,external_urls,name,description,images,owner,uri,tracks.total"})],total:1}}))))}}},getMetadata:function(e){return Gs(this,void 0,void 0,(function*(){if(!hl(e)||void 0!==e.inLibrary)return e;const t=or.get(e.src);if(void 0!==t)return Object.assign(Object.assign({},e),{inLibrary:t});const[,,n]=e.src.split(":");switch(e.itemType){case Yn.Album:{const[t]=yield tl.containsMySavedAlbums([n]);return Object.assign(Object.assign({},e),{inLibrary:t})}case Yn.Media:{const[t]=yield tl.containsMySavedTracks([n]);return Object.assign(Object.assign({},e),{inLibrary:t})}case Yn.Playlist:{const[t]=yield tl.areFollowingPlaylist(n,[el.getString("userId")]);return Object.assign(Object.assign({},e),{inLibrary:t})}default:return e}}))},lookup:function(e,t,n=10,r){return Gs(this,void 0,void 0,(function*(){if(!e||!t)return[];const i=e=>e.replace(/['"]/g," "),a={pageSize:n,maxSize:n,lookup:!0};return hr(vl(Yn.Media,`${i(e)} ${i(t)}`,a),{timeout:r})}))},store:function(e,t){return Gs(this,void 0,void 0,(function*(){return fl([e],t)}))},observeIsLoggedIn:function(){return Fs().pipe(Xt((e=>""!==e)),er())},isLoggedIn:Vs,login:function(){return Ns(this,void 0,void 0,(function*(){if(!Vs())try{Bs(yield function(){return Ns(this,void 0,void 0,(function*(){return new Promise(((e,t)=>{let n=null;const r=i=>{if(/(localhost|ampcast)/.test(i.origin)){if(clearInterval(a),window.removeEventListener("message",r,!1),null==n||n.close(),n=null,i.origin!==location.origin)return void t({message:`Origin ${i.origin} does not match ${location.origin}`});(function(e){return Ns(this,void 0,void 0,(function*(){const t=zs.getString("code_verifier"),n=yield fetch(`${Rs}/api/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},body:new URLSearchParams({client_id:gr,grant_type:"authorization_code",code:e,redirect_uri:Ls,code_verifier:t})});if(!n.ok)throw n;return yield n.json()}))})(i.data.code).then(e,t)}};window.addEventListener("message",r,!1);const i=new URLSearchParams({client_id:gr,scope:["user-read-recently-played","user-read-playback-position","user-top-read","user-read-playback-state","user-modify-playback-state","user-read-currently-playing","streaming","user-read-email","user-read-private","playlist-read-private","playlist-modify-private","playlist-modify-public","user-library-read","user-library-modify"].join(" "),redirect_uri:Ls,response_type:"code",code_challenge_method:"S256",code_challenge:_s});n=window.open(`${Rs}/authorize?${i}`,"Spotify","popup");const a=setInterval((()=>{(null==n?void 0:n.closed)&&(clearInterval(a),t({message:"access_denied"}))}),500)}))}))}())}catch(e){$s.log("Could not obtain access token."),$s.error(e)}}))},logout:function(){return Ns(this,void 0,void 0,(function*(){Ks(),yield Ws()}))}},ml=dl;function hl(e,t){switch(e.itemType){case Yn.Album:return!e.synthetic;case Yn.Media:return!0;case Yn.Playlist:return!e.isOwn&&!t;default:return!1}}function fl(e,t){return Gs(this,void 0,void 0,(function*(){const n=e[0];if(!n)return;const r=e.map((e=>{const[,,t]=e.src.split(":");return t})),i=()=>Gs(this,void 0,void 0,(function*(){switch(n.itemType){case Yn.Album:t?yield Promise.all(u(r,20).map((e=>tl.addToMySavedAlbums(e)))):yield Promise.all(u(r,20).map((e=>tl.removeFromMySavedAlbums(e))));break;case Yn.Media:t?yield Promise.all(u(r,50).map((e=>tl.addToMySavedTracks(e)))):yield Promise.all(u(r,50).map((e=>tl.removeFromMySavedTracks(e))));break;case Yn.Playlist:t?yield Promise.all(r.map((e=>tl.followPlaylist(e)))):yield Promise.all(r.map((e=>tl.unfollowPlaylist(e))))}}));try{yield i()}catch(e){if(401!==e.status)throw e;yield Us(),yield i()}}))}function pl(e,t){return Object.assign(Object.assign({},t),{itemType:e,id:`spotify/search/${t.title.toLowerCase()}`,icon:"search",searchable:!0,search:({q:t=""}={})=>vl(e,t)})}function vl(e,t,n){return t?new Xs(function(e,t){const n=bl();switch(e){case Yn.Media:return(e,r)=>Gs(this,void 0,void 0,(function*(){const{tracks:{items:i,total:a,next:o}}=yield tl.searchTracks(t,{offset:e,limit:r,market:n});return{items:i,total:a,next:o}}));case Yn.Album:return(e,r)=>Gs(this,void 0,void 0,(function*(){const{albums:{items:i,total:a,next:o}}=yield tl.searchAlbums(t,{offset:e,limit:r,market:n});return{items:i,total:a,next:o}}));case Yn.Artist:return(e,r)=>Gs(this,void 0,void 0,(function*(){const{artists:{items:i,total:a,next:o}}=yield tl.searchArtists(t,{offset:e,limit:r,market:n});return{items:i,total:a,next:o}}));case Yn.Playlist:return(e,r)=>Gs(this,void 0,void 0,(function*(){const{playlists:{items:i,total:a,next:o}}=yield tl.searchPlaylists(t,{offset:e,limit:r,market:n});return{items:i,total:a,next:o}}));default:throw TypeError("Fetch not supported for this type of media.")}}(e,t),Object.assign({maxSize:250},n)):new fr}function bl(){return el.getString("market")}Fs().subscribe((e=>tl.setAccessToken(e))),bl()||Fs().pipe(Is((e=>!e)),Zt((()=>tl.getMe())),$e((e=>{el.setString("userId",e.id),el.setString("market",e.country)})),mr(1)).subscribe(Zs),or.observeRemovals("spotify").pipe(Xt((e=>{var t;switch(null===(t=e[0])||void 0===t?void 0:t.itemType){case Yn.Media:return e.slice(0,500);case Yn.Album:return e.slice(0,200);case Yn.Playlist:return e.slice(0,10);default:return[]}})),ze((e=>e.length>0)),sr((e=>fl(e,!1).then((()=>e)))),sr((e=>or.applyRemovals(e))),lr((e=>(Zs.error(e),[])))).subscribe(Zs);var gl=Z((function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}}));function yl(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=dn(e);return Oe((function(t,r){for(var i=e.length,a=new Array(i),o=e.map((function(){return!1})),s=!1,l=function(t){Jt(e[t]).subscribe(Me(r,(function(e){a[t]=e,s||o[t]||(o[t]=!0,(s=o.every(ke))&&(o=null))}),ce))},c=0;c<i;c++)l(c);t.subscribe(Me(r,(function(e){if(s){var t=Q([e],J(a));r.next(n?n.apply(void 0,Q([],J(t))):t)}})))}))}function wl(e){return ze((function(t,n){return e<=n}))}function El(e,t){return t?function(n){return gn(t.pipe(mr(1),Oe((function(e,t){e.subscribe(Me(t,ce))}))),n.pipe(El(e)))}:Zt((function(t,n){return Jt(e(t,n)).pipe(mr(1),function(e){return Xt((function(){return e}))}(t))}))}function xl(e,t){void 0===t&&(t=zt);var n=Rt(e,t);return El((function(){return n}))}var kl,Sl,Cl,Pl=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))},Tl=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Al=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const Il=new A("SpotifyPlayer"),Ol="Spotify player not connected.",Ml=(e,t)=>e.paused===t.paused&&e.position===t.position;kl=new WeakMap,Sl=new WeakMap,Cl=new WeakMap;const Nl=new class{constructor(e){this.accessToken$=e,this.player=null,this.paused$=new Ie(!0),this.src$=new Ie(""),this.currentTrackSrc$=new Ie(""),this.error$=new Te,this.playerReady$=new Ie(!1),this.playerStarted$=new Ie(!1),this.state$=new Ie(null),this.loadedSrc="",this.isLoggedIn=!1,this.deviceId="",this.hidden=!0,this.loop=!1,kl.set(this,!1),Sl.set(this,!0),Cl.set(this,1),this.onSpotifyWebPlaybackSDKReady=()=>{Il.log("onSpotifyWebPlaybackSDKReady"),this.observeAccessToken().pipe(ze((e=>""!==e)),Zt((e=>this.connect(e))),$e((()=>this.playerReady$.next(!0))),mr(1)).subscribe(Il)},window.onSpotifyWebPlaybackSDKReady=this.onSpotifyWebPlaybackSDKReady,this.observeReady().pipe($e((()=>this.player.activateElement())),mr(1)).subscribe(Il),this.observeReady().pipe(yn((()=>this.observeIsLoggedIn())),yn((e=>e?this.observePaused():cn)),yn((e=>e?cn:this.observeSrc())),yl(this.observeAccessToken()),yn((([e,t])=>e&&e!==this.loadedSrc?Pn(void 0).pipe(yn((()=>this.loadError?this.reconnect(t):Pn(void 0))),Zt((()=>this.addToQueue(e,t))),lr((t=>(this.loadedSrc="",this.loadError={src:e,error:t},this.error$.next(t),this.currentTrackSrc$.next(""),cn))),mr(1)):cn))).subscribe(Il),this.observeSrc().subscribe((()=>this.currentTrackSrc$.next(""))),this.observeState().pipe($e((e=>{var t,n;const r=null===(n=null===(t=e.track_window)||void 0===t?void 0:t.current_track)||void 0===n?void 0:n.uri;r&&this.loadedSrc===this.src&&this.currentTrackSrc!==r&&this.currentTrackSrc$.next(r)}))).subscribe(Il),this.currentTrackSrc$.pipe(ze((e=>!!e)),yn((()=>this.observeCurrentTrackState().pipe(wl(2),Zt((e=>!e.paused&&this.paused?this.safePause():Pn(void 0))),mr(1))))).subscribe(Il),this.observeIsLoggedIn().pipe(Is((e=>e===this.isLoggedIn)),$e((e=>{this.isLoggedIn=e,e||this.paused||this.error$.next(Error(Ol))}))).subscribe(Il),this.observeError().subscribe(Il.error),c("https://sdk.scdn.co/spotify-player.js")}get autoplay(){return Tl(this,kl,"f")}set autoplay(e){Tl(this,kl,"f")!==e&&(Al(this,kl,e,"f"),e&&this.playerStarted$.next(!0))}get muted(){return Tl(this,Sl,"f")}set muted(e){Tl(this,Sl,"f")!==e&&(Al(this,Sl,e,"f"),this.safeVolume(e?0:this.volume))}get volume(){return Tl(this,Cl,"f")}set volume(e){Tl(this,Cl,"f")!==e&&(Al(this,Cl,e,"f"),this.safeVolume(this.muted?0:e))}observeCurrentTime(){return bn(this.observeCurrentTrackState(),this.observePaused().pipe(yn((e=>e?this.getCurrentState():_t(250).pipe(Zt((()=>this.getCurrentState()))))))).pipe(Xt((e=>{var t,n;return(null===(n=null===(t=null==e?void 0:e.track_window)||void 0===t?void 0:t.current_track)||void 0===n?void 0:n.uri)===this.currentTrackSrc?e.position/1e3:0})),er())}observeDuration(){return this.observeCurrentTrackState().pipe(Xt((e=>e.duration/1e3)),er())}observeEnded(){return this.observePlaying().pipe(yn((()=>this.observeCurrentTrackState())),er(Ml),yl(this.observePaused()),Xt((([e,t])=>!t&&e.paused&&0===e.position)),ze((e=>e)),Xt((()=>{})))}observeError(){return this.error$}observePlaying(){return this.observeCurrentTrackState().pipe(er(Ml),yl(this.observePaused()),Xt((([e,t])=>!t&&!e.paused)),er(),ze((e=>e)),Xt((()=>{})))}observeCurrentTrackState(){return this.observeState().pipe(ze((e=>{var t,n;return(null===(n=null===(t=e.track_window)||void 0===t?void 0:t.current_track)||void 0===n?void 0:n.uri)===this.currentTrackSrc})))}appendTo(){}load(e){Il.log("load",{src:e}),this.src$.next(e),this.autoplay&&this.paused$.next(!1),this.player&&this.isLoggedIn?this.autoplay&&e===this.loadedSrc&&this.safePlay():this.autoplay&&this.error$.next(Error(Ol))}play(){var e;Il.log("play"),this.paused$.next(!1),this.player&&this.isLoggedIn?this.src===(null===(e=this.loadError)||void 0===e?void 0:e.src)?this.error$.next(this.loadError.error):this.src===this.loadedSrc&&this.safePlay():this.error$.next(Error(Ol))}pause(){Il.log("pause"),this.paused$.next(!0),this.safePause()}stop(){Il.log("stop"),this.paused$.next(!0),this.safeStop()}seek(e){var t;null===(t=this.player)||void 0===t||t.seek(1e3*e)}resize(){}getCurrentState(){var e;return Pl(this,void 0,void 0,(function*(){return(null===(e=this.player)||void 0===e?void 0:e.getCurrentState())||null}))}get paused(){return this.paused$.getValue()}get src(){return this.src$.getValue()}get currentTrackSrc(){return this.currentTrackSrc$.getValue()}observeAccessToken(){return this.accessToken$}observeIsLoggedIn(){return this.observeAccessToken().pipe(Xt((e=>!!e)),er())}observePaused(){return this.paused$.pipe(er())}observeReady(){return Gn([this.playerReady$,this.playerStarted$]).pipe(ze((([e,t])=>e&&t)),Xt((()=>{})),mr(1))}observeSrc(){return this.src$.pipe(er())}observeState(){return this.state$.pipe(ze(l))}addToQueue(e,t,n=3){return Pl(this,void 0,void 0,(function*(){if(!t)throw Error(Ol);const r=yield fetch(`https://api.spotify.com/v1/me/player/play?device_id=${this.deviceId}`,{method:"PUT",body:JSON.stringify({uris:[e],position_ms:0}),headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!r.ok){if(n>0)switch(r.status){case 401:{const t=yield Us();return this.addToQueue(e,t,--n)}case 404:case 502:case 503:return yield this.reconnect(t),this.addToQueue(e,t,--n)}throw r}this.loadError=void 0,this.loadedSrc=e}))}connect(e){return Pl(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{let r=!1;const i=new Spotify.Player({name:"ampcast",getOAuthToken:t=>Pl(this,void 0,void 0,(function*(){r&&(e=yield Us()),r=!0,t(e)})),volume:this.muted?0:this.volume});i.addListener("initialization_error",n),i.addListener("authentication_error",n),i.addListener("account_error",n),i.addListener("playback_error",(e=>this.error$.next(e))),i.addListener("player_state_changed",(e=>this.state$.next(e))),i.addListener("not_ready",(()=>{Il.log("not_ready"),this.deviceId="",n("not_ready")})),i.addListener("ready",(({device_id:e})=>{Il.log("ready"),this.player=i,this.deviceId=e,t(i)})),i.connect()}))}))}disconnect(){return Pl(this,void 0,void 0,(function*(){this.loadedSrc="",this.currentTrackSrc$.next(""),this.loadError=void 0;const e=this.player;e&&(e.removeListener("initialization_error"),e.removeListener("authentication_error"),e.removeListener("account_error"),e.removeListener("playback_error"),e.removeListener("player_state_changed"),e.removeListener("not_ready"),e.removeListener("ready"),yield this.safePause(),e.disconnect())}))}reconnect(e){return Pl(this,void 0,void 0,(function*(){return Il.log("reconnect"),t=vn(this.disconnect()).pipe(xl(1e3),Zt((()=>this.connect(e))),xl(3e3),Xt((()=>{}))),new Promise((function(e,n){var r=new ge({next:function(t){e(t),r.unsubscribe()},error:n,complete:function(){n(new gl)}});t.subscribe(r)}));var t}))}safePause(){return Pl(this,void 0,void 0,(function*(){try{this.player&&this.loadedSrc&&(yield this.player.pause())}catch(e){Il.error(e)}}))}safePlay(){return Pl(this,void 0,void 0,(function*(){try{this.player&&this.loadedSrc&&(yield this.player.resume())}catch(e){this.error$.next(e)}}))}safeStop(){return Pl(this,void 0,void 0,(function*(){try{if(this.player&&this.loadedSrc){yield this.player.pause();const e=yield this.getCurrentState();(null==e?void 0:e.position)&&(yield this.player.seek(0))}}catch(e){Il.error(e)}}))}safeVolume(e){var t;return Pl(this,void 0,void 0,(function*(){try{yield null===(t=this.player)||void 0===t?void 0:t.setVolume(e)}catch(e){Il.error(e)}}))}}(Fs());function $l(){return[si,ml,Ao,Cs,oa,ja,Ko]}function zl(){return $l().filter((e=>!!e.lookup))}function jl(e){return $l().find((t=>t.id===e))}function Ll(e){if(e){const[t,n,r]=e.split(":");return"blob"===t||"file"===t||!!r&&!!n&&function(e){const t=jl(e);return!!t&&!t.isScrobbler}(t)}return!1}function Rl(e){return!!e&&Ll(e.src)}const _l=new z("services"),Dl=_l.getJson("hidden",{}),Fl=new Ie(Dl);function Vl(e){return!function(e){var t;return null!==(t=Fl.getValue()[e.id])&&void 0!==t?t:!!e.defaultHidden}(e)}function Ul(e){const t=Fl.getValue(),n=Object.assign(Object.assign({},t),e);_l.setJson("hidden",n),Fl.next(n)}var Bl=n(7068);function Hl({service:e}){return r.createElement("p",null,r.createElement("button",{className:"branded login",onClick:e.login},"Log in to ",e.name))}function Yl({service:e}){return r.createElement("p",{className:"service-link"},r.createElement(yi,{name:e.icon}),r.createElement(Ya,{href:e.url}))}function Kl({service:e}){return r.createElement("div",{className:"panel"},r.createElement("div",{className:"page login"},r.createElement("p",null,"You need to be logged in to play music from ",e.name,"."),r.createElement(Hl,{service:e}),r.createElement(Yl,{service:e})))}function Wl(){return(0,r.useEffect)((()=>{const e=new Te,t=e.pipe(Zt((e=>Rt(e))),Zt((()=>function(){return ns(this,void 0,void 0,(function*(){return ss=yield ts.fetchJSON({host:is,path:"/pins",method:"POST",params:{strong:"true"}}),ss}))}())),Xt((e=>1e3*e.expiresIn)),$e((t=>e.next(t)))).subscribe();return e.next(0),()=>t.unsubscribe()})),r.createElement(Kl,{service:Cs})}function ql({service:e}){return r.createElement("div",{className:"dev-mode note"},r.createElement("p",null,"This application is in ",r.createElement("strong",null,"development mode"),"."),r.createElement("p",null,"You currently need to be an approved user to access services from ",e.name,"."))}function Jl(){return r.createElement("div",{className:"panel"},r.createElement("div",{className:"page login"},r.createElement(ql,{service:ml}),r.createElement("p",null,"You need to be logged in to play music from Spotify.*"),r.createElement(Hl,{service:ml}),r.createElement("p",null,r.createElement("small",null,"*Spotify Premium required.")),r.createElement(Yl,{service:ml})))}function Ql(e,t){return void 0===t&&(t=zt),Oe((function(n,r){var i=null,a=null,o=null,s=function(){if(i){i.unsubscribe(),i=null;var e=a;a=null,r.next(e)}};function l(){var n=o+e,a=t.now();if(a<n)return i=this.schedule(void 0,n-a),void r.add(i);s()}n.subscribe(Me(r,(function(n){a=n,o=t.now(),i||(i=t.schedule(l,e),r.add(i))}),(function(){s(),r.complete()}),void 0,(function(){a=i=null})))}))}function Xl(e){return new Promise(((t,n)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>n(e.error)}))}function Gl(e,t){const n=indexedDB.open(e);n.onupgradeneeded=()=>n.result.createObjectStore(t);const r=Xl(n);return(e,n)=>r.then((r=>n(r.transaction(t,e).objectStore(t))))}let Zl;function ec(){return Zl||(Zl=Gl("keyval-store","keyval")),Zl}function tc(e,t=ec()){return t("readonly",(t=>Xl(t.get(e))))}function nc(e,t,n=ec()){return n("readwrite",(n=>(n.put(t,e),Xl(n.transaction))))}var rc;!function(e){e.Looking="looking",e.NotFound="not-found"}(rc||(rc={}));const ic=rc;var ac=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};const oc=new A("file");function sc(e){var t,r,i;return ac(this,void 0,void 0,(function*(){const{parseBlob:a}=yield Promise.all([n.e(463),n.e(12)]).then(n.bind(n,2463));let o;try{o=yield a(e,{duration:!0,skipCovers:!0})}catch(t){oc.log(`Error parsing file: ${e.name}`),oc.error(t),o={format:{},common:{}}}const{common:s,format:l}=o,c=e.type.startsWith("video"),u=l.duration||(yield function(e){return ac(this,void 0,void 0,(function*(){return new Promise((t=>{const n=e.type.startsWith("video"),r=document.createElement(n?"video":"audio"),i=URL.createObjectURL(e),a=()=>{const e=r.error?0:r.duration;r.ondurationchange=null,r.onerror=null,r.src="",r.removeAttribute("src"),URL.revokeObjectURL(i),t(e)};r.ondurationchange=a,r.onerror=a,r.onended=a,r.muted=!0,r.src=i}))}))}(e)),d=(e=0)=>Math.floor(Number(e))||0;return{itemType:Yn.Media,mediaType:c?Nr.Video:Nr.Audio,src:`blob:${mi()}`,externalUrl:"",title:s.title||e.name.replace(/\.\w+$/,""),artists:s.artist?[s.artist]:s.artists,albumArtist:s.album&&s.albumartist||"",album:s.album||"",genres:s.genre,duration:u?Number(u.toFixed(3)):0,track:d(null===(t=s.track)||void 0===t?void 0:t.no),disc:d(null===(r=s.disk)||void 0===r?void 0:r.no),year:d(s.year),mood:s.mood||"",rating:Number(s.rating)||0,isrc:null===(i=s.isrc)||void 0===i?void 0:i[0],recording_mbid:s.musicbrainz_recordingid,playedAt:0,blob:e}}))}var lc=n(4909),cc=n.n(lc),uc=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module:localdb/listens");const dc=new A("localdb/listens"),mc=[],hc=new Ie(mc);class fc extends vt.ZP{constructor(){super("ampcast/listens"),this.version(1).stores({items:"&playedAt, src, lastfmScrobbledAt, listenbrainzScrobbledAt"})}}const pc=new fc;function vc(){return hc.pipe(ze((e=>e!==mc)))}function bc(e){return uc(this,void 0,void 0,(function*(){try{e.length>0&&(yield pc.items.bulkPut(e))}catch(e){dc.error(e)}}))}function gc(e,t=30){return Math.round(e.playedAt/t)}function yc(e,t,n=5){const r=t.playedAt,i=r-n,a=r+t.duration+n;for(const n of e){if(n.playedAt<i)return;if(n.playedAt>i&&n.playedAt<a&&Ec(t,n,.75))return n}}function wc(e,t){const n=hc.getValue();return function(e,t,n=5){const r=t.playedAt;if(r)for(let i=0;i<e.length;i++){const a=e[i-1];if(a&&a.playedAt<r)return;const o=e[i],s=o.playedAt-n,l=o.playedAt+o.duration+n;if(r>s&&r<l&&Ec(o,t,.75))return o}}(n,e,t)||function(e,t){return e.find((e=>t.src===e.src||t.externalUrl&&t.externalUrl===e.externalUrl||t.isrc&&t.isrc===e.isrc||t.recording_mbid&&t.recording_mbid===e.recording_mbid))}(n,e)||Dc(n,e)}function Ec(e,t,n){return S(e.title,t.title,n)}function xc(e){return uc(this,void 0,void 0,(function*(){const t=`${e}ScrobbledAt`,n=Math.floor(Date.now()/1e3)-1209600,r=yield pc.items.where(t).equals(0).toArray();yield bc(r.filter((e=>e.playedAt<n)).map((e=>Object.assign(Object.assign({},e),{[t]:-1}))))}))}uc(void 0,void 0,void 0,(function*(){try{yield xc("lastfm"),yield xc("listenbrainz")}catch(e){dc.error(e)}(0,vt.Y1)((()=>pc.items.orderBy("playedAt").reverse().toArray())).subscribe(hc)}));const kc=new Te,Sc=new Te,Cc=new z("lookup"),Pc={get preferredService(){return Cc.getString("preferredService")},set preferredService(e){Cc.setString("preferredService",e)}},Tc=["rating","globalRating","playCount","globalPlayCount","inLibrary","lookupStatus"];function Ac(e){return Object.keys(e).reduce(((t,n)=>(void 0===e[n]||Tc.includes(n)||(t[n]=e[n]),t)),{})}var Ic=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};const Oc=new A("lookupStore");class Mc extends vt.ZP{constructor(){super("ampcast/lookup"),this.version(1).stores({items:"&[service+artist+title]"})}add(e,t,n,r){return Ic(this,void 0,void 0,(function*(){try{e&&(Oc.log("add",{service:e,artist:t,title:n,items:r}),t=t.toLowerCase(),n=n.toLowerCase(),r=r.map((e=>Ac(e))),yield this.items.put({service:e,artist:t,title:n,items:r}))}catch(e){Oc.error(e)}}))}get(e,t,n){return Ic(this,void 0,void 0,(function*(){return this.items.get([e,t.toLowerCase(),n.toLowerCase()])}))}}const Nc=new Mc;var $c=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))},zc=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const jc=new A("lookup");let Lc="";function Rc(e,t){return $c(this,void 0,void 0,(function*(){try{if(!e.lookup)return[];const{artist:n,title:r}=Kc(t),i=yield Nc.get(e.id,n,r);if(i)return i.items;if(e.isLoggedIn()){const i=e=>Yc(e).replace(/[([].*$/,"").replace(/['"]/g," ").replace(/\s\s+/g," "),a=Fc(yield e.lookup(i(t.albumArtist||Wc(n)),i(Wc(r)),10,2e3),t);return yield Nc.add(e.id,n,r,a),a}}catch(e){jc.error(e)}return[]}))}function _c(e,t,n){return $c(this,void 0,void 0,(function*(){const r=zl().filter((e=>e!==n&&e.isLoggedIn()===t));return 0===r.length?[]:(yield Promise.all([...r.map((t=>Rc(t,e)))])).flat()}))}function Dc(e,t){const{artist:n,title:r}=Kc(t);if(!n||!r)return;const i=Pc.preferredService||Lc;let a=Fc(e,t);return a=k(a,(e=>Bc(e,t))),i&&(a=k(a,(e=>e.src.startsWith(i)))),a[0]}function Fc(e,t){let n=e.filter((e=>Uc(e,t,!0)));return 0===n.length&&(n=e.filter((e=>Uc(e,t,!1)))),n}const Vc=/\s*(feat\.|[([]?\s?feat[\s.]).*$/i;function Uc(e,t,n){return(function(e,t,n){let r=t.title;if(!r)return!1;if(Hc(r,e.title))return!0;if(n)return!1;const i=Yc(e.title);if(r=Yc(r),Hc(r,i))return!0;const[,...a]=e.artists||[];if(a.length>0){const e=a.length>1?` & ${a.pop()}`:"";if(Hc(r,`${i} (feat. ${a.join(", ")}${e})`))return!0}return!(!Vc.test(r)||!Hc(Wc(r),i))||!(!Vc.test(e.title)||!Hc(r,Wc(i)))}(e,t,n)||function(e,t){if(!Bc(e,t))return!1;if(e.track!==t.track)return!1;const n=Yc(e.title),r=Yc(t.title);return!(!n.startsWith(r)&&!r.startsWith(n))||S(n,r,.75)}(e,t))&&function(e,t,n){var r;const i=null===(r=t.artists)||void 0===r?void 0:r[0];if(!i)return!1;const a=e.artists;if(!a)return!1;const o=a[0];if(!o)return!1;if(Hc(i,o))return!0;if(n)return!1;if(Hc(Yc(i),Yc(o)))return!0;if(Hc(Wc(i),Wc(o)))return!0;const s=t.albumArtist;if(s&&Hc(Yc(s),Yc(o)))return!0;if(Hc(Wc(i),e.albumArtist))return!0;const l=",;&|/".split("").map((e=>[e,`${e} `,` ${e} `])).flat();for(const e of l){const[t]=a[0].split(e);if(Hc(i,t))return!0;if(a.length>1&&Hc(i,a.join(e)))return!0}return!1}(e,t,n)}function Bc(e,t){return!(!e.album||!t.album)&&Hc(Yc(t.album),Yc(e.album))}function Hc(e,t=""){return 0===e.localeCompare(t,void 0,{sensitivity:"accent"})}function Yc(e){return cc()(e).replace(/\s\s+/g," ")}function Kc(e){return{artist:e.artists&&e.artists[0]||"",title:e.title}}function Wc(e){return e.replace(Vc,"")}const qc=new z("playlist"),Jc=new Ie(qc.getJson("settings",{allowDuplicates:!0,showLineNumbers:!0,zeroPadLineNumbers:!0,showSourceIcons:!0})),Qc={observe:function(){return Jc},get:function(){return Jc.getValue()},set:function(e){qc.setJson("settings",e),Jc.next(e)}};var Xc=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::playlist");const Gc=new A("playlist"),Zc=Gl("ampcast/playlist","keyval"),eu=[],tu=new Ie(eu),nu=new Ie("");function ru(){return tu.getValue()}function iu(e){e=e.concat(),tu.next(e),0===e.length?ou(""):su()||ou(e[0].id)}function au(){return nu.getValue()}function ou(e){nu.next(e)}function su(){const e=ru(),t=au();return e.find((e=>e.id===t))||null}function lu(e){ou(e.id)}function cu(){return Gn([tu,nu]).pipe(Xt((([e,t])=>{var n;return null!==(n=e.find((e=>e.id===t)))&&void 0!==n?n:null})),er())}function uu(){return Gn([tu,nu]).pipe(Xt((([e,t])=>e.findIndex((e=>e.id===t)))),er())}function du(){const e=tu.getValue(),t=au();return e.findIndex((e=>e.id===t))}function mu(){return tu.getValue().length}function hu(e){const t=au();if(t){const n=ru(),r=n.findIndex((e=>e.id===t));if(-1!==r){const t=n[r+e];t&&lu(t)}}}function fu(e,t){return Xc(this,void 0,void 0,(function*(){const n=ru(),r=Qc.get().allowDuplicates;let i=yield function(e){return Xc(this,void 0,void 0,(function*(){const t=e=>"itemType"in e&&e.itemType===Yn.Album;let n=[];if(Array.isArray(e))if(t(e[0])){const t=yield Promise.all(e.map((e=>vu(e))));for(const e of t)n=n.concat(e)}else n=yield Promise.all(e.map((e=>bu(e))));else n=t(e)?yield vu(e):e instanceof FileList?yield Promise.all(Array.from(e).map((e=>sc(e)))):[yield bu(e)];return n.filter(l)}))}(e);if(r||(i=i.filter((e=>-1===n.findIndex((t=>t.src===e.src))))),i.length>0){const e=i.map((e=>Object.assign(Object.assign({},Ac(e)),{id:mi()})));t>=0&&t<n.length?(n.splice(t,0,...e),iu(n)):iu(n.concat(e))}}))}function pu(e){return Xc(this,void 0,void 0,(function*(){const t=ru(),n=Array.isArray(e)?e:[e],r=t.filter((e=>!n.includes(e)));if(r.length!==t.length){const e=du(),t=au(),n=r.findIndex((e=>e.id===t));if(-1===n)if(-1===e)ou("");else{const t=r[e]||r.at(-1);ou((null==t?void 0:t.id)||"")}iu(r)}}))}function vu(e){return Xc(this,void 0,void 0,(function*(){return hr(e.pager,{keepAlive:!0})}))}function bu(e){return Xc(this,void 0,void 0,(function*(){return e instanceof File?/^(audio|video)/.test(e.type)?sc(e):null:e}))}const gu={get atEnd(){return du()===mu()-1},get atStart(){return 0===mu()||0===du()},observe:function(){return tu.pipe(ze((e=>e!==eu)))},observeCurrentIndex:uu,observeCurrentItem:cu,observeNextItem:function(){return Gn([tu,nu]).pipe(Xt((([e,t])=>{const n=e.findIndex((e=>e.id===t));return-1===n?null:e[n+1]||null})),er())},observeSize:function(){return tu.pipe(Xt((e=>e.length)),er())},getCurrentIndex:du,getCurrentItem:su,setCurrentItem:lu,add:function(e){return Xc(this,void 0,void 0,(function*(){return fu(e,-1)}))},clear:function(){return Xc(this,void 0,void 0,(function*(){iu([])}))},eject:function(){return Xc(this,void 0,void 0,(function*(){const e=su();if(e)return pu(e)}))},insert:function(e){return Xc(this,void 0,void 0,(function*(){return fu(e,du()+1)}))},insertAt:fu,moveSelection:function(e,t){return Xc(this,void 0,void 0,(function*(){const n=ru(),r=n[t];if(e.includes(r))return;const i=n.filter((t=>!e.includes(t))),a=i.indexOf(r);a>=0?(i.splice(a,0,...e),iu(i)):iu(i.concat(e))}))},next:function(){return Xc(this,void 0,void 0,(function*(){hu(1)}))},prev:function(){return Xc(this,void 0,void 0,(function*(){hu(-1)}))},remove:pu,removeAt:function(e){return Xc(this,void 0,void 0,(function*(){const t=function(e){var t;return null!==(t=ru()[e])&&void 0!==t?t:null}(e);if(t)return pu(t)}))},reverseAt:function(e,t){return Xc(this,void 0,void 0,(function*(){const n=ru(),r=n.slice(e,e+t).reverse();n.splice(e,t,...r),iu(n)}))},shuffle:function(e){return Xc(this,void 0,void 0,(function*(){const t=ru().slice();if(t.length>0){const n=su();if(e&&n){const e=f(t.filter((e=>e!==n)));e.unshift(n),iu(e)}else{const e=f(t);iu(e),lu(e[0])}}}))}};Xc(void 0,void 0,void 0,(function*(){var e,t;const n=null!==(e=yield tc("items",Zc))&&void 0!==e?e:[],r=null!==(t=yield tc("currently-playing-id",Zc))&&void 0!==t?t:"";tu.next(n),nu.next(r)})),tu.pipe(wl(2),Ql(200),Zt((e=>nc("items",e=e.map((e=>{if(e.lookupStatus){const{lookupStatus:t}=e;return function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["lookupStatus"])}return e})),Zc)))).subscribe(Gc),nu.pipe(wl(2),Ql(200),Zt((e=>nc("currently-playing-id",e,Zc)))).subscribe(Gc),kc.pipe($e((({lookupItem:e})=>{const t=ru(),n=t.findIndex((t=>t.src===e.src));if(-1!==n){const e=t[n];t[n]=Object.assign(Object.assign({},e),{lookupStatus:ic.Looking}),iu(t)}}))).subscribe(Gc),Sc.pipe($e((({lookupItem:e,foundItem:t})=>{const n=ru(),r=n.findIndex((t=>t.src===e.src));if(-1!==r){const e=n[r];n[r]=t?Object.assign(Object.assign({},t),{id:e.id,lookupStatus:void 0}):Object.assign(Object.assign({},e),{lookupStatus:ic.NotFound}),iu(n)}}))).subscribe(Gc);var yu,wu,Eu=n(1062),xu=n.n(Eu),ku=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Su=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const Cu=(e,t)=>e.width===t.width&&e.height===t.height,Pu=16/9,Tu={autohide:1,autoplay:0,controls:0,disablekb:1,enablejsapi:1,fs:0,iv_load_policy:3,modestbranding:1,rel:0,showinfo:0};var Au;!function(e){e[e.UNSTARTED=-1]="UNSTARTED",e[e.ENDED=0]="ENDED",e[e.PLAYING=1]="PLAYING",e[e.PAUSED=2]="PAUSED",e[e.BUFFERING=3]="BUFFERING",e[e.CUED=5]="CUED"}(Au||(Au={}));class Iu{constructor(e){this.player=null,this.src$=new Ie(""),this.size$=new Ie({width:0,height:0}),this.error$=new Te,this.ready$=new Te,this.state$=new Te,this.videoId$=new Ie(""),yu.set(this,!0),wu.set(this,1),this.autoplay=!1,this.loop=!1;const t=this.element=document.createElement("div"),n=document.createElement("div"),r=document.createElement("div"),i=this.logger=new A(`YouTubePlayer/${e}`);this.targetId=`youtube-iframe-${e}`,t.hidden=!0,t.className="youtube-video",n.className="youtube-video-wrapper",r.id=this.targetId,n.append(r),t.append(n),this.observeReady().pipe(Zt((()=>this.observeSrc())),Is((e=>!e)),$e((e=>{const t=this.player,[,n,r,i="0"]=e.split(":"),a=Number(i)||0;if(r){if("playlist"===n){const e={list:r,listType:n,index:a};this.autoplay?t.loadPlaylist(e):t.cuePlaylist(e)}else this.autoplay?t.loadVideoById(r,a):t.cueVideoById(r,a);this.loadError=void 0}else t.stopVideo()}))).subscribe(i),this.observeReady().pipe(Zt((()=>this.observeVideoSize())),$e((({width:e,height:t})=>this.player.setSize(e,t)))).subscribe(i),this.observeState().pipe(ze((e=>e===Au.ENDED&&this.loop)),$e((()=>this.player.seekTo(0,!0)))).subscribe(i),this.observeState().pipe(ze((e=>e===Au.PLAYING)),$e((()=>this.element.style.visibility=""))).subscribe(i),this.observeState().pipe(Xt((()=>{var e;return this.getVideoId((null===(e=this.player)||void 0===e?void 0:e.getVideoUrl())||"")})),$e((e=>this.videoId$.next(e)))).subscribe(i),this.observeError().subscribe(i.error)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e,e&&(this.element.style.visibility="hidden")}get muted(){return ku(this,yu,"f")}set muted(e){ku(this,yu,"f")!==e&&(Su(this,yu,e,"f"),this.player&&(e?this.player.mute():0!==this.volume&&this.player.unMute()))}get volume(){return ku(this,wu,"f")}set volume(e){ku(this,wu,"f")!==e&&(Su(this,wu,e,"f"),this.player&&(this.player.setVolume(100*e),0===e?this.player.mute():this.muted||this.player.unMute()))}observeCurrentTime(){return this.observeState().pipe(yn((e=>{var t;return e===Au.PLAYING?Rt(250-Math.round(1e3*this.player.getCurrentTime())%250,250).pipe(Xt((()=>this.player.getCurrentTime())),wn(this.observeState())):Pn((null===(t=this.player)||void 0===t?void 0:t.getCurrentTime())||0)})))}observeDuration(){return this.observeState().pipe(Xt((()=>{var e;return(null===(e=this.player)||void 0===e?void 0:e.getDuration())||0})),ze((e=>0!==e)),er())}observeEnded(){return this.observeState().pipe(ze((e=>e===Au.ENDED&&!this.loop)),Xt((()=>{})))}observeError(){return this.error$}observePlaying(){return this.observeState().pipe(ze((e=>e===Au.PLAYING)),Xt((()=>{})))}observeVideoId(){return this.videoId$.pipe(er())}appendTo(e){e.appendChild(this.element),this.createPlayer()}load(e){this.logger.log("load",{src:e}),this.player||this.createPlayer(),this.autoplay&&this.player&&e===this.src?this.player.playVideo():this.src$.next(e)}play(){var e;this.logger.log("play"),this.player?this.src===(null===(e=this.loadError)||void 0===e?void 0:e.src)?this.error$.next(this.loadError.error):this.player.playVideo():this.error$.next(Error("YouTube player not loaded."))}pause(){var e;this.logger.log("pause"),null===(e=this.player)||void 0===e||e.pauseVideo()}stop(){var e;this.logger.log("stop"),null===(e=this.player)||void 0===e||e.stopVideo()}seek(e){var t;null===(t=this.player)||void 0===t||t.seekTo(e,!0)}resize(e,t){this.size$.next({width:e,height:t})}destroy(){var e;null===(e=this.player)||void 0===e||e.destroy(),this.element.remove()}get src(){return this.src$.getValue()}observeAspectRatio(){return this.observeVideoId().pipe(yn((e=>e?this.getAspectRatio(e):Pn(Pu))),er())}observeReady(){return this.ready$.pipe(mr(1))}observeSize(){return this.size$.pipe(er(Cu),ze((({width:e,height:t})=>e*t>0)))}observeSrc(){return this.src$.pipe(er())}observeState(){return this.state$}observeVideoSize(){return Gn([this.observeSize(),this.observeAspectRatio()]).pipe(Xt((([{width:e,height:t},n])=>{const r=Math.max(Math.round(e/n),t);return{width:Math.max(Math.round(r*n),e),height:r}})),er(Cu))}createPlayer(){if(!this.player&&this.element.isConnected){const e=xu()(this.targetId,{playerVars:Tu});e.on("ready",(({target:e})=>{this.player=e,e.setVolume(100*this.volume),(this.muted||0===this.volume)&&e.mute(),this.ready$.next(void 0)})),e.on("stateChange",(({data:e})=>{this.state$.next(e)})),e.on("error",(e=>{this.loadError={src:this.src,error:e},this.error$.next(e)}))}}getAspectRatio(e){return vn(Po(e)).pipe(wn(Rt(3e3)),wn(this.observeVideoId().pipe(wl(1))),Xt((({aspectRatio:e})=>e||Pu)),lr((t=>(this.logger.log(`Could not obtain oembed info (videoId=${e}): ${t.message}`),this.loadError={src:this.src,error:t},this.error$.next(t),Pn(Pu)))))}getPlayerState(){return this.player?this.player.getPlayerState():Au.UNSTARTED}getVideoId(e){if(e.startsWith("youtube:video")){const[,,t]=e.split(":");return t}return eo()(e)||""}}yu=new WeakMap,wu=new WeakMap;var Ou=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};let Mu=0;class Nu extends Iu{constructor(e){super("loader-"+Mu++),this.load(e)}loadPlaylist(){return Ou(this,void 0,void 0,(function*(){return yield this.cue(),this.player.getPlaylist()||[]}))}observeVideoSize(){return cn}loadDuration(){return Ou(this,void 0,void 0,(function*(){return yield this.cue(),this.player.getDuration()||0}))}cue(){return new Promise(((e,t)=>{const n=this.observeCued(),r=bn(this.observeError(),Rt(3e3).pipe(Xt((()=>Error("timeout")))));n.pipe(wn(r),mr(1)).subscribe({next:e}),r.pipe(wn(n),mr(1)).subscribe({next:t}),setTimeout((()=>this.appendTo(document.body)))}))}observeCued(){return this.observeState().pipe(ze((e=>e===Au.CUED)),Xt((()=>{})),mr(1))}}var $u=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};function zu(){const e=(0,r.useRef)(null),[t,n]=(0,r.useState)(""),i=(0,r.useCallback)((t=>$u(this,void 0,void 0,(function*(){try{t.preventDefault();const r=e.current.value,i=eo()(r),a=yield Po(i),o=yield function(e){return Ou(this,void 0,void 0,(function*(){const t=new Nu(e);try{return yield t.loadDuration()}finally{t.destroy()}}))}(a.src);yield gu.add(Object.assign(Object.assign({},a),{duration:o})),n("Queued.")}catch(e){n(e.message||"This video cannot be embedded.")}}))),[]),a=(0,r.useCallback)((()=>{n("");const t=e.current.value;let r="Not a valid YouTube url.";/^https?/.test(t)&&/youtu\.?be/.test(t)&&(r="Not a YouTube video.",eo()(t)&&(r="")),e.current.setCustomValidity(r)}),[]);return r.createElement("form",{className:"add-youtube-video",onSubmit:i},r.createElement("fieldset",null,r.createElement("legend",null,"Add video from url:"),r.createElement("p",{className:"text-with-button"},r.createElement("input",{type:"url",required:!0,onInput:a,ref:e}),r.createElement("button",{title:"Add to playlist"},r.createElement(yi,{name:"playlist-add"}))),r.createElement("p",null,r.createElement("output",null,t))))}function ju(){return r.createElement("div",{className:"panel"},r.createElement("div",{className:"page login"},r.createElement(ql,{service:Ao}),r.createElement("p",null,"You can still play YouTube videos without being logged in.",r.createElement("br",null),"But you need to be logged in to search for music and access your playlists."),r.createElement(Hl,{service:Ao}),r.createElement(zu,null),r.createElement(Yl,{service:Ao})))}function Lu({service:e}){switch(e.id){case"plex":return r.createElement(Wl,null);case"spotify":return r.createElement(Jl,null);case"youtube":return r.createElement(ju,null);default:return r.createElement(Kl,{service:e})}}function Ru({icon:e,placeholder:t="Search",onSubmit:n}){const i=(0,r.useRef)(null),a=(0,r.useCallback)((e=>{const t=i.current.value;e.preventDefault(),null==n||n(t)}),[n]);return r.createElement("form",{className:"search-bar",onSubmit:a},r.createElement("p",{className:"text-with-button"},e?r.createElement(yi,{name:e}):null,r.createElement("input",{type:"search",placeholder:t,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",ref:i}),r.createElement("button",{type:"submit",title:"Search"},r.createElement(yi,{name:"search"}))))}function _u({children:e}){return r.createElement("div",{className:"panel empty-screen"},e)}var Du,Fu,Vu=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},Uu=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};class Bu{constructor(e,t,n,r){this.players=t,this.selectPlayer=n,this.loadPlayer=r,this.player$=new Ie(null),this.error$=new Te,Du.set(this,!1),Fu.set(this,!1);const i=this.element=document.createElement("div");i.className=e,t.forEach((e=>{e.autoplay=!1,e.muted=!0,e.hidden=!0,e.appendTo(i)}))}get autoplay(){return Vu(this,Du,"f")}set autoplay(e){Uu(this,Du,e,"f"),this.currentPlayer&&(this.currentPlayer.autoplay=e)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e,this.currentPlayer&&(this.currentPlayer.hidden=e)}get loop(){return this.players[0].loop}set loop(e){this.players.forEach((t=>t.loop=e))}get muted(){return Vu(this,Fu,"f")}set muted(e){Uu(this,Fu,e,"f"),this.currentPlayer&&(this.currentPlayer.muted=e)}get volume(){return this.players[0].volume}set volume(e){this.players.forEach((t=>t.volume=e))}observeCurrentTime(){return this.observeCurrentPlayer().pipe(yn((e=>e?e.observeCurrentTime():Pn(0))),er())}observeDuration(){return this.observeCurrentPlayer().pipe(yn((e=>e?e.observeDuration():cn)),er())}observeEnded(){return this.observeCurrentPlayer().pipe(yn((e=>e?e.observeEnded():cn)))}observeError(){return this.observeCurrentPlayer().pipe(yn((e=>e?bn(this.error$,e.observeError()):cn)))}observePlaying(){return this.observeCurrentPlayer().pipe(yn((e=>e?e.observePlaying():cn)))}appendTo(e){e.appendChild(this.element)}load(e){const t=this.currentPlayer,n=this.selectPlayer(e);if(this.player$.next(null),t&&t!==n&&(t.muted=!0,t.hidden=!0,t.stop()),this.player$.next(n),n)try{n.autoplay=this.autoplay,this.loadPlayer(n,e),n.muted=this.muted,n.hidden=this.hidden}catch(e){this.error$.next(e)}else this.error$.next(Error("No player found."))}play(){var e;this.autoplay=!0,null===(e=this.currentPlayer)||void 0===e||e.play()}pause(){var e;this.autoplay=!1,null===(e=this.currentPlayer)||void 0===e||e.pause()}stop(){var e;this.autoplay=!1,null===(e=this.currentPlayer)||void 0===e||e.stop()}seek(e){var t;null===(t=this.currentPlayer)||void 0===t||t.seek(e)}resize(e,t){e*t>0&&this.players.forEach((n=>n.resize(e,t)))}get currentPlayer(){return this.player$.getValue()}observeCurrentPlayer(){return this.player$.pipe(er())}}Du=new WeakMap,Fu=new WeakMap;var Hu;class Yu{constructor(){Hu.set(this,!1),this.loop=!0,this.muted=!0,this.volume=0}get autoplay(){return function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,Hu,"f")}set autoplay(e){!function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,Hu,e,"f")}observeCurrentTime(){return cn}observeDuration(){return cn}observeEnded(){return cn}observeError(){return cn}observePlaying(){return cn}seek(){}}Hu=new WeakMap;class Ku{constructor(e,t){this.error$=new Te,this.src="",this.autoplay=!1;const n=this.element=document.createElement(e);n.hidden=!0,n.muted=!0,n.autoplay=!1,n.className=`html5-${e} html5-${e}-${t}`,n.crossOrigin="anonymous",on(n,"error").pipe(Xt((()=>n.error))).subscribe(this.error$);const r=this.logger=new A(`HTML5Player/${e}/${t}`);this.observeError().subscribe(r.error)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e}get loop(){return this.element.loop}set loop(e){this.element.loop=e}get muted(){return this.element.muted}set muted(e){this.element.muted=e}get volume(){return this.element.volume}set volume(e){this.element.volume=e}observeCurrentTime(){return on(this.element,"timeupdate").pipe(Xt((()=>this.element.currentTime)),Xt((e=>isFinite(e)?e:0)))}observeDuration(){return on(this.element,"durationchange").pipe(Xt((()=>this.element.duration)),Xt((e=>isFinite(e)?e:0)))}observeEnded(){return on(this.element,"ended").pipe(Xt((()=>{})))}observeError(){return this.error$}observePlaying(){return on(this.element,"playing").pipe(Xt((()=>{})))}appendTo(e){e.appendChild(this.element)}load(e){this.logger.log("load"),this.src=e;try{const e=this.getMediaSource(this.src);this.element.setAttribute("src",e),this.autoplay&&this.safePlay()}catch(e){this.error$.next(e)}}play(){this.logger.log("play");try{const e=this.getMediaSource(this.src);this.element.getAttribute("src")!==e&&this.element.setAttribute("src",e),this.safePlay()}catch(e){this.error$.next(e)}}pause(){this.logger.log("pause"),this.element.pause()}stop(){this.logger.log("stop"),this.element.pause(),this.element.currentTime=0}seek(e){this.element.currentTime=e}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}getMediaSource(e){return e.startsWith("jellyfin:")?gi.getPlayableUrlFromSrc(e):e.startsWith("plex:")?ts.getPlayableUrlFromSrc(e):e}safePlay(){return e=this,t=void 0,r=function*(){try{yield this.element.play()}catch(e){this.error$.next(e)}},new((n=void 0)||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}));var e,t,n,r}}const Wu=new z("visualizer/settings"),qu={get ambientVideoEnabled(){return Wu.getBoolean("ambientVideoEnabled")},set ambientVideoEnabled(e){var t;e!==this.ambientVideoEnabled&&(Wu.setBoolean("ambientVideoEnabled",e),e||("ambientvideo"===this.provider&&Wu.setString("provider",""),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&Wu.removeItem("lockedVisualizer")),Ju.next(this))},get ambientVideoSource(){return Wu.getString("ambientVideoSource")},set ambientVideoSource(e){var t;e!==this.ambientVideoSource&&(Wu.setString("ambientVideoSource",e),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&Wu.removeItem("lockedVisualizer"),Ju.next(this))},get beatsOverlay(){return Wu.getBoolean("beatsOverlay")},set beatsOverlay(e){e!==this.beatsOverlay&&(Wu.setBoolean("beatsOverlay",e),Ju.next(this))},get useAmbientVideoSource(){return Wu.getBoolean("useAmbientVideoSource")},set useAmbientVideoSource(e){var t;e!==this.useAmbientVideoSource&&(Wu.setBoolean("useAmbientVideoSource",e),"ambientvideo"===(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)&&Wu.removeItem("lockedVisualizer"),Ju.next(this))},get lockedVisualizer(){return Wu.getJson("lockedVisualizer")},set lockedVisualizer(e){if(e){const{providerId:t,name:n}=e;Wu.setJson("lockedVisualizer",{providerId:t,name:n})}else Wu.removeItem("lockedVisualizer");Ju.next(this)},get provider(){return Wu.getString("provider")},set provider(e){var t;e!==this.provider&&(Wu.setString("provider",e),e&&(null===(t=this.lockedVisualizer)||void 0===t?void 0:t.providerId)!==e&&Wu.removeItem("lockedVisualizer"),Ju.next(this))}},Ju=new Ie(qu),Qu=qu;function Xu(){return Ju}function Gu(e,t,n){void 0===t&&(t=zt);var r=Rt(e,t);return function(e,t){return Oe((function(e,n){var i=null!=t?t:{},a=i.leading,o=void 0===a||a,s=i.trailing,l=void 0!==s&&s,c=!1,u=null,d=null,m=!1,h=function(){null==d||d.unsubscribe(),d=null,l&&(v(),m&&n.complete())},f=function(){d=null,m&&n.complete()},p=function(e){return d=Jt(r).subscribe(Me(n,h,f))},v=function(){if(c){c=!1;var e=u;u=null,n.next(e),!m&&p()}};e.subscribe(Me(n,(function(e){c=!0,u=e,(!d||d.closed)&&(o?v():p())}),(function(){m=!0,(!(l&&c&&d)||d.closed)&&n.complete()})))}))}(0,n)}console.log("module::playback");const Zu=new Ie({currentItem:null,currentTime:0,startedAt:0,endedAt:0,duration:0,paused:!0});function ed(){return Zu}function td(){return ed().pipe(ze((e=>0!==e.startedAt)),er(((e,t)=>e.startedAt===t.startedAt)))}function nd(){return ed().pipe(ze((e=>0!==e.endedAt)),er(((e,t)=>e.endedAt===t.endedAt)))}function rd(e=1e4){return td().pipe(yn((()=>ed().pipe(Gu(e,void 0,{trailing:!0}),wn(nd())))))}function id(){return ed().pipe(Xt((e=>e.paused)),er())}function ad(){const e=Zu.getValue();e.startedAt&&(e.endedAt||Zu.next(Object.assign(Object.assign({},e),{endedAt:Date.now()})),Zu.next(Object.assign(Object.assign({},e),{startedAt:0,endedAt:0})))}cu().subscribe((e=>{ad(),Zu.next(Object.assign(Object.assign({},Zu.getValue()),{currentItem:e,currentTime:0,duration:(null==e?void 0:e.duration)||0,startedAt:0,endedAt:0}))}));const od={get paused(){return Zu.getValue().paused},observePlaybackState:ed,observePlaybackStart:td,observePlaybackEnd:nd,observePlaybackProgress:rd,observeCurrentTime:function(){return ed().pipe(Xt((e=>e.currentTime)),er())},observeDuration:function(){return ed().pipe(Xt((e=>e.duration)),er())},observePaused:id,getCurrentTime:function(){return Zu.getValue().currentTime},setCurrentTime:function(e){const t=Zu.getValue();(e=Math.max(Math.min(Math.floor(isFinite(e)?e:0),t.duration),0))!==t.currentTime&&Zu.next(Object.assign(Object.assign({},t),{currentTime:e}))},getDuration:function(){return Zu.getValue().duration},setDuration:function(e){const t=Zu.getValue();if((e=Math.max(Math.floor(isFinite(e)?e:0),0))!==t.duration){const n=Math.min(t.currentTime,e);Zu.next(Object.assign(Object.assign({},t),{duration:e,currentTime:n}))}},play:function(){const e=Zu.getValue();e.currentItem&&e.paused&&Zu.next(Object.assign(Object.assign({},e),{paused:!1}))},pause:function(){const e=Zu.getValue();e.paused||Zu.next(Object.assign(Object.assign({},e),{paused:!0}))},stop:function(){const e=Zu.getValue();if(!e.paused||0!==e.currentTime||0!==e.startedAt&&0===e.endedAt){const t=Object.assign(Object.assign({},e),{paused:!0,currentTime:0,endedAt:e.endedAt||(e.startedAt?Date.now():0)});Zu.next(t),e.startedAt&&Zu.next(Object.assign(Object.assign({},t),{startedAt:0,endedAt:0}))}},started:function(){const e=Zu.getValue();e.startedAt||Zu.next(Object.assign(Object.assign({},e),{startedAt:Date.now()}))},ended:ad};function sd(e,t,n,r,i){var a=e*e,o=a*e;return((1-3*e+3*a-o)*t+(4-6*a+3*o)*n+(1+3*e+3*a-3*o)*r+o*i)/6}function ld(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],a=e[r+1],o=r>0?e[r-1]:2*i-a,s=r<t-1?e[r+2]:2*a-i;return sd((n-r/t)*t,o,i,a,s)}}function cd(e,t){let n;if(void 0===t)for(const t of e)null!=t&&(n>t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n>i||void 0===n&&i>=i)&&(n=i)}return n}const ud=Math.sqrt(50),dd=Math.sqrt(10),md=Math.sqrt(2);function hd(e,t,n){const r=(t-e)/Math.max(0,n),i=Math.floor(Math.log10(r)),a=r/Math.pow(10,i),o=a>=ud?10:a>=dd?5:a>=md?2:1;let s,l,c;return i<0?(c=Math.pow(10,-i)/o,s=Math.round(e*c),l=Math.round(t*c),s/c<e&&++s,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*o,s=Math.round(e/c),l=Math.round(t/c),s*c<e&&++s,l*c>t&&--l),l<s&&.5<=n&&n<2?hd(e,t,2*n):[s,l,c]}function fd(e,t,n){if(!((n=+n)>0))return[];if((e=+e)==(t=+t))return[e];const r=t<e,[i,a,o]=r?hd(t,e,n):hd(e,t,n);if(!(a>=i))return[];const s=a-i+1,l=new Array(s);if(r)if(o<0)for(let e=0;e<s;++e)l[e]=(a-e)/-o;else for(let e=0;e<s;++e)l[e]=(a-e)*o;else if(o<0)for(let e=0;e<s;++e)l[e]=(i+e)/-o;else for(let e=0;e<s;++e)l[e]=(i+e)*o;return l}var pd,vd=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function bd(e){if(!(t=vd.exec(e)))throw new Error("invalid format: "+e);var t;return new gd({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function gd(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function yd(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function wd(e,t){var n=yd(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}bd.prototype=gd.prototype,gd.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const Ed={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>wd(100*e,t),r:wd,s:function(e,t){var n=yd(e,t);if(!n)return e+"";var r=n[0],i=n[1],a=i-(pd=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,o=r.length;return a===o?r:a>o?r+new Array(a-o+1).join("0"):a>0?r.slice(0,a)+"."+r.slice(a):"0."+new Array(1-a).join("0")+yd(e,Math.max(0,t+a-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function xd(e){return e}var kd,Sd,Cd=Array.prototype.map,Pd=["y","z","a","f","p","n","Âµ","m","","k","M","G","T","P","E","Z","Y"];function Td(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Ad(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Id(e){let t,n,r;function i(e,r,i=0,a=e.length){if(i<a){if(0!==t(r,r))return a;do{const t=i+a>>>1;n(e[t],r)<0?i=t+1:a=t}while(i<a)}return i}return 2!==e.length?(t=Td,n=(t,n)=>Td(e(t),n),r=(t,n)=>e(t)-n):(t=e===Td||e===Ad?e:Od,n=e,r=e),{left:i,center:function(e,t,n=0,a=e.length){const o=i(e,t,n,a-1);return o>n&&r(e[o-1],t)>-r(e[o],t)?o-1:o},right:function(e,r,i=0,a=e.length){if(i<a){if(0!==t(r,r))return a;do{const t=i+a>>>1;n(e[t],r)<=0?i=t+1:a=t}while(i<a)}return i}}}function Od(){return 0}kd=function(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?xd:(t=Cd.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,a=[],o=0,s=t[0],l=0;i>0&&s>0&&(l+s+1>r&&(s=Math.max(1,r-l)),a.push(e.substring(i-=s,i+s)),!((l+=s+1)>r));)s=t[o=(o+1)%t.length];return a.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",a=void 0===e.currency?"":e.currency[1]+"",o=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?xd:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}(Cd.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"âˆ’":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function d(e){var t=(e=bd(e)).fill,n=e.align,d=e.sign,m=e.symbol,h=e.zero,f=e.width,p=e.comma,v=e.precision,b=e.trim,g=e.type;"n"===g?(p=!0,g="g"):Ed[g]||(void 0===v&&(v=12),b=!0,g="g"),(h||"0"===t&&"="===n)&&(h=!0,t="0",n="=");var y="$"===m?i:"#"===m&&/[boxX]/.test(g)?"0"+g.toLowerCase():"",w="$"===m?a:/[%p]/.test(g)?l:"",E=Ed[g],x=/[defgprs%]/.test(g);function k(e){var i,a,l,m=y,k=w;if("c"===g)k=E(e)+k,e="";else{var S=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:E(Math.abs(e),v),b&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),S&&0==+e&&"+"!==d&&(S=!1),m=(S?"("===d?d:c:"-"===d||"("===d?"":d)+m,k=("s"===g?Pd[8+pd/3]:"")+k+(S&&"("===d?")":""),x)for(i=-1,a=e.length;++i<a;)if(48>(l=e.charCodeAt(i))||l>57){k=(46===l?o+e.slice(i+1):e.slice(i))+k,e=e.slice(0,i);break}}p&&!h&&(e=r(e,1/0));var C=m.length+e.length+k.length,P=C<f?new Array(f-C+1).join(t):"";switch(p&&h&&(e=r(P+e,P.length?f-k.length:1/0),P=""),n){case"<":e=m+e+k+P;break;case"=":e=m+P+e+k;break;case"^":e=P.slice(0,C=P.length>>1)+m+e+k+P.slice(C);break;default:e=P+m+e+k}return s(e)}return v=void 0===v?6:/[gprs]/.test(g)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v)),k.toString=function(){return e+""},k}return{format:d,formatPrefix:function(e,t){var n,r=d(((e=bd(e)).type="f",e)),i=3*Math.max(-8,Math.min(8,Math.floor((n=t,((n=yd(Math.abs(n)))?n[1]:NaN)/3)))),a=Math.pow(10,-i),o=Pd[8+i/3];return function(e){return r(a*e)+o}}}}({thousands:",",grouping:[3],currency:["$",""]}),Sd=kd.format,kd.formatPrefix;const Md=Id(Td),Nd=Md.right,$d=(Md.left,Id((function(e){return null===e?NaN:+e})).center,Nd);function zd(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function jd(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function Ld(){}var Rd=.7,_d=1/Rd,Dd="\\s*([+-]?\\d+)\\s*",Fd="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Vd="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Ud=/^#([0-9a-f]{3,8})$/,Bd=new RegExp(`^rgb\\(${Dd},${Dd},${Dd}\\)$`),Hd=new RegExp(`^rgb\\(${Vd},${Vd},${Vd}\\)$`),Yd=new RegExp(`^rgba\\(${Dd},${Dd},${Dd},${Fd}\\)$`),Kd=new RegExp(`^rgba\\(${Vd},${Vd},${Vd},${Fd}\\)$`),Wd=new RegExp(`^hsl\\(${Fd},${Vd},${Vd}\\)$`),qd=new RegExp(`^hsla\\(${Fd},${Vd},${Vd},${Fd}\\)$`),Jd={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Qd(){return this.rgb().formatHex()}function Xd(){return this.rgb().formatRgb()}function Gd(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Ud.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?Zd(t):3===n?new nm(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?em(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?em(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=Bd.exec(e))?new nm(t[1],t[2],t[3],1):(t=Hd.exec(e))?new nm(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=Yd.exec(e))?em(t[1],t[2],t[3],t[4]):(t=Kd.exec(e))?em(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=Wd.exec(e))?lm(t[1],t[2]/100,t[3]/100,1):(t=qd.exec(e))?lm(t[1],t[2]/100,t[3]/100,t[4]):Jd.hasOwnProperty(e)?Zd(Jd[e]):"transparent"===e?new nm(NaN,NaN,NaN,0):null}function Zd(e){return new nm(e>>16&255,e>>8&255,255&e,1)}function em(e,t,n,r){return r<=0&&(e=t=n=NaN),new nm(e,t,n,r)}function tm(e,t,n,r){return 1===arguments.length?((i=e)instanceof Ld||(i=Gd(i)),i?new nm((i=i.rgb()).r,i.g,i.b,i.opacity):new nm):new nm(e,t,n,null==r?1:r);var i}function nm(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function rm(){return`#${sm(this.r)}${sm(this.g)}${sm(this.b)}`}function im(){const e=am(this.opacity);return`${1===e?"rgb(":"rgba("}${om(this.r)}, ${om(this.g)}, ${om(this.b)}${1===e?")":`, ${e})`}`}function am(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function om(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function sm(e){return((e=om(e))<16?"0":"")+e.toString(16)}function lm(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new um(e,t,n,r)}function cm(e){if(e instanceof um)return new um(e.h,e.s,e.l,e.opacity);if(e instanceof Ld||(e=Gd(e)),!e)return new um;if(e instanceof um)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),o=NaN,s=a-i,l=(a+i)/2;return s?(o=t===a?(n-r)/s+6*(n<r):n===a?(r-t)/s+2:(t-n)/s+4,s/=l<.5?a+i:2-a-i,o*=60):s=l>0&&l<1?0:o,new um(o,s,l,e.opacity)}function um(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function dm(e){return(e=(e||0)%360)<0?e+360:e}function mm(e){return Math.max(0,Math.min(1,e||0))}function hm(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}zd(Ld,Gd,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Qd,formatHex:Qd,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return cm(this).formatHsl()},formatRgb:Xd,toString:Xd}),zd(nm,tm,jd(Ld,{brighter(e){return e=null==e?_d:Math.pow(_d,e),new nm(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?Rd:Math.pow(Rd,e),new nm(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new nm(om(this.r),om(this.g),om(this.b),am(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rm,formatHex:rm,formatHex8:function(){return`#${sm(this.r)}${sm(this.g)}${sm(this.b)}${sm(255*(isNaN(this.opacity)?1:this.opacity))}`},formatRgb:im,toString:im})),zd(um,(function(e,t,n,r){return 1===arguments.length?cm(e):new um(e,t,n,null==r?1:r)}),jd(Ld,{brighter(e){return e=null==e?_d:Math.pow(_d,e),new um(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?Rd:Math.pow(Rd,e),new um(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new nm(hm(e>=240?e-240:e+120,i,r),hm(e,i,r),hm(e<120?e+240:e-120,i,r),this.opacity)},clamp(){return new um(dm(this.h),mm(this.s),mm(this.l),am(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=am(this.opacity);return`${1===e?"hsl(":"hsla("}${dm(this.h)}, ${100*mm(this.s)}%, ${100*mm(this.l)}%${1===e?")":`, ${e})`}`}}));const fm=e=>()=>e;function pm(e,t){var n=t-e;return n?function(e,t){return function(n){return e+n*t}}(e,n):fm(isNaN(e)?t:e)}const vm=function e(t){var n=function(e){return 1==(e=+e)?pm:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):fm(isNaN(t)?n:t)}}(t);function r(e,t){var r=n((e=tm(e)).r,(t=tm(t)).r),i=n(e.g,t.g),a=n(e.b,t.b),o=pm(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=a(t),e.opacity=o(t),e+""}}return r.gamma=e,r}(1);function bm(e){return function(t){var n,r,i=t.length,a=new Array(i),o=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=tm(t[n]),a[n]=r.r||0,o[n]=r.g||0,s[n]=r.b||0;return a=e(a),o=e(o),s=e(s),r.opacity=1,function(e){return r.r=a(e),r.g=o(e),r.b=s(e),r+""}}}function gm(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,a=new Array(i),o=new Array(r);for(n=0;n<i;++n)a[n]=Pm(e[n],t[n]);for(;n<r;++n)o[n]=t[n];return function(e){for(n=0;n<i;++n)o[n]=a[n](e);return o}}function ym(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function wm(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Em(e,t){var n,r={},i={};for(n in null!==e&&"object"==typeof e||(e={}),null!==t&&"object"==typeof t||(t={}),t)n in e?r[n]=Pm(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}bm(ld),bm((function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],a=e[r%t],o=e[(r+1)%t],s=e[(r+2)%t];return sd((n-r/t)*t,i,a,o,s)}}));var xm=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,km=new RegExp(xm.source,"g");function Sm(e,t){var n,r,i,a=xm.lastIndex=km.lastIndex=0,o=-1,s=[],l=[];for(e+="",t+="";(n=xm.exec(e))&&(r=km.exec(t));)(i=r.index)>a&&(i=t.slice(a,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:wm(n,r)})),a=km.lastIndex;return a<t.length&&(i=t.slice(a),s[o]?s[o]+=i:s[++o]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var n,r=0;r<t;++r)s[(n=l[r]).i]=n.x(e);return s.join("")})}function Cm(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(a){for(n=0;n<r;++n)i[n]=e[n]*(1-a)+t[n]*a;return i}}function Pm(e,t){var n,r,i=typeof t;return null==t||"boolean"===i?fm(t):("number"===i?wm:"string"===i?(n=Gd(t))?(t=n,vm):Sm:t instanceof Gd?vm:t instanceof Date?ym:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?gm:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Em:wm:Cm))(e,t)}function Tm(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function Am(e){return+e}var Im=[0,1];function Om(e){return e}function Mm(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function Nm(e,t,n){var r=e[0],i=e[1],a=t[0],o=t[1];return i<r?(r=Mm(i,r),a=n(o,a)):(r=Mm(r,i),a=n(a,o)),function(e){return a(r(e))}}function $m(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),a=new Array(r),o=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<r;)i[o]=Mm(e[o],e[o+1]),a[o]=n(t[o],t[o+1]);return function(t){var n=$d(e,t,1,r)-1;return a[n](i[n](t))}}function zm(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function jm(e){return Math.log(e)}function Lm(e){return Math.exp(e)}function Rm(e){return-Math.log(-e)}function _m(e){return-Math.exp(-e)}function Dm(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Fm(e){return(t,n)=>-e(-t,n)}function Vm(){const e=function(e){const t=e(jm,Lm),n=t.domain;let r,i,a=10;function o(){return r=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}(a),i=function(e){return 10===e?Dm:e===Math.E?Math.exp:t=>Math.pow(e,t)}(a),n()[0]<0?(r=Fm(r),i=Fm(i),e(Rm,_m)):e(jm,Lm),t}return t.base=function(e){return arguments.length?(a=+e,o()):a},t.domain=function(e){return arguments.length?(n(e),o()):n()},t.ticks=e=>{const t=n();let o=t[0],s=t[t.length-1];const l=s<o;l&&([o,s]=[s,o]);let c,u,d=r(o),m=r(s);const h=null==e?10:+e;let f=[];if(!(a%1)&&m-d<h){if(d=Math.floor(d),m=Math.ceil(m),o>0){for(;d<=m;++d)for(c=1;c<a;++c)if(u=d<0?c/i(-d):c*i(d),!(u<o)){if(u>s)break;f.push(u)}}else for(;d<=m;++d)for(c=a-1;c>=1;--c)if(u=d>0?c/i(-d):c*i(d),!(u<o)){if(u>s)break;f.push(u)}2*f.length<h&&(f=fd(o,s,h))}else f=fd(d,m,Math.min(m-d,h)).map(i);return l?f.reverse():f},t.tickFormat=(e,n)=>{if(null==e&&(e=10),null==n&&(n=10===a?"s":","),"function"!=typeof n&&(a%1||null!=(n=bd(n)).precision||(n.trim=!0),n=Sd(n)),e===1/0)return n;const o=Math.max(1,a*e/t.ticks().length);return e=>{let t=e/i(Math.round(r(e)));return t*a<a-.5&&(t*=a),t<=o?n(e):""}},t.nice=()=>n(function(e,t){var n,r=0,i=(e=e.slice()).length-1,a=e[r],o=e[i];return o<a&&(n=r,r=i,i=n,n=a,a=o,o=n),e[r]=t.floor(a),e[i]=t.ceil(o),e}(n(),{floor:e=>i(Math.floor(r(e))),ceil:e=>i(Math.ceil(r(e)))})),t}(function(){var e,t,n,r,i,a,o=Im,s=Im,l=Pm,c=Om;function u(){var e,t,n,l=Math.min(o.length,s.length);return c!==Om&&(e=o[0],t=o[l-1],e>t&&(n=e,e=t,t=n),c=function(n){return Math.max(e,Math.min(t,n))}),r=l>2?$m:Nm,i=a=null,d}function d(t){return null==t||isNaN(t=+t)?n:(i||(i=r(o.map(e),s,l)))(e(c(t)))}return d.invert=function(n){return c(t((a||(a=r(s,o.map(e),wm)))(n)))},d.domain=function(e){return arguments.length?(o=Array.from(e,Am),u()):o.slice()},d.range=function(e){return arguments.length?(s=Array.from(e),u()):s.slice()},d.rangeRound=function(e){return s=Array.from(e),l=Tm,u()},d.clamp=function(e){return arguments.length?(c=!!e||Om,u()):c!==Om},d.interpolate=function(e){return arguments.length?(l=e,u()):l},d.unknown=function(e){return arguments.length?(n=e,d):n},function(n,r){return e=n,t=r,u()}}()).domain([1,10]);return e.copy=()=>{return(t=e,n=Vm(),n.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())).base(e.base());var t,n},zm.apply(e,arguments),e}const Um=[16.35,17.32,18.35,19.45,20.6,21.83,23.12,24.5,25.96,27.5,29.14,30.87].map(((e,t)=>{const n=[{index:t,value:e}];for(let r=1;r<12;r++)n[r]={index:t,value:e*Math.pow(2,r)};return n})).flat().sort(((e,t)=>e.value-t.value));function Bm(e,t,n){return function(e,t){const n=e*t,r=n+t,i=Um.filter((e=>e.value>=n&&e.value<r));if(i.length>0)return i.map((({index:e})=>({index:e,value:1})));for(let e=0;e<Um.length;e++){const t=Um[e];if(t.value>r){const i=Um[e-1],a=t.value-i.value;return[{index:i.index,value:1-(r-i.value)/a},{index:t.index,value:1-(t.value-n)/a}]}}return[]}(t,n).map((({index:t,value:n})=>e[t]*n)).reduce(((e,t)=>e+t),0)}var Hm,Ym=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};Hm=new WeakMap;const Km=new class{constructor(e){this.intervalTypes=["bars","beats","sections","segments","tatums"],this.animationFrameId=0,this.currentTrackId="",this.currentTrackAnalysis=null,this.trackAnalysis={},this.initialTrackProgress=0,this.initialStart=0,this.trackProgress=0,this.active=!1,this.queues={volume:[],beat:[]},this.activeIntervals$=new Ie({bars:{},beats:{},sections:{},segments:{},tatums:{}}),Hm.set(this,0),this.fftSize=2048,this.volumeSmoothing=100,this.smoothingTimeConstant=0,this.minDecibels=-100,this.maxDecibels=-30,e.observeCurrentTrackState().subscribe((t=>Ym(this,void 0,void 0,(function*(){var n,r;const i=null===(r=null===(n=null==t?void 0:t.track_window)||void 0===n?void 0:n.current_track)||void 0===r?void 0:r.id;if(i&&this.currentTrackId!==i){this.currentTrackId=i,this.currentTrackAnalysis=null;try{this.currentTrackAnalysis=yield tl.getAudioAnalysisForTrack(i),t=yield e.getCurrentState()}catch(e){console.error(e),this.currentTrackAnalysis=null,t=null}}t&&this.currentTrackAnalysis&&this.updateState(t),this.active=!(!this.currentTrackAnalysis||!t||t.paused||t.loading),this.active?this.start():this.stop()}))))}get bar(){return this.activeIntervals.bars}get beat(){return this.activeIntervals.beats}get frequencyBinCount(){return this.fftSize/2}get section(){return this.activeIntervals.sections}get segment(){return this.activeIntervals.segments}get tatum(){return this.activeIntervals.tatums}get volume(){return function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)}(this,Hm,"f")}observeBar(){return this.observeActiveIntervals().pipe(Xt((e=>e.bars)),er())}observeBeat(){return this.observeActiveIntervals().pipe(Xt((e=>e.beats)),er())}observeSection(){return this.observeActiveIntervals().pipe(Xt((e=>e.sections)),er())}observeSegment(){return this.observeActiveIntervals().pipe(Xt((e=>e.segments)),er())}observeTatum(){return this.observeActiveIntervals().pipe(Xt((e=>e.tatums)),er())}getByteFrequencyData(e){if(!this.active)return void e.fill(0);const t=this.segment.pitches;if(t){const n=(this.segment.timbre[1]-180)/360,r=this.frequencyBinCount,i=ld([64,255*this.volume,64])(this.beat.progress);for(let a=0;a<r;a++){const o=Bm(t,a,this.sampleSize);let s=(a-r/2-n*r)/r+1;(s<0||s>2)&&(s=0),e[a]=Math.sin(s*(Math.PI/2))*o*i}}else e.fill(0)}getFloatFrequencyData(e){const t=e.length,n=new Uint8Array(e.length);this.getByteFrequencyData(n);for(let r=0;r<t;r++)e[r]=n[r]-128}getByteTimeDomainData(e){e.fill(128)}get activeIntervals(){return this.activeIntervals$.getValue()}get sampleSize(){return 22050/this.frequencyBinCount}observeActiveIntervals(){return id().pipe(yn((e=>e?cn:this.activeIntervals$)),ze((()=>this.active)))}updateState(e){return Ym(this,void 0,void 0,(function*(){this.trackAnalysis=JSON.parse(JSON.stringify(this.currentTrackAnalysis)),this.intervalTypes.forEach((e=>{const t=this.trackAnalysis[e];t[0].duration=t[0].start+t[0].duration,t[0].start=0,t.forEach((e=>{this.isSegment(e)&&(e.loudness_max_time=1e3*e.loudness_max_time),e.start=1e3*(e.start||0),e.duration=1e3*(e.duration||0)}))})),this.initialTrackProgress=e.position,this.trackProgress=e.position,this.initialStart=window.performance.now()}))}setActiveIntervals(){const e=this.activeIntervals,t=e=>{const t=this.trackAnalysis[e],n=this.trackProgress;for(let e=0;e<t.length;e++){if(e===t.length-1)return e;if(t[e].start<n&&n<t[e+1].start)return e}return 0};this.intervalTypes.forEach((n=>{const r=t(n);null!=e[n].start&&r===e[n].index||(e[n]=Object.assign(Object.assign({},this.trackAnalysis[n][r]),{index:r}));const{start:i,duration:a}=e[n],o=this.trackProgress-i;e[n].elapsed=o,e[n].progress=this.easeOutQuart(o/a)})),this.activeIntervals$.next(e)}getVolume(){const{loudness_max:e,loudness_start:t,loudness_max_time:n,duration:r,elapsed:i,start:a,index:o}=this.activeIntervals.segments;if(!this.trackAnalysis.segments[o+1])return 0;const s=this.trackAnalysis.segments[o+1].loudness_start,l=a+i;if(i<n){const r=Math.min(1,i/n);return this.interpolate(t,e)(r)}{const t=l-(a+n),i=r-n,o=Math.min(1,t/i);return this.interpolate(e,s)(o)}}start(){this.animationFrameId||(this.animationFrameId=requestAnimationFrame((e=>this.tick(e))))}stop(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}tick(e){if(this.animationFrameId=requestAnimationFrame((e=>this.tick(e))),!this.active)return;this.trackProgress=e-this.initialStart+this.initialTrackProgress,this.setActiveIntervals();const t=this.getVolume(),n=this.queues;function r(e){return e.reduce(((e,t)=>e+t))/e.length}n.volume.unshift(t),n.volume.length>400&&n.volume.pop(),n.beat.unshift(t),n.beat.length>this.volumeSmoothing&&n.beat.pop();const i=Vm().domain([cd(n.volume),r(n.volume)]).range([0,1]),a=r(n.beat);!function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?i.call(e,n):i?i.value=n:t.set(e,n)}(this,Hm,i(a)||0,"f")}interpolate(e,t){return n=>e*(1-n)+t*n}isSegment(e){return"loudness_max_time"in e}easeOutQuart(e){return e=Math.min(Math.max(0,e),1),1- --e*e*e*e}}(Nl);console.log("module::audio");const Wm=new AudioContext,qm=new AnalyserNode(Wm,{fftSize:2048,smoothingTimeConstant:0}),Jm=new class{constructor(e,t){this.analyserNode=e,this.spotifyAudioAnalyser=t,this.currentAnalyser=e,td().subscribe((({currentItem:n})=>{n.src.startsWith("spotify:")?this.currentAnalyser=t:this.currentAnalyser=e}))}get fftSize(){return this.analyserNode.fftSize}set fftSize(e){this.analyserNode.fftSize=e,this.spotifyAudioAnalyser.fftSize=e}get frequencyBinCount(){return this.analyserNode.frequencyBinCount}getByteFrequencyData(e){this.currentAnalyser.getByteFrequencyData(e)}getFloatFrequencyData(e){this.currentAnalyser.getFloatFrequencyData(e)}getByteTimeDomainData(e){this.currentAnalyser.getByteTimeDomainData(e)}}(qm,Km);let Qm,Xm;qm.connect(Wm.destination);const Gm=new Ie(Wm.createMediaElementSource(new Audio));function Zm(){return Gm.pipe(er())}td().subscribe((({currentItem:e})=>{if(e.src.startsWith("apple:")){if(!Xm){const e=document.querySelector("audio#apple-music-player");e&&(Xm=Wm.createMediaElementSource(e))}Xm&&Gm.next(Xm)}else{if(!Qm){const e=document.querySelector("audio.html5-audio");e&&(Qm=Wm.createMediaElementSource(e))}Qm&&Gm.next(Qm)}})),Zm().pipe(wl(1)).subscribe((e=>e.connect(qm)));const eh=new A("WaveformPlayer");class th extends Yu{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-waveform"}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e||this.animationFrameId||this.render(performance.now()))}appendTo(e){e.append(this.canvas)}load(e){eh.log("load"),e&&(eh.log(`Using Waveform visualizer: ${e.name}`),this.config=e.config),this.autoplay&&this.play()}play(){eh.log("play"),this.animationFrameId||this.render(performance.now())}pause(){eh.log("pause"),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}stop(){eh.log("stop"),this.pause(),this.clear()}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.renderFrame(performance.now())}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(e){this.renderFrame(e),this.autoplay&&!this.hidden&&(this.animationFrameId=requestAnimationFrame((e=>this.render(e))))}renderFrame(e){var t,n;const r=this.context2D,i=this.canvas.width,a=this.canvas.height,o=this.analyser;null===(n=null===(t=this.config)||void 0===t?void 0:t.onPaint)||void 0===n||n.call(t,{context2D:r,width:i,height:a,now:e,analyser:o})}}const nh=new th(Jm);nh.load({providerId:"waveform",name:"bars",config:{onPaint:({context2D:e,width:t,height:n,analyser:r})=>{const i=r.frequencyBinCount,a=new Uint8Array(i);r.getByteFrequencyData(a),e.clearRect(0,0,t,n),e.fillStyle=`rgba(255, 255, 255, ${document.fullscreenElement?.45:.6})`,e.strokeStyle="rgba(0, 0, 0, .9)",e.shadowColor="rgba(0, 0, 0, .6)",e.lineWidth=1,e.shadowBlur=2,e.shadowOffsetX=2,e.shadowOffsetY=2;const o=(t-48)/12,s=.0075*n,l=i/12;let c,u=4;for(let t=0;t<i;t+=l){const r=a.slice(t,t+l).reduce(((e,t)=>e+t),0)/l;c=s*r,e.fillRect(u,n-c/2,o,c/2+4),e.strokeRect(u,n-c/2,o,c/2+4),u+=o+4}}}});const rh=nh,ih=new A("ambientVideoPlayer"),ah=new Ku("video","ambient"),oh=new Iu("ambient"),sh=new z("ambientVideoPlayer");function lh(){return Qu.useAmbientVideoSource&&Qu.ambientVideoSource?"user-progress":"progress"}const ch=new Bu("ambient-video-player",[ah,oh,rh],(function(e){return e?e.src.startsWith("youtube:")?oh:ah:null}),(function(e,t){const n=t.src;if(n.startsWith("youtube:")){const[,,t]=n.split(":"),r=lh(),i=sh.getJson(r,{})[t]||("progress"===r?120:0);e.load(`${n}:${i}`)}else e.load(n)}));ch.loop=!0,ch.volume=0,ch.hidden=!0;const uh=new class extends Yu{constructor(e,t){super(),this.videoPlayer=e,this.beatsPlayer=t,Xu().pipe(Xt((e=>e.beatsOverlay)),er()).subscribe((e=>{this.beatsPlayer.hidden=this.hidden||!e}))}get autoplay(){return this.videoPlayer.autoplay}set autoplay(e){this.videoPlayer.autoplay=e,this.beatsPlayer.autoplay=e}get hidden(){return this.videoPlayer.hidden}set hidden(e){this.videoPlayer.hidden=e,this.beatsPlayer.hidden=e||!Qu.beatsOverlay}observeCurrentTime(){return this.videoPlayer.observeCurrentTime()}observeDuration(){return this.videoPlayer.observeDuration()}observeEnded(){return this.videoPlayer.observeEnded()}observeError(){return this.videoPlayer.observeError()}observePlaying(){return this.videoPlayer.observePlaying()}appendTo(e){this.videoPlayer.appendTo(e)}load(e){this.videoPlayer.load(e),this.autoplay&&Qu.beatsOverlay&&this.beatsPlayer.play()}play(){this.videoPlayer.play(),Qu.beatsOverlay&&this.beatsPlayer.play()}pause(){this.videoPlayer.pause(),this.beatsPlayer.pause()}stop(){this.videoPlayer.stop(),this.beatsPlayer.stop()}resize(e,t){this.videoPlayer.resize(e,t);const n=document.fullscreenElement?20:10;this.beatsPlayer.resize(xt.fontSize*n,xt.fontSize*n*.225)}}(ch,rh);oh.observeVideoId().pipe(yn((e=>e?oh.observeCurrentTime().pipe(Xt(Math.round),er(),ze((e=>e>0&&e%30==0)),yl(oh.observeDuration()),ze((([,e])=>e>600)),$e((([t])=>{const n=lh(),r=sh.getJson(n,{});r[e]=t,sh.setJson(n,r)}))):cn))).subscribe(ih),Xu().pipe(Xt((e=>e.ambientVideoSource)),er(),wl(1),$e((()=>sh.removeItem("user-progress")))).subscribe(ih);const dh="\nmo2re_RX3Bs blXien2Jh_o etiatMRgFcM DYsMJiwiZSI _MZ7UZ5frCI HCx1Z92PjJE dIP7wWY4Znw gW4nffCscYs\nA1m0SEqmmbE 9uZ8CCa0t4Y MXlFDpaQ1ec wz_ItcoR0-c jS4-FmNEDKo Tz77vqH_LJw K73lfmxDVR0 W8ayfyRWUrg\ncbuldALGsaQ AJZon2grzmA H5ASEM9dMiA GE2YEq7vaLc MYGOdJNAzrI Oszl95YWfbs b0-IkxXyhmY hoYPURX2RuE\nH6Xy97CD9Hs p-OUNPqRzII XaTxLSPh_Is 1n3ezT1cvAM CWU1pZVw0xM ry1Q7KaQdxM VlC5LSTvoj0 j-bG0j3-KzE\n1bClbVe4QyI f6OZ01vvmko o4jE24WixcI BIej9P2LrzM dxw91a7C5BQ lN9LdcAQnjw VVkZKzTbWQs vXCB1zGGFiY\nJHARFKMl8dU KSB1AZ0-I74 IGqfU6cJJc8 8zg22-ZCUfE WMlR8eJRS3I l4D6bnIdehk A5pbF_YBulo dRFRsKobN9I\nBur1ChHBNsQ IlDvBTDGanI SqMzG8xsynw mOmwk3WyYnw im2eWwIiTOc lxQS58t39_U yk076o8NF3k oggiHfuV4m8\np_GnUkm-G1M xVMsAgHy_IY VdZkfef44JI ZxOd8tmdsIM fszuqfJWKxc 0LGL_lx9XcA i_hU5eUrVIs qtwWkv9OdF0\nuZjCNtOeZG4 ZpXnEvW0XD0 -C8TYbhnVTU WzxSiEWK3cg ZE8vuq4aqNA 7HMw3bcIgRE ZJiCEDweLl8 lyh2kAjcmSY\nvFwqZ4qAUkE QLbPYQcUcgM xwf7EssFnXU QXac-wRKITA vvm8b2jAfv0 XkRFSnxXQ_w Ee0Qh_nIoHw 78rppSvbh7A\nNXIaYDJql1c e5eg-tOusSo ZkRjihsMdp8 e1M6jHcRrlM z9Ug-3qhrwY mA30W2dHQIo XIhEPwTMjWk -Tm4H4CrKT0\nT6tapzmF_n0 7QetsPh7BPM xBDqge4w-XA suWbFuw1O_I OvStKpL5Ujo ZX8fSO8uTPg xX9xfFT-Qw0 hf3r9TNSsyY\n-WIamcIaipI Zjc6DwVDvq0 eHjoav_sb88 7E0WVROBsEE BvLIJSmzAnY YPurG3WT8xI 0ocUnSG4oQQ EkmJlmU7uqw\naC7s2UVXt3c EJArkl7K29k 9eFVeErnUzg CLDzwdixWsk B1-yyoNMUzs Ab5I38wGxko sVuqgnXD9AE EqXNmIh0X4I\nY0U0HAwpw2s G20ZaQfTWgs Nde5P8Ob2xg f-Xul0mdBCA ExStG9rRkoY tMzCwwvHwN0 iaVmsp7dU1Y TV4J01qGE8E\nMPch_urCew8 eYpCCSAW3aw XfBNIrQ5JKQ -b68N6Q4Qus H3mdjo7kYiQ 9CJLtzzUphU yy-aMo2ds2k FFjGdNl5Sso\nLtPGmDskDiY U9rtWGI6H5A NHa506wwN0Y sFSrJSEFXu8 ubQKAfwSLDA aFsNz5VMyC8 h6yhFP_qUro GlotnVckHG4\nPEgQ0dIOB5c KWz3SXWnFys MGRDy2PqCGk 4DcMcAHrURw ETwbuC3p1ls iszl1WqjQIk njcvxMb8TVQ Vpi5By3PG68\nhNNN5xPyyeY 8ls8xBn70gM 2XREaQqoU1U MXL2qjIL4qI 9YqbQcfIre0 nAMkwo2eSbY 8DRItK-C7vU WdtkaLxc464\nPaIH77c53LA FSlhSL8bFoI XLuV3_a-ro0 mo7mUJZV6DM IqWPDr8KCmQ v-QS_Kh_i6o zowLNSKyfI0 Xn8tufsbSz0\n7gG4l70v8mw thurNCHVo08 YgryBZTMVZY XAmU3yQc90M KBUg3U3MRao v_My9t4gadA Xwb1xsWClCM KlH1g1x6RJk\nyFqew9NnNvk LMSmWzCqlPE oN3glsVrnRY PPBV3hem5iM eqzVRpevI8s nSJ67PGjQfQ EoBF2xRsbAc KDUYy3xwCFs\nRZOcoZS_52Q pSP9_otXcTU H36qe8NatNQ qgfd-uWTVwg Blu_yCEFYvk HeYMIBFtwh4 fb0QX7DbqLg kdqyAA0ILD4\nriZWEoGKyuU 4qo9bKRxgYA t0j_GdkG1BM hLq9J32lGRs zfc53CpvlZ4 IjNKQbm4AQ8 Ms0uDHae8FY tG991Undnbc\nsh8l2-cCAGQ XDE5pd4V_xc C2BVXFIX7bY ySPxZpoqXZ8 hiEUaLX4cCM wHxEyBMi1A4 YJSw3ougt9Y 2hUJBRUtrPU\nWsCCYv2adkM wmV7Po_E0pw 9Rvtm2zGEl4 DGlAMkUjcY0 h2s_WOkfTXk 0VhxPdtX0xg 6vuFh6NNa70 ukOHqdPbYYg\nH6OmEQ8RqVk qPp315pPVSI FQqj6gN7M6M Xrwks9O2-JQ ipRwt3TDgY4 aVqRyfRviwA X33dmu12C5c QEwzFKoG7tk\nh98nR30UD8Q Z7WpAwRjprI ilqlSBYfCGs V6SoeDWDon0 d-Hwz42Vfw4 RCdAP0e4W4w 22dlye7h3qU p7l6JQApzak\nblSZ365wpfQ ADF4KgfhzPs jSRvD7Uma1g uLMC6bL_q38 k9DuPxFQ7HQ 7f2taFPyqxc vHf4WQtJvdI NXg0IKlrz-Q\nORHIVufNfRM RT4hEmX5OJ0 H3GL5jO53NU acTsYqhq-AA vp2yiZnjK0w eR5vsN1Lq4E yyNl2HuCTHk 55w2VtMNuvY\n7qXiAaxxGBs m6m6bqHiT6U l5jUOT0XiUM NLxwmtJSvk4 dv_QzcJGHAE kaPD4n9uQ2k r7HpeG2ofU0 O1AQcFpPs04\n44ih4WRTyGg W5BmjLsEsB0 JkNlFaei_k8 2ttB1FzBpZ4 k3Q1vse7In8 7xltSb3VBJQ ojbiGfhnjTU _Qb7TJ-T1HM\ngvT3gIDSwq8 4X95pykbYTY BPDznHIgVMA OIA5xQWkk2U 2uQ58Xwx1V4 UVjCFpYMR6A -uww0BzTb7g EqWBy5i8LyQ\nszErNcJMCdA 5k1DGpr_qDw YNEkjkh0bYo jmjrpHYegzc Eye8xYrjm24 rVLOQB5kGGw F8MN0o6RS9o viim_l9gbF8\nsBtYWK817-0 g0IvwhzSIW0 y7vz1qQGUd8 -0ewPjoBBNI S1emxk9UWBE 1muEwEFDKgk P0MbbslO62E MPEvXbw3hYA\nwwXpkTd1CaQ W2A_PcIhUVM ZIb8u6uJwBo TWjid2dVjMk gdJjc6l6iII n3Dru5y3ROc OOf4Z7tyLVM iDXDrTKJehk\nwYhliE9O_3k nw0uvJZonBc cK7x6lUUsYo ltNMSx_imZU e2AUzM6QgGs 3cxyYOXiJss AsD5u6k6dKI d_hx39kXDUg\nhlvfDL3nSoo 6L2xYzu724E URy2Ak-WRpE 9N-sp0FaZEA yttvb9ByOtY ctqujFKaFZQ orTy-IqN9_I JdkM1EBCCKs\nef1wAfrMg5I eN-RZVkFGj0 yXuFVc_9Zgg -bp4Bgs7MaQ u1rRUwx_Vy4 iTjgWeJMUJo WL9EOfzoSsA xrCNwCD-z-M\nCC3AanQdQZA ZGLrP5eawdY HoOghpRTkvs N787WRdI35A Cw0d-nqSNE8 2vifO3_gjiM OeJ5xXrbkfU vkYBLYAGavM\njP4gBqxfheI HHi8qOtHnhE oN8q7p57nZw 6vnxzfejWN4 gVamQ6jodK0 iU5QjAbuhec qLIU_90P4Ac z8k_ximc8Og\nZFBoN7yIMZw 4mexI7cACZk bx-0YlFprqc NDWpXTg3koc Vo2AcHSCRiQ UrfJgjQt1SY WXI7byeZk5s y8d7Ihe0IwE\nubmUJcwor3k CGslieDL-04 w7ljU-lmaK4 I0B21LjeSUQ PyFN_FYwqvc bxy9PFJRJ0g ahmrb5EYoxY HGxuVWpN8vQ\nDNR1zyr5Go4 eyPhudLTuis aPWXL4ahxdY JB0A8Me8EKk dGy_6qyyY7c rxrDLgt5YFA uhcocK-td5E 4Z5FLeh7P18\nVB0zDS9ITmk VukLV0AoeFA CouF-tNHV3g lTvYjERVAnY S27YOjpgaaE 24uCC_-zaaE DslTxXsDLsw xilGAQPx5Xw\n9eu4yqpxQGU tdi8B0YzxHg R1OHRQoJOP0 fbqmVbEj9fg asL1AN3hifU rUkLoqxFOTw 3ma3yXXc3V8 1U1We59en3s\niNm7PPqO6rM CLRk8SgtVS4 VYO8Biwffns 9Wm8Ij8rHIE ZMOC332wC7A doORhRob3Qg E2sSvVCRI4s 2aVxI4PSiDI\nE6Ww7lpuZ2k Ueqm3PQKYPk eFiKAcbp2MY dAfMgDBeqwU MsUOx11_eLk LAFK1EvwulU OF0iDephya8 L_mlofcsRaA\neZe4Q_58UTU NXObT_Fl-xI t6jlhqNxRYk _WkkH31sTMI ALJcKvnOjHM 85Y1N8avsXs NCY42RnUpCE 48rsDblF5Ig\n0Tpq2mLtXDc Zp1Oajc7VQw WGi4XiEGe8M b6L40CEYVyM Mw9qiV7XlFs UgHKb_7884o mvIYmMo906E VoXOYFlJTuI\nfsjdpo1o-J8 k9rKpHXwA1E MTG3VA-m6qk cU3XY6Ii8v0 NBIdmswtcnM k5sznEJz8BA R8W3U0Mu6t4 7iSOMLkFizU\n6KBo0GhU9XM d5R3FK9vLBs N5b7Iy4W0ow epD5ixtaID0 pughd7ysJyQ A-mPDdnzipI 6gqU-HL68wE 3ODGCQ-kjGA\nVIlQIVVLWVs 6A-kQCdEIpI _lisL6tLbdg VarS6olPfTA va306f9aN3A YlPawyXaMJI KpFU_kIw6To hNC6-bxHJac\nbHK0ZvQzfOY PkF4EKJQOOg 0aMUCiKjBDI D1KsEOUqCEU JdE_xc1rQBY omlVslJvzxQ FoS3732REf0 kNMOaRRBat4\nqqC80mXlOKo MS2asGj1-_M NmP0RylitI4 IahW6hJ1-SM 9MIJm1NeUpE 2qzbMPpgtDw H3UY2gQfj-s 9kekiNImlsI\n5zUCClmhjF0 88jpBZdsrT8 UdFae3BAH38 MAFdQs_yWvg xkAUTCdoteI p7G1lkYIFTM JX19TZp8gDQ 7TML_MTQdg4\nSH4f_DnPIto v-A03t6-Kss 5rf_gOfa7O4 MYG6FeY4SKg AVzdfRpE9Q0 1UxoHtG2qas o7XgU4ut6jQ IcOYM87wTRc\noPetbPLA8dM F41dgN-mwrE tpRBHKAJ_tU sTy4stPcD0E p4jroQX6Hwk y2Zl-KXvdSk zffchwaq6KE jv7hNnJEWPU\nDN-BxbMH264 mWaC_VSncEg 8x5Yzxi3LhA 0Txa_T4pHY4 McT_FUPZR5k 5rTo8-CPgU4 WbUgBaEsugI QytjUFgcmWw\n6BLY2zj6pq0 W5Y0deEEszo U6jAaBK7idQ rHZlMW_zxaE 4Xp4J5RYns0 Xsf2ThMqNBM lUbOyYp91NU dpuTxI8KAyc\nOIoAJfLDW1U bXK3EZ1AOZ0 nV62c0XBLDg 7ZWSdWxHAzY LVJHOKOIXK4 8QdnY1lACEs BfkdRwJAeu8 qyCXiUtWhD0\nXLNixgPHzao Q-iZMkvHnFw O47-jQYPznA H0RwPrdQs9g 5hkJkYLounY tlgv2urELis zHAbIALBaog cvoo5xXtiEA\nRpHnKaxt_OQ GsqsG3axUCs eMv6SCniTPg 5BdpkKiY3Fw _85ElkxtQa4 xCfEA0kuNww zsdPYFPTdw0 9pTT6867XJ4\nDUhdSWsapuA EmxS4JvlT5k CGBPXRi1nrM P9iRIGoIc9g Cy3okiPj26M TaKvapV_BwU jg5mnvYmrzU eG89_Vk_cqE\nwqoJj3ZJnXA N3DgwOn9yGI mvUV0FNBnGI 5FJWKoV07VM VaTBFaLFvHk EwlhQziQ-kw c9Ydsd89vWc Id83Esvmmb0\n09h57SoWrvE kwgeurY2omQ uLZlVUnQYY8 4jdV5FbvHpM 44KChB6CQOI XCUk8cRysW4 IEEjSXfMXXI _8fm1yqbPA4\n0hvAQ9hE-V0 df2q8ciX2rU p08ErTYMOh0 MvmxZj9Bo1I fDZYQD1GDd4 cJwiiXmPg-Y 9lDC8o24H_g pYqScYQZ-o8\nQ7W4JISNmQk fryghm20GnQ jgtcAEUtgF4 XPKTAyKWoIo n5PqysUA4lU 0bJWDOTyCTY YJJA6pUx2FY StOmRbPJIZg\nhsNMJp8G5tA pO13fJttJBE iw44ObI2cig 0KIWOl_lF2A 001TlVo_jmg kt0qIFPQBJg 0tZ2Y8kpCLI bzADvjia-mw\nqZezMIk7Oq4 ZHNYXUmEGoU 8dFr3YqPaeg M9KXG8jCq2U djP_T_rp09s Tyd_wjLfA_E ymRww99Yb-I zQrgF2izz2Y\nW0Kl0QfMEPo FDqQlAUDZyk fd8spJiYS0k JBm1ainuk-c fVRSSNkq3Bk 2FE1_YK5OPI VWHTlq5Fcr8\n".match(/\S+/g).map((e=>({providerId:"ambientvideo",name:e,src:`youtube:video:${e}`})));console.log("Default ambient videos:",dh.length);const mh=new A("ambientvideo/visualizers"),hh=new Ie([]);function fh(){return hh}Xu().pipe(Ql(1),Xt((e=>!!e.ambientVideoEnabled)),er(),yn((e=>e?Xu().pipe(Xt((e=>!!e.useAmbientVideoSource)),er(),yn((e=>e?Xu().pipe(Xt((e=>e.ambientVideoSource||"")),er(),yn((e=>e?function(e){return t=this,n=void 0,i=function*(){const t=So(e),[,n,r]=t.split(":");let i=[r];return"playlist"===n&&(i=yield function(e){return Ou(this,void 0,void 0,(function*(){const t=new Nu(e);try{return yield t.loadPlaylist()}finally{t.destroy()}}))}(t)),i.map((e=>({providerId:"ambientvideo",name:e,src:`youtube:video:${e}`})))},new((r=void 0)||(r=Promise))((function(e,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(o,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e):Pn([])))):Pn(dh)))):Pn([]))),lr((e=>(mh.error(e),Pn([]))))).subscribe(hh),fh().pipe(Xt((e=>e.length)),Is((e=>0===e))).subscribe(mh.rx("size"));const ph={id:"ambientvideo",name:"Ambient Video",defaultHidden:!0,player:uh,get visualizers(){return hh.getValue()},observeVisualizers:fh},vh=new A("AmpShaderPlayer");const bh=new Ie([]);setTimeout((()=>{return e=void 0,t=void 0,i=function*(){const{default:e}=yield n.e(595).then(n.bind(n,7069));e&&bh.next(e)},new((r=void 0)||(r=Promise))((function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())}));var e,t,r,i}),1e3);const gh=new class extends Yu{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.gl=this.canvas.getContext("webgl"),this.animationFrameId=0,this.fragTheme=null,this.fragTime=null,this.fragChannelTime=null,this.fragDate=null,this.shader=null,this.startTime=performance.now();const t=this.gl;this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-ampshader",t.getExtension("OES_standard_derivatives"),t.getExtension("EXT_shader_texture_lod");const n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const r=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,r);const i=new Float32Array([-1,-1,1,-1,-1,1,1,1]);t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),t.vertexAttribPointer(0,2,t.FLOAT,!1,0,0)}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e||this.animationFrameId||this.render())}appendTo(e){e.append(this.canvas)}load(e){vh.log("load"),e&&(vh.log(`Using Ampshader visualizer: ${e.name}`),this.createShader(e.shader)),this.play()}play(){vh.log("play"),this.animationFrameId||this.render()}pause(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}stop(){this.pause(),this.clear()}resize(e,t){const n=this.canvas,r=this.gl;if(n.width=e,n.height=t,r.viewport(0,0,e,t),this.shader){const e=r.getUniformLocation(this.shader,"iResolution");r.uniform2f(e,n.width,n.height),this.renderFrame()}}get currentDate(){const e=new Date;return[e.getFullYear(),e.getMonth()+1,e.getDate(),3600*e.getHours()+60*e.getMinutes()+e.getSeconds()+.001*e.getMilliseconds()]}get currentTime(){return(performance.now()-this.startTime)/1e3}get themeColor(){const{r:e,g:t,b:n}=new Ge(xt.frameColor).toRgb();return[e,t,n,1]}clear(){}createShader(e){const t=this.gl,n=t.createShader(t.VERTEX_SHADER);if(t.shaderSource(n,"attribute vec2 position;void main(void){gl_Position=vec4(position,0,1);}"),t.compileShader(n),!t.getShaderParameter(n,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(n));const r=t.createShader(t.FRAGMENT_SHADER);if(t.shaderSource(r,e),t.compileShader(r),!t.getShaderParameter(r,t.COMPILE_STATUS))throw new Error(t.getShaderInfoLog(r));const i=t.createProgram();t.attachShader(i,n),t.attachShader(i,r),t.linkProgram(i),t.useProgram(i);const a=t.getAttribLocation(i,"position");t.enableVertexAttribArray(a),this.fragTheme=t.getUniformLocation(i,"iTheme"),t.uniform4f(this.fragTheme,...this.themeColor);const o=this.currentTime;this.fragTime=t.getUniformLocation(i,"iTime"),t.uniform1f(this.fragTime,o),this.fragChannelTime=t.getUniformLocation(i,"iChannelTime"),t.uniform1fv(this.fragChannelTime,new Float32Array([o,0,0,0])),this.fragDate=t.getUniformLocation(i,"iDate"),t.uniform4f(this.fragDate,...this.currentDate);const s=t.getUniformLocation(i,"iResolution");t.uniform2f(s,this.canvas.width,this.canvas.height),this.shader=i}render(){this.renderFrame(),this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((()=>this.render())))}renderFrame(){if(this.shader){const e=this.gl,t=new Uint8Array(this.analyser.frequencyBinCount),n=new Uint8Array(4*t.length);this.analyser.getByteFrequencyData(t);for(let e=0;e<t.length;e++)n[4*e+0]=t[e],n[4*e+1]=t[e],n[4*e+2]=t[e],n[4*e+3]=255;const r=this.currentTime;e.uniform1f(this.fragTime,r),e.uniform1fv(this.fragChannelTime,new Float32Array([r,0,0,0])),e.uniform4f(this.fragDate,...this.currentDate),e.uniform4f(this.fragTheme,...this.themeColor),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t.length,1,0,e.RGBA,e.UNSIGNED_BYTE,n),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)}}}(Jm),yh={id:"ampshader",name:"ampshader",player:gh,get visualizers(){return bh.getValue()},observeVisualizers:function(){return bh}};var wh=n(8841);const Eh=new A("AudioMotionPlayer"),xh="audiomotion",kh=[{providerId:xh,name:"Anemone",options:{radial:!0,ledBars:!1,spinSpeed:1,mode:8,barSpace:0,gradient:"ampcast-rainbow",reflexRatio:.4,showPeaks:!0,mirror:-1,maxFreq:8e3,lineWidth:2,fillAlpha:.2}},{providerId:xh,name:"Classic LEDs",options:{mode:7,barSpace:0,gradient:"ampcast-classic",ledBars:!0,lumiBars:!1,radial:!1,reflexRatio:0,showPeaks:!0}},{providerId:xh,name:"Mirror wave",options:{mode:10,fillAlpha:.6,gradient:"ampcast-rainbow",lineWidth:2,mirror:-1,radial:!1,reflexAlpha:1,reflexBright:1,reflexRatio:.5,showPeaks:!1}},{providerId:xh,name:"Radial overlay",options:{mode:5,barSpace:.1,gradient:"ampcast-prism",radial:!0,ledBars:!1,showPeaks:!0,spinSpeed:1}},{providerId:xh,name:"Reflex Bars",options:{mode:5,barSpace:.25,gradient:"ampcast-prism",lumiBars:!1,radial:!1,reflexAlpha:.25,reflexBright:1,reflexFit:!0,reflexRatio:.3,ledBars:!1,showPeaks:!0}}];console.log("audioMotion-analyzer visualizers:",kh.length);const Sh=kh,Ch=new class extends Yu{constructor(e,t){super();const n=this.element=document.createElement("div");n.hidden=!0,n.className="visualizer visualizer-audiomotion";const r=this.visualizer=new wh.Z(n,{audioCtx:e,showBgColor:!1,overlay:!0,showScaleX:!1,showScaleY:!1,connectSpeakers:!1});t.subscribe((e=>{this.audioSourceNode=e,this.element.hidden||r.connectInput(e)})),xt.observe().pipe($e((()=>this.registerGradients()))).subscribe(Eh)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden!==e&&(this.element.hidden=e,e?this.visualizer.disconnectInput():this.audioSourceNode&&this.visualizer.connectInput(this.audioSourceNode))}appendTo(e){e.append(this.element)}load(e){Eh.log("load"),e&&(Eh.log(`Using AudioMotion visualizer: ${e.name}`),this.visualizer.setOptions(e.options)),this.autoplay&&this.play()}play(){Eh.log("play"),this.visualizer.toggleAnalyzer(!0)}pause(){Eh.log("pause"),this.visualizer.toggleAnalyzer(!1)}stop(){this.visualizer.toggleAnalyzer(!0)}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}registerGradients(){const e=new Ge(xt.isMediaButtonLight?xt.mediaButtonColor:xt.defaultMediaButtonColor),t=[new Ge(xt.mediaButtonColor),new Ge(xt.defaultMediaButtonColor),new Ge(xt.frameColor),new Ge(xt.frameTextColor),new Ge(xt.backgroundColor),new Ge(xt.textColor)].filter((e=>e.getBrightness()<200&&e.getLuminance()>.3&&e.toHsl().s>.3)).sort(((e,t)=>t.getLuminance()-e.getLuminance()))[0]||e,n=t.tetrad().map((e=>e.toRgbString())).slice(1);this.visualizer.registerGradient("ampcast-classic",{bgColor:xt.black,colorStops:[n[0],{pos:.6,color:n[1]},n[2]]}),this.visualizer.registerGradient("ampcast-prism",{bgColor:xt.black,colorStops:xt.getVisualizerColors()}),this.visualizer.registerGradient("ampcast-rainbow",{bgColor:xt.black,colorStops:e.analogous().map((e=>e.toRgbString()))})}}(Wm,Zm()),Ph={id:"audiomotion",name:"audioMotion-analyzer",externalUrl:"https://audiomotion.dev/",player:Ch,visualizers:Sh,observeVisualizers:()=>Pn(Sh)};var Th=n(2238),Ah=n.n(Th);const Ih=new A("ButterchurnPlayer");const Oh=new Ie([]);function Mh(){return Oh.getValue()}setTimeout((()=>{return e=void 0,t=void 0,i=function*(){const e="butterchurn",{default:t}=yield n.e(577).then(n.t.bind(n,6607,23));if(t){Oh.next(Object.keys(t).map((n=>({providerId:e,name:n,data:t[n]}))));const{default:r}=yield n.e(271).then(n.t.bind(n,3710,23));r&&Oh.next(Mh().concat(Object.keys(r).map((t=>({providerId:e,name:t,data:r[t]})))))}},new((r=void 0)||(r=Promise))((function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){e.done?n(e.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(e.value).then(o,s)}l((i=i.apply(e,t||[])).next())}));var e,t,r,i}),1e3);const Nh=new class extends Yu{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-butterchurn",(this.visualizer=Ah().createVisualizer(e.context,this.canvas,{width:400,height:200})).connectAudio(e)}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e?this.visualizer.disconnectAudio(this.analyser):(this.visualizer.connectAudio(this.analyser),this.animationFrameId||this.render()))}appendTo(e){e.append(this.canvas)}load(e){e&&(Ih.log(`Using Butterchurn visualizer: ${e.name}`),this.visualizer.loadPreset(e.data,.5),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0),this.render())}play(){Ih.log("play"),this.animationFrameId||this.render()}pause(){Ih.log("pause"),this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}stop(){this.pause(),this.clear()}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.visualizer.render(),this.visualizer.setRendererSize(e,t),this.visualizer.render()}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(){this.visualizer.render(),this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((()=>this.render())))}}(qm),$h={id:"butterchurn",name:"Butterchurn (Milkdrop)",externalUrl:"https://butterchurnviz.com/",player:Nh,get visualizers(){return Mh()},observeVisualizers:function(){return Oh}},zh=new A("SpotifyVizPlayer");let jh="",Lh="";const Rh={volumeSmoothing:10,onBar(){const e=xt.getVisualizerColors();jh=Lh||E(e),Lh=E(e.filter((e=>e!==Lh)))},onPaint({context2D:e,height:t,width:n,now:r,analyser:i}){const a=ld([0,10*i.volume,0])(i.bar.progress),o=ld([0,300*i.volume,0])(i.beat.progress),{r:s,g:l,b:c}=new Ge(xt.black).toRgb(),u=`${s},${l},${c}`;e.fillStyle=`rgba(${u},0.08)`,e.fillRect(0,0,n,t),e.lineWidth=a,e.strokeStyle=vm(jh,Lh)(i.bar.progress),function(e,t,n,r,i,a=5){const o=e=>r*Math.sin(e/i+t)+n,{width:s}=e.canvas;e.beginPath();for(let t=-50;t<s+50;t+=a)-50===t?e.moveTo(t,o(t)):e.lineTo(t,o(t))}(e,r/50,t/2,50*i.volume,100),e.stroke(),e.fillStyle=`rgb(${u})`,e.beginPath(),e.lineWidth=o,function(e,t,n,r,i=0,a=2*Math.PI){e.beginPath(),e.arc(t,n,r,i,a),e.closePath()}(e,n/2,t/2,i.volume*t/5+o/10),e.stroke(),e.fill()}},_h=[{providerId:"spotifyviz",name:"example by zachwinter",config:Rh,externalUrl:"https://github.com/zachwinter/spotify-viz/blob/master/client/example.js"}],Dh=_h;console.log("spotify-viz visualizers:",_h.length);const Fh=new class extends Yu{constructor(e){super(),this.analyser=e,this.canvas=document.createElement("canvas"),this.context2D=this.canvas.getContext("2d"),this.animationFrameId=0,this.canvas.hidden=!0,this.canvas.className="visualizer visualizer-spotifyviz",e.observeBar().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onBar)||void 0===n||n.call(t,e)})),e.observeBeat().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onBeat)||void 0===n||n.call(t,e)})),e.observeSection().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onSection)||void 0===n||n.call(t,e)})),e.observeSegment().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onSegment)||void 0===n||n.call(t,e)})),e.observeTatum().subscribe((e=>{var t,n;null===(n=null===(t=this.config)||void 0===t?void 0:t.onTatum)||void 0===n||n.call(t,e)}))}get hidden(){return this.canvas.hidden}set hidden(e){this.canvas.hidden!==e&&(this.canvas.hidden=e,e||this.animationFrameId||this.render(performance.now()))}appendTo(e){e.append(this.canvas)}load(e){var t,n;zh.log("load"),e&&(zh.log(`Using SpotifyViz visualizer: ${e.name}`),this.config=e.config,this.analyser.volumeSmoothing=null!==(n=null===(t=e.config)||void 0===t?void 0:t.volumeSmoothing)&&void 0!==n?n:100),this.autoplay&&this.play()}play(){zh.log("play"),this.animationFrameId||this.render(performance.now())}pause(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=0)}stop(){this.pause(),this.clear()}resize(e,t){this.canvas.width=e,this.canvas.height=t,this.renderFrame(performance.now())}clear(){const e=this.canvas.width,t=this.canvas.height;this.context2D.clearRect(0,0,e,t)}render(e){this.renderFrame(e),this.autoplay&&!this.canvas.hidden&&(this.animationFrameId=requestAnimationFrame((e=>this.render(e))))}renderFrame(e){var t,n;const r=this.context2D,i=this.canvas.width,a=this.canvas.height,o=this.analyser;null===(n=null===(t=this.config)||void 0===t?void 0:t.onPaint)||void 0===n||n.call(t,{context2D:r,width:i,height:a,now:e,analyser:o})}}(Km),Vh={id:"spotifyviz",name:"spotify-viz",externalUrl:"https://github.com/zachwinter/spotify-viz/",player:Fh,visualizers:Dh,observeVisualizers:()=>Pn(Dh)};function Uh(){return xt.isLight&&xt.isFrameLight?xt.frameColor:xt.isTextLight?xt.textColor:xt.frameTextColor}const Bh=[{providerId:"waveform",name:"wave",config:{onPaint:({context2D:e,width:t,height:n,analyser:r})=>{const i=r.frequencyBinCount,a=new Uint8Array(i),o=t/i;let s=0;e.lineWidth=Math.round(xt.fontSize/4),e.clearRect(0,0,t,n),e.strokeStyle=Uh(),e.beginPath(),r.getByteTimeDomainData(a);for(let t=0;t<i;t++){const r=a[t]/128*n/2;0===t?e.moveTo(s,r):e.lineTo(s,r),s+=o}e.lineTo(t,n/2),e.stroke()}}},{providerId:"waveform",name:"bars",config:{onPaint:({context2D:e,width:t,height:n,analyser:r})=>{const i=r.frequencyBinCount,a=new Uint8Array(i);r.getByteFrequencyData(a),e.clearRect(0,0,t,n),e.fillStyle=Uh();const o=(t-30)/16,s=.0075*n,l=i/16;let c,u=0;for(let t=0;t<i;t+=l){const r=a.slice(t,t+l).reduce(((e,t)=>e+t),0)/l;c=s*r,e.fillRect(u,n-c/2,o,c/2),u+=o+2}}}}],Hh=Bh;console.log("Waveform visualizers:",Bh.length);const Yh={id:"waveform",name:"Waveform",externalUrl:"https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API/Visualizations_with_Web_Audio_API",player:new th(Jm),visualizers:Hh,observeVisualizers:()=>Pn(Hh)};function Kh(){return[ph,yh,Ph,$h,Vh,Yh]}function Wh(e){return Kh().find((t=>t.id===e))}function qh(e){var t;return(null===(t=Wh(e))||void 0===t?void 0:t.visualizers)||[]}console.log("module::visualizerPlayer");const Jh=new A("visualizerPlayer"),Qh=new Bu("visualizer-player",Kh().map((e=>e.player)),(function(e){return function(e){var t;return null===(t=Wh(e))||void 0===t?void 0:t.player}(e.providerId)||null}),(function(e,t){e.load(t)}));Qh.loop=!0,Qh.muted=!0,Qh.volume=.07,Qh.observeError().subscribe(Jh.error);const Xh=Qh;var Gh,Zh,ef=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},tf=function(e,t,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(e,n):i?i.value=n:t.set(e,n),n};const nf=new A("MusicKitPlayer"),rf="Apple Music player not connected.",af="Video playback not supported.";Gh=new WeakMap,Zh=new WeakMap;const of=new class{constructor(e){this.isLoggedIn$=e,this.paused$=new Ie(!0),this.duration$=new Te,this.currentTime$=new Te,this.ended$=new Te,this.playing$=new Te,this.error$=new Te,this.playerReady$=new Te,this.activated$=new Ie(!1),this.src$=new Ie(""),this.loadedSrc="",this.isLoggedIn=!1,this.hasPlayed=!1,this.loop=!1,this.autoplay=!1,Gh.set(this,!0),Zh.set(this,1),this.onPlaybackStateChange=({state:e})=>{switch(e){case MusicKit.PlaybackStates.playing:{const[,,e]=this.src.split(":"),t=this.player.nowPlayingItem;!1===(null==t?void 0:t.isPlayable)&&(null==t?void 0:t.id)===e?(this.error$.next(Error("Unplayable")),this.stop()):this.paused?this.pause():this.playing$.next(void 0);break}case MusicKit.PlaybackStates.ended:this.ended$.next(void 0)}},this.onPlaybackDurationChange=({duration:e})=>{this.duration$.next(e)},this.onPlaybackTimeChange=({currentPlaybackTime:e})=>{this.currentTime$.next(e)},this.onPlaybackError=e=>{this.error$.next(e)};const t=this.element=document.createElement("div");t.hidden=!0,t.className="apple-video",t.id="apple-music-video-container",this.observeIsLoggedIn().pipe(ze((e=>e)),$e((()=>{const e=this.player=MusicKit.getInstance(),t=MusicKit.Events;e.addEventListener(t.playbackStateDidChange,this.onPlaybackStateChange),e.addEventListener(t.playbackDurationDidChange,this.onPlaybackDurationChange),e.addEventListener(t.playbackTimeDidChange,this.onPlaybackTimeChange),e.addEventListener(t.mediaPlaybackError,this.onPlaybackError),e.volume=this.muted?0:this.volume,this.playerReady$.next(void 0)})),mr(1)).subscribe(nf),this.observeReady().pipe(yn((()=>this.observeIsLoggedIn())),yn((e=>e?this.observePaused():cn)),yn((e=>e?cn:this.observeSrc())),yn((e=>{if(e&&e!==this.loadedSrc){if(!this.canPlay(e))return this.error$.next(Error(af)),cn;const[,t,n]=e.split(":"),r=t.replace("library-","").replace(/s$/,"").replace(/-([a-z])/g,((e,t)=>t.toUpperCase()));return vn(this.player.setQueue({[r]:n})).pipe(yn((()=>(this.loadedSrc=e,this.autoplay?this.safePlay():cn))),lr((e=>(this.loadedSrc="",this.error$.next(e),cn))))}return cn}))).subscribe(nf),this.observeIsLoggedIn().pipe(Is((e=>e===this.isLoggedIn))).subscribe((e=>{var t;this.isLoggedIn=e,!e&&(null===(t=this.player)||void 0===t?void 0:t.isPlaying)&&(this.stop(),this.error$.next(Error(rf)))})),this.observeError().subscribe(nf.error)}get hidden(){return this.element.hidden}set hidden(e){this.element.hidden=e}get muted(){return ef(this,Gh,"f")}set muted(e){ef(this,Gh,"f")!==e&&(tf(this,Gh,e,"f"),this.player&&(this.player.volume=e?0:this.volume))}get volume(){return ef(this,Zh,"f")}set volume(e){ef(this,Zh,"f")!==e&&(tf(this,Zh,e,"f"),this.player&&(this.player.volume=this.muted?0:e))}observeCurrentTime(){return this.currentTime$.pipe(er())}observeDuration(){return this.duration$.pipe(er())}observePlaying(){return this.playing$}observeEnded(){return this.ended$}observeError(){return this.error$}appendTo(e){e.appendChild(this.element)}load(e){nf.log("load",{src:e}),this.autoplay&&this.activated$.next(!0),this.src$.next(e),this.autoplay&&this.paused$.next(!1),this.player&&this.isLoggedIn?this.autoplay&&(e===this.loadedSrc?this.safePlay():this.canPlay(e)||this.error$.next(Error(af))):this.autoplay&&this.error$.next(Error(rf))}play(){nf.log("play"),this.activated$.next(!0),this.paused$.next(!1),this.player&&this.isLoggedIn?this.src===this.loadedSrc?this.safePlay():this.canPlay(this.src)||this.error$.next(Error(af)):this.error$.next(Error(rf))}pause(){var e;nf.log("pause"),this.paused$.next(!0),(null===(e=this.player)||void 0===e?void 0:e.isPlaying)&&this.player.pause()}stop(){nf.log("stop"),this.paused$.next(!0),this.hasPlayed&&this.player.stop()}seek(e){var t;null===(t=this.player)||void 0===t||t.seekToTime(e)}resize(e,t){this.element.style.width=`${e}px`,this.element.style.height=`${t}px`}get paused(){return this.paused$.getValue()}get src(){return this.src$.getValue()}observeIsLoggedIn(){return this.isLoggedIn$}observePaused(){return this.paused$.pipe(er())}observeReady(){return this.playerReady$.pipe(yn((()=>this.activated$)),ze((e=>e)),Xt((()=>{})),mr(1))}observeSrc(){return this.src$.pipe(er())}canPlay(e){var t;return!(null===(t=this.player)||void 0===t?void 0:t.version.startsWith("1"))||!/musicVideo/.test(e)}safePlay(){var e,t,n,r,i;return t=this,n=void 0,i=function*(){try{!1===(null===(e=this.player)||void 0===e?void 0:e.isPlaying)&&(yield this.player.play(),this.hasPlayed=!0)}catch(e){this.error$.next(e)}},new((r=void 0)||(r=Promise))((function(e,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(o,s)}l((i=i.apply(t,n||[])).next())}))}}(Ir());console.log("module::mediaPlayer");const sf=new Ku("audio","main"),lf=new Ku("video","main"),cf=new Iu("main"),uf=new Bu("media-player",[sf,lf,cf,of,Nl],(function(e){return e?e.src.startsWith("youtube:")?cf:e.src.startsWith("apple:")?of:e.src.startsWith("spotify:")?Nl:e.mediaType===Nr.Video?lf:sf:null}),(function(e,t){if(null==t?void 0:t.unplayable)throw Error("Unplayable.");e.load(function(e){return e?e.blob?URL.createObjectURL(e.blob):e.src||"":""}(t))}));var df=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::jellyfinReporting");const mf=new A("jellyfinReporting");function hf(e,t,n,r){return df(this,void 0,void 0,(function*(){try{const[,,i]=e.src.split(":");yield gi.post("Sessions/Playing/Progress",{ItemId:i,IsPaused:n,PositionTicks:Math.floor(1e7*t),PlayMethod:"Transcode",EventName:r})}catch(e){mf.error(e)}}))}console.log("module::jellyfinScrobbler");const ff=new A("jellyfinScrobbler"),pf=e=>{var t;return!!(null===(t=e.currentItem)||void 0===t?void 0:t.src.startsWith("jellyfin:"))};Ui().pipe(yn((e=>e?td():cn)),ze(pf),Zt((({currentItem:e})=>function(e){return df(this,void 0,void 0,(function*(){try{const[,,t]=e.src.split(":");yield gi.post("Sessions/Playing",{ItemId:t,IsPaused:!1,PositionTicks:0,PlayMethod:"Transcode"})}catch(e){mf.error(e)}}))}(e)))).subscribe(ff),Ui().pipe(yn((e=>e?nd():cn)),ze(pf),Zt((({currentItem:e,currentTime:t})=>function(e,t){return df(this,void 0,void 0,(function*(){try{const[,,n]=e.src.split(":");yield gi.post("Sessions/Playing/Stopped",{ItemId:n,IsPaused:!1,PositionTicks:Math.floor(1e7*t),PlayMethod:"Transcode"})}catch(e){mf.error(e)}}))}(e,t)))).subscribe(ff),Ui().pipe(yn((e=>e?rd(1e4):cn)),ze(pf),Zt((({currentItem:e,currentTime:t,paused:n})=>hf(e,t,n,"timeupdate")))).subscribe(ff),Ui().pipe(yn((e=>e?td():cn)),yn((e=>pf(e)?ed().pipe(er(((e,t)=>e.paused===t.paused)),wl(1),wn(nd())):cn)),Zt((({currentItem:e,currentTime:t,paused:n})=>hf(e,t,n,n?"pause":"unpause")))).subscribe(ff);const vf=new z("scrobbling"),bf=new Ie(vf.getJson("noScrobble",{})),gf=new Ie(vf.getJson("options",{}));function yf(e,t){var n;const r=bf.getValue()[e.id];return!(null!==(n=null==r?void 0:r[t.id])&&void 0!==n?n:t.defaultNoScrobble)}function wf(e,t){const n=bf.getValue(),r=n[e.id],i=Object.assign(Object.assign({},r),t),a=Object.assign(Object.assign({},n),{[e.id]:i});vf.setJson("noScrobble",a),bf.next(a)}function Ef(e){var t;return!!(null===(t=gf.getValue()[e.id])||void 0===t?void 0:t.updateNowPlaying)}function xf(e,t){const n=gf.getValue(),r=n[e.id],i=Object.assign(Object.assign({},r),t),a=Object.assign(Object.assign({},n),{[e.id]:i});vf.setJson("options",a),gf.next(a)}const kf={canScrobble:yf,setNoScrobble:wf,canUpdateNowPlaying:Ef,updateOptions:xf};console.log("module::lastfmScrobbler");const Sf=new A("lastfmScrobbler");function Cf(e){const[t]=e.src.split(":"),n=jl(t);return!n||kf.canScrobble(ja,n)}wa().pipe(yn((e=>e?td():cn)),ze((()=>kf.canUpdateNowPlaying(ja))),Xt((({currentItem:e})=>e)),ze(l),ze((e=>Cf(e))),Zt((e=>Sa.updateNowPlaying(e)))).subscribe(Sf),wa().pipe(yn((e=>e?vc():cn)),Xt((e=>e.filter((e=>!e.lastfmScrobbledAt)))),Ql(1e4),Zt((e=>function(e){return t=this,n=void 0,i=function*(){try{if(0===e.length)return;const t=e[0].playedAt+Math.floor(e[0].duration),n=e.at(-1).playedAt,r=new Ta({from:n-30,to:t+30,limit:Ta.maxPageSize}),i=yield hr(r),a=i.map((e=>gc(e,30))),[o,s]=d(e,(e=>!Cf(e)||a.includes(gc(e,30))||!!yc(i,e)));if(yield bc(o.map((e=>Object.assign(Object.assign({},e),{lastfmScrobbledAt:-1})))),s.length>0){s.reverse(),s.length=Math.min(s.length,50),yield Sa.scrobble(s);const e=Math.floor(Date.now()/1e3);yield bc(s.map((t=>Object.assign(Object.assign({},t),{lastfmScrobbledAt:e}))))}}catch(e){Sf.error(e)}},new((r=void 0)||(r=Promise))((function(e,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(o,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e)))).subscribe(Sf);console.log("module::listenbrainzScrobbler");const Pf=new A("listenbrainzScrobbler");function Tf(e){const[t]=e.src.split(":"),n=jl(t);return!n||kf.canScrobble(Ko,n)}Ga().pipe(yn((e=>e?td():cn)),ze((()=>kf.canUpdateNowPlaying(Ko))),Xt((({currentItem:e})=>e)),ze(l),ze((e=>Tf(e))),Zt((e=>Ba.updateNowPlaying(e)))).subscribe(Pf),Ga().pipe(yn((e=>e?vc():cn)),Xt((e=>e.filter((e=>!e.listenbrainzScrobbledAt)))),Ql(1e4),Zt((e=>function(e){return t=this,n=void 0,i=function*(){try{if(0===e.length)return;const t=e[0].playedAt+Math.floor(e[0].duration),n=e.at(-1).playedAt,r=new Mo({min_ts:n-30,max_ts:t+30,count:Mo.maxPageSize}),i=yield hr(r),a=i.map((e=>gc(e,30))),[o,s]=d(e,(e=>!Tf(e)||a.includes(gc(e,30))||!!yc(i,e)));if(yield bc(o.map((e=>Object.assign(Object.assign({},e),{listenbrainzScrobbledAt:-1})))),s.length>0){s.reverse(),s.length=Math.min(s.length,50),yield Ba.scrobble(s);const e=Math.floor(Date.now()/1e3);yield bc(s.map((t=>Object.assign(Object.assign({},t),{listenbrainzScrobbledAt:e}))))}}catch(e){Pf.error(e)}},new((r=void 0)||(r=Promise))((function(e,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(o,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e)))).subscribe(Pf);var Af=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module::plexReporting");const If=new A("plexReporting");let Of=null;function Mf(e,t,n){return Af(this,void 0,void 0,(function*(){try{yield Nf(e,t,n)}catch(e){If.error(e)}}))}function Nf(e,t,n,r){return Af(this,void 0,void 0,(function*(){const[,,i]=e.src.split(":");yield ts.fetch({path:"/:/timeline",params:{key:i,ratingKey:e.plex.ratingKey,playQueueItemID:String(Of.playQueueSelectedItemID),state:n,hasMDE:"1",time:String(Math.floor(1e3*t)),duration:String(Math.floor(1e3*e.duration))},keepalive:r})}))}console.log("module::plexScrobbler");const $f=new A("plexScrobbler"),zf=e=>{var t;return!!(null===(t=e.currentItem)||void 0===t?void 0:t.src.startsWith("plex:"))};cs().pipe(yn((e=>e?td():cn)),ze(zf),Zt((({currentItem:e})=>function(e){return Af(this,void 0,void 0,(function*(){try{const[,,t]=e.src.split(":");Of=yield function(e){return Af(this,void 0,void 0,(function*(){return ts.fetchJSON({path:"/playQueues",method:"POST",params:{type:"music",continuous:"0",uri:`server://${Qo.server.clientIdentifier}/com.plexapp.plugins.library/${e}`,repeat:"0",own:"1",includeExternalMedia:"1"}})}))}(t),yield Nf(e,0,"playing")}catch(e){If.error(e)}}))}(e)))).subscribe($f),cs().pipe(yn((e=>e?nd():cn)),ze(zf),Zt((({currentItem:e})=>function(e){return Af(this,void 0,void 0,(function*(){try{yield Nf(e,0,"stopped",!0)}catch(e){If.error(e)}}))}(e)))).subscribe($f),cs().pipe(yn((e=>e?rd(1e4):cn)),ze(zf),Zt((({currentItem:e,currentTime:t,paused:n})=>Mf(e,t,n?"paused":"playing")))).subscribe($f),cs().pipe(yn((e=>e?td():cn)),yn((e=>zf(e)?ed().pipe(er(((e,t)=>e.paused===t.paused)),wl(1),wn(nd())):cn)),Zt((({currentItem:e,currentTime:t,paused:n})=>Mf(e,t,n?"paused":"playing")))).subscribe($f);const jf=new A("mediaPlayback/scrobbler");nd().pipe(Zt((e=>function(e){var t;return uc(this,void 0,void 0,(function*(){try{const n=e.currentItem;if(!n||!e.startedAt||!e.endedAt)throw Error("Invalid PlaybackState.");if(n.title&&(null===(t=n.artists)||void 0===t?void 0:t[0])&&n.duration>30){const t=Math.min(n.duration/2,240),r=Math.floor(e.startedAt/1e3);if(Math.floor(e.endedAt/1e3)-r>t){const{id:e,lookupStatus:t}=n,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(n,["id","lookupStatus"]);dc.log("add",{listen:i}),yield pc.items.add(Object.assign(Object.assign({},i),{playedAt:r,lastfmScrobbledAt:0,listenbrainzScrobbledAt:0}))}}}catch(e){dc.error(e)}}))}(e)))).subscribe(jf);console.log("module::mediaPlayback");const Lf=new A("mediaPlayback"),Rf=new z("mediaPlayback"),_f=new z("mediaPlayback","session"),Df=new Ie(!1),Ff=new Te;let Vf="forward";function Uf(){return gu.observeCurrentItem()}function Bf(){return od.observeCurrentTime()}function Hf(){return od.observeDuration()}function Yf(){return uf.observeEnded()}function Kf(){return od.observePaused()}function Wf(){return od.observePlaybackStart()}function qf(){return od.observePlaybackEnd()}function Jf(){return uf.observePlaying()}function Qf(e){Lf.log("load",{item:e}),uf.load(e),uf.autoplay&&od.play()}function Xf(){Lf.log("play"),Vf="forward",op(),od.play(),od.paused||(uf.play(),Xh.play())}function Gf(){Lf.log("pause"),lp.stopAfterCurrent=!1,op(),od.pause(),uf.pause(),Xh.pause()}function Zf(e){Lf.log("seek",{time:b(e)}),uf.seek(e)}function ep(){Lf.log("stop"),lp.stopAfterCurrent=!1,op(),od.stop(),uf.stop(),Xh.stop()}function tp(){Vf="backward",gu.atStart||(lp.stopAfterCurrent=!1,ap(),gu.prev())}function np(){Vf="forward",gu.atEnd||(lp.stopAfterCurrent=!1,ap(),gu.next())}function rp(){lp.stopAfterCurrent=!1,ap(),gu.eject()}function ip(){return Gn([gu.observeCurrentIndex(),gu.observeSize()]).pipe(Xt((([e,t])=>e===t-1)),er())}function ap(){od.paused||!1!==Df.getValue()||(od.stop(),uf.stop(),od.play()),Df.next(!0)}function op(){Df.next(!1)}function sp(e){return t=this,n=void 0,i=function*(){if(!Rl(e)){const t=yield function(e){return $c(this,void 0,void 0,(function*(){try{if(!e)return;if(Rl(e))return e;t=e,kc.next({lookupItem:t});const n=yield function(e){return $c(this,void 0,void 0,(function*(){const t=wc(e);if(t)return t;const{link:n}=e,r=zc(e,["link"]);if(n&&Rl(n))return Object.assign(Object.assign({},r),n);const{artist:i,title:a}=Kc(e);if(!i||!a)return;let o=[];const[s]=(null==n?void 0:n.src.split(":"))||[],l=jl(s);return l&&(o=yield Rc(l,e)),0===o.length&&(o=yield _c(e,!0,l)),0===o.length&&(o=yield _c(e,!1,l)),Dc(o,e)}))}(e);return n&&([Lc]=n.src.split(":")),function(e,t){Sc.next({lookupItem:e,foundItem:t?x(t,e):void 0})}(e,n),n}catch(e){jc.error(e)}var t}))}(e);if(t)return Object.assign(Object.assign({},e),t)}return e},new((r=void 0)||(r=Promise))((function(e,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(o,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}const lp={stopAfterCurrent:!1,get autoplay(){return uf.autoplay},set autoplay(e){uf.autoplay=e,Xh.autoplay=e},get hidden(){return!1},get loop(){return!1},get muted(){return uf.muted},set muted(e){_f.setBoolean("muted",e),uf.muted=e},get paused(){return od.paused},get volume(){return uf.volume},set volume(e){Rf.setNumber("volume",e),uf.volume=e},observeCurrentItem:Uf,observeCurrentTime:Bf,observeDuration:Hf,observeEnded:Yf,observeError:function(){return uf.observeError()},observePaused:Kf,observePlaying:Jf,observePlaybackStart:Wf,observePlaybackEnd:qf,observePlaybackProgress:function(e){return od.observePlaybackProgress(e)},observePlaybackState:function(){return od.observePlaybackState()},appendTo:function(e){const t=e.querySelector("#playback");uf.appendTo(t),Xh.appendTo(t)},load:Qf,play:Xf,pause:Gf,stop:ep,seek:Zf,resize:function(e,t){uf.resize(e,t),Xh.resize(e,t)},next:np,prev:tp,shuffle:function(){gu.shuffle()}},cp=lp;lp.muted=_f.getBoolean("muted"),lp.volume=Rf.getNumber("volume",1),uf.observeCurrentTime().subscribe((e=>od.setCurrentTime(e))),uf.observeDuration().subscribe((e=>od.setDuration(e))),uf.observePlaying().subscribe((()=>od.started())),uf.observeEnded().subscribe((()=>od.ended())),uf.observePlaying().subscribe((()=>Vf="forward")),uf.observeEnded().pipe(yl(ip()),wn(Ff)).subscribe((([,e])=>{e||lp.stopAfterCurrent?ep():gu.next()})),uf.observeError().pipe(yl(Kf(),gu.observeCurrentIndex().pipe(Xt((e=>0===e)),er()),ip()),wn(Ff)).subscribe((([,e,t,n])=>{n||t&&"backward"===Vf?ep():e||("backward"===Vf?gu.prev():gu.next())})),gu.observeSize().pipe(Xt((e=>0===e)),er(),ze((e=>e))).subscribe(ep),Df.pipe(Ql(250),ze((e=>e))).subscribe((()=>{lp.autoplay=!od.paused,Df.next(!1)})),Df.pipe(er(),yn((e=>e?cn:Uf())),er(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),yn((e=>e?sp(e):Pn(null))),$e(Qf)).subscribe(Lf),Df.pipe(er(),yn((e=>e?cn:gu.observeNextItem())),er(((e,t)=>(null==e?void 0:e.id)===(null==t?void 0:t.id))),Ql(1e4),yn((e=>e?sp(e):cn))).subscribe(Lf),on(window,"pagehide").subscribe((function(){Ff.next(void 0),ep()})),Hf().pipe(Xt(b),er()).subscribe(Lf.rx("duration")),Bf().pipe(ze((e=>Math.round(e)%30==0)),Xt(b)).subscribe(Lf.rx("currentTime")),Jf().subscribe(Lf.rx("playing")),Yf().subscribe(Lf.rx("ended")),Wf().subscribe(Lf.rx("playbackStart")),qf().subscribe(Lf.rx("playbackEnd"));var up=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function dp(e){var{icon:t,className:n=""}=e,i=up(e,["icon","className"]);return r.createElement("button",Object.assign({},i,{className:`icon-button icon-button-${t} ${n}`,type:"button",onMouseDown:w,onMouseUp:y}),r.createElement(yi,{name:t}))}var mp=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function hp(e){var{className:t="",children:n}=e,i=mp(e,["className","children"]);return r.createElement("div",Object.assign({},i,{className:`icon-buttons ${t}`}),n)}function fp({children:e,onClose:t,x:n,y:i,align:a="left"}){const o=(0,r.useRef)(null),s=(0,r.useRef)(document.activeElement),[l,c]=(0,r.useState)({visibility:"hidden"}),[u,d]=(0,r.useState)([]),[m,h]=(0,r.useState)("");(0,r.useLayoutEffect)((()=>{const e={},t=o.current,r=Array.from(t.querySelectorAll("button"));"right"===a||n+t.offsetWidth>document.body.clientWidth?e.left=n-t.offsetWidth+"px":e.left=`${n}px`,i+t.offsetHeight>document.body.clientHeight?e.top=i-t.offsetHeight+"px":e.top=`${i}px`,d(r),c(e)}),[a,n,i]),(0,r.useEffect)((()=>{const e=u.find((e=>!e.disabled));null==e||e.focus(),h((null==e?void 0:e.id)||"")}),[u]),(0,r.useEffect)((()=>{const e=bn(Rt(0).pipe(yn((()=>on(document,"mousedown",{capture:!0}).pipe(ze((e=>!o.current.contains(e.target))))))),on(document,"keydown",{capture:!0}).pipe(ze((e=>"Escape"===e.code))),on(window,"blur")).subscribe((()=>{var e;null===(e=s.current)||void 0===e||e.focus(),t()}));return()=>e.unsubscribe()}),[t]);const f=(0,r.useCallback)((e=>{var n;let r=e.target;for(;r&&"BUTTON"!==r.nodeName;)r=r.parentElement;(null==r?void 0:r.value)&&!r.disabled&&(null===(n=s.current)||void 0===n||n.focus(),t(r.value))}),[t]),p=(0,r.useCallback)((e=>{let t=u.indexOf(document.activeElement);"ArrowDown"===e.code?(e.stopPropagation(),t++):"ArrowUp"===e.code&&(e.stopPropagation(),t--),t=Math.min(Math.max(t,0),u.length-1);const n=u[t];n&&!n.disabled&&(n.focus(),h(n.id))}),[u]),v=(0,r.useCallback)((e=>{let t=e.target;for(;t&&"BUTTON"!==t.nodeName;)t=t.parentElement;t&&!t.disabled&&(t.focus(),h(t.id))}),[]);return r.createElement("ul",{className:"popup-menu",tabIndex:-1,role:"menu","aria-label":"Actions","aria-activedescendant":m,style:l,onClick:f,onContextMenu:g,onKeyDown:p,onMouseOver:v,ref:o},e)}var pp=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function vp(e){var{className:t="",label:n,acceleratorKey:i="",role:a="menuitem"}=e,o=pp(e,["className","label","acceleratorKey","role"]);const s=(0,r.useId)();return r.createElement("li",{className:`popup-menu-item ${t}`},r.createElement("button",Object.assign({},o,{id:s,role:a,tabIndex:-1,onMouseDown:w,onMouseUp:y}),r.createElement("span",{className:"popup-menu-item-label"},n),r.createElement("span",{className:"popup-menu-item-accelerator-key"},i)))}var bp=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function gp(e){var{className:t="",checked:n=!1}=e,i=bp(e,["className","checked"]);return r.createElement(vp,Object.assign({},i,{className:`popup-menu-item-checkbox ${t}`,role:"menuitemcheckbox","aria-checked":n}))}function yp(){return r.createElement("li",{className:"popup-menu-separator",role:"separator"})}var wp=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};function Ep(e,t,n,a){return wp(this,void 0,void 0,(function*(){return new Promise(((o,s)=>{const l=document.getElementById("popup"),c=document.createElement("div"),u=(0,i.s)(c);try{const i=e=>{u.unmount(),c.remove(),o(e)};l.append(c),u.render(r.createElement(e,{x:t,y:n,align:a,onClose:i}))}catch(e){u.unmount(),c.remove(),s(e)}}))}))}var xp=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))},kp=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Sp(e,t,n,i,a="left"){return xp(this,void 0,void 0,(function*(){return Ep((n=>r.createElement(Cp,Object.assign({},n,{items:e,isContextMenu:t}))),n,i,a)}))}function Cp(e){var{items:t,isContextMenu:n}=e,i=kp(e,["items","isContextMenu"]);const a=t[0],o=1===t.length&&!!a,s=t.every((e=>e.itemType===Yn.Media||e.itemType===Yn.Album));return r.createElement(fp,Object.assign({},i),s?r.createElement(Pp,null):null,n&&o?r.createElement(Tp,{item:a}):null,o?r.createElement(vp,{label:"Info...",value:Bn.Info,acceleratorKey:`${U.ctrlKeyStr}+I`,key:Bn.Info}):null)}function Pp(){return r.createElement(r.Fragment,null,r.createElement(vp,{label:"Queue",value:Bn.Queue,acceleratorKey:"Enter",key:Bn.Queue}),r.createElement(vp,{label:"Play next",value:Bn.PlayNext,acceleratorKey:"Shift+Enter",key:Bn.PlayNext}),r.createElement(vp,{label:"Play now",value:Bn.PlayNow,acceleratorKey:`${U.ctrlKeyStr}+Enter`,key:Bn.PlayNow}),r.createElement(yp,null))}function Tp({item:e}){const[t]=(null==e?void 0:e.src.split(":"))||[],n=jl(t);return r.createElement(r.Fragment,null,e.itemType===Yn.Playlist?r.createElement(vp,{label:e.isPinned?"Unpin":"Pin",value:e.isPinned?Bn.Unpin:Bn.Pin,key:e.isPinned?Bn.Unpin:Bn.Pin}):null,void 0!==e.rating&&(null==n?void 0:n.canRate(e,!0))?r.createElement(vp,{label:e.rating?jp(n,Bn.Unlike):jp(n,Bn.Like),value:e.rating?Bn.Unlike:Bn.Like,key:e.rating?Bn.Unlike:Bn.Like}):null,!1===e.inLibrary&&(null==n?void 0:n.canStore(e,!0))?r.createElement(vp,{label:jp(n,Bn.AddToLibrary),value:Bn.AddToLibrary,key:Bn.AddToLibrary}):null,"apple"!==t&&!0===e.inLibrary&&(null==n?void 0:n.canStore(e,!0))?r.createElement(vp,{label:jp(n,Bn.RemoveFromLibrary),value:Bn.RemoveFromLibrary,key:Bn.RemoveFromLibrary}):null,r.createElement(yp,null))}const Ap=()=>{};function Ip({rating:e=0,onClick:t=Ap}){const n=Math.round(e/2),[i,a]=(0,r.useState)(!1);return r.createElement(hp,{className:"star-rating"},r.createElement(dp,{icon:"star",className:`${n>0?"checked":""} ${i?"clicked":""}`,tabIndex:-1,onClick:()=>{a(!0),t(1===n?0:2)},onMouseLeave:()=>a(!1)}),r.createElement(dp,{icon:"star",className:n>1?"checked":"",tabIndex:-1,onClick:()=>t(2===n?2:4)}),r.createElement(dp,{icon:"star",className:n>2?"checked":"",tabIndex:-1,onClick:()=>t(3===n?4:6)}),r.createElement(dp,{icon:"star",className:n>3?"checked":"",tabIndex:-1,onClick:()=>t(4===n?6:8)}),r.createElement(dp,{icon:"star",className:n>4?"checked":"",tabIndex:-1,onClick:()=>t(5===n?8:10)}))}var Op=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};const Mp={[Bn.AddToLibrary]:"plus",[Bn.RemoveFromLibrary]:"tick-fill",[Bn.Rate]:"star",[Bn.Like]:"heart",[Bn.Unlike]:"heart-fill"},Np={[Bn.AddToLibrary]:"Add to library",[Bn.RemoveFromLibrary]:"Remove from library",[Bn.Rate]:"Rate",[Bn.Like]:"Love",[Bn.Unlike]:"Unlove"};function $p({item:e,inline:t}){const[n]=e.src.split(":"),i=jl(n),a=t?-1:void 0,o=(0,r.useCallback)((()=>Op(this,void 0,void 0,(function*(){e.itemType===Yn.Playlist&&(e.isPinned?yield gv(Bn.Unpin,[e]):yield gv(Bn.Pin,[e]))}))),[e]),s=(0,r.useCallback)((()=>Op(this,void 0,void 0,(function*(){e.rating?yield gv(Bn.Unlike,[e]):yield gv(Bn.Like,[e])}))),[e]),l=(0,r.useCallback)((()=>Op(this,void 0,void 0,(function*(){e.inLibrary?yield gv(Bn.RemoveFromLibrary,[e]):yield gv(Bn.AddToLibrary,[e])}))),[e]),c=(0,r.useCallback)((t=>Op(this,void 0,void 0,(function*(){const n=t.target.getBoundingClientRect(),r=yield Sp([e],!1,n.right,n.bottom,"right");r&&(yield gv(r,[e]))}))),[e]),u=(0,r.useCallback)((t=>Op(this,void 0,void 0,(function*(){yield gv(Bn.Rate,[e],t)}))),[e]);return r.createElement(hp,null,t?r.createElement(dp,{icon:"menu",title:"More...",tabIndex:a,onClick:c,key:"menu"}):null,e.itemType===Yn.Playlist?r.createElement(dp,{icon:e.isPinned?"pin-fill":"pin",title:e.isPinned?"Unpin":"Pin to sidebar",tabIndex:a,onClick:o,key:"pin"}):null,i?r.createElement(r.Fragment,null,void 0!==e.rating&&(null==i?void 0:i.canRate(e,t))?"plex"===n?r.createElement(Ip,{rating:e.rating,onClick:u}):r.createElement(dp,{icon:e.rating?zp(i,Bn.Unlike):zp(i,Bn.Like),title:e.rating?jp(i,Bn.Unlike):jp(i,Bn.Like),tabIndex:a,onClick:s,key:"rate"}):null,void 0!==e.inLibrary&&(null==i?void 0:i.canStore(e,t))?r.createElement(dp,{icon:e.inLibrary?zp(i,Bn.RemoveFromLibrary):zp(i,Bn.AddToLibrary),title:e.inLibrary?jp(i,Bn.RemoveFromLibrary):jp(i,Bn.AddToLibrary),tabIndex:a,disabled:"apple"===n&&e.inLibrary,onClick:l,key:"store"}):null):null)}function zp(e,t){var n;return(null===(n=e.icons)||void 0===n?void 0:n[t])||Mp[t]}function jp(e,t){var n;return(null===(n=e.labels)||void 0===n?void 0:n[t])||Np[t]}var Lp=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};console.log("module:musicbrainz/coverart");const Rp=new A("musicbrainz/coverart");class _p extends vt.ZP{constructor(){super("ampcast/musicbrainz/coverart"),this.version(1).stores({items:"&mbid, album, artist, thumbnails"})}}const Dp=new _p;function Fp(e){switch(e){case"small":return 250;case"large":return 500;default:return Number(e)||0}}function Vp({item:e,size:t,className:n=""}){const[i,a]=(0,r.useState)(!1),[o,s]=(0,r.useState)((()=>e.thumbnails)),l=!!(null==o?void 0:o.length),c=l?function(e,t=240){if(1===e.length)return e[0];let n=e.filter((e=>Bp(e)<1.34));return 0===n.length&&(n=e.filter((e=>Bp(e)<1.5)),0===n.length&&(n=e)),t*=window.devicePixelRatio,n.sort(((e,n)=>Math.abs(e.height-t)-Math.abs(n.height-t))),n[0]}(o,t):void 0,u=c?Up(c):"",d=function(e){switch(e.itemType){case Yn.Artist:return"artist";case Yn.Album:return"album";case Yn.Media:return e.mediaType===Nr.Video?"video":"audio";case Yn.Playlist:return"playlist";case Yn.Folder:return"folder"}}(e);(0,r.useEffect)((()=>s(e.thumbnails)),[e.thumbnails]),(0,r.useEffect)((()=>{if(!l){if(e.itemType===Yn.Media){const t=wc(e);if(t&&t.thumbnails)return void s(t.thumbnails)}const t=vn(function(e){var t;return Lp(this,void 0,void 0,(function*(){if(!e||e.itemType!==Yn.Album&&e.itemType!==Yn.Media)return;let n=!1;const r=e.release_mbid;if(r){const e=yield Dp.items.get(r);if(n=!!e,null==e?void 0:e.thumbnails)return e.thumbnails}let i,a;if(e.itemType===Yn.Album?(i=e.title,a=e.artist):(i=e.album,a=e.albumArtist||(null===(t=e.artists)||void 0===t?void 0:t[0])),i&&a){const e=yield Dp.items.get({album:i,artist:a});if(e)return e.thumbnails}if(r&&!n)try{const e=yield function(e){return Lp(this,void 0,void 0,(function*(){const t=yield fetch(`https://coverartarchive.org/release/${e}`);if(!t.ok)throw t;return t.json()}))}(r),t=e.images.filter((e=>e.front&&e.approved))[0],n=t?Object.keys(t.thumbnails).filter((e=>0!==Fp(e))).map((e=>({url:t.thumbnails[e],width:Fp(e),height:Fp(e)}))):[];return yield Dp.items.put(0===n.length?{mbid:r}:{mbid:r,album:i,artist:a,thumbnails:n}),n}catch(e){404===e.status?yield Dp.items.put({mbid:r}):Rp.error(e)}}))}(e)).subscribe(s);return()=>t.unsubscribe()}}),[l,e]);const m=(0,r.useCallback)((()=>a(!0)),[]);return r.createElement("figure",{className:`cover-art ${n}`},u&&!i?r.createElement("img",{className:"cover-art-image",src:u,alt:`${e.title}: Cover art`,onError:m}):d?r.createElement(yi,{className:"cover-art-image",name:d}):null)}function Up(e){return e.url.replace("{plex-token}",Qo.serverToken)}function Bp({width:e,height:t}){return e/t}function Hp({className:e,children:t}){const n=(0,r.useRef)(null),i=(0,r.useRef)(null),[a,o]=(0,r.useState)(0),[s,l]=(0,r.useState)("hidden"),c=(0,r.useCallback)((({scrollHeight:e})=>o(e)),[]);return(0,r.useLayoutEffect)((()=>{setTimeout((()=>requestAnimationFrame((()=>l(void 0)))),50)}),[]),r.createElement("div",{className:`text-box ${e}`,style:{height:`${a}px`,visibility:s},ref:n},r.createElement("div",{style:{position:"relative",height:"100%"}},r.createElement(Cn,{onResize:c,scrollableRef:i},t)))}const Yp=new A("Media/useCurrentItem");var Kp=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Wp(e){const t=function(e){const[t,n]=(0,r.useState)(e),[i,a]=(0,r.useState)("");return(0,r.useEffect)((()=>{if(i!==e.src){const[t]=e.src.split(":"),r=jl(t);if(null==r?void 0:r.getMetadata){const t=vn(r.getMetadata(e)).pipe($e((t=>{a(e.src),n(Object.assign(Object.assign({},e),t))}))).subscribe(Yp);return()=>t.unsubscribe()}a(e.src)}}),[e,i]),(0,r.useEffect)((()=>{const e=rr.observe().pipe($e((e=>{for(const{match:r,values:i}of e)if(r(t)){n(Object.assign(Object.assign({},t),i));break}}))).subscribe(Yp);return()=>e.unsubscribe()}),[t]),t}(e.item);if(e.debug)return r.createElement(uv,{item:t});switch(t.itemType){case Yn.Media:return r.createElement(qp,{item:t});case Yn.Artist:return r.createElement(Qp,{item:t});case Yn.Album:return r.createElement(Jp,{item:t});case Yn.Playlist:return r.createElement(Xp,{item:t});case Yn.Folder:return r.createElement(Gp,{item:t})}}function qp({item:e}){var t;return r.createElement("article",{className:"media-info media-item-info"},r.createElement("div",{className:"media-info-main"},r.createElement(cv,{item:e}),r.createElement(Zp,{title:e.title}),r.createElement(tv,{artist:null===(t=e.artists)||void 0===t?void 0:t.join(", ")}),r.createElement(iv,{album:e.album,year:e.year}),r.createElement(av,{album:e.album,track:e.track}),r.createElement(nv,{owner:e.owner,src:e.src}),r.createElement($p,{item:e})),r.createElement(ev,{description:e.description}),r.createElement(rv,{url:e.externalUrl,src:e.src}))}function Jp({item:e}){return r.createElement("article",{className:"media-info album-info"},r.createElement("div",{className:"media-info-main"},r.createElement(cv,{item:e}),r.createElement(Zp,{title:e.title}),r.createElement(tv,{artist:e.artist}),r.createElement(ov,{year:e.year}),r.createElement($p,{item:e})),r.createElement(ev,{description:e.description}),r.createElement(rv,{url:e.externalUrl,src:e.src}))}function Qp({item:e}){return r.createElement("article",{className:"media-info artist-info"},r.createElement("div",{className:"media-info-main"},r.createElement(cv,{item:e}),r.createElement(Zp,{title:e.title}),r.createElement(sv,{genres:e.genres}),r.createElement(lv,{country:e.country}),r.createElement($p,{item:e})),r.createElement(ev,{description:e.description}),r.createElement(rv,{url:e.externalUrl,src:e.src}))}function Xp({item:e}){return r.createElement("article",{className:"media-info playlist-info"},r.createElement("div",{className:"media-info-main"},r.createElement(cv,{item:e}),r.createElement(Zp,{title:e.title}),r.createElement(nv,{owner:e.owner,src:e.src}),r.createElement(sv,{genres:e.genres}),r.createElement($p,{item:e})),r.createElement(ev,{description:e.description}),r.createElement(rv,{url:e.externalUrl,src:e.src}))}function Gp({item:e}){return r.createElement("article",{className:"media-info folder-info"},r.createElement("div",{className:"media-info-main"},r.createElement(cv,{item:e}),r.createElement(Zp,{title:e.title})))}function Zp({title:e}){return r.createElement("h3",{className:"title"},e||"(no title)")}function ev({description:e}){return e?r.createElement(Hp,{className:"blurb"},r.createElement("p",null,e)):null}function tv({artist:e}){return e?r.createElement("h4",{className:"artist"},"By: ",e):null}function nv({src:e,owner:t}){if(!t||!t.name)return null;const[n]=e.split(":"),i="youtube"===n?"Channel":"Curator";return r.createElement("p",{className:"owner"},i,":"," ",t.url?r.createElement(Ya,{href:t.url},t.name):t.name)}function rv({src:e,url:t=""}){let[n]=e.split(":"),i=n;switch(n){case"musicbrainz":i="MusicBrainz";break;case"listenbrainz":/musicbrainz/.test(t)?(i="MusicBrainz",n="musicbrainz"):i="ListenBrainz";break;default:{const e=jl(n);e&&(i=e.name)}}return r.createElement("p",{className:"external-view"},r.createElement(yi,{name:n}),t?r.createElement(Ya,{href:t},"View on ",i):r.createElement("span",{className:"external-provider"},"Provided by ",i))}function iv({album:e,year:t}){return e&&t?r.createElement("h4",{className:"album"},"From: ",e," (",t,")"):e?r.createElement("h4",{className:"album"},"From: ",e):t?r.createElement("h4",{className:"album"},"Year: ",t):null}function av({album:e,disc:t,track:n}){return e&&n?r.createElement(r.Fragment,null,t&&r.createElement("p",{className:"track disc"},"Disc: ",t),r.createElement("p",{className:"track"},"Track: ",n)):null}function ov({year:e}){return e?r.createElement("p",{className:"year"},"Year: ",e):null}function sv({genres:e}){return e?r.createElement("p",{className:"genre"},"Genre: ",e.join(", ")):null}function lv({country:e}){return e?r.createElement("p",{className:"country"},"Country: ",e):null}function cv(e){return r.createElement("div",{className:"thumbnail"},r.createElement(Vp,Object.assign({},e)))}function uv(e){const t=e.item,{pager:n}=t,i=Kp(t,["pager"]);return r.createElement("article",{className:"media-info debug"},r.createElement("pre",null,JSON.stringify(i,void 0,2)),r.createElement(rv,{url:i.externalUrl,src:i.src}))}function dv(e){const[t,n]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{if(e.current){const e=document.querySelectorAll(".focus");for(const t of e)t.classList.toggle("focus",!1)}const t=on(document,"keydown",{capture:!0}).subscribe((t=>{var r;t.repeat||(t.ctrlKey&&t.shiftKey&&"Digit8"===t.code?n((e=>!e)):t[U.ctrlKey]&&!t.shiftKey&&"KeyI"===t.code&&(null===(r=e.current)||void 0===r||r.close()))}));return()=>t.unsubscribe()}),[e]),{debug:t}}var mv=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))},hv=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function fv(e){return mv(this,void 0,void 0,(function*(){yield Si((t=>r.createElement(pv,Object.assign({},t,{item:e}))))}))}function pv(e){var{item:t}=e,n=hv(e,["item"]);const i=(0,r.useRef)(null),{debug:a}=dv(i),o=function(e){switch(e.itemType){case Yn.Playlist:return"Playlist info";case Yn.Album:return"Album info";case Yn.Artist:return"Artist info";case Yn.Folder:return"Folder info";default:return"Media info"}}(t);return r.createElement(xi,Object.assign({},n,{className:"media-info-dialog",title:o,ref:i}),r.createElement("form",{method:"dialog"},r.createElement(Wp,{item:t,debug:a}),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",null,"Close"))))}var vv=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};const bv=new A("ampcast/actions");function gv(e,t,n){return vv(this,void 0,void 0,(function*(){const r=t[0];if(!r)return;const i=r.itemType;switch(e){case Bn.PlayNow:case Bn.PlayNext:case Bn.Queue:!function(e,t){vv(this,void 0,void 0,(function*(){const n=t[0];if(!n)return;const r=n.itemType;if(r===Yn.Media||r===Yn.Album)switch(e){case Bn.PlayNow:case Bn.PlayNext:e===Bn.PlayNow&&(cp.autoplay=!0),r===Yn.Media?yield gu.insert(t):yield gu.insert(n),e===Bn.PlayNow&&gu.next();break;case Bn.Queue:r===Yn.Media?yield gu.add(t):yield gu.add(n)}}))}(e,t);break;case Bn.Like:case Bn.Unlike:case Bn.Rate:case Bn.AddToLibrary:case Bn.RemoveFromLibrary:!function(e,t,n){vv(this,void 0,void 0,(function*(){if(t)try{switch(e){case Bn.Like:yield dr.rate(t,1);break;case Bn.Unlike:yield dr.rate(t,0);break;case Bn.Rate:"number"==typeof n&&(yield dr.rate(t,n));break;case Bn.AddToLibrary:yield or.store(t,!0);break;case Bn.RemoveFromLibrary:yield or.store(t,!1)}}catch(r){bv.warn("Failed to perform action:",{action:e,item:t,payload:n}),bv.error(r)}}))}(e,r,n);break;case Bn.Pin:i===Yn.Playlist&&(yield Wr.pin(t));break;case Bn.Unpin:i===Yn.Playlist&&(yield Wr.unpin(t));break;case Bn.Info:yield fv(r)}}))}let yv=null,wv="none";const Ev={getData:function(e){return"#globalDrag"===e.dataTransfer.getData("text")?yv:null},getEffect:function(e){return"#globalDrag"===e.dataTransfer.getData("text")?wv:"none"},set:function(e,t,n){e.dataTransfer.setData("text","#globalDrag"),e.dataTransfer.effectAllowed=n,yv=t,wv=n},unset:function(){yv=null,wv="none"}};function xv(e){const t=(0,r.useRef)();return(0,r.useEffect)((()=>{t.current=e}),[e]),t.current}function kv({style:e,title:t}){return r.createElement("div",{className:"list-view-cell",style:e},t)}function Sv({col:e,onResize:t}){const[n,i]=(0,r.useState)(e.width),[a,o]=(0,r.useState)(-1),[s,l]=(0,r.useState)(0),c=-1!==a,u=(0,r.useCallback)((e=>{e.preventDefault(),0===e.button&&(o(e.screenX),l(n))}),[n]);(0,r.useEffect)((()=>t(e.index,n)),[e.index,n,t]);const d=(0,r.useCallback)((e=>{i(Math.max(20,s+(e.screenX-a)))}),[a,s]),m=(0,r.useCallback)((()=>{o(-1),l(0)}),[]);return(0,r.useEffect)((()=>{if(c)return document.documentElement.style.cursor="col-resize",document.body.classList.add("dragging"),document.addEventListener("mouseup",m),document.addEventListener("mousemove",d),()=>{document.documentElement.style.cursor="",document.body.classList.remove("dragging"),document.removeEventListener("mouseup",m),document.removeEventListener("mousemove",d)}}),[c,d,m]),r.createElement("span",{className:"column-resizer",onMouseDown:u,style:{left:e.left+n-4+"px"}})}function Cv({width:e,height:t,cols:n,sizeable:i,onColumnResize:a}){const o=(0,r.useCallback)(((e,t)=>{null==a||a(e,t)}),[a]);return r.createElement("header",{className:"list-view-head",style:{width:`${e}px`}},r.createElement("div",{className:"list-view-row",style:{width:`${e}px`,height:`${t}px`}},n.map((e=>r.createElement(kv,Object.assign({},e,{key:e.index}))))," ",i&&n.map((e=>r.createElement(Sv,{col:e,onResize:o,key:e.index})))))}function Pv({rowIndex:e,col:{className:t="",render:n,style:i},item:a}){return r.createElement("div",{className:`list-view-cell ${t}`,style:i},n(a,e))}function Tv({item:e,className:t,id:n,rowIndex:i,height:a,selected:o,cols:s,setSize:l,dragIndex:c}){const u=`${t} ${o?"selected selected-text":""} ${c===l?i===l-1?"drag-over-last":"":c===i?"drag-over":""}`;return r.createElement("li",{role:"option",className:`list-view-row ${u}`,id:n,"aria-selected":o,"aria-setsize":l,"aria-posinset":i+1,style:{height:`${a}px`,transform:`translateY(${a*i}px)`}},s.map((t=>r.createElement(Pv,{rowIndex:i,col:t,item:e,key:t.index}))))}function Av({listViewId:e,title:t,width:n,height:i,rowHeight:a,cols:o,items:s,itemKey:l,itemClassName:c,selectedId:u,scrollTop:d,overScan:m=2,selection:h,draggable:f,dragIndex:p,multiple:v=!1}){const b=(0,r.useRef)(null),g=s.length,y=Math.floor(d/a),w=Math.floor(i/a),E=Math.max(0,y-m),x=Math.min(g,w+2*m),k=s.slice(E,E+x);return r.createElement("ol",{role:"listbox",className:"list-view-body",draggable:f,style:{width:n?`${n}px`:void 0},"aria-label":t,"aria-multiselectable":v,"aria-activedescendant":u,ref:b},k.map(((t,n)=>r.createElement(Tv,{className:c(t),id:`${e}-${t[l]}`,rowIndex:E+n,height:a,selected:h.includes(t),cols:o,item:t,setSize:g,dragIndex:p,key:t[l]}))))}const Iv=[],Ov=()=>"";new Image(0,0).src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1H\nAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=";const Mv=["ArrowUp","ArrowDown","PageUp","PageDown"];function Nv({items:e=[],itemKey:t,title:n,itemClassName:i=Ov,layout:a,className:o="",selectedIndex:s=-1,draggable:l,droppable:c,droppableTypes:u=[],multiple:d,reorderable:m,disabled:h,onClick:f,onDoubleClick:p,onContextMenu:v,onDrop:b,onDelete:g,onEnter:y,onInfo:w,onRowIndexChange:E,onScrollIndexChange:x,onPageSizeChange:k,onSelect:S,onMove:C,listViewRef:P}){const T=(0,r.useId)(),A=(0,r.useRef)(null),I=(0,r.useRef)(null),O=(0,r.useRef)(null),M=(0,r.useRef)(null),N=(0,r.useRef)(null),$="details"===a.view&&a.showTitles,z="details"===a.view&&a.sizeable,[j,L]=(0,r.useState)(-1),[R,_]=(0,r.useState)(0),[D,F]=(0,r.useState)(0),[V,B]=(0,r.useState)(0),[H,Y]=(0,r.useState)(0),[K,W]=function(e){const[t,n]=(0,r.useState)([]),i="details"===e.view&&e.sizeable;(0,r.useEffect)((()=>{const t="details"===e.view,r=t&&e.sizeable;n(e.cols.reduce(((e,n,i)=>{const a=e[i-1],o=a?a.left+a.width:0,{title:s="",className:l="",align:c="left",sortOrder:u="none",sortPriority:d=0,width:m=200}=n,h=r?{left:`${o}px`,width:`${m}px`,textAlign:c}:t?{textAlign:c}:{};return e.push(Object.assign(Object.assign({},n),{title:s,className:l,align:c,index:i,left:o,width:m,style:h,sortOrder:u,sortPriority:d})),e}),[]))}),[e]);const a=(0,r.useCallback)(((e,r)=>{i&&t[e].width!==r&&n(t.reduce(((t,n,i)=>{if(i>=e){const a=t[i-1],o=a?a.left+a.width:0,s=i===e?r:n.width,l={left:`${o}px`,width:`${s}px`,textAlign:n.align};t.push(Object.assign(Object.assign({},n),{left:o,width:s,style:l}))}else t.push(n);return t}),[]))}),[t,i]);return[t,a]}(a),q=(0,r.useMemo)((()=>K.reduce(((e,t)=>e+t.width),0)),[K]),J=H?Math.max(Math.floor(D/H),1)-($?1:0):0,Q=e.length,{selectedItems:X,selectAll:G,selectAt:Z,selectRange:ee,toggleSelectionAt:te}=function(e,t,n){const[i,a]=(0,r.useState)([]),o=xv(e);(0,r.useLayoutEffect)((()=>{if(e!==o){const o=e.filter((e=>i.some((n=>n[t]===e[t]))));if(s=o,(r=i).length!==s.length||!r.every(((e,t)=>s[t]===e))){const t=e.length;t>0&&0===o.length?a(n<t?[e[n]]:n===t?[e[n-1]]:o):a(o)}}var r,s}),[o,e,i,t,n]);const s=(0,r.useCallback)((()=>{a(e.slice())}),[e]),l=(0,r.useCallback)((t=>{const n=e[t];a(n?[n]:[])}),[e]),c=(0,r.useCallback)(((t,n)=>{const r=Math.min(t,n),i=Math.max(t,n),o=e.slice(r,i+1);a(o)}),[e]),u=(0,r.useCallback)(((t,n)=>{const r=e[t],o=i.includes(r);o!==n&&a(o?i.filter((e=>e!==r)):e.filter((e=>i.includes(e)||e===r)))}),[e,i]);return{selectedItems:i,selectAll:s,selectAt:l,selectRange:c,toggleSelectionAt:u}}(e,t,j),ne=X.length>0,re=Ct(),[ie,ae]=(0,r.useState)(-1),[oe,se]=(0,r.useState)(-1),[le,ce]=(0,r.useState)(-1),ue=0===Q,de=-1!==le,me=H?Math.floor(R/H):0,he=Tn(Mv)&&!(0===j||j===Q-1),fe=xv(e),[pe,ve]=(0,r.useState)((()=>X)),[be,ge,ye,we]=l?X:[],Ee=e[j]?`${T}-${e[j][t]}`:"",xe=(0,r.useCallback)((()=>I.current.focus()),[]),ke=(0,r.useCallback)((e=>{const t=O.current,n=Math.floor(R/H);if(e>=n+J-1){const n=(Q+($?1:0))*H,r=Q-J-1,i=Math.min(Q-1,e+1)-J,a=i===r?n:i*H;t.scrollTo({top:a})}else if(e<=n){const n=Math.max(0,e-1)*H;t.scrollTo({top:n})}}),[R,H,J,$,Q]),Se=(0,r.useCallback)((e=>{ke(e),Z(e),L(e)}),[ke,Z]);(0,r.useEffect)((()=>{A.current={focus:xe,scrollIntoView:Se,scrollTo:ke,selectAll:G,selectAt:Z},P&&(P.current=Object.assign(P.current||{},A.current))}),[P,xe,Se,ke,G,Z]),(0,r.useEffect)((()=>{var e;null===(e=A.current)||void 0===e||e.scrollIntoView(s)}),[s]),(0,r.useLayoutEffect)((()=>null==E?void 0:E(j)),[j,E]),(0,r.useLayoutEffect)((()=>null==x?void 0:x(me)),[me,x]),(0,r.useLayoutEffect)((()=>null==k?void 0:k(J)),[J,k]),(0,r.useLayoutEffect)((()=>null==S?void 0:S(pe)),[pe,S]),(0,r.useEffect)((()=>L(Math.min(Q-1,j))),[Q,j]),(0,r.useEffect)((()=>{if(fe&&e.length!==fe.length){const n=fe[j];if(n){const r=e.findIndex((e=>e&&e[t]===n[t]));-1!==r&&L(r)}}}),[e,fe,j,t]),(0,r.useEffect)((()=>{he||ve(X)}),[X,he]),(0,r.useEffect)((()=>{ue&&L(-1)}),[ue]),(0,r.useLayoutEffect)((()=>{!d&&X.length>1&&Z(j)}),[d,j,X,Z]);const Ce=(0,r.useCallback)((t=>{switch(t.code){case"Enter":t.stopPropagation(),t.repeat||null==y||y(X,t[U.ctrlKey],t.shiftKey);break;case"Delete":t.stopPropagation(),null==g||g(X);break;case"KeyI":if(t.stopPropagation(),t.preventDefault(),t[U.ctrlKey]&&!t.shiftKey&&!t.repeat){null==w||w(X);break}break;case"KeyA":t[U.ctrlKey]&&!t.shiftKey&&(t.preventDefault(),t.stopPropagation(),t.repeat||G());break;case"ShiftLeft":case"ShiftRight":t.repeat||ae(j);break;case"Space":t.preventDefault(),t.repeat||(t[U.ctrlKey]?(t.stopPropagation(),te(j)):X.includes(e[j])||(t.stopPropagation(),te(j,!0)));break;default:{const n=e.length,r=function(e,t,n,r){switch(e){case"ArrowUp":t-=1;break;case"ArrowDown":t+=1;break;case"PageUp":t-=n-1;break;case"PageDown":t+=n-1;break;case"Home":t=0;break;case"End":t=r-1;break;default:return-1}return Math.min(Math.max(t,0),r-1)}(t.key,j,J,n);-1!==r&&(t.preventDefault(),r!==j&&(t.stopPropagation(),ke(r),L(r)),d&&t.shiftKey&&-1!==ie?ee(ie,r):t[U.ctrlKey]||Z(r))}}}),[j,e,J,y,g,w,ke,G,Z,ee,te,X,d,ie]),Pe=(0,r.useCallback)((e=>{const t=$v(e);-1!==t&&(L(t),d&&e.shiftKey?-1===ie?ee(t,j):ee(ie,t):d&&e[U.ctrlKey]?te(t):function(e){const t=zv(e);return!!(null==t?void 0:t.classList.contains("selected"))}(e)||Z(t))}),[Z,te,ee,j,ie,d]),Te=(0,r.useCallback)((e=>{if(0===e.button){const t=$v(e);-1!==t&&(!d||e[U.ctrlKey]||e.shiftKey||Z(t))}}),[Z,d]),Ae=(0,r.useCallback)((e=>{"Shift"===e.key&&ae(-1)}),[]),Ie=(0,r.useCallback)((({clientWidth:e,clientHeight:t})=>{B(e),F(t)}),[]),Oe=(0,r.useCallback)((({top:e})=>{_(e)}),[]);kt(M,(()=>{Y(M.current.getBoundingClientRect().height)})),(0,r.useLayoutEffect)((()=>{I.current.classList.toggle("thin",20*re>V)}),[re,V]);const Me=(0,r.useCallback)((t=>{const n=$v(t);-1!==n&&(t.preventDefault(),null==f||f(e[n],n))}),[e,f]),Ne=(0,r.useCallback)((e=>{if(e.preventDefault(),-1===e.button){const t=function(e,t){return e.querySelector(`li[aria-posinset="${t+1}"]`)}(I.current,j);if(t){const n=t.getBoundingClientRect();null==v||v(X,Math.min(n.left+V,n.right),n.bottom,j,e.button)}}else null==v||v(X,e.pageX,e.pageY,$v(e),e.button)}),[j,X,v,V]),$e=(0,r.useCallback)((t=>{const n=$v(t);-1!==n&&(t.preventDefault(),null==p||p(e[n],n))}),[e,p]);(0,r.useEffect)((()=>{const e=N.current;for(;e.hasChildNodes();)e.removeChild(e.lastChild);const t=Array.from(I.current.querySelectorAll(".list-view-body:not(list-view-drag-image) li.selected"));t.length=Math.min(t.length,4);for(let n=0;n<t.length;n++){const r=t[n].cloneNode(!0);r.removeAttribute("id"),r.removeAttribute("role"),r.style.transform=`translateY(${H*n}px)`,e.appendChild(r)}}),[be,ge,ye,we,H]);const ze=(0,r.useCallback)((e=>{const t=e.dataTransfer;if(l||m){t.setDragImage(N.current,-16,-16);let n="none";n=l&&m?"copyMove":l?"copy":"move",Ev.set(e,X,n),ce(j)}else t.effectAllowed="none"}),[l,m,X,j]),je=(0,r.useCallback)((e=>{e.preventDefault(),e.stopPropagation();const t=e.dataTransfer;if(c||m){const n=t.types.includes("text/plain");let r=$v(e);-1===r&&(r=Q),de?m&&n?(t.dropEffect="move",se(r)):(t.dropEffect="none",se(-1)):c&&(n||jv(t.items,u))?(t.dropEffect="copy",se(r)):(t.dropEffect="none",se(-1))}else de?t.dropEffect="copy":(t.dropEffect="none",se(-1))}),[Q,de,c,u,m]),Le=(0,r.useCallback)((e=>{if(c||m){const t=e.dataTransfer;let n=$v(e);-1===n&&(n=Q);const r=Ev.getEffect(e);if("copy"===r){const t=Ev.getData(e);t&&(null==b||b(t,n))}else if("move"===r){const e=le<n?-1:0;null==C||C(X,n),L(n+e)}else c&&jv(t.items,u)&&(null==b||b(t.files,n))}se(-1),e.preventDefault(),e.stopPropagation()}),[Q,X,c,u,m,le,b,C]),Re=(0,r.useCallback)((()=>{Ev.unset(),ce(-1)}),[]),_e=(0,r.useCallback)((()=>{se(-1)}),[]),De=(0,r.useCallback)((()=>{d||ne||Z(Math.max(j,0))}),[ne,j,d,Z]);return r.createElement("div",{className:`list-view list-view-${a.view} ${o}`,tabIndex:h?void 0:ue?-1:0,onClick:Me,onContextMenu:Ne,onDoubleClick:$e,onDragStart:ze,onDragEnter:je,onDragOver:je,onDragLeave:_e,onDragEnd:Re,onDrop:Le,onFocus:De,onKeyDown:Ce,onKeyUp:Ae,onMouseDown:Pe,onMouseUp:Te,ref:I},r.createElement(Cn,{scrollWidth:z?q:void 0,scrollHeight:(Q+(c?1:0)+($?1:0))*H,scrollAmount:H,droppable:c||m&&de,onResize:Ie,onScroll:Oe,scrollableRef:O},$&&r.createElement(Dt,null,r.createElement(Cv,{width:q,height:H,sizeable:z,cols:K,onColumnResize:W})),r.createElement(Av,{title:n,width:z?q:void 0,height:D,rowHeight:H,cols:K,items:e,itemKey:t,itemClassName:i,listViewId:T,selectedId:Ee,scrollTop:R,selection:h?Iv:X,dragIndex:oe,draggable:!h&&(l||m),multiple:d}),r.createElement("div",{className:"list-view-cursor",style:{width:z?`${q}px`:void 0,transform:`translateY(${Math.max(j,0)*H}px)`},ref:M})),r.createElement("ul",{className:"list-view-drag-image list-view-body","aria-hidden":!0,ref:N}))}function $v(e){let t=0;const n=zv(e);return n&&(t=Number(n.getAttribute("aria-posinset"))||0),t-1}function zv(e){let t=e.target;for(;t&&!(null==t?void 0:t.hasAttribute("aria-posinset"));)t=t.parentElement;return t}function jv(e,t){return-1!==Array.from(e).findIndex((e=>t.some((t=>((e,t)=>{const[n,r]=e.split("/"),[i,a]=t.split("/");return n===i&&(r===a||"*"===r)})(t,e.type)))))}function Lv(e,t){const[n,i]=(0,r.useState)(t),a=(0,r.useMemo)(e,[e]);return(0,r.useEffect)((()=>{const e=a.subscribe(i);return()=>e.unsubscribe()}),[a]),n}function Rv(){return Lv(cu,null)}function _v({children:e}){return r.createElement("footer",{className:"status-bar"},e)}function Dv({items:e,size:t,maxSize:n,error:i,loading:a,loadingText:o="Loading",selectedCount:s,itemName:l="item",itemNamePlural:c=l+"s"}){let u="";if(a)u=r.createElement("span",{className:"message"},o,"...");else if(e.length>0){const i=e.reduce((e=>e+1),0),a=r.createElement("span",{className:"selected"},"(",Fv(s)," selected)"),o=i===t?`${t.toLocaleString()} ${1===t?l:c}`:`Loaded ${Fv(i)} of ${void 0===t?n||`${Fv(e.length)}+`:Fv(n?Math.min(t,n):t)} ${c}`;u=r.createElement("span",{className:"message"},o," ",a)}else if(i){const e=function(e){return String(e.message||e.statusText||Vv[e.status]||e.status||"")}(i);u=r.createElement("span",{className:"error"},e?`Error: ${e}`:"Error")}else u=r.createElement("span",{className:"message"},"0 ",c);return r.createElement(_v,null,u)}function Fv(e=0){return(e=Number(e))<1e4?String(e):e.toLocaleString()}const Vv={401:"Unauthorized",403:"Forbidden",404:"Not found",408:"Timeout",429:"Too many requests",500:"Internal server error",502:"Bad gateway",503:"Service unavailable",504:"Timeout"};function Uv({icon:e,text:t,showConnectivity:n}){return r.createElement("span",{className:"media-source-label"},r.createElement(yi,{name:e,className:n?"show-connectivity":""}),r.createElement("span",{className:"text"},t))}const Bv=(0,r.memo)((function({time:e}){const t=100/6,n=new Date(e);let i=n.getHours()+n.getMinutes()/60,a=Math.min(i,6),o=i-a;return i>12&&(i=24-i,o=Math.min(i,6),a=i-o),r.createElement("span",{role:"presentation",className:"sun-clock",title:n.toLocaleTimeString(),style:{"--am-alpha":a*t+"%","--pm-alpha":o*t+"%"}})}));function Hv({time:e,className:t}){return r.createElement("time",{className:t},b(e))}const Yv={view:"details",fields:["Title","Genre","Owner"]};const Kv=e=>r.createElement(Hv,{className:"text",time:e.duration||0});function Wv({value:e=""}){return""===e?null:r.createElement("span",{className:"text"},e)}const qv={Index:{title:"#",render:(e,t)=>t+1,className:"index",align:"right",width:60},Artist:{title:"Artist",render:e=>{var t;return r.createElement(Wv,{value:e.itemType===Yn.Media?null===(t=e.artists)||void 0===t?void 0:t.join(", "):e.artist})},className:"artist"},AlbumArtist:{title:"Album Artist",render:e=>r.createElement(Wv,{value:e.albumArtist}),className:"artist"},Title:{title:"Title",render:e=>r.createElement(Wv,{value:e.title}),className:"title"},IconTitle:{title:"Title",render:e=>{const[t]=e.src.split(":"),n=jl(t);return n?r.createElement(Uv,{icon:n.icon,text:e.title}):r.createElement(Wv,{value:e.title})},className:"title"},Blurb:{title:"Description",render:e=>r.createElement(Wv,{value:e.description}),className:"blurb"},Album:{title:"Album",render:e=>r.createElement(Wv,{value:e.album}),className:"album"},AlbumAndYear:{title:"Album",render:e=>r.createElement(Wv,{value:e.album?e.year?`${e.album} (${e.year})`:e.album:e.year}),className:"album"},Track:{title:"Track",render:e=>r.createElement(Wv,{value:e.track||"-"}),align:"right",width:80,className:"track"},Duration:{title:"Time",render:Kv,align:"right",width:120,className:"duration"},FileIcon:{title:"Thumbnail",render:(e,t)=>{const n=e.itemType===Yn.Media?e.mediaType===Nr.Video?"file-video":"file-audio":0===t&&e.fileName.startsWith("../")?"folder-up":"folder";return r.createElement("figure",{className:"cover-art"},r.createElement(yi,{className:"cover-art-image",name:n}))},className:"thumbnail"},FileName:{title:"FileName",render:e=>r.createElement(Wv,{value:e.fileName}),className:"title"},PlayCount:{title:"Plays",render:e=>r.createElement(Wv,{value:Jv(e.playCount)}),align:"right",width:80,className:"play-count"},TrackCount:{title:"Tracks",render:e=>r.createElement(Wv,{value:Jv(e.trackCount)}),align:"right",width:120,className:"track-count"},Year:{title:"Year",render:e=>r.createElement(Wv,{value:e.year}),width:120,className:"year"},Views:{title:"Views",render:e=>void 0===e.globalPlayCount?null:r.createElement(Wv,{value:Qv(e.globalPlayCount,"view")}),className:"views"},Genre:{title:"Genre",render:e=>{var t;return r.createElement(Wv,{value:null===(t=e.genres)||void 0===t?void 0:t.join(", ")})},className:"genre"},Owner:{title:"Owner",render:e=>{var t;return r.createElement(Wv,{value:null===(t=e.owner)||void 0===t?void 0:t.name})},className:"owner"},LastPlayed:{title:"Last played",render:e=>{if(!e.playedAt)return"";const t=new Date(1e3*e.playedAt),n=function(e){const t=Date.now()-e,n=6e4;if(t<12e4)return"just now";const r=36e5;if(t<54e5)return`${Math.round(t/n)} mins ago`;const i=24*r;if(t<1.5*i)return`${Math.round(t/r)} hours ago`;if(t<12*i)return`${Math.round(t/i)} days ago`;const a=7*i;if(t<10*a)return`${Math.round(t/a)} weeks ago`;const o=365*i;return t<o?`${Math.round(t/2592e6)} months ago`:t<2*o?"1 year ago":`${Math.floor(t/o)} years ago`}(t.valueOf());return r.createElement("time",{className:"text last-played",title:t.toLocaleDateString()},n)},className:"played-at"},ListenDate:{title:"Played On",render:e=>{if(!e.playedAt)return"";const t=1e3*e.playedAt;return r.createElement("time",{className:"text"},r.createElement(Bv,{time:t}),r.createElement("span",{className:"date"},new Date(t).toLocaleDateString()))},className:"played-at listen-date"},Thumbnail:{title:"Thumbnail",render:e=>r.createElement(Vp,{item:e}),className:"thumbnail"},Rate:{title:r.createElement(Ip,{rating:0}),render:e=>{const t=(0,r.useCallback)((t=>{return n=void 0,r=void 0,a=function*(){yield gv(Bn.Rate,[e],t)},new((i=void 0)||(i=Promise))((function(e,t){function o(e){try{l(a.next(e))}catch(e){t(e)}}function s(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(o,s)}l((a=a.apply(n,r||[])).next())}));var n,r,i,a}),[e]);return r.createElement(Ip,{rating:e.rating,onClick:t})},className:"rate",width:120}};function Jv(e){if(null==e)return"";const t=Number(e);return isNaN(t)?"":t.toLocaleString()}function Qv(e=0,t="listen",n=t+"s"){return 1===e?`1 ${t}`:e<1e3?`${e} ${n}`:e<1e5?`${(e/1e3).toFixed(1).replace(".0","")}K  ${n}`:e<1e6?`${Math.round(e/1e3)}K  ${n}`:e<1e8?`${(e/1e6).toFixed(1).replace(".0","")}M  ${n}`:e<1e9?`${Math.round(e/1e6)}M  ${n}`:`${(e/1e9).toFixed(1).replace(".0","")}M  ${n}`}var Xv=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))},Gv=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Zv(e){var{className:t="",pager:n=null,keepAlive:i,statusBar:a=!0,loadingText:o,onDoubleClick:s,onEnter:l,onSelect:c}=e,u=Gv(e,["className","pager","keepAlive","statusBar","loadingText","onDoubleClick","onEnter","onSelect"]);const d=function(e=Yv){return(0,r.useMemo)((()=>function(e){const{view:t,fields:n}=e,i=n.map((e=>qv[e]));return i.push({title:r.createElement(yi,{name:"menu"}),render:e=>r.createElement($p,{item:e,inline:!0}),className:"actions",align:"right",width:80}),"details"===t?{view:t,cols:i,showTitles:!0,sizeable:!0}:{view:t,cols:i}}(e)),[e])}(u.layout),[m,h]=(0,r.useState)(0),[f,p]=(0,r.useState)(0),[{items:v,loaded:b,error:g,size:y,maxSize:w},E]=function(e,t=!1){const[n,i]=function(){const e=(0,r.useRef)(null);null===e.current&&(e.current=new Te),(0,r.useEffect)((()=>()=>{var t;return null===(t=e.current)||void 0===t?void 0:t.complete()}),[]);const t=(0,r.useCallback)((t=>{e.current.next(t)}),[]);return[e.current,t]}(),[a,o]=(0,r.useState)([]),[s,l]=(0,r.useState)(void 0),[c,u]=(0,r.useState)(void 0),[d,m]=(0,r.useState)(),[h,f]=(0,r.useState)(!1),p=(0,r.useMemo)((()=>({items:a,size:s,maxSize:c,error:d,loaded:h})),[a,s,c,d,h]),v=(0,r.useCallback)(((e,t)=>{i([e,t])}),[i]);return(0,r.useEffect)((()=>{if(o([]),l(void 0),u(void 0),m(void 0),f(!1),!e)return;const r=e.observeItems(),i=e.observeSize(),a=e.observeError(),s=bn(r,a).pipe(mr(1),Xt((()=>!0))),c=gn(Pn([]),Pn([]).pipe(xl(0))),d=new ne;return d.add(gn(c,r).subscribe(o)),d.add(i.subscribe(l)),d.add(a.subscribe(m)),d.add(s.subscribe(f)),d.add(n.subscribe((([t,n])=>e.fetchAt(t,n)))),t||d.add((()=>e.disconnect())),u(e.maxSize),()=>d.unsubscribe()}),[e,n,t]),[p,v]}(n,i),[x,k]=(0,r.useState)(0),S=Rv(),C=function(e){const[t,n]=(0,r.useState)("");return(0,r.useEffect)((()=>{let t=0;"details"!==e.view&&e.cols.forEach((e=>{/played-at/.test(e.className)&&(t=2),2!==t&&/duration|track-count|play-count/.test(e.className)&&(t=1)})),n(t?`clip-${t}`:"")}),[e]),t}(d);(0,r.useEffect)((()=>{m>=0&&f>0&&E(m,f)}),[E,m,f,n]);const P=(0,r.useCallback)((e=>{k(e.length),null==c||c(e)}),[c]),T=(0,r.useCallback)(((e,t,n,r,i)=>Xv(this,void 0,void 0,(function*(){if(0===e.length)return;const r=yield Sp(e,!0,t,n,-1===i?"right":"left");r&&(yield gv(r,e))}))),[]),A=(0,r.useCallback)(((e,t)=>Xv(this,void 0,void 0,(function*(){eb(e)?yield gv(Bn.Queue,[e]):null==s||s(e,t)}))),[s]),I=(0,r.useCallback)(((e,t,n)=>Xv(this,void 0,void 0,(function*(){e.every(eb)?t||n?t&&!n?yield gv(Bn.PlayNow,e):n&&!t&&(yield gv(Bn.PlayNext,e)):yield gv(Bn.Queue,e):null==l||l(e,t,n)}))),[l]),O=(0,r.useCallback)((e=>Xv(this,void 0,void 0,(function*(){yield gv(Bn.Info,e)}))),[]),M=(0,r.useCallback)((e=>{if(e.itemType===Yn.Media){const[t]=e.src.split(":");return`source-${t} ${e.src===(null==S?void 0:S.src)?"playing":""} ${e.unplayable?"unplayable":""}`}return""}),[S]);return r.createElement("div",{className:`panel ${t} ${C}`},r.createElement(Nv,Object.assign({},u,{className:"media-list",layout:d,items:v,itemClassName:M,itemKey:"src",selectedIndex:0===v.length?-1:0,onContextMenu:T,onDoubleClick:A,onEnter:I,onInfo:O,onPageSizeChange:p,onScrollIndexChange:h,onSelect:P})),a?r.createElement(Dv,{items:v,error:g,size:y,maxSize:w,loading:!!n&&!b,loadingText:o,selectedCount:x}):null)}function eb(e){return e.itemType===Yn.Media||e.itemType===Yn.Album}var tb=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const nb={view:"details",fields:["Artist","Title","Album","Track","Duration","Genre","PlayCount"]};function rb(e){var{className:t="",layout:n=nb,multiple:i=!0,draggable:a=!0}=e,o=tb(e,["className","layout","multiple","draggable"]);return r.createElement(Zv,Object.assign({},o,{className:`media-items ${t}`,layout:n,multiple:i,draggable:a}))}var ib=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function ab(e){var{source:t,className:n=""}=e,i=ib(e,["source","className"]);return r.createElement("div",{className:`panel media-item-browser ${n}`},r.createElement(rb,Object.assign({},i,{title:t.title})),";")}function ob(e){var t;return(null===(t=window.MusicKit)||void 0===t?void 0:t.version.startsWith("3"))?r.createElement(ab,Object.assign({},e)):r.createElement(sb,null)}function sb(){return r.createElement(_u,null,r.createElement("div",{className:"note"},r.createElement("p",null,r.createElement("strong",null,"Apple MusicKit beta required.")),r.createElement("p",null,"You need to enable ",r.createElement("strong",null,"MusicKit beta")," from the Settings screen to watch videos from Apple Music.")))}function lb({min:e="1970",max:t=cb(),value:n=t,onSelect:i}){const[a,o]=(0,r.useState)((()=>String(new Date(n).getFullYear()))),s=function(e,t){const[n,i]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const n=[],r=new Date(e),a=new Date(t),o=r.getFullYear();let s=a.getFullYear();for(;s>=o;)n.push(s),s--;i(n)}),[e,t]),n}(e,t);(0,r.useEffect)((()=>{null==i||i(a)}),[i,a]);const l=(0,r.useCallback)((e=>{o(e.target.value)}),[]);return r.createElement("span",{className:"year-picker"},r.createElement("select",{defaultValue:a,onChange:l},s.map((e=>r.createElement("option",{value:e,key:e},e)))))}function cb(){const e=new Date;return String(e.getFullYear())}const ub=(()=>{const e=new Intl.DateTimeFormat(navigator.language,{month:"short"}).format;return[...Array(12).keys()].map((t=>e(new Date(2022,t,2))))})();function db({min:e="1970-01",max:t=v(),value:n=t,onSelect:i}){const a=(0,r.useRef)(null),[o,s]=(0,r.useState)((()=>String(new Date(n).getFullYear()))),[l,c]=(0,r.useState)((()=>new Date(n).getMonth())),u=function(e,t,n){const[i,a]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const r=[],i=new Date(t),o=new Date(n),s=Number(e)===i.getFullYear()?i.getMonth():0;let l=Number(e)===o.getFullYear()?o.getMonth():11;for(;l>=s;)r.push(l),l--;a(r)}),[e,t,n]),i}(o,e,t);(0,r.useEffect)((()=>{const e=u[0];void 0!==e&&(a.current.value=String(e),c(e))}),[u]),(0,r.useEffect)((()=>{-1!==l&&(null==i||i(`${o}-${String(l+1).padStart(2,"0")}`))}),[i,o,l]);const d=(0,r.useCallback)((e=>{c(-1),s(e)}),[]),m=(0,r.useCallback)((e=>{c(Number(e.target.value))}),[]);return r.createElement("span",{className:"month-picker"},r.createElement(lb,{min:e,max:t,value:o,onSelect:d}),r.createElement("select",{defaultValue:l,onChange:m,key:o,ref:a},u.map((e=>r.createElement("option",{value:e,key:e},ub[e])))))}function mb({min:e="1970-01-01",max:t=p(),value:n=t,onSelect:i}){const a=(0,r.useRef)(null),[o,s]=(0,r.useState)((()=>v(n))),[l,c]=(0,r.useState)((()=>new Date(n).getDate())),u=function(e,t,n){const[i,a]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const r=[],i=new Date(t),o=new Date(n),s=e.split("-").map(Number),l=s[0],c=s[1]-1,u=l===i.getFullYear()&&c===i.getMonth()?i.getDate():1;let d=l===o.getFullYear()&&c===o.getMonth()?o.getDate():new Date(l,c+1,0).getDate();for(;d>=u;)r.push(d),d--;a(r)}),[e,t,n]),i}(o,e,t);(0,r.useEffect)((()=>{const e=u[0];e&&(a.current.value=String(e),c(e))}),[u]),(0,r.useEffect)((()=>{l&&(null==i||i(`${o}-${String(l).padStart(2,"0")}`))}),[i,o,l]);const d=(0,r.useCallback)((e=>{c(0),s(e)}),[]),m=(0,r.useCallback)((e=>{c(Number(e.target.value))}),[]);return r.createElement("span",{className:"date-picker"},r.createElement(db,{min:e,max:t,value:o,onSelect:d}),r.createElement("select",{defaultValue:l,onChange:m,key:o,ref:a},u.map((e=>r.createElement("option",{value:e,key:e},e)))))}function hb({icon:e,children:t}){return r.createElement("h2",{className:"page-header"},r.createElement(Uv,{icon:e,text:t}))}function fb(e,t){const[n,i]=(0,r.useState)(null);return(0,r.useEffect)((()=>{i((null==e?void 0:e.search(t))||null)}),[e,t]),n}var pb=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const vb={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","ListenDate"]};function bb(e){var{service:t,source:n,minDate:i="2010-01-1"}=e,a=pb(e,["service","source","minDate"]);const[o,s]=(0,r.useState)(0),l=function(e,t=0){return fb(e,(0,r.useMemo)((()=>({startAt:t})),[t]))}(n,o),c=(0,r.useCallback)((e=>{const t=new Date,n=new Date(e);n.getFullYear()===t.getFullYear()&&n.getMonth()===t.getMonth()&&n.getDate()===t.getDate()?s(0):s(Math.floor(n.valueOf()/1e3))}),[]);return r.createElement(r.Fragment,null,r.createElement(hb,{icon:t.icon},t.name,":",r.createElement(mb,{min:i,onSelect:c})),r.createElement(ab,Object.assign({},a,{className:"history-browser",source:n,pager:l,layout:n.layout||vb})))}const gb="2002-11-20",yb=new A("lastfm/useHistoryStart");function wb(){const e=function(){const[e,t]=(0,r.useState)((()=>fa.firstScrobbledAt)),n=""===e||e===gb;return(0,r.useEffect)((()=>{if(n){t(gb);const e=vn(Sa.getUserInfo()).pipe(Xt((e=>Number(e.user.playcount))),Zt((e=>{return e?Pn(e):(n=G(t=()=>Error("No history."))?t:function(){return t},new Se((function(e){return e.error(n())})));var t,n})),Xt((e=>Math.floor(e/50))),Xt((e=>new Ta({page:e},{pageSize:50}))),Zt((e=>hr(e))),Xt((e=>e.at(-1))),ze(l),Xt((e=>new Date(1e3*e.playedAt))),Xt(p),$e((e=>fa.firstScrobbledAt=e)),$e(t)).subscribe(yb);return()=>e.unsubscribe()}}),[n]),e}();return r.createElement(bb,{service:ja,source:Ma,minDate:e})}class Eb extends Dr{disconnect(){super.disconnect(),this.items.forEach((e=>{var t;return null===(t=e.pager)||void 0===t?void 0:t.disconnect()}))}fetchAt(){}next(e){this.disconnected||(this.subscriptions||this.connect(),this.size$.next(e.length),this.items$.next(e))}}var xb=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const kb={view:"card",fields:["Thumbnail","Title","Artist","AlbumAndYear","LastPlayed"]};function Sb(e){var{service:t,source:n,total:i}=e,a=xb(e,["service","source","total"]);const[,o]=(0,r.useReducer)((e=>e+1),0);return(0,r.useEffect)((()=>{const e=setInterval(o,6e4);return()=>clearInterval(e)}),[]),r.createElement(r.Fragment,null,r.createElement(hb,{icon:t.icon},void 0===i?t.name:r.createElement(r.Fragment,null,t.name,": ",i.toLocaleString()," scrobbles")),r.createElement(ab,Object.assign({},a,{className:"recently-played-browser",source:n,layout:n.layout||kb})))}var Cb=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};const Pb=new A("LastFmRecentlyPlayedBrowser");function Tb(){const{pager:e,total:t}=function(){const e=(0,r.useMemo)((()=>Math.floor(Date.now()/1e3)),[]),[t,n]=(0,r.useState)(null),[i,a]=(0,r.useState)(void 0);return(0,r.useEffect)((()=>{const t=new Eb,r=new Ta({to:e}),i=new zr(t,r),o=bn(vc().pipe(wl(1),xl(2e4)),_t(3e5)),s=new ne;return s.add(r.observeItems().pipe(Is((e=>0===e.length)),mr(1),Xt((e=>e[0].playedAt)),yn((e=>o.pipe(Zt((()=>function(e){return Cb(this,void 0,void 0,(function*(){const t=new Ta({from:e});return yield hr(t)}))}(e+1))),$e((e=>t.next(e))))))).subscribe(Pb)),s.add(i.observeSize().pipe($e(a)).subscribe(Pb)),t.next([]),n(i),()=>s.unsubscribe()}),[e]),{pager:t,total:i}}();return r.createElement(Sb,{service:ja,source:Na,pager:e,total:t})}var Ab=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Ib=[{value:"overall",text:"All time"},{value:"12month",text:"Year"},{value:"1month",text:"Month"},{value:"7day",text:"Week"}];function Ob(e){var{source:t}=e,n=Ab(e,["source"]);const i=(0,r.useId)(),[a,o]=(0,r.useState)(),s=function(e,t="overall"){return fb(e,(0,r.useMemo)((()=>({period:t})),[t]))}(t,a),l=(0,r.useCallback)((e=>{o(e.target.value)}),[]);return r.createElement(r.Fragment,null,r.createElement(hb,{icon:ja.icon},ja.name,": ",t.title),r.createElement("div",{className:"lastfm-period-selector options"},r.createElement("ul",{className:"lastfm-periods"},Ib.map((({value:e,text:t})=>r.createElement("li",{className:"lastfm-period",key:e},r.createElement("input",{id:`${i}-period-${e}`,type:"radio",name:"lastfm-period",value:e,defaultChecked:"overall"===e,onChange:l}),r.createElement("label",{htmlFor:`${i}-period-${e}`},t)))))),r.createElement(Eg,Object.assign({},n,{source:t,pager:s,layout:t.layout})))}const Mb="2015-09-17";function Nb(){const e=function(){const[e,t]=(0,r.useState)(Da.firstScrobbledAt),n=""===e||e===Mb;return(0,r.useEffect)((()=>{if(n){t(Mb);const e=vn(Ba.getListeningActivity()).pipe(Xt((e=>e.find((e=>e.listen_count>0)))),ze(l),Xt((e=>p(1e3*Number(e.from_ts)))),$e((e=>Da.firstScrobbledAt=e)),mr(1)).subscribe(t);return()=>e.unsubscribe()}}),[n]),e}();return r.createElement(bb,{service:Ko,source:Do,minDate:e})}var $b=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};const zb=new A("ListenBrainzRecentlyPlayedBrowser");function jb(){const{pager:e,total:t}=function(){const e=(0,r.useMemo)((()=>Math.floor(Date.now()/1e3)),[]),[t,n]=(0,r.useState)(null),[i,a]=(0,r.useState)(void 0);return(0,r.useEffect)((()=>{const t=new Eb,r=new Mo({max_ts:e},!0),i=new zr(t,r),o=bn(vc().pipe(wl(1),xl(2e4)),_t(3e5)),s=new ne;return s.add(r.observeItems().pipe(Is((e=>0===e.length)),mr(1),Xt((e=>e[0].playedAt)),yn((e=>o.pipe(Zt((()=>function(e){return $b(this,void 0,void 0,(function*(){const t=new Mo({min_ts:e});return yield hr(t)}))}(e+1))),$e((e=>t.next(e))))))).subscribe(zb)),s.add(i.observeSize().pipe($e(a)).subscribe(zb)),t.next([]),n(i),()=>s.unsubscribe()}),[e]),{pager:t,total:i}}();return r.createElement(Sb,{service:Ko,source:Fo,pager:e,total:t})}var Lb=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Rb={view:"card compact",fields:["Thumbnail","Title","Artist","Year"]};function _b(e){var{className:t="",layout:n=Rb,draggable:i=!0}=e,a=Lb(e,["className","layout","draggable"]);return r.createElement(Zv,Object.assign({},a,{className:`albums ${t}`,layout:n,draggable:i}))}var Db=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Fb={view:"details",fields:["Index","Title","Artist","Duration"]};function Vb(e){var{source:t,className:n=""}=e,i=Db(e,["source","className"]);const[a,o]=(0,r.useState)(null),s=(0,r.useCallback)((([e])=>{o(e||null)}),[]);return r.createElement("div",{className:`panel album-browser ${n}`},r.createElement(At,{id:"album-browser-layout",arrange:"rows",primaryIndex:1},r.createElement(_b,Object.assign({},i,{title:t.title,onSelect:s})),r.createElement(rb,{title:a?`${a.title}: Tracks`:"",className:"album-items",pager:null==a?void 0:a.pager,keepAlive:!0,layout:t.secondaryLayout||Fb})))}var Ub=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Bb={view:"card compact",fields:["Thumbnail","Title","Genre"]};function Hb(e){var{className:t="",layout:n=Bb}=e,i=Ub(e,["className","layout"]);return r.createElement(Zv,Object.assign({},i,{className:`artists ${t}`,layout:n}))}var Yb=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Kb=[{value:"all_time",text:"All time"},{value:"year",text:"Year"},{value:"month",text:"Month"},{value:"week",text:"Week"}];function Wb(e){var{source:t}=e,n=Yb(e,["source"]);const i=(0,r.useId)(),[a,o]=(0,r.useState)(),s=function(e,t="all_time"){return fb(e,(0,r.useMemo)((()=>({range:t})),[t]))}(t,a),l=(0,r.useCallback)((e=>{o(e.target.value)}),[]);return r.createElement(r.Fragment,null,r.createElement(hb,{icon:Ko.icon},Ko.name,": ",t.title),r.createElement("div",{className:"listenbrainz-range-selector options"},r.createElement("ul",{className:"listenbrainz-ranges"},Kb.map((({value:e,text:t})=>r.createElement("li",{className:"listenbrainz-range",key:e},r.createElement("input",{id:`${i}-range-${e}`,type:"radio",name:"listenbrainz-range",value:e,defaultChecked:"all_time"===e,onChange:l}),r.createElement("label",{htmlFor:`${i}-range-${e}`},t)))))),r.createElement(qb,Object.assign({},n,{source:t,pager:s,layout:t.layout})))}function qb(e){switch(e.source.itemType){case Yn.Artist:return r.createElement("div",{className:"panel artist-browser"},r.createElement(Hb,Object.assign({},e,{title:e.source.title})));case Yn.Album:return r.createElement(Vb,Object.assign({},e));default:return r.createElement(ab,Object.assign({},e))}}var Jb=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const Qb={view:"card compact",fields:["Thumbnail","Title","Year"]},Xb={view:"details",fields:["Index","Title","Artist","Duration"]},Gb={view:"details",fields:["Index","Title","Artist","Duration","Album","Year"]};function Zb(e){var{source:t,className:n=""}=e,i=Jb(e,["source","className"]);const[a,o]=(0,r.useState)(null),[s,l]=(0,r.useState)(null),[c,u]=(0,r.useState)(Xb),d=(0,r.useCallback)((([e])=>{o(e||null)}),[]),m=(0,r.useCallback)((([e])=>{l(e||null),u(/^\w+:top-tracks/.test(null==e?void 0:e.src)?Gb:Xb)}),[]);return r.createElement("div",{className:`panel artist-browser ${n}`},r.createElement(At,{id:"artist-browser-layout",arrange:"columns",primaryIndex:0},r.createElement(Hb,Object.assign({},i,{title:t.title,onSelect:d})),r.createElement(At,{id:"artist-album-browser-layout",arrange:"rows",primaryIndex:1},r.createElement(_b,{title:a?`${a.title}: Albums`:"",className:"artist-albums",pager:null==a?void 0:a.pager,keepAlive:!0,layout:t.secondaryLayout||Qb,onSelect:m}),r.createElement(rb,{title:s?`${s.title}: Tracks`:"",className:"album-items",pager:null==s?void 0:s.pager,keepAlive:!0,layout:t.tertiaryLayout||c}))))}var eg=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const tg={view:"card minimal",fields:["FileIcon","FileName"]};function ng(e){var{className:t="",layout:n=tg,multiple:i=!0,draggable:a=!0,onSelect:o}=e,s=eg(e,["className","layout","multiple","draggable","onSelect"]);const[l,c]=(0,r.useState)([]),u=(0,r.useMemo)((()=>i&&l.every((e=>e.itemType===Yn.Media))),[i,l]),d=(0,r.useMemo)((()=>a&&l.every((e=>e.itemType===Yn.Media))),[a,l]),m=(0,r.useCallback)((e=>{c(e),null==o||o(e)}),[o]);return r.createElement(Zv,Object.assign({},s,{className:`folder-items ${t}`,layout:n,multiple:u,draggable:d,onSelect:m}))}var rg=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))},ig=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function ag(e){var{service:t,source:n,className:i=""}=e,a=ig(e,["service","source","className"]);const[o,s]=(0,r.useState)(null),[l,c]=(0,r.useState)("/");(0,r.useEffect)((()=>{const e=n.search();return s(e),c("/"),()=>e.disconnect()}),[n]);const u=(0,r.useCallback)((e=>rg(this,void 0,void 0,(function*(){e.itemType===Yn.Folder&&(s(e.pager),c(e.path||"/"))}))),[]),d=(0,r.useCallback)((e=>rg(this,void 0,void 0,(function*(){if(1===e.length){const t=e[0];(null==t?void 0:t.itemType)===Yn.Folder&&(s(t.pager),c(t.path||"/"))}}))),[]);return r.createElement(r.Fragment,null,r.createElement(hb,{icon:t.icon},t.name,": ",l),r.createElement("div",{className:`panel folder-item-browser ${i}`},r.createElement(ng,Object.assign({},a,{title:`Path: ${l}`,pager:o,keepAlive:!0,onEnter:d,onDoubleClick:u}))))}function og({sources:e,onSourceChange:t}){const n=(0,r.useId)(),i=(0,r.useCallback)((n=>{const r=Number(n.target.value),i=e[r];null==t||t(i)}),[e,t]);return r.createElement("div",{className:"media-source-selector options"},r.createElement("ul",{className:"media-sources"},e.map(((e,t)=>r.createElement("li",{className:"media-source",key:e.id},r.createElement("input",{id:`${n}-${e.id}`,type:"radio",name:n,value:t,defaultChecked:0===t,onChange:i}),r.createElement("label",{htmlFor:`${n}-${e.id}`},e.title))))))}var sg=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const lg={view:"card compact",fields:["Thumbnail","Title","TrackCount","Owner"]};function cg(e){var{className:t="",layout:n=lg}=e,i=sg(e,["className","layout"]);return r.createElement(Zv,Object.assign({},i,{className:`playlists ${t}`,layout:n}))}var ug=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const dg={view:"details",fields:["Index","Artist","Title","Album","Duration","Genre"]};function mg(e){var{source:t,className:n=""}=e,i=ug(e,["source","className"]);const[a,o]=(0,r.useState)(null),s=(0,r.useCallback)((([e])=>{o(e||null)}),[]);return r.createElement("div",{className:`panel playlist-browser ${n}`},r.createElement(At,{id:"playlist-browser-layout",arrange:"rows",primaryIndex:1},r.createElement(cg,Object.assign({},i,{title:t.title,onSelect:s})),r.createElement(rb,{title:a?`${a.title}: Tracks`:"",className:"playlist-items",pager:null==a?void 0:a.pager,keepAlive:!0,layout:t.secondaryLayout||dg})))}var hg=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};const fg={view:"card",fields:["Thumbnail","IconTitle","TrackCount","Owner"]},pg={view:"card compact",fields:["Thumbnail","Title","Artist","AlbumAndYear","Duration"]};function vg(e){var{source:t,className:n=""}=e,i=hg(e,["source","className"]);const[a,o]=(0,r.useState)(null);(0,r.useEffect)((()=>()=>Wr.unlock()),[t]),(0,r.useEffect)((()=>{a&&Wr.lock(a)}),[a]);const s=(0,r.useCallback)((([e])=>{o(e||null)}),[]);return r.createElement("div",{className:`panel playlist-browser pinned-playlist-browser ${n}`},r.createElement(cg,Object.assign({},i,{title:t.title,layout:t.layout||fg,onSelect:s,statusBar:!1,disabled:!0})),r.createElement(rb,{title:`${t.title}: Tracks`,className:"playlist-items",pager:null==a?void 0:a.pager,keepAlive:!0,layout:t.secondaryLayout||pg}))}function bg({error:e,children:t}){return r.createElement("div",{className:"panel error-screen"},r.createElement("div",{className:"error-screen-content"},r.createElement("h2",null,"Error"),r.createElement("pre",{className:"note error"},(null==e?void 0:e.message)||String(e)),t))}function gg({service:e,sources:t}){const n=Lv(e.observeIsLoggedIn,!1),i=function(e){return(0,r.useMemo)((()=>function({error:t}){return r.createElement(bg,{error:t},e&&r.createElement("p",null,r.createElement("button",{className:"disconnect",onClick:e.logout},"Reconnect to ",e.name,"...")))}),[e])}(e),a=`${e.id}/${t.map((e=>e.id))}`;return r.createElement("div",{className:`media-browser ${e.id}-browser`,key:a},n?r.createElement(Bl.SV,{fallbackRender:i},r.createElement(yg,{service:e,sources:t})):r.createElement(Lu,{service:e}))}function yg({service:e,sources:t}){const n=1===t.length?t[0]:null;switch((0,r.useEffect)((()=>{(null==n?void 0:n.viewType)===Wn.Library?or.lock(e.id,n.itemType):or.unlock()}),[e,n]),(0,r.useEffect)((()=>{(null==n?void 0:n.viewType)===Wn.Ratings?dr.lock(e.id,n.itemType):dr.unlock()}),[e,n]),(0,r.useEffect)((()=>()=>{or.unlock(),dr.unlock()}),[e]),null==n?void 0:n.id){case"lastfm/top/tracks":case"lastfm/top/albums":case"lastfm/top/artists":return r.createElement(Ob,{source:n});case"listenbrainz/top/tracks":case"listenbrainz/top/albums":case"listenbrainz/top/artists":return r.createElement(Wb,{source:n});case"lastfm/history":return r.createElement(wb,null);case"listenbrainz/history":return r.createElement(Nb,null);case"lastfm/recently-played":return r.createElement(Tb,null);case"listenbrainz/recently-played":return r.createElement(jb,null);case"jellyfin/folders":case"plex/folders":return r.createElement(ag,{service:e,source:n});default:return r.createElement(wg,{service:e,sources:t})}}function wg({service:e,sources:t}){const[n,i]=(0,r.useState)((()=>t[0])),[a,o]=(0,r.useState)(""),s=function(e,t=""){return fb(e,(0,r.useMemo)((()=>({q:t})),[t]))}(n,a),l=!!n.searchable,c=!l&&!n.isPin;return r.createElement(r.Fragment,null,c?r.createElement(hb,{icon:e.icon},e.name,": ",n.title):null,l?r.createElement(Ru,{icon:e.icon,placeholder:`Search ${e.name}`,onSubmit:o}):null,t.length>1?r.createElement(og,{sources:t,onSourceChange:i}):null,r.createElement(Eg,{className:l?"search-browser":"",source:n,pager:s,layout:n.layout,loadingText:a?"Searching":void 0}))}function Eg(e){switch(e.source.itemType){case Yn.Artist:return r.createElement(Zb,Object.assign({},e));case Yn.Album:return r.createElement(Vb,Object.assign({},e));case Yn.Playlist:return e.source.isPin?r.createElement(vg,Object.assign({},e)):r.createElement(mg,Object.assign({},e));default:switch(e.source.id){case"apple/search/videos":case"apple/library-videos":return r.createElement(ob,Object.assign({},e));default:return r.createElement(ab,Object.assign({},e))}}}console.log("component::MediaSources");const xg=new z("sources");function kg({onSelect:e}){const t=(0,r.useRef)(null),n=function(){const[e,t]=(0,r.useState)([]);return(0,r.useEffect)((()=>{const e=bn(Fl.pipe(ze((e=>e!==Dl)),Xt((()=>{}))),Wr.observe()).pipe(Xt((()=>$l().filter(Vl).map((e=>({id:e.id,label:r.createElement(Uv,{icon:e.icon,text:e.name,showConnectivity:!0}),value:r.createElement(gg,{service:e,sources:e.roots}),startExpanded:!0,children:e.sources.filter(Vl).map((t=>({id:t.id,label:r.createElement(Uv,{icon:t.icon,text:t.title}),value:r.createElement(gg,{service:e,sources:[t]})}))).concat(Wr.getPinsForService(e.id).map((t=>{var n;return null===(n=e.createSourceFromPin)||void 0===n?void 0:n.call(e,t)})).filter(l).map((t=>({id:t.id,label:r.createElement(Uv,{icon:t.icon,text:t.title}),value:r.createElement(gg,{service:e,sources:[t]})}))))})))))).subscribe(t);return()=>e.unsubscribe()}),[]),e}();return(0,r.useEffect)((()=>{t.current.focus()}),[]),r.createElement("div",{className:"panel media-sources"},r.createElement(Dn,{roots:n,onSelect:e,storageId:xg.id,treeViewRef:t}))}var Sg=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Cg(e){var{id:t,item:n,index:i,selected:a}=e,o=Sg(e,["id","item","index","selected"]);return r.createElement("button",Object.assign({},o,{className:"tab",id:`${t}-tab-${i}`,tabIndex:a?0:-1,role:"tab","aria-selected":a,"aria-controls":`${t}-panel-${i}`}),n.tab)}function Pg({id:e,item:t,index:n,hidden:i}){return r.createElement("div",{className:"tab-panel",id:`${e}-panel-${n}`,hidden:i,role:"tabpanel","aria-labelledby":`${e}-tab-${n}`},t.panel)}function Tg({label:e,items:t,className:n=""}){const i=(0,r.useId)(),a=(0,r.useRef)(null),[o,s]=(0,r.useState)([]),[l,c]=(0,r.useState)(0);(0,r.useLayoutEffect)((()=>{s(Array.from(a.current.querySelectorAll("button")))}),[]);const u=(0,r.useCallback)((e=>{let t=l;"ArrowRight"===e.code?(e.stopPropagation(),t++):"ArrowLeft"===e.code&&(e.stopPropagation(),t--),t=Math.min(Math.max(t,0),o.length-1);const n=o[t];n&&!n.disabled&&n.focus()}),[l,o]),d=(0,r.useCallback)((e=>{const t=e.target;if(t.id){const e=Number(t.id.split("-").pop());c(e)}}),[]);return r.createElement("div",{className:`tab-list ${n}`},r.createElement("ul",{className:"tab-list-tabs",role:"tablist","aria-label":e,onFocus:d,onKeyDown:u,ref:a},t.map(((e,t)=>r.createElement("li",{role:"presentation",key:t},r.createElement(Cg,{id:i,item:e,index:t,selected:t===l}))))),r.createElement("div",{className:"tab-list-panels"},t.map(((e,t)=>r.createElement(Pg,{id:i,item:e,index:t,hidden:t!==l,key:t})))))}function Ag({service:e}){const t=(0,r.useId)(),n=(0,r.useRef)(null),i=Lv(e.observeIsLoggedIn,!1),a=(0,r.useCallback)((()=>{const e=n.current.elements,t={};for(const n of e)t[n.value]=!n.checked;Ul(t)}),[]);return r.createElement("form",{className:"media-service-settings-general",method:"dialog",onSubmit:a},r.createElement("p",null,r.createElement("button",{type:"button",className:"disconnect",onClick:e.logout,disabled:!i},i?"Disconnect...":"Not connected")),r.createElement("fieldset",{ref:n},r.createElement("legend",null,"Display"),r.createElement("ul",null,e.sources.map((e=>r.createElement("li",{key:e.id},r.createElement("input",{id:`${t}-${e.id}`,type:"checkbox",value:e.id,defaultChecked:Vl(e)}),r.createElement("label",{htmlFor:`${t}-${e.id}`},e.title)))))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}var Ig=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Og(e){var{renderItem:t=String,className:n=""}=e,i=Ig(e,["renderItem","className"]);const a=(0,r.useMemo)((()=>({view:"details",cols:[{render:t}]})),[t]);return r.createElement(Nv,Object.assign({},i,{className:`list-box ${n}`,layout:a}))}var Mg=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};function Ng({service:e}){const t=(0,r.useMemo)((()=>e=>e.title),[]),[n,i]=(0,r.useState)((()=>Wr.getPinsForService(e.id))),[a,o]=(0,r.useState)([]),s=(0,r.useCallback)((()=>Mg(this,void 0,void 0,(function*(){const t=Wr.getPinsForService(e.id);yield Wr.unpin(t.filter((e=>-1===n.findIndex((t=>t.src===e.src)))))}))),[e,n]),l=(0,r.useCallback)((()=>{const e=a.map((e=>e.src));i((t=>t.filter((t=>!e.includes(t.src))))),o([])}),[a]);return r.createElement("form",{className:"pinned-settings",method:"dialog",onSubmit:s},r.createElement("h3",null,"Pinned playlists:"),r.createElement(Og,{title:"Pinned playlists",items:n,itemKey:"src",multiple:!0,renderItem:t,onDelete:l,onSelect:o}),r.createElement("p",{className:"pinned-settings-buttons"},r.createElement("button",{type:"button",disabled:0===a.length,onClick:l},"Remove")),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}var $g=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};function zg(){const e=(0,r.useId)(),t=(0,r.useRef)(null),n=(0,r.useCallback)((()=>$g(this,void 0,void 0,(function*(){xr.useMusicKitBeta=t.current.checked,(yield Mi({title:"Reload required",message:r.createElement(r.Fragment,null,r.createElement("p",null,"You need to reload for changes to take effect."),r.createElement("p",null,"Reload now?")),okLabel:"Reload",system:!0}))&&(yield si.logout(),location.reload())}))),[]);return r.createElement("form",{className:"apple-beta-settings",method:"dialog",onSubmit:n},r.createElement("fieldset",null,r.createElement("legend",null,"MusicKit*"),r.createElement("p",null,r.createElement("input",{type:"radio",name:"use-musickit",id:`${e}-musickit-stable`,defaultChecked:!xr.useMusicKitBeta}),r.createElement("label",{htmlFor:`${e}-musickit-stable`},"Stable version")),r.createElement("p",null,r.createElement("input",{type:"radio",name:"use-musickit",id:`${e}-musickit-beta`,defaultChecked:xr.useMusicKitBeta,ref:t}),r.createElement("label",{htmlFor:`${e}-musickit-beta`},"Beta version"))),r.createElement("div",{className:"note"},r.createElement("p",null,"MusicKit beta enables playback of music videos."),r.createElement("p",null,"However, this release of MusicKit is still undergoing changes and may be unstable. If you experience any problems then use the stable release."),r.createElement("p",null,"You will need to reload the page for changes to take effect. And you may have to log in again.")),r.createElement("p",null,r.createElement("small",null,"*MusicKit is a JavaScript library supplied by Apple that provides access to Apple Music services and media playback.")),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}function jg(){const e=(0,r.useMemo)((()=>[{tab:"General",panel:r.createElement(Ag,{service:si})},{tab:"Pinned",panel:r.createElement(Ng,{service:si})},{tab:"Beta",panel:r.createElement(zg,null)}]),[]);return r.createElement(Tg,{className:"media-service-settings apple-settings",items:e,label:si.name})}function Lg({service:e}){const t=(0,r.useId)(),n=(0,r.useRef)(null),i=(0,r.useRef)(null),a=(0,r.useMemo)((()=>$l().filter((e=>!e.isScrobbler))),[]),o=(0,r.useCallback)((()=>{const t=n.current.elements,r={};for(const e of t)r[e.value]=!e.checked;wf(e,r);const a=i.current.elements,o={};for(const e of a)o[e.value]=e.checked;xf(e,o)}),[e]);return r.createElement("form",{className:"scrobbling-settings",method:"dialog",onSubmit:o},r.createElement("fieldset",{ref:n},r.createElement("legend",null,"Scrobble"),r.createElement("ul",null,a.map((n=>r.createElement("li",{key:n.id},r.createElement("input",{id:`${t}-${n.id}`,type:"checkbox",value:n.id,defaultChecked:yf(e,n),disabled:"youtube"===n.id}),r.createElement("label",{htmlFor:`${t}-${n.id}`},n.name)))))),r.createElement("fieldset",{ref:i},r.createElement("legend",null,"Options"),r.createElement("ul",null,r.createElement("li",null,r.createElement("input",{id:`${t}-scrobbling-options`,type:"checkbox",value:"updateNowPlaying",defaultChecked:Ef(e)}),r.createElement("label",{htmlFor:`${t}-scrobbling-options`},'Update "Now Playing"')))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}function Rg({service:e}){const t=(0,r.useMemo)((()=>{const t=[{tab:"General",panel:r.createElement(Ag,{service:e})}];return e.createSourceFromPin&&t.push({tab:"Pinned",panel:r.createElement(Ng,{service:e})}),e.isScrobbler&&t.push({tab:"Scrobbling",panel:r.createElement(Lg,{service:e})}),t}),[e]);return r.createElement(Tg,{className:`media-service-settings ${e.id}-settings`,items:t,label:e.name})}function _g(){return r.createElement(Rg,{service:oa})}function Dg(){return r.createElement(Rg,{service:ja})}function Fg(){return r.createElement(Rg,{service:Ko})}function Vg(){return r.createElement(Rg,{service:Cs})}function Ug(){return r.createElement(Rg,{service:ml})}function Bg(){return r.createElement(Rg,{service:Ao})}function Hg(){return Lv((0,r.useMemo)((()=>()=>bn(xt.observe(),wt.observeUserThemes()).pipe(Xt((()=>Object.assign({},xt.current))))),[]),xt.current)}function Yg(){return Lv((0,r.useMemo)((()=>()=>wt.observeUserThemes()),[]),[])}var Kg=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Wg(e){var{colorName:t,onChange:n}=e,i=Kg(e,["colorName","onChange"]);const a=(0,r.useCallback)((e=>{const r=e.target.value;xt[t]=r,null==n||n(r)}),[t,n]);return r.createElement("input",Object.assign({},i,{type:"color",onChange:a}))}function qg({label:e,backgroundColorName:t,textColorName:n,defaultBackgroundColor:i,defaultTextColor:a,suggestedColors:o,nextSuggestion:s,trackingColor:l="frame"}){const c=Hg(),u=i&&a,d=c[t],m=c[n],[h,f]=(0,r.useState)((()=>d||i||"")),[p,v]=(0,r.useState)((()=>m||a||"")),b=!d&&!m,g=(0,r.useCallback)((()=>{if(o&&s){const[e,r]=o;xt[t]=e,xt[n]=r,s()}}),[t,n,o,s]),y=(0,r.useCallback)((()=>{b?(xt[t]=h,xt[n]=p):(xt[t]="",xt[n]="")}),[b,t,n,h,p]),w=(0,r.useCallback)((()=>{const e=xt[t],r=xt[n];xt[t]=r,xt[n]=e}),[t,n]);return r.createElement("p",{className:"color-pair "+(b?"locked":"")},r.createElement("label",null,e,":"),r.createElement(Wg,{colorName:t,value:d||i,title:`${e} background color`,disabled:b,onChange:f}),r.createElement(dp,{icon:"swap",title:"Swap",onClick:w,disabled:b}),r.createElement(Wg,{colorName:n,value:m||a,title:`${e} text color`,disabled:b,onChange:v}),u?r.createElement(dp,{icon:b?"locked":"unlocked",title:b?"Allow editing":`Lock to ${l} color`,onClick:y}):null,o&&s?r.createElement("button",{className:"small",type:"button",onClick:g},"Suggest"):null)}function Jg(e,t){var n=new Ge(e),r=new Ge(t);return(Math.max(n.getLuminance(),r.getLuminance())+.05)/(Math.min(n.getLuminance(),r.getLuminance())+.05)}function Qg(e,t,n){void 0===n&&(n={includeFallbackColors:!1,level:"AA",size:"small"});for(var r=null,i=0,a=n.includeFallbackColors,o=n.level,s=n.size,l=0,c=t;l<c.length;l++){var u=c[l],d=Jg(e,u);d>i&&(i=d,r=new Ge(u))}return function(e,t,n){var r,i;void 0===n&&(n={level:"AA",size:"small"});var a=Jg(e,t);switch((null!==(r=n.level)&&void 0!==r?r:"AA")+(null!==(i=n.size)&&void 0!==i?i:"small")){case"AAsmall":case"AAAlarge":return a>=4.5;case"AAlarge":return a>=3;case"AAAsmall":return a>=7;default:return!1}}(e,r,{level:o,size:s})||!a?r:(n.includeFallbackColors=!1,Qg(e,["#fff","#000"],n))}var Xg=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};function Gg(e){return Xg(this,void 0,void 0,(function*(){return!wt.getUserTheme(e)||Mi({title:"My themes",message:`Overwrite existing theme '${e}'?`,okLabel:"Save",storageId:"overwrite-user-theme",system:!0})}))}var Zg=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};function ey(e){var{suggestedName:t}=e,n=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["suggestedName"]);const i=(0,r.useId)(),a=(0,r.useMemo)((()=>e=>e.name),[]),[o,s]=(0,r.useState)(t),l=(0,r.useRef)(null),c=(0,r.useRef)(null),u=Yg(),d=(0,r.useCallback)((e=>{s(e.target.value)}),[]),m=(0,r.useCallback)((([e])=>{e&&(c.current.value=e.name,s(e.name))}),[]),h=(0,r.useCallback)((()=>Zg(this,void 0,void 0,(function*(){o&&(yield Gg(o))&&l.current.close(o)}))),[o]),f=(0,r.useCallback)((e=>Zg(this,void 0,void 0,(function*(){e.preventDefault(),h()}))),[h]);return r.createElement(xi,Object.assign({},n,{className:"save-theme-dialog",title:"Save Theme",onSubmit:f,ref:l}),r.createElement("form",{method:"dialog"},r.createElement("p",{className:"prompt-message"},r.createElement("label",{htmlFor:i},"Name: "),r.createElement("input",{type:"text",id:i,defaultValue:t,spellCheck:!1,autoComplete:"off",autoCapitalize:"off",onChange:d,ref:c})),r.createElement(Og,{title:"My themes",items:u,itemKey:"name",renderItem:a,onDoubleClick:h,onSelect:m}),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",{value:o},"Save"))))}var ty=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};const ny=[{tab:"General",panel:r.createElement((function(){const e=(0,r.useId)(),t=Hg(),n=(0,r.useRef)(null),i=(0,r.useRef)(null),a=(0,r.useRef)(null),o=(0,r.useMemo)((()=>xt.fontSize),[]),s=(0,r.useMemo)((()=>wt.getDefaultThemes()),[]),l=Yg(),c=!!t.userTheme;(0,r.useLayoutEffect)((()=>{const e=document.getElementById("system").style;return e.setProperty("--font-size",String(xt.fontSize)),()=>{xt.restore(),e.removeProperty("--font-size")}}),[]);const u=(0,r.useCallback)((()=>xt.save()),[]),d=(0,r.useCallback)((()=>{const e=a.current.checked?wt.getUserTheme(i.current.value):wt.getDefaultTheme(n.current.value);e&&xt.apply(e)}),[]),m=(0,r.useCallback)((e=>{xt.fontSize=e.target.valueAsNumber}),[]);return r.createElement("form",{className:"appearance-settings-general",method:"dialog",onSubmit:u},r.createElement("fieldset",null,r.createElement("legend",null,"Theme"),r.createElement("div",{className:"table-layout"},r.createElement("p",null,r.createElement("input",{type:"radio",name:"theme-source",id:`${e}-default-themes`,value:"",checked:!c,onChange:d}),r.createElement("label",{htmlFor:`${e}-default-themes`},"Default themes:"),r.createElement("select",{value:c?void 0:t.name,disabled:c,onChange:d,ref:n},s.map((({name:e})=>r.createElement("option",{value:e,key:e},e))))),r.createElement("p",null,r.createElement("input",{type:"radio",name:"theme-source",id:`${e}-user-themes`,value:"user",checked:c,disabled:0===l.length,onChange:d,ref:a}),r.createElement("label",{htmlFor:`${e}-user-themes`},"My themes:"),r.createElement("select",{value:c?t.name:void 0,onChange:d,disabled:!c,ref:i},l.map((({name:e})=>r.createElement("option",{value:e,key:e},e))))))),r.createElement("fieldset",null,r.createElement("legend",null,"Preferences"),r.createElement("div",{className:"table-layout"},r.createElement("p",{className:"font-size"},r.createElement("label",{htmlFor:"theme-fontSize"},"Font Size:"),r.createElement("input",{type:"range",id:"theme-fontSize",min:12,max:28,step:.4,defaultValue:o,onChange:m})))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}),null)},{tab:"Theme Editor",panel:r.createElement((function(){const e=(0,r.useId)(),t=Hg(),n=`${t.name}${xt.edited?" (edited)":""}`,i=`${!!t.userTheme}/${t.name}`,[a,o]=function(e){const[t,n]=(0,r.useState)([]),[i,a]=(0,r.useState)(-1);(0,r.useEffect)((()=>{const t=new Ge(e),r=m([...t.triad(),...t.tetrad(),...t.splitcomplement(),...t.analogous(),...t.monochromatic(),t.lighten(),t.darken(),t.saturate(),t.desaturate(),t.greyscale(),t.brighten()].map((e=>e.toHexString()))).map((e=>new Ge(e))),i=r.reverse().map((e=>[e.toHexString(),Qg(e,["black","white"],{includeFallbackColors:!0,level:"AA",size:"large"}).toHexString()]));n(f(i)),a(-1===i.length?-1:0)}),[e]);const o=(0,r.useCallback)((()=>{a((e=>e===t.length-1?-1===t.length?-1:0:e+1))}),[t]);return[t[i],o]}(t.frameColor);(0,r.useLayoutEffect)((()=>{const e=document.getElementById("system").style;return e.setProperty("--font-size",String(xt.fontSize)),()=>{xt.restore(),e.removeProperty("--font-size")}}),[]);const s=(0,r.useCallback)((()=>{xt.save()}),[]),l=(0,r.useCallback)((()=>{!function(e){var t,n,i,a;t=this,n=void 0,a=function*(){const t=yield Si((t=>r.createElement(ey,Object.assign({},t,{suggestedName:e}))),!0);t&&(xt.name=t,xt.userTheme=!0,yield wt.save(xt.current))},new((i=void 0)||(i=Promise))((function(e,r){function o(e){try{l(a.next(e))}catch(e){r(e)}}function s(e){try{l(a.throw(e))}catch(e){r(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof i?e:new i((function(t){t(e)}))}(t.value).then(o,s)}l((a=a.apply(t,n||[])).next())}))}(t.name)}),[t]),c=(0,r.useCallback)((e=>{xt.spacing=e.target.valueAsNumber}),[]),u=(0,r.useCallback)((e=>{xt.roundness=e.target.valueAsNumber}),[]),d=(0,r.useCallback)((e=>{xt.flat=e.target.checked}),[]);return r.createElement("form",{className:"theme-editor",method:"dialog",onSubmit:s},r.createElement("div",{className:"table-layout"},r.createElement("p",{className:"theme-name"},r.createElement("label",{htmlFor:`${e}-theme-name`},"Name:"),r.createElement("input",{type:"text",id:`${e}-theme-name`,value:n,spellCheck:!1,readOnly:!0,tabIndex:-1}),r.createElement("button",{className:"small",type:"button",onClick:l},"Save asâ€¦")),r.createElement(qg,{label:"Frame",backgroundColorName:"frameColor",textColorName:"frameTextColor",key:`${i}/frame`}),r.createElement(qg,{label:"Content",backgroundColorName:"backgroundColor",textColorName:"textColor",key:`${i}/content`}),r.createElement(qg,{label:"Selection",backgroundColorName:"selectedBackgroundColor",textColorName:"selectedTextColor",suggestedColors:a,nextSuggestion:o,key:`${i}/selection`}),r.createElement(qg,{label:"Media button",backgroundColorName:"mediaButtonColor",textColorName:"mediaButtonTextColor",defaultBackgroundColor:xt.defaultMediaButtonColor,defaultTextColor:xt.defaultMediaButtonTextColor,key:`${i}/media-button`}),r.createElement(qg,{label:"Button",backgroundColorName:"buttonColor",textColorName:"buttonTextColor",defaultBackgroundColor:xt.defaultButtonColor,defaultTextColor:xt.defaultButtonTextColor,key:`${i}/button`}),r.createElement(qg,{label:"Scrollbar",backgroundColorName:"scrollbarColor",textColorName:"scrollbarTextColor",defaultBackgroundColor:xt.defaultScrollbarColor,defaultTextColor:xt.defaultScrollbarTextColor,trackingColor:"button",key:`${i}/scrollbar`}),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-theme-spacing`},"Spacing:"),r.createElement("input",{type:"range",id:`${e}-theme-spacing`,min:0,max:1,step:.01,value:t.spacing,onChange:c})),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-theme-roundness`},"Roundness:"),r.createElement("input",{type:"range",id:`${e}-theme-roundness`,min:0,max:1,step:.01,value:t.roundness,onChange:u})),r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-theme-flat`},"Flat:"),r.createElement("input",{type:"checkbox",id:`${e}-theme-flat`,checked:t.flat,onChange:d}))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}),null)},{tab:"My Themes",panel:r.createElement((function(){const e=(0,r.useRef)(null),t=(0,r.useMemo)((()=>e=>e.name),[]),n=(0,r.useRef)(null),i=Yg(),[a,o]=(0,r.useState)(""),[s,l]=(0,r.useState)([]),[c]=s;(0,r.useEffect)((()=>{if(a){const t=i.findIndex((e=>e.name===a));-1!==t&&(e.current.selectAt(t),o(""))}}),[i,a]);const u=(0,r.useCallback)((()=>ty(this,void 0,void 0,(function*(){if(c){const e=c.name,t=yield zi({title:"My themes",suggestedValue:e,okLabel:"Rename",system:!0});t&&(yield Gg(t))&&(yield wt.rename(e,t),o(t))}}))),[c]),d=(0,r.useCallback)((()=>ty(this,void 0,void 0,(function*(){if(c){const e=c.name,t=wt.getUserTheme(e);if(t){const{userTheme:n}=t,r=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(t,["userTheme"]);!function(e,t,n="text/json"){const r=document.createElement("a");r.href=window.URL.createObjectURL(new Blob([t],{type:n})),r.download=e,r.type=n,r.click()}(`${e}.json`,JSON.stringify(r,void 0,4))}}}))),[c]),m=(0,r.useCallback)((()=>ty(this,void 0,void 0,(function*(){if(c){const e=c.name,t=yield function(e){return t=this,n=void 0,i=function*(){return Mi({title:"My themes",message:`Delete theme '${e}'?`,okLabel:"Delete",storageId:"delete-user-theme",system:!0})},new((r=void 0)||(r=Promise))((function(e,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(o,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(e);t&&(yield wt.remove(e),l([]))}}))),[c]),h=(0,r.useCallback)((()=>{n.current.click()}),[]),f=(0,r.useCallback)((e=>ty(this,void 0,void 0,(function*(){var t;const n=null===(t=e.target.files)||void 0===t?void 0:t[0];n&&(yield function(e){return t=this,n=void 0,i=function*(){const t="Import theme",n=!0;try{const r=yield e.text(),i=JSON.parse(r);if(!xt.validate(i))return void(yield Pi({title:t,message:"Not a valid theme.",system:n}));let a=i.name,o=!1;for(;a&&!o;)a=yield zi({title:t,suggestedValue:a,okLabel:"Import",system:n}),a&&(o=yield Gg(a),o&&(yield wt.save(Object.assign(Object.assign({},i),{name:a}))))}catch(e){console.error(e),yield Pi({title:t,message:"Could not load theme.",system:n})}},new((r=void 0)||(r=Promise))((function(e,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof r?e:new r((function(t){t(e)}))}(t.value).then(o,s)}l((i=i.apply(t,n||[])).next())}));var t,n,r,i}(n),e.target.value="")}))),[]);return r.createElement("form",{className:"user-themes",method:"dialog"},r.createElement("h3",null,"My themes:"),r.createElement(Og,{title:"My themes",items:i,itemKey:"name",renderItem:t,onDelete:m,onSelect:l,listViewRef:e}),r.createElement("p",{className:"user-themes-buttons"},r.createElement("button",{type:"button",onClick:u,disabled:!c},"Renameâ€¦"),r.createElement("button",{type:"button",onClick:d,disabled:!c},"Exportâ€¦"),r.createElement("button",{className:"user-themes-delete",type:"button",onClick:m,disabled:!c},"Delete")),r.createElement("fieldset",{className:"user-themes-import"},r.createElement("legend",null,"Import themes"),r.createElement("p",null,r.createElement("input",{type:"file",accept:"text/json,.json",onChange:f,ref:n}),r.createElement("button",{type:"button",onClick:h},"Importâ€¦"))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}),null)}],ry=[{tab:"General",panel:r.createElement((function(){const e=(0,r.useId)(),t=(0,r.useMemo)((()=>Qc.get()),[]),n=Lv(Qc.observe,t),i=(0,r.useRef)(null),a=(0,r.useRef)(null),o=(0,r.useRef)(null),s=(0,r.useRef)(null),l=(0,r.useCallback)((()=>{Qc.set(t)}),[t]),c=(0,r.useCallback)((()=>{Qc.set({allowDuplicates:i.current.checked,showLineNumbers:a.current.checked,zeroPadLineNumbers:o.current.checked,showSourceIcons:s.current.checked})}),[]);return r.createElement("form",{className:"playlist-settings-general",method:"dialog"},r.createElement("fieldset",null,r.createElement("legend",null,"Content"),r.createElement("p",null,r.createElement("input",{id:`${e}-allow-duplicates`,type:"checkbox",checked:n.allowDuplicates,onChange:c,ref:i}),r.createElement("label",{htmlFor:`${e}-allow-duplicates`},"Allow duplicates"))),r.createElement("fieldset",null,r.createElement("legend",null,"Display"),r.createElement("p",null,r.createElement("input",{id:`${e}-item-numbers`,type:"checkbox",checked:n.showLineNumbers,onChange:c,ref:a}),r.createElement("label",{htmlFor:`${e}-item-numbers`},"Show line numbers")),r.createElement("p",null,r.createElement("input",{id:`${e}-zero-pad`,type:"checkbox",checked:n.zeroPadLineNumbers,disabled:!n.showLineNumbers,onChange:c,ref:o}),r.createElement("label",{htmlFor:`${e}-zero-pad`},"Zero pad line numbers")),r.createElement("p",null,r.createElement("input",{id:`${e}-source-icons`,type:"checkbox",checked:n.showSourceIcons,onChange:c,ref:s}),r.createElement("label",{htmlFor:`${e}-source-icons`},"Show media source icons"))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{value:"#cancel",onClick:l},"Cancel"),r.createElement("button",null,"Confirm")))}),null)}],iy=[{tab:"General",panel:r.createElement((function(){const e=(0,r.useId)(),t=(0,r.useRef)(null),n=Qu.provider,i=(0,r.useCallback)((()=>{Qu.provider=t.current.value}),[]);return r.createElement("form",{className:"visualizer-settings-general",method:"dialog",onSubmit:i},r.createElement("p",null,r.createElement("label",{htmlFor:`${e}-visualizer-provider`},"Provider:"),r.createElement("select",{id:`${e}-visualizer-provider`,defaultValue:n,ref:t},r.createElement("option",{value:"none"},"(none)"),r.createElement("option",{value:""},"(random)"),Kh().filter((e=>"ambientvideo"!==e.id||Qu.ambientVideoEnabled)).map((e=>r.createElement("option",{value:e.id,key:e.id},e.name))))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}),null)},{tab:"Ambient Video",panel:r.createElement((function(){const e=(0,r.useId)(),t=(0,r.useRef)(null),n=(0,r.useRef)(null),i=(0,r.useRef)(null),a=(0,r.useRef)(null),[o,s]=(0,r.useState)((()=>!!Qu.useAmbientVideoSource)),l=(0,r.useCallback)((()=>{Qu.ambientVideoEnabled=t.current.checked,Qu.useAmbientVideoSource=i.current.checked,Qu.ambientVideoSource=n.current.value,Qu.beatsOverlay=a.current.checked}),[]),c=(0,r.useCallback)((()=>{n.current.validity.valid||i.current.checked||(n.current.value=""),s(i.current.checked)}),[]),u=(0,r.useCallback)((()=>{const e=n.current.value;let t="Not a valid YouTube url.";/^https?/.test(e)&&/youtu\.?be/.test(e)&&(t="Not a YouTube video or playlist.",So(e)&&(t="")),n.current.setCustomValidity(t)}),[]);return r.createElement("form",{className:"ambient-video-settings",method:"dialog",onSubmit:l},r.createElement("p",null,r.createElement("input",{id:`${e}-ambient-video-enabled`,type:"checkbox",defaultChecked:Qu.ambientVideoEnabled,ref:t}),r.createElement("label",{htmlFor:`${e}-ambient-video-enabled`},"Enable ambient video")),r.createElement("fieldset",null,r.createElement("legend",null,"Source"),r.createElement("p",null,r.createElement("input",{type:"radio",name:"video-source",id:`${e}-source-default`,defaultChecked:!Qu.useAmbientVideoSource,onChange:c}),r.createElement("label",{htmlFor:`${e}-source-default`},"Default videos")),r.createElement("p",null,r.createElement("input",{type:"radio",name:"video-source",id:`${e}-source-youtube`,defaultChecked:Qu.useAmbientVideoSource,onChange:c,ref:i}),r.createElement("label",{id:`${e}-source-youtube-label`,htmlFor:`${e}-source-youtube`},"YouTube video or playlist:")),r.createElement("p",null,r.createElement("input",{type:"url",defaultValue:Qu.ambientVideoSource,disabled:!o,required:o,onInput:u,"aria-labelledby":`${e}-source-youtube-label`,ref:n}))),r.createElement("p",null,r.createElement("input",{id:`${e}-beats-overlay`,type:"checkbox",defaultChecked:Qu.beatsOverlay,ref:a}),r.createElement("label",{htmlFor:`${e}-beats-overlay`},'Show "beats" overlay')),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}),null)}];function ay(){return r.createElement(Tg,{className:"visualizer-settings",items:iy,label:"Visualizers"})}function oy(e){return r.createElement(xi,Object.assign({},e,{className:"settings-dialog visualizer-settings-dialog",title:"Visualizer Settings"}),r.createElement(ay,null))}function sy(){const e=(0,r.useId)(),t=(0,r.useRef)(null),n=(0,r.useCallback)((()=>{const e=t.current.elements,n={};for(const t of e)n[t.value]=!t.checked;Ul(n)}),[]);return r.createElement("form",{className:"media-library-settings-general",method:"dialog",onSubmit:n},r.createElement("fieldset",{ref:t},r.createElement("legend",null,"Display"),r.createElement("ul",null,$l().map((t=>r.createElement("li",{key:t.id},r.createElement("input",{id:`${e}-${t.id}`,type:"checkbox",value:t.id,defaultChecked:Vl(t)}),r.createElement("label",{htmlFor:`${e}-${t.id}`},t.name)))))),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}function ly(){const e=(0,r.useId)(),t=(0,r.useRef)(null),n=Pc.preferredService,i=(0,r.useCallback)((()=>{Pc.preferredService=t.current.value}),[]);return r.createElement("form",{className:"lookup-settings",method:"dialog",onSubmit:i},r.createElement("label",{htmlFor:`${e}-lookup-services`},"Preferred Service:"),r.createElement("select",{id:`${e}-lookup-services`,defaultValue:n,ref:t},r.createElement("option",{value:""},"(none)"),zl().map((e=>r.createElement("option",{value:e.id,key:e.id},e.name)))),r.createElement("div",{className:"note"},r.createElement("p",null,"To enable playback from last.fm and ListenBrainz, Ampcast will search your logged in services to find a match."),r.createElement("p",null,"Exact matches are preferred. If you have several exact matches then the match from the preferred lookup service is used.")),r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",{type:"button",value:"#cancel"},"Cancel"),r.createElement("button",null,"Confirm")))}const cy=[{id:"services",label:r.createElement(Uv,{text:"Media Services",icon:"globe"}),value:r.createElement((function(){const e=(0,r.useMemo)((()=>[{tab:"General",panel:r.createElement(sy,null)},{tab:"Lookup",panel:r.createElement(ly,null)}]),[]);return r.createElement(Tg,{className:"media-library-settings",items:e,label:"Media Services"})}),null),startExpanded:!0,children:$l().map((e=>({id:e.id,label:r.createElement(Uv,{icon:e.icon,text:e.name}),value:r.createElement(dy,{service:e})})))},{id:"visualizer",label:r.createElement(Uv,{text:"Visualizer",icon:"visualizer"}),value:r.createElement(ay,null)},{id:"playlist",label:r.createElement(Uv,{text:"Playlist",icon:"playlist"}),value:r.createElement((function(){return r.createElement(Tg,{className:"playlist-settings",items:ry,label:"Playlist Settings"})}),null)},{id:"appearance",label:r.createElement(Uv,{text:"Appearance",icon:"palette"}),value:r.createElement((function(){return r.createElement(Tg,{className:"appearance-settings",items:ny,label:"Appearance"})}),null)}],uy=()=>cy;function dy({service:e}){switch(e.id){case"apple":return r.createElement(jg,null);case"spotify":return r.createElement(Ug,null);case"youtube":return r.createElement(Bg,null);case"plex":return r.createElement(Vg,null);case"jellyfin":return r.createElement(_g,null);case"lastfm":return r.createElement(Dg,null);case"listenbrainz":return r.createElement(Fg,null)}}const my=new z("settings-sources");function hy(e){const t=uy(),[n,i]=(0,r.useState)(null);return r.createElement(xi,Object.assign({},e,{className:"settings-dialog",title:"Settings"}),r.createElement(Dn,{className:"settings-dialog-sources",roots:t,storageId:my.id,onSelect:i}),r.createElement("div",{className:"settings-dialog-source"},n))}console.log("component::MediaLibrary");const fy=(0,r.memo)((function(){const[e,t]=(0,r.useState)(null),n=(0,r.useCallback)((()=>{Si(hy,!0)}),[]);return r.createElement("div",{className:"media-library"},r.createElement("header",{className:"media-library-head"},r.createElement("h1",{className:"media-library-title"},r.createElement("span",{className:"app-name"},r.createElement(yi,{className:"app-icon",name:"ampcast"}),r.createElement("span",{className:"app-text"},"ampcast")),r.createElement("span",{className:"app-version"},"0.8.12")),r.createElement(dp,{icon:"settings",className:"in-frame",title:"Settings",onClick:n})),r.createElement("div",{className:"media-library-body"},r.createElement(At,{id:"media-library-layout",arrange:"columns",primaryIndex:1},r.createElement(kg,{onSelect:t}),e||r.createElement(_u,null))))}));console.log("module::visualizer");const py=new A("visualizer"),vy={providerId:"none",name:""},by=new Ie(vy),gy=new Te,yy=[...Array(79).fill("butterchurn"),...Array(6).fill("audiomotion"),...Array(4).fill("ampshader"),...Array(1).fill("waveform")],wy=[...Array(69).fill("ampshader"),...Array(10).fill("spotifyviz"),...Array(1).fill("waveform")],Ey=Array(10).fill("ambientvideo"),xy=Array(20).fill("ambientvideo");function ky(){return by}function Sy(){return Py().pipe(Xt((e=>Wh(e))),yn((e=>e?e.observeVisualizers():Pn([]))))}function Cy(){return Xu().pipe(Xt((e=>!!e.lockedVisualizer)),er())}function Py(){return Xu().pipe(Xt((e=>e.provider||"")),er())}function Ty(e){gy.next(e)}function Ay(){Qu.lockedVisualizer=by.getValue()}function Iy(){Qu.lockedVisualizer=null}function Oy(e,t=1){var n;null===(n=Wh(e))||void 0===n||n.observeVisualizers().pipe(Is((e=>0===e.length)),yl(ky()),$e((([t,n])=>{console.log(`${e} visualizers:`,t.length),n===vy&&Ty("sync")})),mr(t)).subscribe(py)}function My(){return Lv(ky,null)}function Ny(e){const[t,n]=(0,r.useState)(null);return(0,r.useEffect)((()=>{null==t&&null!=e&&n(e)}),[t,e]),t}function $y({visualizer:e}){return r.createElement("article",{className:"visualizer-info"},r.createElement(zy,{visualizer:e}),r.createElement(jy,{visualizer:e}))}function zy({visualizer:e}){return r.createElement("h3",null,"Visualizer: ",function(e){if(e){const t=Wh(e.providerId);if(t)return t.name}return"none"}(e))}function jy({visualizer:e}){var t;const n="ambientvideo"===(null==e?void 0:e.providerId)&&e.src.startsWith("youtube:"),i=e?e.externalUrl||(null===(t=Wh(e.providerId))||void 0===t?void 0:t.externalUrl):void 0;return n?r.createElement(Ly,{visualizer:e}):(null==e?void 0:e.name)?r.createElement(r.Fragment,null,r.createElement("h4",null,"Name: ",e.name),i?r.createElement("p",{className:"external-view"},r.createElement("span",null,"Url:")," ",r.createElement(Ya,{href:i})):null):null}function Ly({visualizer:e}){const t=function(e){const[t,,n]=e.split(":"),[i,a]=(0,r.useState)(null);return(0,r.useEffect)((()=>{if(a(null),n&&"youtube"===t){const e=vn(Po(n)).subscribe(a);return()=>e.unsubscribe()}}),[t,n]),i}(e.src);return t?r.createElement("div",{className:"youtube-video-info"},r.createElement("h4",null,"Title: ",t.title),r.createElement(nv,{owner:t.owner,src:t.src}),r.createElement("p",{className:"external-view"},"View on YouTube: ",r.createElement(yi,{name:"youtube"})," ",r.createElement(Ya,{href:t.externalUrl}))):null}function Ry(e){const t=(0,r.useRef)(null),{debug:n}=dv(t),i=Rv(),a=My(),o=Ny(i),s=Ny(a);return r.createElement(xi,Object.assign({},e,{className:"currently-playing-dialog media-info-dialog",title:"Media Info",ref:t}),r.createElement("form",{method:"dialog"},o?r.createElement(Wp,{item:o,debug:n}):r.createElement("p",null,"The playlist is empty."),o&&o.mediaType!==Nr.Video?r.createElement($y,{visualizer:s}):null,r.createElement("footer",{className:"dialog-buttons"},r.createElement("button",null,"Close"))))}function _y(){const e=(0,r.useRef)(null),t=(0,r.useRef)(null);return(0,r.useLayoutEffect)((()=>{let e;const n=()=>{const r=t.current,i=r.getContext("2d"),a=i.createImageData(r.width,r.height),o=new Uint32Array(a.data.buffer);for(let e=0;e<o.length;e++)o[e]=(255*Math.random()|0)<<24;i.putImageData(a,0,0),e=requestAnimationFrame((()=>n()))};return e=requestAnimationFrame((()=>n())),()=>cancelAnimationFrame(e)}),[]),kt(e,(()=>{const n=t.current,r=e.current.getBoundingClientRect();n.width=r.width,n.height=r.height})),r.createElement("div",{className:"static",ref:e},r.createElement("canvas",{ref:t}))}cu().pipe(Ql(200)).subscribe((()=>Ty("item"))),Xh.observeError().subscribe((()=>Ty("error"))),Sy().subscribe((()=>Ty("provider"))),gy.pipe(yl(cu(),Xu()),Xt((([e,t,n])=>function(e,t,n){if(!e||e.mediaType===Nr.Video||e.duration<30)return vy;const r=e.src.startsWith("spotify:"),i=t.lockedVisualizer;let a=(null==i?void 0:i.providerId)||t.provider;switch(a){case"spotifyviz":if(!r)return vy;break;case"audiomotion":case"butterchurn":if(r)return vy;break;case"none":return vy}if(i)return function(e,t){return qh(e).find((e=>e.name===t))}(i.providerId,i.name)||vy;const o=by.getValue();if(a=t.provider,!a){let e=r?wy:yy;t.ambientVideoEnabled&&(e=e.concat(r?xy:Ey)),a=E(e),"click"===n&&a===o.providerId&&1===qh(a).length&&(a=E(e,a))}return E(qh(a),o)||vy}(t,n,e))),er()).subscribe(by),ky().pipe($e((e=>Xh.load(e)))).subscribe(py),Oy("ampshader"),Oy("butterchurn",2);const Dy=(0,r.memo)((function(){const e=Lv(Sy,[]),t=Lv(Cy,!1),n=Lv(Py,void 0),i="none"!==n,a=!t&&(!n||e.length>1),o=function(){const e=Rv(),t=My(),[n,i]=(0,r.useState)("");return(0,r.useEffect)((()=>{(null==e?void 0:e.src.startsWith("youtube:"))?i("youtube"):(null==e?void 0:e.src.startsWith("apple:"))&&(null==e?void 0:e.mediaType)===Nr.Video?i("apple"):"ambientvideo"===(null==t?void 0:t.providerId)&&(null==t?void 0:t.src.startsWith("youtube:"))?i("youtube"):i("")}),[e,t]),n}(),[s,l]=(0,r.useState)(0),c=(0,r.useCallback)((()=>{Si(Ry)}),[]),u=(0,r.useCallback)((()=>{Si(oy,!0)}),[]),d=(0,r.useCallback)((()=>{0===s&&Ty("click"),l(s+1)}),[s]);return(0,r.useEffect)((()=>{if(s){const e=Rt(500).subscribe((()=>l(0)));return()=>e.unsubscribe()}}),[s]),r.createElement("div",{className:"visualizer-controls"},i&&s?r.createElement(_y,null):null,r.createElement(hp,{className:"visualizer-controls-settings"},r.createElement(dp,{className:"with-overlay",icon:"info",title:"Info",tabIndex:-1,onClick:c}),r.createElement(dp,{className:"with-overlay",icon:"settings",title:"Settings",tabIndex:-1,onClick:u})),i?r.createElement(hp,{className:"visualizer-controls-selector"},r.createElement(dp,{className:"with-overlay",icon:t?"locked":"unlocked",title:t?"Unlock":"Lock the current visualizer",tabIndex:-1,onClick:t?Iy:Ay}),a?r.createElement(dp,{className:"with-overlay",icon:"right",title:"Next visualizer",tabIndex:-1,onClick:d}):null):null,o?r.createElement(yi,{className:"source-icon",name:o}):null)}));function Fy(){return Lv(Kf,!0)}const Vy=(0,r.memo)((function(){const e=Rv(),t=Fy(),n=function(){const[e,t]=(0,r.useState)("searching"),n=Rv(),i=null==n?void 0:n.id;return(0,r.useEffect)((()=>t("searching")),[i]),(0,r.useEffect)((()=>{switch(null==n?void 0:n.lookupStatus){case ic.Looking:t("searching");break;case ic.NotFound:t("loaded");break;default:if(n){if(Rl(n)){t("loading");const e=Jf().pipe(mr(1)).subscribe((()=>t("loaded")));return()=>e.unsubscribe()}t("searching")}else t("loaded")}}),[n]),e}(),[i,a]=(0,r.useState)(!1),[o,s]=(0,r.useState)(!1),l=null==e?void 0:e.id;return(0,r.useEffect)((()=>{s(!0);const e=setTimeout((()=>s(!1)),5e3);return()=>clearTimeout(e)}),[l]),(0,r.useEffect)((()=>{if(a(!1),"loaded"===n){const e=setTimeout((()=>a(!0)),4500);return()=>clearTimeout(e)}}),[n]),r.createElement("div",{className:`interstitial ${n} ${i?"ready":""} ${o?"is-recent":""}`},r.createElement("div",{className:"currently-playing"},e?r.createElement(r.Fragment,null,r.createElement("h2",null,e.title),e.artists?r.createElement(r.Fragment,null,r.createElement("span",{className:"by"},"by"),r.createElement("h3",null,e.artists.join(", "))):null):r.createElement("p",null,"The playlist is empty.")),r.createElement("p",{className:"interstitial-state"},t?"":`${"loaded"===n?"playing":n}...`))}));n(6234),console.log("component::Media");const Uy=(0,r.memo)((function(){const e=(0,r.useRef)(null),[t,n]=(0,r.useState)(!1),i=Rv(),a=(null==i?void 0:i.mediaType)===Nr.Video,o=function(e,t=200){const[n,i]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{if(e){const n=on(e,"mousemove").pipe($e((()=>i(!0))),Ql(t),$e((()=>i(!1)))).subscribe();return()=>n.unsubscribe()}i(!1)}),[e,t]),n}(e.current,4e3),s=My(),l=!s||"none"===s.providerId;(0,r.useLayoutEffect)((()=>{cp.appendTo(e.current)}),[]),(0,r.useEffect)((()=>{const t=on(document,"fullscreenchange").pipe(Xt((()=>document.fullscreenElement===e.current))).subscribe(n);return()=>t.unsubscribe()}),[]),kt(e,(()=>{const t=e.current;cp.resize(t.clientWidth,t.clientHeight)}));const c=(0,r.useCallback)((()=>{t?document.exitFullscreen():e.current.requestFullscreen()}),[t]);return r.createElement("div",{className:`panel media ${a?"is-playing-video":""} ${l?"no-visualizer":""}  ${o?"":"idle"}`,onDoubleClick:c,ref:e},r.createElement("div",{id:"playback"}),r.createElement(Vy,null),r.createElement(Dy,null))}));var By=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Hy(e){var{icon:t,className:n=""}=e,i=By(e,["icon","className"]);const a=(0,r.useRef)(null),o=(0,r.useCallback)((e=>{e.stopPropagation(),e.preventDefault(),a.current.classList.toggle("active",!0)}),[]);return r.createElement("button",Object.assign({},i,{className:`media-button media-button-${t} ${n}`,type:"button",onMouseDown:o,ref:a}),r.createElement(yi,{name:t}))}const Yy=(0,r.memo)((function(){const[e,t]=(0,r.useState)((()=>cp.muted)),[n,i]=(0,r.useState)((()=>cp.volume)),a=n<=.33?"low":n<=.67?"medium":"high";(0,r.useEffect)((()=>{cp.muted=e}),[e]),(0,r.useEffect)((()=>{cp.volume=n}),[n]);const o=(0,r.useCallback)((e=>{const n=e.target.valueAsNumber;i(n),t(0===n)}),[]),s=(0,r.useCallback)((()=>{i((t=>e?t||.1:t)),t(!e)}),[e]);return r.createElement("div",{className:`volume-control volume-${a}`},r.createElement(dp,{icon:e?"muted":"volume",className:"in-frame","aria-label":e?"Unmute":"Mute",title:e?"unmute":"mute",onClick:s}),r.createElement("input",{type:"range","aria-label":"Volume",min:0,max:1,step:.01,value:e?0:n,onChange:o}))}));function Ky(e){const t=Lv(uu,du()),n=Fy();return r.createElement(fp,Object.assign({},e),r.createElement(gp,{label:"Stop after current",value:"stop-after-current",checked:cp.stopAfterCurrent,disabled:n,key:"stop-after-current"}),r.createElement(vp,{label:"Jump to current",value:"jump-to-current",disabled:-1===t,key:"jump-to-current"}),r.createElement(yp,null),r.createElement(vp,{label:"Shuffle",value:"shuffle",key:"shuffle"}),r.createElement(yp,null),r.createElement(vp,{label:"Clear",value:"clear",key:"clear"}))}var Wy=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};function qy({listViewRef:e}){const t=Lv(uu,-1),n=Lv(Bf,0),i=Lv(Hf,0),a=Fy(),o=(0,r.useCallback)((e=>{Zf(e.target.valueAsNumber)}),[]),s=(0,r.useCallback)((n=>Wy(this,void 0,void 0,(function*(){const i=e.current,o=n.target.getBoundingClientRect();switch(yield function(e,t){return n=this,i=void 0,o=function*(){return Ep((e=>r.createElement(Ky,Object.assign({},e))),e,t)},new((a=void 0)||(a=Promise))((function(e,t){function r(e){try{l(o.next(e))}catch(e){t(e)}}function s(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){t.done?e(t.value):function(e){return e instanceof a?e:new a((function(t){t(e)}))}(t.value).then(r,s)}l((o=o.apply(n,i||[])).next())}));var n,i,a,o}(o.right,o.bottom+4)){case"jump-to-current":i.scrollIntoView(t),i.focus();break;case"stop-after-current":cp.stopAfterCurrent=!cp.stopAfterCurrent;break;case"clear":gu.clear();break;case"shuffle":yield gu.shuffle(!a),i.scrollIntoView(0)}}))),[e,t,a]),l=(0,r.useCallback)((()=>Wy(this,void 0,void 0,(function*(){gu.atStart||(cp.prev(),e.current.scrollIntoView(t-1))}))),[e,t]),c=(0,r.useCallback)((()=>Wy(this,void 0,void 0,(function*(){gu.atEnd||(cp.next(),e.current.scrollIntoView(t+1))}))),[e,t]);return r.createElement("div",{className:"media-controls"},r.createElement("div",{className:"current-time-control"},r.createElement(Hv,{time:n}),r.createElement("input",{id:"playhead",type:"range","aria-label":"Seek",min:0,max:i,step:1,value:n,disabled:a,onChange:o})),r.createElement("div",{className:"playback-control"},r.createElement(Yy,null),r.createElement("div",{className:"media-buttons"},r.createElement(Hy,{"aria-label":"Previous track",icon:"prev",onClick:l}),r.createElement(Hy,{"aria-label":a?"Play":"Pause",icon:a?"play":"pause",onClick:a?Xf:Gf}),r.createElement(Hy,{"aria-label":"Stop",icon:"stop",onClick:ep}),r.createElement(Hy,{"aria-label":"Next track",icon:"next",onClick:c})),r.createElement("div",{className:"media-buttons-more"},r.createElement(Hy,{title:"More...",icon:"menu",onClick:s}))))}var Jy=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n};function Qy(e){var{items:t,selectedItems:n,rowIndex:i}=e,a=Jy(e,["items","selectedItems","rowIndex"]);const o=t.length,s=n.length,l=0===o,c=s===o,u=1===s;return r.createElement(fp,Object.assign({},a),-1===i?null:r.createElement(r.Fragment,null,u?r.createElement(vp,{label:"Play",value:"play",acceleratorKey:"Enter",key:"play"}):null,r.createElement(vp,{label:"Remove",value:"remove",acceleratorKey:"Del",key:"remove"}),u?r.createElement(vp,{label:"Info...",value:"info",acceleratorKey:`${U.ctrlKeyStr}+I`,key:"info"}):null),r.createElement(yp,null),c?null:r.createElement(vp,{label:"Select all",value:"select-all",acceleratorKey:`${U.ctrlKeyStr}+A`,key:"select-all"}),!u&&function(e,t){const n=e.findIndex((e=>e===t[0]));return t.every(((t,r)=>t===e[n+r]))}(t,n)?r.createElement(vp,{label:"Reverse selection",value:"reverse-selection",key:"reverse-selection"}):null,r.createElement(yp,null),l?null:r.createElement(vp,{label:"Clear",value:"clear",key:"clear"}))}const Xy={view:"details",showTitles:!1,cols:[{title:"#",render:()=>null,align:"right",className:"index"},{title:"Source",render:function({src:e,lookupStatus:t}){const[n]=e.split(":");let i;switch(t){case ic.Looking:i="lookup-looking";break;case ic.NotFound:i="lookup-not-found";break;default:i=Ll(e)?n:"lookup-pending"}return r.createElement(yi,{name:i,className:"youtube"===n?"":"show-connectivity"})},align:"center",className:"source"},{title:"Title",render:function({title:e,artists:t}){return t?r.createElement(r.Fragment,null,r.createElement("span",{className:"artist-text"},t.join("/")),r.createElement("span",{role:"separator"},"-"),r.createElement("span",{className:"title-text"},e)):r.createElement("span",{className:"title-text"},e)},className:"title"},{title:"Time",render:Kv,align:"right",className:"duration"}]};var Gy=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))};const Zy=["audio/*","video/*"];function ew(e){var{onSelect:t,onPlay:n,onEject:i,listViewRef:a}=e,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}(e,["onSelect","onPlay","onEject","listViewRef"]);const s=Lv(gu.observe,[]),l=function(e){const t=Rv(),n=Fy(),i=String(e).length,{zeroPadLineNumbers:a,showLineNumbers:o,showSourceIcons:s}=Lv(Qc.observe,Qc.get());return(0,r.useMemo)((()=>Object.assign(Object.assign({},Xy),{cols:Xy.cols.filter((e=>{switch(e.className){case"index":return o;case"source":return s;default:return!0}})).map((e=>"index"===e.className?Object.assign(Object.assign({},e),{render:(e,o)=>{const s=function(e,t=0){return r.createElement("span",{className:"number"},String(e+1).padStart(t,"0"))}(o,a?i:0);return e.id===(null==t?void 0:t.id)?r.createElement(r.Fragment,null,r.createElement(yi,{name:n?"pause":"play"}),s):s}}):e))})),[a,o,s,i,t,n])}(s.length),c=Rv(),[u,d]=(0,r.useState)(0),m=(0,r.useCallback)((e=>{const[t]=e.src.split(":");return`source-${t} ${e.id===(null==c?void 0:c.id)?"playing":""} ${e.unplayable||e.lookupStatus===ic.NotFound?"unplayable":""}`}),[c]),h=(0,r.useCallback)((e=>{d(e.length),null==t||t(e)}),[t]),f=(0,r.useCallback)((e=>{null==n||n(e)}),[n]),p=(0,r.useCallback)((e=>{1===e.length&&(null==n||n(e[0]))}),[n]),v=(0,r.useCallback)((e=>{1===e.length&&e[0]===c?null==i||i():gu.remove(e)}),[i,c]),b=(0,r.useCallback)((([e])=>Gy(this,void 0,void 0,(function*(){e&&(yield fv(e))}))),[]),g=(0,r.useCallback)(((e,t,i,o,l)=>Gy(this,void 0,void 0,(function*(){if(0===s.length)return;const c=yield function(e,t,n,i,a,o="left"){return s=this,l=void 0,u=function*(){return Ep((i=>r.createElement(Qy,Object.assign({},i,{items:e,selectedItems:t,rowIndex:n}))),i,a,o)},new((c=void 0)||(c=Promise))((function(e,t){function n(e){try{i(u.next(e))}catch(e){t(e)}}function r(e){try{i(u.throw(e))}catch(e){t(e)}}function i(t){t.done?e(t.value):function(e){return e instanceof c?e:new c((function(t){t(e)}))}(t.value).then(n,r)}i((u=u.apply(s,l||[])).next())}));var s,l,c,u}(s,e,o,t,i,-1===l?"right":"left");switch(c){case"play":null==n||n(e[0]);break;case"remove":gu.remove(e);break;case"info":yield fv(e[0]);break;case"select-all":a.current.selectAll();break;case"reverse-selection":{const t=s.findIndex((t=>t===e[0]));gu.reverseAt(t,e.length);break}case"clear":gu.clear()}}))),[n,s,a]);return r.createElement("div",{className:"playlist"},r.createElement(Nv,Object.assign({},o,{title:"Playlist",className:"media-list",layout:l,items:s,itemKey:"id",itemClassName:m,selectedIndex:0===s.length?-1:0,droppable:!0,droppableTypes:Zy,multiple:!0,reorderable:!0,onContextMenu:g,onDelete:v,onDoubleClick:f,onDrop:gu.insertAt,onEnter:p,onInfo:b,onMove:gu.moveSelection,onSelect:h,listViewRef:a})),r.createElement(Dv,{items:s,size:s.length,selectedCount:u}))}console.log("component::MediaPlayback");const tw=(0,r.memo)((function(){const e=(0,r.useRef)(null),t=Rv(),n=Fy(),i=(0,r.useCallback)((e=>{e===t?cp.play():(cp.load(null),cp.autoplay=!0,gu.setCurrentItem(e))}),[t]);return r.createElement("div",{className:"media-playback "+(n?"paused":"")},r.createElement(At,{id:"media-playback-layout",arrange:"rows"},r.createElement("div",{className:"panel playback"},r.createElement(qy,{listViewRef:e}),r.createElement(ew,{onPlay:i,onEject:rp,listViewRef:e})),r.createElement(Uy,null)))}));function nw(e){const t=e.dataTransfer;t&&(e.preventDefault(),t.effectAllowed="none",t.dropEffect="none")}function rw(e=null){var t,n;const r=navigator.mediaSession;e&&(r.metadata=new MediaMetadata({title:e.title,artist:null===(t=e.artists)||void 0===t?void 0:t.join(", "),album:e.artists?"":e.album,artwork:null===(n=e.thumbnails)||void 0===n?void 0:n.map((e=>({src:Up(e),sizes:`${e.width}x${e.height}`})))})),r.setActionHandler("play",Xf),r.setActionHandler("pause",Gf),r.setActionHandler("stop",ep),r.setActionHandler("previoustrack",tp),r.setActionHandler("nexttrack",np),r.setActionHandler("seekto",(e=>{null!=e.seekTime&&Zf(e.seekTime)}))}function iw(e){switch(e.key){case" ":e.target&&!("form"in e.target)&&(e.preventDefault(),aw());break;case"MediaPlayPause":e.preventDefault(),aw();break;case"MediaStop":e.preventDefault(),cp.stop();break;case"MediaTrackPrevious":e.preventDefault(),cp.prev();break;case"MediaTrackNext":e.preventDefault(),cp.next()}}function aw(){cp.paused?cp.play():cp.pause()}const ow=new z("desktopWarning");function sw(){const[e,t]=(0,r.useState)((()=>U.desktop||ow.getBoolean("dismissed"))),n=(0,r.useCallback)((()=>{ow.setBoolean("dismissed",!0),t(!0)}),[]);return e?null:r.createElement("div",{className:"desktop-warning"},r.createElement("h1",null,"ampcast"," ","0.8.12"),r.createElement("p",null,"This application is intended for a desktop browser."),r.createElement("p",null,r.createElement("button",{onClick:n},"Proceed")))}console.log("module::App"),console.log("module::index"),(0,i.s)(document.getElementById("app")).render(r.createElement((function(){return(0,r.useEffect)((()=>{document.body.classList.add(`browser-${U.name.replace(/\s+/g,"-")}`)}),[]),(0,r.useEffect)((()=>{const e=new ne;return $l().forEach((t=>{const n=t.observeIsLoggedIn().subscribe((e=>{document.body.classList.toggle(`${t.id}-connected`,e),document.body.classList.toggle(`${t.id}-not-connected`,!e)}));e.add(n)})),()=>e.unsubscribe()}),[]),(0,r.useLayoutEffect)((()=>{const e=document.getElementById("app"),t=document.getElementById("system"),n=new ne,r=e=>on(e,"focusin").subscribe((()=>{const t=e.querySelector(".focus");t!==document.activeElement&&(null==t||t.classList.toggle("focus",!1),document.activeElement.classList.toggle("focus",!0))}));return n.add(on(document,"focusout").subscribe((e=>{if(!e.relatedTarget){const e=(document.querySelector(".system .settings-dialog")?t:document).querySelectorAll(".focus");for(const t of e)t.classList.toggle("focus",!1)}}))),n.add(on(document,"mouseup").subscribe((()=>{const e=document.querySelectorAll(".active");for(const t of e)t.classList.toggle("active",!1)}))),n.add(on(t,"mousedown").subscribe(y)),n.add(r(e)),n.add(r(t)),()=>n.unsubscribe()}),[]),(0,r.useEffect)((()=>{const e=on(document,"dragenter"),t=on(document,"dragover"),n=on(document,"drop"),r=bn(e,t).pipe($e(nw)),i=bn(r,n.pipe($e(g))).subscribe();return()=>i.unsubscribe()}),[]),function(){const e=Rv(),t=Lv(Wf,null),n=Lv(Bf,0),i=Lv(Hf,0);(0,r.useEffect)((()=>{navigator.mediaSession.setPositionState({duration:i,position:n,playbackRate:1})}),[i,n]),(0,r.useEffect)((()=>rw(null==t?void 0:t.currentItem)),[t]),(0,r.useEffect)((()=>rw(e)),[e])}(),(0,r.useEffect)((()=>{document.getElementById("system").addEventListener("keydown",y),document.getElementById("popup").addEventListener("keydown",y),document.body.addEventListener("keydown",iw)}),[]),function(){(0,r.useEffect)((()=>{(()=>{var e,t,n,r;e=this,t=void 0,r=function*(){var e,t,n,r;const{state:i="granted"}=(yield null===(e=navigator.permissions)||void 0===e?void 0:e.query({name:"persistent-storage"}))||{};let a=yield null===(n=null===(t=navigator.storage)||void 0===t?void 0:t.persisted)||void 0===n?void 0:n.call(t);"granted"!==i||a||(a=yield null===(r=navigator.storage)||void 0===r?void 0:r.persist()),console.log("Persisted storage:",{state:i,persisted:a})},new((n=void 0)||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){e.done?i(e.value):function(e){return e instanceof n?e:new n((function(t){t(e)}))}(e.value).then(o,s)}l((r=r.apply(e,t||[])).next())}))})()}),[])}(),r.createElement("main",null,r.createElement(At,{id:"main-layout",arrange:"columns"},r.createElement(fy,null),r.createElement(tw,null)),r.createElement(sw,null))}),null))}},e=>{e.O(0,[136,529,503],(()=>(7784,e(e.s=7784)))),e.O()}]);